import{a6 as Te,r as q,E as ce,d as de,K as ae,k as ue,f as c,a7 as Re,e as d,h as $,g as e,m as f,l as g,I as x,t as l,H as oe,F as M,z as V,n as F,w as Ie,_ as me,o as Ce,y as ee,a3 as N,Q as K,ad as Ae}from"./index-CtAEeURr.js";import{$ as le,b as De}from"./api-client-Bm7qFAv0.js";function pe(w=!1,u={}){const n=Te(),o=q(w),b=q(!1),y=q(null),{closeOnEscape:p=!0,closeOnClickOutside:_=!0,showLoadingSpinner:L=!0}=u,G=()=>{o.value=!0,y.value=null},C=()=>{o.value=!1,y.value=null},W=v=>{b.value=v},a=v=>{v===null?y.value=null:typeof v=="string"?y.value=v:y.value=v.message,b.value=!1},s=(v,R,B)=>{n.showToast(R,B||"",v)},k=v=>{p&&v.key==="Escape"&&o.value&&C()},S=()=>{_&&C()};return ce(o,v=>{v&&p?document.addEventListener("keydown",k):document.removeEventListener("keydown",k)}),{show:o,isLoading:b,error:y,open:G,close:C,setLoading:W,setError:a,showToast:s,handleClickOutside:S,hasError:()=>y.value!==null,canSubmit:()=>!b.value&&y.value===null}}const Ne={class:"w-full max-w-5xl min-h-[70vh] max-h-[90vh] modal-glassmorphism premium-modal-container overflow-hidden flex flex-col"},Oe={class:"modal-header flex items-center justify-between p-4"},Pe={class:"flex items-center gap-4"},Le={class:"modal-icon-box p-3 rounded-lg"},ze={class:"text-xl font-bold text-white"},Be={key:0,class:"flex items-center gap-3 mt-1"},Fe={class:"text-sm text-gray-400"},Me={class:"flex items-center gap-2"},Ve={key:0,class:"flex items-center justify-center p-12"},Ue={class:"text-center"},Je={class:"mt-4 text-gray-300"},qe={key:1,class:"p-6 bg-red-900/10 border border-red-500/20 m-4 rounded-lg"},He={class:"text-gray-300"},Ge={class:"mt-4 flex gap-2"},Ke={key:2,class:"flex flex-col flex-1"},We={key:0,class:"modal-tabs flex items-center justify-center gap-1 p-3"},Ze=["onClick"],Xe={class:"overflow-y-auto flex-1",style:{"max-height":"calc(85vh - 120px)"}},Ye={class:"p-6"},Qe=de({__name:"DetailModal",props:{show:{type:Boolean},title:{},subtitle:{},headerIcon:{default:"lucide:file-text"},tabs:{default:()=>[]},defaultTab:{},loadingText:{default:"Caricamento dati..."},isLoading:{type:Boolean,default:!1},error:{default:null},data:{default:null}},emits:["close","retry","tabChanged"],setup(w,{emit:u}){const n=w,{handleClickOutside:o}=pe(!1),b=q(n.defaultTab||n.tabs[0]?.id||"default"),y=ae(()=>n.data!==null||n.error!==null);return(p,_)=>(c(),ue(Re,{to:"body"},[p.show?(c(),d("div",{key:0,class:"fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4 premium-modal-overlay",onClick:_[3]||(_[3]=Ie((...L)=>g(o)&&g(o)(...L),["self"]))},[e("div",Ne,[e("div",Oe,[e("div",Pe,[e("div",Le,[f(g(x),{icon:p.headerIcon,class:"h-6 w-6 text-emerald-400"},null,8,["icon"])]),e("div",null,[e("h2",ze,l(p.title),1),p.subtitle||p.$slots.subtitle?(c(),d("div",Be,[oe(p.$slots,"subtitle",{},()=>[e("span",Fe,l(p.subtitle),1)],!0)])):$("",!0)])]),e("div",Me,[oe(p.$slots,"headerActions",{isLoading:p.isLoading},void 0,!0),e("button",{onClick:_[0]||(_[0]=L=>p.$emit("close")),class:"p-2 text-gray-400 hover:text-red-400 transition-all duration-200 rounded-lg hover:bg-red-500/10"},[f(g(x),{icon:"lucide:x",class:"h-5 w-5"})])])]),p.isLoading&&!y.value?(c(),d("div",Ve,[e("div",Ue,[_[4]||(_[4]=e("div",{class:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-emerald-400"},null,-1)),e("p",Je,l(p.loadingText),1)])])):p.error?(c(),d("div",qe,[_[5]||(_[5]=e("div",{class:"flex items-center justify-between mb-4"},[e("h2",{class:"text-lg font-semibold text-red-400 premium-text-glow"},"Errore nel caricamento")],-1)),e("p",He,l(p.error),1),e("div",Ge,[e("button",{onClick:_[1]||(_[1]=L=>p.$emit("retry")),class:"btn-premium"},"Riprova"),e("button",{onClick:_[2]||(_[2]=L=>p.$emit("close")),class:"btn-premium-secondary"},"Chiudi")])])):(c(),d("div",Ke,[p.tabs.length>1?(c(),d("div",We,[(c(!0),d(M,null,V(p.tabs,L=>(c(),d("button",{key:L.id,onClick:G=>b.value=L.id,class:F(["flex items-center justify-center px-4 py-2 rounded-lg text-sm transition-all duration-200",b.value===L.id?"bg-emerald-500/20 text-emerald-400 border border-emerald-500/30":"text-gray-400 hover:bg-white/5 hover:text-white"])},l(L.label),11,Ze))),128))])):$("",!0),e("div",Xe,[oe(p.$slots,b.value,{activeTab:b.value,isLoading:p.isLoading,error:p.error,data:p.data},()=>[e("div",Ye,[oe(p.$slots,"default",{activeTab:b.value,data:p.data},void 0,!0)])],!0)])]))])])):$("",!0)]))}}),et=me(Qe,[["__scopeId","data-v-fb9208aa"]]);function tt(){const w=a=>a?a.replace(/n8n/gi,"WFEngine").replace(/\.nodes\./g,".engine.").replace(/\.base\./g,".core."):"",u=a=>{if(!a?.json)return null;const s=[],k=a.json.oggetto||a.json.subject;k&&s.push(`Oggetto: "${k}"`);const v=[a.json.mittente,a.json.mittente_nome,a.json.sender?.emailAddress?.address,a.sender?.emailAddress?.address].find(T=>T);v&&s.push(`Da: ${v}`);const B=[a.json.messaggio_cliente,a.json.messaggio,a.json.body?.content,a.json.body,a.json.content].find(T=>T&&typeof T=="string"&&T.length>20);if(B){const O=B.replace(/<[^>]+>/g," ").replace(/&[a-zA-Z0-9]+;/g," ").replace(/\s+/g," ").trim().substring(0,150);s.push(`Messaggio: "${O}${O.length>=150?"...":""}"`)}return s.length>0?{summary:"Email ricevuta",details:s,type:"email",confidence:"high"}:null},n=a=>{if(!a?.json)return null;const s=[],S=[a.json.output?.risposta_html,a.json.risposta_html,a.json.ai_response,a.json.response,a.json.output].find(v=>v&&typeof v=="string"&&v.length>20);if(S){const R=S.replace(/<[^>]+>/g," ").replace(/&[a-zA-Z0-9]+;/g," ").replace(/\s+/g," ").trim().substring(0,200);s.push(`Risposta: "${R}${R.length>=200?"...":""}"`)}return(a.json.categoria||a.json.classification)&&s.push(`Categoria: ${a.json.categoria||a.json.classification}`),s.length>0?{summary:"Risposta AI generata",details:s,type:"ai",confidence:"high"}:null},o=a=>{if(!a?.json)return null;const s=[];return a.json.order_reference&&s.push(`Riferimento: ${a.json.order_reference}`),a.json.customer_full_name&&s.push(`Cliente: ${a.json.customer_full_name}`),a.json.order_status&&s.push(`Stato: ${a.json.order_status}`),a.json.order_total_paid&&s.push(`Totale: ${a.json.order_total_paid}`),a.json.delivery_city&&s.push(`Città consegna: ${a.json.delivery_city}`),a.json.order_shipping_number&&s.push(`Tracking: ${a.json.order_shipping_number}`),s.length>0?{summary:"Dati ordine recuperati",details:s,type:"order",confidence:"high"}:null},b=a=>{if(!a?.json)return null;const s=[];if(a.json.matches||a.json.results){const k=a.json.matches||a.json.results,S=Array.isArray(k)?k.length:1;s.push(`Documenti trovati: ${S}`)}if((a.json.score||a.json.similarity)&&s.push(`Similarità: ${a.json.score||a.json.similarity}`),a.json.content||a.json.text){const S=(a.json.content||a.json.text).substring(0,100);s.push(`Contenuto: "${S}${S.length>=100?"...":""}"`)}return s.length>0?{summary:"Ricerca vettoriale completata",details:s,type:"vector",confidence:"medium"}:null},y=a=>{const s=JSON.stringify(a),k=[],S=/[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}/g,v=s.match(S);v&&v.length>0&&k.push(`Email rilevata: ${v[0]}`);const R=Array.isArray(a)?a[0]:a;if(R&&typeof R=="object"){const B=Object.keys(R.json||R);B.length>0&&k.push(`Campi disponibili: ${B.slice(0,4).join(", ")}${B.length>4?"...":""}`)}return{summary:"Dati di processo",details:k.length>0?k:["Dati complessi disponibili"],type:"generic",confidence:"low"}},p=(a,s,k,S)=>{const v=w(k),R=S?.toLowerCase()||"";if((v?.includes("trigger")||v?.includes("Trigger")||R.includes("ricezione")||R.includes("trigger"))&&s==="input")return{summary:"In attesa di eventi",details:["In attesa di nuove email dal server Microsoft Outlook"],type:"email",confidence:"high"};if(v==="execution_error"||R.includes("execution error")){let I="Errore di Esecuzione",P=["Il workflow ha riscontrato un errore durante l'esecuzione"];if(a&&typeof a=="object"&&(a.n8nErrorDetails||a.errorType)){const H=a.errorType||"Unknown Error",X=a.failedNode||"Unknown Node",z=a.specificErrorMessage||"Error details not available",Y=a.stackTrace,ie=a.httpCode,ne=a.errorTimestamp;if(I=`${H}: ${X}`,P=[`Errore: ${z}`,`Nodo Fallito: ${X}`,`Tipo Errore: ${H}`],ie&&P.push(`Codice HTTP: ${ie}`),ne){const se=new Date(ne);P.push(`Timestamp: ${se.toLocaleString("it-IT")}`)}if(Y&&Y.includes("at ")){const se=Y.split(`
`)[0];P.push(`Stack: ${se}`)}H==="NodeApiError"?P.push("Suggerimento: Verificare connessioni API e credenziali"):z.toLowerCase().includes("connection")?P.push("Suggerimento: Controllare connettività di rete"):z.toLowerCase().includes("auth")&&P.push("Suggerimento: Verificare le credenziali di autenticazione")}return{summary:I,details:P,type:"error",confidence:"high"}}if(!a)return{summary:"Nessun dato",details:["Nessun dato disponibile per questo step"],type:"generic",confidence:"high"};const T=Array.isArray(a)?a[0]:a;if(!T||typeof T!="object")return{summary:"Dato semplice",details:[String(T)||"Dato non strutturato"],type:"generic",confidence:"medium"};const O=R.includes("mail")||R.includes("ricezione"),te=R.includes("milena")||R.includes("assistente")||R.includes("ai"),E=R.includes("ordini")||R.includes("order"),j=R.includes("qdrant")||R.includes("vector");if(O&&s==="output"){const I=u(T);if(I)return I}if(te&&s==="output"){const I=n(T);if(I)return I}if(E){const I=o(T);if(I)return I}if(j&&s==="output"){const I=b(T);if(I)return I}return y(T)},_=a=>{const s=`--- ${a.summary.toUpperCase()} ---`,k=a.details.join(`
`);return`${s}
${k}`},L=(a,s,k,S)=>{const v=p(a,"input",k,S),R=p(s,"output",k,S);let B=v.details.length>0?v.details.join(" • "):v.summary,T=R.details.length>0?R.details.join(" • "):R.summary;const O=S?.toLowerCase()||"";if(O.includes("mail")||O.includes("ricezione")||R.type==="email"){const E=s?.body?.content||s?.json?.body?.content||s?.main?.json?.body?.content||a?.body?.content||a?.json?.body?.content||a?.main?.json?.body?.content;if(E&&typeof E=="string"){let j=E.replace(/<script[^>]*>.*?<\/script>/gi,"").replace(/<style[^>]*>.*?<\/style>/gi,"").replace(/<[^>]+>/g," ").replace(/&nbsp;/g," ").replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&#039;/g,"'").replace(/&[a-zA-Z0-9]+;/g," ").replace(/\r\n/g," ").replace(/\n/g," ").replace(/\t/g," ").replace(/\s+/g," ").trim();if(j.length>20)if(!j.toLowerCase().includes("content-type")&&!j.toLowerCase().includes("charset")&&!j.toLowerCase().includes("viewport"))T=`Email received: "${j.length>150?j.substring(0,150)+"...":j}"`;else{const I=s?.oggetto||s?.json?.oggetto||a?.oggetto||a?.json?.oggetto,P=s?.mittente||s?.json?.mittente||a?.mittente||a?.json?.mittente;I&&P?T=`Email from ${P} - Subject: "${I}"`:I?T=`Email received - Subject: "${I}"`:T="Customer email received and processed"}}if(O.includes("rispond")){const j=s?.body?.content||s?.json?.body?.content;if(j&&typeof j=="string"){const I=j.replace(/<[^>]*>/g,"").replace(/\s+/g," ").trim();T=`Email sent: "${I.length>200?I.substring(0,200)+"...":I}"`}}}else if(O.includes("milena")||O.includes("assistente")||k==="ai_agent"){const E=s?.output?.risposta_html||s?.json?.output?.risposta_html||s?.response||s?.json?.response||s?.main?.json?.output?.risposta_html;if(E&&typeof E=="string"){const j=E.replace(/<[^>]*>/g,"").replace(/\s+/g," ").trim();T=`AI Response: "${j.length>200?j.substring(0,200)+"...":j}"`}}else if(O.includes("qdrant")||O.includes("vector")||k==="vector_search"){const E=s?.ai_tool?.json?.response||s?.json?.response||s?.response||s?.main?.ai_tool?.json?.response;if(E&&Array.isArray(E)){const j=E.length,I=E[0];if(I&&typeof I.text=="string")try{const P=JSON.parse(I.text),H=P.pageContent||P.content;if(H){const X=H.length>150?H.substring(0,150)+"...":H;T=`Found ${j} documents: "${X}"`}}catch{T=`Found ${j} search results`}else T=`Found ${j} search results`}}else if(O.includes("ordini")||O.includes("parcel")||k==="order_lookup"||k==="parcel_tracking"){const E=s?.json||s?.main?.json||s;if(E){const j=[];E.order_reference&&j.push(`Order: ${E.order_reference}`),E.customer_full_name&&j.push(`Customer: ${E.customer_full_name}`),E.order_status&&j.push(`Status: ${E.order_status}`),E.tracking_number&&j.push(`Tracking: ${E.tracking_number}`),E.delivery_status&&j.push(`Delivery: ${E.delivery_status}`),j.length>0&&(T=j.join(" • "))}}else if(O.includes("execute")||O.includes("workflow")||k==="sub_workflow"){const E=s?.json||s?.main?.json||s;if(E){const j=[];E.workflow_name&&j.push(`Workflow: ${E.workflow_name}`),E.execution_status&&j.push(`Status: ${E.execution_status}`),E.duration&&j.push(`Duration: ${E.duration}ms`),E.nodes_executed&&j.push(`Nodes: ${E.nodes_executed}`),j.length>0?T=j.join(" • "):T="Sub-workflow executed successfully"}}B.length>150&&(B=B.substring(0,150)+"..."),T.length>250&&(T=T.substring(0,250)+"...");const te=G(v,R,k,S);return{inputSummary:B,outputSummary:T,businessValue:te}},G=(a,s,k,S)=>{const v=S?.toLowerCase()||"";return v.includes("milena")||v.includes("assistente")||s.type==="ai"?"Risposta intelligente generata per il cliente":v.includes("mail")||v.includes("ricezione")||s.type==="email"?v.includes("ricezione")?"Email cliente acquisita nel sistema":"Comunicazione inviata al cliente":v.includes("supabase")||v.includes("database")||s.type==="order"?"Dati salvati nel sistema aziendale":v.includes("extractor")||v.includes("parser")?"Informazioni estratte e processate":k?.includes("http")||v.includes("api")?"Integrazione esterna completata":"Operazione completata con successo"},C=a=>{const s=[];a.businessSummary&&(s.push(a.businessSummary.description),a.summaryType==="document"&&a.businessSummary.pageCount&&s.push(`Pages: ${a.businessSummary.pageCount}`),a.summaryType==="dataset"&&(a.businessSummary.totalRows&&s.push(`Rows: ${a.businessSummary.totalRows}`),a.businessSummary.totalColumns&&s.push(`Columns: ${a.businessSummary.totalColumns}`))),a.metrics&&Object.entries(a.metrics).slice(0,3).forEach(([S,v])=>{s.push(`${S}: ${v}`)}),a.businessInsight&&s.push(`Insight: ${a.businessInsight}`);let k="generic";switch(a.summaryType){case"document":k="document";break;case"dataset":k="dataset";break;case"emails":k="email";break;case"statistics":k="statistical";break;case"ai":k="ai";break}return{summary:a.businessSummary?.title||"Process Data",details:s,type:k,confidence:a.type==="ai_generated"?"medium":"high"}};return{parseBusinessData:p,formatBusinessData:_,formatTimelineStepData:L,sanitizeNodeType:w,parseIntelligentSummary:C,formatIntelligentData:a=>{const s=C(a);return _(s)}}}function re(w){return w?w.replace(/<[^>]+>/g," ").replace(/&[a-zA-Z0-9]+;/g," ").replace(/\s+/g," ").replace(/\n{3,}/g,`

`).trim():""}function U(w,u=150){if(!w||w.length<=u)return w;const n=w.substring(0,u),o=n.lastIndexOf(" ");return o>0?n.substring(0,o)+"...":n+"..."}function st(w){return w?w.subject||w.oggetto||w.sender||w.mittente||w.email_body?"email":w.ai_response||w.risposta_html||w.output?.risposta_html||w.chatResponse||w.gpt_response?"ai":w.orderId||w.order_id||w.items||w.orderDetails?"order":w.vector_results||w.similarity_search||w.embeddings?"vector":"generic":"generic"}function ge(w){if(!w)return"low";const n=Object.keys(w).filter(o=>w[o]!==null&&w[o]!==void 0).length;return n>5?"high":n>2?"medium":"low"}class it{static parse(u){const n=this.extractEmailData(u),o=ge(n),b=[];let y="Email received";if(n.subject&&(y=`Email: ${U(n.subject,100)}`,b.push(`Subject: ${n.subject}`)),n.sender&&b.push(`From: ${n.sender}`),n.recipient&&b.push(`To: ${n.recipient}`),n.body){const p=re(n.body),_=U(p,200);_&&b.push(`Content: ${_}`)}return n.attachments&&n.attachments.length>0&&b.push(`Attachments: ${n.attachments.length} file(s)`),{summary:y,details:b,type:"email",confidence:o,metadata:n,businessValue:this.extractBusinessValue(n)}}static extractEmailData(u){if(!u)return{};const n={},o=u.json||u;return n.subject=o.subject||o.oggetto||o.email_subject||o.Subject||o.title,n.sender=o.sender||o.mittente||o.from||o.From||o.email_from||o.sender_email,n.recipient=o.recipient||o.destinatario||o.to||o.To||o.email_to,n.body=o.body||o.email_body||o.corpo||o.message||o.content||o.text||o.html||o.email_content,(o.attachments||o.allegati)&&(n.attachments=o.attachments||o.allegati),n.timestamp=o.timestamp||o.date||o.received_at||o.sent_at,n}static extractBusinessValue(u){const n=[];if(u.subject){const o=u.subject.toLowerCase();(o.includes("order")||o.includes("ordine"))&&n.push("Order-related"),(o.includes("support")||o.includes("help")||o.includes("assistenza"))&&n.push("Support request"),(o.includes("urgent")||o.includes("urgente"))&&n.push("High priority"),(o.includes("invoice")||o.includes("fattura"))&&n.push("Financial")}if(u.sender){const o=u.sender.toLowerCase();if(o.includes(".com")||o.includes(".it")){const b=o.split("@")[1];b&&(b.includes("google")||b.includes("microsoft")||b.includes("amazon"))&&n.push("Major vendor")}}return n.length>0?n.join(", "):"Standard communication"}static generateSummary(u){return u.subject?`Processed email: "${U(u.subject,80)}"`:u.sender?`Email received from ${u.sender}`:"Email communication processed"}}class nt{static parse(u){const n=this.extractAIData(u),o=ge(n),b=[];let y="AI processing completed";if(n.response){const p=re(n.response);y=`AI: ${U(p,100)}`,b.push(`Response: ${U(p,300)}`)}return n.prompt&&b.push(`Prompt: ${U(n.prompt,150)}`),n.model&&b.push(`Model: ${n.model}`),n.tokens&&b.push(`Tokens used: ${n.tokens}`),{summary:y,details:b,type:"ai",confidence:o,metadata:n,businessValue:this.extractBusinessValue(n)}}static extractAIData(u){if(!u)return{};const n={},o=u.json||u;return n.response=o.ai_response||o.risposta_html||o.output?.risposta_html||o.chatResponse||o.gpt_response||o.response||o.answer||o.output?.text||o.completion||o.generated_text||o.ai_output,n.prompt=o.prompt||o.question||o.query||o.input||o.user_message||o.domanda,n.model=o.model||o.model_name||o.ai_model||o.llm_model||this.detectModelFromResponse(n.response),(o.tokens||o.token_count||o.usage?.total_tokens)&&(n.tokens=o.tokens||o.token_count||o.usage?.total_tokens),n.timestamp=o.timestamp||o.created_at||o.generated_at,n}static detectModelFromResponse(u){if(!u)return"Unknown AI Model";const n=u.toLowerCase();return n.includes("gpt-4")||n.includes("openai")?"GPT-4":n.includes("gpt-3")?"GPT-3.5":n.includes("claude")?"Claude":n.includes("gemini")?"Gemini":n.includes("llama")?"LLaMA":"AI Assistant"}static extractBusinessValue(u){const n=[];if(u.response){const o=u.response.toLowerCase();(o.includes("customer")||o.includes("cliente"))&&n.push("Customer-focused"),(o.includes("analysis")||o.includes("analisi"))&&n.push("Data analysis"),(o.includes("recommendation")||o.includes("suggest")||o.includes("consiglio"))&&n.push("Strategic advice"),(o.includes("report")||o.includes("summary")||o.includes("rapporto"))&&n.push("Report generation"),(o.includes("translation")||o.includes("traduzione"))&&n.push("Translation service")}if(u.prompt){const o=u.prompt.toLowerCase();(o.includes("write")||o.includes("scrivi"))&&n.push("Content creation"),(o.includes("analyze")||o.includes("analizza"))&&n.push("Analysis task"),(o.includes("help")||o.includes("aiuto"))&&n.push("Support task")}return u.tokens&&(u.tokens>1e3?n.push("Complex processing"):u.tokens<100&&n.push("Quick response")),n.length>0?n.join(", "):"AI processing task"}static generateSummary(u){if(u.response){const n=re(u.response);return`AI generated: ${U(n,80)}`}return u.prompt?`AI processed: "${U(u.prompt,60)}"`:u.model?`${u.model} completed processing`:"AI task completed successfully"}static hasStructuredData(u){if(!u.response)return!1;const n=u.response;if(n.includes("{")&&n.includes("}"))try{return JSON.parse(n),!0}catch{}return!!(n.includes("|")||n.includes("•")||n.includes("1."))}}class ot{static cache=new Map;static process(u,n){if(n?.executionId){const y=`${n.executionId}-${JSON.stringify(u).substring(0,50)}`;if(this.cache.has(y))return this.cache.get(y)}const o=st(u);let b;switch(o){case"email":b=it.parse(u);break;case"ai":b=nt.parse(u);break;case"order":b=this.parseOrderData(u);break;case"vector":b=this.parseVectorData(u);break;default:b=this.parseGenericData(u)}if(n&&(b.metadata={...b.metadata,source:n.source,nodeType:n.nodeType,workflowId:n.workflowId}),n?.executionId){const y=`${n.executionId}-${JSON.stringify(u).substring(0,50)}`;if(this.cache.set(y,b),this.cache.size>100){const p=this.cache.keys().next().value;this.cache.delete(p)}}return b}static parseOrderData(u){const n=u.json||u,o=[];let b="Order processed";if(n.orderId||n.order_id){const y=n.orderId||n.order_id;b=`Order #${y}`,o.push(`Order ID: ${y}`)}if((n.customer||n.customerName)&&o.push(`Customer: ${n.customer||n.customerName}`),n.items&&Array.isArray(n.items)&&(o.push(`Items: ${n.items.length} product(s)`),n.items.slice(0,3).forEach(y=>{(y.name||y.product)&&o.push(`  • ${y.name||y.product}`)})),n.total||n.totalAmount){const y=n.total||n.totalAmount;o.push(`Total: €${y}`)}return(n.status||n.orderStatus)&&o.push(`Status: ${n.status||n.orderStatus}`),{summary:b,details:o,type:"order",confidence:"high",metadata:n,businessValue:"Customer transaction"}}static parseVectorData(u){const n=u.json||u,o=[];let b="Search completed";if(n.query||n.search_query){const y=n.query||n.search_query;b=`Search: "${U(y,50)}"`,o.push(`Query: ${y}`)}if(n.results||n.vector_results){const y=n.results||n.vector_results;Array.isArray(y)&&(o.push(`Found: ${y.length} result(s)`),y.slice(0,3).forEach((p,_)=>{const L=p.content||p.text||p.document;L&&o.push(`  ${_+1}. ${U(L,100)}`)}))}return(n.similarity_score||n.score)&&o.push(`Match score: ${n.similarity_score||n.score}`),{summary:b,details:o,type:"vector",confidence:"medium",metadata:n,businessValue:"Information retrieval"}}static parseGenericData(u){const n=u.json||u,o=[];let b="Data processed";const y=Object.keys(n).filter(p=>n[p]!==null&&n[p]!==void 0&&p!=="json");for(const p of y){const _=n[p];if(typeof _=="string"&&_.length>0){b=U(re(_),100);break}}return y.slice(0,5).forEach(p=>{const _=n[p];_!=null&&(typeof _=="string"?o.push(`${p}: ${U(_,100)}`):typeof _=="number"?o.push(`${p}: ${_}`):typeof _=="boolean"?o.push(`${p}: ${_?"Yes":"No"}`):Array.isArray(_)?o.push(`${p}: ${_.length} items`):typeof _=="object"&&o.push(`${p}: [Complex data]`))}),{summary:b,details:o.length>0?o:["Data processing completed"],type:"generic",confidence:"low",metadata:n,businessValue:"Business operation"}}static clearCache(){this.cache.clear()}static getCacheStats(){return{size:this.cache.size,maxSize:100}}}const rt={class:"p-4 space-y-4"},at={class:"card-glassmorphism rounded-lg p-4"},lt={class:"text-text-muted whitespace-pre-wrap"},ct={class:"grid grid-cols-1 md:grid-cols-3 gap-4"},dt={class:"metric-card-glassmorphism rounded-lg p-4"},ut={class:"flex items-center justify-between mb-2"},mt={class:"text-2xl font-bold text-white"},pt={class:"metric-card-glassmorphism rounded-lg p-4"},gt={class:"flex items-center justify-between mb-2"},ft={class:"text-sm text-text-muted"},xt={class:"text-2xl font-bold text-white"},ht={class:"metric-card-glassmorphism rounded-lg p-4"},bt={class:"flex items-center justify-between mb-2"},vt={class:"text-2xl font-bold text-white"},yt={class:"card-glassmorphism rounded-lg p-4"},_t={key:0,class:"space-y-2"},wt={class:"text-text-muted"},kt={key:1,class:"space-y-2"},$t={class:"flex items-start gap-2"},St={class:"flex items-start gap-2"},Et={class:"flex items-start gap-2"},jt={class:"value-card-glassmorphism rounded-lg p-4"},Tt={class:"flex items-start gap-3"},Rt={class:"text-text-muted"},It={key:0,class:"grid grid-cols-2 md:grid-cols-4 gap-3 mt-4"},Ct={key:0,class:"text-center"},At={class:"text-xl font-bold text-primary"},Dt={key:1,class:"text-center"},Nt={class:"text-xl font-bold text-green-400"},Ot={key:2,class:"text-center"},Pt={class:"text-xl font-bold text-blue-400"},Lt={key:3,class:"text-center"},zt={class:"text-xl font-bold text-purple-400"},Bt={class:"p-4"},Ft={key:0,class:"space-y-4 mb-6"},Mt={class:"flex items-center justify-between"},Vt={class:"flex-1"},Ut={class:"flex items-center gap-2 mb-2"},Jt={class:"text-xs text-text-muted"},qt={class:"text-sm text-white"},Ht={key:0,class:"text-xs text-text-muted mt-1"},Gt={key:1,class:"space-y-6"},Kt={class:"flex items-center justify-between mb-4"},Wt={class:"flex items-center"},Zt={class:"text-white font-medium"},Xt={class:"text-sm text-gray-400"},Yt={class:"text-xs text-gray-500"},Qt={class:"mb-4"},es={class:"grid grid-cols-1 md:grid-cols-2 gap-4"},ts={class:"text-sm text-gray-300"},ss={class:"text-sm text-gray-300"},is={key:0,class:"mt-4 p-3 bg-purple-400/10 rounded border border-purple-400/20"},ns={class:"text-sm text-white"},os={key:1,class:"mt-4 space-y-3"},rs={class:"flex items-center gap-2"},as={class:"text-xs font-medium text-blue-400 uppercase"},ls={key:0,class:"ml-auto"},cs={key:0,class:"bg-blue-900/20 border border-blue-500/20 rounded-lg p-4"},ds={class:"text-sm font-medium text-blue-300 mb-2"},us={class:"text-sm text-gray-300"},ms={key:0,class:"mt-2 text-xs text-gray-400"},ps={key:1,class:"mt-2 text-xs text-gray-400"},gs={key:1,class:"grid grid-cols-2 md:grid-cols-4 gap-2"},fs={class:"text-xs text-gray-500 capitalize"},xs={class:"text-sm font-medium text-white"},hs={key:2,class:"bg-gray-900/50 rounded-lg p-3"},bs={class:"flex items-center justify-between mb-2"},vs=["onClick"],ys={key:0,class:"text-xs text-gray-300 space-y-1"},_s={key:0},ws={key:1},ks={key:1,class:"overflow-x-auto"},$s={class:"text-xs w-full"},Ss={class:"text-gray-500"},Es={key:3,class:"bg-green-900/20 border border-green-500/20 rounded-lg p-3"},js={class:"flex items-start gap-2"},Ts={class:"text-sm text-gray-300"},Rs={key:4,class:"flex flex-wrap gap-2"},Is=["onClick"],Cs={key:2,class:"text-center py-12 text-gray-400"},As={class:"p-4 overflow-y-auto"},Ds={class:"grid grid-cols-2 md:grid-cols-4 gap-3 mb-4"},Ns={class:"metric-card-glassmorphism rounded-lg p-2"},Os={class:"flex items-center justify-between"},Ps={class:"text-lg font-bold text-white"},Ls={class:"text-xs text-gray-500"},zs={class:"metric-card-glassmorphism rounded-lg p-2"},Bs={class:"flex items-center justify-between"},Fs={class:"text-lg font-bold text-green-400"},Ms={class:"text-xs text-gray-500"},Vs={class:"metric-card-glassmorphism rounded-lg p-2"},Us={class:"flex items-center justify-between"},Js={class:"text-lg font-bold text-red-400"},qs={key:0,class:"text-xs text-orange-400"},Hs={class:"metric-card-glassmorphism rounded-lg p-2"},Gs={class:"flex items-center justify-between"},Ks={class:"text-lg font-bold text-purple-400"},Ws={key:0,class:"card-glassmorphism rounded-lg p-3 mb-4"},Zs={class:"flex items-end justify-between h-20 gap-1"},Xs=["title"],Ys={class:"text-xs text-gray-500 mt-1"},Qs={key:1,class:"bg-surface-hover rounded-lg border border-border overflow-hidden"},ei={class:"max-h-[400px] overflow-y-auto"},ti={class:"w-full"},si={class:"divide-y divide-border/50"},ii={class:"px-3 py-2 text-text-muted"},ni={class:"px-3 py-2"},oi={class:"px-3 py-2 text-text-muted"},ri={key:0},ai={key:1,class:"text-gray-600"},li={class:"px-3 py-2 text-text-muted"},ci={key:0,class:"text-xs"},di={key:1,class:"text-xs text-gray-600"},ui={key:2,class:"text-center py-6 text-gray-400"},mi={class:"p-3 overflow-y-auto"},pi={class:"grid grid-cols-1 lg:grid-cols-2 gap-3"},gi={class:"space-y-3"},fi={class:"card-glassmorphism rounded-lg p-3"},xi={class:"text-sm font-medium text-white mb-2 flex items-center gap-2"},hi={class:"grid grid-cols-2 gap-2 mb-2"},bi={class:"p-2 bg-surface/50 rounded border border-emerald-500/20"},vi={class:"flex items-center justify-between"},yi={class:"text-xl font-bold text-white"},_i={class:"p-2 bg-surface/50 rounded border border-border/50"},wi={class:"flex items-center justify-between"},ki={class:"text-xl font-bold text-white"},$i={key:0,class:"text-xs text-gray-500 mt-0.5"},Si={class:"p-2 bg-surface/50 rounded border border-border/50"},Ei={class:"flex items-center justify-between"},ji={class:"text-xl font-bold text-white"},Ti={class:"p-2 bg-surface/50 rounded border border-border/50"},Ri={class:"flex items-center justify-between"},Ii={class:"text-xl font-bold text-white"},Ci={class:"grid grid-cols-3 gap-1.5"},Ai={class:"p-1.5 bg-surface/30 rounded text-center"},Di={class:"text-sm font-bold text-white"},Ni={class:"p-1.5 bg-surface/30 rounded text-center"},Oi={class:"text-sm font-bold text-white"},Pi={class:"p-1.5 bg-surface/30 rounded text-center"},Li={class:"text-sm font-bold text-white"},zi={class:"card-glassmorphism rounded-lg p-3"},Bi={class:"text-sm font-medium text-white mb-2 flex items-center gap-2"},Fi={class:"h-20 flex items-end gap-1 mb-2"},Mi=["title"],Vi={key:0,class:"text-xs text-center text-green-400 pt-1"},Ui=["title"],Ji={key:0,class:"text-xs text-center text-red-400 pt-1"},qi=["title"],Hi={class:"text-xs text-center text-orange-400 pt-1"},Gi={class:"flex justify-around text-xs"},Ki={class:"flex items-center gap-1"},Wi={class:"flex items-center gap-1"},Zi={key:0,class:"flex items-center gap-1"},Xi={class:"card-glassmorphism rounded-lg p-3"},Yi={class:"text-sm font-medium text-white mb-2 flex items-center gap-2"},Qi={key:0,class:"h-24"},en={class:"flex items-end justify-between h-20 gap-0.5"},tn=["title"],sn={key:0,class:"text-xs text-emerald-400 text-center block pt-0.5"},nn={class:"flex justify-between mt-0.5"},on={key:1,class:"h-20 flex items-center justify-center text-xs text-gray-500"},rn={class:"space-y-3"},an={class:"card-glassmorphism rounded-lg p-3"},ln={class:"text-sm font-medium text-white mb-2 flex items-center gap-2"},cn={class:"grid grid-cols-2 gap-2 mb-2"},dn={class:"p-2 bg-surface/50 rounded border border-border/50"},un={class:"flex items-center justify-between"},mn={class:"text-lg font-bold text-white"},pn={class:"p-2 bg-surface/50 rounded border border-border/50"},gn={class:"flex items-center justify-between"},fn={class:"text-lg font-bold text-white"},xn={class:"p-2 bg-surface/50 rounded border border-border/50"},hn={class:"flex items-center justify-between"},bn={class:"text-lg font-bold text-white"},vn={class:"p-2 bg-surface/50 rounded border border-border/50"},yn={class:"flex items-center justify-between"},_n={class:"text-lg font-bold text-white"},wn={key:0},kn={key:1,class:"text-gray-600"},$n={key:0,class:"p-2 bg-surface/30 rounded"},Sn={class:"flex items-center justify-between"},En={class:"card-glassmorphism rounded-lg p-3"},jn={class:"text-sm font-medium text-white mb-2 flex items-center gap-2"},Tn={class:"space-y-1.5"},Rn={class:"flex justify-between items-center p-1.5 bg-surface/50 rounded"},In={class:"text-xs text-gray-400 flex items-center gap-1"},Cn={class:"text-sm font-bold text-yellow-400"},An={class:"flex justify-between items-center p-1.5 bg-surface/50 rounded"},Dn={class:"text-xs text-gray-400 flex items-center gap-1"},Nn={class:"text-sm font-bold text-green-400"},On={class:"flex justify-between items-center p-1.5 bg-surface/50 rounded"},Pn={class:"text-xs text-gray-400 flex items-center gap-1"},Ln={class:"text-sm font-bold text-red-400"},zn={class:"flex justify-between items-center p-1.5 bg-surface/30 rounded border border-emerald-500/20"},Bn={class:"text-xs text-gray-400 flex items-center gap-1"},Fn={class:"text-sm font-bold text-emerald-400"},Mn={class:"card-glassmorphism rounded-lg p-3"},Vn={class:"text-sm font-medium text-white mb-2 flex items-center gap-2"},Un={class:"space-y-1.5"},Jn={key:0,class:"flex items-start gap-1.5"},qn={class:"flex-1"},Hn={class:"text-xs text-gray-400"},Gn={class:"mt-1 h-1 bg-surface/50 rounded-full overflow-hidden"},Kn={key:1,class:"flex items-start gap-1.5"},Wn={class:"flex-1"},Zn={class:"text-xs text-gray-400"},Xn={class:"mt-1 h-1 bg-surface/50 rounded-full overflow-hidden"},Yn={key:2,class:"flex items-start gap-1.5"},Qn={class:"flex-1"},eo={class:"text-xs text-gray-400"},to={class:"mt-1 h-1 bg-surface/50 rounded-full overflow-hidden"},so={key:3,class:"flex items-start gap-1.5"},io={class:"flex-1"},no={class:"text-xs text-gray-400"},oo={class:"mt-1 h-1 bg-surface/50 rounded-full overflow-hidden"},ro={class:"bg-gradient-to-r from-blue-500/20 to-blue-500/10 rounded-lg p-3 border border-blue-500/30"},ao={class:"text-sm font-medium text-white mb-2 flex items-center gap-2"},lo={class:"space-y-1.5 text-xs"},co={key:0,class:"flex items-start gap-1.5 p-1.5 bg-surface/30 rounded border border-border/50"},uo={class:"flex-1"},mo={class:"text-gray-400 text-xs mt-0.5"},po={key:1,class:"flex items-start gap-1.5 p-1.5 bg-surface/30 rounded border border-border/50"},go={key:2,class:"flex items-start gap-1.5 p-1.5 bg-surface/30 rounded border border-border/50"},fo={class:"flex-1"},xo={class:"text-gray-400 text-xs mt-0.5"},ho={key:3,class:"flex items-start gap-1.5 p-1.5 bg-surface/30 rounded border border-border/50"},bo={key:4,class:"flex items-start gap-1.5 p-1.5 bg-surface/30 rounded border border-emerald-500/20"},vo={class:"mt-3 p-2 bg-surface/30 rounded-lg border border-border/50"},yo={class:"flex items-center justify-between"},_o={class:"flex items-center gap-4 text-xs"},wo={class:"flex items-center gap-1"},ko={class:"text-white font-medium"},$o={key:0,class:"flex items-center gap-1"},So={class:"text-white font-medium"},Eo={class:"flex items-center gap-1"},jo={class:"text-white font-medium"},To={class:"p-6"},Ro={class:"flex items-center justify-between mb-4"},Io={class:"flex items-center"},Co={class:"flex gap-2"},Ao={id:"raw-data-content",class:"bg-black/50 p-4 rounded-lg border border-gray-800 text-xs text-gray-300 overflow-auto max-h-96 font-mono whitespace-pre premium-scrollbar"},Do=de({__name:"TimelineModal",props:{workflowId:{},executionId:{},tenantId:{},show:{type:Boolean}},emits:["close"],setup(w,{emit:u}){const n=w,{isLoading:o,error:b,setLoading:y,setError:p,showToast:_}=pe(),{formatTimelineStepData:L}=tt(),G=(i,t,m,r)=>{const h=ot.process(i,{source:"frontend",nodeType:m,workflowId:n.workflowId});return{summary:h.summary,details:h.details,type:h.type,metadata:h.metadata,businessValue:h.businessValue}},C=q(null);q(null);const W=q(new Set),a=q([]),s=q(null),k=q([]),S=q(null),v=ae(()=>C.value?.workflow?.name||`Business Process ${n.workflowId}`),R=ae(()=>{if(!C.value)return"";const i=C.value.workflow,t=C.value.execution,m=i?.active?"ACTIVE":"INACTIVE";return`ID: ${n.workflowId} • Status: ${m}${t?` • Last: ${t.id}`:""}`}),B=[{id:"overview",label:"Process Overview"},{id:"executions",label:"Latest Activity"},{id:"history",label:"Process History"},{id:"analytics",label:"Analytics"}],T=async()=>{y(!0),p(null);const i=Ae;try{console.log("🔄 Loading dashboard data for workflow:",n.workflowId);const t=await le(`${i}/api/business/dashboard/${n.workflowId}`),m=await le(`${i}/api/business/workflow/${n.workflowId}/full-stats`,{params:{days:30}});console.log("✅ Dashboard data loaded:",t),t.workflow&&(S.value=t.workflow),t.executions&&(a.value=t.executions,console.log("✅ Executions with business data:",a.value.length)),m?(s.value=m,console.log("✅ Full statistics loaded:",s.value),console.log("📊 KPIs detail from full-stats:",{total:s.value?.kpis?.totalExecutions,success:s.value?.kpis?.successfulExecutions,failed:s.value?.kpis?.failedExecutions,canceled:s.value?.kpis?.canceledExecutions,rate:s.value?.kpis?.successRate})):t.statistics&&(s.value=t.statistics,console.log("⚠️ Using fallback statistics from dashboard endpoint")),t.recentActivity&&(k.value=t.recentActivity,console.log("✅ Recent activity loaded:",k.value.length,"items"))}catch(t){console.error("❌ Failed to load dashboard data:",t),p("Failed to load dashboard data. Please try again.")}try{let t=`${i}/api/business/raw-data-for-modal/${n.workflowId}`;n.executionId&&(t+=`?executionId=${n.executionId}`);const m=await De.getWorkflowDetails(n.workflowId);if(console.log("✅ Process timeline loaded:",m.data),!m.data?.businessNodes||m.data.businessNodes.length===0){console.log("ℹ️ No show-n nodes found for this workflow - showing empty state"),C.value={...m.data,businessNodes:[]};return}if(console.log(`📊 Starting enrichment of ${m.data?.businessNodes?.length||0} nodes`),m.data?.businessNodes){const r=m.data.businessNodes.length;m.data.businessNodes=m.data.businessNodes.map((h,A)=>{if(console.log(`📊 Processing node ${A+1}/${r}: "${h.name}"`),h.data&&(h.data.inputJson||h.data.outputJson))try{const D=L(h.data.inputJson,h.data.outputJson,h.data.nodeType,h.name);return console.log(`✅ Enriched node "${h.name}":`,D),{...h,enrichedData:D}}catch(D){return console.warn(`⚠️ Failed to enrich node "${h.name}":`,D),h}else return console.log(`ℹ️ Skipping enrichment for node "${h.name}" - no input/output data`),h}),console.log(`📊 Enrichment complete: ${m.data.businessNodes.length}/${r} nodes processed`),m.data.businessNodes.length!==r&&console.error(`❌ Node count mismatch! Original: ${r}, Final: ${m.data.businessNodes.length}`)}C.value=m.data}catch(t){console.error("❌ Failed to load process timeline:",t),t.message.includes("Failed to fetch")||t.message.includes("fetch")?p("Process configuration incomplete. This business process needs to be configured with visible steps for reporting."):t.message.includes("404")?p("Process not found or not yet configured for business reporting."):p("Unable to load process details. Please try again or contact support.")}finally{y(!1)}},O=i=>G(i.outputData||i.inputData,i.outputData?"output":"input",i.nodeType,i.nodeName).summary,te=i=>{const t=G(i.data,"output",i.nodeType,i.name);if(t.type==="error"&&t.details.length>0)return t.details.join(`
`);if(i.data?.n8nErrorDetails){const m=i.data.n8nErrorDetails;return`${m.errorType}: ${m.message} (Nodo: ${m.nodeName})`}return"Process execution failed to complete successfully"},E=i=>{const t=G(i.data,"output",i.nodeType,i.name);return t.type==="error"&&t.details.length>0?t.details.find(m=>m.includes("Errore:"))||t.details[0]:i.data?.n8nErrorDetails?i.data.n8nErrorDetails.message||"":"Check raw data for error details"},j=i=>{const t=G(i.data,"output",i.nodeType,i.name);if(t.type==="error"&&t.details.length>1)return t.details.find(m=>m.includes("Nodo Fallito:"))||t.details.find(m=>m.includes("Tipo Errore:"))||t.details[1];if(i.data?.n8nErrorDetails){const m=i.data.n8nErrorDetails;return`Errore nel nodo: ${m.nodeName} (${m.errorType})`}return`Errore durante l'esecuzione del nodo: ${i.name}`},I=()=>{if(s.value?.kpis?.successRate!==void 0)return s.value.kpis.successRate;const i=s.value?.kpis?.successfulExecutions||0,t=s.value?.kpis?.failedExecutions||0,m=i+t;return m===0?100:Math.round(i/m*100)},P=()=>{const i=s.value?.kpis;return i?i.ordersProcessed>0?"Orders Processed":i.aiResponsesGenerated>0?"AI Responses":i.emailsProcessed>0?"Emails Handled":i.avgDataItemsPerRun>1?"Avg Items/Run":i.totalDataProcessed>0?"Data Processed":"Operations":"Data Points"},H=()=>{const i=s.value?.kpis;return i?i.ordersProcessed>0?i.ordersProcessed:i.aiResponsesGenerated>0?i.aiResponsesGenerated:i.emailsProcessed>0?i.emailsProcessed:i.avgDataItemsPerRun>1?i.avgDataItemsPerRun.toFixed(1):i.totalDataProcessed>0?i.totalDataProcessed:i.totalExecutions||0:0},X=i=>{const t=new Date(i),r=new Date().getTime()-t.getTime(),h=Math.floor(r/6e4),A=Math.floor(r/36e5),D=Math.floor(r/864e5);return h<1?"Just now":h<60?`${h} minute${h>1?"s":""} ago`:A<24?`${A} hour${A>1?"s":""} ago`:`${D} day${D>1?"s":""} ago`},z=i=>i<1e3?`${i}ms`:i<6e4?`${(i/1e3).toFixed(1)}s`:`${(i/6e4).toFixed(1)}min`,Y=i=>(typeof i=="number"?new Date(i):new Date(i)).toLocaleString("it-IT",{dateStyle:"short",timeStyle:"medium"}),ie=()=>{if(!C.value)return"";let i=`╔${"═".repeat(78)}╗
`;if(i+=`║${" ".repeat(15)}BUSINESS PROCESS EXECUTION REPORT${" ".repeat(16)}║
`,i+=`║${" ".repeat(25)}PilotPro Control Center${" ".repeat(29)}║
`,i+=`╚${"═".repeat(78)}╝

`,i+=`┌─ PROCESS INFORMATION ${"─".repeat(56)}┐

`,i+=`  Process Name:      ${C.value.workflowName||""}
`,i+=`  Process ID:        ${n.workflowId}
`,i+=`  Status:            ${C.value.status==="active"?"ACTIVE":"INACTIVE"}
`,C.value.lastExecution&&(i+=`
  LAST EXECUTION:
`,i+=`  ├─ Execution ID:   ${C.value.lastExecution.id}
`,i+=`  ├─ Date/Time:      ${Y(C.value.lastExecution.executedAt)}
`,i+=`  ├─ Total Duration: ${z(C.value.lastExecution.duration)}
`,i+=`  └─ Status:         ${C.value.lastExecution.status||"Completed"}
`),i+=`
└${"─".repeat(78)}┘

`,C.value.execution?.businessContext&&Object.keys(C.value.execution.businessContext).length>0){i+=`┌─ BUSINESS CONTEXT ANALYSIS ${"─".repeat(50)}┐

`;const t=C.value.execution.businessContext;t.customerEmail&&(i+=`  CUSTOMER INFORMATION:
`,i+=`     Email: ${t.customerEmail}

`),t.subject&&(i+=`  COMMUNICATION SUBJECT:
`,i+=`     "${t.subject}"

`),t.orderId&&(i+=`  ORDER REFERENCE:
`,i+=`     Order ID: ${t.orderId}

`),t.classification&&(i+=`  AI CLASSIFICATION:
`,i+=`     Category: ${t.classification}
`,t.confidence&&(i+=`     Confidence: ${t.confidence}%
`),i+=`
`),i+=`└${"─".repeat(78)}┘

`}return i},ne=()=>{const i=document.getElementById("raw-data-content");if(i&&C.value){const t=JSON.stringify(C.value,null,2).replace(/n8n/gi,"WFEngine").replace(/\.nodes\./g,".engine.").replace(/\.base\./g,".core.");i.textContent=t}},se=i=>{const t=i.name?.toLowerCase()||"";return t.includes("mail")||t.includes("ricezione")?"Customer Communication":t.includes("milena")||t.includes("assistente")?"AI Assistant Processing":t.includes("qdrant")||t.includes("vector")?"Knowledge Base Search":t.includes("ordini")||t.includes("order")?"Order Management":t.includes("supabase")||t.includes("database")?"Data Storage Operation":t.includes("execute")||t.includes("workflow")?"Business Process Execution":"Business Process Step"},fe=i=>{const t=i.name?.toLowerCase()||"";if(t.includes("ricezione")&&i.data?.outputJson){const m=i.data.outputJson;return m.oggetto&&m.mittente?`Customer email received from ${m.mittente} regarding "${m.oggetto}". Message successfully processed and categorized for business response.`:"Customer email received and processed successfully."}if((t.includes("milena")||t.includes("assistente"))&&i.data?.outputJson?.output){const m=i.data.outputJson.output;return m.categoria?`AI Assistant analyzed the customer request and generated an intelligent response. Category: ${m.categoria}. Response crafted based on business knowledge and customer context.`:"AI Assistant processed the request and generated an intelligent, personalized response for the customer."}return t.includes("qdrant")||t.includes("vector")?"Knowledge base searched to find relevant information and context for providing accurate customer support.":t.includes("ordini")||t.includes("order")?"Order information retrieved and processed to provide customer with accurate status and details.":t.includes("supabase")||t.includes("database")?"Customer interaction data saved to business database for future reference and analytics.":t.includes("execute")||t.includes("workflow")?"Business process sub-routine executed successfully to handle specific customer requirements.":"Business process step completed successfully, contributing to efficient customer service automation."},xe=i=>({document:"lucide:file-text",dataset:"lucide:table",statistical:"lucide:bar-chart-2",ai_generated:"lucide:sparkles",email_batch:"lucide:mail",api_response:"lucide:cloud",generic:"lucide:file"})[i]||"lucide:file",he=i=>({document:"Document Analysis",dataset:"Data Table",emails:"Email Batch",api:"API Response",statistics:"Statistical Analysis",ai:"AI Analysis",generic:"Process Data"})[i]||"Process Data",be=i=>i.replace(/_/g," ").replace(/([A-Z])/g," $1").trim(),ve=i=>typeof i=="number"?i>1e6?`${(i/1e6).toFixed(1)}M`:i>1e3?`${(i/1e3).toFixed(1)}K`:i%1!==0?i.toFixed(2):i.toString():typeof i=="boolean"?i?"Yes":"No":i==null?"-":i.toString(),ye=i=>({download_full:"Download Full Data",request_ai_analysis:"AI Analysis",extract_data:"Extract Data",view_full_table:"View Full Table",export_excel:"Export Excel",generate_report:"Generate Report",analyze_patterns:"Analyze Patterns",view_all_emails:"View All Emails",export_list:"Export List",analyze_sentiment:"Analyze Sentiment",view_json:"View JSON",export_data:"Export Data",analyze_structure:"Analyze Structure",view_chart:"View Chart",export_stats:"Export Statistics",analyze_trends:"Analyze Trends",view_raw:"View Raw",download:"Download",regenerate_analysis:"Regenerate Analysis"})[i]||i,_e=i=>{W.value.has(i)?W.value.delete(i):W.value.add(i)},we=async(i,t)=>{switch(console.log("🎯 Handling intelligent action:",i,t),i){case"download_full":ke(t);break;case"request_ai_analysis":await $e();break;case"export_excel":Se(t);break;case"generate_report":Ee(t);break;default:_("info",`Action "${i}" not yet implemented`)}},ke=i=>{const t=i.data?.rawOutputData||i.data?.outputJson||{},m=new Blob([JSON.stringify(t,null,2)],{type:"application/json"}),r=URL.createObjectURL(m),h=document.createElement("a");h.href=r,h.download=`${i.name}-data-${new Date().toISOString().slice(0,10)}.json`,document.body.appendChild(h),h.click(),document.body.removeChild(h),URL.revokeObjectURL(r),_("success","Data downloaded successfully")},$e=async i=>{_("info","Requesting AI analysis..."),setTimeout(()=>{_("success","AI analysis complete")},2e3)},Se=async i=>{try{const t=[];if(t.push(["Field","Value","Details"]),t.push(["Step Name",i.name,""]),t.push(["Type",i.data?.intelligentSummary?.businessSummary?.title||i.type,""]),t.push(["Status",i.status,""]),t.push(["Execution Time",z(i.executionTime||0),""]),t.push(["Started",i.startTime?new Date(i.startTime).toLocaleString("it-IT"):"",""]),t.push(["Finished",i.endTime?new Date(i.endTime).toLocaleString("it-IT"):"",""]),i.data?.intelligentSummary?.businessSummary?.description&&(t.push(["","",""]),t.push(["Business Summary",i.data.intelligentSummary.businessSummary.description,""])),i.data?.intelligentSummary?.metrics&&(t.push(["","",""]),t.push(["Metrics","",""]),Object.entries(i.data.intelligentSummary.metrics).forEach(([J,Q])=>{t.push(["",J,String(Q)])})),i.data?.intelligentSummary?.preview?.sampleRows){t.push(["","",""]),t.push(["Preview Data","",""]);const J=i.data.intelligentSummary.preview.sampleRows;if(Array.isArray(J)&&J.length>0){const Q=Object.keys(J[0]);t.push(Q),J.forEach(Z=>{t.push(Q.map(je=>String(Z[je]||"")))})}}const m=t.map(J=>J.map(Q=>{const Z=String(Q).replace(/"/g,'""');return Z.includes(",")||Z.includes(`
`)||Z.includes('"')?`"${Z}"`:Z}).join(",")).join(`
`),r="\uFEFF",h=new Blob([r+m],{type:"text/csv;charset=utf-8;"}),A=URL.createObjectURL(h),D=document.createElement("a");D.href=A,D.download=`${i.name}-data-${new Date().toISOString().slice(0,10)}.csv`,document.body.appendChild(D),D.click(),document.body.removeChild(D),URL.revokeObjectURL(A),_("success","CSV file downloaded successfully (Excel compatible)")}catch(t){console.error("Export error:",t),_("error","Failed to export data")}},Ee=i=>{const t=`
Business Process Step Report
============================
Step Name: ${i.name}
Type: ${i.data?.intelligentSummary?.businessSummary?.title||i.type}
Status: ${i.status}
Execution Time: ${z(i.executionTime||0)}

Business Summary:
${i.data?.intelligentSummary?.businessSummary?.description||""}

Business Insight:
${i.data?.intelligentSummary?.businessInsight||""}

Generated: ${new Date().toLocaleString()}
  `.trim(),m=new Blob([t],{type:"text/plain"}),r=URL.createObjectURL(m),h=document.createElement("a");h.href=r,h.download=`${i.name}-report-${new Date().toISOString().slice(0,10)}.txt`,document.body.appendChild(h),h.click(),document.body.removeChild(h),URL.revokeObjectURL(r),_("success","Report generated successfully")};return ce(()=>n.show,i=>{i&&(console.log("📊 Timeline modal opened for process:",n.workflowId),T())}),Ce(()=>{n.show&&T()}),(i,t)=>(c(),ue(et,{show:i.show,title:"Business Process Dashboard",subtitle:`${v.value} • ${R.value}`,"header-icon":"lucide:bar-chart-2",tabs:B,"default-tab":"overview","is-loading":g(o),error:g(b),data:C.value,onClose:t[1]||(t[1]=m=>i.$emit("close")),onRetry:T},{headerActions:ee(({isLoading:m})=>[...t[2]||(t[2]=[])]),overview:ee(({data:m})=>[e("div",rt,[e("div",at,[t[3]||(t[3]=e("h3",{class:"text-lg font-semibold text-white mb-3"},"Process Description",-1)),e("div",lt,l(S.value?.description||S.value?.purpose||"This business process automates operations to ensure efficient workflow execution and reliable business outcomes."),1)]),e("div",ct,[e("div",dt,[e("div",ut,[t[4]||(t[4]=e("span",{class:"text-sm text-text-muted"},"Success Rate",-1)),f(g(x),{icon:"lucide:trending-up",class:"w-4 h-4 text-green-400"})]),e("div",mt,l(I())+"% ",1)]),e("div",pt,[e("div",gt,[e("span",ft,l(P()),1),f(g(x),{icon:"lucide:database",class:"w-4 h-4 text-blue-400"})]),e("div",xt,l(H()),1)]),e("div",ht,[e("div",bt,[t[5]||(t[5]=e("span",{class:"text-sm text-text-muted"},"Total Operations",-1)),f(g(x),{icon:"lucide:layers",class:"w-4 h-4 text-purple-400"})]),e("div",vt,l(s.value?.total_executions||a.value.length||0),1)])]),e("div",yt,[t[9]||(t[9]=e("h3",{class:"text-lg font-semibold text-white mb-3"},"Process Capabilities",-1)),S.value?.capabilities?.length>0?(c(),d("ul",_t,[(c(!0),d(M,null,V(S.value.capabilities,(r,h)=>(c(),d("li",{key:h,class:"flex items-start gap-2"},[f(g(x),{icon:"lucide:check-circle",class:"w-5 h-5 text-green-400 mt-0.5"}),e("span",wt,l(r),1)]))),128))])):(c(),d("ul",kt,[e("li",$t,[f(g(x),{icon:"lucide:check-circle",class:"w-5 h-5 text-green-400 mt-0.5"}),t[6]||(t[6]=e("span",{class:"text-text-muted"},"Automated workflow processing",-1))]),e("li",St,[f(g(x),{icon:"lucide:check-circle",class:"w-5 h-5 text-green-400 mt-0.5"}),t[7]||(t[7]=e("span",{class:"text-text-muted"},"Data transformation and routing",-1))]),e("li",Et,[f(g(x),{icon:"lucide:check-circle",class:"w-5 h-5 text-green-400 mt-0.5"}),t[8]||(t[8]=e("span",{class:"text-text-muted"},"Business process optimization",-1))])]))]),e("div",jt,[e("div",Tt,[f(g(x),{icon:"lucide:target",class:"w-6 h-6 text-primary mt-0.5"}),e("div",null,[t[14]||(t[14]=e("h3",{class:"text-lg font-semibold text-white mb-2"},"Business Value",-1)),e("p",Rt,l(S.value?.businessValue?.summary||"This automated process optimizes business operations, reduces manual workload, and ensures consistent service delivery. All operations are tracked for continuous improvement."),1),S.value?.businessValue?(c(),d("div",It,[S.value.businessValue.automationRate?(c(),d("div",Ct,[e("div",At,l(S.value.businessValue.automationRate),1),t[10]||(t[10]=e("div",{class:"text-xs text-text-muted"},"Automation",-1))])):$("",!0),S.value.businessValue.timeSaved?(c(),d("div",Dt,[e("div",Nt,l(S.value.businessValue.timeSaved),1),t[11]||(t[11]=e("div",{class:"text-xs text-text-muted"},"Time Saved",-1))])):$("",!0),S.value.businessValue.avgResponseTime?(c(),d("div",Ot,[e("div",Pt,l(S.value.businessValue.avgResponseTime),1),t[12]||(t[12]=e("div",{class:"text-xs text-text-muted"},"Avg Response",-1))])):$("",!0),S.value.businessValue.dataProcessed?(c(),d("div",Lt,[e("div",zt,l(S.value.businessValue.dataProcessed),1),t[13]||(t[13]=e("div",{class:"text-xs text-text-muted"},"Items Processed",-1))])):$("",!0)])):$("",!0)])])])])]),executions:ee(({data:m})=>[e("div",Bt,[k.value?.length>0?(c(),d("div",Ft,[t[15]||(t[15]=e("h3",{class:"text-lg font-semibold text-white mb-4"},"Recent Business Activity",-1)),(c(!0),d(M,null,V(k.value.slice(0,10),(r,h)=>(c(),d("div",{key:h,class:"bg-surface-hover rounded-lg p-4 border border-border"},[e("div",Mt,[e("div",Vt,[e("div",Ut,[e("span",{class:F(["px-2 py-1 text-xs rounded",r.type==="AI Response"?"bg-purple-500/20 text-purple-300":r.type==="Email"?"bg-blue-500/20 text-blue-300":r.type==="Order"?"bg-green-500/20 text-green-300":"bg-gray-500/20 text-gray-300"])},l(r.type),3),e("span",Jt,l(X(r.timestamp)),1)]),e("p",qt,l(r.summary),1),r.classification?(c(),d("p",Ht," Classification: "+l(r.classification),1)):$("",!0)])])]))),128))])):m?.businessNodes?.length>0?(c(),d("div",Gt,[(c(!0),d(M,null,V(m.businessNodes,(r,h)=>(c(),d("div",{key:r._nodeId||h,class:F(["rounded-lg p-5 border transition-all",r.status==="error"||r.showTag==="error"?"bg-red-900/20 border-red-500/30":"bg-gray-800/50 border-gray-700",r.data?.intelligentSummary?"ring-1 ring-blue-500/20":""])},[e("div",Kt,[e("div",Wt,[e("div",{class:F(["w-8 h-8 rounded-full flex items-center justify-center mr-3",r.status==="error"||r.showTag==="error"?"bg-red-400/20":"bg-green-400/20"])},[e("span",{class:F(["font-medium",r.status==="error"||r.showTag==="error"?"text-red-400":"text-green-400"])},l(r.showTag==="error"?"ERR":h+1),3)],2),e("div",null,[e("h4",Zt,l(r.businessName||r.name||`Process Step ${h+1}`),1),e("p",Xt,l(se(r)),1)])]),e("div",Yt,l(z(r.executionTime||0)),1)]),e("div",Qt,[e("div",{class:F(["text-sm font-medium mb-2",r.status==="error"||r.showTag==="error"?"text-red-400":"text-green-400"])},l(r.status==="error"||r.showTag==="error"?"Error Details:":"Business Summary:"),3),e("div",{class:F(["text-white bg-gray-900/50 p-3 rounded border-l-4",r.status==="error"||r.showTag==="error"?"border-red-400":"border-green-400"])},l(r.status==="error"||r.showTag==="error"?te(r):fe(r)),3)]),e("div",es,[e("div",{class:F(["rounded p-3 border",r.status==="error"||r.showTag==="error"?"bg-orange-400/10 border-orange-400/20":"bg-blue-400/10 border-blue-400/20"])},[e("div",{class:F(["text-xs font-medium mb-1",r.status==="error"||r.showTag==="error"?"text-orange-400":"text-blue-400"])},l(r.status==="error"||r.showTag==="error"?"ERROR CONTEXT":"WHAT HAPPENED"),3),e("div",ts,l(r.status==="error"||r.showTag==="error"?j(r):r.enrichedData?.inputSummary||O(r)),1)],2),e("div",{class:F(["rounded p-3 border",r.status==="error"||r.showTag==="error"?"bg-red-400/10 border-red-400/20":"bg-green-400/10 border-green-400/20"])},[e("div",{class:F(["text-xs font-medium mb-1",r.status==="error"||r.showTag==="error"?"text-red-400":"text-green-400"])},l(r.status==="error"||r.showTag==="error"?"ERROR RESULT":"RESULT"),3),e("div",ss,l(r.status==="error"||r.showTag==="error"?E(r):r.enrichedData?.outputSummary||""),1)],2)]),r.enrichedData?.businessValue?(c(),d("div",is,[t[16]||(t[16]=e("div",{class:"text-xs text-purple-400 font-medium mb-1"},"BUSINESS VALUE",-1)),e("div",ns,l(r.enrichedData.businessValue),1)])):$("",!0),r.data?.intelligentSummary?(c(),d("div",os,[e("div",rs,[f(g(x),{icon:xe(r.data.intelligentSummary.type),class:"w-4 h-4 text-blue-400"},null,8,["icon"]),e("span",as,l(he(r.data.intelligentSummary.summaryType)),1),r.data.intelligentSummary.type==="ai_generated"?(c(),d("div",ls,[...t[17]||(t[17]=[e("span",{class:"px-2 py-0.5 text-xs bg-purple-500/20 text-purple-300 rounded"},"AI Generated",-1)])])):$("",!0)]),r.data.intelligentSummary.businessSummary?(c(),d("div",cs,[e("h5",ds,l(r.data.intelligentSummary.businessSummary.title),1),e("p",us,l(r.data.intelligentSummary.businessSummary.description),1),r.data.intelligentSummary.summaryType==="document"?(c(),d("div",ms,[e("span",null,l(r.data.intelligentSummary.businessSummary.pageCount)+" pages",1),t[18]||(t[18]=e("span",{class:"mx-2"},"•",-1)),e("span",null,"Type: "+l(r.data.intelligentSummary.businessSummary.documentType),1)])):r.data.intelligentSummary.summaryType==="dataset"?(c(),d("div",ps,[e("span",null,l(r.data.intelligentSummary.businessSummary.totalRows)+" rows",1),t[19]||(t[19]=e("span",{class:"mx-2"},"•",-1)),e("span",null,l(r.data.intelligentSummary.businessSummary.totalColumns)+" columns",1)])):$("",!0)])):$("",!0),r.data.intelligentSummary.metrics&&Object.keys(r.data.intelligentSummary.metrics).length>0?(c(),d("div",gs,[(c(!0),d(M,null,V(r.data.intelligentSummary.metrics,(A,D)=>(c(),d("div",{key:D,class:"bg-gray-800/50 rounded p-2 text-center"},[e("div",fs,l(be(D)),1),e("div",xs,l(ve(A)),1)]))),128))])):$("",!0),r.data.intelligentSummary.preview&&!W.value.has(r._nodeId)?(c(),d("div",hs,[e("div",bs,[t[20]||(t[20]=e("span",{class:"text-xs font-medium text-gray-400"},"DATA PREVIEW",-1)),e("button",{onClick:A=>_e(r._nodeId),class:"text-xs text-blue-400 hover:text-blue-300"}," View More → ",8,vs)]),r.data.intelligentSummary.summaryType==="document"?(c(),d("div",ys,[r.data.intelligentSummary.preview.keyDates?.length>0?(c(),d("div",_s,[t[21]||(t[21]=e("span",{class:"text-gray-500"},"Dates:",-1)),N(" "+l(r.data.intelligentSummary.preview.keyDates.join(", ")),1)])):$("",!0),r.data.intelligentSummary.preview.amounts?.length>0?(c(),d("div",ws,[t[22]||(t[22]=e("span",{class:"text-gray-500"},"Amounts:",-1)),N(" "+l(r.data.intelligentSummary.preview.amounts.join(", ")),1)])):$("",!0)])):r.data.intelligentSummary.summaryType==="dataset"&&r.data.intelligentSummary.preview.sampleRows?(c(),d("div",ks,[e("table",$s,[e("thead",null,[e("tr",Ss,[(c(!0),d(M,null,V(r.data.intelligentSummary.preview.headers?.slice(0,4),A=>(c(),d("th",{key:A,class:"px-2 py-1 text-left"},l(A),1))),128))])]),e("tbody",null,[(c(!0),d(M,null,V(r.data.intelligentSummary.preview.sampleRows?.slice(0,3),(A,D)=>(c(),d("tr",{key:D,class:"text-gray-300 border-t border-gray-800"},[(c(!0),d(M,null,V(r.data.intelligentSummary.preview.headers?.slice(0,4),J=>(c(),d("td",{key:J,class:"px-2 py-1"},l(A[J]),1))),128))]))),128))])])])):$("",!0)])):$("",!0),r.data.intelligentSummary.businessInsight?(c(),d("div",Es,[e("div",js,[f(g(x),{icon:"lucide:lightbulb",class:"w-4 h-4 text-green-400 mt-0.5"}),e("div",null,[t[23]||(t[23]=e("div",{class:"text-xs font-medium text-green-400 mb-1"},"BUSINESS INSIGHT",-1)),e("div",Ts,l(r.data.intelligentSummary.businessInsight),1)])])])):$("",!0),r.data.intelligentSummary.actions?.length>0?(c(),d("div",Rs,[(c(!0),d(M,null,V(r.data.intelligentSummary.actions,A=>(c(),d("button",{key:A,onClick:D=>we(A,r),class:"px-3 py-1 text-xs bg-gray-700 hover:bg-gray-600 text-white rounded-md transition-colors"},l(ye(A)),9,Is))),128))])):$("",!0)])):$("",!0)],2))),128))])):(c(),d("div",Cs,[f(g(x),{icon:"lucide:list",class:"w-12 h-12 mx-auto mb-4 opacity-50"}),t[24]||(t[24]=e("h3",{class:"text-lg font-medium mb-2"},"Process Not Yet Configured",-1)),t[25]||(t[25]=e("p",{class:"text-sm mb-2"},"This business process doesn't have steps configured for client reporting.",-1)),t[26]||(t[26]=e("div",{class:"bg-blue-400/10 border border-blue-400/20 rounded-lg p-4 mt-4 max-w-md mx-auto"},[e("h4",{class:"text-blue-400 font-medium mb-2"},"For Administrators:"),e("p",{class:"text-xs text-blue-300"}," Add 'show-1', 'show-2', etc. notes to workflow nodes to make them visible in business reporting. ")],-1))]))])]),history:ee(({data:m})=>[e("div",As,[t[35]||(t[35]=e("h3",{class:"text-lg font-semibold text-white mb-3"},"Process Execution History",-1)),e("div",Ds,[e("div",Ns,[e("div",Os,[f(g(x),{icon:"lucide:play-circle",class:"w-4 h-4 text-blue-400"}),t[27]||(t[27]=e("span",{class:"text-xs text-gray-400"},"Total",-1))]),e("div",Ps,l(s.value?.kpis?.totalExecutions||0),1),e("div",Ls,l(s.value?.kpis?.last24hExecutions||0)+" oggi",1)]),e("div",zs,[e("div",Bs,[f(g(x),{icon:"lucide:check-circle",class:"w-4 h-4 text-green-400"}),t[28]||(t[28]=e("span",{class:"text-xs text-gray-400"},"Success",-1))]),e("div",Fs,l(s.value?.kpis?.successfulExecutions||0),1),e("div",Ms,l(s.value?.kpis?.successRate||0)+"% rate",1)]),e("div",Vs,[e("div",Us,[f(g(x),{icon:"lucide:x-circle",class:"w-4 h-4 text-red-400"}),t[29]||(t[29]=e("span",{class:"text-xs text-gray-400"},"Failed",-1))]),e("div",Js,l(s.value?.kpis?.failedExecutions||0),1),s.value?.kpis?.canceledExecutions>0?(c(),d("div",qs," +"+l(s.value.kpis.canceledExecutions)+" canceled ",1)):$("",!0)]),e("div",Hs,[e("div",Gs,[f(g(x),{icon:"lucide:clock",class:"w-4 h-4 text-purple-400"}),t[30]||(t[30]=e("span",{class:"text-xs text-gray-400"},"Avg Time",-1))]),e("div",Ks,l(s.value?.kpis?.avgRunTime?z(s.value.kpis.avgRunTime):"0ms"),1),t[31]||(t[31]=e("div",{class:"text-xs text-gray-500"},"per run",-1))])]),s.value?.trend?.length>0?(c(),d("div",Ws,[t[32]||(t[32]=e("h4",{class:"text-sm font-medium text-white mb-2"},"Trend ultimi 7 giorni",-1)),e("div",Zs,[(c(!0),d(M,null,V(s.value.trend.slice(0,7),(r,h)=>(c(),d("div",{key:h,class:"flex-1 flex flex-col justify-end"},[e("div",{class:"bg-emerald-500/30 rounded-t hover:bg-emerald-500/40 transition-all",style:K({height:`${Math.max(10,r.executions/Math.max(...s.value.trend.map(A=>A.executions))*100)}%`}),title:`${r.date}: ${r.executions} esecuzioni`},null,12,Xs),e("span",Ys,l(new Date(r.date).getDate()),1)]))),128))])])):$("",!0),a.value.length>0?(c(),d("div",Qs,[e("div",ei,[e("table",ti,[t[33]||(t[33]=e("thead",{class:"bg-black/20 border-b border-border"},[e("tr",null,[e("th",{class:"px-4 py-3 text-left text-xs font-medium text-text-muted uppercase"},"Date"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-text-muted uppercase"},"Status"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-text-muted uppercase"},"Duration"),e("th",{class:"px-4 py-3 text-left text-xs font-medium text-text-muted uppercase"},"Business Outcome")])],-1)),e("tbody",si,[(c(!0),d(M,null,V(a.value.slice(0,25),r=>(c(),d("tr",{key:r.id,class:"hover:bg-surface-hover/50 text-xs"},[e("td",ii,l(Y(r.startedAt||r.createdAt)),1),e("td",ni,[e("span",{class:F(["px-2 py-1 text-xs rounded",r.status==="success"?"bg-green-400/20 text-green-400":r.status==="error"?"bg-red-400/20 text-red-400":"bg-yellow-400/20 text-yellow-400"])},l(r.status==="success"?"Success":r.status==="error"?"Failed":"Running"),3)]),e("td",oi,[r.duration?(c(),d("span",ri,l(z(r.duration)),1)):(c(),d("span",ai,"-"))]),e("td",li,[r.data?.businessOutcome?(c(),d("span",ci,l(r.data.businessOutcome),1)):(c(),d("span",di,"-"))])]))),128))])])])])):(c(),d("div",ui,[f(g(x),{icon:"lucide:history",class:"w-12 h-12 mx-auto mb-4 opacity-50"}),t[34]||(t[34]=e("p",null,"No execution history available yet",-1))]))])]),analytics:ee(({data:m})=>[e("div",mi,[e("div",pi,[e("div",gi,[e("div",fi,[e("h4",xi,[f(g(x),{icon:"lucide:gauge",class:"w-4 h-4 text-emerald-400"}),t[36]||(t[36]=N(" Performance Scores ",-1))]),e("div",hi,[e("div",bi,[e("div",vi,[f(g(x),{icon:"lucide:check-circle",class:"w-3 h-3 text-emerald-400"}),e("span",yi,l(s.value?.kpis?.successRate||0)+"%",1)]),t[37]||(t[37]=e("div",{class:"text-xs text-gray-400"},"Success Rate",-1)),s.value?.trends?.successRateTrend?(c(),d("div",{key:0,class:F(["text-xs mt-0.5",s.value.trends.successRateTrend>0?"text-emerald-400":"text-gray-500"])},l(s.value.trends.successRateTrend>0?"↑":"↓")+" "+l(Math.abs(s.value.trends.successRateTrend))+"% ",3)):$("",!0)]),e("div",_i,[e("div",wi,[f(g(x),{icon:"lucide:timer",class:"w-3 h-3 text-gray-400"}),e("span",ki,l(z(s.value?.kpis?.avgRunTime||0)),1)]),t[38]||(t[38]=e("div",{class:"text-xs text-gray-400"},"Avg Time",-1)),s.value?.kpis?.minRunTime?(c(),d("div",$i,l(z(s.value.kpis.minRunTime))+"-"+l(z(s.value.kpis.maxRunTime)),1)):$("",!0)]),e("div",Si,[e("div",Ei,[f(g(x),{icon:"lucide:zap",class:"w-3 h-3 text-gray-400"}),e("span",ji,l(s.value?.kpis?.efficiencyScore||0),1)]),t[39]||(t[39]=e("div",{class:"text-xs text-gray-400"},"Efficiency",-1)),t[40]||(t[40]=e("div",{class:"text-xs text-gray-500"},"/100 points",-1))]),e("div",Ti,[e("div",Ri,[f(g(x),{icon:"lucide:shield-check",class:"w-3 h-3 text-gray-400"}),e("span",Ii,l(s.value?.kpis?.reliabilityScore||0)+"%",1)]),t[41]||(t[41]=e("div",{class:"text-xs text-gray-400"},"Reliability",-1)),t[42]||(t[42]=e("div",{class:"text-xs text-gray-500"},"10 runs",-1))])]),e("div",Ci,[e("div",Ai,[t[43]||(t[43]=e("div",{class:"text-xs text-gray-500"},"Runs",-1)),e("div",Di,l(s.value?.kpis?.totalExecutions||0),1)]),e("div",Ni,[t[44]||(t[44]=e("div",{class:"text-xs text-gray-500"},"Data",-1)),e("div",Oi,l(s.value?.kpis?.totalDataProcessed||0),1)]),e("div",Pi,[t[45]||(t[45]=e("div",{class:"text-xs text-gray-500"},"Saved",-1)),e("div",Li,l(s.value?.kpis?.automationImpact||0)+"m",1)])])]),e("div",zi,[e("h4",Bi,[f(g(x),{icon:"lucide:pie-chart",class:"w-4 h-4 text-yellow-400"}),t[46]||(t[46]=N(" Execution Breakdown ",-1))]),e("div",Fi,[e("div",{class:"flex-1 bg-green-500/30 rounded-t border-t border-green-500/50 hover:bg-green-500/40 transition-all",style:K({height:`${Math.max(10,s.value?.kpis?.successfulExecutions/(s.value?.kpis?.totalExecutions||1)*100)}%`}),title:`Success: ${s.value?.kpis?.successfulExecutions||0}`},[s.value?.kpis?.successfulExecutions>0?(c(),d("div",Vi,l(s.value?.kpis?.successfulExecutions),1)):$("",!0)],12,Mi),e("div",{class:"flex-1 bg-red-500/30 rounded-t border-t border-red-500/50 hover:bg-red-500/40 transition-all",style:K({height:`${Math.max(10,s.value?.kpis?.failedExecutions/(s.value?.kpis?.totalExecutions||1)*100)}%`}),title:`Failed: ${s.value?.kpis?.failedExecutions||0}`},[s.value?.kpis?.failedExecutions>0?(c(),d("div",Ji,l(s.value?.kpis?.failedExecutions),1)):$("",!0)],12,Ui),s.value?.kpis?.canceledExecutions>0?(c(),d("div",{key:0,class:"flex-1 bg-orange-500/30 rounded-t border-t border-orange-500/50 hover:bg-orange-500/40 transition-all",style:K({height:`${Math.max(10,s.value?.kpis?.canceledExecutions/(s.value?.kpis?.totalExecutions||1)*100)}%`}),title:`Canceled: ${s.value?.kpis?.canceledExecutions||0}`},[e("div",Hi,l(s.value?.kpis?.canceledExecutions),1)],12,qi)):$("",!0)]),e("div",Gi,[e("span",Ki,[t[47]||(t[47]=e("span",{class:"w-2 h-2 bg-green-400 rounded-full"},null,-1)),N(" Success "+l(s.value?.kpis?.successRate||0)+"% ",1)]),e("span",Wi,[t[48]||(t[48]=e("span",{class:"w-2 h-2 bg-red-400 rounded-full"},null,-1)),N(" Failed "+l(s.value?.kpis?.failureRate||0)+"% ",1)]),s.value?.kpis?.canceledExecutions>0?(c(),d("span",Zi,[t[49]||(t[49]=e("span",{class:"w-2 h-2 bg-orange-400 rounded-full"},null,-1)),N(" Cancel "+l((s.value?.kpis?.canceledExecutions/(s.value?.kpis?.totalExecutions||1)*100).toFixed(1))+"% ",1)])):$("",!0)])]),e("div",Xi,[e("h4",Yi,[f(g(x),{icon:"lucide:trending-up",class:"w-4 h-4 text-emerald-400"}),t[50]||(t[50]=N(" Weekly Trend ",-1))]),s.value?.trend?.length>0?(c(),d("div",Qi,[e("div",en,[(c(!0),d(M,null,V(s.value.trend.slice(0,7).reverse(),(r,h)=>(c(),d("div",{key:h,class:"flex-1 flex flex-col justify-end"},[e("div",{class:"bg-gradient-to-t from-emerald-500/40 to-emerald-500/20 rounded-t hover:from-emerald-500/50 hover:to-emerald-500/30 transition-all border-t border-emerald-500/50",style:K({height:`${Math.max(5,r.executions/Math.max(...s.value.trend.map(A=>A.executions))*100)}%`}),title:`${r.date}: ${r.executions} runs`},[r.executions>0?(c(),d("span",sn,l(r.executions),1)):$("",!0)],12,tn)]))),128))]),e("div",nn,[(c(!0),d(M,null,V(s.value.trend.slice(0,7).reverse(),(r,h)=>(c(),d("span",{key:h,class:"flex-1 text-center text-xs text-gray-500"},l(new Date(r.date).getDate()),1))),128))])])):(c(),d("div",on," No trend data "))])]),e("div",rn,[e("div",an,[e("h4",ln,[f(g(x),{icon:"lucide:activity",class:"w-4 h-4 text-blue-400"}),t[51]||(t[51]=N(" Activity Metrics ",-1))]),e("div",cn,[e("div",dn,[e("div",un,[f(g(x),{icon:"lucide:clock-3",class:"w-3 h-3 text-gray-400"}),e("span",mn,l(s.value?.kpis?.last24hExecutions||0),1)]),t[52]||(t[52]=e("div",{class:"text-xs text-gray-400"},"Last 24h",-1))]),e("div",pn,[e("div",gn,[f(g(x),{icon:"lucide:calendar-days",class:"w-3 h-3 text-gray-400"}),e("span",fn,l(s.value?.kpis?.last7dExecutions||0),1)]),t[53]||(t[53]=e("div",{class:"text-xs text-gray-400"},"Last 7d",-1))]),e("div",xn,[e("div",hn,[f(g(x),{icon:"lucide:bar-chart-2",class:"w-3 h-3 text-gray-400"}),e("span",bn,l(s.value?.kpis?.avgExecutionsPerDay||0),1)]),t[54]||(t[54]=e("div",{class:"text-xs text-gray-400"},"Daily Avg",-1))]),e("div",vn,[e("div",yn,[f(g(x),{icon:"lucide:zap",class:"w-3 h-3 text-gray-400"}),e("span",_n,[s.value?.kpis?.peakHour!==null?(c(),d("span",wn,l(s.value.kpis.peakHour)+":00",1)):(c(),d("span",kn,"-"))])]),t[55]||(t[55]=e("div",{class:"text-xs text-gray-400"},"Peak Hour",-1))])]),s.value?.trends?.volumeTrend!==void 0?(c(),d("div",$n,[e("div",Sn,[t[56]||(t[56]=e("span",{class:"text-xs text-gray-400"},"Volume Trend",-1)),e("span",{class:F(["text-xs font-bold flex items-center gap-1",s.value.trends.volumeTrend>0?"text-green-400":"text-orange-400"])},[f(g(x),{icon:s.value.trends.volumeTrend>0?"lucide:trending-up":"lucide:trending-down",class:"w-3 h-3"},null,8,["icon"]),N(" "+l(Math.abs(s.value.trends.volumeTrend))+"% vs prev ",1)],2)])])):$("",!0)]),e("div",En,[e("h4",jn,[f(g(x),{icon:"lucide:gauge",class:"w-4 h-4 text-gray-400"}),t[57]||(t[57]=N(" Timing Analysis ",-1))]),e("div",Tn,[e("div",Rn,[e("span",In,[f(g(x),{icon:"lucide:timer",class:"w-3 h-3"}),t[58]||(t[58]=N(" Average ",-1))]),e("span",Cn,l(z(s.value?.kpis?.avgRunTime||0)),1)]),e("div",An,[e("span",Dn,[f(g(x),{icon:"lucide:fast-forward",class:"w-3 h-3"}),t[59]||(t[59]=N(" Fastest ",-1))]),e("span",Nn,l(z(s.value?.kpis?.minRunTime||0)),1)]),e("div",On,[e("span",Pn,[f(g(x),{icon:"lucide:pause",class:"w-3 h-3"}),t[60]||(t[60]=N(" Slowest ",-1))]),e("span",Ln,l(z(s.value?.kpis?.maxRunTime||0)),1)]),e("div",zn,[e("span",Bn,[f(g(x),{icon:"lucide:hourglass",class:"w-3 h-3"}),t[61]||(t[61]=N(" Total Time ",-1))]),e("span",Fn,l(Math.round((s.value?.kpis?.totalExecutions||0)*(s.value?.kpis?.avgRunTime||0)/6e4))+"m ",1)])])]),e("div",Mn,[e("h4",Vn,[f(g(x),{icon:"lucide:brain",class:"w-4 h-4 text-emerald-400"}),t[62]||(t[62]=N(" AI Insights ",-1))]),e("ul",Un,[s.value?.kpis?.totalExecutions?(c(),d("li",Jn,[f(g(x),{icon:"lucide:activity",class:"w-3 h-3 text-gray-400 mt-0.5"}),e("div",qn,[t[63]||(t[63]=e("div",{class:"text-xs text-white"},"Activity Level",-1)),e("div",Hn,l(s.value.kpis.totalExecutions)+" executions tracked",1),e("div",Gn,[e("div",{class:"h-full bg-emerald-400/50",style:K({width:`${Math.min(100,s.value.kpis.totalExecutions/10)}%`})},null,4)])])])):$("",!0),s.value?.kpis?.successRate?(c(),d("li",Kn,[f(g(x),{icon:"lucide:shield-check",class:"w-3 h-3 text-gray-400 mt-0.5"}),e("div",Wn,[t[64]||(t[64]=e("div",{class:"text-xs text-white"},"Reliability",-1)),e("div",Zn,l(s.value.kpis.successRate)+"% success maintained",1),e("div",Xn,[e("div",{class:"h-full bg-emerald-400/50",style:K({width:`${s.value.kpis.successRate}%`})},null,4)])])])):$("",!0),s.value?.kpis?.avgRunTime?(c(),d("li",Yn,[f(g(x),{icon:"lucide:clock",class:"w-3 h-3 text-gray-400 mt-0.5"}),e("div",Qn,[t[65]||(t[65]=e("div",{class:"text-xs text-white"},"Speed",-1)),e("div",eo,l(z(s.value.kpis.avgRunTime))+" avg",1),e("div",to,[e("div",{class:"h-full bg-emerald-400/50",style:K({width:`${Math.max(10,Math.min(100,100-s.value.kpis.avgRunTime/1e4*100))}%`})},null,4)])])])):$("",!0),a.value.length>0?(c(),d("li",so,[f(g(x),{icon:"lucide:trending-up",class:"w-3 h-3 text-gray-400 mt-0.5"}),e("div",io,[t[66]||(t[66]=e("div",{class:"text-xs text-white"},"Recent Trend",-1)),e("div",no,l(Math.round(a.value.slice(0,10).filter(r=>r.status==="success").length/Math.min(a.value.length,10)*100))+"% last 10 ",1),e("div",oo,[e("div",{class:"h-full bg-emerald-400/50",style:K({width:`${Math.round(a.value.slice(0,10).filter(r=>r.status==="success").length/Math.min(a.value.length,10)*100)}%`})},null,4)])])])):$("",!0)])]),e("div",ro,[e("h4",ao,[f(g(x),{icon:"lucide:sparkles",class:"w-4 h-4 text-blue-400"}),t[67]||(t[67]=N(" Optimization Tips ",-1))]),e("div",lo,[s.value?.kpis?.successRate&&s.value.kpis.successRate<95?(c(),d("div",co,[f(g(x),{icon:"lucide:alert-triangle",class:"w-3 h-3 text-gray-400 mt-0.5"}),e("div",uo,[t[68]||(t[68]=e("span",{class:"text-white font-medium"},"Improve Success Rate",-1)),e("p",mo,"Current: "+l(s.value.kpis.successRate)+"% - Review failed executions",1)])])):$("",!0),s.value?.kpis?.avgRunTime&&s.value.kpis.avgRunTime>1e4?(c(),d("div",po,[f(g(x),{icon:"lucide:clock-alert",class:"w-3 h-3 text-gray-400 mt-0.5"}),t[69]||(t[69]=e("div",{class:"flex-1"},[e("span",{class:"text-white font-medium"},"Optimize Performance"),e("p",{class:"text-gray-400 text-xs mt-0.5"},"Runtime >10s - Enable parallel processing")],-1))])):$("",!0),a.value.filter(r=>r.status==="error").length>0?(c(),d("div",go,[f(g(x),{icon:"lucide:bug",class:"w-3 h-3 text-gray-400 mt-0.5"}),e("div",fo,[t[70]||(t[70]=e("span",{class:"text-white font-medium"},"Error Pattern Detected",-1)),e("p",xo,l(a.value.filter(r=>r.status==="error").length)+" failures need attention",1)])])):$("",!0),!s.value?.kpis?.totalExecutions||s.value.kpis.totalExecutions===0?(c(),d("div",ho,[f(g(x),{icon:"lucide:info",class:"w-3 h-3 text-gray-400 mt-0.5"}),t[71]||(t[71]=e("div",{class:"flex-1"},[e("span",{class:"text-white font-medium"},"No Data Available"),e("p",{class:"text-gray-400 text-xs mt-0.5"},"Run process to start collecting metrics")],-1))])):s.value?.kpis?.successRate>=95?(c(),d("div",bo,[f(g(x),{icon:"lucide:award",class:"w-3 h-3 text-emerald-400 mt-0.5"}),t[72]||(t[72]=e("div",{class:"flex-1"},[e("span",{class:"text-emerald-400 font-medium"},"Excellent Performance!"),e("p",{class:"text-gray-400 text-xs mt-0.5"},"Consider scaling or adding features")],-1))])):$("",!0)])])])]),e("div",vo,[e("div",yo,[e("div",_o,[e("span",wo,[f(g(x),{icon:"lucide:database",class:"w-3 h-3 text-gray-400"}),t[73]||(t[73]=e("span",{class:"text-gray-400"},"Data Points:",-1)),e("span",ko,l(s.value?.kpis?.totalExecutions||0),1)]),s.value?.period?(c(),d("span",$o,[f(g(x),{icon:"lucide:calendar",class:"w-3 h-3 text-gray-400"}),t[74]||(t[74]=e("span",{class:"text-gray-400"},"Period:",-1)),e("span",So,l(s.value.period),1)])):$("",!0),e("span",Eo,[f(g(x),{icon:"lucide:refresh-cw",class:"w-3 h-3 text-gray-400"}),t[75]||(t[75]=e("span",{class:"text-gray-400"},"Updated:",-1)),e("span",jo,l(new Date(s.value?._metadata?.timestamp||Date.now()).toLocaleTimeString()),1)])]),e("button",{onClick:t[0]||(t[0]=r=>i.$emit("refresh")),class:"p-1.5 text-gray-400 hover:text-emerald-400 transition-colors rounded hover:bg-white/5"},[f(g(x),{icon:"lucide:refresh-cw",class:"w-3 h-3"})])])])])]),raw:ee(({data:m})=>[e("div",To,[e("div",Ro,[e("div",Io,[f(g(x),{icon:"lucide:code",class:"w-5 h-5 text-gray-400 mr-2"}),t[76]||(t[76]=e("h3",{class:"text-lg font-medium text-white"},"Raw Timeline Data",-1))]),e("div",Co,[e("button",{onClick:ie,class:"flex items-center px-3 py-1.5 bg-gray-700 hover:bg-gray-600 text-white rounded-lg text-sm transition-colors"},[f(g(x),{icon:"lucide:file-text",class:"w-4 h-4 mr-1.5"}),t[77]||(t[77]=N(" Generate Report ",-1))]),e("button",{onClick:ne,class:"flex items-center px-3 py-1.5 bg-gray-700 hover:bg-gray-600 text-white rounded-lg text-sm transition-colors"},[f(g(x),{icon:"lucide:code",class:"w-4 h-4 mr-1.5"}),t[78]||(t[78]=N(" Show JSON ",-1))])])]),e("pre",Ao,l(m?JSON.stringify(m,null,2).replace(/n8n/gi,"WFEngine").replace(/\.nodes\./g,".engine.").replace(/\.base\./g,".core."):"No data available"),1)])]),_:1},8,["show","subtitle","is-loading","error","data"]))}}),Po=me(Do,[["__scopeId","data-v-d01e1322"]]);export{et as D,Po as T};
//# sourceMappingURL=TimelineModal-Cv_ZCNei.js.map
