import{a as G,r as u,o as H,S as O,k as C,f as i,y as U,g as t,m as c,l as o,I as l,e as r,h as p,t as v,a3 as k,F,z as A,n as B,Q as K,i as x,aC as W,v as j,R as J}from"./index-COrhf4WZ.js";import{a as I}from"./api-client-kiOOfUtV.js";import{M as X}from"./MainLayout-DZbn--hx.js";import"./index-C1hqPmLl.js";import"./settings-DvFL2W95.js";const Y={class:"milhena-chat-container"},Z={class:"chat-header"},ee={class:"header-content"},te={class:"header-left"},se={class:"header-stats"},ae={class:"stat"},ne={class:"stat-value"},ie={class:"stat"},oe={class:"stat-value"},le={key:0,class:"stat"},re={key:0,class:"welcome-message"},ce={class:"quick-actions"},de={class:"message-avatar"},ue={class:"message-content"},ve={class:"message-header"},pe={class:"message-sender"},me={class:"message-time"},fe={key:0,class:"message-latency"},_e=["innerHTML"],he={key:0,class:"message-confidence"},ge={class:"confidence-bar"},ke={class:"confidence-text"},be={key:1,class:"feedback-buttons"},ye=["onClick"],Ce=["onClick"],we={key:2,class:"feedback-confirmed"},Me={key:0,class:"positive"},Se={key:1,class:"negative"},Te={key:3,class:"reformulation-helper"},qe={class:"suggestions"},Ie=["onClick"],ze={key:1,class:"message assistant typing"},De={class:"message-avatar"},Le={class:"chat-input-container"},Re={class:"input-wrapper"},$e=["disabled"],Ee=["disabled"],Fe={class:"input-hint"},Ae={key:0,class:"reformulation-alert"},Be={key:1},Pe={class:"learning-stats"},Ne={class:"stat-item"},Qe={class:"stat-value"},Ve={class:"stat-item"},Ge={class:"stat-value"},He={class:"stat-item"},Oe={class:"stat-value"},Ue={key:0,class:"stat-item"},Ke={class:"stat-value"},Ze={__name:"MilhenaChat",setup(xe){const z=G(),d=u([]),m=u(""),g=u(!1),M=u(!1),S=u(!1),h=u(!1),D=u(0),T=u(92),w=u(null),L=u(P()),f=u({queries:0,patterns:0,improvement:0,cache_hit_rate:0});function P(){return"session_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)}const N=a=>new Date(a).toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit",second:"2-digit"}),Q=a=>(a=a.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>"),a=a.replace(/\*(.*?)\*/g,"<em>$1</em>"),a=a.replace(/\n/g,"<br>"),a=a.replace(/â€¢ /g,"ðŸ”¸ "),a),R=()=>{J(()=>{w.value&&(w.value.scrollTop=w.value.scrollHeight)})},b=a=>{m.value=a,q()},$=async(a,e)=>{const s=d.value[a];if(!(!s||s.feedback)){s.feedback=e,e==="negative"&&(h.value=!0,setTimeout(()=>{h.value=!1},3e4)),S.value=!0,setTimeout(()=>{S.value=!1},3e3);try{await I.post("/api/milhena/feedback",{session_id:L.value,message_id:s.id||a,query:d.value[a-1]?.content||"",response:s.content,feedback_type:e,confidence:s.confidence,timestamp:s.timestamp}),z.success(e==="positive"?"Grazie per il feedback positivo!":"Grazie, userÃ² questo feedback per migliorare")}catch(_){console.error("Feedback error:",_)}}},V=a=>{const e=[];return a.intent==="ERRORS"||a.content.includes("error")?(e.push("Mostra solo gli errori critici di oggi"),e.push("Quali processi hanno avuto problemi nelle ultime 24 ore?")):a.intent==="METRICS"||a.content.includes("metric")?(e.push("Quante fatture sono state elaborate oggi?"),e.push("Dammi le statistiche complete del sistema")):(e.push("Mostra lo stato generale del sistema"),e.push("Ci sono problemi urgenti da risolvere?")),e},q=async()=>{if(!m.value.trim()||g.value)return;const a={role:"user",content:m.value,timestamp:new Date,isReformulation:h.value};d.value.push(a);const e=m.value;m.value="";let s={conversation_history:d.value.slice(-10),is_reformulation:h.value};if(h.value){const n=d.value.findLastIndex(y=>y.feedback==="negative");n>=0&&(s.original_query=d.value[n-1]?.content||"",s.failed_response=d.value[n]?.content||""),h.value=!1}g.value=!0,M.value=!0,R();const _=Date.now();try{const n=await I.post("/api/n8n/agent/customer-support",{message:e,session_id:L.value,context:s}),y=Date.now()-_;D.value=y,n.data.system_accuracy&&(T.value=Math.round(n.data.system_accuracy*100)),d.value.push({role:"assistant",content:n.data.response||n.data.message,timestamp:new Date,confidence:n.data.confidence,intent:n.data.intent,latency:y,cached:n.data.cached||!1,learned:n.data.learned||!1}),n.data.learned&&f.value.patterns++}catch(n){console.error("Chat error:",n),d.value.push({role:"assistant",content:n.response?.data?.message||"Mi dispiace, c'Ã¨ stato un problema. Riprova tra poco.",timestamp:new Date,latency:Date.now()-_}),z.error("Errore nella comunicazione con Milhena")}finally{g.value=!1,M.value=!1,R(),f.value.queries++}},E=async()=>{try{const a=await I.get("/api/milhena/learning/stats/today");f.value=a.data,a.data.accuracy&&(T.value=Math.round(a.data.accuracy*100))}catch(a){console.error("Failed to load learning stats:",a)}};return H(()=>{E();const a=setInterval(E,6e4);setTimeout(()=>{d.value.push({role:"assistant",content:"Ciao! Sono Milhena v3.0 Learning Edition. Imparo dai tuoi feedback per migliorare continuamente. Come posso aiutarti oggi?",timestamp:new Date,confidence:1})},500),O(()=>{clearInterval(a)})}),(a,e)=>(i(),C(X,null,{default:U(()=>[t("div",Y,[t("div",Z,[t("div",ee,[t("div",te,[c(o(l),{icon:"mdi:robot-happy",class:"header-icon"}),e[5]||(e[5]=t("div",null,[t("h1",null,"Milhena Assistant"),t("p",{class:"subtitle"},"v3.0 Learning Edition - Self-Improving AI")],-1))]),t("div",se,[t("div",ae,[t("span",ne,v(D.value)+"ms",1),e[6]||(e[6]=t("span",{class:"stat-label"},"Latency",-1))]),t("div",ie,[t("span",oe,v(T.value)+"%",1),e[7]||(e[7]=t("span",{class:"stat-label"},"Accuracy",-1))]),S.value?(i(),r("div",le,[c(o(l),{icon:"mdi:brain",class:"learning-icon animate-pulse"}),e[8]||(e[8]=t("span",{class:"stat-label"},"Learning...",-1))])):p("",!0)])])]),t("div",{class:"chat-messages",ref_key:"messagesContainer",ref:w},[d.value.length===0?(i(),r("div",re,[c(o(l),{icon:"mdi:hand-wave",class:"wave-icon"}),e[13]||(e[13]=t("h2",null,"Ciao! Sono Milhena",-1)),e[14]||(e[14]=t("p",null,"Il tuo assistente AI per PilotProOS. Posso aiutarti con:",-1)),t("div",ce,[t("button",{onClick:e[0]||(e[0]=s=>b("Mostrami i workflow attivi")),class:"quick-btn"},[c(o(l),{icon:"mdi:workflow"}),e[9]||(e[9]=k(" Workflow Attivi ",-1))]),t("button",{onClick:e[1]||(e[1]=s=>b("Analizza le performance di oggi")),class:"quick-btn"},[c(o(l),{icon:"mdi:chart-line"}),e[10]||(e[10]=k(" Performance Oggi ",-1))]),t("button",{onClick:e[2]||(e[2]=s=>b("Quali sono gli ultimi errori?")),class:"quick-btn"},[c(o(l),{icon:"mdi:alert-circle"}),e[11]||(e[11]=k(" Ultimi Errori ",-1))]),t("button",{onClick:e[3]||(e[3]=s=>b("Come funzioni?")),class:"quick-btn"},[c(o(l),{icon:"mdi:help-circle"}),e[12]||(e[12]=k(" Come Funzioni ",-1))])])])):p("",!0),(i(!0),r(F,null,A(d.value,(s,_)=>(i(),r("div",{key:_,class:B(["message",s.role])},[t("div",de,[s.role==="user"?(i(),C(o(l),{key:0,icon:"mdi:account"})):(i(),C(o(l),{key:1,icon:"mdi:robot"}))]),t("div",ue,[t("div",ve,[t("span",pe,v(s.role==="user"?"Tu":"Milhena"),1),t("span",me,v(N(s.timestamp)),1),s.latency?(i(),r("span",fe,v(s.latency)+"ms",1)):p("",!0)]),t("div",{class:"message-text",innerHTML:Q(s.content)},null,8,_e),s.confidence?(i(),r("div",he,[t("div",ge,[t("div",{class:B(["confidence-fill",{high:s.confidence>.8,medium:s.confidence>.6&&s.confidence<=.8,low:s.confidence<=.6}]),style:K({width:s.confidence*100+"%"})},null,6)]),t("span",ke,"Confidence: "+v((s.confidence*100).toFixed(0))+"%",1)])):p("",!0),s.role==="assistant"&&!s.feedback?(i(),r("div",be,[t("button",{onClick:n=>$(_,"positive"),class:"feedback-btn positive",title:"Risposta utile"},[c(o(l),{icon:"mdi:thumb-up-outline"})],8,ye),t("button",{onClick:n=>$(_,"negative"),class:"feedback-btn negative",title:"Risposta non utile"},[c(o(l),{icon:"mdi:thumb-down-outline"})],8,Ce)])):p("",!0),s.feedback?(i(),r("div",we,[s.feedback==="positive"?(i(),r("span",Me,[c(o(l),{icon:"mdi:check-circle"}),e[15]||(e[15]=k(" Grazie per il feedback! ",-1))])):(i(),r("span",Se,[c(o(l),{icon:"mdi:alert-circle"}),e[16]||(e[16]=k(" Grazie, sto imparando... ",-1))]))])):p("",!0),s.feedback==="negative"&&!s.reformulated?(i(),r("div",Te,[e[17]||(e[17]=t("p",null,"Puoi riformulare la domanda per aiutarmi a capire meglio?",-1)),t("div",qe,[(i(!0),r(F,null,A(V(s),n=>(i(),r("button",{key:n,onClick:y=>b(n),class:"suggestion-btn"},v(n),9,Ie))),128))])])):p("",!0)])],2))),128)),M.value?(i(),r("div",ze,[t("div",De,[c(o(l),{icon:"mdi:robot"})]),e[18]||(e[18]=t("div",{class:"message-content"},[t("div",{class:"typing-indicator"},[t("span"),t("span"),t("span")])],-1))])):p("",!0)],512),t("div",Le,[t("div",Re,[x(t("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>m.value=s),onKeyup:W(q,["enter"]),disabled:g.value,placeholder:"Chiedi qualsiasi cosa su processi, workflow, performance...",class:"chat-input"},null,40,$e),[[j,m.value]]),t("button",{onClick:q,disabled:!m.value.trim()||g.value,class:"send-button"},[g.value?(i(),C(o(l),{key:0,icon:"mdi:loading",class:"animate-spin"})):(i(),C(o(l),{key:1,icon:"mdi:send"}))],8,Ee)]),t("div",Fe,[c(o(l),{icon:"mdi:information"}),h.value?(i(),r("span",Ae," ðŸ”„ Sto imparando dalla tua correzione... ")):(i(),r("span",Be,"Milhena impara dai tuoi feedback per migliorare continuamente."))])]),t("div",Pe,[t("div",Ne,[e[19]||(e[19]=t("span",{class:"stat-label"},"Oggi:",-1)),t("span",Qe,v(f.value.queries)+" queries",1)]),t("div",Ve,[e[20]||(e[20]=t("span",{class:"stat-label"},"Patterns appresi:",-1)),t("span",Ge,v(f.value.patterns),1)]),t("div",He,[e[21]||(e[21]=t("span",{class:"stat-label"},"Miglioramento:",-1)),t("span",Oe,"+"+v(f.value.improvement)+"%",1)]),f.value.cache_hit_rate?(i(),r("div",Ue,[e[22]||(e[22]=t("span",{class:"stat-label"},"Cache Hit:",-1)),t("span",Ke,v(f.value.cache_hit_rate)+"%",1)])):p("",!0)])])]),_:1}))}};export{Ze as default};
//# sourceMappingURL=MilhenaChat-D9hwDBSV.js.map
