import{ab as X,r as i,K as m,d as H,u as J,a6 as Q,E as F,o as Z,x as N,c as ee,k as te,f as v,y as se,g as s,m as f,e as p,h as O,l as _,I as w,t as r,i as L,v as oe,ac as P,F as $,z as V,a3 as ae,n as M,_ as re}from"./index-COrhf4WZ.js";import{M as le}from"./MainLayout-DZbn--hx.js";import{T as ne}from"./TimelineModal-DK-_O-M8.js";import{b as ie}from"./api-client-kiOOfUtV.js";import"./settings-DvFL2W95.js";import"./index-C1hqPmLl.js";const ce=X("workflows",()=>{const g=i([]),T=i(null),S=i(!1),x=i(null),R=i(0),C=m(()=>({total:g.value.length,active:g.value.filter(a=>a.active&&!a.is_archived).length,inactive:g.value.filter(a=>!a.active&&!a.is_archived).length,archived:g.value.filter(a=>a.is_archived).length})),h=m(()=>g.value.filter(a=>a.active&&!a.is_archived)),k=m(()=>g.value.sort((a,c)=>new Date(c.updated_at).getTime()-new Date(a.updated_at).getTime()).slice(0,10));return{workflows:g,selectedWorkflow:T,isLoading:S,error:x,lastFetch:R,stats:C,activeWorkflows:h,recentWorkflows:k,fetchWorkflows:async()=>{S.value=!0,x.value=null;try{const c=(await apiClient.get("/api/business/processes")).data;g.value=(c.data||[]).map(l=>({id:l.process_id,name:l.process_name,active:l.is_active,is_archived:!1,created_at:l.created_date||new Date().toISOString(),updated_at:l.last_modified||new Date().toISOString(),node_count:5,execution_count:parseInt(l.executions_today)||0,has_webhook:!1,last_execution:l.last_modified,tags:[],settings:{}})),R.value=Date.now(),console.log("✅ Workflows loaded:",g.value.length)}catch(a){x.value=a.message||"Failed to load workflows",console.error("❌ Failed to load workflows:",a),g.value=[{id:"1",name:"TRY Backend",active:!0,is_archived:!1,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),node_count:5,execution_count:0,has_webhook:!1,last_execution:null,tags:[],settings:{}}]}finally{S.value=!1}},selectWorkflow:a=>{T.value=a,console.log("✅ Workflow selected:",a.name)},toggleWorkflow:async a=>{try{a.active=!a.active,console.log(`✅ Workflow ${a.active?"activated":"deactivated"}:`,a.name)}catch(c){console.error("❌ Failed to toggle workflow:",c)}},createWorkflow:async a=>{try{const c={id:"new-"+Date.now(),name:a.name||"New Workflow",active:!1,is_archived:!1,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),node_count:0,execution_count:0,has_webhook:!1,last_execution:null,tags:a.tags||[],settings:a.settings||{}};return g.value.push(c),console.log("✅ Workflow created:",c.name),c}catch(c){throw console.error("❌ Failed to create workflow:",c),c}}}}),de={class:"executions-container"},ue={class:"professional-kpi-bar"},ve={class:"kpi-card"},ge={class:"kpi-card-content"},pe={class:"kpi-card-value"},fe={class:"kpi-card highlight-success"},_e={class:"kpi-card-content"},he={class:"kpi-card-value"},we={class:"kpi-card highlight-error"},me={class:"kpi-card-content"},ke={class:"kpi-card-value"},ye={class:"kpi-card"},be={class:"kpi-card-content"},xe={class:"kpi-card-value"},Se={class:"kpi-card"},Re={class:"kpi-card-content"},Ee={class:"kpi-card-value"},Te={class:"kpi-card"},Ce={class:"kpi-card-content"},Ie={class:"kpi-card-value"},De={class:"control-card p-4"},Ne={class:"grid grid-cols-1 lg:grid-cols-3 gap-4"},We={class:"relative"},Ae={value:"all"},Le={value:"success"},Me={value:"error"},Ue={value:"canceled"},Fe={value:"running"},Oe={value:"waiting"},Pe=["value"],$e={class:"bg-gray-900 border border-gray-700 rounded-lg overflow-hidden"},Ve={class:"overflow-x-auto"},ze={class:"w-full border-collapse"},Be={key:0},Ge={colspan:"6",class:"px-2 py-8 text-center text-gray-500 bg-gray-900"},Ke={class:"border-r border-gray-700 px-2 py-1"},Ye={class:"text-xs text-gray-100 max-w-xs"},je=["onClick","title"],qe={class:"border-r border-gray-700 px-2 py-1"},Xe={key:0,class:"text-xs text-green-300 font-bold"},He={key:1,class:"text-xs text-red-300 font-bold"},Je={key:2,class:"text-xs text-yellow-300 font-bold"},Qe={key:3,class:"text-xs text-blue-300 font-bold"},Ze={key:4,class:"text-xs text-orange-300 font-bold"},et={key:5,class:"text-xs text-white font-bold"},tt={class:"border-r border-gray-700 px-2 py-1 text-xs text-gray-300"},st={class:"border-r border-gray-700 px-2 py-1 text-xs text-gray-300"},ot={class:"border-gray-700 px-2 py-1 text-xs text-gray-400"},at={key:0,class:"flex items-center justify-between"},rt={class:"text-sm text-gray-400"},lt={class:"flex items-center gap-2"},nt=["disabled"],it={class:"text-white text-sm px-2"},ct=["disabled"],dt=H({__name:"ExecutionsPage",setup(g){const T=J(),S=ce(),x=Q(),R=i(!1),C=i(!0),h=i(""),k=i("all"),y=i("all"),n=i([]);i(!1),i(!1);const d=i(1),I=i(20),a=i(!1),c=i("");F([h,k,y],()=>{d.value=1});const l=m(()=>{const t={total:n.value.length,success:n.value.filter(e=>e.status==="success").length,error:n.value.filter(e=>e.status==="error").length,canceled:n.value.filter(e=>e.status==="canceled").length,running:n.value.filter(e=>e.status==="running").length,waiting:n.value.filter(e=>e.status==="waiting").length};return console.log("📈 Execution Stats:",t),t}),z=m(()=>{const t=new Map;return n.value.forEach(e=>{const o=e.workflow_id||e.processId,u=e.workflow_name||e.processName;o&&u&&t.set(o,u)}),Array.from(t.entries()).map(([e,o])=>({id:e,name:o}))}),W=m(()=>{console.log("🔍 Filtering executions. Total:",n.value.length);const t=n.value.filter(e=>{const o=e.workflow_name?.toLowerCase().includes(h.value.toLowerCase())||e.processName?.toLowerCase().includes(h.value.toLowerCase())||String(e.id).includes(h.value),u=k.value==="all"||e.status===k.value,D=y.value==="all"||e.workflow_id===y.value||e.processId===y.value;return o&&u&&D});return console.log("✅ All filtered:",t.length),t}),A=m(()=>{const t=(d.value-1)*I.value,e=t+I.value;return W.value.slice(t,e)}),E=m(()=>Math.ceil(W.value.length/I.value)),B=(t,e)=>{if(!t)return"success";const o=t.toLowerCase();if(o.includes("success"))return"success";if(o.includes("error")||o.includes("fail"))return"error";if(o.includes("cancel"))return"canceled";if(o.includes("running")||o.includes("progress"))return"running";if(o.includes("waiting")||o.includes("pending"))return"waiting";if(e){const u=e.toLowerCase();if(u.includes("completed"))return"success";if(u.includes("attention"))return"error";if(u.includes("progress"))return"running"}return"success"},G=t=>{const e=B(t.originalStatus,t.processRunStatus?.label)||"success";return{...t,id:t.processRunId||t.id,workflow_id:t.processId||t.workflow_id,workflow_name:t.processName||t.workflow_name,status:e,started_at:t.processRunStarted||t.processRunStartTime||t.started_at,stopped_at:t.processRunStopped||t.processRunEndTime||t.stopped_at,duration_ms:t.processRunDuration?t.processRunDuration*1e3:t.processDuration||t.duration_ms||0,originalStatus:t.originalStatus,processRunStatus:t.processRunStatus}},b=async()=>{console.log("🚀 Starting refresh executions..."),R.value=!0;try{const t=await ie.getProcessExecutions();console.log("🔥 RAW API DATA:",t),t.processRuns&&Array.isArray(t.processRuns)?(console.log("📦 First execution raw:",t.processRuns[0]),n.value=t.processRuns.map(G),console.log("✅ Mapped executions:",n.value),n.value.length>0&&x.showToast("Process Runs",`${n.value.length} process runs loaded`,"success")):(console.log("⚠️ No processRuns in data"),n.value=[])}catch(t){console.error("❌ ERROR loading executions:",t.message),x.showToast("Error",t.message||"Unable to load process runs","error"),n.value=[]}finally{R.value=!1}},K=t=>{if(!t)return"-";const e=new Date(t);if(isNaN(e.getTime()))return"-";const o=new Date,u=new Date(o.getFullYear(),o.getMonth(),o.getDate()),D=new Date(e.getFullYear(),e.getMonth(),e.getDate()),U=e.toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit",second:"2-digit"});return D.getTime()===u.getTime()?U:`${e.toLocaleDateString("it-IT",{month:"short",day:"2-digit"})}, ${U}`},Y=t=>t?t<1e3?`${t}ms`:t<6e4?`${Math.round(t/1e3*10)/10}s`:`${Math.round(t/6e4*10)/10}min`:"-";F(C,t=>{t?N.startAutoRefresh("executions",b,5e3):N.stopAutoRefresh("executions")});const j=t=>{console.log("🔥 CLICK DETECTED! Execution:",t),console.log("🎯 Opening execution details for:",t.workflow_name,"ID:",t.workflow_id),c.value=t.workflow_id,a.value=!0},q=()=>{a.value=!1,c.value=""};return Z(()=>{b(),S.fetchWorkflows(),C.value&&N.startAutoRefresh("executions",b,5e3),window.addEventListener("execution:started",b),window.addEventListener("execution:completed",b)}),ee(()=>{N.stopAutoRefresh("executions"),window.removeEventListener("execution:started",b),window.removeEventListener("execution:completed",b)}),(t,e)=>(v(),te(le,null,{default:se(()=>[s("div",de,[s("div",ue,[s("div",ve,[f(_(w),{icon:"mdi:sigma",class:"kpi-card-icon"}),s("div",ge,[s("div",pe,r(l.value.total),1),e[5]||(e[5]=s("div",{class:"kpi-card-label"},"TOTAL RUNS",-1))])]),s("div",fe,[f(_(w),{icon:"mdi:check-circle",class:"kpi-card-icon"}),s("div",_e,[s("div",he,r(l.value.success),1),e[6]||(e[6]=s("div",{class:"kpi-card-label"},"SUCCESS",-1))])]),s("div",we,[f(_(w),{icon:"mdi:alert-circle",class:"kpi-card-icon"}),s("div",me,[s("div",ke,r(l.value.error),1),e[7]||(e[7]=s("div",{class:"kpi-card-label"},"ERRORS",-1))])]),s("div",ye,[f(_(w),{icon:"mdi:cancel",class:"kpi-card-icon"}),s("div",be,[s("div",xe,r(l.value.canceled),1),e[8]||(e[8]=s("div",{class:"kpi-card-label"},"CANCELED",-1))])]),s("div",Se,[f(_(w),{icon:"mdi:play-circle",class:"kpi-card-icon"}),s("div",Re,[s("div",Ee,r(l.value.running),1),e[9]||(e[9]=s("div",{class:"kpi-card-label"},"RUNNING",-1))])]),s("div",Te,[f(_(w),{icon:"mdi:clock-outline",class:"kpi-card-icon"}),s("div",Ce,[s("div",Ie,r(l.value.waiting),1),e[10]||(e[10]=s("div",{class:"kpi-card-label"},"WAITING",-1))])])]),s("div",De,[s("div",Ne,[s("div",We,[f(_(w),{icon:"mdi:magnify",class:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-gray-500"}),L(s("input",{"onUpdate:modelValue":e[0]||(e[0]=o=>h.value=o),type:"text",placeholder:"Cerca executions...",class:"w-full pl-10 pr-4 py-2 bg-gray-800 border border-gray-700 rounded-md text-white text-sm focus:border-green-500 focus:outline-none"},null,512),[[oe,h.value]])]),L(s("select",{"onUpdate:modelValue":e[1]||(e[1]=o=>k.value=o),class:"px-3 py-2 bg-gray-800 border border-gray-700 rounded-md text-white text-sm focus:border-green-500 focus:outline-none"},[s("option",Ae,"Any Status ("+r(l.value.total)+")",1),s("option",Le,"Success ("+r(l.value.success)+")",1),s("option",Me,"Error ("+r(l.value.error)+")",1),s("option",Ue,"Canceled ("+r(l.value.canceled)+")",1),s("option",Fe,"Running ("+r(l.value.running)+")",1),s("option",Oe,"Waiting ("+r(l.value.waiting)+")",1)],512),[[P,k.value]]),L(s("select",{"onUpdate:modelValue":e[2]||(e[2]=o=>y.value=o),class:"px-3 py-2 bg-gray-800 border border-gray-700 rounded-md text-white text-sm focus:border-green-500 focus:outline-none"},[e[11]||(e[11]=s("option",{value:"all"},"All Workflows",-1)),(v(!0),p($,null,V(z.value,o=>(v(),p("option",{key:o.id,value:o.id},r(o.name),9,Pe))),128))],512),[[P,y.value]])])]),s("div",$e,[s("div",Ve,[s("table",ze,[e[13]||(e[13]=s("thead",null,[s("tr",{class:"bg-gray-800 border-b-2 border-gray-600"},[s("th",{class:"border-r border-gray-700 px-2 py-1 text-xs font-bold text-gray-300 text-left"},"PROCESS NAME"),s("th",{class:"border-r border-gray-700 px-2 py-1 text-xs font-bold text-gray-300 text-left"},"STATUS"),s("th",{class:"border-r border-gray-700 px-2 py-1 text-xs font-bold text-gray-300 text-left"},"STARTED"),s("th",{class:"border-r border-gray-700 px-2 py-1 text-xs font-bold text-gray-300 text-left"},"RUN TIME"),s("th",{class:"border-r border-gray-700 px-2 py-1 text-xs font-bold text-gray-300 text-left"},"EXEC. ID")])],-1)),s("tbody",null,[A.value.length===0?(v(),p("tr",Be,[s("td",Ge,[f(_(w),{icon:"mdi:play-circle-outline",class:"h-8 w-8 mx-auto mb-2 text-gray-600"}),e[12]||(e[12]=ae(" No process runs found ",-1))])])):O("",!0),(v(!0),p($,null,V(A.value,(o,u)=>(v(),p("tr",{key:o.id,class:M(["border-b border-gray-700 hover:bg-gray-800",{"bg-gray-900":u%2===0,"bg-gray-850":u%2===1}])},[s("td",Ke,[s("div",Ye,[s("span",{onClick:D=>j(o),class:"truncate block cursor-pointer hover:text-green-400 transition-colors",title:o.workflow_name||o.processName},r(o.workflow_name||o.processName),9,je)])]),s("td",qe,[o.status==="success"?(v(),p("span",Xe," SUCCESS ")):o.status==="error"?(v(),p("span",He," ERROR ")):o.status==="canceled"?(v(),p("span",Je," CANCELED ")):o.status==="running"?(v(),p("span",Qe," RUNNING ")):o.status==="waiting"?(v(),p("span",Ze," WAITING ")):(v(),p("span",et,r((o.status||"UNKNOWN").toUpperCase()),1))]),s("td",tt,r(K(o.started_at)),1),s("td",st,r(Y(o.duration_ms)),1),s("td",ot," #"+r(o.id||o.processRunId),1)],2))),128))])])])]),n.value.length>0?(v(),p("div",at,[s("p",rt," Pagina "+r(d.value)+" di "+r(E.value)+" - Visualizzando "+r(A.value.length)+" di "+r(W.value.length)+" risultati ",1),s("div",lt,[s("button",{onClick:e[3]||(e[3]=o=>d.value=Math.max(1,d.value-1)),disabled:d.value===1,class:M(["btn-control text-xs px-3 py-1",d.value===1?"opacity-50 cursor-not-allowed":""])}," ← Precedente ",10,nt),s("span",it,r(d.value)+" / "+r(E.value),1),s("button",{onClick:e[4]||(e[4]=o=>d.value=Math.min(E.value,d.value+1)),disabled:d.value===E.value,class:M(["btn-control text-xs px-3 py-1",d.value===E.value?"opacity-50 cursor-not-allowed":""])}," Successiva → ",10,ct)])])):O("",!0)]),f(ne,{show:a.value,"workflow-id":c.value,"tenant-id":_(T).tenantId,onClose:q},null,8,["show","workflow-id","tenant-id"])]),_:1}))}}),ht=re(dt,[["__scopeId","data-v-4bdb7bcf"]]);export{ht as default};
//# sourceMappingURL=ExecutionsPage-C2cjiPZe.js.map
