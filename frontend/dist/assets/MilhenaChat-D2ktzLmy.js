import{_ as G,a as H,r as u,o as O,S as U,e as o,f as i,g as t,m as c,l,I as r,h as p,t as v,a3 as k,F,z as A,n as B,k as w,Q as K,i as x,v as W,aC as j,R as J}from"./index-DL2fbv_4.js";import{a as q}from"./api-client-C9hONd1T.js";const X={class:"milhena-chat-container"},Y={class:"chat-header"},Z={class:"header-content"},ee={class:"header-left"},te={class:"header-stats"},se={class:"stat"},ae={class:"stat-value"},ne={class:"stat"},ie={class:"stat-value"},oe={key:0,class:"stat"},le={key:0,class:"welcome-message"},re={class:"quick-actions"},ce={class:"message-avatar"},de={class:"message-content"},ue={class:"message-header"},ve={class:"message-sender"},pe={class:"message-time"},me={key:0,class:"message-latency"},fe=["innerHTML"],_e={key:0,class:"message-confidence"},he={class:"confidence-bar"},ge={class:"confidence-text"},ke={key:1,class:"feedback-buttons"},be=["onClick"],ye=["onClick"],Ce={key:2,class:"feedback-confirmed"},we={key:0,class:"positive"},Me={key:1,class:"negative"},Se={key:3,class:"reformulation-helper"},Te={class:"suggestions"},Ie=["onClick"],qe={key:1,class:"message assistant typing"},ze={class:"message-avatar"},De={class:"chat-input-container"},Le={class:"input-wrapper"},Re=["disabled"],$e=["disabled"],Ee={class:"input-hint"},Fe={key:0,class:"reformulation-alert"},Ae={key:1},Be={class:"learning-stats"},Pe={class:"stat-item"},Ne={class:"stat-value"},Qe={class:"stat-item"},Ve={class:"stat-value"},Ge={class:"stat-item"},He={class:"stat-value"},Oe={key:0,class:"stat-item"},Ue={class:"stat-value"},Ke={__name:"MilhenaChat",setup(xe){const z=H(),d=u([]),m=u(""),g=u(!1),M=u(!1),S=u(!1),h=u(!1),D=u(0),T=u(92),C=u(null),L=u(P()),f=u({queries:0,patterns:0,improvement:0,cache_hit_rate:0});function P(){return"session_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)}const N=a=>new Date(a).toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit",second:"2-digit"}),Q=a=>(a=a.replace(/\*\*(.*?)\*\*/g,"<strong>$1</strong>"),a=a.replace(/\*(.*?)\*/g,"<em>$1</em>"),a=a.replace(/\n/g,"<br>"),a=a.replace(/â€¢ /g,"ðŸ”¸ "),a),R=()=>{J(()=>{C.value&&(C.value.scrollTop=C.value.scrollHeight)})},b=a=>{m.value=a,I()},$=async(a,e)=>{const s=d.value[a];if(!(!s||s.feedback)){s.feedback=e,e==="negative"&&(h.value=!0,setTimeout(()=>{h.value=!1},3e4)),S.value=!0,setTimeout(()=>{S.value=!1},3e3);try{await q.post("/api/milhena/feedback",{session_id:L.value,message_id:s.id||a,query:d.value[a-1]?.content||"",response:s.content,feedback_type:e,confidence:s.confidence,timestamp:s.timestamp}),z.success(e==="positive"?"Grazie per il feedback positivo!":"Grazie, userÃ² questo feedback per migliorare")}catch(_){console.error("Feedback error:",_)}}},V=a=>{const e=[];return a.intent==="ERRORS"||a.content.includes("error")?(e.push("Mostra solo gli errori critici di oggi"),e.push("Quali processi hanno avuto problemi nelle ultime 24 ore?")):a.intent==="METRICS"||a.content.includes("metric")?(e.push("Quante fatture sono state elaborate oggi?"),e.push("Dammi le statistiche complete del sistema")):(e.push("Mostra lo stato generale del sistema"),e.push("Ci sono problemi urgenti da risolvere?")),e},I=async()=>{if(!m.value.trim()||g.value)return;const a={role:"user",content:m.value,timestamp:new Date,isReformulation:h.value};d.value.push(a);const e=m.value;m.value="";let s={conversation_history:d.value.slice(-10),is_reformulation:h.value};if(h.value){const n=d.value.findLastIndex(y=>y.feedback==="negative");n>=0&&(s.original_query=d.value[n-1]?.content||"",s.failed_response=d.value[n]?.content||""),h.value=!1}g.value=!0,M.value=!0,R();const _=Date.now();try{const n=await q.post("/api/n8n/agent/customer-support",{message:e,session_id:L.value,context:s}),y=Date.now()-_;D.value=y,n.data.system_accuracy&&(T.value=Math.round(n.data.system_accuracy*100)),d.value.push({role:"assistant",content:n.data.response||n.data.message,timestamp:new Date,confidence:n.data.confidence,intent:n.data.intent,latency:y,cached:n.data.cached||!1,learned:n.data.learned||!1}),n.data.learned&&f.value.patterns++}catch(n){console.error("Chat error:",n),d.value.push({role:"assistant",content:n.response?.data?.message||"Mi dispiace, c'Ã¨ stato un problema. Riprova tra poco.",timestamp:new Date,latency:Date.now()-_}),z.error("Errore nella comunicazione con Milhena")}finally{g.value=!1,M.value=!1,R(),f.value.queries++}},E=async()=>{try{const a=await q.get("/api/milhena/learning/stats/today");f.value=a.data,a.data.accuracy&&(T.value=Math.round(a.data.accuracy*100))}catch(a){console.error("Failed to load learning stats:",a)}};return O(()=>{E();const a=setInterval(E,6e4);setTimeout(()=>{d.value.push({role:"assistant",content:"Ciao! Sono Milhena v3.0 Learning Edition. Imparo dai tuoi feedback per migliorare continuamente. Come posso aiutarti oggi?",timestamp:new Date,confidence:1})},500),U(()=>{clearInterval(a)})}),(a,e)=>(i(),o("div",X,[t("div",Y,[t("div",Z,[t("div",ee,[c(l(r),{icon:"mdi:robot-happy",class:"header-icon"}),e[5]||(e[5]=t("div",null,[t("h1",null,"Milhena Assistant"),t("p",{class:"subtitle"},"v3.0 Learning Edition - Self-Improving AI")],-1))]),t("div",te,[t("div",se,[t("span",ae,v(D.value)+"ms",1),e[6]||(e[6]=t("span",{class:"stat-label"},"Latency",-1))]),t("div",ne,[t("span",ie,v(T.value)+"%",1),e[7]||(e[7]=t("span",{class:"stat-label"},"Accuracy",-1))]),S.value?(i(),o("div",oe,[c(l(r),{icon:"mdi:brain",class:"learning-icon animate-pulse"}),e[8]||(e[8]=t("span",{class:"stat-label"},"Learning...",-1))])):p("",!0)])])]),t("div",{class:"chat-messages",ref_key:"messagesContainer",ref:C},[d.value.length===0?(i(),o("div",le,[c(l(r),{icon:"mdi:hand-wave",class:"wave-icon"}),e[13]||(e[13]=t("h2",null,"Ciao! Sono Milhena",-1)),e[14]||(e[14]=t("p",null,"Il tuo assistente AI per PilotProOS. Posso aiutarti con:",-1)),t("div",re,[t("button",{onClick:e[0]||(e[0]=s=>b("Mostrami i workflow attivi")),class:"quick-btn"},[c(l(r),{icon:"mdi:workflow"}),e[9]||(e[9]=k(" Workflow Attivi ",-1))]),t("button",{onClick:e[1]||(e[1]=s=>b("Analizza le performance di oggi")),class:"quick-btn"},[c(l(r),{icon:"mdi:chart-line"}),e[10]||(e[10]=k(" Performance Oggi ",-1))]),t("button",{onClick:e[2]||(e[2]=s=>b("Quali sono gli ultimi errori?")),class:"quick-btn"},[c(l(r),{icon:"mdi:alert-circle"}),e[11]||(e[11]=k(" Ultimi Errori ",-1))]),t("button",{onClick:e[3]||(e[3]=s=>b("Come funzioni?")),class:"quick-btn"},[c(l(r),{icon:"mdi:help-circle"}),e[12]||(e[12]=k(" Come Funzioni ",-1))])])])):p("",!0),(i(!0),o(F,null,A(d.value,(s,_)=>(i(),o("div",{key:_,class:B(["message",s.role])},[t("div",ce,[s.role==="user"?(i(),w(l(r),{key:0,icon:"mdi:account"})):(i(),w(l(r),{key:1,icon:"mdi:robot"}))]),t("div",de,[t("div",ue,[t("span",ve,v(s.role==="user"?"Tu":"Milhena"),1),t("span",pe,v(N(s.timestamp)),1),s.latency?(i(),o("span",me,v(s.latency)+"ms",1)):p("",!0)]),t("div",{class:"message-text",innerHTML:Q(s.content)},null,8,fe),s.confidence?(i(),o("div",_e,[t("div",he,[t("div",{class:B(["confidence-fill",{high:s.confidence>.8,medium:s.confidence>.6&&s.confidence<=.8,low:s.confidence<=.6}]),style:K({width:s.confidence*100+"%"})},null,6)]),t("span",ge,"Confidence: "+v((s.confidence*100).toFixed(0))+"%",1)])):p("",!0),s.role==="assistant"&&!s.feedback?(i(),o("div",ke,[t("button",{onClick:n=>$(_,"positive"),class:"feedback-btn positive",title:"Risposta utile"},[c(l(r),{icon:"mdi:thumb-up-outline"})],8,be),t("button",{onClick:n=>$(_,"negative"),class:"feedback-btn negative",title:"Risposta non utile"},[c(l(r),{icon:"mdi:thumb-down-outline"})],8,ye)])):p("",!0),s.feedback?(i(),o("div",Ce,[s.feedback==="positive"?(i(),o("span",we,[c(l(r),{icon:"mdi:check-circle"}),e[15]||(e[15]=k(" Grazie per il feedback! ",-1))])):(i(),o("span",Me,[c(l(r),{icon:"mdi:alert-circle"}),e[16]||(e[16]=k(" Grazie, sto imparando... ",-1))]))])):p("",!0),s.feedback==="negative"&&!s.reformulated?(i(),o("div",Se,[e[17]||(e[17]=t("p",null,"Puoi riformulare la domanda per aiutarmi a capire meglio?",-1)),t("div",Te,[(i(!0),o(F,null,A(V(s),n=>(i(),o("button",{key:n,onClick:y=>b(n),class:"suggestion-btn"},v(n),9,Ie))),128))])])):p("",!0)])],2))),128)),M.value?(i(),o("div",qe,[t("div",ze,[c(l(r),{icon:"mdi:robot"})]),e[18]||(e[18]=t("div",{class:"message-content"},[t("div",{class:"typing-indicator"},[t("span"),t("span"),t("span")])],-1))])):p("",!0)],512),t("div",De,[t("div",Le,[x(t("input",{"onUpdate:modelValue":e[4]||(e[4]=s=>m.value=s),onKeyup:j(I,["enter"]),disabled:g.value,placeholder:"Chiedi qualsiasi cosa su processi, workflow, performance...",class:"chat-input"},null,40,Re),[[W,m.value]]),t("button",{onClick:I,disabled:!m.value.trim()||g.value,class:"send-button"},[g.value?(i(),w(l(r),{key:0,icon:"mdi:loading",class:"animate-spin"})):(i(),w(l(r),{key:1,icon:"mdi:send"}))],8,$e)]),t("div",Ee,[c(l(r),{icon:"mdi:information"}),h.value?(i(),o("span",Fe," ðŸ”„ Sto imparando dalla tua correzione... ")):(i(),o("span",Ae,"Milhena impara dai tuoi feedback per migliorare continuamente."))])]),t("div",Be,[t("div",Pe,[e[19]||(e[19]=t("span",{class:"stat-label"},"Oggi:",-1)),t("span",Ne,v(f.value.queries)+" queries",1)]),t("div",Qe,[e[20]||(e[20]=t("span",{class:"stat-label"},"Patterns appresi:",-1)),t("span",Ve,v(f.value.patterns),1)]),t("div",Ge,[e[21]||(e[21]=t("span",{class:"stat-label"},"Miglioramento:",-1)),t("span",He,"+"+v(f.value.improvement)+"%",1)]),f.value.cache_hit_rate?(i(),o("div",Oe,[e[22]||(e[22]=t("span",{class:"stat-label"},"Cache Hit:",-1)),t("span",Ue,v(f.value.cache_hit_rate)+"%",1)])):p("",!0)])]))}},Je=G(Ke,[["__scopeId","data-v-4f057f88"]]);export{Je as default};
//# sourceMappingURL=MilhenaChat-D2ktzLmy.js.map
