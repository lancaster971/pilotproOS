import{a6 as K,r as c,q as W,d as J,a3 as Q,G as Z,o as ee,x as R,b as te,j as se,e as g,y as O,f as e,m as x,c as m,g as T,t as n,k as f,h as N,a7 as oe,l as D,n as v,v as ae,a8 as P,F as L,z as F}from"./index-Dtu06-oO.js";import{P as re,M as ne}from"./MainLayout-C-wHnsEA.js";import{_ as le}from"./TimelineModal.vue_vue_type_script_setup_true_lang-D0DUcXE3.js";import{useAuthStore as ie}from"./auth-Ckyanyq3.js";import{b as U}from"./api-client-Dy4MoU83.js";import{R as ce}from"./refresh-cw-CLd2lEEu.js";import{c as z}from"./settings-BXrMLSgp.js";import{S as ue,E as de}from"./search-BIejRd0M.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";import"./iconify-BAXUVM_a.js";/**
 * @license lucide-vue-next v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=z("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-vue-next v0.542.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=z("download",[["path",{d:"M12 15V3",key:"m9g1x1"}],["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["path",{d:"m7 10 5 5 5-5",key:"brsn70"}]]),fe=K("workflows",()=>{const d=c([]),I=c(null),p=c(!1),y=c(null),_=c(0),k=W(()=>({total:d.value.length,active:d.value.filter(a=>a.active&&!a.is_archived).length,inactive:d.value.filter(a=>!a.active&&!a.is_archived).length,archived:d.value.filter(a=>a.is_archived).length})),S=W(()=>d.value.filter(a=>a.active&&!a.is_archived)),u=W(()=>d.value.sort((a,l)=>new Date(l.updated_at).getTime()-new Date(a.updated_at).getTime()).slice(0,10));return{workflows:d,selectedWorkflow:I,isLoading:p,error:y,lastFetch:_,stats:k,activeWorkflows:S,recentWorkflows:u,fetchWorkflows:async()=>{p.value=!0,y.value=null;try{const l=(await apiClient.get("/api/business/processes")).data;d.value=(l.data||[]).map(r=>({id:r.process_id,name:r.process_name,active:r.is_active,is_archived:!1,created_at:r.created_date||new Date().toISOString(),updated_at:r.last_modified||new Date().toISOString(),node_count:5,execution_count:parseInt(r.executions_today)||0,has_webhook:!1,last_execution:r.last_modified,tags:[],settings:{}})),_.value=Date.now(),console.log("✅ Workflows loaded:",d.value.length)}catch(a){y.value=a.message||"Failed to load workflows",console.error("❌ Failed to load workflows:",a),d.value=[{id:"1",name:"TRY Backend",active:!0,is_archived:!1,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),node_count:5,execution_count:0,has_webhook:!1,last_execution:null,tags:[],settings:{}}]}finally{p.value=!1}},selectWorkflow:a=>{I.value=a,console.log("✅ Workflow selected:",a.name)},toggleWorkflow:async a=>{try{a.active=!a.active,console.log(`✅ Workflow ${a.active?"activated":"deactivated"}:`,a.name)}catch(l){console.error("❌ Failed to toggle workflow:",l)}},createWorkflow:async a=>{try{const l={id:"new-"+Date.now(),name:a.name||"New Workflow",active:!1,is_archived:!1,created_at:new Date().toISOString(),updated_at:new Date().toISOString(),node_count:0,execution_count:0,has_webhook:!1,last_execution:null,tags:a.tags||[],settings:a.settings||{}};return d.value.push(l),console.log("✅ Workflow created:",l.name),l}catch(l){throw console.error("❌ Failed to create workflow:",l),l}}}}),ve={class:"space-y-6"},xe={class:"flex items-center justify-between"},me={class:"text-3xl font-bold text-gradient"},he={class:"flex items-center gap-3"},we={class:"flex items-center gap-2"},pe=["disabled"],_e={class:"btn-control"},be={class:"grid grid-cols-2 md:grid-cols-5 gap-4"},ye={class:"control-card p-4"},ke={class:"text-center"},Se={class:"text-2xl font-bold text-white"},Ee={class:"control-card p-4"},Ce={class:"text-center"},De={class:"text-2xl font-bold text-green-400"},Ie={class:"control-card p-4"},Te={class:"text-center"},We={class:"text-2xl font-bold text-red-400"},Ae={class:"control-card p-4"},Re={class:"text-center"},$e={class:"text-2xl font-bold text-blue-400"},Oe={class:"control-card p-4"},Le={class:"text-center"},Fe={class:"text-2xl font-bold text-yellow-400"},Me={class:"control-card p-4"},Ne={class:"grid grid-cols-1 lg:grid-cols-3 gap-4"},Pe={class:"relative group"},Ue={class:"relative"},Ve={class:"flex items-center gap-2"},ze={key:0,class:"absolute z-10 mt-2 w-full bg-surface border border-border rounded-lg shadow-xl overflow-hidden"},Be=["onClick"],je={class:"flex items-center gap-2"},Ge={class:"text-text-muted text-xs"},He={class:"relative"},Xe={class:"truncate"},Ye={key:0,class:"absolute z-10 mt-2 w-full bg-surface border border-border rounded-lg shadow-xl overflow-hidden max-h-64 overflow-y-auto"},qe=["onClick"],Ke={class:"truncate"},Je={class:"control-card overflow-hidden"},Qe={class:"overflow-x-auto"},Ze={class:"w-full"},et={key:0},tt={colspan:"7",class:"p-8 text-center text-gray-500"},st={class:"p-4"},ot={class:"font-medium text-white max-w-xs"},at=["onClick","title"],rt={class:"p-4"},nt={class:"p-4 text-sm text-gray-300"},lt={class:"p-4 text-sm text-gray-300 font-mono"},it={class:"p-4 text-sm text-gray-300 font-mono"},ct={class:"p-4"},ut={class:"p-1 text-gray-400 hover:text-white transition-colors"},dt={key:0,class:"flex items-center justify-between"},gt={class:"text-sm text-gray-400"},kt=J({__name:"ExecutionsPage",setup(d){const I=ie(),p=fe(),y=Q(),_=c(!1),k=c(!0),S=c(""),u=c("all"),h=c("all"),i=c([]),E=c(!1),b=c(!1),a=c(!1),l=c(""),r=W(()=>({total:i.value.length,success:i.value.filter(o=>o.status==="success").length,error:i.value.filter(o=>o.status==="error").length,running:i.value.filter(o=>o.status==="running").length,waiting:i.value.filter(o=>o.status==="waiting").length})),A=W(()=>{console.log("🔍 Filtering executions. Total:",i.value.length);const o=i.value.filter(s=>{const t=s.workflow_name?.toLowerCase().includes(S.value.toLowerCase())||String(s.id).includes(S.value),C=u.value==="all"||s.status===u.value,$=h.value==="all"||s.workflow_id===h.value;return t&&C&&$});return console.log("✅ Filtered executions:",o.length),o}),w=async()=>{alert("🚀 REFRESH EXECUTIONS CALLED!"),console.log("🚀 STARTING refreshExecutions..."),_.value=!0;try{console.log("🌐 Making API call to /process-runs...");const o=await U.getProcessRuns();console.log("✅ OFETCH data loaded, length:",o.data?.length);const s=await U.get("/process-runs");console.log("📡 BusinessAPI response status:",s.status);const t=s.data;if(console.log("📊 BusinessAPI data:",t),!t.data||!Array.isArray(t.data))throw new Error("Invalid API response format");i.value=[{id:999,workflow_id:"test-id",workflow_name:"TEST EXECUTION - Click me!",status:"success",mode:"webhook",started_at:new Date().toISOString(),stopped_at:new Date().toISOString(),duration_ms:1e3,business_status:"Completed Successfully",issue_description:null}],console.log("✅ SET TEST EXECUTION:",i.value),i.value.length>0&&y.showToast("SUCCESS",`${i.value.length} test executions loaded`,"success")}catch(o){console.error("❌ ERROR in refreshExecutions:",o),y.showToast("Errore",o.message||"Impossibile caricare le executions","error"),i.value=[]}finally{console.log("🏁 FINISHED refreshExecutions. Executions count:",i.value.length),_.value=!1}},B=o=>{switch(o){case"success":return"text-green-400 bg-green-500/10 border-green-500/30";case"error":return"text-red-400 bg-red-500/10 border-red-500/30";case"running":return"text-blue-400 bg-blue-500/10 border-blue-500/30";case"waiting":return"text-yellow-400 bg-yellow-500/10 border-yellow-500/30";default:return"text-gray-400 bg-gray-500/10 border-gray-500/30"}},j=o=>{switch(o){case"success":return"bg-green-500";case"error":return"bg-red-500";case"running":return"bg-blue-500";case"waiting":return"bg-yellow-500";default:return"bg-gray-500"}},G=o=>{switch(o){case"success":return"Success";case"error":return"Error";case"running":return"Running";case"waiting":return"Waiting";default:return"Unknown"}},H=o=>{const s=new Date(o),t=new Date,C=new Date(t.getFullYear(),t.getMonth(),t.getDate()),$=new Date(s.getFullYear(),s.getMonth(),s.getDate()),M=s.toLocaleTimeString("it-IT",{hour:"2-digit",minute:"2-digit",second:"2-digit"});return $.getTime()===C.getTime()?M:`${s.toLocaleDateString("it-IT",{month:"short",day:"2-digit"})}, ${M}`},X=o=>o?o<1e3?`${o}ms`:o<6e4?`${Math.round(o/1e3*10)/10}s`:`${Math.round(o/6e4*10)/10}min`:"-";Z(k,o=>{o?R.startAutoRefresh("executions",w,5e3):R.stopAutoRefresh("executions")});const Y=o=>{console.log("🔥 CLICK DETECTED! Execution:",o),console.log("🎯 Opening execution details for:",o.workflow_name,"ID:",o.workflow_id),l.value=o.workflow_id,a.value=!0},q=()=>{a.value=!1,l.value=""};return ee(()=>{w(),p.fetchWorkflows(),k.value&&R.startAutoRefresh("executions",w,5e3),window.addEventListener("execution:started",w),window.addEventListener("execution:completed",w)}),te(()=>{R.stopAutoRefresh("executions"),window.removeEventListener("execution:started",w),window.removeEventListener("execution:completed",w)}),(o,s)=>(g(),se(ne,null,{default:O(()=>[e("div",ve,[e("div",xe,[e("div",null,[e("h1",me," ⚡ CODICE AGGIORNATO ADESSO! - "+n(f(I).tenantId),1),s[5]||(s[5]=e("p",{class:"text-gray-400 mt-1"}," Monitora le esecuzioni dei tuoi workflow ",-1))]),e("div",he,[e("div",we,[N(e("input",{"onUpdate:modelValue":s[0]||(s[0]=t=>k.value=t),type:"checkbox",id:"auto-refresh",class:"w-4 h-4 text-green-500 bg-gray-900 border-gray-600 rounded focus:ring-green-500"},null,512),[[oe,k.value]]),s[6]||(s[6]=e("label",{for:"auto-refresh",class:"text-sm text-white"}," Auto refresh ",-1))]),e("button",{onClick:w,disabled:_.value,class:"btn-control"},[x(f(ce),{class:v([{"animate-spin":_.value},"h-4 w-4"])},null,8,["class"]),s[7]||(s[7]=D(" Refresh ",-1))],8,pe),e("button",_e,[x(f(ge),{class:"h-4 w-4"}),s[8]||(s[8]=D(" Esporta ",-1))])])]),e("div",be,[e("div",ye,[e("div",ke,[e("p",Se,n(r.value.total),1),s[9]||(s[9]=e("p",{class:"text-xs text-gray-400"},"Totali",-1))])]),e("div",Ee,[e("div",Ce,[e("p",De,n(r.value.success),1),s[10]||(s[10]=e("p",{class:"text-xs text-gray-400"},"Success",-1))])]),e("div",Ie,[e("div",Te,[e("p",We,n(r.value.error),1),s[11]||(s[11]=e("p",{class:"text-xs text-gray-400"},"Error",-1))])]),e("div",Ae,[e("div",Re,[e("p",$e,n(r.value.running),1),s[12]||(s[12]=e("p",{class:"text-xs text-gray-400"},"Running",-1))])]),e("div",Oe,[e("div",Le,[e("p",Fe,n(r.value.waiting),1),s[13]||(s[13]=e("p",{class:"text-xs text-gray-400"},"Waiting",-1))])])]),e("div",Me,[e("div",Ne,[e("div",Pe,[x(f(ue),{class:"absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-text-muted transition-colors group-focus-within:text-primary"}),N(e("input",{"onUpdate:modelValue":s[1]||(s[1]=t=>S.value=t),type:"text",placeholder:"Cerca executions...",class:"w-full pl-10 pr-4 py-2.5 bg-surface border border-border rounded-lg text-text text-sm focus:border-primary focus:outline-none focus:ring-1 focus:ring-primary/20 transition-all duration-200 placeholder:text-text-muted"},null,512),[[ae,S.value]])]),e("div",Ue,[e("button",{onClick:s[2]||(s[2]=t=>E.value=!E.value),class:"w-full px-4 py-2.5 bg-surface border border-border rounded-lg text-text text-sm hover:border-primary/50 focus:border-primary focus:outline-none focus:ring-1 focus:ring-primary/20 transition-all duration-200 flex items-center justify-between group"},[e("span",Ve,[u.value!=="all"?(g(),m("div",{key:0,class:v(["w-2 h-2 rounded-full",u.value==="success"?"bg-green-400":u.value==="error"?"bg-red-400":u.value==="running"?"bg-blue-400":"bg-yellow-400"])},null,2)):T("",!0),D(" "+n(u.value==="all"?`Any Status (${r.value.total})`:u.value==="success"?`Success (${r.value.success})`:u.value==="error"?`Error (${r.value.error})`:u.value==="running"?`Running (${r.value.running})`:`Waiting (${r.value.waiting})`),1)]),x(f(V),{class:v(["h-4 w-4 text-text-muted transition-transform duration-200",E.value?"rotate-180":""])},null,8,["class"])]),x(P,{"enter-active-class":"transition ease-out duration-200","enter-from-class":"transform opacity-0 scale-95","enter-to-class":"transform opacity-100 scale-100","leave-active-class":"transition ease-in duration-150","leave-from-class":"transform opacity-100 scale-100","leave-to-class":"transform opacity-0 scale-95"},{default:O(()=>[E.value?(g(),m("div",ze,[(g(),m(L,null,F(["all","success","error","running","waiting"],t=>e("button",{key:t,onClick:C=>{u.value=t,E.value=!1},class:v(["w-full px-4 py-2.5 text-left text-sm hover:bg-surface-hover transition-colors flex items-center justify-between group",u.value===t?"bg-primary/10 text-primary":"text-text"])},[e("span",je,[e("div",{class:v(["w-2 h-2 rounded-full",t==="success"?"bg-green-400":t==="error"?"bg-red-400":t==="running"?"bg-blue-400":t==="waiting"?"bg-yellow-400":"bg-transparent"])},null,2),D(" "+n(t==="all"?"Any Status":t==="success"?"Success":t==="error"?"Error":t==="running"?"Running":"Waiting"),1)]),e("span",Ge,n(t==="all"?r.value.total:t==="success"?r.value.success:t==="error"?r.value.error:t==="running"?r.value.running:r.value.waiting),1)],10,Be)),64))])):T("",!0)]),_:1})]),e("div",He,[e("button",{onClick:s[3]||(s[3]=t=>b.value=!b.value),class:"w-full px-4 py-2.5 bg-surface border border-border rounded-lg text-text text-sm hover:border-primary/50 focus:border-primary focus:outline-none focus:ring-1 focus:ring-primary/20 transition-all duration-200 flex items-center justify-between group"},[e("span",Xe,n(h.value==="all"?"All Workflows":f(p).workflows.find(t=>t.id===h.value)?.name||"Select Workflow"),1),x(f(V),{class:v(["h-4 w-4 text-text-muted transition-transform duration-200 flex-shrink-0",b.value?"rotate-180":""])},null,8,["class"])]),x(P,{"enter-active-class":"transition ease-out duration-200","enter-from-class":"transform opacity-0 scale-95","enter-to-class":"transform opacity-100 scale-100","leave-active-class":"transition ease-in duration-150","leave-from-class":"transform opacity-100 scale-100","leave-to-class":"transform opacity-0 scale-95"},{default:O(()=>[b.value?(g(),m("div",Ye,[e("button",{onClick:s[4]||(s[4]=t=>{h.value="all",b.value=!1}),class:v(["w-full px-4 py-2.5 text-left text-sm hover:bg-surface-hover transition-colors",h.value==="all"?"bg-primary/10 text-primary":"text-text"])}," All Workflows ",2),(g(!0),m(L,null,F(f(p).workflows,t=>(g(),m("button",{key:t.id,onClick:C=>{h.value=t.id,b.value=!1},class:v(["w-full px-4 py-2.5 text-left text-sm hover:bg-surface-hover transition-colors flex items-center gap-2",h.value===t.id?"bg-primary/10 text-primary":"text-text"])},[e("div",{class:v(["w-2 h-2 rounded-full",t.active?"bg-green-400":"bg-gray-400"])},null,2),e("span",Ke,n(t.name),1)],10,qe))),128))])):T("",!0)]),_:1})])])]),e("div",Je,[e("div",Qe,[e("table",Ze,[s[16]||(s[16]=e("thead",null,[e("tr",{class:"border-b border-gray-800"},[e("th",{class:"text-left p-4 text-sm font-medium text-gray-400"},[e("input",{type:"checkbox",class:"w-4 h-4 bg-gray-900 border-gray-600 rounded"})]),e("th",{class:"text-left p-4 text-sm font-medium text-gray-400"},"Workflow"),e("th",{class:"text-left p-4 text-sm font-medium text-gray-400"},"Status"),e("th",{class:"text-left p-4 text-sm font-medium text-gray-400"},"Started"),e("th",{class:"text-left p-4 text-sm font-medium text-gray-400"},"Run Time"),e("th",{class:"text-left p-4 text-sm font-medium text-gray-400"},"Exec. ID"),e("th",{class:"text-left p-4 text-sm font-medium text-gray-400"})])],-1)),e("tbody",null,[A.value.length===0?(g(),m("tr",et,[e("td",tt,[x(f(re),{class:"h-8 w-8 mx-auto mb-2 text-gray-600"}),s[14]||(s[14]=D(" Nessuna execution trovata ",-1))])])):T("",!0),(g(!0),m(L,null,F(A.value,t=>(g(),m("tr",{key:t.id,class:"border-b border-gray-800/50 hover:bg-gray-900/30 transition-colors"},[s[15]||(s[15]=e("td",{class:"p-4"},[e("input",{type:"checkbox",class:"w-4 h-4 bg-gray-900 border-gray-600 rounded"})],-1)),e("td",st,[e("div",ot,[e("span",{onClick:C=>Y(t),class:"truncate block cursor-pointer hover:text-green-400 transition-colors",title:t.workflow_name},n(t.workflow_name),9,at)])]),e("td",rt,[e("span",{class:v(["inline-flex items-center gap-1.5 px-2 py-1 rounded-md text-xs font-medium border",B(t.status)])},[e("div",{class:v(["w-1.5 h-1.5 rounded-full",j(t.status)])},null,2),D(" "+n(G(t.status)),1)],2)]),e("td",nt,n(H(t.started_at)),1),e("td",lt,n(X(t.duration_ms)),1),e("td",it,n(t.id),1),e("td",ct,[e("button",ut,[x(f(de),{class:"h-4 w-4"})])])]))),128))])])])]),A.value.length>0?(g(),m("div",dt,[e("p",gt," Visualizzando "+n(A.value.length)+" di "+n(i.value.length)+" executions ",1),s[17]||(s[17]=e("div",{class:"flex items-center gap-2"},[e("button",{class:"btn-control text-xs px-3 py-1",disabled:""}," Precedente "),e("button",{class:"btn-control text-xs px-3 py-1",disabled:""}," Successiva ")],-1))])):T("",!0)]),x(le,{show:a.value,"workflow-id":l.value,"tenant-id":f(I).tenantId,onClose:q},null,8,["show","workflow-id","tenant-id"])]),_:1}))}});export{kt as default};
//# sourceMappingURL=ExecutionsPage-BneTTTMy.js.map
