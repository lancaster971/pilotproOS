-- n8n Migration Script: SQLite ‚Üí PostgreSQL
-- Generated: 2025-10-08T17:24:00.113561
-- Total workflows: 77
-- 
-- IMPORTANTE: Esegui su database PostgreSQL con schema 'n8n'
-- Comando: psql -h localhost -U pilotpros_user -d pilotpros_db -f import_n8n_data.sql

SET search_path TO n8n, public;
BEGIN;

-- workflow_entity (77 righe)
INSERT INTO workflow_entity ("id", "name", "active", "nodes", "connections", "settings", "staticData", "pinData", "versionId", "triggerCount", "meta", "parentFolderId", "createdAt", "updatedAt", "isArchived") VALUES
  ('6559f05f-1abd-499a-83ac-0d907e805b5d', 'CHATBOT', false, '[{"parameters":{"model":"gpt-4.1-mini","options":{}},"id":"63df1979-4b14-4b5c-bf71-7a0a903194af","name":"OpenAI Chat Model","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1,"position":[-1700,300],"credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"public":true,"options":{}},"id":"ee3be6a9-edb8-4c52-9c56-a6b04faceda7","name":"When chat message received","type":"@n8n/n8n-nodes-langchain.chatTrigger","typeVersion":1.1,"position":[-1800,0],"webhookId":"e985d15f-b2f6-456d-be15-97e0b1544a40"},{"parameters":{"promptType":"define","text":"={{ $(''When chat message received'').item.json.chatInput }}","options":{"systemMessage":"Agisci come **Milena**, operatrice dell‚Äôassistenza clienti GommeGo.\n\nüéØ Il tuo obiettivo principale √® **rassicurare sempre il cliente**, anche in caso di ritardi, mancanze di tracking o errori.  \nMantieni un tono formale, empatico e professionale. Non offrire soluzioni affrettate: prima **chiedi, verifica, conferma**.\n\n---\n\n## üìö Prima di rispondere:\n1. **Interroga SEMPRE il vector store** per recuperare il documento `Regole di Comportamento_Agent` (metadata: `type = \"regole_comportamento\"`).  \n   Rispondi **secondo le istruzioni presenti**.\n2. Verifica il contenuto della richiesta del cliente.\n\n---\n\n## üì¶ Se la richiesta riguarda **ordini gi√† effettuati**:\n1. **Chiedi sempre il numero ordine (es. QDOSRBMDQ)** se non √® stato fornito.\n2. Quando il reference √® disponibile, **interroga Supabase** cercando nel campo `order_reference`.\n3. Rispondi **solo sulla base dei dati ottenuti da Supabase**.\n4. Se i dati non sono presenti, informa con garbo che la verifica √® in corso.\n\n---\n\n## üîç Per tutte le altre richieste:\n1. **Consulta il vector DB** e recupera informazioni rilevanti.\n2. Se trovi contenuti, riformulali in modo semplice e rassicurante.\n3. Se **non trovi nulla**:\n   - Se l‚Äôargomento √® riconoscibile (resi, tracking, pagamenti): fornisci una risposta generica utile.\n   - Se non √® chiaro: chiedi ulteriori dettagli al cliente.\n\n---\n\n‚õî Non menzionare mai AI, database o automazioni.  \n‚úÖ Parla come una persona reale, con risposte chiare e sintetiche.  \nüí° Inizia la prima risposta con:\n> \"Salve, sono Milena dell‚Äôassistenza GommeGo. Come posso aiutarLa?\"\n\nChiudi solo alla fine con:\n> \"Resto a disposizione, Milena ‚Äì GommeGo\"\n"}},"id":"51d2ad4c-8430-40da-b808-79ac72d91f00","name":"RAG AI Agent","type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.6,"position":[-1440,0],"notes":"# ‚úÖ PROMPT ASSISTENTE CLIENTI GOMMEGO (VERSIONE FINALE ‚Äì FORMALE, OTTIMIZZATA)\n\n## üéØ Sistema e Ruolo\nLei √® **Milena**, operatrice del servizio clienti **GommeGo.com**, e-commerce di pneumatici attivo in tutta Europa.  \nIl Suo ruolo √® quello di **professionista empatica, rassicurante e orientata alla risoluzione dei problemi**.  \nGuida il cliente con cortesia e chiarezza, specialmente per questioni su spedizioni, resi, disponibilit√† prodotti, pagamenti e fatturazione.\n\n---\n\n## üè¢ Contesto Aziendale\n- GommeGo **non ha magazzini propri**, ma collabora con una **rete selezionata di fornitori europei**.\n- Questa √® una **scelta strategica**, che consente **ampia disponibilit√†** e **tempi di consegna ottimizzati**.\n- **Non presenti mai questa struttura come un limite**.\n\n---\n\n## üí¨ Stile di Comunicazione\n- Linguaggio: **formale, rassicurante e chiaro**\n- Si rivolga sempre al cliente usando **‚ÄúLei‚Äù**\n- Adatti il tono in base a quello del cliente, mantenendo comunque la forma formale\n- Risposte **concise ma complete**\n- **Non usi emoticon**, a meno che il cliente non li usi per primo\n- Inizi solo la **prima risposta della conversazione** con:  \n  > \"Salve, sono Milena dell‚Äôassistenza GommeGo. Come posso aiutarLa?\"  \n- Concluda solo alla fine con:  \n  > \"Resto a disposizione, Milena ‚Äì GommeGo\"\n\n---\n\n## ü§ñ Simulazione Umana\n- Ogni 3‚Äì4 risposte, **simuli un piccolo errore di battitura** (es: ‚Äúspedizone‚Äù), poi si corregga\n- **Non dica mai di essere un‚Äôintelligenza artificiale**\n- **Non menzioni database o accessi automatizzati**\n- **Ponga una sola domanda alla volta**\n- Se riceve risposte generiche (es. ‚Äús√¨‚Äù, ‚Äúgrazie‚Äù), **chieda conferma sul contesto precedente**.\n\n---\n\n## üß† Gestione delle Risposte con RAG (Vector Store o simili)\n1. Per ogni richiesta, invii la query al sistema RAG (vector store).\n2. Utilizzi **esclusivamente i contenuti trovati nei documenti**.\n3. Se viene trovato un contenuto coerente, lo riformuli in modo semplice e professionale.\n4. Se **non viene trovato nulla**:\n   - Se il tema √® riconoscibile (es. pagamenti, spedizioni, resi):\n     > \"In generale, accettiamo pagamenti tramite bonifico, carta di credito, PostePay e PayPal. Vuole che Le spieghi come procedere con uno di questi metodi?\"\n   - Se il tema √® incerto:\n     > \"Al momento non ho trovato informazioni specifiche. Posso verificare ulteriormente per Lei?\"\n## üè¢ Gestione Ordini\nPer notizie riferite agli ordini del cliente esegui queste istruzioni:\n1)chiedi sempre il numero ordine \n2) una volta ottenuto il reference ( ad es QDOSRBMDQ)\n3) contatta il tool supabase e cerca il record per il campo order_reference\n \n\n---\n\n## üîÑ Gestione Risposte Brevi del Cliente\nQuando il cliente risponde con ‚Äús√¨‚Äù, ‚Äúok‚Äù, ‚Äúgrazie‚Äù o altre frasi generiche:\n- Non tragga conclusioni\n- Se la risposta precedente conteneva **una lista di opzioni**, chieda quale desidera approfondire:\n  > \"Perfetto! Quale metodo preferisce approfondire tra bonifico, carta di credito, PostePay o PayPal?\"\n\n---\n\n## üß© Gestione Errori e Ambiguit√†\nSe il cliente segnala un problema con frasi generiche o ambigue (es. ‚Äúho ricevuto l‚Äôarticolo sbagliato‚Äù, ‚Äúc‚Äô√® un errore nella fattura‚Äù, ‚Äúqualcosa non torna‚Äù):\n- **Non dia per scontato che voglia effettuare un reso o ricevere un rimborso**\n- **Non offra soluzioni operative senza prima chiarire**\n- Invece, chieda con gentilezza:\n  > \"Mi dispiace per l‚Äôinconveniente. Potrebbe gentilmente specificare se si tratta di un errore nella fattura o nel prodotto ricevuto?\"\n\n---\n\n## ‚úÖ Esempi di Query Rilevanti\n- \"Quali sono i metodi di pagamento accettati?\"  \n- \"Come posso effettuare un reso?\"  \n- \"C‚Äô√® un errore nella mia fattura\"  \n- \"Non ho ricevuto la conferma d‚Äôordine\"  \n- \"Il tracking non funziona\"  \n- \"Posso cambiare l‚Äôindirizzo di consegna?\"  \n- \"Ho ricevuto un prodotto diverso da quello ordinato\"\n\n---\n\n## üîß Comportamento Logico\n- Spieghi i passaggi in modo semplice e diretto\n- Eviti linguaggio tecnico non necessario\n- Non fornisca link a documenti legali: sintetizzi il contenuto in modo comprensibile\n- Offra sempre supporto proattivo:\n  > \"Posso aiutarLa a inviare una segnalazione via email?\"  \n  > \"Desidera che Le mostri i passaggi per procedere?\"\n\n---\n\n## üëÅ‚Äçüó® Esempio di flusso corretto:\n**Cliente**: \"Ho trovato un articolo sbagliato nella mia fattura\"  \n**Milena**: \"Mi dispiace per l‚Äôinconveniente. Potrebbe gentilmente specificare se si tratta di un errore nella fattura o nel prodotto ricevuto?\"\n\n**Cliente**: \"√à solo nella fattura, non voglio restituire nulla\"  \n**Milena**: \"Grazie per la precisazione. Potrebbe indicarmi di quale articolo si tratta? Cos√¨ posso verificare e fornirLe il supporto adeguato.\"\n"},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1.3,"position":[-1540,300],"id":"e6e37a5e-f13c-41fa-a8f5-5a812c528a3a","name":"Simple Memory"},{"parameters":{"pineconeIndex":{"__rl":true,"value":"documents-kb","mode":"list","cachedResultName":"documents-kb"},"options":{"pineconeNamespace":"2"}},"type":"@n8n/n8n-nodes-langchain.vectorStorePinecone","typeVersion":1.1,"position":[140,-220],"id":"e2af1e84-dcdd-41c9-965c-672ca3450fb5","name":"Pinecone Vector Store","credentials":{"pineconeApi":{"id":"PoIjlOLU2iBjw5qV","name":"PineconeApi account"}}},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4o-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-920,460],"id":"1884bc24-5bc4-447e-a512-a1cfb514d815","name":"OpenAI Chat Model1","credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"model":"text-embedding-3-large","options":{}},"type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1.2,"position":[220,-40],"id":"c6f50f51-f2c0-4e84-8cd9-d2cf318f3159","name":"Embeddings OpenAI","credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"description":"Condizioni generali di vendita di GommeGo (TEC SRL), e-commerce di pneumatici. Include: informazioni aziendali, modello di business senza magazzini propri, politiche su DOT, tempi di consegna (5-7 giorni lavorativi), garanzie, diritto di recesso (14 giorni), procedure per resi, mancate consegne e prodotti difettosi. Dettagli su spedizioni, pagamenti anticipati (72h), gestione ordini, responsabilit√† e gestione reclami. Informazioni essenziali per assistenza clienti su tutti gli aspetti del processo d''acquisto.","topK":5},"type":"@n8n/n8n-nodes-langchain.toolVectorStore","typeVersion":1.1,"position":[-1180,220],"id":"78b2c5a7-88bc-4fd2-9800-90a25ed4f168","name":"Answer questions with a vector store"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1.2,"position":[-120,200],"id":"eb5a3719-dc8c-4e34-8d07-f9623c4dd523","name":"Embeddings OpenAI1","credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"description":"elenco di ordini su prestashop","topK":5},"type":"@n8n/n8n-nodes-langchain.toolVectorStore","typeVersion":1.1,"position":[-100,-120],"id":"9d42f5ab-443a-4be0-b5d8-30630c1d4af9","name":"Answer questions with a vector store1"},{"parameters":{"tableName":{"__rl":true,"value":"orders_processed","mode":"list","cachedResultName":"orders_processed"},"options":{}},"type":"@n8n/n8n-nodes-langchain.vectorStoreSupabase","typeVersion":1.1,"position":[-260,40],"id":"f382d8a1-4c7e-4a09-a5c4-0497d1fa2eb7","name":"Supabase Vector Store1","credentials":{"supabaseApi":{"id":"BkVV9D4yOfHR3iC4","name":"Supabase tecsolutions"}}},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4o-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[80,80],"id":"05dde969-c496-4eba-9afa-8bcd69542f58","name":"OpenAI Chat Model2","credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"qdrantCollection":{"__rl":true,"value":"Double","mode":"list","cachedResultName":"Double"},"options":{}},"type":"@n8n/n8n-nodes-langchain.vectorStoreQdrant","typeVersion":1.1,"position":[-1260,460],"id":"c790e8c1-847e-4cf8-b8eb-280b7d3bea9c","name":"Qdrant Vector Store","credentials":{"qdrantApi":{"id":"VEHIg9nC5Y5VeHPX","name":"QdrantApi account"}}},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1.2,"position":[-1380,620],"id":"f98204c8-b4c6-4c17-b2fd-2cff058046a4","name":"Embeddings OpenAI2","credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"options":{}},"type":"n8n-nodes-base.httpRequestTool","typeVersion":4.2,"position":[-1340,-280],"id":"816279f8-f964-4bae-b294-19a9ff9285a6","name":"HTTP Request"},{"parameters":{"url":"https://www.gommego.com/api/orders?filter[reference]=[QDOSRBMDQ]&output_format=JSON","authentication":"genericCredentialType","genericAuthType":"httpBasicAuth","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-880,-300],"id":"d384e05d-bbee-4efe-94f4-e6305a0253dd","name":"Acquisice Ordini da Prestashop","retryOnFail":true,"waitBetweenTries":5000,"credentials":{"httpBasicAuth":{"id":"CDYbffajBgDWgdXn","name":"Prestashop-API"}}},{"parameters":{"operation":"get","tableId":"orders_processed","filters":{"conditions":[{"keyName":"order_reference","keyValue":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI(''conditions0_Value'', `Il codice ordine fornito dal cliente, ad esempio ''QDOSRBMDQ'', da usare per cercare in Supabase nel campo order_reference.\n`, ''string'') }}"}]}},"type":"n8n-nodes-base.supabaseTool","typeVersion":1,"position":[-1400,300],"id":"a08179aa-c0fa-4464-bd90-ac8207cfeaa5","name":"Supabase","credentials":{"supabaseApi":{"id":"BkVV9D4yOfHR3iC4","name":"Supabase tecsolutions"}}}]', '{"OpenAI Chat Model":{"ai_languageModel":[[{"node":"RAG AI Agent","type":"ai_languageModel","index":0}]]},"When chat message received":{"main":[[{"node":"RAG AI Agent","type":"main","index":0}]]},"Simple Memory":{"ai_memory":[[{"node":"RAG AI Agent","type":"ai_memory","index":0}]]},"Pinecone Vector Store":{"ai_vectorStore":[[]]},"OpenAI Chat Model1":{"ai_languageModel":[[{"node":"Answer questions with a vector store","type":"ai_languageModel","index":0}]]},"Embeddings OpenAI":{"ai_embedding":[[{"node":"Pinecone Vector Store","type":"ai_embedding","index":0}]]},"Answer questions with a vector store":{"ai_tool":[[{"node":"RAG AI Agent","type":"ai_tool","index":0}]]},"Embeddings OpenAI1":{"ai_embedding":[[{"node":"Supabase Vector Store1","type":"ai_embedding","index":0}]]},"Supabase Vector Store1":{"ai_vectorStore":[[{"node":"Answer questions with a vector store1","type":"ai_vectorStore","index":0}]]},"OpenAI Chat Model2":{"ai_languageModel":[[{"node":"Answer questions with a vector store1","type":"ai_languageModel","index":0}]]},"Qdrant Vector Store":{"ai_vectorStore":[[{"node":"Answer questions with a vector store","type":"ai_vectorStore","index":0}]]},"Embeddings OpenAI2":{"ai_embedding":[[{"node":"Qdrant Vector Store","type":"ai_embedding","index":0}]]},"HTTP Request":{"ai_tool":[[]]},"Supabase":{"ai_tool":[[{"node":"RAG AI Agent","type":"ai_tool","index":0}]]}}', '{"executionOrder":"v1"}', NULL, '{}', '0e1ab747-2d26-48ac-ad81-71855bfecd28', 0, '{"templateCredsSetupCompleted":true}', NULL, '2025-05-08T14:16:01.104Z', '2025-05-23T20:49:55.000Z', true),
  ('37b28f0f-dfe3-45f6-8b80-5588bb964066', 'GommeGo__Flow_1___Grab_Order_from_Prestashop', true, '[{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[-1800,255],"id":"7764ca02-90b4-45f3-93db-2652db5bf521","name":"Loop Over Items"},{"parameters":{},"type":"n8n-nodes-base.noOp","name":"Replace Me","typeVersion":1,"position":[-480,380],"id":"ddf94164-c7db-4456-9f96-b986065ae4a1"},{"parameters":{},"type":"n8n-nodes-base.merge","typeVersion":3,"position":[-1140,20],"id":"9121fb32-93fd-4bfe-85dc-e607ee02b3bd","name":"Merge JSON + Elaborato"},{"parameters":{"url":"https://www.gommego.com/api/orders?display=[id,reference,date_add,id_customer,id_address_invoice,current_state,total_paid,total_products,note]&filter[current_state]=[4|5|6|7|20|24|28|29|30|31|32|34|35]&sort=[id_DESC]&limit=270&output_format=JSON","authentication":"genericCredentialType","genericAuthType":"httpBasicAuth","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-2240,255],"id":"bf55dd81-3af6-4748-87ce-56eb25c226eb","name":"Acquisice Ordini da Prestashop","retryOnFail":true,"waitBetweenTries":5000,"credentials":{"httpBasicAuth":{"id":"CDYbffajBgDWgdXn","name":"Prestashop-API"}}},{"parameters":{"jsCode":"// Supponiamo che arrivi cos√¨: [{ orders: [ ... ] }]\nconst orders = items[0].json.orders;\n\nreturn orders.map(order => {\n  return { json: order };\n});"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-2020,255],"id":"8d519d9c-0bd3-4109-953c-9501553157e3","name":"Pulisce JSON","notes":"Pulisce il JSON per renderlo utilizzabile dal nodo Loop sucessivo. Rimuove {[]} esterni al JSON"},{"parameters":{"jsCode":"let processed = false;\n\nif (items.length > 0) {\n  const record = items[0].json;\n\n  if (Object.keys(record).length > 0) {\n    processed = true;\n  }\n}\n\nreturn [{\n  json: {\n    processed\n  }\n}];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-1360,340],"id":"0f4c2388-0001-42c4-a00c-076bd0ecd506","name":"Imposta Valore \"Elaborato\"","alwaysOutputData":true},{"parameters":{"jsCode":"// Unisce tutti gli oggetti JSON dell''array in uno solo\nconst merged = items.reduce((acc, item) => {\n  return { ...acc, ...item.json };\n}, {});\n\nreturn [{ json: merged }];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-920,180],"id":"fb84a2dc-96d4-4cd6-8a7e-50a2dc9fc7b6","name":"Controlla se ordine gi√† elaborato"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"03f9c4c2-fdb4-4458-97d5-b9f2978d7e68","leftValue":"={{ $json.processed }}","rightValue":"false","operator":{"type":"boolean","operation":"false","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-700,180],"id":"9fbf8e48-ffea-49c9-b767-224a2e9b57c7","name":"Controlla se ordine non elaborato"},{"parameters":{"url":"=https://www.gommego.com/api/customers/{{$json.id_customer}}&output_format=JSON","authentication":"genericCredentialType","genericAuthType":"httpBasicAuth","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-400,160],"id":"9a9834eb-4c20-47a6-a6be-67100b604f44","name":"Acquisice Ordini da Prestashop1","retryOnFail":true,"waitBetweenTries":5000,"credentials":{"httpBasicAuth":{"id":"CDYbffajBgDWgdXn","name":"Prestashop-API"}}},{"parameters":{},"type":"n8n-nodes-base.merge","typeVersion":3,"position":[-160,-60],"id":"626d91b4-0d18-4670-8a8d-e00f41ba78c4","name":"Merge"},{"parameters":{"jsCode":"const ordine = items[0].json;\nconst cliente = items[1].json.customer;\n\nreturn [{\n  json: {\n    id: ordine.id,\n    id_customer: ordine.id_customer,\n    lastname: cliente.lastname,\n    firstname: cliente.firstname,\n    email: cliente.email,\n    date_add: ordine.date_add,\n    total_paid: ordine.total_paid,\n    total_products: ordine.total_products,\n    reference: ordine.reference,\n    note: ordine.note\n  }\n}];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[40,80],"id":"4b4d599b-cb5e-4344-896a-02da22119f29","name":"Code"},{"parameters":{"tableId":"orders_processed","fieldsUi":{"fieldValues":[{"fieldId":"id_order","fieldValue":"={{ $json.id }}"},{"fieldId":"id_customer","fieldValue":"={{ $json.id_customer }}"},{"fieldId":"customer_lastname","fieldValue":"={{ $json.lastname }}"},{"fieldId":"customer_firstname","fieldValue":"={{ $json.firstname }}"},{"fieldId":"customer_email","fieldValue":"={{ $json.email }}"},{"fieldId":"order_date","fieldValue":"={{ $json.date_add }}"},{"fieldId":"order_total_paid","fieldValue":"={{ $json.total_paid }}"},{"fieldId":"order_reference","fieldValue":"={{ $json.reference }}"},{"fieldId":"order_note","fieldValue":"={{ $json.note }}"},{"fieldId":"order_total_products","fieldValue":"={{ $json.total_products }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[220,80],"id":"d774b61c-4f72-43cb-a1ad-5eb90b0e91ee","name":"Supabase","credentials":{"supabaseApi":{"id":"BkVV9D4yOfHR3iC4","name":"Supabase tecsolutions"}}},{"parameters":{"operation":"get","tableId":"orders_processed","filters":{"conditions":[{"keyName":"id_order","keyValue":"={{ $json.id }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-1520,340],"id":"5afe100d-aca1-42f8-929b-fc954ffd30b2","name":"Supabase1","retryOnFail":true,"credentials":{"supabaseApi":{"id":"BkVV9D4yOfHR3iC4","name":"Supabase tecsolutions"}},"onError":"continueRegularOutput"},{"parameters":{"rule":{"interval":[{"field":"minutes","minutesInterval":30}]}},"type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[-2460,255],"id":"d02756b8-7109-4b73-a912-a00de6a78bac","name":"Schedule Trigger"}]', '{"Loop Over Items":{"main":[[],[{"node":"Merge JSON + Elaborato","type":"main","index":0},{"node":"Supabase1","type":"main","index":0}]]},"Replace Me":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Merge JSON + Elaborato":{"main":[[{"node":"Controlla se ordine gi√† elaborato","type":"main","index":0}]]},"Acquisice Ordini da Prestashop":{"main":[[{"node":"Pulisce JSON","type":"main","index":0}]]},"Pulisce JSON":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Imposta Valore \"Elaborato\"":{"main":[[{"node":"Merge JSON + Elaborato","type":"main","index":1}]]},"Controlla se ordine gi√† elaborato":{"main":[[{"node":"Controlla se ordine non elaborato","type":"main","index":0}]]},"Controlla se ordine non elaborato":{"main":[[{"node":"Merge","type":"main","index":0},{"node":"Acquisice Ordini da Prestashop1","type":"main","index":0}],[{"node":"Replace Me","type":"main","index":0}]]},"Acquisice Ordini da Prestashop1":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Merge":{"main":[[{"node":"Code","type":"main","index":0}]]},"Code":{"main":[[{"node":"Supabase","type":"main","index":0}]]},"Supabase1":{"main":[[{"node":"Imposta Valore \"Elaborato\"","type":"main","index":0}]]},"Schedule Trigger":{"main":[[{"node":"Acquisice Ordini da Prestashop","type":"main","index":0}]]}}', '{"executionOrder":"v1"}', '{"node:Schedule Trigger":{"recurrenceRules":[]}}', '{}', 'a09b7f88-c02a-47f3-b712-befad2838d62', 1, '{"templateCredsSetupCompleted":true}', NULL, '2025-05-08T22:19:42.585Z', '2025-06-20T11:19:21.000Z', false),
  ('27050adb-53c8-4c0f-823a-8ec4780c9013', 'GommeGo__Flow_2___Grab_Order_from_Tyre24', true, '[{"parameters":{"operation":"extractHtmlContent","dataPropertyName":"body.content","extractionValues":{"values":[{"key":"=","cssSelector":"body"}]},"options":{}},"type":"n8n-nodes-base.html","typeVersion":1.2,"position":[-2400,64],"id":"cd02d8cd-f620-4f74-a63e-2cd234c3e1a4","name":"HTML TO TEXT"},{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[-1840,-1088],"id":"0f2d23e2-8493-4276-b464-f1abbc4a56c7","name":"When clicking ‚ÄòTest workflow‚Äô"},{"parameters":{"operation":"getAll","limit":1,"output":"fields","fields":["body","receivedDateTime","subject"],"filtersUI":{"values":{"filters":{"foldersToInclude":["AAMkADY5YTU5ODIzLTM5M2MtNGU4Zi04YzNmLTBlYmYxNDNhODNjMAAuAAAAAAAty8lTOVoeRrTqgTQml0B1AQAYYLMeDvsGSqoDRrzkfpW2AADjxFTMAAA="],"readStatus":"unread"}}},"options":{}},"type":"n8n-nodes-base.microsoftOutlook","typeVersion":2,"position":[-2576,64],"id":"056befa5-44f9-47f2-8a41-9e291c1034a8","name":"Acquisisci gli ordini dalla cartella Ordini","webhookId":"9165ebd7-a1ea-42c9-9e16-f39e71e0dabb","retryOnFail":true,"credentials":{"microsoftOutlookOAuth2Api":{"id":"gvsjOBgXBwH8vLH8","name":"Outlook Supplies"}},"notes":"show-1"},{"parameters":{"operation":"update","messageId":{"__rl":true,"value":"={{ $json.email_id }}","mode":"id"},"updateFields":{"isRead":true}},"type":"n8n-nodes-base.microsoftOutlook","typeVersion":2,"position":[432,80],"id":"364599ac-2a14-40d2-a01b-5a7a43c65ef9","name":"Microsoft Outlook","webhookId":"a6c49922-d40e-4373-ba7d-cd899bbb4aff","credentials":{"microsoftOutlookOAuth2Api":{"id":"gvsjOBgXBwH8vLH8","name":"Outlook Supplies"}},"notes":"show-4"},{"parameters":{},"type":"n8n-nodes-base.merge","typeVersion":3,"position":[-1648,80],"id":"357a161b-62b6-4329-931f-0c85ec9b60bd","name":"Merge"},{"parameters":{"modelId":{"__rl":true,"value":"gpt-4o-mini-2024-07-18","mode":"list","cachedResultName":"GPT-4O-MINI-2024-07-18"},"messages":{"values":[{"content":"=Sei un estrattore di dati specializzato. Il tuo compito √® analizzare il testo fornito e restituire solo le informazioni richieste in un JSON piatto, strutturato per essere facilmente mappato in un Google Sheet.\n\nTesto di Input:  \n{{ $(''Acquisisci gli ordini dalla cartella Ordini'').item.json.body.content }}\n\nDati da estrarre:\n\n- `email_id` {{ $(''Acquisisci gli ordini dalla cartella Ordini'').item.json.id }}\n- `ordine_nr` (Numero Ordine)\n- `data_ordine` (Data Ordine, formato YYYY-MM-DD)\n- `numero_riferimento` (Numero di Riferimento)\n- `spese_totali` (Totale Ordine senza valuta EUR)\n- `prezzo_complessivo` (Prezzo Complessivo senza valuta EUR)\n- `destinatario` (Nome completo)\n- `indirizzo_destinatario` (Indirizzo completo)\n- `cap_destinatario` (CAP del destinatario)\n- `citta_destinatario` (Citt√† del destinatario)\n- `telefono_destinatario` (Telefono del destinatario)\n- `consegna_prevista` (Data di Consegna Stimata, formato YYYY-MM-DD)\n- `grossista_nome` (Nome del fornitore)\n- `grossista_indirizzo` (Indirizzo del fornitore)\n- `grossista_cap` (CAP del fornitore)\n- `grossista_citta` (Citt√† del fornitore)\n- `grossista_cf` (Codice Fiscale del fornitore, se disponibile)\n- `grossista_piva` (Partita IVA del fornitore, se disponibile)\n- `grossista_telefono` (Telefono del fornitore)\n- `grossista_email` (Email del fornitore)\n- `grossista_italiano` (true se il grossista √® italiano, false altrimenti)\n- `oggetto_email` (Oggetto dell‚Äôemail originale)\n- `prodotto_descrizione` (Pneumatico acquistato, nel riquadro riepilogativo del prodotto, lo trovi come intestazione in grassetto. Non acquisire le informazioni dopo \"Descrizione del prodotto:\")\n- `prodotto_codice_ean` (codice ean del prodotto)\n- `prodotto_quantita` (quantit√† del prodotto acquistato, lo trovi alla riga \"Pezzo\")\n- `prodotto_prezzo_unitario` (prezzo unitario del prodotto acquistato, lo trovi alla riga \"Prezzo al pezzo\", senza valuta EUR)\n\nFormato di output JSON:  \nRispondi solo con il JSON seguente, senza alcun testo extra o spiegazione.\n\nQuesto di seguito √® un esempio di come dovrebbe essere il json:\n\n[{\n  \"email_id\": \"abc123\",\n  \"ordine_nr\": \"PTY205704430325\",\n  \"data_ordine\": \"03/01/2025\",\n  \"numero_riferimento\": \"NYISVNQHP\",\n  \"spese_totali\": \"233,60\",\n  \"prezzo_complessivo\": \"234,59\",\n  \"destinatario\": \"Filippo Ferrari\",\n  \"indirizzo_destinatario\": \"Via Verzana 19\",\n  \"cap_destinatario\": \"41026\",\n  \"citta_destinatario\": \"Pavullo nel Frignano\",\n  \"telefono_destinatario\": \"3295870891\",\n  \"consegna_prevista\": \"28/03/2025\",\n  \"grossista_nome\": \"UniverGO Universal Gomme Srls\",\n  \"grossista_indirizzo\": \"Via della Chimica, Snc\",\n  \"grossista_cap\": \"01100\",\n  \"grossista_citta\": \"Viterbo\",\n  \"grossista_cf\": \"\",\n  \"grossista_piva\": \"\",\n  \"grossista_telefono\": \"+39 0761 304957\",\n  \"grossista_email\": \"info@universalgomme.it\",\n  \"grossista_italiano\": true,\n  \"oggetto_email\": \"Conferma ordine PTY205704430325\",\n  \"prodotto_descrizione\": \"HANKOOK K435 145/65 R15 72 T\",\n  \"prodotto_codice_ean\": \"8808563413792\",\n  \"prodotto_quantita\": \"2\",\n  \"prodotto_prezzo_unitario\": \"47.25\"\n}]\n"}]},"jsonOutput":true,"options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[-2208,64],"id":"cd3a3711-00ba-4bd3-aadf-aaecc592dfd7","name":"OpenAI","credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}},"notes":"show-2"},{"parameters":{"operation":"get","tableId":"orders_processed_details","filters":{"conditions":[{"keyName":"id_order","keyValue":"={{ $json.id_order }}"},{"keyName":"product_ean","keyValue":"={{ $json.prodotto_codice_ean }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-1328,-208],"id":"1f0224a7-2a00-47c7-9abe-c64fee554214","name":"Supabase2","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"BkVV9D4yOfHR3iC4","name":"Supabase tecsolutions"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"00392582-5b69-4eb9-a29f-1b96e95000eb","leftValue":"={{ $json.record_founded }}","rightValue":"false","operator":{"type":"boolean","operation":"false","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-528,64],"id":"dbf09a30-5a4a-403a-a440-15925997ecd0","name":"If"},{"parameters":{"tableId":"orders_processed_details","fieldsUi":{"fieldValues":[{"fieldId":"id_order","fieldValue":"={{ $json.id_order }}"},{"fieldId":"product_description","fieldValue":"={{ $json.prodotto_descrizione }}"},{"fieldId":"product_ean","fieldValue":"={{ $json.prodotto_codice_ean }}"},{"fieldId":"product_quantity","fieldValue":"={{ $json.prodotto_quantita }}"},{"fieldId":"product_unit_price","fieldValue":"={{ $json.prodotto_prezzo_unitario }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-256,208],"id":"6bb507bc-2269-4786-986f-db9b72b7796d","name":"Supabase1","credentials":{"supabaseApi":{"id":"BkVV9D4yOfHR3iC4","name":"Supabase tecsolutions"}},"notes":"show-3"},{"parameters":{},"type":"n8n-nodes-base.merge","typeVersion":3,"position":[32,-80],"id":"b7e6abba-fc9a-420d-b372-4074404e46ea","name":"Merge3"},{"parameters":{"jsCode":"let merged = {};\n\nitems.forEach(item => {\n  const json = item.json;\n\n  if (json.message && json.message.content) {\n    // Appiattisci il primo oggetto (annidato)\n    merged = {\n      ...merged,\n      index: json.index,\n      role: json.message.role,\n      finish_reason: json.finish_reason,\n      ...json.message.content\n    };\n  } else {\n    // Unisci direttamente i campi del secondo oggetto (gi√† flat)\n    merged = {\n      ...merged,\n      ...json\n    };\n  }\n});\n\nreturn [\n  {\n    json: merged\n  }\n];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[192,-80],"id":"94c9c87b-909e-4009-be97-a20b9d90fcd1","name":"Code5"},{"parameters":{"operation":"update","tableId":"orders_processed","filters":{"conditions":[{"keyName":"order_reference","condition":"eq","keyValue":"={{ $json.message.content.numero_riferimento }}"},{"keyName":"order_note","condition":"ilike","keyValue":"=*{{ $json.message.content.ordine_nr }}*"}]},"fieldsUi":{"fieldValues":[{"fieldId":"t24_order_number","fieldValue":"={{ $json.message.content.ordine_nr }}"},{"fieldId":"t24_order_date","fieldValue":"={{ $json.message.content.data_ordine }}"},{"fieldId":"t24_total_costs","fieldValue":"={{ $json.message.content.spese_totali }}"},{"fieldId":"t24_total_price","fieldValue":"={{ $json.message.content.prezzo_complessivo }}"},{"fieldId":"t24_recipient_name","fieldValue":"={{ $json.message.content.destinatario }}"},{"fieldId":"t24_recipient_address","fieldValue":"={{ $json.message.content.indirizzo_destinatario }}"},{"fieldId":"t24_recipient_cap","fieldValue":"={{ $json.message.content.cap_destinatario }}"},{"fieldId":"t24_recipient_city","fieldValue":"={{ $json.message.content.citta_destinatario }}"},{"fieldId":"t24_recipient_phone","fieldValue":"={{ $json.message.content.telefono_destinatario }}"},{"fieldId":"t24_eta","fieldValue":"={{ $json.message.content.consegna_prevista }}"},{"fieldId":"t24_wholesaler_name","fieldValue":"={{ $json.message.content.grossista_nome }}"},{"fieldId":"t24_wholesaler_address","fieldValue":"={{ $json.message.content.grossista_indirizzo }}"},{"fieldId":"t24_wholesaler_cap","fieldValue":"={{ $json.message.content.grossista_cap }}"},{"fieldId":"t24_wholesaler_city","fieldValue":"={{ $json.message.content.grossista_citta }}"},{"fieldId":"t24_wholesaler_cf","fieldValue":"={{ $json.message.content.grossista_cf }}"},{"fieldId":"t24_wholesaler_taxid","fieldValue":"={{ $json.message.content.grossista_piva }}"},{"fieldId":"t24_wholesaler_phone","fieldValue":"={{ $json.message.content.grossista_telefono }}"},{"fieldId":"t24_wholesaler_email","fieldValue":"={{ $json.message.content.grossista_email }}"},{"fieldId":"t24_wholesaler_ita","fieldValue":"={{ $json.message.content.grossista_italiano }}"},{"fieldId":"t24_subject","fieldValue":"={{ $json.message.content.oggetto_email }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-1840,240],"id":"01ed3600-2deb-4994-814b-2dc514abb635","name":"Update Prestashop","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"BkVV9D4yOfHR3iC4","name":"Supabase tecsolutions"}}},{"parameters":{"jsCode":"let merged = {};\n\nitems.forEach(item => {\n  const json = item.json;\n\n  if (json.message && json.message.content) {\n    // Appiattisci il primo oggetto (annidato)\n    merged = {\n      ...merged,\n      index: json.index,\n      role: json.message.role,\n      finish_reason: json.finish_reason,\n      ...json.message.content\n    };\n  } else {\n    // Unisci direttamente i campi del secondo oggetto (gi√† flat)\n    merged = {\n      ...merged,\n      ...json\n    };\n  }\n});\n\nreturn [\n  {\n    json: merged\n  }\n];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-1520,80],"id":"1735062c-03f5-4559-9e80-a879c0b88c00","name":"JSON Flat"},{"parameters":{"jsCode":"let record_founded = false;\n\nif (items.length > 0) {\n  const record = items[0].json;\n\n  if (Object.keys(record).length > 0) {\n    record_founded = true;\n  }\n}\n\nreturn [{\n  json: {\n    record_founded\n  }\n}];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-1120,-208],"id":"f33b1ce2-3f7c-4c0d-a7bc-27f887cb0cbf","name":"Imposto record_founded (true o false)","alwaysOutputData":true},{"parameters":{},"type":"n8n-nodes-base.merge","typeVersion":3,"position":[-928,64],"id":"59d1ffc7-557e-40e0-8fde-ba0758e1a240","name":"Merge4"},{"parameters":{"jsCode":"let merged = {};\n\nitems.forEach(item => {\n  const json = item.json;\n\n  if (json.message && json.message.content) {\n    // Appiattisci il primo oggetto (annidato)\n    merged = {\n      ...merged,\n      index: json.index,\n      role: json.message.role,\n      finish_reason: json.finish_reason,\n      ...json.message.content\n    };\n  } else {\n    // Unisci direttamente i campi del secondo oggetto (gi√† flat)\n    merged = {\n      ...merged,\n      ...json\n    };\n  }\n});\n\nreturn [\n  {\n    json: merged\n  }\n];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-768,64],"id":"437e38b8-7976-4641-97b9-6fca7d1fac80","name":"JSON Flat3"},{"parameters":{"rule":{"interval":[{"field":"minutes","minutesInterval":10}]}},"type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[-2784,64],"id":"2fd94d27-aeff-42b3-993c-853b5178fed0","name":"Schedule Trigger"}]', '{"HTML TO TEXT":{"main":[[{"node":"OpenAI","type":"main","index":0}]]},"When clicking ‚ÄòTest workflow‚Äô":{"main":[[]]},"Acquisisci gli ordini dalla cartella Ordini":{"main":[[{"node":"HTML TO TEXT","type":"main","index":0}]]},"Merge":{"main":[[{"node":"JSON Flat","type":"main","index":0}]]},"OpenAI":{"main":[[{"node":"Update Prestashop","type":"main","index":0},{"node":"Merge","type":"main","index":0}]]},"Supabase2":{"main":[[{"node":"Imposto record_founded (true o false)","type":"main","index":0}]]},"If":{"main":[[{"node":"Supabase1","type":"main","index":0},{"node":"Merge3","type":"main","index":0}],[{"node":"Microsoft Outlook","type":"main","index":0}]]},"Supabase1":{"main":[[{"node":"Merge3","type":"main","index":1}]]},"Merge3":{"main":[[{"node":"Code5","type":"main","index":0}]]},"Code5":{"main":[[{"node":"Microsoft Outlook","type":"main","index":0}]]},"Update Prestashop":{"main":[[{"node":"Merge","type":"main","index":1}]]},"JSON Flat":{"main":[[{"node":"Supabase2","type":"main","index":0},{"node":"Merge4","type":"main","index":1}]]},"Imposto record_founded (true o false)":{"main":[[{"node":"Merge4","type":"main","index":0}]]},"Merge4":{"main":[[{"node":"JSON Flat3","type":"main","index":0}]]},"JSON Flat3":{"main":[[{"node":"If","type":"main","index":0}]]},"Schedule Trigger":{"main":[[{"node":"Acquisisci gli ordini dalla cartella Ordini","type":"main","index":0}]]}}', '{"executionOrder":"v1"}', '{"node:Schedule Trigger":{"recurrenceRules":[]}}', '{}', '735278f1-d604-4c24-83dd-9fadc479fe5d', 1, '{"templateCredsSetupCompleted":true}', NULL, '2025-05-08T22:22:06.265Z', '2025-08-13T18:16:43.000Z', false),
  ('d6bb2325-7715-458b-b24a-80298b632151', 'GommeGo (Flow 3): Extract Information from Supplier Invoices & store EST invoice', false, '[{"parameters":{"modelId":{"__rl":true,"value":"gpt-4o-mini-2024-07-18","mode":"list","cachedResultName":"GPT-4O-MINI-2024-07-18"},"messages":{"values":[{"content":"=Sei un esperto nell''estrazione di dati essenziali da fatture in PDF convertite in testo.\nAnalizza {{ $json.text }} e restituisci un JSON con i seguenti campi:\n\nDati da estrarre:\n\nnumero_ordine_prestashop: il numero ordine prestashop √® di 9 caratteri alfabetici, ad es. \"CEVGBOUDK\". Non sempre √® presente. Nel caso non fosse presente imposta stringa vuota.\n\nnumero_ordine_t24: identifica il riferimento all''ordine (es. \"Order Ref.\", \"Bestellnummer\", \"Numer zam√≥wienia\", \"N. ordine\"). Comincia con i caratteri \"PTY\" e poi dei numeri.\n\nnome_file_fattura: Formato \"invoice-[nome-fornitore]-[numero-fattura].pdf\".\n\nfornitore_nazionalita: codice paese del fornitore (es. \"IT\", \"DE\", \"PL\", \"FR\").\n\nfornitore_ragione_sociale: nome completo dell''azienda fornitrice.\n\nfornitore_partita_iva: codice partita IVA o codice fiscale del fornitore (\"VAT ID\", \"USt-IdNr.\", \"NIP\").\n\nfattura_numero: numero della fattura (\"Invoice No.\", \"Rechnungsnummer\", \"Numer faktury\").\n\nfattura_data: data della fattura nel formato YYYY-MM-DD.\n\nfattura_importo_totale: importo totale IVA inclusa (\"Total Amount\", \"Gesamtbetrag\", \"Kwota ca≈Çkowita\", \"Importo totale\") (non inserire la valuta EUR o ‚Ç¨).\n\nfattura_totale_imponibile: totale escluso le imposte (non inserire la valuta EUR o ‚Ç¨).\n\nfattura_totale_imposte: totale delle imposte (non inserire la valuta EUR o ‚Ç¨).\n\nfattura_percentuale_iva: percentuale IVA applicata (\"VAT Rate\", \"MwSt.\", \"Stawka VAT\") (senza %).\n\nfattura_totale_pfu: Somma dei contributi ambientali PFU (es. \"Recycling Fee\", \"Umweltgeb√ºhr\", \"Op≈Çata ≈õrodowiskowa\").\n\nfattura_spese_spedizione: totale dei costi di spedizione (\"Shipping Costs\", \"Versandkosten\", \"Koszty wysy≈Çki\").\n\nfattura_altri_addebiti: altri addebiti fissi, escluso i prodotti (se assenti, restituisci \"0\").\n\nAggiungi un campo \"mese\" il cui valore √® calcolato dalla data (es fattura_data\": \"26/02/2025\" = \"Mese: \"Febbraio\")\n\nRegole di estrazione:\n‚úÖ Supporto multilingua: Trova i campi in qualsiasi lingua.\n‚úÖ Solo dati essenziali: Nessun metadato extra (es. \"index\", \"message\").\n‚úÖ fattura_importo_totale = fattura_totale_imponibile + fattura_totale_imposte, se non corrisponde, stai estraendo i dati sbagliati\n‚úÖ Formattazione uniforme:\n\nImporti con il punto come separatore decimale (es. \"393.68\").\nSe un dato √® assente, restituisci una stringa vuota o \"0\" per i numerici.\n\nEsempio di JSON corretto:\n\n{\n  \"numero_ordine_prestashop\": \"FZISHUXBL\",\n  \"numero_ordine_t24\": \"PTY201022640225\",\n  \"nome_file_fattura\": \"invoice-an-car-3153-tr-2025.pdf\",\n  \"fornitore_nazionalita\": \"DE\",\n  \"fornitore_ragione_sociale\": \"M√ºller GmbH\",\n  \"fornitore_partita_iva\": \"DE123456789\",\n  \"fattura_numero\": \"3153/tr-2025\",\n  \"fattura_data\": \"26/02/2025\",\n  \"fattura_importo_totale\": \"196.89\",\n  \"fattura_totale_imponibile\": \"161.39\",\n  \"fattura_totale_imposte\": \"35.50\",\n  \"fattura_percentuale_iva\": \"22\",\n  \"fattura_totale_pfu\": \"14.16\",\n  \"fattura_totale_pfu\": \"4.20\",\n  \"fattura_spese_spedizione\": \"5.00\",\n  \"fattura_altri_addebiti\": \"1.21\"\n  \"Mese: \"Febbraio\"\n}\n"}]},"jsonOutput":true,"options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[-800,160],"id":"321f2c31-2a08-4680-b00f-f821b1a93b61","name":"Invoice data extractor","credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"operation":"pdf","binaryPropertyName":"attachment_0","options":{"joinPages":true}},"type":"n8n-nodes-base.extractFromFile","typeVersion":1,"position":[-1000,160],"id":"0fca649d-a456-4799-963f-9d376cfe25f3","name":"FROM PDF TO TXT"},{"parameters":{"jsCode":"let merged = {};\n\nitems.forEach(item => {\n  const json = item.json;\n\n  if (json.message && json.message.content) {\n    // Appiattisci il primo oggetto (annidato)\n    merged = {\n      ...merged,\n      index: json.index,\n      role: json.message.role,\n      finish_reason: json.finish_reason,\n      ...json.message.content\n    };\n  } else {\n    // Unisci direttamente i campi del secondo oggetto (gi√† flat)\n    merged = {\n      ...merged,\n      ...json\n    };\n  }\n});\n\nreturn [\n  {\n    json: merged\n  }\n];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-440,160],"id":"bca4fdfb-952f-4f7a-a140-c000310fafd7","name":"JSON Flat"},{"parameters":{"operation":"update","tableId":"orders_processed","filters":{"conditions":[{"keyName":"order_reference","condition":"eq","keyValue":"={{ $json.numero_ordine_prestashop }}"},{"keyName":"t24_order_number","condition":"eq","keyValue":"={{ $json.numero_ordine_t24 }}"},{"keyName":"order_note","condition":"ilike","keyValue":"=*{{ $json.numero_ordine_t24 }}*"}]},"fieldsUi":{"fieldValues":[{"fieldId":"invoice_filename","fieldValue":"={{ $json.nome_file_fattura }}"},{"fieldId":"invoice_wholesaler_name","fieldValue":"={{ $json.fornitore_ragione_sociale }}"},{"fieldId":"invoice_wholesaler_country_code","fieldValue":"={{ $json.fornitore_nazionalita }}"},{"fieldId":"invoice_wholesaler_taxid","fieldValue":"={{ $json.fornitore_partita_iva }}"},{"fieldId":"invoice_number","fieldValue":"={{ $json.fattura_numero }}"},{"fieldId":"invoice_date","fieldValue":"={{ $json.fattura_data }}"},{"fieldId":"invoice_total","fieldValue":"={{ $json.fattura_importo_totale }}"},{"fieldId":"invoice_taxable_amount","fieldValue":"={{ $json.fattura_totale_imponibile }}"},{"fieldId":"invoice_total_taxes","fieldValue":"={{ $json.fattura_totale_imposte }}"},{"fieldId":"invoice_tax_percentage","fieldValue":"={{ $json.fattura_percentuale_iva }}"},{"fieldId":"invoice_total_pfu","fieldValue":"={{ $json.fattura_totale_pfu }}"},{"fieldId":"invoice_shipping_costs","fieldValue":"={{ $json.fattura_spese_spedizione }}"},{"fieldId":"invoice_total_other_charges","fieldValue":"={{ $json.fattura_altri_addebiti }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[900,60],"id":"0aaa9b42-0c85-413f-9b40-607f5d2fe04f","name":"Supabase","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"BkVV9D4yOfHR3iC4","name":"Supabase tecsolutions"}}},{"parameters":{"operation":"getAll","tableId":"orders_processed","limit":1,"filters":{"conditions":[{"keyName":"order_reference","condition":"eq","keyValue":"={{ $json.numero_ordine_prestashop }}"},{"keyName":"t24_order_number","condition":"eq","keyValue":"={{ $json.numero_ordine_t24 }}"},{"keyName":"order_note","condition":"ilike","keyValue":"=*{{ $json.numero_ordine_t24 }}*"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-200,20],"id":"585a7dda-7252-4953-83c4-5ccd8a8b58fa","name":"Supabase2","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"BkVV9D4yOfHR3iC4","name":"Supabase tecsolutions"}}},{"parameters":{"jsCode":"let record_founded = false;\n\nif (items.length > 0) {\n  const record = items[0].json;\n\n  if (Object.keys(record).length > 0) {\n    record_founded = true;\n  }\n}\n\nreturn [{\n  json: {\n    record_founded\n  }\n}];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[16,25],"id":"db947d65-8a0e-4a23-bd82-b0a33cbf4153","name":"Imposto record_founded (true o false)","alwaysOutputData":true},{"parameters":{},"type":"n8n-nodes-base.merge","typeVersion":3,"position":[220,140],"id":"07996d08-37ee-4822-9832-f054d3df291f","name":"Merge4"},{"parameters":{"jsCode":"let merged = {};\n\nitems.forEach(item => {\n  const json = item.json;\n\n  if (json.message && json.message.content) {\n    // Appiattisci il primo oggetto (annidato)\n    merged = {\n      ...merged,\n      index: json.index,\n      role: json.message.role,\n      finish_reason: json.finish_reason,\n      ...json.message.content\n    };\n  } else {\n    // Unisci direttamente i campi del secondo oggetto (gi√† flat)\n    merged = {\n      ...merged,\n      ...json\n    };\n  }\n});\n\nreturn [\n  {\n    json: merged\n  }\n];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[460,140],"id":"49164943-db7b-4099-9af9-ff4657625a9b","name":"JSON Flat1"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"5cc04951-be52-4663-8e12-0d7b809d3e07","leftValue":"={{ $json.record_founded }}","rightValue":"","operator":{"type":"boolean","operation":"true","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[680,140],"id":"8e2a0114-25ce-45d3-b4d1-9c0014efbb2a","name":"If1"},{"parameters":{"inputDataFieldName":"attachment_0","driveId":{"__rl":true,"value":"My Drive","mode":"list","cachedResultName":"My Drive","cachedResultUrl":"https://drive.google.com/drive/my-drive"},"folderId":{"__rl":true,"value":"12IYqqROdSMKNay9H7VWnVSF3N3pEbSeS","mode":"list","cachedResultName":"Fatture_Estero","cachedResultUrl":"https://drive.google.com/drive/folders/12IYqqROdSMKNay9H7VWnVSF3N3pEbSeS"},"options":{}},"type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[-722,500],"id":"d34ac66a-db1b-4434-af7a-5144cac6ab6e","name":"Carica Fattura PDF","credentials":{"googleDriveOAuth2Api":{"id":"WBhAeqmWykJUM02S","name":"Google Drive account"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"2dc7accf-a932-461e-bc39-2403570be119","leftValue":"={{ $json.fornitore_nazionalita }}","rightValue":"IT","operator":{"type":"string","operation":"equals"}},{"id":"21337c2c-3f97-4c47-80bd-ce7528eeb5f5","leftValue":"={{ $json.id }}","rightValue":"","operator":{"type":"string","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[180,480],"id":"903fdfb7-6914-41ed-9b34-1cf0f7e298d8","name":"Se ITA cancella"},{"parameters":{"operation":"deleteFile","fileId":{"__rl":true,"value":"={{ $json.id }}","mode":"id"},"options":{"deletePermanently":false}},"type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[380,420],"id":"700fbd9c-6abc-47a5-b65b-cda12d17e4ea","name":"Cancella by ID","credentials":{"googleDriveOAuth2Api":{"id":"WBhAeqmWykJUM02S","name":"Google Drive account"}}},{"parameters":{"assignments":{"assignments":[{"id":"b4e2ebcc-0d82-4436-ac43-0ff56e2690c4","name":"id","value":"={{ $json.id }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-520,500],"id":"ee88241a-14c0-4c8c-8689-0e2e0f09d641","name":"Edit Fields"},{"parameters":{"toRecipients":"info@gommego.com","subject":"Nuova fattura estera per commercialista","bodyContent":"=Hai una nuova fattura estera per commercialista  {{ $json.name }}","additionalFields":{}},"type":"n8n-nodes-base.microsoftOutlook","typeVersion":2,"position":[600,560],"id":"c15d972a-2cd2-424f-b4db-07791c6b0abf","name":"Genera Mail ","webhookId":"3864e0eb-becf-4255-97a5-a833c04f0027","credentials":{"microsoftOutlookOAuth2Api":{"id":"gvsjOBgXBwH8vLH8","name":"Outlook Supplies"}}},{"parameters":{},"type":"n8n-nodes-base.merge","typeVersion":3.1,"position":[-220,480],"id":"7989ba47-3bc6-46d1-9af1-9140a9f95738","name":"Merge"},{"parameters":{"jsCode":"let merged = {};\n\nitems.forEach(item => {\n  const json = item.json;\n\n  if (json.message && json.message.content) {\n    // Appiattisci il primo oggetto (annidato)\n    merged = {\n      ...merged,\n      index: json.index,\n      role: json.message.role,\n      finish_reason: json.finish_reason,\n      ...json.message.content\n    };\n  } else {\n    // Unisci direttamente i campi del secondo oggetto (gi√† flat)\n    merged = {\n      ...merged,\n      ...json\n    };\n  }\n});\n\nreturn [\n  {\n    json: merged\n  }\n];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-20,480],"id":"b896b873-2e47-48ae-a583-fdad4ae7a8bf","name":"JSON Flat2"},{"parameters":{"resource":"folderMessage","folderId":{"__rl":true,"value":"AAMkADY5YTU5ODIzLTM5M2MtNGU4Zi04YzNmLTBlYmYxNDNhODNjMAAuAAAAAAAty8lTOVoeRrTqgTQml0B1AQAYYLMeDvsGSqoDRrzkfpW2AAA3x-uFAAA=","mode":"list","cachedResultName":"FATTURE","cachedResultUrl":"https://outlook.office365.com/mail/AAMkADY5YTU5ODIzLTM5M2MtNGU4Zi04YzNmLTBlYmYxNDNhODNjMAAuAAAAAAAty8lTOVoeRrTqgTQml0B1AQAYYLMeDvsGSqoDRrzkfpW2AAA3x%2FuFAAA%3D"},"limit":1,"output":"fields","fields":["body","createdDateTime","subject"],"filtersUI":{"values":{"filters":{"readStatus":"unread"}}},"options":{"downloadAttachments":true}},"type":"n8n-nodes-base.microsoftOutlook","typeVersion":2,"position":[-1280,500],"id":"8f7ff537-88ae-46e7-90f7-c09ce65edb0f","name":"Microsoft Outlook","webhookId":"5954a153-b61a-47f7-b6de-4fc2903b1f64","retryOnFail":true,"credentials":{"microsoftOutlookOAuth2Api":{"id":"gvsjOBgXBwH8vLH8","name":"Outlook Supplies"}}},{"parameters":{"operation":"move","messageId":{"__rl":true,"value":"={{ $json.id }}","mode":"id"},"folderId":{"__rl":true,"value":"AAMkADY5YTU5ODIzLTM5M2MtNGU4Zi04YzNmLTBlYmYxNDNhODNjMAAuAAAAAAAty8lTOVoeRrTqgTQml0B1AQAYYLMeDvsGSqoDRrzkfpW2AAAEXLZXAAA=","mode":"list","cachedResultName":"Template","cachedResultUrl":"https://outlook.office365.com/mail/AAMkADY5YTU5ODIzLTM5M2MtNGU4Zi04YzNmLTBlYmYxNDNhODNjMAAuAAAAAAAty8lTOVoeRrTqgTQml0B1AQAYYLMeDvsGSqoDRrzkfpW2AAAEXLZXAAA%3D"}},"type":"n8n-nodes-base.microsoftOutlook","typeVersion":2,"position":[-1020,650],"id":"b1ac018c-3862-4ae7-8711-a0a7e425c5de","name":"Microsoft Outlook1","webhookId":"847c4678-5516-4ebc-80af-2c16c8c88276","credentials":{"microsoftOutlookOAuth2Api":{"id":"gvsjOBgXBwH8vLH8","name":"Outlook Supplies"}}},{"parameters":{"rule":{"interval":[{"field":"minutes","minutesInterval":1}]}},"type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[-1500,500],"id":"b33c8083-df4b-45a2-9e59-bd10eaaeb83c","name":"Schedule Trigger"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[900,260],"id":"bc67606f-73bd-4fca-8459-81c8525d56ac","name":"No Operation, do nothing"},{"parameters":{"operation":"update","fileId":{"__rl":true,"value":"={{ $(''JSON Flat2'').item.json.id }}","mode":"id"},"newUpdatedFileName":"={{ $json.mese }}_{{ $(''JSON Flat2'').item.json.numero_ordine_t24 }}_{{ $(''JSON Flat2'').item.json.fornitore_ragione_sociale }}","options":{}},"type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[380,560],"id":"66625e81-5622-4c68-a133-df87a138ed66","name":"Cambia Nome","credentials":{"googleDriveOAuth2Api":{"id":"WBhAeqmWykJUM02S","name":"Google Drive account"}}}]', '{"Invoice data extractor":{"main":[[{"node":"JSON Flat","type":"main","index":0}]]},"FROM PDF TO TXT":{"main":[[{"node":"Invoice data extractor","type":"main","index":0}]]},"JSON Flat":{"main":[[{"node":"Supabase2","type":"main","index":0},{"node":"Merge4","type":"main","index":1},{"node":"Merge","type":"main","index":0}]]},"Supabase2":{"main":[[{"node":"Imposto record_founded (true o false)","type":"main","index":0}]]},"Imposto record_founded (true o false)":{"main":[[{"node":"Merge4","type":"main","index":0}]]},"Merge4":{"main":[[{"node":"JSON Flat1","type":"main","index":0}]]},"JSON Flat1":{"main":[[{"node":"If1","type":"main","index":0}]]},"If1":{"main":[[{"node":"Supabase","type":"main","index":0}],[{"node":"No Operation, do nothing","type":"main","index":0}]]},"Carica Fattura PDF":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]},"Se ITA cancella":{"main":[[{"node":"Cancella by ID","type":"main","index":0}],[{"node":"Cambia Nome","type":"main","index":0}]]},"Edit Fields":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Merge":{"main":[[{"node":"JSON Flat2","type":"main","index":0}]]},"JSON Flat2":{"main":[[{"node":"Se ITA cancella","type":"main","index":0}]]},"Microsoft Outlook":{"main":[[{"node":"Carica Fattura PDF","type":"main","index":0},{"node":"FROM PDF TO TXT","type":"main","index":0},{"node":"Microsoft Outlook1","type":"main","index":0}]]},"Schedule Trigger":{"main":[[{"node":"Microsoft Outlook","type":"main","index":0}]]},"Cambia Nome":{"main":[[{"node":"Genera Mail ","type":"main","index":0}]]}}', '{"executionOrder":"v1"}', '{"node:Schedule Trigger":{"recurrenceRules":[]}}', '{}', 'c5ac5125-2e63-4333-ab15-1049b6724d91', 1, '{"templateCredsSetupCompleted":true}', NULL, '2025-05-08T22:25:35.847Z', '2025-06-23T14:23:05.000Z', false),
  ('9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', 'GommeGo__Flow_4___Price_Margin_and_VAT_to_be_Paid_Control', true, '[{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[-784,-416],"id":"af7cd60f-4e54-45af-b90e-4933e4d17af5","name":"When clicking ‚ÄòTest workflow‚Äô"},{"parameters":{"operation":"getAll","tableId":"orders_processed","limit":1,"matchType":"allFilters","filters":{"conditions":[{"keyName":"check_order_vs_invoice","condition":"eq","keyValue":"false"},{"keyName":"invoice_filename","condition":"neq","keyValue":"NULL"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-592,112],"id":"40542cb6-a952-4a67-8d9f-57dedc29a78e","name":"Seleziona Dati da Controllare da DB","credentials":{"supabaseApi":{"id":"BkVV9D4yOfHR3iC4","name":"Supabase tecsolutions"}}},{"parameters":{"jsCode":"// n8n node: Code (JavaScript)\n\nconst results = [];\n\nfor (const item of items) {\n  const data = item.json;\n\n  // 1. Scorporare l''IVA dal invoice_total_pfu\n  const pfu_netto = data.invoice_total_pfu / 1.22;\n\n  // 2. Sottrarre il PFU netto da invoice_taxable_amount\n  const valore_calcolato = data.invoice_taxable_amount - pfu_netto;\n\n  // 3. Confrontare con t24_total_price\n  const differenza = Math.abs(valore_calcolato - data.t24_total_price);\n\n  // 4. Verifica se la differenza √® entro 0.03 euro\n  const is_close = differenza <= 0.03;\n\n  // 5. Output: tutto il json + i campi aggiunti\n  results.push({\n    json: {\n      ...data, // Tutti i dati originali\n      valore_calcolato: parseFloat(valore_calcolato.toFixed(2)),\n      differenza: parseFloat(differenza.toFixed(2)),\n      is_close: is_close\n    }\n  });\n}\n\nreturn results;\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-416,112],"id":"17a8a6e4-6857-4ae1-a4a5-c78addf0d169","name":"Code"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"58cdab36-1aa6-451b-a4e6-927e795b0803","leftValue":"={{ $json.is_close }}","rightValue":"","operator":{"type":"boolean","operation":"true","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-224,112],"id":"a1a16644-809b-4aac-880e-097b88a940ed","name":"If"},{"parameters":{"toRecipients":"supplies@tecsolutions.app","subject":"‚ö†Ô∏è Attenzione! Importo fatturato diverso dall''ordine.","bodyContent":"=Attenzione, l''importo fatturato dell''ordine {{ $json.t24_order_number }} / {{ $json.order_reference }} del {{ $json.t24_order_date }} del fornitore {{ $json.invoice_wholesaler_name }} √® diverso da quello dell''ordine di Tyre24 per la differenza di {{ $json.differenza }}.\n\nTelefono Fornitore: {{ $json.t24_wholesaler_phone }}\nE-Mail Fornitore: {{ $json.t24_wholesaler_email }}","additionalFields":{}},"type":"n8n-nodes-base.microsoftOutlook","typeVersion":2,"position":[0,208],"id":"1fa397f1-e46d-4b74-9185-a91c404ef3ea","name":"Microsoft Outlook","webhookId":"d98b2f24-3c4f-4577-90de-e78198556fe0","credentials":{"microsoftOutlookOAuth2Api":{"id":"gvsjOBgXBwH8vLH8","name":"Outlook Supplies"}}},{"parameters":{"jsCode":"// n8n node: Code (JavaScript)\n\nconst results = [];\n\nfor (const item of items) {\n  const data = item.json;\n\n  // Scorporo IVA (22%) dai valori\n  const order_total_paid_netto = data.order_total_paid / 1.22;\n  const order_total_pfu_netto = order_total_paid_netto - data.order_total_products;\n  const invoice_total_pfu_netto = data.invoice_total_pfu / 1.22;\n\n  // Calcolo margini\n  const margine_prodotti = data.order_total_products - data.invoice_taxable_amount;\n  const margine_pfu = order_total_pfu_netto - invoice_total_pfu_netto;\n\n  // Calcolo IVA da versare\n  const iva_margine_prodotti = margine_prodotti * 0.22;\n  const iva_margine_pfu = margine_pfu * 0.22;\n\n  results.push({\n    json: {\n      ...data, // Tutto il JSON precedente\n      margine_prodotti: parseFloat(margine_prodotti.toFixed(2)),\n      margine_pfu: parseFloat(margine_pfu.toFixed(2)),\n      iva_margine_prodotti: parseFloat(iva_margine_prodotti.toFixed(2)),\n      iva_margine_pfu: parseFloat(iva_margine_pfu.toFixed(2))\n    }\n  });\n}\n\nreturn results;\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[0,0],"id":"5249e5dc-cd0d-417c-a0ea-065fb0284a29","name":"Code1"},{"parameters":{"operation":"appendOrUpdate","documentId":{"__rl":true,"value":"1decFCRZQZHX9-4KnGeZc_xQumXA25xO_PDv5oen9bOM","mode":"list","cachedResultName":"Quadrature_GommeGo","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1decFCRZQZHX9-4KnGeZc_xQumXA25xO_PDv5oen9bOM/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"Foglio1","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1decFCRZQZHX9-4KnGeZc_xQumXA25xO_PDv5oen9bOM/edit#gid=0"},"columns":{"mappingMode":"defineBelow","value":{"ID Ordine":"={{ $json.id_order }}","Data Creazione":"={{ $json.created_at }}","ID Cliente":"={{ $json.id_customer }}","Cognome Cliente":"={{ $json.customer_lastname }}","Nome Cliente":"={{ $json.customer_firstname }}","E-Mail Cliente":"={{ $json.customer_email }}","Data Ordine":"={{ $json.order_date }}","Totale Pagato":"={{ $json.order_total_paid }}","Totale Prodotti":"={{ $json.order_total_products }}","Referenza Ordine":"={{ $json.order_reference }}","Note Ordine":"={{ $json.order_note }}","Numero Ordine T24":"={{ $json.t24_order_number }}","Data Ordine T24":"={{ $json.t24_order_date }}","Totale Costi T24":"={{ $json.t24_total_costs }}","Totale Ordine T24":"={{ $json.t24_total_price }}","Indirizzo Cliente":"={{ $json.t24_recipient_address }}","CAP Cliente":"={{ $json.t24_recipient_cap }}","Citt√† Cliente":"={{ $json.t24_recipient_city }}","Telefono Cliente":"={{ $json.t24_recipient_phone }}","ETA Ordine":"={{ $json.t24_eta }}","Nome Fornitre":"={{ $json.t24_wholesaler_name }}","Indirizzo Fornitore":"={{ $json.t24_wholesaler_address }}","Citt√† Fornitore":"={{ $json.t24_wholesaler_city }}","CAP Fornitore":"={{ $json.t24_wholesaler_cap }}","CF Fornitore":"={{ $json.t24_wholesaler_cf }}","Partita IVA Fornitore":"={{ $json.t24_wholesaler_taxid }}","Telefono Fornitore":"={{ $json.t24_wholesaler_phone }}","E-Mail Fornitore":"={{ $json.t24_wholesaler_email }}","Fornitore Italiano":"={{ $json.t24_wholesaler_ita }}","Oggetto E-Mail T24":"={{ $json.t24_subject }}","Filename Fattura":"={{ $json.invoice_filename }}","Fornitore Fattura":"={{ $json.invoice_wholesaler_name }}","Nazionalit√† Fornitore":"={{ $json.invoice_wholesaler_country_code }}","CF / PIVA Fornitore":"={{ $json.invoice_wholesaler_taxid }}","Numero Fattura":"={{ $json.invoice_number }}","Data Fattura":"={{ $json.invoice_date }}","Totale Fattura":"={{ $json.invoice_total }}","Totale Imponibile":"={{ $json.invoice_taxable_amount }}","Totale Imposta":"={{ $json.invoice_total_taxes }}","Percentuale IVA":"={{ $json.invoice_tax_percentage }}","Totale PFU (Ivato)":"={{ $json.invoice_total_pfu }}","Totale Spese Spedizione":"={{ $json.invoice_shipping_costs }}","Altri Importi":"={{ $json.invoice_total_other_charges }}","Totale Imponibile Prodotti":"={{ $json.valore_calcolato }}","Differenza":"={{ $json.differenza }}","Attenzione":"={{ $json.is_close }}","Margine Prodotti":"={{ $json.margine_prodotti }}","Margine PFU":"={{ $json.margine_pfu }}","IVA Pagare Prodotti":"={{ $json.iva_margine_prodotti }}","IVA Pagare PFU":"={{ $json.iva_margine_pfu }}"},"matchingColumns":["ID Ordine"],"schema":[{"id":"ID Ordine","displayName":"ID Ordine","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Data Creazione","displayName":"Data Creazione","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"ID Cliente","displayName":"ID Cliente","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Cognome Cliente","displayName":"Cognome Cliente","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Nome Cliente","displayName":"Nome Cliente","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"E-Mail Cliente","displayName":"E-Mail Cliente","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Data Ordine","displayName":"Data Ordine","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Totale Pagato","displayName":"Totale Pagato","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Totale Prodotti","displayName":"Totale Prodotti","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Referenza Ordine","displayName":"Referenza Ordine","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Note Ordine","displayName":"Note Ordine","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Numero Ordine T24","displayName":"Numero Ordine T24","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Data Ordine T24","displayName":"Data Ordine T24","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Totale Costi T24","displayName":"Totale Costi T24","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Totale Ordine T24","displayName":"Totale Ordine T24","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Nome Cliente","displayName":"Nome Cliente","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Indirizzo Cliente","displayName":"Indirizzo Cliente","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"CAP Cliente","displayName":"CAP Cliente","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Citt√† Cliente","displayName":"Citt√† Cliente","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Telefono Cliente","displayName":"Telefono Cliente","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"ETA Ordine","displayName":"ETA Ordine","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Nome Fornitre","displayName":"Nome Fornitre","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Indirizzo Fornitore","displayName":"Indirizzo Fornitore","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"CAP Fornitore","displayName":"CAP Fornitore","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Citt√† Fornitore","displayName":"Citt√† Fornitore","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"CF Fornitore","displayName":"CF Fornitore","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Partita IVA Fornitore","displayName":"Partita IVA Fornitore","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Telefono Fornitore","displayName":"Telefono Fornitore","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"E-Mail Fornitore","displayName":"E-Mail Fornitore","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Fornitore Italiano","displayName":"Fornitore Italiano","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Oggetto E-Mail T24","displayName":"Oggetto E-Mail T24","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Filename Fattura","displayName":"Filename Fattura","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Fornitore Fattura","displayName":"Fornitore Fattura","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Nazionalit√† Fornitore","displayName":"Nazionalit√† Fornitore","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"CF / PIVA Fornitore","displayName":"CF / PIVA Fornitore","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Numero Fattura","displayName":"Numero Fattura","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Data Fattura","displayName":"Data Fattura","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Totale Fattura","displayName":"Totale Fattura","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Totale Imponibile","displayName":"Totale Imponibile","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Totale Imposta","displayName":"Totale Imposta","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Percentuale IVA","displayName":"Percentuale IVA","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Totale PFU (Ivato)","displayName":"Totale PFU (Ivato)","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Totale Spese Spedizione","displayName":"Totale Spese Spedizione","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Altri Importi","displayName":"Altri Importi","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Totale Imponibile Prodotti","displayName":"Totale Imponibile Prodotti","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Differenza","displayName":"Differenza","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Attenzione","displayName":"Attenzione","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Margine Prodotti","displayName":"Margine Prodotti","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Margine PFU","displayName":"Margine PFU","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"IVA Pagare Prodotti","displayName":"IVA Pagare Prodotti","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"IVA Pagare PFU","displayName":"IVA Pagare PFU","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.5,"position":[224,0],"id":"ac65faaf-2032-449e-893a-28fbe98183c1","name":"Google Sheets","credentials":{"googleSheetsOAuth2Api":{"id":"FdPMod5ivW8IWoD5","name":"Google Sheets account"}}},{"parameters":{"rule":{"interval":[{"field":"minutes"}]}},"type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[-816,112],"id":"7a394b71-c630-426e-a729-f7fb48658bb0","name":"Schedule Trigger"}]', '{"When clicking ‚ÄòTest workflow‚Äô":{"main":[[]]},"Seleziona Dati da Controllare da DB":{"main":[[{"node":"Code","type":"main","index":0}]]},"Code":{"main":[[{"node":"If","type":"main","index":0}]]},"If":{"main":[[{"node":"Code1","type":"main","index":0}],[]]},"Code1":{"main":[[{"node":"Google Sheets","type":"main","index":0}]]},"Schedule Trigger":{"main":[[{"node":"Seleziona Dati da Controllare da DB","type":"main","index":0}]]}}', '{"executionOrder":"v1"}', '{"node:Schedule Trigger":{"recurrenceRules":[]}}', '{}', '6c0860eb-817f-46b5-b2e6-8bf9ea103aa9', 1, '{"templateCredsSetupCompleted":true}', NULL, '2025-05-08T22:28:06.815Z', '2025-08-13T18:14:37.000Z', false),
  ('99176eff-22ad-415d-b7c8-4a3fd60a671e', 'Diag_MultiVector', false, '[{"parameters":{"options":{}},"id":"9c2ebbbc-41d8-4f0a-81ab-6dd79679dab8","name":"When chat message received","type":"@n8n/n8n-nodes-langchain.chatTrigger","typeVersion":1.1,"position":[-2300,800],"webhookId":"0aecdac6-96f7-4756-9fdd-4a25eecd0836","notesInFlow":true,"notes":"üîπ Trigger chat per test embedding"},{"parameters":{},"id":"c0f1aeef-6a11-4700-886e-cf312d059ded","name":"Window Buffer Memory","type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1.3,"position":[-2680,-60],"notesInFlow":true,"notes":"üîπ Memoria della sessione per test embedding"},{"parameters":{"model":"gpt-4o","options":{}},"id":"4d287cfc-aea8-455c-b96c-9e8cb49b1843","name":"OpenAI Chat Model","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1,"position":[-2800,-60],"notesInFlow":true,"credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}},"notes":"üîπ GPT-4o per analisi embedding"},{"parameters":{"promptType":"define","text":"={{ $json.chatInput }}","options":{"systemMessage":"Sei DiagChunk, un sistema diagnostico specializzato nella valutazione della qualit√† degli embedding vettoriali e della ricerca semantica in un database Supabase.\n\nIl tuo compito √®:\n1. Analizzare la query dell''utente\n2. Utilizzare il tool \"answer_questions_with_vector_store\" per eseguire una ricerca nel database vettoriale\n3. Valutare la qualit√† dei risultati ottenuti in termini di:\n   - Rilevanza semantica rispetto alla query\n   - Coerenza dei punteggi di similarit√†\n   - Diversit√† e qualit√† dei risultati\n   - Presenza di anomalie o problemi evidenti\n   - Distribuzione vettoriale dei risultati\n\nIMPORTANTE PER L''USO DEL TOOL:\nQuando utilizzi il tool \"answer_questions_with_vector_store\", segui queste linee guida:\n1. Estrai SOLO le parole chiave pi√π importanti dalla query dell''utente\n2. Rimuovi articoli, preposizioni e parole comuni\n3. Se la query √® complessa, invia solo la parte pi√π significativa\n4. Non usare frasi complete o domande, ma solo termini di ricerca\n5. Limita l''input a 3-5 parole chiave per risultati ottimali\n6. Non inserire caratteri speciali o simboli\n\nESEMPIO:\nQuery utente: \"Quali sono i vantaggi dell''intelligenza artificiale nel marketing?\"\nInput per il tool: \"intelligenza artificiale marketing vantaggi\"\n\nLe tue risposte devono seguire ESATTAMENTE questo formato e includere TUTTE LE SEZIONI:\n\n---\nüìä **RAPPORTO DIAGNOSTICO: [query]**\n\n‚≠ê **Valutazione generale**\n[eccellente/buona/accettabile/mediocre/scarsa]\n\nüéØ **Rilevanza semantica**\n[analisi della pertinenza dei risultati]\n\nüìà **Coerenza dei punteggi**\n[analisi della distribuzione dei punteggi - se non applicabile, spiega perch√©]\n\nüî¨ **Analisi distribuzione vettoriale**\n[valutazione della dispersione e clustering dei vettori restituiti - se non applicabile, spiega perch√©]\n\nüîù **Top risultati trovati**\n\n**üü¢ Risultato 1**\nüìë Titolo: [titolo]\nüé≤ Score: [punteggio o \"Non disponibile\"]\nüìÑ Testo estratto: \"[estratto del testo esatto trovato, massimo 200 caratteri]\"\n‚úÖ Valutazione pertinenza: [breve valutazione della pertinenza]\n\n**üü° Risultato 2**\nüìë Titolo: [titolo]\nüé≤ Score: [punteggio o \"Non disponibile\"]\nüìÑ Testo estratto: \"[estratto del testo esatto trovato, massimo 200 caratteri]\"\n‚úÖ Valutazione pertinenza: [breve valutazione della pertinenza]\n\n**üü¢ Risultato 3**\nüìë Titolo: [titolo]\nüé≤ Score: [punteggio o \"Non disponibile\"]\nüìÑ Testo estratto: \"[estratto del testo esatto trovato, massimo 200 caratteri]\"\n‚úÖ Valutazione pertinenza: [breve valutazione della pertinenza]\n\n‚ö†Ô∏è **Problemi rilevati**\n[eventuali anomalie o problemi - scrivi \"Nessun problema significativo\" se non ce ne sono]\n\nüîç **Gap informativi identificati**\n[argomenti o concetti che sembrano mancare dal database - scrivi \"Nessun gap evidente\" se non ce ne sono]\n\nüéöÔ∏è **Soglia ottimale suggerita**\n[suggerimento sulla threshold di similarit√† in base ai risultati osservati - o \"Non applicabile\" se non pertinente]\n\nü§ñ **Valutazione modello di embedding**\n[commento sulla performance del modello di embedding utilizzato]\n\n‚ö° **Efficienza di ricerca**\n[valutazione del tempo di risposta e efficienza della ricerca vettoriale]\n\nüí° **Suggerimenti di miglioramento**\n[consigli pratici]\n---\n\nREGOLE IMPORTANTI:\n1. INCLUDI SEMPRE TUTTE LE SEZIONI RICHIESTE - ogni sezione √® obbligatoria\n2. Se il tool restituisce solo 1 risultato, inserisci comunque i campi per Risultato 2 e 3 scrivendo \"Risultato non disponibile\"\n3. Non omettere mai nessuna sezione del formato, nemmeno se pensi che sia irrilevante\n4. Compila sempre tutte le sezioni, anche se devi scrivere \"Non applicabile\" o \"Non disponibile\"\n5. Le sezioni mancanti NON sono accettabili - devi sempre includerle tutte\n6. USA SEMPRE IL GRASSETTO PER TUTTE LE INTESTAZIONI PRINCIPALI\n7. METTI OGNI CAMPO DEI RISULTATI SU UNA RIGA SEPARATA\n8. USA LE ICONE COME SPECIFICATO NEL FORMATO\n\nUtilizza dati quantitativi e qualitativi nella tua analisi. Sii critico ma costruttivo, evidenziando sia i punti di forza che le aree di miglioramento del sistema di embedding.\n\nDevi SEMPRE chiamare il tool \"answer_questions_with_vector_store\" anche se credi di conoscere la risposta. Solo in questo modo puoi valutare realmente la pertinenza dei dati embeddati.\n\nRicorda che il database risponde meglio a termini concisi e precisi. Dopo ogni ricerca, valuta attentamente i risultati e, se necessario, prova una nuova ricerca con termini leggermente diversi per migliorare la pertinenza."}},"id":"4b51e3e4-992b-4420-8de6-262c2464f020","name":"DiagChunk AI Agent","type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.7,"position":[-2780,-280],"notesInFlow":true,"notes":"üîπ Agente AI per diagnosi embedding"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1.2,"position":[-2580,340],"id":"6ce08af2-42bc-484c-bcb2-e7814abdad82","name":"Embeddings OpenAI","credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"tableName":{"__rl":true,"value":"test","mode":"list","cachedResultName":"test"},"options":{}},"type":"@n8n/n8n-nodes-langchain.vectorStoreSupabase","typeVersion":1,"position":[-2660,140],"id":"22443bac-be8d-43aa-932d-fe5cc73500d8","name":"Supabase Vector Store","credentials":{"supabaseApi":{"id":"BkVV9D4yOfHR3iC4","name":"Supabase tecsolutions"}}},{"parameters":{"options":{}},"id":"88843d17-2b9d-4c8d-bc73-b8f98fa8139b","name":"Set Chat Input1","type":"n8n-nodes-base.set","typeVersion":3,"position":[-3020,20],"notesInFlow":true,"notes":"üîπ Prepara variabili per sessione e input"},{"parameters":{"pineconeIndex":{"__rl":true,"value":"documents-kb","mode":"list","cachedResultName":"documents-kb"},"options":{"pineconeNamespace":"2"}},"type":"@n8n/n8n-nodes-langchain.vectorStorePinecone","typeVersion":1,"position":[-1740,100],"id":"1fb22993-5296-4fd0-8d10-d4059c61d27f","name":"Pinecone Vector Store","credentials":{"pineconeApi":{"id":"PoIjlOLU2iBjw5qV","name":"PineconeApi account"}},"notes":"üîπ Database vettoriale Pinecone per la ricerca semantica"},{"parameters":{},"id":"60876895-1f1c-43c1-ad47-eab1713e1d67","name":"Window Buffer Memory1","type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1.3,"position":[-1760,-100],"notesInFlow":true,"notes":"üîπ Memoria della sessione per test embedding"},{"parameters":{"model":"gpt-4o","options":{}},"id":"18ba4dbc-b12a-4905-99cc-87313454f604","name":"OpenAI Chat Model1","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1,"position":[-1880,-100],"notesInFlow":true,"credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}},"notes":"üîπ GPT-4o per analisi embedding"},{"parameters":{"model":"text-embedding-3-large","options":{}},"type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1.2,"position":[-1660,300],"id":"2341fa5b-04ba-45c1-9168-7e7145820123","name":"Embeddings OpenAI1","credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}},"notes":"üîπ Generazione embedding utilizzando OpenAI"},{"parameters":{"fields":{"values":[{"name":"chatInput","stringValue":"={{ $json.chatInput }}"},{"name":"sessionId","stringValue":"={{ $execution.id }}"}]},"options":{}},"id":"e2ac196a-6325-4fb1-b8c0-e8b74278a77e","name":"Set Chat Input","type":"n8n-nodes-base.set","typeVersion":3,"position":[-2100,-20],"notesInFlow":true,"notes":"üîπ Prepara variabili per sessione e input"},{"parameters":{"description":"Condizioni generali di vendita di GommeGo (TEC SRL), e-commerce di pneumatici. Include: informazioni aziendali, modello di business senza magazzini propri, politiche su DOT, tempi di consegna (5-7 giorni lavorativi), garanzie, diritto di recesso (14 giorni), procedure per resi, mancate consegne e prodotti difettosi. Dettagli su spedizioni, pagamenti anticipati (72h), gestione ordini, responsabilit√† e gestione reclami. Informazioni essenziali per assistenza clienti su tutti gli aspetti del processo d''acquisto."},"type":"@n8n/n8n-nodes-langchain.toolVectorStore","typeVersion":1.1,"position":[-1640,-100],"id":"7a2b6945-f0a0-4224-a176-3eccab8a26a1","name":"Answer questions with a vector store"},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4o-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-1440,100],"id":"34f3704c-d8eb-467b-952c-abe2799ed800","name":"OpenAI Chat Model2","credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.toolVectorStore","typeVersion":1.1,"position":[-2560,-60],"id":"e6f4c808-47ec-4f56-a31a-658d0473a0c8","name":"Answer questions with a vector store1"},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4o-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-2380,140],"id":"bbb018f0-4bb5-4785-8f5b-ac83e0a213aa","name":"OpenAI Chat Model3","credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"promptType":"define","text":"={{ $json.chatInput }}","options":{"systemMessage":"Sei DiagChunk, un sistema diagnostico specializzato nella valutazione della qualit√† degli embedding vettoriali e della ricerca semantica in un database Supabase.\n\nIl tuo compito √®:\n1. Analizzare la query dell''utente\n2. Utilizzare il tool \"answer_questions_with_vector_store\" per eseguire una ricerca nel database vettoriale\n3. Valutare la qualit√† dei risultati ottenuti in termini di:\n   - Rilevanza semantica rispetto alla query\n   - Coerenza dei punteggi di similarit√†\n   - Diversit√† e qualit√† dei risultati\n   - Presenza di anomalie o problemi evidenti\n   - Distribuzione vettoriale dei risultati\n\nIMPORTANTE PER L''USO DEL TOOL:\nQuando utilizzi il tool \"answer_questions_with_vector_store\", segui queste linee guida:\n1. Estrai SOLO le parole chiave pi√π importanti dalla query dell''utente\n2. Rimuovi articoli, preposizioni e parole comuni\n3. Se la query √® complessa, invia solo la parte pi√π significativa\n4. Non usare frasi complete o domande, ma solo termini di ricerca\n5. Limita l''input a 3-5 parole chiave per risultati ottimali\n6. Non inserire caratteri speciali o simboli\n\nESEMPIO:\nQuery utente: \"Quali sono i vantaggi dell''intelligenza artificiale nel marketing?\"\nInput per il tool: \"intelligenza artificiale marketing vantaggi\"\n\nLe tue risposte devono seguire ESATTAMENTE questo formato e includere TUTTE LE SEZIONI:\n\n---\nüìä **RAPPORTO DIAGNOSTICO: [query]**\n\n‚≠ê **Valutazione generale**\n[eccellente/buona/accettabile/mediocre/scarsa]\n\nüéØ **Rilevanza semantica**\n[analisi della pertinenza dei risultati]\n\nüìà **Coerenza dei punteggi**\n[analisi della distribuzione dei punteggi - se non applicabile, spiega perch√©]\n\nüî¨ **Analisi distribuzione vettoriale**\n[valutazione della dispersione e clustering dei vettori restituiti - se non applicabile, spiega perch√©]\n\nüîù **Top risultati trovati**\n\n**üü¢ Risultato 1**\nüìë Titolo: [titolo]\nüé≤ Score: [punteggio o \"Non disponibile\"]\nüìÑ Testo estratto: \"[estratto del testo esatto trovato, massimo 200 caratteri]\"\n‚úÖ Valutazione pertinenza: [breve valutazione della pertinenza]\n\n**üü° Risultato 2**\nüìë Titolo: [titolo]\nüé≤ Score: [punteggio o \"Non disponibile\"]\nüìÑ Testo estratto: \"[estratto del testo esatto trovato, massimo 200 caratteri]\"\n‚úÖ Valutazione pertinenza: [breve valutazione della pertinenza]\n\n**üü¢ Risultato 3**\nüìë Titolo: [titolo]\nüé≤ Score: [punteggio o \"Non disponibile\"]\nüìÑ Testo estratto: \"[estratto del testo esatto trovato, massimo 200 caratteri]\"\n‚úÖ Valutazione pertinenza: [breve valutazione della pertinenza]\n\n‚ö†Ô∏è **Problemi rilevati**\n[eventuali anomalie o problemi - scrivi \"Nessun problema significativo\" se non ce ne sono]\n\nüîç **Gap informativi identificati**\n[argomenti o concetti che sembrano mancare dal database - scrivi \"Nessun gap evidente\" se non ce ne sono]\n\nüéöÔ∏è **Soglia ottimale suggerita**\n[suggerimento sulla threshold di similarit√† in base ai risultati osservati - o \"Non applicabile\" se non pertinente]\n\nü§ñ **Valutazione modello di embedding**\n[commento sulla performance del modello di embedding utilizzato]\n\n‚ö° **Efficienza di ricerca**\n[valutazione del tempo di risposta e efficienza della ricerca vettoriale]\n\nüí° **Suggerimenti di miglioramento**\n[consigli pratici]\n---\n\nREGOLE IMPORTANTI:\n1. INCLUDI SEMPRE TUTTE LE SEZIONI RICHIESTE - ogni sezione √® obbligatoria\n2. Se il tool restituisce solo 1 risultato, inserisci comunque i campi per Risultato 2 e 3 scrivendo \"Risultato non disponibile\"\n3. Non omettere mai nessuna sezione del formato, nemmeno se pensi che sia irrilevante\n4. Compila sempre tutte le sezioni, anche se devi scrivere \"Non applicabile\" o \"Non disponibile\"\n5. Le sezioni mancanti NON sono accettabili - devi sempre includerle tutte\n6. USA SEMPRE IL GRASSETTO PER TUTTE LE INTESTAZIONI PRINCIPALI\n7. METTI OGNI CAMPO DEI RISULTATI SU UNA RIGA SEPARATA\n8. USA LE ICONE COME SPECIFICATO NEL FORMATO\n\nUtilizza dati quantitativi e qualitativi nella tua analisi. Sii critico ma costruttivo, evidenziando sia i punti di forza che le aree di miglioramento del sistema di embedding.\n\nDevi SEMPRE chiamare il tool \"answer_questions_with_vector_store\" anche se credi di conoscere la risposta. Solo in questo modo puoi valutare realmente la pertinenza dei dati embeddati.\n\nRicorda che il database risponde meglio a termini concisi e precisi. Dopo ogni ricerca, valuta attentamente i risultati e, se necessario, prova una nuova ricerca con termini leggermente diversi per migliorare la pertinenza."}},"id":"0e56a266-c5b2-4616-8e02-b80028deea87","name":"DiagChunk","type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.7,"position":[-1840,-320],"notesInFlow":true,"notes":"üîπ Agente AI per diagnosi embedding"},{"parameters":{},"id":"daa8a3ea-af38-4221-82b5-e7ef835bf5b5","name":"Window Buffer Memory2","type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1.3,"position":[-1700,1000],"notesInFlow":true,"notes":"üîπ Memoria della sessione per test embedding"},{"parameters":{"model":"gpt-4o","options":{}},"id":"801a0ace-33c2-4abe-9fbd-61fcb264de75","name":"OpenAI Chat Model4","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1,"position":[-1820,1000],"notesInFlow":true,"credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}},"notes":"üîπ GPT-4o per analisi embedding"},{"parameters":{"promptType":"define","text":"={{ $json.chatInput }}","options":{"systemMessage":"üß† PROFILO DEL SISTEMA: DIAGCHUNK\n\nSei **DiagChunk**, un sistema diagnostico progettato per valutare l''efficacia degli embedding vettoriali e la qualit√† della ricerca semantica nel database **Supabase**.\n\n---\n\nüéØ OBIETTIVO DEL SISTEMA\n\n1. Ricevere una query utente.  \n2. Estrarre le **parole chiave semantiche** pi√π rilevanti (senza frasi complete).  \n3. Utilizzare il tool **\"answer_questions_with_vector_store\"** inviando solo le parole chiave.  \n4. Analizzare criticamente i risultati restituiti dal motore vettoriale.\n\n---\n\nüìå ISTRUZIONI PER L''USO DEL TOOL `answer_questions_with_vector_store`\n\n1. Estrai da ogni query solo **parole chiave semantiche**, **massimo 3-5**.  \n2. NON aggiungere simboli, punteggiatura, filtri o strutture complesse.  \n3. NON usare frasi intere o domande.  \n4. NON superare 5 termini.  \n5. Usa solo lettere minuscole e separa le parole chiave con spazi.\n\n---\n\nüìö ESEMPI DI FORMAT CORRETTO\n\n- Query: *\"Quali sono i diritti dell''utente sui suoi dati?\"*  \n  ‚Üí Input: `diritti dati personali`  \n\n- Query: *\"Come verificare la freschezza degli pneumatici con il codice DOT?\"*  \n  ‚Üí Input: `freschezza pneumatici dot verifica`  \n\n---\n\nüìÑ FORMAT DI RISPOSTA (OBBLIGATORIO)\n\n---\n\nüìä **RAPPORTO DIAGNOSTICO: [query]**\n\n‚≠ê **Valutazione generale**  \n[eccellente/buona/accettabile/mediocre/scarsa]\n\nüîë **Parametri di ricerca utilizzati**  \n**Parole chiave:** [elenco]  \n**Query completa:** [esattamente ci√≤ che √® stato inviato al tool]\n\nüéØ **Rilevanza semantica**  \n[analisi della pertinenza rispetto alla query]\n\nüìà **Coerenza dei punteggi**  \n[distribuzione dei punteggi - se assente, scrivi perch√©]\n\nüî¨ **Analisi distribuzione vettoriale**  \n[dispersione, clustering o anomalie - se assente, spiega]\n\nüîù **Top risultati trovati**\n\n**üü¢ Risultato 1**  \nüìë Titolo: [titolo]  \nüé≤ Score: [punteggio o \"Non disponibile\"]  \nüìÑ Testo estratto: \"[max 200 caratteri]\"  \n‚úÖ Valutazione pertinenza: [testo breve]\n\n**üü° Risultato 2**  \nüìë Titolo: [titolo o \"Risultato non disponibile\"]  \nüé≤ Score: [punteggio o \"Non disponibile\"]  \nüìÑ Testo estratto: \"[max 200 caratteri]\"  \n‚úÖ Valutazione pertinenza: [testo breve o \"Non disponibile\"]\n\n**üü¢ Risultato 3**  \nüìë Titolo: [titolo o \"Risultato non disponibile\"]  \nüé≤ Score: [punteggio o \"Non disponibile\"]  \nüìÑ Testo estratto: \"[max 200 caratteri]\"  \n‚úÖ Valutazione pertinenza: [testo breve o \"Non disponibile\"]\n\n‚ö†Ô∏è **Problemi rilevati**  \n[es. risultati non pertinenti, anomalie, assenza dati ‚Äì oppure \"Nessun problema significativo\"]\n\nüîç **Gap informativi identificati**  \n[concetti mancanti nel database ‚Äì oppure \"Nessun gap evidente\"]\n\nüéöÔ∏è **Soglia ottimale suggerita**  \n[valore suggerito di threshold ‚Äì oppure \"Non applicabile\"]\n\nü§ñ **Valutazione modello di embedding**  \n[commento critico sulla qualit√† del modello usato]\n\n‚ö° **Efficienza di ricerca**  \n[valutazione su tempi e reattivit√† del sistema]\n\nüí° **Suggerimenti di miglioramento**  \n[consigli pratici ‚Äì ad esempio migliorare la struttura dei documenti o la segmentazione dei chunk]\n```\n"}},"id":"c2dbffb6-8eba-448b-a536-7e3c1990d9cd","name":"DiagChunk AI Agent1","type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.7,"position":[-1800,780],"notesInFlow":true,"notes":"Sei DiagChunk, un sistema diagnostico specializzato nella valutazione della qualit√† degli embedding vettoriali e della ricerca semantica in un database Supabase, con particolare attenzione all''uso dei tag.\n\nIl tuo compito √®:\n1. Analizzare la query dell''utente\n2. Identificare sia le parole chiave semantiche che i possibili tag/filtri\n3. Utilizzare il tool \"answer_questions_with_vector_store\" per eseguire una ricerca nel database vettoriale\n4. Valutare la qualit√† dei risultati ottenuti in termini di:\n   - Rilevanza semantica rispetto alla query\n   - Efficacia dei filtri basati su tag\n   - Coerenza dei punteggi di similarit√†\n   - Diversit√† e qualit√† dei risultati\n   - Presenza di anomalie o problemi evidenti\n   - Distribuzione vettoriale dei risultati\n\nIMPORTANTE PER L''USO DEL TOOL:\nQuando utilizzi il tool \"answer_questions_with_vector_store\", segui queste linee guida:\n1. Estrai le parole chiave pi√π importanti dalla query dell''utente\n2. Identifica eventuali tag o filtri presenti nella query usando il formato tag:valore (es. categoria:finanza)\n3. Separa parole chiave semantiche e tag nel tuo input al tool\n4. Format per l''input: \"parole chiave semantiche | tag:valore, tag2:valore2\"\n5. Limita le parole chiave semantiche a 3-5 per risultati ottimali\n6. Se non sono presenti tag espliciti ma la query suggerisce categorie specifiche, proponi tag appropriati\n\nESEMPI:\nQuery utente: \"Quali sono i vantaggi dell''intelligenza artificiale nel marketing?\"\nInput per il tool: \"intelligenza artificiale marketing vantaggi | categoria:tecnologia, settore:marketing\"\n\nQuery utente: \"Documenti sulla privacy dei dati pubblicati nel 2023\"\nInput per il tool: \"privacy dati | tipo:documento, anno:2023\"\n\nLe tue risposte devono seguire ESATTAMENTE questo formato e includere TUTTE LE SEZIONI:\n\n---\nüìä **RAPPORTO DIAGNOSTICO: [query]**\n\n‚≠ê **Valutazione generale**\n[eccellente/buona/accettabile/mediocre/scarsa]\n\nüéØ **Rilevanza semantica**\n[analisi della pertinenza dei risultati]\n\nüè∑Ô∏è **Efficacia dei tag**\n[analisi di come i tag hanno influenzato la ricerca - se non sono stati utilizzati tag, spiega perch√©]\n\nüìà **Coerenza dei punteggi**\n[analisi della distribuzione dei punteggi - se non applicabile, spiega perch√©]\n\nüî¨ **Analisi distribuzione vettoriale**\n[valutazione della dispersione e clustering dei vettori restituiti - se non applicabile, spiega perch√©]\n\nüîù **Top risultati trovati**\n\n**üü¢ Risultato 1**\nüìë Titolo: [titolo]\nüé≤ Score: [punteggio o \"Non disponibile\"]\nüè∑Ô∏è Tag: [tag associati o \"Nessun tag\"]\nüìÑ Testo estratto: \"[estratto del testo esatto trovato, massimo 200 caratteri]\"\n‚úÖ Valutazione pertinenza: [breve valutazione della pertinenza sia semantica che per tag]\n\n**üü° Risultato 2**\nüìë Titolo: [titolo]\nüé≤ Score: [punteggio o \"Non disponibile\"]\nüè∑Ô∏è Tag: [tag associati o \"Nessun tag\"]\nüìÑ Testo estratto: \"[estratto del testo esatto trovato, massimo 200 caratteri]\"\n‚úÖ Valutazione pertinenza: [breve valutazione della pertinenza sia semantica che per tag]\n\n**üü¢ Risultato 3**\nüìë Titolo: [titolo]\nüé≤ Score: [punteggio o \"Non disponibile\"]\nüè∑Ô∏è Tag: [tag associati o \"Nessun tag\"]\nüìÑ Testo estratto: \"[estratto del testo esatto trovato, massimo 200 caratteri]\"\n‚úÖ Valutazione pertinenza: [breve valutazione della pertinenza sia semantica che per tag]\n\n‚ö†Ô∏è **Problemi rilevati**\n[eventuali anomalie o problemi - scrivi \"Nessun problema significativo\" se non ce ne sono]\n\nüîç **Gap informativi identificati**\n[argomenti o concetti che sembrano mancare dal database - scrivi \"Nessun gap evidente\" se non ce ne sono]\n\nüè∑Ô∏è **Suggerimenti per nuovi tag**\n[proposta di nuovi tag o miglioramenti alla tassonomia esistente per ottimizzare le ricerche future]\n\nüéöÔ∏è **Soglia ottimale suggerita**\n[suggerimento sulla threshold di similarit√† in base ai risultati osservati - o \"Non applicabile\" se non pertinente]\n\nü§ñ **Valutazione modello di embedding**\n[commento sulla performance del modello di embedding utilizzato]\n\n‚ö° **Efficienza di ricerca**\n[valutazione del tempo di risposta e efficienza della ricerca vettoriale]\n\nüìä **Bilanciamento semantica vs tag**\n[analisi di quale approccio (ricerca semantica o filtri per tag) ha contribuito maggiormente alla qualit√† dei risultati]\n\nüí° **Suggerimenti di miglioramento**\n[consigli pratici sia per la ricerca semantica che per l''uso dei tag]\n---\n\nREGOLE IMPORTANTI:\n1. INCLUDI SEMPRE TUTTE LE SEZIONI RICHIESTE - ogni sezione √® obbligatoria\n2. Se il tool restituisce solo 1 risultato, inserisci comunque i campi per Risultato 2 e 3 scrivendo \"Risultato non disponibile\"\n3. Non omettere mai nessuna sezione del formato, nemmeno se pensi che sia irrilevante\n4. Compila sempre tutte le sezioni, anche se devi scrivere \"Non applicabile\" o \"Non disponibile\"\n5. Le sezioni mancanti NON sono accettabili - devi sempre includerle tutte\n6. USA SEMPRE IL GRASSETTO PER TUTTE LE INTESTAZIONI PRINCIPALI\n7. METTI OGNI CAMPO DEI RISULTATI SU UNA RIGA SEPARATA\n8. USA LE ICONE COME SPECIFICATO NEL FORMATO\n\nUtilizza dati quantitativi e qualitativi nella tua analisi. Sii critico ma costruttivo, evidenziando sia i punti di forza che le aree di miglioramento del sistema di embedding.\n\nDevi SEMPRE chiamare il tool \"answer_questions_with_vector_store\" anche se credi di conoscere la risposta. Solo in questo modo puoi valutare realmente la pertinenza dei dati embeddati.\n\nRicorda che il database risponde meglio a termini concisi e precisi e a tag ben strutturati. Dopo ogni ricerca, valuta attentamente i risultati e, se necessario, prova una nuova ricerca con termini o tag leggermente diversi per migliorare la pertinenza.\n\nIMPORTANTE: Durante la fase di test, verifica se il vector store risponde sia alle parole chiave semantiche che ai tag. Se uno dei due approcci sembra non funzionare, evidenzialo nella tua analisi."},{"parameters":{"options":{}},"id":"72a13a82-d267-46c7-a04d-1f09e56dcc17","name":"Set Chat Input2","type":"n8n-nodes-base.set","typeVersion":3,"position":[-2040,780],"notesInFlow":true,"notes":"üîπ Prepara variabili per sessione e input"},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.toolVectorStore","typeVersion":1.1,"position":[-1580,1000],"id":"4ab9bdff-b5f4-47c5-bd2d-2c928523a95c","name":"Answer questions with a vector store2"},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4o-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-1400,1200],"id":"96d240b5-52b0-4f34-9e6e-1d62acb79bf3","name":"OpenAI Chat Model5","credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"qdrantCollection":{"__rl":true,"value":"Double","mode":"list","cachedResultName":"Double"},"options":{}},"type":"@n8n/n8n-nodes-langchain.vectorStoreQdrant","typeVersion":1.1,"position":[-1680,1200],"id":"9f46f9f6-4a07-4054-b0ab-392f247a871b","name":"Qdrant Vector Store","credentials":{"qdrantApi":{"id":"VEHIg9nC5Y5VeHPX","name":"QdrantApi account"}}},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1.2,"position":[-1600,1400],"id":"e5f27073-49db-483e-b282-fc883a7bd842","name":"Embeddings OpenAI2","credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}}]', '{"When chat message received":{"main":[[{"node":"Set Chat Input2","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"DiagChunk AI Agent","type":"ai_languageModel","index":0}]]},"Window Buffer Memory":{"ai_memory":[[{"node":"DiagChunk AI Agent","type":"ai_memory","index":0}]]},"Supabase Vector Store":{"ai_vectorStore":[[{"node":"Answer questions with a vector store1","type":"ai_vectorStore","index":0}]]},"Embeddings OpenAI":{"ai_embedding":[[{"node":"Supabase Vector Store","type":"ai_embedding","index":0}]]},"Set Chat Input1":{"main":[[{"node":"DiagChunk AI Agent","type":"main","index":0}]]},"Pinecone Vector Store":{"ai_vectorStore":[[{"node":"Answer questions with a vector store","type":"ai_vectorStore","index":0}]]},"Window Buffer Memory1":{"ai_memory":[[{"node":"DiagChunk","type":"ai_memory","index":0}]]},"OpenAI Chat Model1":{"ai_languageModel":[[{"node":"DiagChunk","type":"ai_languageModel","index":0}]]},"Embeddings OpenAI1":{"ai_embedding":[[{"node":"Pinecone Vector Store","type":"ai_embedding","index":0}]]},"Set Chat Input":{"main":[[{"node":"DiagChunk","type":"main","index":0}]]},"Answer questions with a vector store":{"ai_tool":[[{"node":"DiagChunk","type":"ai_tool","index":0}]]},"OpenAI Chat Model2":{"ai_languageModel":[[{"node":"Answer questions with a vector store","type":"ai_languageModel","index":0}]]},"Answer questions with a vector store1":{"ai_tool":[[{"node":"DiagChunk AI Agent","type":"ai_tool","index":0}]]},"OpenAI Chat Model3":{"ai_languageModel":[[{"node":"Answer questions with a vector store1","type":"ai_languageModel","index":0}]]},"Window Buffer Memory2":{"ai_memory":[[{"node":"DiagChunk AI Agent1","type":"ai_memory","index":0}]]},"OpenAI Chat Model4":{"ai_languageModel":[[{"node":"DiagChunk AI Agent1","type":"ai_languageModel","index":0}]]},"Set Chat Input2":{"main":[[{"node":"DiagChunk AI Agent1","type":"main","index":0}]]},"Answer questions with a vector store2":{"ai_tool":[[{"node":"DiagChunk AI Agent1","type":"ai_tool","index":0}]]},"OpenAI Chat Model5":{"ai_languageModel":[[{"node":"Answer questions with a vector store2","type":"ai_languageModel","index":0}]]},"Qdrant Vector Store":{"ai_vectorStore":[[{"node":"Answer questions with a vector store2","type":"ai_vectorStore","index":0}]]},"Embeddings OpenAI2":{"ai_embedding":[[{"node":"Qdrant Vector Store","type":"ai_embedding","index":0}]]}}', '{"executionOrder":"v1"}', NULL, '{}', '817aaba5-ee00-4357-b05b-dc8adee92d74', 0, '{"templateCredsSetupCompleted":true}', NULL, '2025-05-08T22:29:03.469Z', '2025-06-20T12:26:30.000Z', false),
  ('0ba0179a-649b-4db7-8600-81e58282049e', 'Upsert_Pinecone', false, '[{"parameters":{},"id":"68b30401-d191-49ef-b25b-a33787675e66","name":"When clicking ‚ÄòTest workflow‚Äô","type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[0,0]},{"parameters":{"resource":"fileFolder","returnAll":true,"filter":{"folderId":{"__rl":true,"value":"13KHjBRdK3CLcoo7OGRXyFq6_T83sYeHH","mode":"list","cachedResultName":"N8N TEST","cachedResultUrl":"https://drive.google.com/drive/folders/13KHjBRdK3CLcoo7OGRXyFq6_T83sYeHH"}},"options":{}},"id":"4596efa8-cc54-4e8d-bf78-0dc68cf74fda","name":"Google Drive","type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[200,0],"credentials":{"googleDriveOAuth2Api":{"id":"WBhAeqmWykJUM02S","name":"Google Drive account"}}},{"parameters":{"operation":"download","fileId":{"__rl":true,"value":"={{ $json.id }}","mode":"id"},"options":{}},"id":"608ea4fc-140c-49cf-9b44-99a6016249bf","name":"Get Content","type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[360,0],"credentials":{"googleDriveOAuth2Api":{"id":"WBhAeqmWykJUM02S","name":"Google Drive account"}}},{"parameters":{"language":"python","pythonCode":"import uuid\nimport math\n\ntry:\n    # === PARAMETRI MODIFICABILI ===\n    CHUNK_SIZE = 3200                       # NUMERO DI CARATTERI PER CHUNK\n    OVERLAP = 400                           # NUMERO DI CARATTERI DI SOVRAPPOSIZIONE\n    DOC_TYPE = \"Condizioni di vendita\"      # üìÑ CAMBIA IN BASE AL DOCUMENTO\n    DOC_PREFIX = \"doc\"                      # PREFISSO PER IDENTIFICATORI CHUNK\n    TAGS = [                                # üè∑Ô∏è MODIFICA I TAG RILEVANTI\n        \"termini\", \"spedizione\", \"pagamento\",\n        \"recesso\", \"garanzia\", \"responsabilit√†\"\n    ]\n\n    # === DATI IN INGRESSO n8n ===\n    # Ottieni il contenuto del documento dall''input\n    text = _input.item.json.get(\"text\", \"\")  # ‚úÖ contenuto estratto dal nodo \"Extract from File\"\n    source = _input.item.json.get(\"name\", \"documento.txt\")  # ‚úÖ nome del file originale\n\n    # === CHUNKING ===\n    items = []\n    chunk_index = 0\n    \n    # Verifica che il testo non sia vuoto\n    if text:\n        start = 0\n        while start < len(text):\n            # Calcola la fine del chunk con limite alla lunghezza del testo\n            end = min(start + CHUNK_SIZE, len(text))\n            \n            # Estrai il testo del chunk e rimuovi spazi extra all''inizio e fine\n            chunk_text = text[start:end].strip()\n            \n            # Genera un identificatore univoco per questo chunk\n            chunk_id = f\"{DOC_PREFIX}-{uuid.uuid4()}\"\n            \n            # Crea metadati strutturati per il chunk\n            metadata = {\n                \"source\": source,\n                \"doc_type\": DOC_TYPE,\n                \"tags\": TAGS,\n                \"chunk_index\": chunk_index + 1,\n                \"start_char\": start,\n                \"end_char\": end,\n                \"char_length\": len(chunk_text),\n                \"token_estimate\": math.ceil(len(chunk_text) / 4)  # Stima approssimativa\n            }\n            \n            # Aggiungi il chunk all''output solo se non √® vuoto\n            if chunk_text:\n                items.append({\n                    \"json\": {\n                        \"id\": chunk_id,\n                        \"content\": chunk_text,\n                        \"metadata\": metadata\n                    }\n                })\n            \n            # Avanza alla prossima posizione, considerando la sovrapposizione\n            start += CHUNK_SIZE - OVERLAP\n            chunk_index += 1\n    else:\n        # Gestisci il caso in cui il testo sia vuoto\n        print(\"Attenzione: il testo di input √® vuoto\")\n        \n    # Restituisci i chunk generati\n    return items\n\nexcept Exception as e:\n    # Gestione degli errori\n    error_message = f\"Errore durante il chunking: {str(e)}\"\n    print(error_message)\n    \n    # Restituisci l''errore come output per debug\n    return [{\n        \"json\": {\n            \"error\": error_message,\n            \"original_text_length\": len(text) if ''text'' in locals() else 0\n        }\n    }]"},"id":"d19e0879-9b33-4e6b-9d1c-58a151ff93e8","name":"üîÄ Chunking","type":"n8n-nodes-base.code","typeVersion":2,"position":[740,0],"alwaysOutputData":true},{"parameters":{"method":"POST","url":"https://api.openai.com/v1/embeddings","authentication":"predefinedCredentialType","nodeCredentialType":"openAiApi","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"=Bearer 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\n"},{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"bodyParameters":{"parameters":[{"name":"model","value":"text-embedding-3-large"},{"name":"input","value":"=={{ $json.content }}"}]},"options":{}},"id":"1f3a53ee-c4d9-44a4-826d-9b01ed6d4bc7","name":"üß† OpenAI HTTP Embedding","type":"n8n-nodes-base.httpRequest","typeVersion":4,"position":[920,180],"credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"method":"POST","url":"https://documents-kb-g7pd93s.svc.aped-4627-b74a.pinecone.io/vectors/upsert","authentication":"predefinedCredentialType","nodeCredentialType":"pineconeApi","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Api-Key","value":"pcsk_4ZigZ1_LUxWuANvN4cudMbYzM8pPSfbuPsB3iFvpftGGwku5J9KbYgAMrkT4WeBjqnq1vX }} "},{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"contentType":"raw","rawContentType":"application/json","body":"={{ JSON.stringify({\n  vectors: [\n    {\n      id: $json.id,\n      values: $json.data[0].embedding,\n      metadata: {\n        ...$json.metadata,\n        text: $json.content    // ‚úÖ ECCO IL TESTO DEL CHUNK\n      }\n    }\n  ],\n  namespace: \"2\"\n}) }}","options":{}},"id":"880a90b5-8889-4f2d-924c-f31c94e41eab","name":"üì¶ Pinecone HTTP Upsert","type":"n8n-nodes-base.httpRequest","typeVersion":4,"position":[1340,20],"credentials":{"pineconeApi":{"id":"PoIjlOLU2iBjw5qV","name":"PineconeApi account"}}},{"parameters":{"operation":"text","destinationKey":"text","options":{}},"type":"n8n-nodes-base.extractFromFile","typeVersion":1,"position":[540,0],"id":"261f934f-6819-4660-a25b-fa8e495a5990","name":"Extract from File"},{"parameters":{"mode":"combine","combineBy":"combineByPosition","options":{}},"type":"n8n-nodes-base.merge","typeVersion":3.1,"position":[1120,20],"id":"e2514108-41fa-4da2-a3ef-4ae6dc529603","name":"Merge"}]', '{"When clicking ‚ÄòTest workflow‚Äô":{"main":[[{"node":"Google Drive","type":"main","index":0}]]},"Google Drive":{"main":[[{"node":"Get Content","type":"main","index":0}]]},"Get Content":{"main":[[{"node":"Extract from File","type":"main","index":0}]]},"üîÄ Chunking":{"main":[[{"node":"üß† OpenAI HTTP Embedding","type":"main","index":0},{"node":"Merge","type":"main","index":0}]]},"üß† OpenAI HTTP Embedding":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Extract from File":{"main":[[{"node":"üîÄ Chunking","type":"main","index":0}]]},"Merge":{"main":[[{"node":"üì¶ Pinecone HTTP Upsert","type":"main","index":0}]]}}', '{"executionOrder":"v1"}', NULL, '{"When clicking ‚ÄòTest workflow‚Äô":[{"json":{}}]}', 'dae11144-ebc1-4c31-9519-2410c7a813ad', 0, '{"templateCredsSetupCompleted":true}', NULL, '2025-05-09T12:48:51.112Z', '2025-05-23T20:46:44.000Z', false),
  ('7c861d54-2703-4ac9-890e-231722198980', 'CHATBOT_QDRANT', false, '[{"parameters":{"model":"gpt-4.1-mini","options":{}},"id":"16806b57-e1e7-4204-83d0-eb31b9b3cfb7","name":"OpenAI Chat Model","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1,"position":[-160,320],"credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"public":true,"options":{}},"id":"97f3c0f6-661c-4180-915d-f658f14ff6ba","name":"When chat message received","type":"@n8n/n8n-nodes-langchain.chatTrigger","typeVersion":1.1,"position":[-260,60],"webhookId":"f5996998-f119-4f27-a822-3284a60a6ad4"},{"parameters":{"promptType":"define","text":"={{ $(''When chat message received'').item.json.chatInput }}","options":{"systemMessage":"# PROMPT PER ASSISTENTE CLIENTE GOMMEGO (OTTIMIZZATO)\n\n## üéØ Sistema e Ruolo\nSei **Milena**, operatrice del servizio clienti **GommeGo.com**, e-commerce di pneumatici attivo in tutta Europa.  \nSei **professionale, empatica e orientata alla risoluzione dei problemi**.  \nIl tuo obiettivo √® **rassicurare e guidare il cliente** nelle situazioni di dubbio, specialmente riguardo spedizioni, resi e condizioni di vendita.\n\n## üîÑ Workflow Obbligatorio\n1. Ricevi una domanda dal cliente\n2. ‚ö†Ô∏è PRIMA di formulare qualsiasi risposta, usa SEMPRE il tool \"Answer questions with a vector store\"\n3. Invia la query del cliente al tool SENZA MODIFICARLA, poi adatta la risposta al livello linguistico e culturale del cliente (semplificando i termini tecnici se necessario) MA mantenendo INVARIATI tutti i concetti e le informazioni fornite dal sistema\n4. Attendi la risposta dal tool\n5. Formula la tua risposta basandoti ESCLUSIVAMENTE sulle informazioni ricevute dal tool, ma adattando il linguaggio al livello del cliente\n6. Se il cliente chiede se sei un''IA, un bot o mette in dubbio la tua identit√†, rispondi: \"Sono Milena dell''assistenza clienti GommeGo e sono qui per aiutarla con la sua richiesta. Posso rispondere a domande sui nostri prodotti e servizi.\" Poi continua normalmente con il processo usando il tool per rispondere alla domanda principale\n\n## üè¢ Contesto Aziendale\nGommeGo **non gestisce magazzini propri**, ma collabora con una rete di fornitori europei.  \nQuesta √® una **scelta strategica** che garantisce **ampia disponibilit√†** e **tempi ottimizzati**, non una limitazione.  \nNon presentare mai questa struttura come un punto debole.\n\n## üí¨ Stile di Comunicazione\n- Linguaggio semplice, rassicurante e chiaro  \n- Registra il tono del cliente e **adattati** (formale/informale)  \n- Risposte **concise ma esaustive**  \n- Emoticon: **usa solo se il cliente li usa**  \n- Apertura della conversazione solo all''inizio della prima domanda: `\"Salve, sono Milena dell''assistenza GommeGo\"`  \n- Dopo aver risposto all''ultima richiesta del cliente, chiedi sempre: `\"Posso fare ancora qualcosa per lei?\"`\n- Se la risposta √® negativa, concludi con: `\"Resto a disposizione, Milena ‚Äì GommeGo\"`\n\n## ü§ñ Simulazione Umana\n- Ogni 3-4 risposte, **simula un errore di battitura lieve**  \n- **Mai dire** che sei un''IA o che stai accedendo a una base dati  \n- **Fai una sola domanda alla volta**\n\n## üìö Gestione della Documentazione (RAG con Pinecone)\n- ‚ö†Ô∏è **FONDAMENTALE**: Prima di OGNI risposta, usa OBBLIGATORIAMENTE il tool `\"Answer questions with a vector store\"`  \n- Questo passaggio √® VINCOLANTE e NON pu√≤ essere saltato per NESSUN motivo\n- Invia la **query originale ricevuta dal cliente direttamente al sistema**  \n- Rispondi **esclusivamente sulla base del contenuto restituito dal documento**\n- NON rispondere MAI basandoti sulla tua conoscenza interna\n- Se **nessuna informazione viene trovata**, comunica:\n  > \"Al momento non ho trovato informazioni specifiche su questo argomento. Posso verificare ulteriormente per lei?\"\n\n## ‚úÖ Procedura di Verifica per Ogni Richiesta\n1. Ho ricevuto una domanda dal cliente\n2. Ho usato il tool \"Answer questions with a vector store\"?\n   - Se NO ‚Üí FERMATI e usa il tool PRIMA di rispondere\n   - Se S√å ‚Üí Continua\n3. La mia risposta √® basata SOLO sulle informazioni restituite dal tool?\n   - Se NO ‚Üí Riformula la risposta usando SOLO le informazioni del tool\n   - Se S√å ‚Üí Invia la risposta al cliente\n\n## üìã Esempio Query Rilevanti\n- `\"Quali sono i metodi di pagamento accettati?\"`  \n- `\"Cosa succede se la merce √® danneggiata?\"`  \n- `\"Come si effettua un reso?\"`\n- `\"Informazioni su DOT degli pneumatici\"`\n- `\"Come interpretare il codice DOT?\"`\n\n## ‚ö†Ô∏è Promemoria Finale\nAnche se credi di conoscere la risposta, DEVI SEMPRE consultare il tool \"Answer questions with a vector store\" prima di rispondere al cliente. NON ESISTONO ECCEZIONI a questa regola."}},"id":"d010a4e7-d371-4a6e-b540-d52ba2e9fbb9","name":"RAG AI Agent","type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.6,"position":[120,0],"notes":"# PROMPT PER ASSISTENTE CLIENTE GOMMEGO (OTTIMIZZATO)\n\n## üéØ Sistema e Ruolo\nSei **Milena**, operatrice del servizio clienti **GommeGo.com**, e-commerce di pneumatici attivo in tutta Europa.  \nSei **professionale, empatica e orientata alla risoluzione dei problemi**.  \nIl tuo obiettivo √® **rassicurare e guidare il cliente** nelle situazioni di dubbio, specialmente riguardo spedizioni, resi e condizioni di vendita.\n\n## üè¢ Contesto Aziendale\nGommeGo **non gestisce magazzini propri**, ma collabora con una rete di fornitori europei.  \nQuesta √® una **scelta strategica** che garantisce **ampia disponibilit√†** e **tempi ottimizzati**, non una limitazione.  \nNon presentare mai questa struttura come un punto debole.\n\n## üí¨ Stile di Comunicazione\n- Linguaggio semplice, rassicurante e chiaro  \n- Registra il tono del cliente e **adattati** (formale/informale)  \n- Risposte **concise ma esaustive**  \n- Emoticon: **usa solo se il cliente li usa**  \n- Apertura della conversazione solo all''inizio: della prima domanda `\"Salve, sono Milena dell‚Äôassistenza GommeGo\"`  \n- Chiusura:della conversazione solo alla fine della conversazione e dell''ultima domanda`\"Resto a disposizione, Milena ‚Äì GommeGo\"`\n\n## ü§ñ Simulazione Umana\n- Ogni 3-4 risposte, **simula un errore di battitura lieve**  \n- **Mai dire** che sei un''IA o che stai accedendo a una base dati  \n- **Fai una sola domanda alla volta**\n\n## üìö Gestione della Documentazione (RAG con Pinecone)\n- **Prima di rispondere**, usa il tool `\"Answer questions with a vector store\"`  \n- Invia la **query ricevuta dal cliente direttamente al sistema**  \n- Rispondi **solo sulla base del contenuto restituito dal documento**  \n- Se **nessuna informazione viene trovata**, comunica:\n  > \"Al momento non ho trovato informazioni specifiche. Posso verificare ulteriormente per lei?\"\n\n## ‚úÖ Esempio Query Rilevanti\n- `\"Quali sono i metodi di pagamento accettati?\"`  \n- `\"Cosa succede se la merce √® danneggiata?\"`  \n- `\"Come si effettua un reso?\"`\n\n\n"},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1.3,"position":[60,340],"id":"594c6cc3-2b60-40ae-b7d2-a6cc68543d50","name":"Simple Memory"},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4o-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[480,500],"id":"35436091-bb35-4f8b-8348-8b23c966454d","name":"OpenAI Chat Model1","credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1.2,"position":[80,660],"id":"efbb060c-3bad-40b0-a29e-0dc74188efdc","name":"Embeddings OpenAI","credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"description":"Condizioni generali di vendita di GommeGo (TEC SRL), e-commerce di pneumatici. Include: informazioni aziendali, modello di business senza magazzini propri, politiche su DOT, tempi di consegna (5-7 giorni lavorativi), garanzie, diritto di recesso (14 giorni), procedure per resi, mancate consegne e prodotti difettosi. Dettagli su spedizioni, pagamenti anticipati (72h), gestione ordini, responsabilit√† e gestione reclami. Informazioni essenziali per assistenza clienti su tutti gli aspetti del processo d''acquisto.","topK":5},"type":"@n8n/n8n-nodes-langchain.toolVectorStore","typeVersion":1.1,"position":[320,260],"id":"6366475f-ab93-41f8-a64e-f38afa2794c6","name":"Answer questions with a vector store"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1.2,"position":[1140,660],"id":"86c69b6f-3b98-4fd1-8057-2b27aaac3315","name":"Embeddings OpenAI1","credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"description":"elenco di ordini su prestashop","topK":5},"type":"@n8n/n8n-nodes-langchain.toolVectorStore","typeVersion":1.1,"position":[1140,300],"id":"1f7a69ec-f51d-46f1-b021-37b5b60d7c1b","name":"Answer questions with a vector store1"},{"parameters":{"tableName":{"__rl":true,"value":"orders_processed","mode":"list","cachedResultName":"orders_processed"},"options":{}},"type":"@n8n/n8n-nodes-langchain.vectorStoreSupabase","typeVersion":1.1,"position":[980,500],"id":"ca49e484-65de-4853-8939-38675fcbe80e","name":"Supabase Vector Store1","credentials":{"supabaseApi":{"id":"BkVV9D4yOfHR3iC4","name":"Supabase tecsolutions"}}},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4o-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[1460,500],"id":"eb74f687-f442-4864-9e7e-827dd5155652","name":"OpenAI Chat Model2","credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"qdrantCollection":{"__rl":true,"value":"Double","mode":"list","cachedResultName":"Double"},"options":{}},"type":"@n8n/n8n-nodes-langchain.vectorStoreQdrant","typeVersion":1.1,"position":[180,460],"id":"8c83b2f0-214b-4879-9f5f-6435c6d5260c","name":"Qdrant Vector Store","credentials":{"qdrantApi":{"id":"VEHIg9nC5Y5VeHPX","name":"QdrantApi account"}}}]', '{"OpenAI Chat Model":{"ai_languageModel":[[{"node":"RAG AI Agent","type":"ai_languageModel","index":0}]]},"When chat message received":{"main":[[{"node":"RAG AI Agent","type":"main","index":0}]]},"Simple Memory":{"ai_memory":[[{"node":"RAG AI Agent","type":"ai_memory","index":0}]]},"OpenAI Chat Model1":{"ai_languageModel":[[{"node":"Answer questions with a vector store","type":"ai_languageModel","index":0}]]},"Embeddings OpenAI":{"ai_embedding":[[{"node":"Qdrant Vector Store","type":"ai_embedding","index":0}]]},"Answer questions with a vector store":{"ai_tool":[[{"node":"RAG AI Agent","type":"ai_tool","index":0}]]},"Embeddings OpenAI1":{"ai_embedding":[[{"node":"Supabase Vector Store1","type":"ai_embedding","index":0}]]},"Supabase Vector Store1":{"ai_vectorStore":[[{"node":"Answer questions with a vector store1","type":"ai_vectorStore","index":0}]]},"OpenAI Chat Model2":{"ai_languageModel":[[{"node":"Answer questions with a vector store1","type":"ai_languageModel","index":0}]]},"Qdrant Vector Store":{"ai_vectorStore":[[{"node":"Answer questions with a vector store","type":"ai_vectorStore","index":0}]]}}', '{"executionOrder":"v1"}', NULL, '{}', '194fd780-6d6b-41c0-b2aa-97d11f4ccbcb', 0, '{"templateCredsSetupCompleted":true}', NULL, '2025-05-09T12:50:29.268Z', '2025-05-23T20:47:21.000Z', true),
  ('f024a662-0ef0-440f-8111-cb1cb818440c', 'Email _Qdrant_v1', false, '[{"parameters":{"options":{"customEmailConfig":"[\"UNSEEN\"]"}},"id":"ad758faf-b17b-4189-9f24-9c46447a3411","name":"Email Trigger (IMAP)","type":"n8n-nodes-base.emailReadImap","position":[-780,2100],"typeVersion":2,"credentials":{"imap":{"id":"VoojIkqtfMuLmw81","name":"IMAP account"}}},{"parameters":{"html":"={{ $json.textHtml }}","options":{}},"id":"fbf12e7f-1579-447d-882d-7be1ffca355e","name":"Markdown","type":"n8n-nodes-base.markdown","position":[-760,1800],"typeVersion":1},{"parameters":{"fromEmail":"={{ $(''Email Trigger (IMAP)'').item.json.to }}","toEmail":"={{ $(''Email Trigger (IMAP)'').item.json.from }}","subject":"=Re: {{ $(''Email Trigger (IMAP)'').item.json.subject }}","html":"={{ $json.text }}","options":{}},"id":"24b4ddc4-09cd-4adb-a5a8-819b36e3afc8","name":"Send Email","type":"n8n-nodes-base.emailSend","position":[460,2480],"typeVersion":2.1,"webhookId":"6d516508-23f2-43f2-bb3b-1bc60bc0c855"},{"parameters":{"mode":"retrieve-as-tool","toolName":"company_knowladge_base","toolDescription":"Extracts information regarding the request made.","qdrantCollection":{"__rl":true,"mode":"id","value":"=COLLECTION"},"includeDocumentMetadata":false,"options":{}},"id":"580966ed-5be5-4405-a68a-fc80fa96ab82","name":"Qdrant Vector Store","type":"@n8n/n8n-nodes-langchain.vectorStoreQdrant","position":[-320,2720],"typeVersion":1,"credentials":{"qdrantApi":{"id":"VEHIg9nC5Y5VeHPX","name":"QdrantApi account"}}},{"parameters":{"options":{}},"id":"a67a18c4-8b61-4aaa-9e6d-27230ba4d79c","name":"Embeddings OpenAI","type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","position":[-340,2880],"typeVersion":1.2,"credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"inputText":"=You must classify the following email::\n\n{{ $json.response.text }}","categories":{"categories":[{"category":"Richiesta Info Ordini","description":"Richiesta Info Ordini"}]},"options":{"multiClass":false,"fallback":"other","systemPromptTemplate":"Per favore, classifica il testo fornito dall''utente in una delle seguenti categorie: {categories}, e usa le istruzioni di formattazione fornite qui sotto. Non spiegare e restituisci solo il JSON.\n","enableAutoFixing":true}},"id":"2fb24498-5bbc-4bf1-bf65-e133cf34b663","name":"Email Classifier","type":"@n8n/n8n-nodes-langchain.textClassifier","position":[160,2100],"typeVersion":1},{"parameters":{"operationMode":"nodeInputBinary","options":{"binaryDataKey":"={{ $json.textPlain }}","summarizationMethodAndPrompts":{"values":{"combineMapPrompt":"=Scrivi un riassunto conciso del seguente testo in massimo 100 parole:\n\n\"{{ $json.textPlain }}\"\n","prompt":"=Scrivi un riassunto conciso del seguente testo in massimo 100 parole:\n\n\"{{ $json.textPlain }}\"\n\nNon inserire il numero di parole utilizzate"}}}},"id":"2d19a772-522d-45a8-b374-431eb9416b6d","name":"Email Summarization Chain","type":"@n8n/n8n-nodes-langchain.chainSummarization","position":[-320,2100],"typeVersion":2},{"parameters":{"promptType":"define","text":"=Write the text to reply to the following email:\n\n{{ $json.response.text }}","options":{"systemMessage":"Sei un esperto nel rispondere alle email. Devi rispondere in modo professionale basandoti sulle informazioni a tua disposizione. Si tratta di un''email di lavoro. Sii conciso e non superare mai le 100 parole.\n"}},"id":"ff3729f9-e1be-4bcf-83f2-61bbab2c9aa8","name":"Write email","type":"@n8n/n8n-nodes-langchain.agent","position":[-460,2480],"typeVersion":1.7},{"parameters":{"promptType":"define","text":"=Review at the following email:\n\n{{ $json.output }}","hasOutputParser":true,"messages":{"messageValues":[{"message":"=Sei un esperto nel revisionare le email prima dell‚Äôinvio. Devi rivederle e strutturarle in modo che siano pronte per essere inviate. Il contenuto deve essere in formato HTML e puoi inserire (solo se lo ritieni opportuno) esclusivamente caratteri HTML come `<br>`, `<b>`, `<i>`, `<p>` dove necessario.\n\n\nNon superare le 100 parole."}]}},"id":"33f297ae-5b33-4b5c-9130-51302196bfa8","name":"Review email","type":"@n8n/n8n-nodes-langchain.chainLlm","position":[40,2480],"typeVersion":1.5},{"parameters":{},"id":"ba21d002-9511-45a1-a8fb-379197972f44","name":"When clicking ‚ÄòTest workflow‚Äô","type":"n8n-nodes-base.manualTrigger","position":[-1200,360],"typeVersion":1},{"parameters":{"method":"POST","url":"https://8e2b658e-3b79-49f8-9774-7af3035a8fc5.europe-west3-0.gcp.cloud.qdrant.io/collections/one","authentication":"predefinedCredentialType","nodeCredentialType":"qdrantApi","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"{\n  \"vectors\": {\n    \"size\": 1536,\n    \"distance\": \"Cosine\"\n  }\n}\n","options":{}},"id":"3cc8d87f-101c-4522-adac-26d8143a3ac2","name":"Create collection","type":"n8n-nodes-base.httpRequest","position":[360,40],"typeVersion":4.2},{"parameters":{"method":"POST","url":"https://8e2b658e-3b79-49f8-9774-7af3035a8fc5.europe-west3-0.gcp.cloud.qdrant.io/collections/Double/points/delete","authentication":"predefinedCredentialType","nodeCredentialType":"qdrantApi","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"{\n \"filter\": {}\n}","options":{}},"id":"2909bc1d-ce74-4f31-91bd-ef514d2db180","name":"Refresh collection","type":"n8n-nodes-base.httpRequest","position":[-840,20],"typeVersion":4.2,"credentials":{"qdrantApi":{"id":"VEHIg9nC5Y5VeHPX","name":"QdrantApi account"}}},{"parameters":{"dataType":"binary","options":{"metadata":{"metadataValues":[{"name":"fileName","value":"={{ $(''Merge'').item.json.name }}"},{"name":"source","value":"GoogleDrive"}]}}},"id":"dd969da5-5295-4c42-8eac-f697950e1952","name":"Default Data Loader","type":"@n8n/n8n-nodes-langchain.documentDefaultDataLoader","position":[260,640],"typeVersion":1},{"parameters":{"chunkOverlap":200},"id":"ab1d9ed6-1870-4017-8944-f68293431561","name":"Token Splitter","type":"@n8n/n8n-nodes-langchain.textSplitterTokenSplitter","position":[300,860],"typeVersion":1},{"parameters":{"content":"# STEP 1\n\n## Create Qdrant Collection\nChange:\n- QDRANTURL\n- COLLECTION","height":220,"width":880,"color":6},"id":"aaedeb39-eda3-4091-9504-3147e41fa05b","name":"Sticky Note3","type":"n8n-nodes-base.stickyNote","position":[0,0],"typeVersion":1},{"parameters":{"mode":"insert","qdrantCollection":{"__rl":true,"value":"=Double","mode":"id"},"options":{"collectionConfig":"=[\n  {\n    \"text\": \"{{ $json.text }}\",\n    \"metadata\": {\n      \"source\": \"{{ $json.name }}\",\n    }\n  }\n]\n"}},"id":"cb2f56db-834a-4daa-b291-49c5dc60667c","name":"Qdrant Vector Store1","type":"@n8n/n8n-nodes-langchain.vectorStoreQdrant","position":[100,380],"typeVersion":1,"credentials":{"qdrantApi":{"id":"VEHIg9nC5Y5VeHPX","name":"QdrantApi account"}}},{"parameters":{"options":{}},"id":"63af1bc0-56c9-4b29-bd2c-f3583e1f6b69","name":"Embeddings OpenAI1","type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","position":[60,720],"typeVersion":1.1,"credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{},"id":"d7736f14-171e-42bb-9fd4-d7d3b4258866","name":"Do nothing","type":"n8n-nodes-base.noOp","position":[820,2120],"typeVersion":1},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4o-mini","cachedResultName":"gpt-4o-mini"},"options":{}},"id":"a8857a44-3e5c-4d1a-9dd7-4f05b1a81b88","name":"OpenAI","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","position":[-520,2700],"typeVersion":1.2,"credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"content":"# STEP 3 - MAIN FLOW\n\n- Transform the email into Markdown format for optimal reading by the LLM model\n- Email Summarization through DeepSeek R1 (any model can be used)\n- I classify the email in such a way as to continue only with emails regarding general information about the company. In this way I can respond independently through the information obtained from the vector database\n- I create a chain where I entrust the review of the email to a high-performance model designed for this purpose\n- I send the response email\n\n\n","height":240,"width":1620},"id":"8ae3dd22-cb47-4536-a985-45ada9338d01","name":"Sticky Note","type":"n8n-nodes-base.stickyNote","position":[-540,1800],"typeVersion":1},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4o-mini","cachedResultName":"gpt-4o-mini"},"options":{}},"id":"7d1e50ba-e917-4381-9d7f-410567e05546","name":"OpenAI 4-o-mini","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","position":[180,2320],"typeVersion":1.2,"credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"resource":"fileFolder","filter":{"folderId":{"__rl":true,"value":"13KHjBRdK3CLcoo7OGRXyFq6_T83sYeHH","mode":"list","cachedResultName":"N8N TEST","cachedResultUrl":"https://drive.google.com/drive/folders/13KHjBRdK3CLcoo7OGRXyFq6_T83sYeHH"},"whatToSearch":"files","fileTypes":[]},"options":{"fields":["mimeType","id","name"]}},"type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[-1160,-560],"id":"1b28ddb2-caf8-4d37-bacc-5e0acdf18b6e","name":"Lista File","credentials":{"googleDriveOAuth2Api":{"id":"WBhAeqmWykJUM02S","name":"Google Drive account"}}},{"parameters":{"operation":"download","fileId":{"__rl":true,"value":"={{ $json.id }}","mode":"id"},"options":{}},"type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[-860,-520],"id":"03a3bb0a-06f2-4bc7-b03f-6777f75cd00f","name":"Download file","credentials":{"googleDriveOAuth2Api":{"id":"WBhAeqmWykJUM02S","name":"Google Drive account"}}},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4o-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-300,2320],"id":"bec4eb6b-e6ca-4116-9f5b-720b5a9547f5","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4o-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[40,2700],"id":"58bad566-8d6e-408e-b5b4-ad22e9498d1b","name":"OpenAI Chat Model1","credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"jsCode":"return items.map(item => {\n  const rawName = item.json.name || ''documento_senza_nome'';\n\n  // 1. Slug leggibile dal nome file\n  const baseId = rawName\n    .toLowerCase()\n    .replace(/\\.[^/.]+$/, '''')         // Rimuove estensione\n    .replace(/[^a-z0-9]+/gi, ''_'')     // Spazi e simboli ‚Üí _\n    .replace(/^_+|_+$/g, '''');         // Rimuove _ iniziali/finali\n\n  // 2. Data in formato ggmmaa\n  const now = new Date();\n  const day = String(now.getDate()).padStart(2, ''0'');\n  const month = String(now.getMonth() + 1).padStart(2, ''0'');\n  const year = String(now.getFullYear()).slice(2);\n  const date = `${day}${month}${year}`; // es: 040525\n\n  // 3. Suffisso casuale\n  const randomSuffix = Math.random().toString(36).substring(2, 6);\n\n  // 4. ID finale\n  const id = `${baseId}_${date}_${randomSuffix}`;\n\n  item.json.qdrant_id = id;\n  return item;\n});\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-300,80],"id":"2bf8970e-3c07-44f1-93df-adb02c8ab915","name":"Code"},{"parameters":{"operation":"text","destinationKey":"text","options":{}},"type":"n8n-nodes-base.extractFromFile","typeVersion":1,"position":[-420,520],"id":"30e5768a-aee0-4c74-9774-8822ff56eb41","name":"Extract from File"},{"parameters":{"mode":"combine","combineBy":"combineByPosition","options":{}},"type":"n8n-nodes-base.merge","typeVersion":3.1,"position":[-140,380],"id":"ff460b7d-4bc8-4479-9e22-74001cb37264","name":"Merge"},{"parameters":{"assignments":{"assignments":[{"id":"c74d0534-7b68-4df0-afa4-d2ee2c4c8f2d","name":"name","value":"={{ $json.name }}","type":"string"}]},"includeOtherFields":true,"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-420,320],"id":"a66ca340-d776-4176-8dbd-38fd5bca1ff8","name":"Edit Fields"},{"parameters":{"resource":"fileFolder","filter":{"folderId":{"__rl":true,"value":"13KHjBRdK3CLcoo7OGRXyFq6_T83sYeHH","mode":"list","cachedResultName":"N8N TEST","cachedResultUrl":"https://drive.google.com/drive/folders/13KHjBRdK3CLcoo7OGRXyFq6_T83sYeHH"},"whatToSearch":"files","fileTypes":[]},"options":{"fields":["mimeType","id","name"]}},"type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[-940,360],"id":"8e194c57-d113-44c1-9870-2dfbade6f332","name":"Lista File1","credentials":{"googleDriveOAuth2Api":{"id":"WBhAeqmWykJUM02S","name":"Google Drive account"}}},{"parameters":{"operation":"download","fileId":{"__rl":true,"value":"={{ $json.id }}","mode":"id"},"options":{}},"type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[-700,360],"id":"96d53553-78ba-4135-a1de-774c2ba91dfc","name":"Download file1","credentials":{"googleDriveOAuth2Api":{"id":"WBhAeqmWykJUM02S","name":"Google Drive account"}}}]', '{"Email Trigger (IMAP)":{"main":[[{"node":"Email Summarization Chain","type":"main","index":0}]]},"Qdrant Vector Store":{"ai_tool":[[{"node":"Write email","type":"ai_tool","index":0}]]},"Embeddings OpenAI":{"ai_embedding":[[{"node":"Qdrant Vector Store","type":"ai_embedding","index":0}]]},"Email Classifier":{"main":[[{"node":"Write email","type":"main","index":0}],[{"node":"Do nothing","type":"main","index":0}]]},"Email Summarization Chain":{"main":[[{"node":"Email Classifier","type":"main","index":0}]]},"Write email":{"main":[[{"node":"Review email","type":"main","index":0}]]},"Review email":{"main":[[{"node":"Send Email","type":"main","index":0}]]},"When clicking ‚ÄòTest workflow‚Äô":{"main":[[{"node":"Lista File1","type":"main","index":0}]]},"Default Data Loader":{"ai_document":[[{"node":"Qdrant Vector Store1","type":"ai_document","index":0}]]},"Token Splitter":{"ai_textSplitter":[[{"node":"Default Data Loader","type":"ai_textSplitter","index":0}]]},"Embeddings OpenAI1":{"ai_embedding":[[{"node":"Qdrant Vector Store1","type":"ai_embedding","index":0}]]},"OpenAI":{"ai_languageModel":[[{"node":"Write email","type":"ai_languageModel","index":0}]]},"OpenAI 4-o-mini":{"ai_languageModel":[[{"node":"Email Classifier","type":"ai_languageModel","index":0}]]},"Lista File":{"main":[[{"node":"Download file","type":"main","index":0}]]},"Download file":{"main":[[]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"Email Summarization Chain","type":"ai_languageModel","index":0}]]},"OpenAI Chat Model1":{"ai_languageModel":[[{"node":"Review email","type":"ai_languageModel","index":0}]]},"Extract from File":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Edit Fields":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Lista File1":{"main":[[{"node":"Download file1","type":"main","index":0}]]},"Download file1":{"main":[[{"node":"Edit Fields","type":"main","index":0},{"node":"Extract from File","type":"main","index":0}]]},"Merge":{"main":[[{"node":"Qdrant Vector Store1","type":"main","index":0}]]}}', '{"executionOrder":"v1"}', NULL, '{}', '1c5721d5-5b3e-4746-b7e8-0810764900fb', 0, NULL, NULL, '2025-05-09T12:57:27.455Z', '2025-05-13T14:30:13.000Z', false),
  ('43d885a0-5579-4b99-b0a9-67185d52db4e', 'Qdrant_Embedding_Custom', false, '[{"parameters":{"method":"POST","url":"https://8e2b658e-3b79-49f8-9774-7af3035a8fc5.europe-west3-0.gcp.cloud.qdrant.io/collections/Double/points/delete","authentication":"predefinedCredentialType","nodeCredentialType":"qdrantApi","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"{\n \"filter\": {}\n}","options":{}},"id":"ebf5e7f9-2bda-463c-9a72-5d0a10b7e49d","name":"Refresh collection","type":"n8n-nodes-base.httpRequest","position":[-1760,480],"typeVersion":4.2,"credentials":{"qdrantApi":{"id":"VEHIg9nC5Y5VeHPX","name":"QdrantApi account"}}},{"parameters":{},"id":"bed82e47-bb7e-4370-a6ad-75afd456058a","name":"When clicking \"Test workflow\"","type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[-1960,1160]},{"parameters":{"jsCode":"// Funzione per generare UUID se necessario\nfunction generateUUIDv4() {\n  return ''xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx''.replace(/[xy]/g, c => {\n    const r = Math.random() * 16 | 0;\n    const v = c === ''x'' ? r : (r & 0x3 | 0x8);\n    return v.toString(16);\n  });\n}\n\n// Elabora gli elementi di input\ntry {\n  // Verifichiamo prima che ci siano dati in input\n  const inputItems = $input.all();\n  \n  // Log per debug - verifica quanti elementi abbiamo\n  console.log(`Numero di elementi in input: ${inputItems.length}`);\n  \n  if (inputItems.length === 0) {\n    throw new Error(\"Nessun elemento in input\");\n  }\n  \n  // Log del primo elemento per vedere la struttura\n  console.log(\"Primo elemento:\", JSON.stringify(inputItems[0], null, 2));\n  \n  // Elabora ogni elemento\n  const processedItems = inputItems.map(item => {\n    // Verifica che l''item abbia la propriet√† json\n    if (!item || !item.json) {\n      console.log(\"Item senza propriet√† json:\", item);\n      return {\n        json: {\n          error: \"Elemento non valido: manca la propriet√† json\"\n        }\n      };\n    }\n    \n    const data = item.json;\n    \n    // Estrai i dati importanti o usa valori predefiniti\n    const id = data.id || generateUUIDv4();\n    \n    // Gestisci diversi formati di dati possibili\n    let payload = {};\n    let text = \"\";\n    let source = \"\";\n    let document_id = \"\";\n    let tags = [];\n    let embedding = [];\n    \n    // Caso 1: i dati sono nell''oggetto payload\n    if (data.payload) {\n      payload = data.payload;\n      text = data.payload.text || \"\";\n      source = data.payload.source || \"\";\n      document_id = data.payload.document_id || \"\";\n      tags = data.payload.tags || [];\n    } \n    // Caso 2: i dati sono direttamente nell''oggetto json\n    else {\n      text = data.text || \"\";\n      source = data.source || \"\";\n      document_id = data.document_id || \"\";\n      tags = data.tags || [];\n      payload = {\n        text: text,\n        source: source,\n        document_id: document_id,\n        tags: tags\n      };\n    }\n    \n    // Gestisci l''embedding (vettore)\n    if (data.embedding) {\n      embedding = data.embedding;\n    } else if (data.vector) {\n      embedding = data.vector;\n    }\n    \n    // Crea l''oggetto formattato per Qdrant\n    return {\n      json: {\n        id: id,\n        payload: {\n          text: text,\n          source: source,\n          document_id: document_id,\n          tags: tags,\n          date: new Date().toISOString(),\n          // Includi tutti gli altri metadati originali\n          ...payload\n        },\n        vector: embedding\n      }\n    };\n  });\n  \n  // Filtra gli elementi con errori\n  const validItems = processedItems.filter(item => !item.json.error);\n  \n  if (validItems.length === 0) {\n    throw new Error(\"Nessun elemento valido dopo l''elaborazione\");\n  }\n  \n  console.log(`Inviando ${validItems.length} elementi a Qdrant`);\n  return validItems;\n  \n} catch (error) {\n  console.error(\"Errore:\", error);\n  return [{\n    json: {\n      status: \"error\",\n      message: `Errore durante l''elaborazione: ${error.message}`,\n      stack: error.stack\n    }\n  }];\n}"},"id":"60247aac-1ef8-4816-b406-51c0d0fa2194","name":"Chunking Semantico","type":"n8n-nodes-base.code","typeVersion":1,"position":[-140,1140],"notesInFlow":true,"notes":"Questo nodo divide il testo in chunk semantici, rispettando i paragrafi e le frasi quando possibile. Crea ID univoci per ogni chunk basati sul nome del file."},{"parameters":{"batchSize":5,"options":{"reset":true}},"id":"ac4fa9f1-0086-49ac-b152-3fada87a1188","name":"Processa Batch di Chunk","type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[820,1040],"notesInFlow":true,"notes":"Questo nodo processa i chunk in batch di 5 per evitare di sovracaricare l''API di OpenAI con troppe richieste simultanee."},{"parameters":{"method":"POST","url":"https://api.openai.com/v1/embeddings","authentication":"predefinedCredentialType","nodeCredentialType":"openAiApi","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"model\": \"text-embedding-3-small\",\n  \"input\": {{ JSON.stringify($json.payload.text) }},\n  \"encoding_format\": \"float\"\n}\n","options":{}},"id":"a0f1d803-15b7-4965-8807-c76b20d0c3f6","name":"Genera Embedding con OpenAI","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[1140,1140],"notesInFlow":true,"credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}},"notes":"Questo nodo utilizza l''API OpenAI per generare gli embedding utilizzando il modello text-embedding-3-small."},{"parameters":{"jsCode":"// Otteniamo tutti gli elementi di input\nconst allItems = $input.all();\nconst results = [];\n\n// Elaboriamo ogni elemento\nfor (const inputItem of allItems) {\n  const json = inputItem.json;\n  \n  // Prendiamo tutti i metadati disponibili mantenendo la struttura originale\n  const metadata = json.metadata || {};\n  \n  // Estrazione dei tag se presenti\n  const tags = json.tags || [];\n  \n  // Verifichiamo la presenza del vettore di embedding\n  let embedding = null;\n  \n  // Estrazione dell''embedding da diverse possibili strutture\n  if (json.embedding) {\n    embedding = json.embedding;\n  } else if (json.object === \"embedding\" && Array.isArray(json.embedding)) {\n    embedding = json.embedding;\n  } else if (json.data && json.data.embedding) {\n    embedding = json.data.embedding;\n  } else if (json.data && Array.isArray(json.data) && json.data[0] && json.data[0].embedding) {\n    embedding = json.data[0].embedding;\n  } else if (json.data && Array.isArray(json.data) && json.data.length > 0) {\n    // Cerca nell''array data\n    for (const item of json.data) {\n      if (item.embedding) {\n        embedding = item.embedding;\n        break;\n      }\n    }\n  }\n  \n  // Verifica della validit√† dell''embedding\n  if (!Array.isArray(embedding)) {\n    console.log(`Elemento ${results.length + 1}: L''embedding non √® un array valido`);\n    continue; // Salta questo elemento e passa al successivo\n  }\n  \n  // Assicuriamoci di avere un ID per il chunk\n  const chunkId = json.chunkId || \n                 (metadata.source && metadata.chunkIndex ? \n                  `${metadata.source}_chunk_${metadata.chunkIndex}` : \n                  `doc_${Date.now()}_chunk_${results.length}`);\n  \n  // Testo del contenuto\n  const contentText = json.content || metadata.text || \"\";\n  \n  // Preserviamo tutti i campi originali come source, fileType, ecc.\n  const payload = {\n    // Tutti i metadati originali\n    ...metadata,\n    \n    // Aggiungiamo il testo per il retrieval se non √® gi√† presente nei metadati\n    text: contentText,\n    \n    // Preserviamo i tag se presenti\n    tags: tags,\n    \n    // Aggiungiamo campi importanti se non sono gi√† presenti nei metadati\n    ...(metadata.source === undefined && json.source && { source: json.source }),\n    ...(metadata.fileType === undefined && json.fileType && { fileType: json.fileType }),\n    ...(metadata.chunkIndex === undefined && json.chunkIndex !== undefined && { chunkIndex: json.chunkIndex }),\n    ...(metadata.totalChunks === undefined && json.totalChunks !== undefined && { totalChunks: json.totalChunks }),\n    ...(metadata.documentId === undefined && json.documentId && { documentId: json.documentId })\n  };\n  \n  // Creiamo l''oggetto punto per Qdrant secondo la struttura attesa\n  const resultItem = {\n    id: chunkId,\n    vector: embedding,\n    payload: payload\n  };\n  \n  // Aggiungiamo l''elemento elaborato all''array dei risultati\n  results.push({json: resultItem});\n}\n\n// Log del numero di elementi elaborati\nconsole.log(`Elaborati ${results.length} elementi su ${allItems.length}`);\n\n// Restituisci tutti gli elementi elaborati\nreturn results;"},"id":"a8eff505-5b01-458e-b93c-b67ce01537c9","name":"Prepara Dati per Qdrant","type":"n8n-nodes-base.code","typeVersion":1,"position":[-1960,1620],"notesInFlow":true,"notes":"Questo nodo prepara i dati per l''inserimento in Qdrant, limitando a massimo 6 campi metadata come richiesto. Include l''embedding, l''ID univoco e il payload con i metadati."},{"parameters":{"method":"PUT","url":"=https://8e2b658e-3b79-49f8-9774-7af3035a8fc5.europe-west3-0.gcp.cloud.qdrant.io/collections/UNO/points","authentication":"predefinedCredentialType","nodeCredentialType":"qdrantApi","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"contentType":"raw","rawContentType":"json","body":"={\n  \"points\": [\n    {\n      \"id\": {{ JSON.stringify($json.id) }},\n      \"vector\": {{ JSON.stringify($json.vector) }},\n      \"payload\": {\n        \"text\": {{ JSON.stringify($json.payload.text || \"\") }},\n        \"tags\": {{ JSON.stringify($json.payload.tags || []) }},\n        \"source\": {{ JSON.stringify($json.payload.source || \"\") }},\n        \"date\": {{ JSON.stringify($json.payload.date || new Date().toISOString()) }},\n        \"chunkIndex\": {{ JSON.stringify($json.payload.chunkIndex || 0) }},\n        \"totalChunks\": {{ JSON.stringify($json.payload.totalChunks || 1) }},\n        \"document_id\": {{ JSON.stringify($json.payload.document_id || \"\") }},\n        \"fileType\": {{ JSON.stringify($json.payload.fileType || \"text/plain\") }},\n        \"language\": {{ JSON.stringify($json.payload.language || \"it\") }},\n        \"contentType\": {{ JSON.stringify($json.payload.contentType || \"text/plain\") }},\n        \"characterCount\": {{ JSON.stringify($json.payload.characterCount || 0) }},\n        \"chunk_id\": {{ JSON.stringify($json.payload.chunk_id || \"\") }}\n      }\n    }\n  ]\n}","options":{}},"id":"477176c3-92c7-414a-b845-5c66907d35f5","name":"Upsert in Qdrant","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[600,1040],"notesInFlow":true,"credentials":{"qdrantApi":{"id":"VEHIg9nC5Y5VeHPX","name":"QdrantApi account"}},"notes":"{\n  \"points\": [\n    {\n      \"id\": \"{{ $json.id }}\",\n      \"vector\": {{ JSON.stringify($json.vector) }},\n      \"payload\": {\n        \"text\": {{ JSON.stringify($json.payload.text) }},\n        \"tags\": {{ JSON.stringify($json.payload.tags) }},\n        \"source\": {{ JSON.stringify($json.payload.source) }},\n        \"date\": {{ JSON.stringify($json.payload.date || $json.payload.createdAt) }},\n        \"chunkIndex\": {{ $json.payload.chunkIndex }},\n        \"totalChunks\": {{ $json.payload.totalChunks }},\n        \"document_id\": {{ JSON.stringify($json.payload.document_id) }},\n        \"fileType\": {{ JSON.stringify($json.payload.fileType) }},\n        \"language\": {{ JSON.stringify($json.payload.language) }},\n        \"contentType\": {{ JSON.stringify($json.payload.contentType) }},\n        \"characterCount\": {{ $json.payload.characterCount }},\n        \"chunk_id\": {{ JSON.stringify($json.payload.chunk_id) }},\n        \"embedding_model\": \"text-embedding-3-small\"\n      }\n    }\n  ]\n}\n"},{"parameters":{},"id":"cbc19a7f-c909-45ad-a0c4-cbf85c99a303","name":"Continua Processamento","type":"n8n-nodes-base.noOp","typeVersion":1,"position":[1140,1400],"notesInFlow":true,"notes":"Questo nodo serve come punto di continuazione e verifica del flusso. Da qui il flusso torna al nodo Processa Batch di Chunk per elaborare il prossimo set di dati."},{"parameters":{"jsCode":"// Script per creare la collezione Qdrant se non esiste ancora\ntry {\n  // Dati di configurazione\n  const collectionName = ''UNO'';\n  const vectorSize = 1536; // Dimensione vettoriale per text-embedding-3-small\n  \n  return [\n    {\n      json: {\n        collectionName: collectionName,\n        vectorSize: vectorSize\n      }\n    }\n  ];\n} catch (error) {\n  console.error(`Errore nella configurazione: ${error.message}`);\n  throw error;\n}"},"id":"645097d5-ea6a-4bf4-82b2-59d7cc21aa5d","name":"Configura Parametri","type":"n8n-nodes-base.code","typeVersion":1,"position":[-1680,680],"notesInFlow":true,"notes":"Questo nodo configura i parametri principali del workflow, come il nome della collezione Qdrant e la dimensione vettoriale per gli embedding di OpenAI text-embedding-3-small."},{"parameters":{"method":"PUT","url":"=https://8e2b658e-3b79-49f8-9774-7af3035a8fc5.europe-west3-0.gcp.cloud.qdrant.io/collections/{{ $json.collectionName }}","authentication":"predefinedCredentialType","nodeCredentialType":"qdrantApi","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Content-Type","value":"application/json"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"vectors\": {\n    \"size\": 1536,\n    \"distance\": \"Cosine\"\n  },\n  \"id_type\": \"string\"\n}\n","options":{}},"id":"ff824c41-3843-49a3-873a-4301cf5e5f12","name":"Crea Collezione Qdrant","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-1420,680],"notesInFlow":true,"credentials":{"qdrantApi":{"id":"VEHIg9nC5Y5VeHPX","name":"QdrantApi account"}},"notes":"Questo nodo crea la collezione Qdrant se non esiste gi√†. Configura la dimensione vettoriale e la metrica di distanza (Cosine)."},{"parameters":{"content":"# Motore di Embedding per Qdrant\n\nQuesto workflow implementa un motore di embedding per file di testo che processa documenti, esegue chunking semantico, genera embedding tramite OpenAI (text-embedding-3-small) e li inserisce in Qdrant.\n\n## Funzionalit√†:\n- Caricamento di file di testo da una directory\n- Chunking semantico con dimensione e overlap calcolati dinamicamente\n- Generazione di embedding con OpenAI text-embedding-3-small\n- Creazione di ID univoci basati sul titolo del file\n- Gestione di metadati (massimo 6 per file)\n- Upsert dei documenti in Qdrant\n\n## Configurazione:\n1. Impostare le credenziali di OpenAI e Qdrant\n2. Configurare il percorso della directory dei file di testo\n3. Opzionalmente modificare il nome della collezione in Qdrant","height":440,"width":500},"id":"70eddbab-b20e-4df0-96a0-22346549c930","name":"Descrizione Workflow","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-660,-20]},{"parameters":{"content":"## Processo di Chunking e Embedding\n\nIl workflow esegue le seguenti operazioni:\n\n1. Estrazione del testo dai file\n2. Calcolo dinamico di dimensione chunk e overlap (15%)\n3. Chunking semantico che rispetta paragrafi e frasi\n4. Creazione di ID univoci per ogni chunk\n5. Aggiunta di metadati limitati a 6 campi\n6. Generazione di embedding tramite OpenAI\n7. Upsert in Qdrant\n\nI chunk vengono processati in batch di 5 per evitare di sovraccaricare l''API.","height":320,"width":400},"id":"1f4a30b1-5286-4782-b112-30b4569c7173","name":"Dettagli Processo","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-1040,480]},{"parameters":{"content":"## Qdrant e Metadati\n\nLa collezione Qdrant √® configurata con:\n- Dimensione vettoriale: 1536 (text-embedding-3-small)\n- Metrica di distanza: Cosine\n\nI metadati memorizzati (max 6) includono:\n- source: nome del file\n- fileType: estensione del file\n- language: lingua del testo (default: it)\n- chunkIndex: posizione del chunk nel documento\n- totalChunks: numero totale di chunk\n- documentId: ID del documento originale","height":300,"width":400},"id":"5528b831-a8fd-429f-b267-ba2a2ed81785","name":"Configurazione Qdrant","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-140,-40]},{"parameters":{"resource":"fileFolder","filter":{"folderId":{"__rl":true,"value":"13KHjBRdK3CLcoo7OGRXyFq6_T83sYeHH","mode":"list","cachedResultName":"N8N TEST","cachedResultUrl":"https://drive.google.com/drive/folders/13KHjBRdK3CLcoo7OGRXyFq6_T83sYeHH"},"whatToSearch":"files","fileTypes":[]},"options":{"fields":["mimeType","id","name"]}},"type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[-1740,1160],"id":"8e7551f6-cb53-4187-8100-03b196161226","name":"Lista File","credentials":{"googleDriveOAuth2Api":{"id":"WBhAeqmWykJUM02S","name":"Google Drive account"}}},{"parameters":{"operation":"download","fileId":{"__rl":true,"value":"={{ $json.id }}","mode":"id"},"options":{}},"type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[-1520,1160],"id":"f312fa6a-6c86-499a-afde-4278b4368efa","name":"Download file","credentials":{"googleDriveOAuth2Api":{"id":"WBhAeqmWykJUM02S","name":"Google Drive account"}}},{"parameters":{"operation":"text","options":{}},"type":"n8n-nodes-base.extractFromFile","typeVersion":1,"position":[-1300,1260],"id":"f192a392-2d80-4d7a-bdd8-3c87925ee06c","name":"Extract from File"},{"parameters":{"mode":"combine","combineBy":"combineByPosition","options":{}},"type":"n8n-nodes-base.merge","typeVersion":3.1,"position":[-1080,1160],"id":"881a1e84-9c23-4e0a-b622-3e9ff7924fd5","name":"Merge"},{"parameters":{"assignments":{"assignments":[{"id":"c74d0534-7b68-4df0-afa4-d2ee2c4c8f2d","name":"name","value":"={{ $json.name }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-1300,1060],"id":"0de65bc8-4e75-4213-b209-b8b6c3efc6a6","name":"Edit Fields"},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4o-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-880,1300],"id":"214e3409-19e1-44e3-8701-3b7ec3ae1eae","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"mode":"combine","combineBy":"combineByPosition","options":{}},"type":"n8n-nodes-base.merge","typeVersion":3.1,"position":[-500,1140],"id":"a5e58ce1-8226-4e91-891e-cf033b62b5ed","name":"Merge1"},{"parameters":{"jsCode":"function generateUUIDv4() {\n  return ''xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx''.replace(/[xy]/g, c => {\n    const r = Math.random() * 16 | 0;\n    const v = c === ''x'' ? r : (r & 0x3 | 0x8);\n    return v.toString(16);\n  });\n}\n\ntry {\n  const items = [];\n  const report = [];\n  \n  // Funzione per determinare il tipo di file\n  function detectFileType(fileName) {\n    const extension = fileName.split(''.'').pop().toLowerCase();\n    const extensionMap = {\n      ''pdf'': ''application/pdf'',\n      ''doc'': ''application/msword'',\n      ''docx'': ''application/vnd.openxmlformats-officedocument.wordprocessingml.document'',\n      ''txt'': ''text/plain'',\n      ''csv'': ''text/csv'',\n      ''json'': ''application/json'',\n      ''html'': ''text/html'',\n      ''htm'': ''text/html'',\n      ''xml'': ''application/xml'',\n      ''md'': ''text/markdown''\n    };\n    \n    return extensionMap[extension] || ''text/plain'';\n  }\n  \n  // Funzione per determinare la lingua (semplice euristica)\n  function detectLanguage(text) {\n    // Semplice euristica per l''italiano basata su parole comuni\n    const italianWords = [''il'', ''lo'', ''la'', ''i'', ''gli'', ''le'', ''di'', ''a'', ''da'', ''in'', ''con'', ''su'', ''per'', ''tra'', ''fra'', ''questo'', ''quello'', ''tutti''];\n    const lowerText = text.toLowerCase();\n    let italianCount = 0;\n    \n    for (const word of italianWords) {\n      const regex = new RegExp(`\\\\b${word}\\\\b`, ''g'');\n      const matches = lowerText.match(regex);\n      if (matches) {\n        italianCount += matches.length;\n      }\n    }\n    \n    // Se ci sono abbastanza parole italiane, √® probabile che sia italiano\n    return italianCount > 5 ? ''it'' : ''en'';\n  }\n  \n  for (const item of $input.all()) {\n    const fileName = item.json.name;\n    const text = item.json.data;\n    const tags = item.json.output || [];\n    const totalLength = text.length;\n    const chunkSize = Math.min(Math.max(Math.floor(totalLength / 5), 1000), 2500);\n    const overlapSize = Math.floor(chunkSize * 0.15);\n    \n    // Determina fileType, language e contentType\n    const fileType = detectFileType(fileName);\n    const language = detectLanguage(text);\n    const contentType = fileType.startsWith(''text/'') ? fileType : ''text/plain'';\n    \n    const baseFileName = fileName\n      .replace(/\\.[^/.]+$/, '''')\n      .toLowerCase()\n      .replace(/[^a-z0-9]/g, ''_'');\n    const now = new Date();\n    const pad = (n) => n.toString().padStart(2, ''0'');\n    const formattedTime = `${now.getFullYear()}${pad(now.getMonth() + 1)}${pad(now.getDate())}_${pad(now.getHours())}${pad(now.getMinutes())}`;\n    const readableId = `${baseFileName}_${formattedTime}`;\n    \n    // Split text in chunks with optional overlap\n    const paragraphs = text.split(/\\n\\s*\\n/);\n    const chunks = [];\n    let currentChunk = '''';\n    \n    for (const paragraph of paragraphs) {\n      if (paragraph.length > chunkSize * 1.5) {\n        const sentences = paragraph.split(/(?<=[.!?])\\s+/);\n        for (const sentence of sentences) {\n          if (currentChunk.length + sentence.length <= chunkSize) {\n            currentChunk += sentence + '' '';\n          } else {\n            if (currentChunk.trim()) chunks.push(currentChunk.trim());\n            const words = currentChunk.split(/\\s+/);\n            const overlapWords = words.slice(-Math.floor(overlapSize / 5));\n            currentChunk = overlapWords.join('' '') + '' '' + sentence + '' '';\n          }\n        }\n      } else {\n        if (currentChunk.length + paragraph.length + 2 <= chunkSize) {\n          currentChunk += paragraph + ''\\n\\n'';\n        } else {\n          if (currentChunk.trim()) chunks.push(currentChunk.trim());\n          currentChunk = paragraph + ''\\n\\n'';\n        }\n      }\n    }\n    \n    if (currentChunk.trim()) chunks.push(currentChunk.trim());\n    \n    // Track per-file stats\n    report.push({\n      json: {\n        file: fileName,\n        chunks: chunks.length,\n        characters: totalLength,\n        tags: tags,\n        fileType: fileType,\n        language: language,\n        contentType: contentType\n      }\n    });\n    \n    // Push chunked items\n    for (let i = 0; i < chunks.length; i++) {\n      const chunkId = `${baseFileName}_chunk_${i}`;\n      const uuid = generateUUIDv4();\n      const chunkText = chunks[i];\n      const characterCount = chunkText.length;\n      \n      items.push({\n        json: {\n          id: uuid,\n          embedding: item.json.embedding,\n          payload: {\n            text: chunkText,\n            tags: tags,\n            source: fileName,\n            date: now.toISOString(),\n            chunkIndex: i,\n            totalChunks: chunks.length,\n            document_id: readableId,\n            chunk_id: chunkId,\n            fileType: fileType,\n            language: language,\n            contentType: contentType,\n            characterCount: characterCount\n          }\n        }\n      });\n    }\n  }\n  \n  // Merge processed chunks + summary report\n  return [...items, ...report];\n} catch (error) {\n  return [{\n    json: {\n      error: error.message\n    }\n  }];\n}"},"id":"0fc27ef1-0936-4d48-812d-a3931605a0d3","name":"Prepara testo per chunking","type":"n8n-nodes-base.code","typeVersion":1,"position":[-340,1140],"notesInFlow":true,"notes":"function generateUUIDv4() {\n  return ''xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx''.replace(/[xy]/g, c => {\n    const r = Math.random() * 16 | 0;\n    const v = c === ''x'' ? r : (r & 0x3 | 0x8);\n    return v.toString(16);\n  });\n}\n\ntry {\n  const items = [];\n  const report = [];\n\n  for (const item of $input.all()) {\n    const fileName = item.json.name;\n    const text = item.json.data;\n    const tags = item.json.output || [];\n\n    const totalLength = text.length;\n    const chunkSize = Math.min(Math.max(Math.floor(totalLength / 5), 1000), 2500);\n    const overlapSize = Math.floor(chunkSize * 0.15);\n\n    const baseFileName = fileName\n      .replace(/\\.[^/.]+$/, '''')\n      .toLowerCase()\n      .replace(/[^a-z0-9]/g, ''_'');\n\n    const now = new Date();\n    const pad = (n) => n.toString().padStart(2, ''0'');\n    const formattedTime = `${now.getFullYear()}${pad(now.getMonth() + 1)}${pad(now.getDate())}_${pad(now.getHours())}${pad(now.getMinutes())}`;\n    const readableId = `${baseFileName}_${formattedTime}`;\n\n    // Split text in chunks with optional overlap\n    const paragraphs = text.split(/\\n\\s*\\n/);\n    const chunks = [];\n    let currentChunk = '''';\n\n    for (const paragraph of paragraphs) {\n      if (paragraph.length > chunkSize * 1.5) {\n        const sentences = paragraph.split(/(?<=[.!?])\\s+/);\n        for (const sentence of sentences) {\n          if (currentChunk.length + sentence.length <= chunkSize) {\n            currentChunk += sentence + '' '';\n          } else {\n            if (currentChunk.trim()) chunks.push(currentChunk.trim());\n            const words = currentChunk.split(/\\s+/);\n            const overlapWords = words.slice(-Math.floor(overlapSize / 5));\n            currentChunk = overlapWords.join('' '') + '' '' + sentence + '' '';\n          }\n        }\n      } else {\n        if (currentChunk.length + paragraph.length + 2 <= chunkSize) {\n          currentChunk += paragraph + ''\\n\\n'';\n        } else {\n          if (currentChunk.trim()) chunks.push(currentChunk.trim());\n          currentChunk = paragraph + ''\\n\\n'';\n        }\n      }\n    }\n    if (currentChunk.trim()) chunks.push(currentChunk.trim());\n\n    // Track per-file stats\n    report.push({\n      json: {\n        file: fileName,\n        chunks: chunks.length,\n        characters: totalLength,\n        tags: tags\n      }\n    });\n\n    // Push chunked items\n    for (let i = 0; i < chunks.length; i++) {\n      const chunkId = `${baseFileName}_chunk_${i}`;\n      const uuid = generateUUIDv4();\n      const chunkText = chunks[i];\n\n      items.push({\n        json: {\n          id: uuid,\n          embedding: item.json.embedding,\n          payload: {\n            text: chunkText,\n            tags: tags,\n            source: fileName,\n            date: now.toISOString(),\n            chunkIndex: i,\n            totalChunks: chunks.length,\n            document_id: readableId,\n            chunk_id: chunkId\n          }\n        }\n      });\n    }\n  }\n\n  // Merge processed chunks + summary report\n  return [...items, ...report];\n} catch (error) {\n  return [{\n    json: {\n      error: error.message\n    }\n  }];\n}\n"},{"parameters":{"mode":"combine","combineBy":"combineByPosition","options":{}},"type":"n8n-nodes-base.merge","typeVersion":3.1,"position":[180,1040],"id":"3eebcf56-205f-497d-a2c8-dabe4a4fc56f","name":"Merge2"},{"parameters":{"assignments":{"assignments":[{"id":"4efb772f-877b-4b22-b564-876528f8d0ef","name":"=vectorStringified","value":"={{ JSON.stringify($json.vector) }}","type":"string"}]},"includeOtherFields":true,"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-1740,1620],"id":"c2ca5ed8-8a54-474a-b94f-8f75b295e2a6","name":"Edit Fields1"},{"parameters":{"jsCode":"return $input.all().map(item => {\n  const json = item.json;\n  const vector = json.data?.[0]?.embedding;\n\n  return {\n    json: {\n      id: json.id,\n      vector: vector,\n      payload: {\n        ...json.payload,\n        tags: json.payload.tags || [] // ‚úÖ mantiene array come [\"tag1\", \"tag2\"]\n      }\n    }\n  };\n});\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[380,1040],"id":"8f06c864-b8b1-4b83-87ec-0e8e33b72ced","name":"Code"},{"parameters":{"promptType":"define","text":"=Sei un analizzatore di documenti specializzato in rilevazione di tag per DB vettoriali in questo caso Qdrant. Analizza il testo {{ $json.data }} ed il titolo{{ $json.name }} e fornisci una lista di max sei tag formattati cosi :\nes [\"privacy\", \"trattamento_dati\", \"diritti_utente\", \"consenso\", \"normativa_privacy\", \"responsabile_trattamento\"]\ncome risultato restituisci solo la stringa \n\n[\"privacy\", \"trattamento_dati\", \"diritti_utente\", \"consenso\", \"normativa_privacy\", \"responsabile_trattamento\"]\n\n","options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.9,"position":[-840,1060],"id":"8b5e4370-d7c2-4a7c-b101-61045ee66cd7","name":"Genera TAG"}]', '{"When clicking \"Test workflow\"":{"main":[[{"node":"Lista File","type":"main","index":0}]]},"Chunking Semantico":{"main":[[{"node":"Genera Embedding con OpenAI","type":"main","index":0},{"node":"Merge2","type":"main","index":0}]]},"Processa Batch di Chunk":{"main":[[{"node":"Genera Embedding con OpenAI","type":"main","index":0}],[{"node":"Continua Processamento","type":"main","index":0}]]},"Genera Embedding con OpenAI":{"main":[[{"node":"Merge2","type":"main","index":1}]]},"Prepara Dati per Qdrant":{"main":[[{"node":"Edit Fields1","type":"main","index":0}]]},"Upsert in Qdrant":{"main":[[{"node":"Processa Batch di Chunk","type":"main","index":0}]]},"Configura Parametri":{"main":[[]]},"Lista File":{"main":[[{"node":"Download file","type":"main","index":0}]]},"Download file":{"main":[[{"node":"Extract from File","type":"main","index":0},{"node":"Edit Fields","type":"main","index":0}]]},"Extract from File":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Merge":{"main":[[{"node":"Genera TAG","type":"main","index":0},{"node":"Merge1","type":"main","index":1}]]},"Edit Fields":{"main":[[{"node":"Merge","type":"main","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"Genera TAG","type":"ai_languageModel","index":0}]]},"Merge1":{"main":[[]]},"Prepara testo per chunking":{"main":[[{"node":"Chunking Semantico","type":"main","index":0}]]},"Merge2":{"main":[[{"node":"Code","type":"main","index":0}]]},"Code":{"main":[[{"node":"Upsert in Qdrant","type":"main","index":0}]]},"Genera TAG":{"main":[[{"node":"Merge1","type":"main","index":0}]]}}', '{"executionOrder":"v1"}', NULL, '{}', 'b2d06a1a-e282-4265-96db-1d3e0aa2bbd7', 0, '{"templateCredsSetupCompleted":true}', NULL, '2025-05-09T13:00:44.811Z', '2025-06-20T11:25:05.000Z', false),
  ('8b34c8be-cb1e-4350-acdc-6bbd4a98454d', 'Document Processor_v1', false, '[{"parameters":{},"id":"b89ad83d-9670-4d4c-926f-92929b798e47","name":"Manual Trigger","type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[-2360,520],"notesInFlow":true,"notes":"Funzione: Trigger manuale che avvia il workflow a comando\n\nQuando si attiva: Quando l''utente clicca sul pulsante \"Execute Workflow\" nell''interfaccia n8n\n\nUtilizzo: Per testare l''elaborazione di un documento specifico durante lo sviluppo o verificare il\nfunzionamento del sistema"},{"parameters":{"resource":"fileFolder","filter":{"folderId":{"__rl":true,"value":"13KHjBRdK3CLcoo7OGRXyFq6_T83sYeHH","mode":"list","cachedResultName":"N8N TEST","cachedResultUrl":"https://drive.google.com/drive/folders/13KHjBRdK3CLcoo7OGRXyFq6_T83sYeHH"},"whatToSearch":"files","fileTypes":[]},"options":{"fields":["mimeType","id","name"]}},"type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[-2140,520],"id":"c95f5fee-91c0-44eb-836a-e10f03121a16","name":"Google Drive1","credentials":{"googleDriveOAuth2Api":{"id":"WBhAeqmWykJUM02S","name":"Google Drive account"}}},{"parameters":{"operation":"download","fileId":{"__rl":true,"value":"={{ $json.id }}","mode":"id"},"options":{}},"type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[-1700,520],"id":"173d32f4-b79f-45c5-bc09-c10d8c49ab5b","name":"Google Drive2","credentials":{"googleDriveOAuth2Api":{"id":"WBhAeqmWykJUM02S","name":"Google Drive account"}}},{"parameters":{"assignments":{"assignments":[{"id":"427d17f2-2811-40ab-9050-e62daaa5a9dd","name":"id","value":"={{ $json.id }}","type":"string"},{"id":"b5ba7ffa-6ffa-4533-8a4a-fc409b537c19","name":"nimetype","value":"={{ $json.mimeType }}","type":"string"},{"id":"81165e89-4f90-4362-b40b-b8f52168ceeb","name":"fileName","value":"={{ $json.name }}","type":"string"}]},"includeOtherFields":true,"include":"selected","includeFields":"mimeType,id,fileName","options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-1920,520],"id":"e55009e1-0bd2-4077-aad5-1ed386f5bf0f","name":"Edit Fields","notes":"Assegna un ID al file che facilita la ricerca nel nodo successivo per il download "},{"parameters":{"assignments":{"assignments":[{"id":"08e724a1-a393-4109-a099-ac24c400c635","name":"extension","value":"={{ $binary.data.fileName.split(''.'').pop().toLowerCase() }}","type":"string"},{"id":"9a3c89e4-8b7d-4e0e-a834-34f2396bb3a8","name":"fileName","value":"={{ $json.fileName }}","type":"string"}]},"includeOtherFields":true,"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-1300,520],"id":"b0281d20-faec-4d80-b11f-9fcf119ea7e2","name":"Exentions","notes":"Controlla l''estensione del file"},{"parameters":{"mode":"expression","numberOutputs":12,"output":"={{(() => {\n  const ext = $json.extension?.toLowerCase();\n  if (ext === ''csv'') return 0;\n  if (ext === ''html'') return 1;\n  if (ext === ''ics'') return 2;\n  if (ext === ''json'') return 3;\n  if (ext === ''ods'') return 4;\n  if (ext === ''pdf'') return 5;\n  if (ext === ''rtf'') return 6;\n  if (ext === ''txt'') return 7;\n  if (ext === ''xml'') return 8;\n  if (ext === ''xls'') return 9;\n  if (ext === ''xlsx'') return 10;\n  return 11; // default fallback\n})()}}\n\n\n"},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[-1080,340],"id":"b8a5c83f-f450-404f-b5f4-f3f987331f70","name":"Switch"},{"parameters":{"operation":"pdf","options":{}},"type":"n8n-nodes-base.extractFromFile","typeVersion":1,"position":[-640,160],"id":"b8a5331d-e832-4199-a5e5-908dffd1a1c8","name":"PDF"},{"parameters":{"operation":"fromJson","options":{}},"type":"n8n-nodes-base.extractFromFile","typeVersion":1,"position":[-620,-400],"id":"16b4ca18-d446-4fa2-86b1-0cec6e4af69e","name":"JSON"},{"parameters":{"operation":"html","options":{}},"type":"n8n-nodes-base.extractFromFile","typeVersion":1,"position":[-640,-40],"id":"db2732bd-dc41-416f-9642-253517c69c52","name":"HTML"},{"parameters":{"operation":"fromIcs","options":{}},"type":"n8n-nodes-base.extractFromFile","typeVersion":1,"position":[-640,360],"id":"3225bdae-8aa1-4c2d-a550-d23b2b8e010b","name":"ICS"},{"parameters":{"operation":"ods","options":{}},"type":"n8n-nodes-base.extractFromFile","typeVersion":1,"position":[-640,560],"id":"36f1dea5-d449-402b-bfb0-80d75a36ce9b","name":"ODS"},{"parameters":{"operation":"rtf","options":{}},"type":"n8n-nodes-base.extractFromFile","typeVersion":1,"position":[-640,760],"id":"7349262c-f083-4075-b447-6b9a31f9414a","name":"RFT"},{"parameters":{"operation":"text","options":{}},"type":"n8n-nodes-base.extractFromFile","typeVersion":1,"position":[-640,960],"id":"128c21b5-b854-4322-9dbb-e90bcc4ff0b7","name":"TXT"},{"parameters":{"operation":"xml","options":{}},"type":"n8n-nodes-base.extractFromFile","typeVersion":1,"position":[-640,1160],"id":"fba3c7d8-9aaa-404a-9683-2999f2993870","name":"XML"},{"parameters":{"operation":"xls","options":{}},"type":"n8n-nodes-base.extractFromFile","typeVersion":1,"position":[-640,1360],"id":"09d91ef5-ea42-4229-a0c9-37493e030389","name":"XLS"},{"parameters":{"operation":"xlsx","options":{"headerRow":true,"rawData":true}},"type":"n8n-nodes-base.extractFromFile","typeVersion":1,"position":[-620,1580],"id":"4dfe30fc-2439-4e97-95a6-76f467138787","name":"XLSX"},{"parameters":{"options":{}},"type":"n8n-nodes-base.extractFromFile","typeVersion":1,"position":[-640,-240],"id":"de3537ea-8369-4fbb-8a68-1572c3e04759","name":"CSV"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[300,520],"id":"810c6cff-0a36-4bae-86e1-147105a68722","name":"No Operation, do nothing"},{"parameters":{"language":"javascript","jsCode":"// Save fileName while keeping binary\nfor (const item of $input.all()) {\n  item.json.metadata = { fileName: item.json.fileName || ''unknown-file'' };\n}\nreturn $input.all();"},"id":"6717964c-1965-4c08-b625-fdcd14974390","name":"Save Metadata","type":"n8n-nodes-base.code","typeVersion":1,"position":[-1500,520]},{"parameters":{"mode":"combine","combinationMode":"mergeByPosition","options":{}},"id":"4f6766d2-4629-471e-a379-dd100fcc701e","name":"Merge PDF","type":"n8n-nodes-base.merge","typeVersion":2,"position":[-360,160]},{"parameters":{"fields":{"values":[{"name":"fileName","stringValue":"={{ $json.metadata.fileName }}"},{"name":"content","stringValue":"={{ $json.text }}"}]},"options":{}},"id":"d4476ba9-4992-4534-acda-7f5d9fb4a540","name":"Set Final PDF","type":"n8n-nodes-base.set","typeVersion":3,"position":[-140,160]},{"parameters":{"mode":"combine","combinationMode":"mergeByPosition","options":{}},"id":"edbfb515-1ed1-4668-af9b-464e9c0a7ef8","name":"Merge PDF1","type":"n8n-nodes-base.merge","typeVersion":2,"position":[-360,540]},{"parameters":{"fields":{"values":[{"name":"fileName","stringValue":"={{ $json.metadata.fileName }}"},{"name":"content","stringValue":"={{ $json.text }}"}]},"options":{}},"id":"7ea47140-08f3-45e5-adc0-211ea583c0b4","name":"Set Final PDF1","type":"n8n-nodes-base.set","typeVersion":3,"position":[-140,540]},{"parameters":{"mode":"combine","combinationMode":"mergeByPosition","options":{}},"id":"a99303a8-b225-43be-8a3f-bdc6de652e7e","name":"Merge PDF2","type":"n8n-nodes-base.merge","typeVersion":2,"position":[-360,760]},{"parameters":{"fields":{"values":[{"name":"fileName","stringValue":"={{ $json.metadata.fileName }}"},{"name":"content","stringValue":"={{ $json.text }}"}]},"options":{}},"id":"ffd3f1c8-8614-495d-aaab-aeae10b779fc","name":"Set Final PDF2","type":"n8n-nodes-base.set","typeVersion":3,"position":[-140,760]},{"parameters":{"mode":"combine","combinationMode":"mergeByPosition","options":{}},"id":"e85190d4-9e1a-41a7-9330-9943b438409d","name":"Merge PDF3","type":"n8n-nodes-base.merge","typeVersion":2,"position":[-380,960]},{"parameters":{"fields":{"values":[{"name":"fileName","stringValue":"={{ $json.metadata.fileName }}"},{"name":"content","stringValue":"={{ $json.text }}"}]},"options":{}},"id":"458354d5-8e93-409a-9a70-6c8e22ba8236","name":"Set Final PDF3","type":"n8n-nodes-base.set","typeVersion":3,"position":[-140,960]},{"parameters":{"mode":"combine","combinationMode":"mergeByPosition","options":{}},"id":"b07d57e0-11eb-46db-899e-e152d70fa355","name":"Merge PDF4","type":"n8n-nodes-base.merge","typeVersion":2,"position":[-360,1140]},{"parameters":{"fields":{"values":[{"name":"fileName","stringValue":"={{ $json.metadata.fileName }}"},{"name":"content","stringValue":"={{ $json.text }}"}]},"options":{}},"id":"05c6adc8-34eb-4f7d-a79f-fc9e26191342","name":"Set Final PDF4","type":"n8n-nodes-base.set","typeVersion":3,"position":[-140,1140]},{"parameters":{"mode":"combine","combinationMode":"mergeByPosition","options":{}},"id":"1882b40f-a2ac-4a1b-bb99-ad9aadeedb84","name":"Merge PDF5","type":"n8n-nodes-base.merge","typeVersion":2,"position":[-360,1360]},{"parameters":{"fields":{"values":[{"name":"fileName","stringValue":"={{ $json.metadata.fileName }}"},{"name":"content","stringValue":"={{ $json.text }}"}]},"options":{}},"id":"883d2b21-e29a-4e31-80ba-63ea2f553d0f","name":"Set Final PDF5","type":"n8n-nodes-base.set","typeVersion":3,"position":[-140,1360]},{"parameters":{"mode":"combine","combinationMode":"mergeByPosition","options":{}},"id":"2042bec3-e2ab-485d-8bda-607e85d2967a","name":"Merge PDF6","type":"n8n-nodes-base.merge","typeVersion":2,"position":[-380,1580]},{"parameters":{"fields":{"values":[{"name":"fileName","stringValue":"={{ $json.metadata.fileName }}"},{"name":"content","stringValue":"={{ $json.text }}"}]},"options":{}},"id":"d9ef3a69-27d4-48b9-8032-8b19e8eb734a","name":"Set Final PDF6","type":"n8n-nodes-base.set","typeVersion":3,"position":[-140,1580]},{"parameters":{"mode":"combine","combinationMode":"mergeByPosition","options":{}},"id":"c77f862c-84fa-466d-b92e-f464d6d18e02","name":"Merge PDF7","type":"n8n-nodes-base.merge","typeVersion":2,"position":[-360,340]},{"parameters":{"fields":{"values":[{"name":"fileName","stringValue":"={{ $json.metadata.fileName }}"},{"name":"content","stringValue":"={{ $json.text }}"}]},"options":{}},"id":"d826f910-9e2a-4a2c-88f0-de28603642f4","name":"Set Final PDF7","type":"n8n-nodes-base.set","typeVersion":3,"position":[-140,340]},{"parameters":{"mode":"combine","combinationMode":"mergeByPosition","options":{}},"id":"f1fe6f38-3d3a-4abf-a336-cfcbe75739b0","name":"Merge PDF8","type":"n8n-nodes-base.merge","typeVersion":2,"position":[-360,-20]},{"parameters":{"fields":{"values":[{"name":"fileName","stringValue":"={{ $json.metadata.fileName }}"},{"name":"content","stringValue":"={{ $json.text }}"}]},"options":{}},"id":"a955388d-bd82-41ab-bd7b-69373f259f7d","name":"Set Final PDF8","type":"n8n-nodes-base.set","typeVersion":3,"position":[-140,-20]},{"parameters":{"mode":"combine","combinationMode":"mergeByPosition","options":{}},"id":"64f59ead-af74-468e-8c0a-d96578f29f8a","name":"Merge PDF9","type":"n8n-nodes-base.merge","typeVersion":2,"position":[-360,-220]},{"parameters":{"fields":{"values":[{"name":"fileName","stringValue":"={{ $json.metadata.fileName }}"},{"name":"content","stringValue":"={{ $json.text }}"}]},"options":{}},"id":"8aef32af-dadc-40f7-b4c2-c8bb569d0070","name":"Set Final PDF9","type":"n8n-nodes-base.set","typeVersion":3,"position":[-140,-220]},{"parameters":{"mode":"combine","combinationMode":"mergeByPosition","options":{}},"id":"73f99cde-01e3-42d2-bc74-a4f956360c03","name":"Merge PDF10","type":"n8n-nodes-base.merge","typeVersion":2,"position":[-360,-400]},{"parameters":{"fields":{"values":[{"name":"fileName","stringValue":"={{ $json.metadata.fileName }}"},{"name":"content","stringValue":"={{ $json.text }}"}]},"options":{}},"id":"4b02f914-4bb0-45c9-8647-4eab5cb77d41","name":"Set Final PDF10","type":"n8n-nodes-base.set","typeVersion":3,"position":[-140,-400]}]', '{"Manual Trigger":{"main":[[{"node":"Google Drive1","type":"main","index":0}]]},"Google Drive1":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]},"Google Drive2":{"main":[[{"node":"Save Metadata","type":"main","index":0}]]},"Edit Fields":{"main":[[{"node":"Google Drive2","type":"main","index":0}]]},"Exentions":{"main":[[{"node":"Switch","type":"main","index":0}]]},"Switch":{"main":[[{"node":"CSV","type":"main","index":0}],[{"node":"HTML","type":"main","index":0}],[{"node":"ICS","type":"main","index":0}],[{"node":"JSON","type":"main","index":0}],[{"node":"ODS","type":"main","index":0}],[{"node":"PDF","type":"main","index":0}],[{"node":"RFT","type":"main","index":0}],[{"node":"TXT","type":"main","index":0}],[{"node":"XML","type":"main","index":0}],[{"node":"XLS","type":"main","index":0}],[{"node":"XLSX","type":"main","index":0}]]},"PDF":{"main":[[{"node":"Merge PDF","type":"main","index":0}]]},"JSON":{"main":[[{"node":"Merge PDF10","type":"main","index":0}]]},"HTML":{"main":[[{"node":"Merge PDF8","type":"main","index":0}]]},"ICS":{"main":[[{"node":"Merge PDF7","type":"main","index":0}]]},"ODS":{"main":[[{"node":"Merge PDF1","type":"main","index":0}]]},"RFT":{"main":[[{"node":"Merge PDF2","type":"main","index":0}]]},"TXT":{"main":[[{"node":"Merge PDF3","type":"main","index":0}]]},"XML":{"main":[[{"node":"Merge PDF4","type":"main","index":0}]]},"XLS":{"main":[[{"node":"Merge PDF5","type":"main","index":0}]]},"XLSX":{"main":[[{"node":"Merge PDF6","type":"main","index":0}]]},"CSV":{"main":[[{"node":"Merge PDF9","type":"main","index":0}]]},"Save Metadata":{"main":[[{"node":"Exentions","type":"main","index":0},{"node":"Merge PDF","type":"main","index":1},{"node":"Merge PDF10","type":"main","index":1},{"node":"Merge PDF9","type":"main","index":1},{"node":"Merge PDF8","type":"main","index":1},{"node":"Merge PDF7","type":"main","index":1},{"node":"Merge PDF1","type":"main","index":1},{"node":"Merge PDF5","type":"main","index":1},{"node":"Merge PDF6","type":"main","index":1},{"node":"Merge PDF4","type":"main","index":1},{"node":"Merge PDF3","type":"main","index":1},{"node":"Merge PDF2","type":"main","index":1}]]},"Merge PDF":{"main":[[{"node":"Set Final PDF","type":"main","index":0}]]},"Merge PDF1":{"main":[[{"node":"Set Final PDF1","type":"main","index":0}]]},"Merge PDF2":{"main":[[{"node":"Set Final PDF2","type":"main","index":0}]]},"Merge PDF3":{"main":[[{"node":"Set Final PDF3","type":"main","index":0}]]},"Merge PDF4":{"main":[[{"node":"Set Final PDF4","type":"main","index":0}]]},"Merge PDF5":{"main":[[{"node":"Set Final PDF5","type":"main","index":0}]]},"Merge PDF6":{"main":[[{"node":"Set Final PDF6","type":"main","index":0}]]},"Merge PDF7":{"main":[[{"node":"Set Final PDF7","type":"main","index":0}]]},"Merge PDF8":{"main":[[{"node":"Set Final PDF8","type":"main","index":0}]]},"Merge PDF9":{"main":[[{"node":"Set Final PDF9","type":"main","index":0}]]},"Merge PDF10":{"main":[[{"node":"Set Final PDF10","type":"main","index":0}]]}}', '{"executionOrder":"v1"}', NULL, '{}', '2bea23f6-0abf-4db7-af97-eeaf7708fa10', 0, '{"templateCredsSetupCompleted":true}', NULL, '2025-05-09T13:02:59.832Z', '2025-05-23T20:46:04.000Z', false),
  ('3551596a-684e-4aa9-94e4-d82704a4c2eb', 'EmbedderEngine_v1_PINECONE_AI', false, '[{"parameters":{"functionCode":"const inputItems = $input.all(); // üî• Prendi TUTTI gli input!\n\ntry {\n  // üîé Analizza tutti i documenti/chunk ricevuti\n  let totalWords = 0;\n  let totalSentences = 0;\n  let documentsProcessed = 0;\n\n  for (const item of inputItems) {\n    const inputData = item.json;\n    const possibleTexts = [\n      inputData.cleanedText,\n      inputData.text,\n      inputData.metadata?.text,\n      inputData.content,\n      inputData.metadata?.content\n    ];\n\n    const textContent = possibleTexts.find(t => typeof t === ''string'' && t.trim().length > 0) || \"\";\n\n    if (textContent) {\n      const wordCount = textContent.split(/\\s+/).filter(Boolean).length;\n      const sentenceCount = (textContent.match(/[.!?]+/g) || []).length;\n\n      totalWords += wordCount;\n      totalSentences += sentenceCount;\n      documentsProcessed++;\n    }\n  }\n\n  // ‚úÖ Se NESSUN documento ha testo valido, errore\n  if (documentsProcessed === 0) {\n    throw new Error(\"Nessun documento valido trovato. Nessun testo analizzabile.\");\n  }\n\n  const averageSentenceLength = totalSentences > 0 ? (totalWords / totalSentences).toFixed(2) : totalWords;\n\n  // üìù Report finale\n  const report = {\n    status: \"success\",\n    timestamp: new Date().toISOString(),\n    operation: \"vector_store_insert\",\n    documentsProcessed,\n    totalWords,\n    totalSentences,\n    averageSentenceLength,\n    provider: \"pinecone\",\n    embeddingModel: inputItems[0]?.json.metadata?.embeddingModel || \"text-embedding-3-small\",\n    embeddingDimensions: inputItems[0]?.json.metadata?.embeddingDimensions || 1536,\n    embeddingProvider: inputItems[0]?.json.metadata?.embeddingProvider || \"openai\",\n    namespace: inputItems[0]?.json.metadata?.namespace || \"default\",\n    indexName: \"documents-kb\",\n    chunksProcessed: $node[\"Pinecone Vector Store1\"].json?.upsertedCount || 1\n  };\n\n  console.log(\"Operazione completata con successo\", report);\n\n  return [{\n    json: {\n      report,\n      success: true,\n      message: \"Documento elaborato e inserito con successo in Pinecone\"\n    }\n  }];\n\n} catch (error) {\n  console.error(`Errore durante il monitoraggio: ${error.message}`);\n  return [{\n    json: {\n      status: \"error\",\n      error: error.message,\n      success: false,\n      message: \"Si √® verificato un errore durante l''elaborazione del documento\"\n    }\n  }];\n}\n"},"id":"287485d6-604b-465d-8fbb-a6157ca9b58b","name":"Monitor Inserimento","type":"n8n-nodes-base.function","typeVersion":1,"position":[820,0]},{"parameters":{"modelId":{"__rl":true,"value":"gpt-4o","mode":"list","cachedResultName":"GPT-4O"},"messages":{"values":[{"content":"=Sei un assistente specializzato nella preparazione dati per Pinecone Vector Database. Elabora il seguente testo per un sistema RAG di knowledge base:\n\n\"{{$json.text}}\"\n\n## Output richiesto (formato JSON compatibile con Pinecone):\n{\n  \"cleaned_text\": \"Il testo pulito e informativo va qui\",\n  \"pinecone_metadata\": {\n    \"category\": [\"categoria1\", \"categoria2\"],  // Array di stringhe principali categorie, max 3, INDICIZZATO\n    \"subcategory\": \"sottocategoria_specifica\",  // Stringa normalizzata, INDICIZZATO\n    \"entities\": [\"entit√†1\", \"entit√†2\"],  // Entit√† rilevanti menzionate, INDICIZZATO\n    \"content_type\": \"faq/description/policy/guide/manual\",  // Tipo di contenuto, INDICIZZATO\n    \"importance_level\": \"critical/high/medium/low\",  // Priorit√† dell''informazione, INDICIZZATO\n    \"contains_pricing\": true/false,  // Contiene info su prezzi, INDICIZZATO\n    \"contains_dates\": true/false,  // Contiene scadenze/date, INDICIZZATO\n    \"contains_requirements\": true/false,  // Contiene requisiti/specifiche, INDICIZZATO\n    \"contains_instructions\": true/false,  // Contiene istruzioni procedurali, INDICIZZATO\n    \"target_audience\": \"customer/technical/internal/partner\",  // Destinatario dell''informazione, INDICIZZATO\n    \"sentiment\": \"positive/neutral/negative\",  // Tono del contenuto, INDICIZZATO\n    \"keywords\": [\"parola1\", \"parola2\", \"parola3\"],  // Parole chiave, NON INDICIZZATO\n    \"complexity_level\": \"basic/intermediate/advanced\",  // Complessit√† del testo, INDICIZZATO\n    \"source_doc\": \"nome_documento\",  // Documento origine, NON INDICIZZATO\n    \"section\": \"sezione_del_documento\",  // Posizione nel documento, NON INDICIZZATO\n    \"last_updated\": \"2025-04-29\",  // Data ultimo aggiornamento, NON INDICIZZATO\n    \"word_count\": 120,  // Numero approssimativo di parole, NON INDICIZZATO\n    \"custom_fields\": {\n      // Campi personalizzati specifici del dominio, definire quali INDICIZZARE\n    }\n  }\n}\n\n## Regole pulizia testo:\n- Rimuovi metadati tecnici, intestazioni PDF, UUID, timestamp\n- Elimina righe vuote eccessive e formattazioni non essenziali\n- Mantieni solo contenuto semanticamente significativo\n- Lunghezza ottimale: 300-500 caratteri per chunk (massimo 40KB totali con metadati)\n\n## Regole metadati Pinecone:\n- Normalizza tutti i valori (lowercase, no spazi, usa underscore)\n- Limita gli array a massimo 10 elementi\n- Mantieni i nomi dei campi brevi e descrittivi\n- I campi indicizzati sono ottimizzati per filtering rapido in Pinecone\n- Non superare 64 campi indicizzati in totale\n- Evita valori null o undefined, usa array vuoti o stringhe vuote\n\nIMPORTANTE: Questo output verr√† utilizzato direttamente per operazioni Pinecone.upsert() senza ulteriori elaborazioni.\n\n\n\n"}]},"options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[0,0],"id":"e9ac0079-8b17-46a7-86c3-e2bb71daf71b","name":"Pinecone Clean & Metadata Optimizer","alwaysOutputData":true,"credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}},"notes":"Preprocessore di testi che genera:\n1) Contenuto pulito da metadati tecnici e contenuti non informativi\n2) Struttura JSON con metadati indicizzati ottimizzati per Pinecone Vector DB\n3) Campi generalisti adattabili a qualsiasi dominio\n4) Rispetta i limiti tecnici di Pinecone (40KB max, 64 campi indicizzati)\n\n"},{"parameters":{"mode":"insert","pineconeIndex":{"__rl":true,"value":"documents-kb","mode":"list","cachedResultName":"documents-kb"},"embeddingBatchSize":100,"options":{"pineconeNamespace":""}},"type":"@n8n/n8n-nodes-langchain.vectorStorePinecone","typeVersion":1.1,"position":[360,0],"id":"0a0b04c4-492b-42cb-9ea9-e2385b8fc554","name":"Pinecone Vector Store","alwaysOutputData":true,"credentials":{"pineconeApi":{"id":"PoIjlOLU2iBjw5qV","name":"PineconeApi account"}}},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1.2,"position":[280,240],"id":"39e16d61-f6f8-464b-aebf-990a4bfbc277","name":"Embeddings OpenAI","credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"jsonMode":"expressionData","jsonData":"={{ $json }}","options":{"metadata":{"metadataValues":[{"name":"documentName","value":"={{ $json.metadata.documentName || $json.metadata.fileName || ''documento.pdf'' }}"},{"name":"documentType","value":"={{ $json.metadata.documentType || $json.metadata.fileType || ''pdf'' }}"},{"name":"source","value":"={{ $json.metadata.source || ''manual_import'' }}"},{"name":"created_at","value":"={{ (() => new Date().toISOString())() }}\n"}]}}},"type":"@n8n/n8n-nodes-langchain.documentDefaultDataLoader","typeVersion":1,"position":[440,240],"id":"a78fe4fb-1ee7-4fac-b087-1d49e1254f28","name":"Default Data Loader"},{"parameters":{"chunkOverlap":250,"options":{}},"type":"@n8n/n8n-nodes-langchain.textSplitterRecursiveCharacterTextSplitter","typeVersion":1,"position":[420,420],"id":"877b30c1-0fe2-4699-a042-38b3912f3175","name":"Recursive Character Text Splitter"}]', '{"Pinecone Clean & Metadata Optimizer":{"main":[[{"node":"Pinecone Vector Store","type":"main","index":0}]]},"Pinecone Vector Store":{"main":[[{"node":"Monitor Inserimento","type":"main","index":0}]]},"Embeddings OpenAI":{"ai_embedding":[[{"node":"Pinecone Vector Store","type":"ai_embedding","index":0}]]},"Default Data Loader":{"ai_document":[[{"node":"Pinecone Vector Store","type":"ai_document","index":0}]]},"Recursive Character Text Splitter":{"ai_textSplitter":[[{"node":"Default Data Loader","type":"ai_textSplitter","index":0}]]}}', '{"executionOrder":"v1"}', NULL, '{}', '20211121-67f7-4033-896d-00c6f5d2dd7e', 0, '{"templateCredsSetupCompleted":true}', NULL, '2025-05-09T13:08:11.690Z', '2025-05-09T13:08:51.000Z', false),
  ('3d95b125-9aab-4ec6-af3e-437378212fe9', 'EMBEDDER_QDRANT_SIMPLE', false, '[{"parameters":{},"id":"b5ae7db0-6818-4d40-a90a-95756df85a3e","name":"When clicking ‚ÄòTest workflow‚Äô","type":"n8n-nodes-base.manualTrigger","position":[-780,100],"typeVersion":1},{"parameters":{"dataType":"binary","options":{"metadata":{"metadataValues":[{"name":"fileName","value":"={{ $(''Merge'').item.json.name }}"},{"name":"source","value":"GoogleDrive"}]}}},"id":"f17b3501-44fe-4d76-87f5-43eac69dce8b","name":"Default Data Loader","type":"@n8n/n8n-nodes-langchain.documentDefaultDataLoader","position":[440,322.5],"typeVersion":1},{"parameters":{"chunkOverlap":200},"id":"b8f28120-adc0-4e30-9289-c55c06e59fe4","name":"Token Splitter","type":"@n8n/n8n-nodes-langchain.textSplitterTokenSplitter","position":[528,520],"typeVersion":1},{"parameters":{"mode":"insert","qdrantCollection":{"__rl":true,"value":"=Double","mode":"id"},"options":{"collectionConfig":"=[\n  {\n    \"text\": \"{{ $json.text }}\",\n    \"metadata\": {\n      \"source\": \"{{ $json.name }}\",\n    }\n  }\n]\n"}},"id":"77b9a078-e4af-4361-887f-ec58a0b9adc0","name":"Qdrant Vector Store1","type":"@n8n/n8n-nodes-langchain.vectorStoreQdrant","position":[300,100],"typeVersion":1,"credentials":{"qdrantApi":{"id":"VEHIg9nC5Y5VeHPX","name":"QdrantApi account"}}},{"parameters":{"options":{}},"id":"c3b7dc6e-9487-4031-87b9-c16929fadacd","name":"Embeddings OpenAI1","type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","position":[260,320],"typeVersion":1.1,"credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"operation":"text","destinationKey":"text","options":{}},"type":"n8n-nodes-base.extractFromFile","typeVersion":1,"position":[-120,200],"id":"d2524bbb-de9a-4061-b3b6-7b16dbaab8f1","name":"Extract from File"},{"parameters":{"mode":"combine","combineBy":"combineByPosition","options":{}},"type":"n8n-nodes-base.merge","typeVersion":3.1,"position":[100,100],"id":"8b1a9a89-37f7-4bfb-8b9b-e5c9d17b8f35","name":"Merge"},{"parameters":{"assignments":{"assignments":[{"id":"c74d0534-7b68-4df0-afa4-d2ee2c4c8f2d","name":"name","value":"={{ $json.name }}","type":"string"}]},"includeOtherFields":true,"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-120,0],"id":"c0660b70-137f-4d0e-b344-ae0315da31ce","name":"Edit Fields"},{"parameters":{"resource":"fileFolder","filter":{"folderId":{"__rl":true,"value":"13KHjBRdK3CLcoo7OGRXyFq6_T83sYeHH","mode":"list","cachedResultName":"N8N TEST","cachedResultUrl":"https://drive.google.com/drive/folders/13KHjBRdK3CLcoo7OGRXyFq6_T83sYeHH"},"whatToSearch":"files","fileTypes":[]},"options":{"fields":["mimeType","id","name"]}},"type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[-560,100],"id":"f9fc8f3b-7ab4-464e-9f00-246e5d23b406","name":"Lista File1","credentials":{"googleDriveOAuth2Api":{"id":"WBhAeqmWykJUM02S","name":"Google Drive account"}}},{"parameters":{"operation":"download","fileId":{"__rl":true,"value":"={{ $json.id }}","mode":"id"},"options":{}},"type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[-340,100],"id":"1bdb8870-e999-495b-8600-d36c9181b8d1","name":"Download file1","credentials":{"googleDriveOAuth2Api":{"id":"WBhAeqmWykJUM02S","name":"Google Drive account"}}}]', '{"When clicking ‚ÄòTest workflow‚Äô":{"main":[[{"node":"Lista File1","type":"main","index":0}]]},"Default Data Loader":{"ai_document":[[{"node":"Qdrant Vector Store1","type":"ai_document","index":0}]]},"Token Splitter":{"ai_textSplitter":[[{"node":"Default Data Loader","type":"ai_textSplitter","index":0}]]},"Embeddings OpenAI1":{"ai_embedding":[[{"node":"Qdrant Vector Store1","type":"ai_embedding","index":0}]]},"Extract from File":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Merge":{"main":[[{"node":"Qdrant Vector Store1","type":"main","index":0}]]},"Edit Fields":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Lista File1":{"main":[[{"node":"Download file1","type":"main","index":0}]]},"Download file1":{"main":[[{"node":"Edit Fields","type":"main","index":0},{"node":"Extract from File","type":"main","index":0}]]}}', '{"executionOrder":"v1"}', NULL, '{}', '15aa92e7-46a5-4eb6-934e-3d19c83c391f', 0, NULL, NULL, '2025-05-09T22:16:36.446Z', '2025-06-20T11:24:03.000Z', false),
  ('37e1513f-fb86-4e69-ba82-a77dddc7d468', 'CHATBOT_API', false, '[{"parameters":{"model":"gpt-4.1-mini","options":{}},"id":"1525a60d-9520-4750-982d-75272fed2dc3","name":"OpenAI Chat Model","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1,"position":[-1740,400],"credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"public":true,"options":{}},"id":"bd7d08af-7e32-4b3b-b9b0-2bad9deaf5ee","name":"When chat message received","type":"@n8n/n8n-nodes-langchain.chatTrigger","typeVersion":1.1,"position":[-1880,120],"webhookId":"ae38e8b8-1425-4413-a979-f98b524bed20"},{"parameters":{"promptType":"define","text":"={{ $(''When chat message received'').item.json.chatInput }}\n","options":{"systemMessage":"Agisci come **Milena**, operatrice dell‚Äôassistenza clienti GommeGo.\n\nQuando ricevi un messaggio dal cliente, **devi scegliere il comportamento corretto in base al tipo di richiesta**:\n\n---\n\n### üì¶ Se la richiesta riguarda un ordine:\n\n1. Se il cliente **non fornisce un codice ordine (reference)**, chiedilo gentilmente.\n2. Se fornisce un codice (es. `QDOSRBMDQ`):\n   - Invia al tool `GET_ID`:\n     ```json\n     { \"reference\": \"QDOSRBMDQ\" }\n     ```\n   - Quando ricevi l‚Äôid da `GET_ID` (es. `12345`), invia al tool `GET_DETAIL`:\n     ```json\n     { \"orderId\": 12345 }\n     ```\n   - Riformula le informazioni ricevute (stato ordine, tracking, ecc.) in modo semplice e rassicurante.\n\n---\n\n### üìö Se la richiesta **NON riguarda un ordine** (es: spedizioni, pagamenti, resi, disponibilit√†):\n\n- Invia la query al tool `Answer questions with a vector store`\n- Se ricevi una risposta, riformulala in modo chiaro ed empatico.\n- Se non trovi contenuto:\n  - Se l‚Äôargomento √® noto: dai una risposta utile\n  - Se √® vago: chiedi dettagli al cliente\n\n---\n\n‚ùå Non usare `GET_ID` o `GET_DETAIL` se non c‚Äô√® un codice ordine  \n‚úÖ Usa sempre `Answer questions with a vector store` per tutto il resto\n"}},"id":"caedd027-94d8-4ad9-bf80-38dc34e57c4b","name":"RAG AI Agent","type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.6,"position":[-1420,140],"notes":"Agisci come **Milena**, operatrice dell‚Äôassistenza clienti GommeGo.\n\nQuando ricevi un messaggio dal cliente, **devi scegliere il comportamento corretto in base al tipo di richiesta**:\n\n---\n\n### üì¶ Se la richiesta riguarda un ordine:\n\n1. Se il cliente **non fornisce un codice ordine (reference)**, chiedilo gentilmente.\n2. Se fornisce un codice (es. `QDOSRBMDQ`):\n   - Invia al tool `GET_ID`:\n     ```json\n     { \"reference\": \"QDOSRBMDQ\" }\n     ```\n   - Quando ricevi l‚Äôid da `GET_ID` (es. `12345`), invia al tool `GET_DETAIL`:\n     ```json\n     { \"orderId\": 12345 }\n     ```\n   - Riformula le informazioni ricevute (stato ordine, tracking, ecc.) in modo semplice e rassicurante.\n\n---\n\n### üìö Se la richiesta **NON riguarda un ordine** (es: spedizioni, pagamenti, resi, disponibilit√†):\n\n- Invia la query al tool `Answer questions with a vector store`\n- Se ricevi una risposta, riformulala in modo chiaro ed empatico.\n- Se non trovi contenuto:\n  - Se l‚Äôargomento √® noto: dai una risposta utile\n  - Se √® vago: chiedi dettagli al cliente\n\n---\n\n‚ùå Non usare `GET_ID` o `GET_DETAIL` se non c‚Äô√® un codice ordine  \n‚úÖ Usa sempre `Answer questions with a vector store` per tutto il resto\n"},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1.3,"position":[-1560,400],"id":"7528116b-b4e9-4bd8-a4ca-8d7f4a5d757f","name":"Simple Memory"},{"parameters":{"pineconeIndex":{"__rl":true,"value":"documents-kb","mode":"list","cachedResultName":"documents-kb"},"options":{"pineconeNamespace":"2"}},"type":"@n8n/n8n-nodes-langchain.vectorStorePinecone","typeVersion":1.1,"position":[140,-220],"id":"494642c7-1541-4c1e-b9ba-08da5454ea0e","name":"Pinecone Vector Store","credentials":{"pineconeApi":{"id":"PoIjlOLU2iBjw5qV","name":"PineconeApi account"}}},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4o-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-760,460],"id":"fe249815-9015-40ef-8735-ca11a2aa843b","name":"OpenAI Chat Model1","credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"model":"text-embedding-3-large","options":{}},"type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1.2,"position":[220,-40],"id":"c54a3fb1-7421-428f-bbd9-7b8c2d4c3939","name":"Embeddings OpenAI","credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"description":"Condizioni generali di vendita di GommeGo (TEC SRL), e-commerce di pneumatici. Include: informazioni aziendali, modello di business senza magazzini propri, politiche su DOT, tempi di consegna (5-7 giorni lavorativi), garanzie, diritto di recesso (14 giorni), procedure per resi, mancate consegne e prodotti difettosi. Dettagli su spedizioni, pagamenti anticipati (72h), gestione ordini, responsabilit√† e gestione reclami. Informazioni essenziali per assistenza clienti su tutti gli aspetti del processo d''acquisto.","topK":5},"type":"@n8n/n8n-nodes-langchain.toolVectorStore","typeVersion":1.1,"position":[-1040,280],"id":"7a864479-396b-4486-924a-4bff187506f0","name":"Answer questions with a vector store"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1.2,"position":[-120,200],"id":"2138aaa6-34e5-4189-8081-b1258b51a937","name":"Embeddings OpenAI1","credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"description":"elenco di ordini su prestashop","topK":5},"type":"@n8n/n8n-nodes-langchain.toolVectorStore","typeVersion":1.1,"position":[-100,-120],"id":"bc6472ca-a83d-4fcd-8699-52635b967c94","name":"Answer questions with a vector store1"},{"parameters":{"tableName":{"__rl":true,"value":"orders_processed","mode":"list","cachedResultName":"orders_processed"},"options":{}},"type":"@n8n/n8n-nodes-langchain.vectorStoreSupabase","typeVersion":1.1,"position":[-260,40],"id":"ba42864a-761d-4220-b137-74b6d3140370","name":"Supabase Vector Store1","credentials":{"supabaseApi":{"id":"BkVV9D4yOfHR3iC4","name":"Supabase tecsolutions"}}},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4o-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[80,80],"id":"f5d01e6f-e1f3-4c8d-8531-a06841774c11","name":"OpenAI Chat Model2","credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"qdrantCollection":{"__rl":true,"value":"Double","mode":"list","cachedResultName":"Double"},"options":{}},"type":"@n8n/n8n-nodes-langchain.vectorStoreQdrant","typeVersion":1.1,"position":[-1140,440],"id":"bf5375a6-aefe-402d-b5fc-f38754e78bcc","name":"Qdrant Vector Store","credentials":{"qdrantApi":{"id":"VEHIg9nC5Y5VeHPX","name":"QdrantApi account"}}},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1.2,"position":[-1060,620],"id":"ed33da72-1da6-4ba5-9885-436269c1ebdc","name":"Embeddings OpenAI2","credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"url":"https://www.gommego.com/api/orders?filter[reference]=[XXXXXX]&output_format=JSON","authentication":"genericCredentialType","genericAuthType":"httpBasicAuth","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-60,-480],"id":"8950a023-998a-47d4-99f0-adc0e09fd5f8","name":"Acquisice Ordini da Prestashop","retryOnFail":true,"waitBetweenTries":5000,"credentials":{"httpBasicAuth":{"id":"CDYbffajBgDWgdXn","name":"Prestashop-API"}}},{"parameters":{"operation":"get","tableId":"orders_processed","filters":{"conditions":[{"keyName":"order_reference","keyValue":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI(''conditions0_Value'', `Il codice ordine fornito dal cliente, ad esempio ''QDOSRBMDQ'', da usare per cercare in Supabase nel campo order_reference.\n`, ''string'') }}"}]}},"type":"n8n-nodes-base.supabaseTool","typeVersion":1,"position":[280,-580],"id":"c8576a3a-3ec9-4a9d-bef8-50425d482659","name":"Supabase","credentials":{"supabaseApi":{"id":"BkVV9D4yOfHR3iC4","name":"Supabase tecsolutions"}}},{"parameters":{"url":"=https://www.gommego.com/api/orders","authentication":"genericCredentialType","genericAuthType":"httpBasicAuth","sendQuery":true,"queryParameters":{"parameters":[{"name":"filter[reference]","value":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI(''parameters0_Value'', `l''agent AI Fornisce il codice del cliente `, ''string'') }}"}]},"options":{}},"type":"n8n-nodes-base.httpRequestTool","typeVersion":4.2,"position":[-1440,500],"id":"c0dc31c4-bb89-4b09-b0ee-2805cbd3e6c6","name":"GET_ID","credentials":{"httpBasicAuth":{"id":"CDYbffajBgDWgdXn","name":"Prestashop-API"}}},{"parameters":{"url":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI(''URL'', `ID dell‚Äôordine passato dall‚Äôagente AI`, ''string'') }}","authentication":"genericCredentialType","genericAuthType":"httpBasicAuth","options":{}},"type":"n8n-nodes-base.httpRequestTool","typeVersion":4.2,"position":[-1240,460],"id":"be89577d-5112-464b-9e03-8e6ed966569f","name":"GET_DETAIL","credentials":{"httpBasicAuth":{"id":"CDYbffajBgDWgdXn","name":"Prestashop-API"}}},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.memoryPostgresChat","typeVersion":1.3,"position":[-2140,300],"id":"2c50144c-b7d6-4114-a43a-1164de85b682","name":"Postgres Chat Memory"},{"parameters":{"assignments":{"assignments":[{"id":"0b0b9a1b-c761-4f68-8911-549f2cde7835","name":"sessionId","value":"={{ $json.sessionId }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-1660,100],"id":"12784d11-cce7-4252-b79b-1545faf123c1","name":"Chat ID persisente"}]', '{"OpenAI Chat Model":{"ai_languageModel":[[{"node":"RAG AI Agent","type":"ai_languageModel","index":0}]]},"When chat message received":{"main":[[{"node":"Chat ID persisente","type":"main","index":0}]]},"Simple Memory":{"ai_memory":[[{"node":"RAG AI Agent","type":"ai_memory","index":0}]]},"Pinecone Vector Store":{"ai_vectorStore":[[]]},"OpenAI Chat Model1":{"ai_languageModel":[[{"node":"Answer questions with a vector store","type":"ai_languageModel","index":0}]]},"Embeddings OpenAI":{"ai_embedding":[[{"node":"Pinecone Vector Store","type":"ai_embedding","index":0}]]},"Answer questions with a vector store":{"ai_tool":[[{"node":"RAG AI Agent","type":"ai_tool","index":0}]]},"Embeddings OpenAI1":{"ai_embedding":[[{"node":"Supabase Vector Store1","type":"ai_embedding","index":0}]]},"Supabase Vector Store1":{"ai_vectorStore":[[{"node":"Answer questions with a vector store1","type":"ai_vectorStore","index":0}]]},"OpenAI Chat Model2":{"ai_languageModel":[[{"node":"Answer questions with a vector store1","type":"ai_languageModel","index":0}]]},"Qdrant Vector Store":{"ai_vectorStore":[[{"node":"Answer questions with a vector store","type":"ai_vectorStore","index":0}]]},"Embeddings OpenAI2":{"ai_embedding":[[{"node":"Qdrant Vector Store","type":"ai_embedding","index":0}]]},"Supabase":{"ai_tool":[[]]},"GET_ID":{"ai_tool":[[{"node":"RAG AI Agent","type":"ai_tool","index":0}]]},"GET_DETAIL":{"ai_tool":[[{"node":"RAG AI Agent","type":"ai_tool","index":0}]]},"Postgres Chat Memory":{"ai_memory":[[]]},"Chat ID persisente":{"main":[[{"node":"RAG AI Agent","type":"main","index":0}]]}}', '{"executionOrder":"v1"}', NULL, '{}', '5f11ff3b-e7ae-4b49-8165-582e896807e8', 0, '{"templateCredsSetupCompleted":true}', NULL, '2025-05-12T20:32:35.190Z', '2025-05-23T20:50:09.000Z', true),
  ('82178785-3751-4578-83af-2e76a419a1f4', 'CHATBOT_API _Order State', false, '[{"parameters":{"model":"gpt-4o","options":{}},"id":"8c0fca98-9c0e-4720-94b6-f11e66b5d930","name":"OpenAI Chat Model","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1,"position":[-1740,400],"credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"public":true,"options":{}},"id":"9621f755-3185-429b-ad99-4acb5fd5d209","name":"When chat message received","type":"@n8n/n8n-nodes-langchain.chatTrigger","typeVersion":1.1,"position":[-1840,140],"webhookId":"bf7c2bb6-5161-4e72-bb86-c3d808ccf774"},{"parameters":{"promptType":"define","text":"={{ $(''When chat message received'').item.json.chatInput }}\n","options":{"systemMessage":"Agisci come Milena, operatrice dell‚Äôassistenza clienti GommeGo.\n\nüéØ Il tuo obiettivo √® rassicurare sempre il cliente, con tono formale, empatico e risposte chiare.\n\n‚úÖ Stile e tono:\n- Dai del ‚ÄúLei‚Äù con cortesia.\n- Linguaggio semplice, diretto e umano.\n- Risposte concise, professionali e rassicuranti.\n- Mai citare strumenti, database, AI o tecnologie.\n- Ogni 3‚Äì4 risposte, simula un piccolo errore di battitura e correggilo.\n- Se non conosci il nome del cliente, chiedilo. Usa il nome ogni 1‚Äì2 risposte per mantenere un tono umano.\n\nüìå Inizio e chiusura:\n- Prima risposta:\n  > ‚ÄúSalve, sono Milena dell‚Äôassistenza GommeGo. Come posso aiutarLa?‚Äù\n- Quando la conversazione √® conclusa (cliente ringrazia o non emergono nuove richieste):\n  > ‚ÄúResto a disposizione, Milena ‚Äì GommeGo\\nSaluti!‚Äù\n- Non chiedere mai ‚ÄúCome posso aiutarLa ancora?‚Äù se il cliente ha gi√† ricevuto tutte le informazioni utili.\n\nüìö Gestione richieste:\n- Usa sempre il tool `Answer questions with a vector store` per comprendere ogni messaggio.\n  - Se trovi contenuto utile ‚Üí riformulalo in tono umano.\n  - Se il contenuto √® insufficiente:\n    - Se l‚Äôargomento √® noto (resi, pagamenti, spedizioni) ‚Üí rispondi comunque in modo utile.\n    - Se la domanda √® vaga o incomprensibile ‚Üí chiedi una sola volta chiarimento. Se non arriva risposta utile, chiudi.\n\nüì¶ Ordini:\n- Se il cliente chiede informazioni su un ordine:\n  - Se manca il numero d‚Äôordine ‚Üí chiedilo gentilmente.\n  - Se √® presente ‚Üí usa i tool GET_ID e GET_DETAIL.\n  - Riformula i dati ottenuti con chiarezza, tono rassicurante e linguaggio semplice.\n\n‚ùå Limitazioni:\n- Se il cliente chiede disponibilit√†, alternative, suggerimenti di acquisto o supporto commerciale:\n  - NON offrire mai suggerimenti, alternative o consulenze.\n  - NON cercare prodotti.\n  - Rispondi sempre cos√¨:\n    > ‚ÄúPer l‚Äôacquisto o informazioni sui prodotti, La invitiamo a contattare il nostro team fornitori all‚Äôindirizzo email: supplies@tecsolutions.app. Io sar√≤ lieta di supportarLa per qualsiasi ordine gi√† effettuato o richiesta di assistenza.‚Äù\n  - Dopo questa risposta, non proseguire con nuove domande. Attendi eventuali altri temi.\n\n‚ö†Ô∏è Conversazioni da chiudere:\n- Se il cliente invia messaggi incomprensibili o generici (es. ‚Äúci dei?‚Äù, frasi spezzate):\n  - NON tentare interpretazioni.\n  - Rispondi solo una volta:\n    > ‚ÄúMi scusi, non sono sicura di aver compreso la Sua richiesta. Potrebbe riformularla gentilmente?‚Äù\n  - Se non ricevi risposta utile ‚Üí chiudi la conversazione.\n- Se non emergono nuove richieste reali ‚Üí chiudi con:\n  > ‚ÄúLa saluto e resto a disposizione‚Äù ( sempre a capo rispetto alla frase )\n"}},"id":"35d09992-35c4-46c9-9ab1-b9ebbcd48384","name":"RAG AI Agent","type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.6,"position":[-1420,160],"notes":"Agisci come **Milena**, operatrice dell‚Äôassistenza clienti GommeGo.\n\nIl tuo obiettivo √® rassicurare sempre il cliente, con tono formale, empatico e risposte chiare.\n\n‚úÖ Regole fondamentali:\n- Usa sempre il ‚ÄúLei‚Äù.\n- Linguaggio semplice, diretto, umano, senza termini tecnici o scuse vaghe.\n- Prenditi carico dei problemi: offri supporto attivo e rassicurante.\n- Non citare mai strumenti, database, AI o tecnologie.\n- Se il cliente risponde con ‚Äús√¨‚Äù, ‚Äúok‚Äù, ‚Äúgrazie‚Äù, ecc., chiedi conferma solo se serve. Altrimenti considera la conversazione chiusa.\n\nüßæ Gestione delle richieste:\n- Usa **sempre** il tool `Answer questions with a vector store` per interpretare la richiesta del cliente.\n- Se il tool restituisce contenuto utile ‚Üí riformulalo in modo umano ed empatico.\n- Se il contenuto non √® sufficiente:\n  - Se l‚Äôargomento √® noto (resi, spedizioni, pagamenti) ‚Üí fornisci comunque una risposta utile.\n  - Se il messaggio √® generico o vago ‚Üí chiedi maggiori dettagli prima di rispondere.\n\n- Se il cliente chiede informazioni su un ordine:\n  - Se manca il numero d‚Äôordine ‚Üí chiedilo gentilmente.\n  - Se √® presente ‚Üí usa i tool GET_ID e GET_DETAIL.\n  - Riformula i dati ottenuti con chiarezza e tono rassicurante.\n\n- ‚ùå Se il cliente chiede disponibilit√† di prodotti, alternative, suggerimenti di acquisto o supporto nella scelta:\n  NON fornire assistenza commerciale. NON cercare prodotti. NON suggerire alternative.\n  Rispondi cos√¨:\n  > ‚ÄúPer l‚Äôacquisto o informazioni sui prodotti, La invitiamo a contattare il nostro team fornitori all‚Äôindirizzo email: supplies@tecsolutions.app. Io sar√≤ lieta di supportarLa per qualsiasi ordine gi√† effettuato o richiesta di assistenza.‚Äù\n\n- Dopo aver inviato questa risposta, **non concludere subito**. Attendi una risposta.\n  Se il cliente conferma o ringrazia (es. ‚Äúok‚Äù, ‚Äúgrazie‚Äù) ‚Üí **solo allora** chiudi con:\n  > ‚ÄúResto a disposizione, Milena ‚Äì GommeGo‚Äù\n\nüí¨ Stile di comunicazione:\n- Inizia **solo la prima risposta** con:\n  > ‚ÄúSalve, sono Milena dell‚Äôassistenza GommeGo. Come posso aiutarLa?‚Äù\n- Se non conosci il nome del cliente, chiedilo cortesemente:\n  > ‚ÄúPotrei chiederLe il Suo nome, cos√¨ posso assisterLa in modo pi√π personalizzato?‚Äù\n- Quando conosci il nome, usalo ogni 1‚Äì2 risposte per mantenere un tono umano.\n- Concludi la conversazione **solo alla fine** con:\n  > ‚ÄúResto a disposizione, Milena ‚Äì GommeGo‚Äù\n- Ogni 3‚Äì4 risposte, simula un piccolo errore di battitura (es: ‚Äúspedizone‚Äù) e correggilo subito.\n\n‚úÖ Se non hai abbastanza dati per rispondere, chiedi sempre ulteriori dettagli prima di procedere.\n\n- Quando il cliente continua a interagire ma **non introduce nuovi elementi rilevanti**, evita di prolungare la conversazione inutilmente.\n  Se la risposta precedente √® gi√† stata esaustiva e non emergono richieste nuove o chiarimenti:\n  > concludi direttamente con:\n  ‚ÄúResto a disposizione, Milena ‚Äì GommeGo‚Äù\n  Non chiedere ‚ÄúCome posso aiutarLa?‚Äù se non ci sono indizi di una richiesta attiva.\n\n"},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1.3,"position":[-480,-160],"id":"480845f9-0f5b-4e35-8262-82dc5769f444","name":"Simple Memory"},{"parameters":{"pineconeIndex":{"__rl":true,"value":"documents-kb","mode":"list","cachedResultName":"documents-kb"},"options":{"pineconeNamespace":"2"}},"type":"@n8n/n8n-nodes-langchain.vectorStorePinecone","typeVersion":1.1,"position":[140,-220],"id":"72ad21a8-16b0-482d-b512-8b1ce52448a4","name":"Pinecone Vector Store","credentials":{"pineconeApi":{"id":"PoIjlOLU2iBjw5qV","name":"PineconeApi account"}}},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4o-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-540,520],"id":"67e104d1-67d4-4844-86a2-ea27bf831ef4","name":"OpenAI Chat Model1","credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"model":"text-embedding-3-large","options":{}},"type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1.2,"position":[220,-40],"id":"71667d67-6c4b-46d1-97a1-462109bd0e80","name":"Embeddings OpenAI","credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"description":"Condizioni generali di vendita di GommeGo (TEC SRL), e-commerce di pneumatici. Include: informazioni aziendali, modello di business senza magazzini propri, politiche su DOT, tempi di consegna (5-7 giorni lavorativi), garanzie, diritto di recesso (14 giorni), procedure per resi, mancate consegne e prodotti difettosi. Dettagli su spedizioni, pagamenti anticipati (72h), gestione ordini, responsabilit√† e gestione reclami. Informazioni essenziali per assistenza clienti su tutti gli aspetti del processo d''acquisto.","topK":5},"type":"@n8n/n8n-nodes-langchain.toolVectorStore","typeVersion":1.1,"position":[-1040,340],"id":"dca6774b-7de3-4f83-9fc0-81f41d54bee1","name":"Answer questions with a vector store"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1.2,"position":[-120,200],"id":"3f8b3679-41e6-4f4a-89b0-07ba57187f8d","name":"Embeddings OpenAI1","credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"description":"elenco di ordini su prestashop","topK":5},"type":"@n8n/n8n-nodes-langchain.toolVectorStore","typeVersion":1.1,"position":[-100,-120],"id":"b4accaff-04bb-471f-a903-03f6a65f3551","name":"Answer questions with a vector store1"},{"parameters":{"tableName":{"__rl":true,"value":"orders_processed","mode":"list","cachedResultName":"orders_processed"},"options":{}},"type":"@n8n/n8n-nodes-langchain.vectorStoreSupabase","typeVersion":1.1,"position":[-260,40],"id":"6425be27-823c-406e-93e5-d7e8444327ff","name":"Supabase Vector Store1","credentials":{"supabaseApi":{"id":"BkVV9D4yOfHR3iC4","name":"Supabase tecsolutions"}}},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4o-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[80,80],"id":"0e3397f1-0ec2-4fd8-9afe-db20e7c7b7db","name":"OpenAI Chat Model2","credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"qdrantCollection":{"__rl":true,"value":"Double","mode":"list","cachedResultName":"Double"},"options":{}},"type":"@n8n/n8n-nodes-langchain.vectorStoreQdrant","typeVersion":1.1,"position":[-940,520],"id":"5a3e1138-c0ec-4e4a-be49-7f4916a595e7","name":"Qdrant Vector Store","credentials":{"qdrantApi":{"id":"VEHIg9nC5Y5VeHPX","name":"QdrantApi account"}}},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1.2,"position":[-940,760],"id":"0795f533-c04c-4d7b-972f-e33f17ea073e","name":"Embeddings OpenAI2","credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"url":"https://www.gommego.com/api/orders?filter[reference]=[XXXXXX]&output_format=JSON","authentication":"genericCredentialType","genericAuthType":"httpBasicAuth","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-60,-480],"id":"8129c18b-78a0-4695-b88c-0f46cb4cb628","name":"Acquisice Ordini da Prestashop","retryOnFail":true,"waitBetweenTries":5000,"credentials":{"httpBasicAuth":{"id":"CDYbffajBgDWgdXn","name":"Prestashop-API"}}},{"parameters":{"operation":"get","tableId":"orders_processed","filters":{"conditions":[{"keyName":"order_reference","keyValue":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI(''conditions0_Value'', `Il codice ordine fornito dal cliente, ad esempio ''QDOSRBMDQ'', da usare per cercare in Supabase nel campo order_reference.\n`, ''string'') }}"}]}},"type":"n8n-nodes-base.supabaseTool","typeVersion":1,"position":[280,-580],"id":"32a7d761-0ed2-4170-8ff2-343a8d0afa23","name":"Supabase","credentials":{"supabaseApi":{"id":"BkVV9D4yOfHR3iC4","name":"Supabase tecsolutions"}}},{"parameters":{"url":"=https://www.gommego.com/api/orders","authentication":"genericCredentialType","genericAuthType":"httpBasicAuth","sendQuery":true,"queryParameters":{"parameters":[{"name":"filter[reference]","value":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI(''parameters0_Value'', `l''agent AI Fornisce il codice del cliente `, ''string'') }}"}]},"options":{}},"type":"n8n-nodes-base.httpRequestTool","typeVersion":4.2,"position":[-1380,540],"id":"5683ddc9-2daf-4a75-9738-1a9bef61de0c","name":"GET_ID","credentials":{"httpBasicAuth":{"id":"CDYbffajBgDWgdXn","name":"Prestashop-API"}}},{"parameters":{"url":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI(''URL'', `ID dell‚Äôordine passato dall‚Äôagente AI`, ''string'') }}","authentication":"genericCredentialType","genericAuthType":"httpBasicAuth","options":{}},"type":"n8n-nodes-base.httpRequestTool","typeVersion":4.2,"position":[-1140,540],"id":"3084293e-05fc-41b4-9b50-66480ee6cf66","name":"GET_DETAIL","credentials":{"httpBasicAuth":{"id":"CDYbffajBgDWgdXn","name":"Prestashop-API"}}},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.memoryPostgresChat","typeVersion":1.3,"position":[-1600,500],"id":"3fcd09dd-b829-4ab1-a8c2-70f5ddf303d1","name":"Postgres Chat Memory","credentials":{"postgres":{"id":"3JqN7cnp8K5WZ58E","name":"Postgres account"}}},{"parameters":{"assignments":{"assignments":[{"id":"0b0b9a1b-c761-4f68-8911-549f2cde7835","name":"sessionId","value":"={{ $json.sessionId }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-1620,120],"id":"13b2b399-2d93-4604-a722-876f904bba99","name":"Chat ID persisente"}]', '{"OpenAI Chat Model":{"ai_languageModel":[[{"node":"RAG AI Agent","type":"ai_languageModel","index":0}]]},"When chat message received":{"main":[[{"node":"Chat ID persisente","type":"main","index":0}]]},"Simple Memory":{"ai_memory":[[]]},"Pinecone Vector Store":{"ai_vectorStore":[[]]},"OpenAI Chat Model1":{"ai_languageModel":[[{"node":"Answer questions with a vector store","type":"ai_languageModel","index":0}]]},"Embeddings OpenAI":{"ai_embedding":[[{"node":"Pinecone Vector Store","type":"ai_embedding","index":0}]]},"Answer questions with a vector store":{"ai_tool":[[{"node":"RAG AI Agent","type":"ai_tool","index":0}]]},"Embeddings OpenAI1":{"ai_embedding":[[{"node":"Supabase Vector Store1","type":"ai_embedding","index":0}]]},"Supabase Vector Store1":{"ai_vectorStore":[[{"node":"Answer questions with a vector store1","type":"ai_vectorStore","index":0}]]},"OpenAI Chat Model2":{"ai_languageModel":[[{"node":"Answer questions with a vector store1","type":"ai_languageModel","index":0}]]},"Qdrant Vector Store":{"ai_vectorStore":[[{"node":"Answer questions with a vector store","type":"ai_vectorStore","index":0}]]},"Embeddings OpenAI2":{"ai_embedding":[[{"node":"Qdrant Vector Store","type":"ai_embedding","index":0}]]},"Supabase":{"ai_tool":[[]]},"GET_ID":{"ai_tool":[[{"node":"RAG AI Agent","type":"ai_tool","index":0}]]},"GET_DETAIL":{"ai_tool":[[{"node":"RAG AI Agent","type":"ai_tool","index":0}]]},"Postgres Chat Memory":{"ai_memory":[[{"node":"RAG AI Agent","type":"ai_memory","index":0}]]},"Chat ID persisente":{"main":[[{"node":"RAG AI Agent","type":"main","index":0}]]}}', '{"executionOrder":"v1"}', NULL, '{}', '488f5148-3a7e-4809-8f6f-3d74e744e5e3', 0, '{"templateCredsSetupCompleted":true}', NULL, '2025-05-12T23:19:57.091Z', '2025-05-13T14:28:42.000Z', false),
  ('1c92e4ca-ba40-43c9-80fb-5e59d83d52d5', 'CHATBOT_API _orer State_mail_ok', false, '[{"parameters":{"model":"gpt-4o","options":{}},"id":"51aa7b18-bc52-4a89-bf53-b762ae682560","name":"OpenAI Chat Model","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1,"position":[-1600,320],"credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"public":true,"options":{}},"id":"f484e17c-00c5-4dae-9087-2e6683203dfe","name":"When chat message received","type":"@n8n/n8n-nodes-langchain.chatTrigger","typeVersion":1.1,"position":[-1780,100],"webhookId":"547ee462-71f1-45c2-91d0-caa8030124a2"},{"parameters":{"promptType":"define","text":"={{ $(''When chat message received'').item.json.chatInput }}\n","options":{"systemMessage":"Agisci come Milena, operatrice dell‚Äôassistenza clienti GommeGo.\n\nüéØ Obiettivo:\nOffrire assistenza con tono formale, rassicurante, chiaro ed empatico.\n\n‚úÖ Stile:\n\n* Dai sempre del \"Lei\"\n* Usa linguaggio semplice, umano, diretto\n* Ogni 3‚Äì4 risposte, simula un errore di battitura e correggilo\n* Se non conosci il nome del cliente, chiedilo con cortesia\n* Usa il nome ogni 1‚Äì2 risposte quando disponibile\n\nüü¢ Inizio:\n\n> Salve, sono Milena, come posso esserle utile?\n\nüìö **Richieste generiche (resi, pagamenti, spedizioni, condizioni di vendita...)**\n\n* Per ogni richiesta che **NON RIGUARDA UN ORDINE**, devi **obbligatoriamente** usare il tool `Answer questions with a vector store` prima di qualsiasi risposta o valutazione.\n\n  1. Usa **subito** il tool `Answer questions with a vector store` per analizzare il messaggio.\n  2. Se il contenuto √® utile ‚Üí riformulalo in tono umano, chiaro e rassicurante.\n  3. Se il contenuto √® insufficiente:\n\n     * Se l‚Äôargomento √® conosciuto ‚Üí rispondi comunque\n     * Se il messaggio √® vago o confuso ‚Üí chiedi una sola volta di chiarire\n     * Se non ricevi risposta utile ‚Üí chiudi la conversazione in modo gentile\n\n‚ùóÔ∏èNon rispondere mai direttamente se non hai consultato il tool `Answer questions with a vector store`.\nQuesto vale per ogni tema che **non riguarda un ordine**.\n\nüì¶ **Ordini**\n\n* Se manca il numero ordine ‚Üí chiedilo con cortesia\n* Se presente un riferimento (es. VPWJTKCUX):\n\n  1. Usa il tool `GET_ID` per ottenere l''ID numerico\n  2. Passa l‚ÄôID a `Detail_Orders`\n  3. Poi usa **solo i tool necessari** in base alla richiesta:\n\n     * `Get_Customer` (cliente)\n     * `Get_Address_Delivery`, `Get_Address_Invoice` (indirizzi)\n     * `Get_Order_Products` (prodotti)\n     * `Get_Order_State`, `Get_Order_History` (stato)\n     * `Get_Order_Payments`, `Get_Order_Invoices`, `Get_Order_Slips` (pagamenti, fatture, note di credito)\n\n       üëâ Non usare tutti i tool: scegli solo quelli utili alla domanda\n\n       &#x20;üëâ Riformula sempre i dati ottenuti in modo umano, rassicurante e professionale\n\nüö´ **Limitazioni ‚Äì Ambito post-vendita**\nMilena si occupa **esclusivamente di assistenza post-vendita**.\nSe il cliente chiede:\n\n* disponibilit√† di prodotti\n* alternative\n* preventivi o suggerimenti di acquisto\n* offerte commerciali\n* supporto nella scelta\n\nRispondi **solo cos√¨**:\n\n> Per proposte commerciali o informazioni sui prodotti, La invitO a contattare il nostro team di tecnici via email: [supplies@tecsolutions.org](mailto:supplies@tecsolutions.org). Io sar√≤ lieta di supportarLa per qualsiasi ordine gi√† effettuato o richiesta di assistenza.\n\n‚û°Ô∏è Dopo aver fornito questa risposta, **non proseguire oltre sull‚Äôargomento**. Attendi eventuali nuove richieste.\n\n‚ö†Ô∏è **Messaggi incomprensibili**\n\n> Mi scusi, non sono sicura di aver compreso la Sua richiesta. Potrebbe riformularla gentilmente?\n\nüîö **Chiusura**\nSe il cliente ringrazia o non emergono nuove richieste:\n\n> Resto a disposizione, Milena ‚Äì GommeGo\n> Saluti!\n"}},"id":"6314f098-f4be-483d-93de-59f637dfefb6","name":"RAG AI Agent","type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.6,"position":[-1160,100],"notes":"Agisci come **Milena**, operatrice dell‚Äôassistenza clienti GommeGo.\n\nIl tuo obiettivo √® rassicurare sempre il cliente, con tono formale, empatico e risposte chiare.\n\n‚úÖ Regole fondamentali:\n- Usa sempre il ‚ÄúLei‚Äù.\n- Linguaggio semplice, diretto, umano, senza termini tecnici o scuse vaghe.\n- Prenditi carico dei problemi: offri supporto attivo e rassicurante.\n- Non citare mai strumenti, database, AI o tecnologie.\n- Se il cliente risponde con ‚Äús√¨‚Äù, ‚Äúok‚Äù, ‚Äúgrazie‚Äù, ecc., chiedi conferma solo se serve. Altrimenti considera la conversazione chiusa.\n\nüßæ Gestione delle richieste:\n- Usa **sempre** il tool `Answer questions with a vector store` per interpretare la richiesta del cliente.\n- Se il tool restituisce contenuto utile ‚Üí riformulalo in modo umano ed empatico.\n- Se il contenuto non √® sufficiente:\n  - Se l‚Äôargomento √® noto (resi, spedizioni, pagamenti) ‚Üí fornisci comunque una risposta utile.\n  - Se il messaggio √® generico o vago ‚Üí chiedi maggiori dettagli prima di rispondere.\n\n- Se il cliente chiede informazioni su un ordine:\n  - Se manca il numero d‚Äôordine ‚Üí chiedilo gentilmente.\n  - Se √® presente ‚Üí usa i tool GET_ID e GET_DETAIL.\n  - Riformula i dati ottenuti con chiarezza e tono rassicurante.\n\n- ‚ùå Se il cliente chiede disponibilit√† di prodotti, alternative, suggerimenti di acquisto o supporto nella scelta:\n  NON fornire assistenza commerciale. NON cercare prodotti. NON suggerire alternative.\n  Rispondi cos√¨:\n  > ‚ÄúPer l‚Äôacquisto o informazioni sui prodotti, La invitiamo a contattare il nostro team fornitori all‚Äôindirizzo email: supplies@tecsolutions.app. Io sar√≤ lieta di supportarLa per qualsiasi ordine gi√† effettuato o richiesta di assistenza.‚Äù\n\n- Dopo aver inviato questa risposta, **non concludere subito**. Attendi una risposta.\n  Se il cliente conferma o ringrazia (es. ‚Äúok‚Äù, ‚Äúgrazie‚Äù) ‚Üí **solo allora** chiudi con:\n  > ‚ÄúResto a disposizione, Milena ‚Äì GommeGo‚Äù\n\nüí¨ Stile di comunicazione:\n- Inizia **solo la prima risposta** con:\n  > ‚ÄúSalve, sono Milena dell‚Äôassistenza GommeGo. Come posso aiutarLa?‚Äù\n- Se non conosci il nome del cliente, chiedilo cortesemente:\n  > ‚ÄúPotrei chiederLe il Suo nome, cos√¨ posso assisterLa in modo pi√π personalizzato?‚Äù\n- Quando conosci il nome, usalo ogni 1‚Äì2 risposte per mantenere un tono umano.\n- Concludi la conversazione **solo alla fine** con:\n  > ‚ÄúResto a disposizione, Milena ‚Äì GommeGo‚Äù\n- Ogni 3‚Äì4 risposte, simula un piccolo errore di battitura (es: ‚Äúspedizone‚Äù) e correggilo subito.\n\n‚úÖ Se non hai abbastanza dati per rispondere, chiedi sempre ulteriori dettagli prima di procedere.\n\n- Quando il cliente continua a interagire ma **non introduce nuovi elementi rilevanti**, evita di prolungare la conversazione inutilmente.\n  Se la risposta precedente √® gi√† stata esaustiva e non emergono richieste nuove o chiarimenti:\n  > concludi direttamente con:\n  ‚ÄúResto a disposizione, Milena ‚Äì GommeGo‚Äù\n  Non chiedere ‚ÄúCome posso aiutarLa?‚Äù se non ci sono indizi di una richiesta attiva.\n\n"},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4o-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-120,500],"id":"171d6271-36f4-42d1-933c-7c6f18c13076","name":"OpenAI Chat Model1","credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"description":"Condizioni generali di vendita di GommeGo (TEC SRL), e-commerce di pneumatici. Include: informazioni aziendali, modello di business senza magazzini propri, politiche su DOT, tempi di consegna (5-7 giorni lavorativi), garanzie, diritto di recesso (14 giorni), procedure per resi, mancate consegne e prodotti difettosi. Dettagli su spedizioni, pagamenti anticipati (72h), gestione ordini, responsabilit√† e gestione reclami. Informazioni essenziali per assistenza clienti su tutti gli aspetti del processo d''acquisto.","topK":5},"type":"@n8n/n8n-nodes-langchain.toolVectorStore","typeVersion":1.1,"position":[-500,280],"id":"b6bd260e-5431-46a3-9b08-3d1c8fb66976","name":"Answer questions with a vector store"},{"parameters":{"qdrantCollection":{"__rl":true,"value":"Double","mode":"list","cachedResultName":"Double"},"options":{}},"type":"@n8n/n8n-nodes-langchain.vectorStoreQdrant","typeVersion":1.1,"position":[-500,520],"id":"2166219b-529f-49b5-96b6-23f53f131095","name":"Qdrant Vector Store","credentials":{"qdrantApi":{"id":"VEHIg9nC5Y5VeHPX","name":"QdrantApi account"}}},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1.2,"position":[-280,680],"id":"f84301e3-ec09-416e-9332-8a7517c8da04","name":"Embeddings OpenAI2","credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"url":"https://www.gommego.com/api/orders?filter[reference]=[XXXXXX]&output_format=JSON","authentication":"genericCredentialType","genericAuthType":"httpBasicAuth","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-600,-520],"id":"f30064e0-ec7f-4935-b636-cb420c77e8ac","name":"Acquisice Ordini da Prestashop","retryOnFail":true,"waitBetweenTries":5000,"credentials":{"httpBasicAuth":{"id":"CDYbffajBgDWgdXn","name":"Prestashop-API"}}},{"parameters":{"url":"=https://www.gommego.com/api/orders","authentication":"genericCredentialType","genericAuthType":"httpBasicAuth","sendQuery":true,"queryParameters":{"parameters":[{"name":"filter[reference]","value":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI(''parameters0_Value'', `l''agent AI Fornisce il codice del cliente `, ''string'') }}"}]},"options":{}},"type":"n8n-nodes-base.httpRequestTool","typeVersion":4.2,"position":[-1720,720],"id":"f6e3ee72-a204-4545-8c4d-7b8abeb9e03a","name":"GET_ID","credentials":{"httpBasicAuth":{"id":"CDYbffajBgDWgdXn","name":"Prestashop-API"}}},{"parameters":{"url":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI(''URL'', `ID dell‚Äôordine passato dall‚Äôagente AI`, ''string'') }}","authentication":"genericCredentialType","genericAuthType":"httpBasicAuth","options":{}},"type":"n8n-nodes-base.httpRequestTool","typeVersion":4.2,"position":[-1560,720],"id":"83606ca1-c01a-489c-af57-03cd9de691cf","name":"GET_DETAIL","credentials":{"httpBasicAuth":{"id":"CDYbffajBgDWgdXn","name":"Prestashop-API"}}},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.memoryPostgresChat","typeVersion":1.3,"position":[-1280,300],"id":"e92db38f-2e73-4362-a345-444784d54d6b","name":"Postgres Chat Memory","credentials":{"postgres":{"id":"3JqN7cnp8K5WZ58E","name":"Postgres account"}}},{"parameters":{"url":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI(''URL'', `id viene fornito da nodo AI (es.9965)`, ''string'') }}","authentication":"genericCredentialType","genericAuthType":"httpBasicAuth","sendQuery":true,"queryParameters":{"parameters":[{}]},"options":{}},"type":"n8n-nodes-base.httpRequestTool","typeVersion":4.2,"position":[-1420,720],"id":"3bbac7d0-ac31-44bd-abfa-7c34c2a2d5de","name":"GET_CUSTOMER","credentials":{"httpBasicAuth":{"id":"CDYbffajBgDWgdXn","name":"Prestashop-API"}}},{"parameters":{"url":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI(''URL'', `id viene fornito da nodo AI (es.9965)`, ''string'') }}","authentication":"genericCredentialType","genericAuthType":"httpBasicAuth","sendQuery":true,"queryParameters":{"parameters":[{}]},"options":{}},"type":"n8n-nodes-base.httpRequestTool","typeVersion":4.2,"position":[-1100,720],"id":"f23b9137-c7c7-4480-bec0-24b199da460a","name":"GET_DELIVERY ADDRESS","credentials":{"httpBasicAuth":{"id":"CDYbffajBgDWgdXn","name":"Prestashop-API"}}},{"parameters":{"assignments":{"assignments":[{"id":"0b0b9a1b-c761-4f68-8911-549f2cde7835","name":"sessionId","value":"={{ $json.sessionId }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-1520,100],"id":"e93722fb-1796-4121-911e-76b92950ef18","name":"Chat ID persisente"},{"parameters":{"url":"GET https://api.fattureincloud.it/v2/issued_documents?type=credit_note&document_number=NC-123","options":{}},"type":"n8n-nodes-base.httpRequestTool","typeVersion":4.2,"position":[-1260,720],"id":"e29265fe-edcc-4324-9b3d-43b2ab0ebc64","name":"Get-invoice"}]', '{"OpenAI Chat Model":{"ai_languageModel":[[{"node":"RAG AI Agent","type":"ai_languageModel","index":0}]]},"When chat message received":{"main":[[{"node":"Chat ID persisente","type":"main","index":0}]]},"OpenAI Chat Model1":{"ai_languageModel":[[{"node":"Answer questions with a vector store","type":"ai_languageModel","index":0}]]},"Answer questions with a vector store":{"ai_tool":[[{"node":"RAG AI Agent","type":"ai_tool","index":0}]]},"Qdrant Vector Store":{"ai_vectorStore":[[{"node":"Answer questions with a vector store","type":"ai_vectorStore","index":0}]]},"Embeddings OpenAI2":{"ai_embedding":[[{"node":"Qdrant Vector Store","type":"ai_embedding","index":0}]]},"GET_ID":{"ai_tool":[[{"node":"RAG AI Agent","type":"ai_tool","index":0}]]},"GET_DETAIL":{"ai_tool":[[{"node":"RAG AI Agent","type":"ai_tool","index":0}]]},"Postgres Chat Memory":{"ai_memory":[[{"node":"RAG AI Agent","type":"ai_memory","index":0}]]},"GET_CUSTOMER":{"ai_tool":[[{"node":"RAG AI Agent","type":"ai_tool","index":0}]]},"GET_DELIVERY ADDRESS":{"ai_tool":[[{"node":"RAG AI Agent","type":"ai_tool","index":0}]]},"Chat ID persisente":{"main":[[{"node":"RAG AI Agent","type":"main","index":0}]]},"Get-invoice":{"ai_tool":[[{"node":"RAG AI Agent","type":"ai_tool","index":0}]]}}', '{"executionOrder":"v1"}', NULL, '{}', 'f47c3178-5c9f-4a2e-b9ca-2d019feb8553', 0, '{"templateCredsSetupCompleted":true}', NULL, '2025-05-13T11:27:40.949Z', '2025-05-13T22:09:23.000Z', false),
  ('b5409d10-1a11-4789-8e81-6cd102dfd317', 'MAIL_AGENT_API _beta', false, '[{"parameters":{"url":"https://www.gommego.com/api/orders?filter[reference]=[XXXXXX]&output_format=JSON","authentication":"genericCredentialType","genericAuthType":"httpBasicAuth","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-600,-520],"id":"5ba613c5-9810-47ae-b5cf-394c127ff900","name":"Acquisice Ordini da Prestashop","retryOnFail":true,"waitBetweenTries":5000,"credentials":{"httpBasicAuth":{"id":"CDYbffajBgDWgdXn","name":"Prestashop-API"}}},{"parameters":{"options":{"customEmailConfig":"[\"UNSEEN\"]"}},"id":"1a748cc0-ec4a-4539-8e60-d102efaeaeee","name":"Email Trigger (IMAP)","type":"n8n-nodes-base.emailReadImap","position":[-1880,860],"typeVersion":2,"credentials":{"imap":{"id":"VoojIkqtfMuLmw81","name":"IMAP account"}}},{"parameters":{"html":"={{ $json.textHtml }}","options":{}},"id":"21b7617d-4bc8-45c6-a976-fff5e06731a4","name":"Markdown","type":"n8n-nodes-base.markdown","position":[-600,-260],"typeVersion":1},{"parameters":{"fromEmail":"={{ $(''Email Trigger (IMAP)'').item.json.to }}","toEmail":"={{ $(''Email Trigger (IMAP)'').item.json.from }}","subject":"=Re: {{ $(''Email Trigger (IMAP)'').item.json.subject }}","html":"={{ $json.text }}","options":{"appendAttribution":false,"replyTo":"={{ $(''Email Classifier'').item.json.mittente }}"}},"id":"0db46165-2892-42cc-a5cb-0ded613e4c41","name":"Send Email","type":"n8n-nodes-base.emailSend","position":[-600,0],"typeVersion":2.1,"webhookId":"6d516508-23f2-43f2-bb3b-1bc60bc0c855","credentials":{"smtp":{"id":"ognxP8WoHebaMOsi","name":"SMTP INVIO GommeGo"}}},{"parameters":{"inputText":"=Devi classificare le seguenti mail \n\n{{$json.testo}}{{ $json.oggetto }}\n","categories":{"categories":[{"category":"Info Ordini","description":"Richiesta Info Ordini"},{"category":"Richieste commerciali","description":"preventivi"},{"category":"Informazioni generali","description":"Info"},{"category":"Segnalazioni  errori ","description":"errori e malfunzionamenti"},{"category":"Resi e restituzioni","description":"resi e restituzioni"}]},"options":{"multiClass":false,"fallback":"other","systemPromptTemplate":"Per favore, classifica il testo fornito in una delle seguenti categorie: {categories}.\nNon spiegare nulla, restituisci solo il risultato in JSON.\n\nEsempi:\n- Se si parla di un ordine, spedizione, pagamento, recesso ‚Üí \"Info Ordini\"\n- Se si chiede disponibilit√† o preventivo ‚Üí \"Richieste commerciali\"\n- Se il messaggio √® generico, vago o amministrativo ‚Üí \"Informazioni generali\"\n\n","enableAutoFixing":true}},"id":"3ec7728d-e819-4299-b65f-59f93b7ee329","name":"Email Classifier","type":"@n8n/n8n-nodes-langchain.textClassifier","position":[-1260,860],"typeVersion":1},{"parameters":{"operationMode":"nodeInputBinary","options":{"binaryDataKey":"={{ $json.textPlain }}","summarizationMethodAndPrompts":{"values":{"combineMapPrompt":"=Scrivi un riassunto conciso del seguente testo in massimo 100 parole :\n\n\"{{ $json.textPlain }}\"\n","prompt":"=Scrivi un riassunto conciso del seguente testo in massimo 100 parole:\n\n\"{{ $json.textPlain }}\"\n\nNon inserire il numero di parole utilizzate"}}}},"id":"b95482e4-4219-4a42-9344-16519c19ac44","name":"Email Summarization Chain","type":"@n8n/n8n-nodes-langchain.chainSummarization","position":[-260,40],"typeVersion":2},{"parameters":{"promptType":"define","text":"=Write the text to reply to the following email from a customer:\n\nSubject: {{$json.oggetto}}\nFrom: {{$json.mittente}}\nMessage: {{$json.testo}}\n","options":{"systemMessage":"üéØ RUOLO:\nAgisci come Milena, assistente post-vendita di GommeGo.  \nRispondi alle email dei clienti con tono formale, empatico e rassicurante.  \nIl tuo compito √® redigere una bozza di risposta chiara, professionale e umana (massimo 100 parole), che sar√† revisionata prima dell‚Äôinvio.\n\n---\n\nüì¶ ORDINI:\n1. Usa il tool `GET_ID` per ottenere l‚ÄôID numerico dell‚Äôordine dal codice (es. ATADXSZQS).\n2. Passa l‚ÄôID al tool `GET_DETAIL`.\n\n3. Analizza i dati ottenuti da `GET_DETAIL`:\n   - Data ordine (`date_add`)\n   - Tracking: verifica se `shipping_number` o `note` sono compilati, ma **non riportarli nel testo**\n   - Stato ordine (`current_state`) ‚Üí mappalo secondo la tabella seguente:\n\n\"2\": \"Pagamento accettato\"  \n\"3\": \"Elaborazione ‚Äì In attesa conferma di stock\"  \n\"4\": \"Spedizione in preparazione\"  \n\"5\": \"Consegnato\"  \n\"6\": \"Annullato\"  \n\"7\": \"Rimborsato\"  \n\"8\": \"Errore di pagamento\"  \n\"9\": \"In attesa di rifornimento\"  \n\"10\": \"In attesa di pagamento con bonifico bancario\"  \n\"14\": \"MultiSafepay Pagamento sospeso\"  \n\"15\": \"MultiSafepay Rimborso Parziale\"  \n\"16\": \"In attesa di pagamento con PayPal\"  \n\"17\": \"In attesa di pagamento con carta di credito\"  \n\"18\": \"In attesa di pagamento con metodo di pagamento locale\"  \n\"20\": \"Rimborso parziale\"  \n\"26\": \"Prove tecniche\"  \n\"27\": \"Annullato per mancato pagamento\"  \n\"28\": \"In transito ‚Äì link di tracciamento inviato\"  \n\"29\": \"Consegnato parzialmente\"  \n\"30\": \"In attesa emissione buono o rimborso\"  \n\"31\": \"In consegna\"  \n\"32\": \"Richiesta reso da cliente\"  \n\"35\": \"Destinatario assente\"\n\nConsidera **‚Äú28‚Äù e ‚Äú31‚Äù come gi√† spedito**, anche se `delivery_date` √® vuoto.\n\n‚ùóNon includere mai `note` o `shipping_number` nel testo della risposta.  \nPuoi dire che l‚Äôordine √® stato spedito, ma **non mostrare il tracking visibile**.\n\n---\n\nüìö POLICY AZIENDALI:\nUsa **sempre il tool `Vector`** per verificare:\n- Condizioni di recesso\n- Tempi di consegna\n- Garanzie e rimborsi\n- Limitazioni aziendali\n\n‚ùå Se le policy del `Vector` non confermano che √® possibile procedere con recesso o rimborso, **non proporli**.  \n‚úÖ In caso di ordine in corso/spedito, rassicura il cliente, conferma che la procedura √® regolare e il pagamento √® tracciato.\n\n---\n\nüó£Ô∏è STILE MILENA:\n- Dai sempre del ‚ÄúLei‚Äù\n- Linguaggio semplice, chiaro, empatico, formale e rassicurante\n- Tono umano, mai freddo n√© robotico\n- Mostra sempre disponibilit√† e vicinanza (es. ‚ÄúCapisco perfettamente‚Äù, ‚ÄúSiamo qui per aiutarLa‚Äù)\n- Ogni 3‚Äì4 risposte, simula un piccolo errore di battitura e correggilo\n- Non usare parole negative: evita ‚Äúritardo‚Äù, ‚Äúproblema‚Äù, ‚Äúci scusiamo‚Äù\n- Non includere saluti finali o firme (saranno aggiunti da un secondo agente)\n\n---\n\nüì§ OUTPUT:\nScrivi solo la bozza della risposta, gi√† pronta per essere inviata.  \nNon aggiungere spiegazioni, titoli o istruzioni tecniche.\n"}},"id":"41c523db-7c43-43ca-a12a-59b2ec1226d9","name":"Write email","type":"@n8n/n8n-nodes-langchain.agent","position":[-520,1200],"typeVersion":1.7},{"parameters":{"promptType":"define","text":"=Review at the following email:\n\n{{ $json.output }}","hasOutputParser":true,"messages":{"messageValues":[{"message":"=Sei un revisore esperto nella preparazione di email da inviare ai clienti.  \nIl tuo compito √® riformattare e correggere il testo in modo che sia professionale, rassicurante e pronto per l''invio.\n\n‚úèÔ∏è Linee guida:\n- Trasforma il testo in formato **HTML valido**, pronto per essere inserito direttamente in un''email.\n- Usa tag come `<p>`, `<b>`, `<br>`, `<ul>`, `<li>` solo se realmente utili e **non includere delimitatori Markdown** (es: ```html).\n- Mantieni il tono **formale**, **umano** ed **empatico**, in linea con lo stile di Milena ‚Äì GommeGo.\n- Non modificare i contenuti sostanziali della risposta, ma migliora grammatica, struttura e leggibilit√†.\n- **Non superare 100 parole.**\n- ‚ùå Non aggiungere saluti, firme, chiusure o frasi non presenti nel testo originale.\n\nüì§ Output:\nRestituisci **solo** il testo HTML finale, **senza** codice aggiuntivo o spiegazioni.\n\n"}]}},"id":"52b3247c-9cda-4ea6-a227-5c1960f1fb67","name":"Review email","type":"@n8n/n8n-nodes-langchain.chainLlm","position":[-120,1200],"typeVersion":1.5},{"parameters":{},"id":"7189f8a9-419f-4330-96c4-7f4107a62ecd","name":"Do nothing","type":"n8n-nodes-base.noOp","position":[240,820],"typeVersion":1},{"parameters":{"model":{"__rl":true,"value":"gpt-4-turbo","mode":"list","cachedResultName":"gpt-4-turbo"},"options":{}},"id":"4384ffd7-c17c-49bd-a799-f444d33a0d6f","name":"OpenAI 4-o-mini","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","position":[-1300,1060],"typeVersion":1.2,"credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4o-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[20,180],"id":"69e75a21-dc68-41d7-bb28-2e83fdbfa0b6","name":"OpenAI Chat Model2","credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4o-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-100,1460],"id":"9dbbb127-31a0-4239-918f-7a3283def01e","name":"OpenAI Chat Model3","credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"url":"=https://www.gommego.com/api/orders","authentication":"genericCredentialType","genericAuthType":"httpBasicAuth","sendQuery":true,"queryParameters":{"parameters":[{"name":"filter[reference]","value":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI(''parameters0_Value'', `l''agent AI Fornisce il codice del cliente `, ''string'') }}"}]},"options":{}},"type":"n8n-nodes-base.httpRequestTool","typeVersion":4.2,"position":[-720,1440],"id":"3a5562fc-307f-4bf4-855c-7b9c03971540","name":"GET_ID1","credentials":{"httpBasicAuth":{"id":"CDYbffajBgDWgdXn","name":"Prestashop-API"}}},{"parameters":{"model":{"__rl":true,"value":"gpt-4o","mode":"list","cachedResultName":"gpt-4o"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-860,1440],"id":"14dda92d-0be6-4f23-8c8f-288ab544150b","name":"OpenAI Chat Model4","credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"url":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI(''URL'', `ID dell‚Äôordine passato dall‚Äôagente AI`, ''string'') }}","authentication":"genericCredentialType","genericAuthType":"httpBasicAuth","options":{}},"type":"n8n-nodes-base.httpRequestTool","typeVersion":4.2,"position":[-580,1460],"id":"b656dfc6-a143-4b5a-bcff-261495e2b874","name":"GET_DETAIL1","credentials":{"httpBasicAuth":{"id":"CDYbffajBgDWgdXn","name":"Prestashop-API"}}},{"parameters":{"url":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI(''URL'', `id viene fornito da nodo AI (es.9965)`, ''string'') }}","authentication":"genericCredentialType","genericAuthType":"httpBasicAuth","sendQuery":true,"queryParameters":{"parameters":[{}]},"options":{}},"type":"n8n-nodes-base.httpRequestTool","typeVersion":4.2,"position":[-1280,1720],"id":"a2bfae46-43bb-4b0e-9c79-8977d93dca6c","name":"GET_CUSTOMER1","credentials":{"httpBasicAuth":{"id":"CDYbffajBgDWgdXn","name":"Prestashop-API"}}},{"parameters":{"url":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI(''URL'', `id viene fornito da nodo AI (es.9965)`, ''string'') }}","authentication":"genericCredentialType","genericAuthType":"httpBasicAuth","sendQuery":true,"queryParameters":{"parameters":[{}]},"options":{}},"type":"n8n-nodes-base.httpRequestTool","typeVersion":4.2,"position":[-1160,1720],"id":"57ba9d88-baaa-4da8-a1d4-3cb2f04441ab","name":"GET_DELIVERY ADDRESS1","credentials":{"httpBasicAuth":{"id":"CDYbffajBgDWgdXn","name":"Prestashop-API"}}},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1.2,"position":[-420,1560],"id":"76ae5383-338d-4961-85f9-4d60654935a9","name":"Embeddings OpenAI3","credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{},"type":"n8n-nodes-base.limit","typeVersion":1,"position":[-1680,860],"id":"aeb7809f-9db4-40eb-b5e9-8c34283dc163","name":"Limit"},{"parameters":{"mode":"retrieve-as-tool","toolName":"Vector","toolDescription":"Recupera le condizioni aziendali da mostrare all‚Äôagente per ogni risposta.","qdrantCollection":{"__rl":true,"value":"Double","mode":"list","cachedResultName":"Double"},"topK":10,"options":{}},"type":"@n8n/n8n-nodes-langchain.vectorStoreQdrant","typeVersion":1.1,"position":[-440,1420],"id":"69d0210d-26ef-465d-82a7-ac4beeffbbb1","name":"Qdrant Vector Store","credentials":{"qdrantApi":{"id":"VEHIg9nC5Y5VeHPX","name":"QdrantApi account"}}},{"parameters":{"jsCode":"return [\n  {\n    json: {\n      mittente: $json.from || '''',\n      oggetto: $json.subject || '''',\n      testo: $json.textPlain || $json.textHtml || ''''\n    }\n  }\n];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-1440,740],"id":"8ceec1d9-238a-4897-a4d6-d3c88493a6a1","name":"Formatta mail"},{"parameters":{"mode":"combine","combineBy":"combineByPosition","options":{}},"type":"n8n-nodes-base.merge","typeVersion":3.1,"position":[540,1040],"id":"7a63fd2e-e6ed-4156-a69f-b33eb82eaeee","name":"Merge"},{"parameters":{"assignments":{"assignments":[{"id":"e2e246d2-121c-46d6-9877-bfe89e8e3d84","name":"mittente","value":"={{ $json.mittente }}","type":"string"},{"id":"467d7417-6fd7-4187-8b04-85386f06ae31","name":"oggetto","value":"={{ $json.oggetto }}","type":"string"},{"id":"9c722cfc-cc87-4dd5-9373-a70d850e9d32","name":"text","value":"={{ $json.text }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[720,1040],"id":"688848fa-287a-469b-852d-d7ceb8699d2a","name":"Edit Fields"},{"parameters":{"functionCode":"return [\n  {\n    json: {\n      nome: $input.item.json.mittente,\n      email_destinatario: $input.item.json.mittente,\n      oggetto: $input.item.json.oggetto,\n      corpo: $input.item.json.text\n    }\n  }\n];"},"id":"c37fa756-165e-4940-9d07-7f2a5026779b","name":"Input Email Data1","type":"n8n-nodes-base.function","typeVersion":1,"position":[940,1040]},{"parameters":{"url":"https://i.ibb.co/QFNDm6xL/White-and-Teal-Minimalist-Marketing-Email-Signature.png","responseFormat":"file","options":{}},"id":"1dd4b946-76ca-4939-9cb4-b6028a1ac015","name":"Download Signature1","type":"n8n-nodes-base.httpRequest","typeVersion":1,"position":[1160,1040]},{"parameters":{"fromEmail":"info@gommego.com","toEmail":"={{$json[\"email_destinatario\"]}}","subject":"={{$json[\"oggetto\"]}}","html":"=<div style=\"background-color: #ffffff; font-family: Arial, sans-serif; padding: 20px; font-size: 15px; color: #000;\">\n  {{ $json[\"corpo\"] }}\n  <br><br>\n  <img src=\"https://i.ibb.co/QFNDm6xL/White-and-Teal-Minimalist-Marketing-Email-Signature.png\" alt=\"Firma Milena Dobrev\" width=\"350\" />\n</div>","options":{}},"id":"a8fc3ea8-c8f6-48e4-996b-7a6aef34426a","name":"Send Email2","type":"n8n-nodes-base.emailSend","typeVersion":1,"position":[1460,1020],"credentials":{"smtp":{"id":"ognxP8WoHebaMOsi","name":"SMTP INVIO GommeGo"}}},{"parameters":{"jsCode":"const mittente = $json.from || '''';\nconst oggetto = $json.subject || '''';\nconst testo = $json.textPlain || '''';\n\nconst righe = testo.split(''\\n'');\n\n// Trova il punto dove inizia la mail citata\nconst indiceFineRisposta = righe.findIndex(riga => {\n  const r = riga.toLowerCase();\n  return r.startsWith(''il giorno'') || r.startsWith(''on '') || r.includes(''ha scritto:'') || r.startsWith(''from:'');\n});\n\n// Prende solo le righe prima della conversazione citata\nconst nuovaRisposta = indiceFineRisposta !== -1\n  ? righe.slice(0, indiceFineRisposta).join(''\\n'').trim()\n  : testo.trim();\n\n// Determina se √® una risposta (RE o inReplyTo)\nconst isReply = oggetto.toLowerCase().startsWith(''re'') || !!$json.inReplyTo;\n\nreturn [{\n  json: {\n    isThreadReply: isReply,\n    mittente,\n    oggetto,\n    nuova_risposta: nuovaRisposta,\n    thread_storico: indiceFineRisposta !== -1 ? righe.slice(indiceFineRisposta).join(''\\n'').trim() : ''''\n  }\n}];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-1100,420],"id":"d39bd773-e224-46f0-9a36-7fcb4ec0207c","name":"Code"}]', '{"Email Trigger (IMAP)":{"main":[[{"node":"Limit","type":"main","index":0}]]},"Email Classifier":{"main":[[{"node":"Write email","type":"main","index":0}],[],[{"node":"Write email","type":"main","index":0}],[],[{"node":"Do nothing","type":"main","index":0},{"node":"Write email","type":"main","index":0}]]},"Email Summarization Chain":{"main":[[]]},"Write email":{"main":[[{"node":"Review email","type":"main","index":0}]]},"Review email":{"main":[[{"node":"Merge","type":"main","index":1}]]},"OpenAI 4-o-mini":{"ai_languageModel":[[{"node":"Email Classifier","type":"ai_languageModel","index":0}]]},"OpenAI Chat Model2":{"ai_languageModel":[[{"node":"Email Summarization Chain","type":"ai_languageModel","index":0}]]},"OpenAI Chat Model3":{"ai_languageModel":[[{"node":"Review email","type":"ai_languageModel","index":0}]]},"GET_ID1":{"ai_tool":[[{"node":"Write email","type":"ai_tool","index":0}]]},"OpenAI Chat Model4":{"ai_languageModel":[[{"node":"Write email","type":"ai_languageModel","index":0}]]},"GET_DETAIL1":{"ai_tool":[[{"node":"Write email","type":"ai_tool","index":0}]]},"GET_CUSTOMER1":{"ai_tool":[[]]},"GET_DELIVERY ADDRESS1":{"ai_tool":[[]]},"Embeddings OpenAI3":{"ai_embedding":[[{"node":"Qdrant Vector Store","type":"ai_embedding","index":0}]]},"Limit":{"main":[[{"node":"Formatta mail","type":"main","index":0}]]},"Markdown":{"main":[[]]},"Qdrant Vector Store":{"ai_tool":[[{"node":"Write email","type":"ai_tool","index":0}]]},"Formatta mail":{"main":[[{"node":"Email Classifier","type":"main","index":0},{"node":"Merge","type":"main","index":0}]]},"Merge":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]},"Edit Fields":{"main":[[{"node":"Input Email Data1","type":"main","index":0}]]},"Input Email Data1":{"main":[[{"node":"Download Signature1","type":"main","index":0}]]},"Download Signature1":{"main":[[{"node":"Send Email2","type":"main","index":0}]]}}', '{"executionOrder":"v1"}', NULL, '{}', '9e8081e2-e65d-4181-b22e-70415bd29b8c', 0, '{"templateCredsSetupCompleted":true}', NULL, '2025-05-13T14:32:12.399Z', '2025-05-14T11:13:45.000Z', false),
  ('f2d16d6e-a2e9-40e7-ad69-4f8951c2f3ed', 'CHATBOT_MAIL_AGENT_API _beta2', false, '[{"parameters":{"inputText":"=Devi classificare le mail in base a questi parametri\n{{ $json.isThreadReply }}\n{{ $json.mittente }}\n{{ $json.oggetto }}\n{{ $json.data_locale }}\n{{ $json.messaggio_cliente }}\n{{ $json.thread_storico }}\n","categories":{"categories":[{"category":"Info Order","description":"Richiesta Info Ordini"},{"category":"Sales","description":"preventivi"},{"category":"General Info","description":"Info"},{"category":"Errors","description":"errori e malfunzionamenti"},{"category":"resi","description":"resi e restituzioni"},{"category":"supplier","description":"fornitori"},{"category":"alert","description":"alert e messaggi automatici "},{"category":"rimborsi","description":"rimborsi"}]},"options":{"multiClass":true,"fallback":"other","systemPromptTemplate":"=Classifica il seguente messaggio email in una sola delle seguenti categorie predefinite. Restituisci solo il risultato in formato JSON, racchiuso tra tre backtick (```), come mostrato.\n\nCategorie disponibili\nInfo Order ‚Üí Email che contengono richieste di informazioni su ordini gi√† effettuati, come ad esempio: stato spedizione, tempistiche di consegna, numero ordine, modifiche a ordini in corso.\nSales ‚Üí Email contenenti richieste di preventivi, cataloghi, listini prezzi, offerte commerciali, o proposte di acquisto prima di effettuare un ordine.\nGeneral Info ‚Üí Email generiche che chiedono informazioni non specifiche, come orari di apertura, indirizzi, modalit√† di contatto, o domande di carattere generale sull‚Äôazienda o il servizio.\nErrors ‚Üí Messaggi che segnalano problemi tecnici, errori di sistema, malfunzionamenti, anomalie nell‚Äôe-commerce, oppure segnalazioni da parte del cliente riguardo problemi nel sito o nel sistema ordini.\nResi ‚Üí Email che contengono richieste di reso, sostituzione, problemi con prodotti ricevuti, articoli danneggiati o sbagliati, attivazione di garanzie.\nAlert ‚Üí Email provenienti da sistemi automatici, come notifiche di ordine ricevuto, aggiornamenti generati da software, sistemi B2B o servizi esterni. Queste email non sono scritte da esseri umani e non richiedono risposta.\nRimborsi ‚Üí Email che contengono richieste di rimborso monetario, per esempio dopo un reso, mancata consegna o problema con l‚Äôordine.\nSe il mittente √® un sistema (es. info@azienda.com, noreply@, sistema@, notifiche@), e il messaggio √® generato automaticamente, classificalo come \"Alert\".\nSe il messaggio appartiene chiaramente a pi√π categorie, scegli quella pi√π specifica e rilevante per l‚Äôazione richiesta.\n\nATTENZIONE!!! Se non riesci a classificare il messaggio in una delle categorie con sicurezza, o se il contenuto √® ambiguo, classifica il messaggio come `\"General Info\"`.\n\nAlla fine della classificazione, restituisci anche un campo `confidence` da 0 a 100 che indichi quanto sei sicuro della tua scelta.\n\n\nNon spiegare nulla. Non aggiungere testo. Rispondi solo con questo formato esatto:\n","enableAutoFixing":true}},"id":"0ba37514-2a59-4ca0-a72b-9be0803e2a11","name":"Email Classifier","type":"@n8n/n8n-nodes-langchain.textClassifier","position":[-2440,740],"typeVersion":1,"notes":"Per favore, classifica il testo fornito in una delle seguenti categorie: {categories}.\nNon spiegare nulla, restituisci solo il risultato in JSON.\n\nEsempi:\n- Se si parla di un ordine, spedizione, pagamento, recesso ‚Üí \"Info Ordini\"\n- Se si chiede disponibilit√† o preventivo ‚Üí \"Richieste commerciali\"\n- Se il messaggio √® generico, vago o amministrativo ‚Üí \"Informazioni generali\"\n"},{"parameters":{"promptType":"define","text":"=Review at the following email:\n\n{{ $json.output }}","messages":{"messageValues":[{"message":"=Sei un revisore professionista, specializzato nella comunicazione Customer Care, con particolare attenzione alla rassicurazione e chiarezza verso il cliente.  \nIl tuo compito √® riformattare e migliorare testi da inviare via email, rendendoli chiari, proattivi, professionali e pronti per l‚Äôinvio.\n\n‚úèÔ∏è Linee guida:\n- Restituisci il testo in formato **HTML valido**, pronto per essere inserito in un‚Äôemail.\n- Usa solo i tag HTML essenziali: `<p>`, `<br>`, `<ul>`, `<li>`. Non usare `<b>`, `<strong>`, n√© markup superfluo.\n- Ogni paragrafo va in un tag `<p>`, con spaziatura normale e senza `<br><br>`.\n- Tono **formale, rassicurante e proattivo**. Evita toni difensivi o passivi.\n- ‚ùå Non menzionare ‚Äúproblemi‚Äù, ‚Äúpreoccupazioni‚Äù, ‚Äúdisagi‚Äù o simili.\n- ‚ùå Evita formule come ‚Äúci scusiamo‚Äù, ‚Äúcomprendiamo‚Äù, ‚Äúcapisco‚Äù.\n- ‚úÖ Sostituiscile con frasi orientate all‚Äôazione:  \n  ‚ÄúProcediamo con la verifica‚Äù, ‚ÄúSiamo a disposizione‚Äù, ‚ÄúLe forniamo tutte le informazioni necessarie‚Äù.\n- ‚ùå Non usare verbi di cortesia con maiuscola interna: scrivi **fornirle**, **aiutarla**, **contattarla**.\n- ‚úÖ **Personalizza la chiusura in base al contesto del messaggio**:\n  - Se **chiediamo un‚Äôazione al cliente** (es. inviare info, dati, allegati), chiudi con:  \n    ‚Äú<p>Attendo un suo gentile riscontro.</p><p>Resto a disposizione per qualsiasi informazione.</p>‚Äù\n  - Se **abbiamo fornito risposte o indicazioni**, chiudi con:  \n    ‚Äú<p>Resto a disposizione per qualsiasi necessit√†.</p><p>Cordiali saluti,</p>‚Äù\n- ‚úÇÔ∏è Limita la risposta a **massimo 100 parole**.\n- ‚ùå Non aggiungere firme, nomi o riferimenti al team.\n\nüì§ Output:\nFornisci solo il testo HTML finale, senza markdown, delimitatori o spiegazioni.\n\nüìå Esempi finali:\n\n**Caso 1 ‚Äì Richiesta al cliente:**\n\n<p>Gentile Cliente,</p>  \n<p>La ringraziamo per averci scritto. Per fornirle un‚Äôassistenza accurata, la invitiamo a indicarci il numero dell‚Äôordine o una breve descrizione della richiesta.</p>  \n<p>Attendo un suo gentile riscontro.</p>  \n<p>Resto a disposizione per qualsiasi informazione.</p>\n\n**Caso 2 ‚Äì Risposta fornita:**\n\n<p>Gentile Cliente,</p>  \n<p>Abbiamo aggiornato i dati richiesti. Pu√≤ ora accedere al suo account e verificare che tutto sia corretto.</p>  \n<p>Resto a disposizione per qualsiasi necessit√†.</p>  \n<p>Cordiali saluti,</p>\n\n"}]}},"id":"e26ce061-73ba-4dfc-8b7e-b9151d086986","name":"Review email","type":"@n8n/n8n-nodes-langchain.chainLlm","position":[-1180,240],"typeVersion":1.5,"notes":"Sei un revisore esperto nella preparazione di email da inviare ai clienti.  \nIl tuo compito √® riformattare e correggere il testo in modo che sia professionale, empatico, rassicurante e pronto per l''invio.\n\n‚úèÔ∏è Linee guida:\n- Trasforma il testo in formato **HTML valido**, pronto per essere inserito direttamente in un''email.\n- Usa tag come `<p>`, `<b>`, `<br>`, `<ul>`, `<li>` solo se realmente utili e **non includere delimitatori Markdown** (es: ```html).\n- Mantieni il tono **formale**, **umano** ed **empatico**, in linea con lo stile di Milena ‚Äì GommeGo.\n- Non modificare i contenuti sostanziali della risposta, ma migliora grammatica, struttura e leggibilit√†.\n- **Non superare 100 parole.**\n- ‚ùå Non aggiungere saluti, firme, chiusure o frasi non presenti nel testo originale.\n\nüì§ Output:\nRestituisci **solo** il testo HTML finale, **senza** codice aggiuntivo o spiegazioni.\n"},{"parameters":{"model":{"__rl":true,"value":"gpt-4-turbo","mode":"list","cachedResultName":"gpt-4-turbo"},"options":{}},"id":"952f05b3-9acc-4aab-a247-54f8d018a49e","name":"OpenAI 4-o-mini","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","position":[-2560,840],"typeVersion":1.2,"credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4o-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-1180,440],"id":"ecb2e1a2-6089-495b-a8ac-e3c7cf88a06c","name":"OpenAI Chat Model3","credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"model":{"__rl":true,"value":"gpt-4o","mode":"list","cachedResultName":"gpt-4o"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-1900,560],"id":"63019bdb-f7c0-4ac9-84ca-27377320ca57","name":"OpenAI Chat Model4","credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1.2,"position":[-1720,680],"id":"338ffa78-787d-47d5-9fbc-ac9947991bf2","name":"Embeddings OpenAI3","credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"mode":"retrieve-as-tool","toolName":"Vector","toolDescription":"Recupera le condizioni aziendali da mostrare all‚Äôagente per ogni risposta.","qdrantCollection":{"__rl":true,"value":"Double","mode":"list","cachedResultName":"Double"},"topK":10,"options":{}},"type":"@n8n/n8n-nodes-langchain.vectorStoreQdrant","typeVersion":1.1,"position":[-1800,480],"id":"ff079d91-2c31-4395-a0ce-d7cd5bfc9ca5","name":"Qdrant Vector Store","credentials":{"qdrantApi":{"id":"VEHIg9nC5Y5VeHPX","name":"QdrantApi account"}}},{"parameters":{"promptType":"define","text":"==Analizza questa risposta del cliente all''interno di una conversazione gi√† in corso. Classifica il tipo di interazione tra:\n\n- \"Conferma\"\n- \"Richiesta di chiarimenti\"\n- \"Lamentela\"\n- \"Sollecito\"\n- \"Altro\"\n\nRispondi in JSON nel seguente formato:\n\n{\n  \"tipo_interazione\": \"...\",\n  \"azione_suggerita\": \"...\"\n}\n\nTesto del cliente:\n{{ $json.nuova_risposta }}\n","options":{"systemMessage":"Agisci come assistente esperto di help desk. Il tuo compito √® comprendere in modo sintetico e preciso cosa intende il cliente, senza inventare nulla. Rispondi solo in formato JSON.\n"}},"id":"d63582f5-72e6-4a6a-ba38-9c59246d4973","name":"Thread Reply Classifier","type":"@n8n/n8n-nodes-langchain.agent","position":[-2900,480],"typeVersion":1.7},{"parameters":{"model":{"__rl":true,"value":"gpt-4-turbo","mode":"list","cachedResultName":"gpt-4-turbo"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-2900,640],"id":"4470296a-df1c-44f7-a466-03642abaab62","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"mode":"combine","combineBy":"combineByPosition","options":{}},"id":"c1b705a7-e597-4894-9680-43a92d8cf2df","name":"Merge Email + Classification","type":"n8n-nodes-base.merge","typeVersion":3,"position":[-2520,260]},{"parameters":{"promptType":"define","text":"=Write the text to reply to the following message from a customer.\n\nLast message (to answer):\n\"{{ $json.messaggio_cliente }}\"\n\nSubject: {{$json.oggetto}}\nFrom: {{$json.mittente}}\n\nüß† Previous thread:\n\"{{$json.thread_storico}}\"\n\nüí¨ Classificazione automatica:\nTipo interazione: {{$json.tipo_interazione}}\nSuggerimento operativo: {{$json.azione_suggerita}}","options":{"systemMessage":"# Milena - Assistente Email GommeGo\n\n**Ruolo**: Operatrice post-vendita con tono professionale, empatico e rassicurante per email clienti.\n\n## Obiettivo\nRedigere bozze email (max 100 parole) rassicuranti e complete che risolvano immediatamente le preoccupazioni del cliente.\n\n## Comportamento Base\n- Dai sempre del \"Lei\"\n- **Analizza accuratamente** il problema e fornisci **rassicurazione completa**\n- Linguaggio semplice, empatico, formale\n- **Messaggi chiave**: \"Pu√≤ stare tranquillo\", \"√à normalissimo\", \"Nessun problema\"\n- **Evita**: \"ritardo\", \"problema\", \"ci scusiamo\"\n\n## üîß Tool Disponibili\n\n### 1. VECTOR STORE (Priorit√† assoluta)\n`Answer questions with a vector store` - Knowledge base completo GommeGo\n- FAQ ufficiali su tracking, DOT, resi, policy\n- Procedure aziendali e regole comportamentali\n- **Usa sempre** per contesto e policy verification\n\n### 2. ORDINI\n`{\"query\": \"CODICE_ORDINE\"}` - Per dettagli ordini esistenti\n- Analizza `shipment_number`: se vuoto ‚Üí consulta Vector Store \"FAQ E RISPOSTE COMUNI - TRACKING E SPEDIZIONI\" per spiegazioni sui ritardi tracking normali\n- Se presente ‚Üí usa ParcelApp per aggiornamenti\n\n### 3. TRACKING  \nParcelApp: Solo se `shipment_number` presente dal tool ordini\n\n### 4. COMMERCIALE\nTool \"Commerciale\" per dati prodotto specifici\n\n### 5. AMMINISTRAZIONE\nTool dedicato per documenti specifici\n\n## üìã Workflow Email\n\n### Input Analysis\nIdentifica tipo richiesta: ordine/tracking/commerciale/FAQ\n\n### Knowledge Retrieval  \n1. **Vector Store**: Consulta sempre per policy e FAQ ufficiali\n2. **Tool specifici**: Solo se servono dati aggiuntivi\n   - Ordini: `{\"query\": \"CODICE_ORDINE\"}`\n   - Tracking: ParcelApp (se shipment_number presente dal tool ordini)\n   - Commerciale: Tool \"Commerciale\"\n   - Amministrazione: Tool dedicato\n\n### Response Construction\n- **Rassicurazione accurata** basata su knowledge ufficiale\n- **Dati specifici** da tool quando necessari\n- **Max 100 parole** - conciso ma completo\n\n## üéØ Gestione Scenario Principale (90% email)\n**RITARDI TRACKING/CONSEGNA**\n\n**Approccio rassicurante**: Utilizza le informazioni del Vector Store per spiegare che i ritardi di aggiornamento tracking sono normalissimi. Trasmetti tranquillit√† spiegando che i corrieri aggiornano spesso con ritardo ma l''ordine procede regolarmente. Personalizza il messaggio in base al caso specifico usando il tone empatico.\n\n## ‚ùå Policy Restrictions\n- Se Vector Store non conferma possibilit√† recesso/rimborso ‚Üí **NON proporli**\n- Per ordini in corso/spediti ‚Üí Rassicura sulla regolarit√† del processo\n\n---\n\n## üì® THREAD / RISPOSTE A MAIL PRECEDENTI:\nConsidera sempre l''ultimo messaggio ricevuto come priorit√†, ma tieni presente anche il contenuto delle email precedenti (campo \"thread_storico\").\n\nSe il cliente ripete una domanda o osservazione gi√† trattata nel thread, rispondi in modo cortese ma diretto, utilizzando espressioni come:\n- \"Come gi√† indicato in precedenza...\"\n- \"Come spiegato nella nostra email precedente...\"\n- \"Come Le abbiamo gi√† comunicato...\"\n\nEvita di ripetere interamente le informazioni: riassumi, fai riferimento alla comunicazione gi√† avvenuta e guida il cliente in modo coerente con il contesto.\n\n---\n\n## üì§ Output\nScrivi solo la bozza email pronta per invio. Nessuna spiegazione tecnica."}},"id":"b4566560-3d89-4e75-9db1-1fef9379da4d","name":"Write email1","type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.7,"position":[-1860,240]},{"parameters":{"description":"DATI ORDINI CLIENTI - INFORMAZIONI SPECIFICHE PRESTASHOP\nQuesto nodo recupera i dettagli specifici di un ordine dal database PrestaShop utilizzando il codice ordine fornito dal cliente.\nFUNZIONE:\nEstrae dati grezzi dell''ordine: stato attuale, prodotti acquistati, indirizzo di consegna, informazioni di fatturazione, shipment_number (se disponibile), date e dettagli tecnici del processo.\nINPUT RICHIESTO:\njson{\"query\": \"CODICE_ORDINE\"}\n\nSe il codice ordine √® presente: inserire il codice esatto\nSe il codice ordine manca: {\"query\": \"\"}\n\nQUANDO USARLO:\n\nDOPO aver consultato il vector store per il contesto generale\nSolo per richieste specifiche su ordini gi√† effettuati\nPer ottenere stato, tracking number, dettagli prodotti\n\nOUTPUT:\nRestituisce dati tecnici che DEVONO essere rielaborati e spiegati al cliente in linguaggio rassicurante usando le informazioni del vector store.\nIMPORTANTE:\nI dati di questo nodo sono \"grezzi\" e vanno sempre combinati con il vector store per ottenere spiegazioni comprensibili degli stati ordine e messaggi rassicuranti appropriati.\nSolo dati specifici - il contesto e la rassicurazione vengono dal vector store.","workflowId":{"__rl":true,"value":"ZdiuN1NHeIs7gwUd","mode":"list","cachedResultName":"SUB_API_INFO_ORDER_PRESTASHOP"},"workflowInputs":{"mappingMode":"defineBelow","value":{},"matchingColumns":["query"],"schema":[{"id":"query","displayName":"query","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[-1480,460],"id":"67dd8862-d84d-4202-9e25-b925c609a111","name":"INFO ORDINI"},{"parameters":{"options":{}},"type":"n8n-nodes-base.dateTimeTool","typeVersion":2,"position":[-1360,480],"id":"7c83a67b-9327-40a5-849c-2b6bf58f1a8d","name":"Date & Time"},{"parameters":{"content":"üéØ RUOLO:\nAgisci come Milena, assistente post-vendita di GommeGo.  \nRispondi alle email dei clienti con tono professionale, empatico e rassicurante.  \nIl tuo compito √® redigere una bozza di risposta chiara, professionale e umana (massimo 100 parole), che sar√† revisionata prima dell‚Äôinvio.\n\n---\n\nüì¶ ORDINI:\n1. Usa il tool `GET_ID` per ottenere l‚ÄôID numerico dell‚Äôordine dal codice (es. ATADXSZQS).\n2. Passa l‚ÄôID al tool `GET_DETAIL`.\n3. Analizza i dati ottenuti da `GET_DETAIL`:\n   - Data ordine (`date_add`)\n   - Tracking: verifica se `shipping_number` o `note` sono compilati, ma **non riportarli nel testo**\n   - Stato ordine (`current_state`) ‚Üí mappalo secondo la tabella seguente:\n\n\"2\": \"Pagamento accettato\"  \n\"3\": \"Elaborazione ‚Äì In attesa conferma di stock\"  \n\"4\": \"Spedizione in preparazione\"  \n\"5\": \"Consegnato\"  \n\"6\": \"Annullato\"  \n\"7\": \"Rimborsato\"  \n\"8\": \"Errore di pagamento\"  \n\"9\": \"In attesa di rifornimento\"  \n\"10\": \"In attesa di pagamento con bonifico bancario\"  \n\"14\": \"MultiSafepay Pagamento sospeso\"  \n\"15\": \"MultiSafepay Rimborso Parziale\"  \n\"16\": \"In attesa di pagamento con PayPal\"  \n\"17\": \"In attesa di pagamento con carta di credito\"  \n\"18\": \"In attesa di pagamento con metodo di pagamento locale\"  \n\"20\": \"Rimborso parziale\"  \n\"26\": \"Prove tecniche\"  \n\"27\": \"Annullato per mancato pagamento\"  \n\"28\": \"In transito ‚Äì link di tracciamento inviato\"  \n\"29\": \"Consegnato parzialmente\"  \n\"30\": \"In attesa emissione buono o rimborso\"  \n\"31\": \"In consegna\"  \n\"32\": \"Richiesta reso da cliente\"  \n\"35\": \"Destinatario assente\"\n\nConsidera ‚Äú28‚Äù e ‚Äú31‚Äù come gi√† spedito.\n\n‚ùó Non includere mai `note` o `shipping_number` nel testo della risposta.\n\n---\n\nüìö POLICY AZIENDALI:\nUsa **sempre il tool `Vector`** per verificare:\n- Condizioni di recesso\n- Tempi di consegna\n- Garanzie e rimborsi\n- Limitazioni aziendali\n\n‚ùå Se le policy del `Vector` non confermano che √® possibile procedere con recesso o rimborso, **non proporli**.\n‚úÖ In caso di ordine in corso/spedito, rassicura il cliente, conferma che la procedura √® regolare e il pagamento √® tracciato.\n\n---\n\nüó£Ô∏è STILE MILENA:\n- Dai sempre del ‚ÄúLei‚Äù\n- Linguaggio semplice, chiaro, empatico, formale e rassicurante\n- Tono umano, mai freddo n√© robotico\n- Mostra sempre disponibilit√† e vicinanza (es. ‚ÄúCapisco perfettamente‚Äù, ‚ÄúSiamo qui per aiutarLa‚Äù)\n- Ogni 3‚Äì4 risposte, simula un piccolo errore di battitura e correggilo\n- Non usare parole negative: evita ‚Äúritardo‚Äù, ‚Äúproblema‚Äù, ‚Äúci scusiamo‚Äù\n- Non includere saluti finali o firme (saranno aggiunti da un secondo agente)\n\n---\n\nüì® THREAD / RISPOSTE A MAIL PRECEDENTI:\nConsidera sempre l‚Äôultimo messaggio ricevuto come priorit√†, ma tieni presente anche il contenuto delle email precedenti (campo ‚Äúthread_storico‚Äù).\n\nSe il cliente ripete una domanda o osservazione gi√† trattata nel thread, rispondi in modo cortese ma diretto, utilizzando espressioni come:\n- ‚ÄúCome gi√† indicato in precedenza...‚Äù\n- ‚ÄúCome spiegato nella nostra email precedente...‚Äù\n- ‚ÄúCome Le abbiamo gi√† comunicato...‚Äù\n\nEvita di ripetere interamente le informazioni: riassumi, fai riferimento alla comunicazione gi√† avvenuta e guida il cliente in modo coerente con il contesto.\n\n\nüì§ OUTPUT:\nScrivi solo la bozza della risposta, gi√† pronta per essere inviata.  \nNon aggiungere spiegazioni, titoli o istruzioni tecniche."},"type":"n8n-nodes-base.stickyNote","position":[-3960,-460],"typeVersion":1,"id":"80b3a246-3689-4896-8093-7c7b5d333480","name":"Sticky Note"},{"parameters":{"jsCode":"const mittente = $json.sender?.emailAddress?.address || '''';\nconst oggetto = $json.subject || '''';\nconst testo = $json.bodyText || '''';\nconst dataOriginale = $json.sentDateTime || new Date().toISOString();\n\nconst righe = testo.split(''\\n'');\n\nconst indiceFineRisposta = righe.findIndex(riga => {\n  const r = riga.toLowerCase();\n  return r.startsWith(''il giorno'') ||\n    r.startsWith(''on '') ||\n    r.includes(''ha scritto:'') ||\n    r.startsWith(''from:'');\n});\n\nconst messaggioCliente = indiceFineRisposta !== -1\n  ? righe.slice(0, indiceFineRisposta).join(''\\n'').trim()\n  : testo.trim();\n\nconst threadStorico = indiceFineRisposta !== -1\n  ? righe.slice(indiceFineRisposta).join(''\\n'').trim()\n  : '''';\n\n// Valutazione se √® una risposta (reply/forward) o prima richiesta\nconst subjectLower = oggetto.trim().toLowerCase();\nconst isThreadReply = subjectLower.startsWith(''re'') || subjectLower.startsWith(''fw'') || !!$json.inReplyTo;\nconst isFirstMessage = !isThreadReply;\n\nreturn [\n  {\n    json: {\n      isThreadReply,\n      isFirstMessage,\n      data_iso: dataOriginale,\n      data_locale: new Date(dataOriginale).toLocaleString(''it-IT''),\n      mittente,\n      oggetto,\n      messaggio_cliente: messaggioCliente,\n      thread_storico: threadStorico\n    }\n  }\n];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-4000,960],"id":"d2ef0433-5d06-4fb4-b3c8-801a3cbcc0da","name":"Prepara Email per Classificatore","notes":"const mittente = $json.sender?.emailAddress?.address || '''';\nconst oggetto = $json.subject || '''';\nconst testo = $json.bodyText || ''''; // ‚úÖ usa il testo pulito\nconst dataOriginale = $json.sentDateTime || new Date().toISOString();\n\nconst righe = testo.split(''\\n'');\n\nconst indiceFineRisposta = righe.findIndex(riga => {\n  const r = riga.toLowerCase();\n  return r.startsWith(''il giorno'') ||\n    r.startsWith(''on '') ||\n    r.includes(''ha scritto:'') ||\n    r.startsWith(''from:'');\n});\n\nconst nuovaRisposta = indiceFineRisposta !== -1\n  ? righe.slice(0, indiceFineRisposta).join(''\\n'').trim()\n  : testo.trim();\n\nconst threadStorico = indiceFineRisposta !== -1\n  ? righe.slice(indiceFineRisposta).join(''\\n'').trim()\n  : '''';\n\nconst isReply = oggetto.trim().toLowerCase().startsWith(''re'') || !!$json.inReplyTo;\n\nreturn [\n  {\n    json: {\n      isThreadReply: isReply,\n      data_iso: dataOriginale,\n      data_locale: new Date(dataOriginale).toLocaleString(''it-IT''),\n      mittente,\n      oggetto,\n      nuova_risposta: nuovaRisposta,\n      thread_storico: threadStorico\n    }\n  }\n];\n"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[-1940,840],"id":"45f497f8-791a-431e-a71d-6b3e8fbefe95","name":"No Operation, do nothing"},{"parameters":{"jsCode":"return $input.all().map(item => {\n  const html = item.json.body?.content || '''';\n\n  const plainText = html\n    .replace(/<style[\\s\\S]*?>[\\s\\S]*?<\\/style>/gi, '''')  // rimuove CSS\n    .replace(/<[^>]+>/g, '''')                            // rimuove tutti i tag HTML\n    .replace(/\\s+/g, '' '')                               // pulizia spazi\n    .trim();\n\n  item.json.bodyText = plainText;\n  return item;\n});\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-4280,1140],"id":"8c6677c4-e9d7-4d99-bbcb-473ac80f58aa","name":"Pulisci Testo"},{"parameters":{"fields":{"values":[{"name":"tipo_interazione","stringValue":"={{ JSON.parse($json.output).tipo_interazione }}"},{"name":"azione_suggerita","stringValue":"={{ JSON.parse($json.output).azione_suggerita }}"}]},"options":{}},"id":"919c42a6-2b1f-42f7-8a30-bcacd8d219f8","name":"Estrae tipo di interazione","type":"n8n-nodes-base.set","typeVersion":3,"position":[-2260,380]},{"parameters":{"inputText":"=Classifica questo messaggio email in una delle seguenti categorie preliminari.\n\nMittente: {{ $json.mittente }}\nOggetto: {{ $json.oggetto }}\nContenuto: {{ $json.messaggio_cliente }}\n\nCategorie disponibili:\n- rimborsi ‚Üí Richieste di rimborso parziale o totale, problemi economici, mancata consegna con richiesta rimborso\n- irrilevante ‚Üí Spam, pubblicit√†, promozioni, risposte automatiche, fuori ambito\n- classificabile ‚Üí La mail ha contenuto utile per classificazione approfondita\n\nRispondi **solo** con una struttura JSON racchiusa da tre backtick, come ad esempio:\n\n","categories":{"categories":[{"category":"irrilevante","description":"spam, bot, sistemi, no-reply"},{"category":"classificabile","description":"passa al classificatore principale"}]},"options":{"multiClass":false,"fallback":"other","systemPromptTemplate":"=Classifica il seguente messaggio email in una sola delle seguenti categorie preliminari.\n\nCategorie disponibili:\n- classificabile ‚Üí L''email contiene contenuti chiari, comprensibili e utili per una successiva classificazione: richieste di clienti, domande su ordini, problemi, o qualsiasi messaggio scritto da una persona reale che richiede attenzione.\n- irrilevante ‚Üí L''email √® spam, una risposta automatica (es. fuori sede), una promozione, un messaggio vuoto o generico, oppure proviene da un sistema o da un indirizzo come noreply@, info@, sistema@, notifiche@, ecc.\n\nRegole:\n- Non assegnare pi√π di una categoria.\n- Se hai dubbi, ma il messaggio sembra umano e utile, scegli \"classificabile\".\n- Se √® automatizzato, pubblicitario o incomprensibile, scegli \"irrilevante\".\n- Alla fine, restituisci un oggetto JSON con due campi:\n  - \"categoria\": una stringa esatta che corrisponde al nome di una categoria\n  - \"confidence\": un numero intero da 0 a 100 che rappresenta quanto sei sicuro della classificazione\n- Non aggiungere testo extra o spiegazioni. Rispondi solo con JSON valido.\n\nSe l‚Äôemail proviene da un indirizzo che contiene ‚Äúnoreply‚Äù, ‚Äúno-reply‚Äù, ‚Äúinfo@‚Äù, ‚Äúsistema@‚Äù, ‚Äúnotifiche@‚Äù, o √® chiaramente un messaggio automatico con conferme, riepiloghi, dettagli d‚Äôordine o aggiornamenti generati da software, classificala come \"irrilevante\", anche se contiene dati leggibili.\n\nse il messaggio arriva da info@gommego.com ed ha come oggetto Nuovo ordine: mettilo nella categria \"irrilevante\"\n","enableAutoFixing":true}},"id":"9647f856-bf1d-4926-9c77-8079d0ac1297","name":"AI Classifier preliminare","type":"@n8n/n8n-nodes-langchain.textClassifier","position":[-3660,540],"typeVersion":1,"notes":"Per favore, classifica il testo fornito in una delle seguenti categorie: {categories}.\nNon spiegare nulla, restituisci solo il risultato in JSON.\n\nEsempi:\n- Se si parla di un ordine, spedizione, pagamento, recesso ‚Üí \"Info Ordini\"\n- Se si chiede disponibilit√† o preventivo ‚Üí \"Richieste commerciali\"\n- Se il messaggio √® generico, vago o amministrativo ‚Üí \"Informazioni generali\"\n"},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4o-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-3640,720],"id":"74d3862c-c5bb-4222-a7d0-a408e43caa48","name":"OpenAI Chat Model1","credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"operation":"reply","messageId":{"__rl":true,"value":"={{ $json.id }}","mode":"id"},"replyToSenderOnly":true,"message":"={{ $json.text }}","additionalFields":{"bodyContentType":"html"},"options":{}},"type":"n8n-nodes-base.microsoftOutlook","typeVersion":2,"position":[-140,600],"id":"f6716c58-92aa-4a5e-b68c-1aec50740596","name":"Rispondi a mittente","webhookId":"374eacdb-0957-4d92-a607-d5549bf79dc4","retryOnFail":true,"alwaysOutputData":true,"credentials":{"microsoftOutlookOAuth2Api":{"id":"EySZIVRGzocRrEOf","name":"Outlook Info GommeGo"}}},{"parameters":{"workflowId":{"__rl":true,"value":"sUoxT0u3iJUz3Hss","mode":"list","cachedResultName":"SUB_SMART TASK ANALYZER"},"workflowInputs":{"mappingMode":"defineBelow","value":{},"matchingColumns":[],"schema":[],"attemptToConvertTypes":false,"convertFieldsToString":true},"options":{}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[-480,1340],"id":"72cd8134-ee5e-4ca9-9606-cf8b2fb19086","name":"Execute Workflow"},{"parameters":{"text":"={{ JSON.stringify($json, null, 2) }}\n","attributes":{"attributes":[{"name":"order_id","description":"il numero di ordine (ad esempio MCWRWNXKT)"},{"name":"customer_email","description":"sender address mail"}]},"options":{"systemPromptTemplate":"sei un esperto di estrazione di dati da tutti i formati in ingresso"}},"type":"@n8n/n8n-nodes-langchain.informationExtractor","typeVersion":1,"position":[-1740,1160],"id":"30d2bc2d-794d-4ab1-9cae-c4270fd810c8","name":"Information Extractor","notes":"{{ $json.body.content }}\n{{ $json.subject }}\n{{ $json.bodyText }}\n{{ $json.sender.emailAddress.name }}\n{{ $json.sender.emailAddress.address }}"},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4o-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-1740,1340],"id":"45cddd3b-2be0-4513-ab06-5d2499a86693","name":"OpenAI Chat Model2","credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"jsCode":"return items.map(item => {\n  const json = item.json;\n\n  // Controlla se esiste il campo output e uniscilo a livello principale\n  return {\n    json: {\n      ...json.output\n    }\n  };\n});\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-1220,1160],"id":"15fed511-235d-49d7-8438-ade057685974","name":"JSON Flat"},{"parameters":{"jsCode":"// =====================================================\n// üìä EMAIL DATA COLLECTOR - NODO 1A\n// Posizione: Dopo \"Prepara Email per Classificatore\"\n// Tipo: Code Node\n// Funzione: Raccoglie e prepara dati per Supabase\n// =====================================================\n\n// =====================================================\n// üìä EMAIL DATA COLLECTOR - NODO 1A (SEMPLIFICATO)\n// Posizione: Dopo \"Prepara Email per Classificatore\"\n// Tipo: Code Node\n// Funzione: Raccoglie SOLO i dati disponibili a questo punto\n// =====================================================\n\n// Prepara SOLO i dati che abbiamo realmente a questo punto\nconst emailLogData = {\n  // === EMAIL BASICS (DISPONIBILI) ===\n  email_id: $json.id || `email_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\n  sender_email: $json.mittente || ''unknown@email.com'',\n  sender_name: $json.sender?.emailAddress?.name || null,\n  subject: $json.oggetto || ''No Subject'',\n  body_length: ($json.messaggio_cliente || '''').length,\n  is_thread_reply: $json.isThreadReply || false,\n  \n  // === WORKFLOW STATUS ===\n  status: ''received'', // Solo ricevuta a questo punto\n  \n  // === PERFORMANCE METRICS ===\n  processing_start_time: new Date().toISOString(),\n  \n  // === BUSINESS DATA (SE DISPONIBILI) ===\n  order_id: $json.order_id || null,\n  customer_email: $json.customer_email || $json.mittente,\n  customer_name: $json.sender?.emailAddress?.name || null,\n  \n  // === CONVERSATION CONTEXT ===\n  conversation_data: {\n    messaggio_cliente: $json.messaggio_cliente || '''',\n    thread_storico: $json.thread_storico || '''',\n    is_first_message: $json.isFirstMessage || true\n  },\n  \n  // === TECHNICAL METADATA ===\n  workflow_version: ''beta2'',\n  n8n_execution_id: $execution.id || null,\n  outlook_message_id: $json.id || null\n};\n\n// Passa sia i dati originali che quelli preparati per Supabase\nreturn [{ \n  json: {\n    // Dati originali per il workflow\n    ...$json,\n    \n    // Dati preparati per Supabase (nodo successivo)\n    supabase_data: emailLogData,\n    \n    // Metadati per tracking\n    tracking_metadata: {\n      email_id: emailLogData.email_id,\n      processing_start_time: emailLogData.processing_start_time,\n      data_prepared: true\n    }\n  }\n}];\n\n// Passa sia i dati originali che quelli preparati per Supabase\nreturn [{ \n  json: {\n    // Dati originali per il workflow\n    ...$json,\n    \n    // Dati preparati per Supabase (nodo successivo)\n    supabase_data: emailLogData,\n    \n    // Metadati per tracking\n    tracking_metadata: {\n      email_id: emailLogData.email_id,\n      processing_start_time: emailLogData.processing_start_time,\n      data_prepared: true\n    }\n  }\n}];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-3422,1250],"id":"54f6431d-f1d3-47fa-a9fd-3781973f7d79","name":"üìä EMAIL DATA COLLECTOR","notes":"// =====================================================\n// üöÄ EMAIL CRITICAL TRACKER - NODO 1\n// Posizione: Dopo \"AI Classifier preliminare\"\n// Funzione: INSERT record base in email_processing_log\n// =====================================================\n\nconst startTime = Date.now();\n\n// Raccolta dati disponibili a questo punto del workflow\nconst emailData = {\n  // Dati base email\n  email_id: $json.id || `email_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\n  sender_email: $json.mittente || ''unknown@email.com'',\n  sender_name: $json.sender?.emailAddress?.name || null,\n  subject: $json.oggetto || ''No Subject'',\n  body_length: ($json.messaggio_cliente || '''').length,\n  is_thread_reply: $json.isThreadReply || false,\n  \n  // Classificazione preliminare\n  preliminary_classification: $json.categoria || null,\n  preliminary_confidence: $json.confidence || null,\n  \n  // Status iniziale\n  status: ''classified'',\n  \n  // Timestamp\n  processing_start_time: new Date().toISOString(),\n  \n  // Dati business (se disponibili)\n  order_id: $json.order_id || null,\n  customer_email: $json.customer_email || $json.mittente,\n  \n  // Conversation context\n  conversation_data: {\n    messaggio_cliente: $json.messaggio_cliente || '''',\n    thread_storico: $json.thread_storico || '''',\n    is_first_message: $json.isFirstMessage || true\n  },\n  \n  // Classification details\n  classification_details: {\n    preliminary: {\n      category: $json.categoria || null,\n      confidence: $json.confidence || null\n    }\n  },\n  \n  // Technical metadata\n  workflow_version: ''beta2'',\n  n8n_execution_id: $execution.id || null,\n  outlook_message_id: $json.id || null,\n  \n  // Processing steps log\n  processing_steps: [\n    {\n      step: ''received'',\n      timestamp: new Date().toISOString(),\n      duration_ms: 0\n    },\n    {\n      step: ''classified'',\n      timestamp: new Date().toISOString(),\n      duration_ms: Date.now() - startTime\n    }\n  ]\n};\n\n// =====================================================\n// CHIAMATA SUPABASE INSERT\n// =====================================================\n\nconst supabaseUrl = ''https://gtjocujukxypqcrpgjyv.supabase.co'';\nconst supabaseKey = ''eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Imd0am9jdWp1a3h5cHFjcnBnanl2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDgyNzAzOTQsImV4cCI6MjA2Mzg0NjM5NH0.TVZMfiuRGkzzo0v_s9BXgEEICZd40ksCB9AwqAYPGWo'';\n\ntry {\n  const response = await fetch(`${supabaseUrl}/rest/v1/email_processing_log`, {\n    method: ''POST'',\n    headers: {\n      ''Content-Type'': ''application/json'',\n      ''apikey'': supabaseKey,\n      ''Authorization'': `Bearer ${supabaseKey}`,\n      ''Prefer'': ''return=minimal''\n    },\n    body: JSON.stringify(emailData)\n  });\n  \n  if (!response.ok) {\n    const errorText = await response.text();\n    console.error(''‚ùå Supabase INSERT fallito:'', errorText);\n    \n    // Aggiungi errore al tracking\n    const errorData = {\n      step: ''email_tracking_insert'',\n      error: errorText,\n      timestamp: new Date().toISOString()\n    };\n  } else {\n    console.log(''‚úÖ Email tracking record creato con successo'');\n  }\n  \n} catch (error) {\n  console.error(''‚ùå Errore nella chiamata Supabase:'', error.message);\n}\n\n// =====================================================\n// PASSA DATI AL NODO SUCCESSIVO\n// =====================================================\n\n// Arricchisce i dati originali con informazioni di tracking\nconst enrichedData = {\n  ...$json,\n  \n  // Aggiunge metadata di tracking\n  tracking_metadata: {\n    email_id: emailData.email_id,\n    processing_start_time: emailData.processing_start_time,\n    tracking_inserted: true\n  }\n};\n\n// Ritorna i dati arricchiti per il workflow\nreturn [{ json: enrichedData }];"},{"parameters":{"jsCode":"// =====================================================\n// üîÑ EMAIL COMPLETE DATA COLLECTOR - NODO 2A\n// Posizione: Dopo \"Rispondi a mittente\"\n// Tipo: Code Node\n// Funzione: Prepara dati finali per UPDATE Supabase\n// =====================================================\n\nconst endTime = Date.now();\n\n// Recupera metadati di tracking dal NODO 1\nconst trackingMetadata = $json.tracking_metadata || {};\nconst emailId = trackingMetadata.email_id || $json.id || `fallback_${Date.now()}`;\nconst startTime = trackingMetadata.processing_start_time ? \n  new Date(trackingMetadata.processing_start_time).getTime() : endTime;\n\n// Calcola tempi di processing\nconst totalProcessingTime = endTime - startTime;\n\n// Prepara dati per UPDATE completo\nconst updateData = {\n  // Identifica il record da aggiornare\n  email_id: emailId,\n  \n  // === AI PROCESSING COMPLETATO ===\n  ai_response_generated: true,\n  ai_response_length: ($json.text || '''').length,\n  ai_model_used: ''gpt-4o'', // Modello principale usato\n  ai_processing_time_ms: Math.round(totalProcessingTime * 0.6), // Stima 60% del tempo\n  \n  // === WORKFLOW STATUS ===\n  status: ''completed'',\n  \n  // === PERFORMANCE METRICS ===\n  total_processing_time_ms: totalProcessingTime,\n  processing_end_time: new Date().toISOString(),\n  \n  // === SEND DATA ===\n  send_attempted: true,\n  send_successful: true, // Assume successo se arriviamo qui\n  send_time: new Date().toISOString(),\n  send_error: null,\n  \n  // === FINAL CLASSIFICATION (se disponibile) ===\n  final_classification: $json.final_classification || $json.categoria || null,\n  final_confidence: $json.final_confidence || $json.confidence || null,\n  \n  // === TASK INTEGRATION (se task √® stato creato) ===\n  has_task_created: $json.task_created || false,\n  task_id: $json.created_task_id || null,\n  gap_detected: $json.gap_identified || false,\n  urgency_level: $json.urgency_level || null,\n  \n  // === AI ANALYSIS (se disponibile) ===\n  ai_analysis: $json.ai_analysis ? {\n    gap_identified: $json.gap_identified || false,\n    customer_satisfaction: $json.customer_satisfaction || null,\n    required_actions: $json.required_actions || [],\n    ai_promises: $json.ai_promises || [],\n    sentiment: $json.customer_sentiment || null\n  } : null,\n  \n  // === UPDATED TIMESTAMP ===\n  updated_at: new Date().toISOString(),\n  \n  // === PROCESSING STEPS COMPLETATI ===\n  processing_steps: [\n    ...(trackingMetadata.processing_steps || []),\n    {\n      step: ''ai_processed'',\n      timestamp: new Date(endTime - totalProcessingTime * 0.4).toISOString(),\n      duration_ms: Math.round(totalProcessingTime * 0.6)\n    },\n    {\n      step: ''formatted'',\n      timestamp: new Date(endTime - totalProcessingTime * 0.1).toISOString(),\n      duration_ms: Math.round(totalProcessingTime * 0.3)\n    },\n    {\n      step: ''sent'',\n      timestamp: new Date().toISOString(),\n      duration_ms: Math.round(totalProcessingTime * 0.1)\n    }\n  ]\n};\n\n// Log per debug\nconsole.log(''üîÑ NODO 2A - Email ID:'', emailId);\nconsole.log(''‚è±Ô∏è Total processing time:'', totalProcessingTime, ''ms'');\nconsole.log(''üìä Update data prepared for Supabase'');\n\n// Passa dati originali + dati per UPDATE\nreturn [{\n  json: {\n    // Dati originali (per eventuale workflow che continua)\n    ...$json,\n    \n    // Dati preparati per UPDATE Supabase\n    supabase_update_data: updateData,\n    \n    // Metadati finali\n    final_tracking_metadata: {\n      email_id: emailId,\n      total_processing_time_ms: totalProcessingTime,\n      processing_completed: true,\n      update_data_prepared: true\n    }\n  }\n}];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[300,860],"id":"6a56e6d9-0342-4f35-8fe7-6ff4ba0b5bf6","name":"üìàüîÑ EMAIL COMPLETE DATA COLLECTOR"},{"parameters":{"jsCode":"return $input.all().map(item => {\n  const corpo = item.json.text || '''';\n  const storico = item.json.thread_storico || '''';\n  \n  const firmaHtml = `\n    <div style=\"margin-top: 20px; margin-bottom: 20px;\">\n      <img src=\"https://i.ibb.co/QFNDm6xL/White-and-Teal-Minimalist-Marketing-Email-Signature.png\" \n           alt=\"Firma Milena Dobrev - GommeGo\" \n           style=\"max-width: 450px; width: 100%; height: auto; display: block;\" />\n    </div>\n  `.trim();\n\n  // Funzione per formattare lo storico come email tradizionale\n  const formatStoricoEmail = (storicoText) => {\n    if (!storicoText) return '''';\n    \n    // Decodifica entit√† HTML\n    let cleanText = storicoText\n      .replace(/&lt;/g, ''<'')\n      .replace(/&gt;/g, ''>'')\n      .replace(/&amp;/g, ''&'')\n      .replace(/&quot;/g, ''\"'');\n    \n    // Cerca pattern specifici per dividere il contenuto\n    let formattedStorico = '''';\n    \n    // Estrai informazioni del mittente (pattern: \"Il giorno ... ha scritto:\")\n    const mittenteMatch = cleanText.match(/Il giorno (.+?), alle ore (.+?), (.+?) ha scritto:/);\n    if (mittenteMatch) {\n      const data = mittenteMatch[1];\n      const ora = mittenteMatch[2];\n      const mittente = mittenteMatch[3];\n      \n      formattedStorico += `<div style=\"margin-bottom: 4px;\"><strong>Da:</strong> ${mittente}</div>`;\n      formattedStorico += `<div style=\"margin-bottom: 4px;\"><strong>Inviato:</strong> ${data} ${ora}</div>`;\n    }\n    \n    // Estrai oggetto\n    const oggettoMatch = cleanText.match(/Oggetto:\\s*(.+?)(?=Gentile|$)/);\n    if (oggettoMatch) {\n      formattedStorico += `<div style=\"margin-bottom: 12px;\"><strong>Oggetto:</strong> ${oggettoMatch[1].trim()}</div>`;\n    }\n    \n    // Estrai il corpo del messaggio (tutto quello che viene dopo \"Oggetto:\")\n    const corpoMatch = cleanText.match(/Oggetto:.*?(Gentile[\\s\\S]*)/);\n    if (corpoMatch) {\n      let corpoMessaggio = corpoMatch[1].trim();\n      \n      // Dividi il testo in frasi per creare paragrafi\n      const frasi = corpoMessaggio.split(/\\.\\s+/).filter(frase => frase.trim().length > 0);\n      \n      formattedStorico += ''<div style=\"margin-top: 15px; line-height: 1.5;\">'';\n      frasi.forEach((frase, index) => {\n        let testoFrase = frase.trim();\n        if (!testoFrase.endsWith(''.'') && index < frasi.length - 1) {\n          testoFrase += ''.'';\n        }\n        formattedStorico += `<div style=\"margin-bottom: 8px;\">${testoFrase}</div>`;\n      });\n      formattedStorico += ''</div>'';\n    }\n    \n    // Se non trova il pattern strutturato, mostra il testo iniziale + quello formattato\n    const testoIniziale = cleanText.split(''Il giorno'')[0].trim();\n    if (testoIniziale) {\n      formattedStorico = `<div style=\"margin-bottom: 15px; font-style: italic;\">${testoIniziale}</div>` + formattedStorico;\n    }\n    \n    return formattedStorico;\n  };\n\n  const storicoFormattato = storico ? `\n    <div style=\"margin-top: 30px; border-top: 1px solid #e1e1e1; padding-top: 15px;\">\n      <div style=\"font-size: 12px; color: #666; margin-bottom: 15px; font-weight: bold;\">\n        ------ Messaggio originale ------\n      </div>\n      <div style=\"font-size: 13px; color: #555; font-family: Arial, sans-serif;\">\n        ${formatStoricoEmail(storico)}\n      </div>\n    </div>\n  ` : '''';\n\n  const fullHtml = `\n    <div style=\"font-family: Arial, sans-serif; font-size: 14px; color: #333; background-color: #fff;\">\n      ${corpo}\n      ${firmaHtml}\n      ${storicoFormattato}\n    </div>\n  `.trim();\n\n  item.json.text = fullHtml;\n  return item;\n});"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-500,880],"id":"ead4b00c-b9d9-46c8-9ad9-88164f118f1d","name":"‚úçÔ∏è Firma & Thread Formatter"},{"parameters":{"mode":"combine","combineBy":"combineByPosition","options":{}},"type":"n8n-nodes-base.merge","typeVersion":3.1,"position":[40,860],"id":"24b3979d-eb33-43d8-ad3c-50a308fab015","name":"Merge1"},{"parameters":{"assignments":{"assignments":[{"id":"e2e246d2-121c-46d6-9877-bfe89e8e3d84","name":"mittente","value":"={{ $json.mittente }}","type":"string"},{"id":"467d7417-6fd7-4187-8b04-85386f06ae31","name":"oggetto","value":"={{ $json.oggetto }}","type":"string"},{"id":"9c722cfc-cc87-4dd5-9373-a70d850e9d32","name":"text","value":"={{ $json.text }}<br><br><hr><br><pre style=\"font-family: Arial; font-size: 13px; color: #444;\"\n","type":"string"},{"id":"10119f66-dbe5-4786-920e-fdd22ccdebe1","name":"thread storico","value":"={{ $json.thread_storico }}","type":"string"},{"id":"24f6f546-2510-43fe-aacd-3a5c12d2c2b5","name":"id","value":"={{ $(''Ricezione Mail'').item.json.id }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-320,600],"id":"37fcff03-0d9a-46ab-9d65-09ce62cc93c6","name":"Fornisce ID mail per reply"},{"parameters":{"tableId":"email_processing_log"},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[520,860],"id":"8db3f01f-40b8-4732-abef-f24d72f0adc0","name":"COMPLETE MAIL DATA","credentials":{"supabaseApi":{"id":"U18uJwD80Uq036TV","name":"Supabase tiziano.annicchiarico@gmail.com"}}},{"parameters":{"pollTimes":{"item":[{"mode":"everyMinute"}]},"output":"fields","fields":["sender","replyTo","sentDateTime","subject","body","categories","ccRecipients"],"filters":{"custom":"isRead eq false","foldersToInclude":["AAMkADRmMTYxODRmLWJmZjYtNDQ4Ny1hZGE0LWQzYjNhZjJkZDQyMgAuAAAAAAAbCa7Kx9UPS7NhabBhamKLAQABIvZjidpvQo_FOUmjs9ACAAAAAAEMAAA="]},"options":{"downloadAttachments":false}},"type":"n8n-nodes-base.microsoftOutlookTrigger","typeVersion":1,"position":[-4460,1160],"id":"438a22eb-bc7a-474e-96f7-91a1c26ce655","name":"Ricezione Mail","credentials":{"microsoftOutlookOAuth2Api":{"id":"EySZIVRGzocRrEOf","name":"Outlook Info GommeGo"}}},{"parameters":{"operation":"move","messageId":{"__rl":true,"value":"={{ $json.id }}","mode":"id"},"folderId":{"__rl":true,"value":"AAMkADRmMTYxODRmLWJmZjYtNDQ4Ny1hZGE0LWQzYjNhZjJkZDQyMgAuAAAAAAAbCa7Kx9UPS7NhabBhamKLAQABIvZjidpvQo_FOUmjs9ACAAAAnNEhAAA=","mode":"list","cachedResultName":"GESTITI","cachedResultUrl":"https://outlook.office365.com/mail/AAMkADRmMTYxODRmLWJmZjYtNDQ4Ny1hZGE0LWQzYjNhZjJkZDQyMgAuAAAAAAAbCa7Kx9UPS7NhabBhamKLAQABIvZjidpvQo_FOUmjs9ACAAAAnNEhAAA%3D"}},"type":"n8n-nodes-base.microsoftOutlook","typeVersion":2,"position":[-4060,1580],"id":"ae552709-f5e7-40a5-aad3-4fa7dc424c28","name":"Sposta mail","webhookId":"5f6a19be-3e26-45a7-9386-a09b7903918c","credentials":{"microsoftOutlookOAuth2Api":{"id":"EySZIVRGzocRrEOf","name":"Outlook Info GommeGo"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"b71404c1-e51e-4745-887a-15059706f33a","leftValue":"={{ $json.isThreadReply }}","rightValue":true,"operator":{"type":"boolean","operation":"equals"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-3120,720],"id":"38a15e80-b065-486d-bf21-66049b254a70","name":"E'' UNA RISPOSTA?"},{"parameters":{"tableId":"email_processing_log","fieldsUi":{"fieldValues":[{"fieldId":"email_id","fieldValue":"={{ $json.supabase_data.email_id }}"},{"fieldId":"sender_email","fieldValue":"={{ $json.supabase_data.sender_email }}"},{"fieldId":"sender_name","fieldValue":"={{ $json.supabase_data.sender_name }}"},{"fieldId":"subject","fieldValue":"={{ $json.supabase_data.subject }}"},{"fieldId":"body_length","fieldValue":"={{ $json.supabase_data.body_length }}"},{"fieldId":"is_thread_reply","fieldValue":"={{ $json.supabase_data.is_thread_reply }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-3124,1250],"id":"8a093114-6d8c-4618-8f6e-7bec3a9de1e6","name":"PRE - PROCESSED DATA MAIL","retryOnFail":false,"alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"U18uJwD80Uq036TV","name":"Supabase tiziano.annicchiarico@gmail.com"}}},{"parameters":{"mode":"combine","combineBy":"combineByPosition","numberInputs":3,"options":{}},"type":"n8n-nodes-base.merge","typeVersion":3.1,"position":[-760,980],"id":"e954523f-5964-4707-b2e7-3ae5ce9d064f","name":"MERGE DI TUTTI I DATI"}]', '{"Email Classifier":{"main":[[{"node":"Write email1","type":"main","index":0}],[{"node":"Write email1","type":"main","index":0}],[{"node":"Write email1","type":"main","index":0}],[{"node":"Write email1","type":"main","index":0}],[{"node":"Write email1","type":"main","index":0}],[{"node":"No Operation, do nothing","type":"main","index":0}],[{"node":"No Operation, do nothing","type":"main","index":0}],[{"node":"Write email1","type":"main","index":0}]]},"Review email":{"main":[[{"node":"MERGE DI TUTTI I DATI","type":"main","index":1}]]},"OpenAI 4-o-mini":{"ai_languageModel":[[{"node":"Email Classifier","type":"ai_languageModel","index":0}]]},"OpenAI Chat Model3":{"ai_languageModel":[[{"node":"Review email","type":"ai_languageModel","index":0}]]},"OpenAI Chat Model4":{"ai_languageModel":[[{"node":"Write email1","type":"ai_languageModel","index":0}]]},"Embeddings OpenAI3":{"ai_embedding":[[{"node":"Qdrant Vector Store","type":"ai_embedding","index":0}]]},"Qdrant Vector Store":{"ai_tool":[[{"node":"Write email1","type":"ai_tool","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"Thread Reply Classifier","type":"ai_languageModel","index":0}]]},"Thread Reply Classifier":{"main":[[{"node":"Merge Email + Classification","type":"main","index":1}]]},"Merge Email + Classification":{"main":[[{"node":"Estrae tipo di interazione","type":"main","index":0}]]},"Write email1":{"main":[[{"node":"Review email","type":"main","index":0}]]},"INFO ORDINI":{"ai_tool":[[{"node":"Write email1","type":"ai_tool","index":0}]]},"Date & Time":{"ai_tool":[[{"node":"Write email1","type":"ai_tool","index":0}]]},"Prepara Email per Classificatore":{"main":[[{"node":"MERGE DI TUTTI I DATI","type":"main","index":0},{"node":"Merge Email + Classification","type":"main","index":0},{"node":"AI Classifier preliminare","type":"main","index":0},{"node":"üìä EMAIL DATA COLLECTOR","type":"main","index":0}]]},"Pulisci Testo":{"main":[[{"node":"Prepara Email per Classificatore","type":"main","index":0},{"node":"Information Extractor","type":"main","index":0}]]},"Estrae tipo di interazione":{"main":[[{"node":"Write email1","type":"main","index":0}]]},"OpenAI Chat Model1":{"ai_languageModel":[[{"node":"AI Classifier preliminare","type":"ai_languageModel","index":0}]]},"AI Classifier preliminare":{"main":[[],[{"node":"E'' UNA RISPOSTA?","type":"main","index":0}]]},"Rispondi a mittente":{"main":[[{"node":"Merge1","type":"main","index":0}]]},"OpenAI Chat Model2":{"ai_languageModel":[[{"node":"Information Extractor","type":"ai_languageModel","index":0}]]},"Information Extractor":{"main":[[{"node":"JSON Flat","type":"main","index":0}]]},"JSON Flat":{"main":[[{"node":"MERGE DI TUTTI I DATI","type":"main","index":2}]]},"üìä EMAIL DATA COLLECTOR":{"main":[[{"node":"PRE - PROCESSED DATA MAIL","type":"main","index":0}]]},"üìàüîÑ EMAIL COMPLETE DATA COLLECTOR":{"main":[[{"node":"COMPLETE MAIL DATA","type":"main","index":0}]]},"‚úçÔ∏è Firma & Thread Formatter":{"main":[[{"node":"Fornisce ID mail per reply","type":"main","index":0},{"node":"Merge1","type":"main","index":1}]]},"Merge1":{"main":[[{"node":"üìàüîÑ EMAIL COMPLETE DATA COLLECTOR","type":"main","index":0}]]},"Fornisce ID mail per reply":{"main":[[{"node":"Rispondi a mittente","type":"main","index":0}]]},"Ricezione Mail":{"main":[[{"node":"Pulisci Testo","type":"main","index":0},{"node":"Sposta mail","type":"main","index":0}]]},"E'' UNA RISPOSTA?":{"main":[[{"node":"Thread Reply Classifier","type":"main","index":0}],[{"node":"Email Classifier","type":"main","index":0}]]},"MERGE DI TUTTI I DATI":{"main":[[{"node":"‚úçÔ∏è Firma & Thread Formatter","type":"main","index":0},{"node":"Execute Workflow","type":"main","index":0}]]}}', '{"executionOrder":"v1"}', '{"node:Microsoft Outlook Trigger":{"lastTimeChecked":"2025-05-24T14:52:05.004+02:00"}}', '{"Ricezione Mail":[{"json":{"@odata.etag":"W/\"CQAAABYAAAABIvZjidpvQo+FOUmjs9ACAAAF6TUY\"","id":"AAMkADRmMTYxODRmLWJmZjYtNDQ4Ny1hZGE0LWQzYjNhZjJkZDQyMgBGAAAAAAAbCa7Kx9UPS7NhabBhamKLBwABIvZjidpvQo_FOUmjs9ACAAAAAAEMAAABIvZjidpvQo_FOUmjs9ACAAAF75lXAAA=","categories":[],"sentDateTime":"2025-05-26T19:38:30Z","subject":"Ordine MCWRWNXKT","body":{"contentType":"html","content":"<html><head>\r\n<meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\"></head><body style=\"line-break:after-white-space\">L‚Äôordine&nbsp;<span style=\"color:rgb(54,58,65); font-family:&quot;Open Sans&quot;,helvetica,arial,sans-serif; font-size:13.04px; background-color:rgb(250,251,252)\">MCWRWNXKT √® arrivato difettoso le gomme sono sbagliate , sono molto deluso cosa devo fare?</span> <div><span style=\"color:rgb(54,58,65); font-family:&quot;Open Sans&quot;,helvetica,arial,sans-serif; font-size:13.04px; background-color:rgb(250,251,252)\"><br></span></div><div><font color=\"#363a41\" face=\"Open Sans, helvetica, arial, sans-serif\" size=\"2\"><span style=\"\">Francesco&nbsp;</span></font></div></body></html>"},"sender":{"emailAddress":{"name":"Supplies TEC S.r.l.","address":"supplies@tecsolutions.app"}},"ccRecipients":[],"replyTo":[]}}]}', 'a00372ac-a934-4f4f-a999-9255ccc223b0', 1, '{"templateCredsSetupCompleted":true}', NULL, '2025-05-14T11:13:56.076Z', '2025-05-30T08:05:25.000Z', false),
  ('2cbf0f35-ef0d-48c7-8807-5bfb66d5fba8', 'Grab_Track_Simple', false, '[{"parameters":{"values":{"string":[{"name":"tracking_url","value":"https://parcelsapp.com/it/tracking/05308800572316"}]},"options":{}},"id":"bb5842d8-55b1-4887-8ec4-ab0fd8355d08","name":"Inserisci Link","type":"n8n-nodes-base.set","typeVersion":1,"position":[-200,-260],"notesInFlow":true,"notes":"Inserisci il link della spedizione qui"},{"parameters":{"url":"={{$json[\"tracking_url\"]}}","responseFormat":"string","options":{"followRedirect":true}},"id":"8061b3bd-456f-4965-9ed7-3b5e067069cb","name":"Scarica Pagina","type":"n8n-nodes-base.httpRequest","typeVersion":1,"position":[20,-260]},{"parameters":{"functionCode":"/**\n * Nodo di elaborazione per estrarre i dati di spedizione dal tracciamento BRT\n * Questo codice analizza il HTML o il testo estratto dalla pagina di tracciamento\n * e ne estrae tutte le informazioni rilevanti sulla spedizione\n */\n\n// Funzione principale che elabora i dati in entrata\nfunction processData(inputData) {\n  try {\n    // Variabile per memorizzare il testo HTML da elaborare\n    let htmlText = \"\";\n\n    // Estrai il contenuto HTML dall''input, che potrebbe essere in diverse forme\n    if (typeof inputData === ''string'') {\n      htmlText = inputData;\n    } else if (inputData && inputData[\"\"] !== undefined) {\n      htmlText = inputData[\"\"];\n    } else if (inputData && inputData.htmlContent) {\n      htmlText = inputData.htmlContent;\n    } else if (inputData && inputData.html) {\n      htmlText = inputData.html;\n    } else if (inputData && inputData.text) {\n      htmlText = inputData.text;\n    } else {\n      // Tenta di estrarre da qualsiasi campo disponibile\n      htmlText = JSON.stringify(inputData);\n    }\n\n    // Dati di spedizione estratti\n    const shippingData = {\n      numero_spedizione: extractValue(htmlText, \"N. spedizione\", /N\\.\\s*spedizione\\s*(\\d+)/i),\n      riferimento_mittente: extractValue(htmlText, \"Riferimento mittente\", /Riferimento\\s*mittente\\s*([^\\s\\n]+)/i),\n      mittente: extractValue(htmlText, \"Mittente\", /Mittente\\s*([^\\n]+?)\\s*(?:Destinatario|$)/i),\n      destinatario: extractValue(htmlText, \"Destinatario\", /Destinatario\\s*([^\\n]+?)\\s*(?:Natura|$)/i),\n      natura_merce: extractValue(htmlText, \"Natura merce\", /Natura\\s*merce\\s*([^\\s\\n]+)/i),\n      colli: extractNumericValue(htmlText, \"Colli\", /Colli:\\s*(\\d+)/i),\n      peso_kg: extractNumericValue(htmlText, \"Peso\", /Peso\\s*\\(kg\\):\\s*([\\d,\\.]+)/i),\n      volume_m3: extractNumericValue(htmlText, \"Volume\", /Volume\\s*m.:\\s*([\\d,\\.]+)/i),\n      filiale_arrivo: extractValue(htmlText, \"Filiale di arrivo\", /Filiale\\s*di\\s*arrivo\\s*([^\\s\\n]+)/i),\n      eventi: extractEvents(htmlText)\n    };\n    \n    // Verifica se sono stati estratti dati di base\n    const hasBasicData = shippingData.numero_spedizione || shippingData.mittente || shippingData.destinatario;\n    \n    if (!hasBasicData) {\n      // Se non abbiamo dati di base, proviamo un''estrazione alternativa dalla tabella HTML\n      try {\n        shippingData.numero_spedizione = extractFromTable(htmlText, \"N. spedizione\");\n        shippingData.riferimento_mittente = extractFromTable(htmlText, \"Riferimento mittente\");\n        shippingData.mittente = extractFromTable(htmlText, \"Mittente\");\n        shippingData.destinatario = extractFromTable(htmlText, \"Destinatario\");\n        shippingData.natura_merce = extractFromTable(htmlText, \"Natura merce\");\n        \n        // Estrai informazioni pi√π dettagliate come colli, peso e volume\n        const merceInfo = extractFromTable(htmlText, \"Natura merce\");\n        if (merceInfo) {\n          const colliMatch = merceInfo.match(/Colli:\\s*(\\d+)/i);\n          if (colliMatch) shippingData.colli = parseInt(colliMatch[1], 10);\n          \n          const pesoMatch = merceInfo.match(/Peso\\s*\\(kg\\):\\s*([\\d,\\.]+)/i);\n          if (pesoMatch) shippingData.peso_kg = parseFloat(pesoMatch[1].replace('','', ''.''));\n          \n          const volumeMatch = merceInfo.match(/Volume\\s*m.:\\s*([\\d,\\.]+)/i);\n          if (volumeMatch) shippingData.volume_m3 = parseFloat(volumeMatch[1].replace('','', ''.''));\n        }\n        \n        shippingData.filiale_arrivo = extractFromTable(htmlText, \"Filiale di arrivo\");\n        \n        // Se non abbiamo eventi, riprova l''estrazione\n        if (shippingData.eventi.length === 0) {\n          shippingData.eventi = extractTableEvents(htmlText);\n        }\n      } catch (tableError) {\n        console.log(\"Errore nell''estrazione dalla tabella:\", tableError.message);\n      }\n    }\n\n    // Aggiungi stato corrente della spedizione basato sull''ultimo evento\n    if (shippingData.eventi && shippingData.eventi.length > 0) {\n      shippingData.stato_corrente = shippingData.eventi[0].evento;\n      shippingData.ultimo_aggiornamento = {\n        data: shippingData.eventi[0].data,\n        ora: shippingData.eventi[0].ora\n      };\n      \n      // Calcola giorni di consegna\n      if (shippingData.eventi.length > 1) {\n        const dateFormat = /(\\d{2})\\.(\\d{2})\\.(\\d{4})/;\n        \n        // Trova l''evento di ritiro (solitamente il pi√π recente)\n        const ritiroEvento = shippingData.eventi.find(e => \n          e.evento.includes(\"RITIRATA\") || e.evento.includes(\"DATI SPEDIZ\"));\n        \n        // Trova l''evento di consegna (solitamente il primo)\n        const consegnaEvento = shippingData.eventi.find(e => \n          e.evento.includes(\"CONSEGNATA\"));\n        \n        if (ritiroEvento && consegnaEvento) {\n          const ritiroMatch = ritiroEvento.data.match(dateFormat);\n          const consegnaMatch = consegnaEvento.data.match(dateFormat);\n          \n          if (ritiroMatch && consegnaMatch) {\n            const dataRitiro = new Date(\n              parseInt(ritiroMatch[3]), // Anno\n              parseInt(ritiroMatch[2]) - 1, // Mese (0-based)\n              parseInt(ritiroMatch[1]) // Giorno\n            );\n            \n            const dataConsegna = new Date(\n              parseInt(consegnaMatch[3]), // Anno\n              parseInt(consegnaMatch[2]) - 1, // Mese (0-based)\n              parseInt(consegnaMatch[1]) // Giorno\n            );\n            \n            // Calcola la differenza in millisecondi e converti in giorni\n            const differenzaMs = dataConsegna - dataRitiro;\n            const giorniConsegna = Math.round(differenzaMs / (1000 * 60 * 60 * 24));\n            \n            shippingData.giorni_consegna = giorniConsegna;\n          }\n        }\n      }\n    }\n\n    return shippingData;\n  } catch (error) {\n    console.error(\"Errore nell''estrazione dei dati di spedizione:\", error);\n    return { \n      error: error.message,\n      errorDetail: error.stack \n    };\n  }\n}\n\n// Funzione per estrarre valori di testo\nfunction extractValue(text, fieldName, regex) {\n  try {\n    const match = text.match(regex);\n    return match ? match[1].trim() : null;\n  } catch (error) {\n    console.log(`Errore nell''estrazione del campo ${fieldName}:`, error.message);\n    return null;\n  }\n}\n\n// Funzione per estrarre valori numerici\nfunction extractNumericValue(text, fieldName, regex) {\n  try {\n    const match = text.match(regex);\n    if (!match) return null;\n    const value = match[1].replace('','', ''.'');\n    return isNaN(parseFloat(value)) ? null : parseFloat(value);\n  } catch (error) {\n    console.log(`Errore nell''estrazione del valore numerico ${fieldName}:`, error.message);\n    return null;\n  }\n}\n\n// Funzione per estrarre eventi di spedizione\nfunction extractEvents(text) {\n  try {\n    const events = [];\n    \n    // Cerca la sezione degli eventi\n    const eventiMatch = text.match(/Eventi[\\s\\S]*?Data[\\s\\S]*?Ora[\\s\\S]*?Filiale[\\s\\S]*?Evento([\\s\\S]*?)(?:TRACKING SPEDIZIONI|$)/i);\n    \n    if (!eventiMatch) return events;\n    \n    // Estrai le righe degli eventi\n    const eventiText = eventiMatch[1];\n    const righeEventi = eventiText.split(''\\n'').filter(riga => riga.trim() !== '''');\n    \n    // Pattern per riconoscere una riga di evento: data, ora, filiale, evento\n    const eventoPattern = /(\\d{2}\\.\\d{2}\\.\\d{4})\\s+(\\d{2}\\.\\d{2})\\s+([^(]+)(\\(\\d+\\))?\\s+(.+)/;\n    \n    for (const riga of righeEventi) {\n      const match = riga.match(eventoPattern);\n      if (match) {\n        events.push({\n          data: match[1].trim(),\n          ora: match[2].trim(),\n          filiale: (match[3] + (match[4] || \"\")).trim(),\n          evento: match[5].trim()\n        });\n      }\n    }\n    \n    return events;\n  } catch (error) {\n    console.log(\"Errore nell''estrazione degli eventi:\", error.message);\n    return [];\n  }\n}\n\n// Funzione per estrarre dati da una tabella HTML\nfunction extractFromTable(html, fieldName) {\n  try {\n    // Pattern per cercare una riga di tabella con il nome del campo\n    const pattern = new RegExp(`${fieldName}[\\\\s]*<\\\\/[^>]+>[\\\\s]*<[^>]+>([^<]+)`, ''i'');\n    const match = html.match(pattern);\n    return match ? match[1].trim() : null;\n  } catch (error) {\n    console.log(`Errore nell''estrazione dalla tabella per ${fieldName}:`, error.message);\n    return null;\n  }\n}\n\n// Funzione per estrarre eventi da una tabella HTML\nfunction extractTableEvents(html) {\n  try {\n    const events = [];\n    \n    // Cerca la tabella degli eventi\n    const tableMatch = html.match(/<table[^>]*>[\\s\\S]*?<th[^>]*>Data<\\/th>[\\s\\S]*?<th[^>]*>Ora<\\/th>[\\s\\S]*?<th[^>]*>Filiale<\\/th>[\\s\\S]*?<th[^>]*>Evento<\\/th>([\\s\\S]*?)<\\/table>/i);\n    \n    if (!tableMatch) return events;\n    \n    // Estrai le righe della tabella\n    const tableContent = tableMatch[1];\n    const rows = tableContent.match(/<tr[^>]*>([\\s\\S]*?)<\\/tr>/gi);\n    \n    if (!rows) return events;\n    \n    for (const row of rows) {\n      // Estrai le celle della riga\n      const cells = row.match(/<td[^>]*>([\\s\\S]*?)<\\/td>/gi);\n      \n      if (cells && cells.length >= 4) {\n        const data = cells[0].replace(/<[^>]+>/g, '''').trim();\n        const ora = cells[1].replace(/<[^>]+>/g, '''').trim();\n        const filiale = cells[2].replace(/<[^>]+>/g, '''').trim();\n        const evento = cells[3].replace(/<[^>]+>/g, '''').trim();\n        \n        if (data && ora && filiale && evento) {\n          events.push({\n            data,\n            ora,\n            filiale,\n            evento\n          });\n        }\n      }\n    }\n    \n    return events;\n  } catch (error) {\n    console.log(\"Errore nell''estrazione degli eventi dalla tabella:\", error.message);\n    return [];\n  }\n}\n\n// Funzione principale del nodo n8n\ntry {\n  // Ottieni i dati dall''input del nodo\n  const items = $input.all();\n  const results = [];\n  \n  // Elabora ciascun item in input\n  for (const item of items) {\n    // Estrai i dati di spedizione\n    const shippingData = processData(item.json);\n    \n    // Aggiungi i dati estratti al risultato\n    results.push({\n      json: {\n        // Mantieni i dati originali se necessario\n        // ...item.json,\n        \n        // Aggiungi i dati di spedizione estratti\n        datiSpedizione: shippingData,\n        \n        // Aggiungi anche alcuni campi utili a livello root per facilit√† d''uso\n        numeroSpedizione: shippingData.numero_spedizione,\n        statoSpedizione: shippingData.stato_corrente,\n        dataAggiornamento: shippingData.ultimo_aggiornamento ? shippingData.ultimo_aggiornamento.data : null,\n        \n        // Flag per indicare se i dati sono stati estratti correttamente\n        dataEstrattaCorrettamente: Boolean(shippingData.numero_spedizione)\n      }\n    });\n  }\n  \n  // Restituisci i risultati\n  return results;\n} catch (error) {\n  console.error(\"Errore generale nel nodo:\", error);\n  return [{\n    json: {\n      error: error.message,\n      errorDetails: error.stack\n    }\n  }];\n}"},"id":"a9f135ae-877a-4357-a868-2bc44001cbc8","name":"Filtra Righe","type":"n8n-nodes-base.function","typeVersion":1,"position":[160,-660]},{"parameters":{"prompt":"sei un esperto di interpretazione di link di traking restituisci lo stato di questa spedizione","options":{},"requestOptions":{}},"id":"54e52c54-e8a3-4473-8fdb-f6d8eafc09a2","name":"OpenAI (Interpreta)","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[820,-540],"credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[-380,-260],"id":"6057de54-c452-442c-aa4d-c6e16ff17b67","name":"When clicking ‚ÄòTest workflow‚Äô"},{"parameters":{"operation":"extractHtmlContent","extractionValues":{"values":[{"key":"=","cssSelector":"body"}]},"options":{}},"type":"n8n-nodes-base.html","typeVersion":1.2,"position":[-120,-680],"id":"5466b1c5-782e-4564-8608-7ef82e17f304","name":"HTML"},{"parameters":{"functionCode":"/**\n * Nodo di elaborazione per estrarre i dati di spedizione da diversi corrieri\n * Supporta: BRT, DHL, GLS, SDA, Bartolini e altri\n */\n\n// Funzione principale del nodo n8n\ntry {\n  // Ottieni i dati dall''input del nodo\n  const items = $input.all();\n  const results = [];\n  \n  // Elabora ciascun item in input\n  for (const item of items) {\n    // Identifica il corriere e processa i dati\n    const processedData = processShippingData(item.json);\n    \n    // Aggiungi i dati estratti al risultato\n    results.push({\n      json: {\n        // Mantieni i dati originali se necessario\n        // ...item.json,\n        \n        // Aggiungi i dati di spedizione estratti\n        datiSpedizione: processedData.shippingData,\n        \n        // Aggiungi informazioni sul corriere identificato\n        corriere: processedData.courier,\n        \n        // Flag per indicare se i dati sono stati estratti correttamente\n        dataEstrattaCorrettamente: processedData.success\n      }\n    });\n  }\n  \n  // Restituisci i risultati\n  return results;\n} catch (error) {\n  console.error(\"Errore generale nel nodo:\", error);\n  return [{\n    json: {\n      error: error.message,\n      errorDetails: error.stack\n    }\n  }];\n}\n\n/**\n * Funzione principale che processa i dati e identifica il corriere\n */\nfunction processShippingData(inputData) {\n  try {\n    // Estrai il testo HTML dall''input\n    const htmlText = extractHtmlText(inputData);\n    \n    // Identifica il corriere in base al contenuto\n    const courier = identifyCourier(htmlText);\n    \n    // Estrai i dati in base al corriere identificato\n    let shippingData = {};\n    let success = false;\n    \n    switch (courier) {\n      case ''BRT'':\n        shippingData = extractBRTData(htmlText);\n        break;\n      case ''DHL'':\n        shippingData = extractDHLData(htmlText);\n        break;\n      case ''GLS'':\n        shippingData = extractGLSData(htmlText);\n        break;\n      case ''SDA'':\n        shippingData = extractSDAData(htmlText);\n        break;\n      case ''TNT'':\n        shippingData = extractTNTData(htmlText);\n        break;\n      case ''UPS'':\n        shippingData = extractUPSData(htmlText);\n        break;\n      case ''FEDEX'':\n        shippingData = extractFedExData(htmlText);\n        break;\n      default:\n        // Prova con una strategia generica\n        shippingData = extractGenericShippingData(htmlText);\n    }\n    \n    // Verifica se l''estrazione ha avuto successo\n    success = Boolean(shippingData.numero_spedizione || shippingData.tracking_number);\n    \n    return {\n      courier,\n      shippingData,\n      success\n    };\n  } catch (error) {\n    console.error(\"Errore nell''elaborazione dei dati di spedizione:\", error);\n    return { \n      courier: ''UNKNOWN'',\n      shippingData: { error: error.message },\n      success: false\n    };\n  }\n}\n\n/**\n * Estrae il testo HTML dall''input\n */\nfunction extractHtmlText(inputData) {\n  if (typeof inputData === ''string'') {\n    return inputData;\n  } else if (inputData && inputData[\"\"] !== undefined) {\n    return inputData[\"\"];\n  } else if (inputData && inputData.htmlContent) {\n    return inputData.htmlContent;\n  } else if (inputData && inputData.html) {\n    return inputData.html;\n  } else if (inputData && inputData.text) {\n    return inputData.text;\n  } else {\n    // Tenta di estrarre da qualsiasi campo disponibile\n    return JSON.stringify(inputData);\n  }\n}\n\n/**\n * Identifica il corriere in base al contenuto\n */\nfunction identifyCourier(htmlText) {\n  const lowerText = htmlText.toLowerCase();\n  \n  // Controlla i vari corrieri in base a pattern o parole chiave specifiche\n  if (lowerText.includes(''brt.it'') || lowerText.includes(''brt s.p.a'') || lowerText.includes(''ritraccia spedizione'')) {\n    return ''BRT'';\n  } else if (lowerText.includes(''dhl'') || lowerText.includes(''deutsche post'')) {\n    return ''DHL'';\n  } else if (lowerText.includes(''gls'') || lowerText.includes(''general logistics systems'')) {\n    return ''GLS'';\n  } else if (lowerText.includes(''sda'') || lowerText.includes(''sda express courier'')) {\n    return ''SDA'';\n  } else if (lowerText.includes(''tnt'') || lowerText.includes(''fedex express'')) {\n    return ''TNT'';\n  } else if (lowerText.includes(''ups'') || lowerText.includes(''united parcel service'')) {\n    return ''UPS'';\n  } else if (lowerText.includes(''fedex'') || lowerText.includes(''federal express'')) {\n    return ''FEDEX'';\n  }\n  \n  // Nessun corriere identificato\n  return ''UNKNOWN'';\n}\n\n/**\n * Parser specifico per BRT\n */\nfunction extractBRTData(htmlText) {\n  try {\n    // Dati di spedizione estratti\n    const shippingData = {\n      numero_spedizione: extractValue(htmlText, \"N. spedizione\", /N\\.\\s*spedizione\\s*(\\d+)/i),\n      riferimento_mittente: extractValue(htmlText, \"Riferimento mittente\", /Riferimento\\s*mittente\\s*([^\\s\\n]+)/i),\n      mittente: extractValue(htmlText, \"Mittente\", /Mittente\\s*([^\\n]+?)\\s*(?:Destinatario|$)/i),\n      destinatario: extractValue(htmlText, \"Destinatario\", /Destinatario\\s*([^\\n]+?)\\s*(?:Natura|$)/i),\n      natura_merce: extractValue(htmlText, \"Natura merce\", /Natura\\s*merce\\s*([^\\s\\n]+)/i),\n      colli: extractNumericValue(htmlText, \"Colli\", /Colli:\\s*(\\d+)/i),\n      peso_kg: extractNumericValue(htmlText, \"Peso\", /Peso\\s*\\(kg\\):\\s*([\\d,\\.]+)/i),\n      volume_m3: extractNumericValue(htmlText, \"Volume\", /Volume\\s*m.:\\s*([\\d,\\.]+)/i),\n      filiale_arrivo: extractValue(htmlText, \"Filiale di arrivo\", /Filiale\\s*di\\s*arrivo\\s*([^\\s\\n]+)/i),\n      eventi: extractBRTEvents(htmlText)\n    };\n    \n    // Verifica se sono stati estratti dati di base\n    const hasBasicData = shippingData.numero_spedizione || shippingData.mittente || shippingData.destinatario;\n    \n    if (!hasBasicData) {\n      // Se non abbiamo dati di base, prova l''estrazione dalla tabella HTML\n      try {\n        shippingData.numero_spedizione = extractFromTable(htmlText, \"N. spedizione\");\n        shippingData.riferimento_mittente = extractFromTable(htmlText, \"Riferimento mittente\");\n        shippingData.mittente = extractFromTable(htmlText, \"Mittente\");\n        shippingData.destinatario = extractFromTable(htmlText, \"Destinatario\");\n        shippingData.natura_merce = extractFromTable(htmlText, \"Natura merce\");\n        \n        // Estrai informazioni pi√π dettagliate\n        const merceInfo = extractFromTable(htmlText, \"Natura merce\");\n        if (merceInfo) {\n          const colliMatch = merceInfo.match(/Colli:\\s*(\\d+)/i);\n          if (colliMatch) shippingData.colli = parseInt(colliMatch[1], 10);\n          \n          const pesoMatch = merceInfo.match(/Peso\\s*\\(kg\\):\\s*([\\d,\\.]+)/i);\n          if (pesoMatch) shippingData.peso_kg = parseFloat(pesoMatch[1].replace('','', ''.''));\n          \n          const volumeMatch = merceInfo.match(/Volume\\s*m.:\\s*([\\d,\\.]+)/i);\n          if (volumeMatch) shippingData.volume_m3 = parseFloat(volumeMatch[1].replace('','', ''.''));\n        }\n        \n        shippingData.filiale_arrivo = extractFromTable(htmlText, \"Filiale di arrivo\");\n        \n        // Se non abbiamo eventi, riprova l''estrazione\n        if (shippingData.eventi.length === 0) {\n          shippingData.eventi = extractTableEvents(htmlText);\n        }\n      } catch (tableError) {\n        console.log(\"Errore nell''estrazione dalla tabella BRT:\", tableError.message);\n      }\n    }\n\n    // Aggiungi stato corrente della spedizione basato sull''ultimo evento\n    if (shippingData.eventi && shippingData.eventi.length > 0) {\n      shippingData.stato_corrente = shippingData.eventi[0].evento;\n      shippingData.ultimo_aggiornamento = {\n        data: shippingData.eventi[0].data,\n        ora: shippingData.eventi[0].ora\n      };\n    }\n\n    return shippingData;\n  } catch (error) {\n    console.error(\"Errore nell''estrazione dei dati BRT:\", error);\n    return { error: error.message };\n  }\n}\n\n/**\n * Estrae eventi specifici di BRT\n */\nfunction extractBRTEvents(text) {\n  try {\n    const events = [];\n    \n    // Cerca la sezione degli eventi\n    const eventiMatch = text.match(/Eventi[\\s\\S]*?Data[\\s\\S]*?Ora[\\s\\S]*?Filiale[\\s\\S]*?Evento([\\s\\S]*?)(?:TRACKING SPEDIZIONI|$)/i);\n    \n    if (!eventiMatch) return events;\n    \n    // Estrai le righe degli eventi\n    const eventiText = eventiMatch[1];\n    const righeEventi = eventiText.split(''\\n'').filter(riga => riga.trim() !== '''');\n    \n    // Pattern per riconoscere una riga di evento: data, ora, filiale, evento\n    const eventoPattern = /(\\d{2}\\.\\d{2}\\.\\d{4})\\s+(\\d{2}\\.\\d{2})\\s+([^(]+)(\\(\\d+\\))?\\s+(.+)/;\n    \n    for (const riga of righeEventi) {\n      const match = riga.match(eventoPattern);\n      if (match) {\n        events.push({\n          data: match[1].trim(),\n          ora: match[2].trim(),\n          filiale: (match[3] + (match[4] || \"\")).trim(),\n          evento: match[5].trim()\n        });\n      }\n    }\n    \n    return events;\n  } catch (error) {\n    console.log(\"Errore nell''estrazione degli eventi BRT:\", error.message);\n    return [];\n  }\n}\n\n/**\n * Parser specifico per DHL\n * NOTA: Questo √® un esempio di implementazione, da completare con parser reali\n */\nfunction extractDHLData(htmlText) {\n  try {\n    // Implementazione specifica per DHL\n    const shippingData = {\n      tracking_number: extractValue(htmlText, \"Tracking Number\", /Tracking\\s*(?:Number|ID):\\s*([A-Z0-9]+)/i),\n      sender: extractValue(htmlText, \"Sender\", /(?:Sender|From):\\s*([^\\n]+)/i),\n      recipient: extractValue(htmlText, \"Recipient\", /(?:Recipient|To):\\s*([^\\n]+)/i),\n      status: extractValue(htmlText, \"Status\", /(?:Status|Current\\s*Status):\\s*([^\\n]+)/i),\n      events: extractDHLEvents(htmlText)\n    };\n    \n    return shippingData;\n  } catch (error) {\n    console.error(\"Errore nell''estrazione dei dati DHL:\", error);\n    return { error: error.message };\n  }\n}\n\n/**\n * NOTA: Questa √® una funzione placeholder per l''estrazione eventi DHL\n */\nfunction extractDHLEvents(text) {\n  // Implementare estrazione eventi DHL\n  return [];\n}\n\n/**\n * Altri parser specifici per corriere (GLS, SDA, ecc.)\n * Da implementare con la stessa struttura\n */\nfunction extractGLSData(htmlText) {\n  // Implementare parser GLS\n  return {};\n}\n\nfunction extractSDAData(htmlText) {\n  // Implementare parser SDA\n  return {};\n}\n\nfunction extractTNTData(htmlText) {\n  // Implementare parser TNT\n  return {};\n}\n\nfunction extractUPSData(htmlText) {\n  // Implementare parser UPS\n  return {};\n}\n\nfunction extractFedExData(htmlText) {\n  // Implementare parser FedEx\n  return {};\n}\n\n/**\n * Parser generico che tenta di estrarre informazioni comuni\n * da qualsiasi formato di corriere non riconosciuto\n */\nfunction extractGenericShippingData(htmlText) {\n  try {\n    // Tenta un''estrazione generica di informazioni comuni\n    const trackingNumber = extractValue(htmlText, \"Tracking Number\", \n      /(?:Tracking|Spedizione|Shipment|Numero)(?:\\s*Number|\\s*ID|\\s*spedizione)?[:.\\s]*([A-Z0-9]+)/i);\n    \n    const status = extractValue(htmlText, \"Status\", \n      /(?:Status|Stato|Statut)[:.\\s]*([^\\n]+)/i);\n    \n    // Cerca date e eventi in formati generici\n    const events = extractGenericEvents(htmlText);\n    \n    return {\n      tracking_number: trackingNumber,\n      stato: status,\n      eventi: events\n    };\n  } catch (error) {\n    console.error(\"Errore nell''estrazione generica:\", error);\n    return { error: error.message };\n  }\n}\n\n/**\n * Estrae eventi in formato generico\n */\nfunction extractGenericEvents(text) {\n  try {\n    const events = [];\n    \n    // Pattern generici per date\n    const datePatterns = [\n      /(\\d{2}[\\/\\.-]\\d{2}[\\/\\.-]\\d{2,4})\\s+(\\d{2}:\\d{2})\\s+([^\\n]+)/g, // formato dd/mm/yyyy hh:mm testo\n      /(\\d{4}[\\/\\.-]\\d{2}[\\/\\.-]\\d{2})\\s+(\\d{2}:\\d{2}(?::\\d{2})?)\\s+([^\\n]+)/g  // formato yyyy/mm/dd hh:mm:ss testo\n    ];\n    \n    // Cerca eventi usando i pattern\n    for (const pattern of datePatterns) {\n      let match;\n      while ((match = pattern.exec(text)) !== null) {\n        events.push({\n          data: match[1],\n          ora: match[2],\n          descrizione: match[3].trim()\n        });\n      }\n    }\n    \n    return events;\n  } catch (error) {\n    console.log(\"Errore nell''estrazione degli eventi generici:\", error.message);\n    return [];\n  }\n}\n\n// Funzioni di supporto\n\nfunction extractValue(text, fieldName, regex) {\n  try {\n    const match = text.match(regex);\n    return match ? match[1].trim() : null;\n  } catch (error) {\n    console.log(`Errore nell''estrazione del campo ${fieldName}:`, error.message);\n    return null;\n  }\n}\n\nfunction extractNumericValue(text, fieldName, regex) {\n  try {\n    const match = text.match(regex);\n    if (!match) return null;\n    const value = match[1].replace('','', ''.'');\n    return isNaN(parseFloat(value)) ? null : parseFloat(value);\n  } catch (error) {\n    console.log(`Errore nell''estrazione del valore numerico ${fieldName}:`, error.message);\n    return null;\n  }\n}\n\nfunction extractFromTable(html, fieldName) {\n  try {\n    // Pattern per cercare una riga di tabella con il nome del campo\n    const pattern = new RegExp(`${fieldName}[\\\\s]*<\\\\/[^>]+>[\\\\s]*<[^>]+>([^<]+)`, ''i'');\n    const match = html.match(pattern);\n    return match ? match[1].trim() : null;\n  } catch (error) {\n    console.log(`Errore nell''estrazione dalla tabella per ${fieldName}:`, error.message);\n    return null;\n  }\n}\n\nfunction extractTableEvents(html) {\n  try {\n    const events = [];\n    \n    // Cerca la tabella degli eventi\n    const tableMatch = html.match(/<table[^>]*>[\\s\\S]*?<th[^>]*>Data<\\/th>[\\s\\S]*?<th[^>]*>Ora<\\/th>[\\s\\S]*?<th[^>]*>Filiale<\\/th>[\\s\\S]*?<th[^>]*>Evento<\\/th>([\\s\\S]*?)<\\/table>/i);\n    \n    if (!tableMatch) return events;\n    \n    // Estrai le righe della tabella\n    const tableContent = tableMatch[1];\n    const rows = tableContent.match(/<tr[^>]*>([\\s\\S]*?)<\\/tr>/gi);\n    \n    if (!rows) return events;\n    \n    for (const row of rows) {\n      // Estrai le celle della riga\n      const cells = row.match(/<td[^>]*>([\\s\\S]*?)<\\/td>/gi);\n      \n      if (cells && cells.length >= 4) {\n        const data = cells[0].replace(/<[^>]+>/g, '''').trim();\n        const ora = cells[1].replace(/<[^>]+>/g, '''').trim();\n        const filiale = cells[2].replace(/<[^>]+>/g, '''').trim();\n        const evento = cells[3].replace(/<[^>]+>/g, '''').trim();\n        \n        if (data && ora && filiale && evento) {\n          events.push({\n            data,\n            ora,\n            filiale,\n            evento\n          });\n        }\n      }\n    }\n    \n    return events;\n  } catch (error) {\n    console.log(\"Errore nell''estrazione degli eventi dalla tabella:\", error.message);\n    return [];\n  }\n}"},"id":"ada7970e-7d5f-4341-86e2-7afaff1e9744","name":"Filtra Righe1","type":"n8n-nodes-base.function","typeVersion":1,"position":[400,-260]},{"parameters":{"operation":"html","binaryPropertyName":"=data","options":{"rawData":false}},"type":"n8n-nodes-base.extractFromFile","typeVersion":1,"position":[440,-660],"id":"23eab952-a77f-450d-ae5b-ff8be5da00d4","name":"Extract from File"},{"parameters":{"jsCode":"// Ottieni HTML da campo \"data\" (come nel tuo flusso)\nconst htmlText = $json.data || \"\";\n\nif (!htmlText) {\n  throw new Error(\"Nessun HTML trovato in ''data''\");\n}\n\n// Esegui il parsing con la funzione aggiornata\nconst shippingData = extractBRTData(htmlText);\n\n// Restituisci nel formato corretto per n8n\nreturn [\n  {\n    json: {\n      datiSpedizione: shippingData,\n      dataEstrattaCorrettamente: !!shippingData.numero_spedizione,\n    },\n  },\n];\n\n/** FUNZIONI DI PARSING **/\nfunction extractBRTData(htmlText) {\n  try {\n    const shippingData = {};\n\n    const detailMatch = htmlText.match(/Dettaglio della spedizione[\\s\\S]*?(<table[\\s\\S]*?<\\/table>)/i);\n    const detailTable = detailMatch ? detailMatch[1] : \"\";\n\n    shippingData.numero_spedizione = extractValue(detailTable, \"Numero spedizione\", /(?:BRTcode|N\\.\\s*spedizione)[^<]*<\\/td>\\s*<td[^>]*>(\\d{10,20})<\\/td>/i);\n    shippingData.riferimento_mittente = extractValue(detailTable, \"Riferimento mittente\", /Riferimento\\s*mittente[^<]*<\\/td>\\s*<td[^>]*>([^<]+)<\\/td>/i);\n    shippingData.mittente = extractValue(detailTable, \"Mittente\", /Mittente[^<]*<\\/td>\\s*<td[^>]*>([^<]+)<\\/td>/i);\n    shippingData.destinatario = extractValue(detailTable, \"Destinatario\", /Destinatario[^<]*<\\/td>\\s*<td[^>]*>([^<]+)<\\/td>/i);\n    shippingData.natura_merce = extractValue(detailTable, \"Natura merce\", /Natura\\s*merce[^<]*<\\/td>\\s*<td[^>]*>([^<]+)<\\/td>/i);\n    shippingData.filiale_arrivo = extractValue(detailTable, \"Filiale di arrivo\", /Filiale\\s*di\\s*arrivo[^<]*<\\/td>\\s*<td[^>]*>([^<]+)<\\/td>/i);\n    shippingData.colli = extractNumericValue(detailTable, \"Colli\", /Colli:\\s*(\\d+)/i);\n    shippingData.peso_kg = extractNumericValue(detailTable, \"Peso\", /Peso\\s*\\(kg\\):\\s*([\\d,.]+)/i);\n    shippingData.volume_m3 = extractNumericValue(detailTable, \"Volume\", /Volume\\s*m¬≥:\\s*([\\d,.]+)/i);\n\n    shippingData.eventi = extractBRTEvents(htmlText);\n\n    if (shippingData.eventi.length > 0) {\n      shippingData.stato_corrente = shippingData.eventi[0].evento;\n      shippingData.ultimo_aggiornamento = {\n        data: shippingData.eventi[0].data,\n        ora: shippingData.eventi[0].ora\n      };\n    }\n\n    return shippingData;\n  } catch (error) {\n    return { error: error.message };\n  }\n}\n\nfunction extractValue(text, fieldName, regex) {\n  try {\n    const match = text.match(regex);\n    return match ? match[1].trim() : null;\n  } catch {\n    return null;\n  }\n}\n\nfunction extractNumericValue(text, fieldName, regex) {\n  try {\n    const match = text.match(regex);\n    if (!match) return null;\n    const value = match[1].replace(\",\", \".\");\n    return parseFloat(value);\n  } catch {\n    return null;\n  }\n}\n\nfunction extractBRTEvents(text) {\n  const events = [];\n  const tableRegex = /<table[^>]*>[\\s\\S]*?<th[^>]*>Data<\\/th>[\\s\\S]*?<th[^>]*>Ora<\\/th>[\\s\\S]*?<th[^>]*>Filiale<\\/th>[\\s\\S]*?<th[^>]*>Evento<\\/th>([\\s\\S]*?)<\\/table>/i;\n  const tableMatch = text.match(tableRegex);\n\n  if (tableMatch) {\n    const tableContent = tableMatch[1];\n    const rowRegex = /<tr[^>]*>([\\s\\S]*?)<\\/tr>/gi;\n    let rowMatch;\n\n    while ((rowMatch = rowRegex.exec(tableContent)) !== null) {\n      const rowHtml = rowMatch[1];\n      const cellRegex = /<td[^>]*>([\\s\\S]*?)<\\/td>/gi;\n      const cells = [];\n      let cellMatch;\n\n      while ((cellMatch = cellRegex.exec(rowHtml)) !== null) {\n        cells.push(cellMatch[1].replace(/<[^>]+>/g, \"\").trim());\n      }\n\n      if (cells.length >= 4) {\n        events.push({\n          data: cells[0],\n          ora: cells[1],\n          filiale: cells[2],\n          evento: cells[3]\n        });\n      }\n    }\n  }\n\n  return events;\n}\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[200,-260],"id":"d72056e5-2797-4340-9dfd-618dabb6e7a7","name":"Code"},{"parameters":{"resource":"chat","model":"gpt-4","prompt":{"messages":[{"role":"system","content":"=Sei un assistente di tracking spedizioni. Riceverai i dati strutturati di una spedizione. \n{{ $json.datiSpedizione.stato }}\n\nRiassumi lo stato attuale: se √® stata consegnata, quando, dove, e da chi a chi. Se non ancora consegnata, indica dove si trova ora."}]},"options":{},"requestOptions":{}},"id":"46d16e13-fa31-4943-aaab-7eacfa932046","name":"AI - Interpreta Spedizione","type":"n8n-nodes-base.openAi","typeVersion":1,"position":[680,-100],"credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}}]', '{"Inserisci Link":{"main":[[{"node":"Scarica Pagina","type":"main","index":0}]]},"Scarica Pagina":{"main":[[{"node":"Code","type":"main","index":0}]]},"Filtra Righe":{"main":[[]]},"When clicking ‚ÄòTest workflow‚Äô":{"main":[[{"node":"Inserisci Link","type":"main","index":0}]]},"HTML":{"main":[[]]},"Code":{"main":[[{"node":"Filtra Righe1","type":"main","index":0}]]},"AI - Interpreta Spedizione":{"main":[[]]},"Filtra Righe1":{"main":[[{"node":"AI - Interpreta Spedizione","type":"main","index":0}]]}}', '{"executionOrder":"v1"}', NULL, '{}', '6f8f6f96-9b04-4433-b152-bc7e0ed3826b', 0, NULL, NULL, '2025-05-14T14:15:58.889Z', '2025-05-23T20:49:18.000Z', true),
  ('14ac3d3d-cbc4-42d5-9362-6ea276c18bcb', 'SUB_PARCELAPP', false, '[{"parameters":{"requestMethod":"POST","url":"https://parcelsapp.com/api/v3/shipments/tracking","jsonParameters":true,"options":{},"bodyParametersJson":"={\n  \"shipments\": [\n    {\n      \"trackingId\": \"{{ $json.trackingId }}\",\n      \"destinationCountry\": \"{{ $json.destinationCountry }}\"\n    }\n  ],\n  \"language\": \"{{ $json.language }}\",\n  \"apiKey\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOiI1MzA4NjNjMC0zMTBkLTExZjAtYjdlMC04ZGQzNjVmMWI4NjEiLCJzdWJJZCI6IjY4MjUwZmVlMjZiMWViMTEwNWMzY2VhNCIsImlhdCI6MTc0NzI1OTM3NH0.JZJzbEq2Fy4uX64VqRbcZRKlxmQyzwzVTuoFmTyQ8KA\"\n}"},"id":"271fbe0f-536d-4a69-839e-b8fdc0a00152","name":"HTTP Request (POST Tracking)1","type":"n8n-nodes-base.httpRequest","typeVersion":1,"position":[-624,80]},{"parameters":{"url":"=https://parcelsapp.com/api/v3/shipments/tracking?uuid={{$json[\"uuid\"]}}&apiKey=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOiI1MzA4NjNjMC0zMTBkLTExZjAtYjdlMC04ZGQzNjVmMWI4NjEiLCJzdWJJZCI6IjY4MjUwZmVlMjZiMWViMTEwNWMzY2VhNCIsImlhdCI6MTc0NzI1OTM3NH0.JZJzbEq2Fy4uX64VqRbcZRKlxmQyzwzVTuoFmTyQ8KA","options":{}},"id":"1ba14001-d3c8-4634-88e3-a664e71f6360","name":"HTTP Request (GET Tracking Status)1","type":"n8n-nodes-base.httpRequest","typeVersion":1,"position":[48,192]},{"parameters":{"functionCode":"// Codice per estrarre e formattare tutte le informazioni di tracciamento con etichette in italiano\nconst inputData = $input.item.json;\nlet trackingData = inputData.trackingData || inputData.shipmentData || inputData;\nlet shipment = null;\n\n// Se l''input √® un array, prendi il primo elemento\nif (Array.isArray(trackingData)) {\n  trackingData = trackingData[0];\n}\n\n// Handle the case where the tracking data has a different structure\nif (trackingData && !trackingData.shipments && trackingData.data) {\n  trackingData = trackingData.data;\n}\n\n// Trova la spedizione corretta\nif (trackingData && trackingData.shipments && Array.isArray(trackingData.shipments)) {\n  // Prendi la prima spedizione disponibile\n  shipment = trackingData.shipments[0];\n}\n\n// Estrai il corriere\nlet corriere = \"Sconosciuto\";\nlet corriereSlug = null;\n\nif (shipment?.detectedCarrier?.name) {\n  corriere = shipment.detectedCarrier.name;\n  corriereSlug = shipment.detectedCarrier.slug;\n} else if (shipment?.carrier) {\n  corriere = shipment.carrier;\n} else if (Array.isArray(shipment?.carriers) && shipment.carriers.length > 0) {\n  corriere = shipment.carriers[0];\n}\n\n// Estrai gli attributi in un formato pi√π facile da usare\nconst attributi = {};\nif (Array.isArray(shipment?.attributes)) {\n  shipment.attributes.forEach(attr => {\n    // Usa l''etichetta personalizzata se disponibile, altrimenti usa ''l''\n    const chiave = attr.n || attr.l;\n    attributi[chiave] = attr.val;\n  });\n}\n\n// Traduci lo stato in italiano\nlet statoItaliano = \"Sconosciuto\";\nswitch (shipment?.status) {\n  case \"delivered\":\n    statoItaliano = \"Consegnato\";\n    break;\n  case \"transit\":\n    statoItaliano = \"In Transito\";\n    break;\n  case \"pickup\":\n    statoItaliano = \"Pronto per il Ritiro\";\n    break;\n  case \"undelivered\":\n    statoItaliano = \"Non Consegnato\";\n    break;\n  case \"exception\":\n    statoItaliano = \"Problema di Consegna\";\n    break;\n  case \"pending\":\n    statoItaliano = \"In Attesa\";\n    break;\n  default:\n    statoItaliano = shipment?.status || \"Sconosciuto\";\n}\n\n// Formatta gli eventi di tracciamento\nlet eventi = [];\nif (Array.isArray(shipment?.states)) {\n  eventi = shipment.states.map(evento => {\n    return {\n      data: evento.date ? new Date(evento.date).toLocaleString(''it-IT'') : \"Data sconosciuta\",\n      localit√†: evento.location || \"Localit√† sconosciuta\",\n      stato: evento.status || \"Stato sconosciuto\",\n      corriere: evento.carrier\n    };\n  });\n} else if (Array.isArray(shipment?.events)) {\n  eventi = shipment.events.map(evento => {\n    return {\n      data: evento.date ? new Date(evento.date).toLocaleString(''it-IT'') : \"Data sconosciuta\",\n      localit√†: evento.location || \"Localit√† sconosciuta\",\n      stato: evento.status || \"Stato sconosciuto\",\n      corriere: evento.carrier\n    };\n  });\n}\n\n// Estrai il link di tracciamento esterno\nlet linkTracciamento = null;\nif (Array.isArray(shipment?.externalTracking) && shipment.externalTracking.length > 0) {\n  linkTracciamento = {\n    url: shipment.externalTracking[0].url,\n    nome: shipment.externalTracking[0].title\n  };\n}\n\n// Risultato finale formattato in italiano\nreturn {\n  success: true,\n  infoGenerali: {\n    numeroTracciamento: shipment?.trackingId || \"Sconosciuto\",\n    stato: statoItaliano,\n    corriere: corriere,\n    corriereSlug: corriereSlug,\n    peso: attributi.weight || attributi.peso || null,\n    colli: attributi.items || attributi.Colli || null,\n    ddt: attributi.ddt || attributi.DDT || null,\n    giorniTransito: attributi.days_transit || attributi[\"Giorni di transito\"] || null\n  },\n  percorso: {\n    origine: attributi.from || shipment?.origin || null,\n    destinazione: attributi.to || shipment?.destination || null\n  },\n  destinatario: {\n    nome: attributi.recipient || null\n  },\n  cronologiaEventi: eventi,\n  ultimoAggiornamento: eventi.length > 0 ? eventi[0] : null,\n  linkTracciamento: linkTracciamento,\n  dettagliRaw: shipment // Includi i dati grezzi per riferimento\n};"},"id":"506e3dc1-999d-4e17-90b7-00065c310369","name":"Function (Format Response)1","type":"n8n-nodes-base.function","typeVersion":1,"position":[-1280,-288]},{"parameters":{"httpMethod":"POST","path":"track-shipment","responseMode":"lastNode","options":{}},"id":"8834c863-96c8-4035-8e9a-423726fdc6a2","name":"Webhook Start","type":"n8n-nodes-base.webhook","typeVersion":1,"position":[-1280,-544],"webhookId":"a6a103ff-36ac-4691-a187-7a7fa0b92223"},{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[-1280,-800],"id":"e4d2c69a-0ef4-4939-84fb-6789a321a27f","name":"When clicking ‚ÄòTest workflow‚Äô"},{"parameters":{"inputSource":"jsonExample","jsonExample":"{\n  \"query\": \"1234567890\"\n}\n"},"type":"n8n-nodes-base.executeWorkflowTrigger","typeVersion":1.1,"position":[-1280,80],"id":"ff398b65-4d06-4527-ad24-58e542eee2f3","name":"When Executed by Another Workflow"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"32a785f7-c0af-4504-8aef-542974964f04","leftValue":"={{ $json.done }}","rightValue":"true","operator":{"type":"boolean","operation":"true","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-400,80],"id":"48a9592e-d9f9-4c1c-8cb8-380f9ba79b36","name":"If"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[-176,-16],"id":"261ac7dd-508c-4653-8004-87a5571786ab","name":"No Operation, do nothing"},{"parameters":{"amount":10,"unit":"seconds"},"id":"92f9df6c-fb8d-493e-9713-4c03cbc6c88e","name":"Wait (10 seconds)","type":"n8n-nodes-base.wait","typeVersion":1,"position":[-176,192],"webhookId":"bd8bd711-0983-4d64-a5d8-77d938e6af7f"},{"parameters":{"jsCode":"return [\n  {\n    json: {\n      query: $json.query.replace(/[^\\d]/g, '''')\n    }\n  }\n];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-1056,80],"id":"f477ce49-7834-4638-a1dc-a885ae4c05a2","name":"Pulisce Dati"},{"parameters":{"values":{"string":[{"name":"trackingId","value":"={{ $(''When Executed by Another Workflow'').item.json.query }}"},{"name":"destinationCountry","value":"Italy"},{"name":"language","value":"it"}]},"options":{}},"id":"c277936b-3e16-4145-9460-efef9578934d","name":"Input: Tracking Details","type":"n8n-nodes-base.set","typeVersion":2,"position":[-848,80]}]', '{"HTTP Request (POST Tracking)1":{"main":[[{"node":"If","type":"main","index":0}]]},"HTTP Request (GET Tracking Status)1":{"main":[[]]},"Function (Format Response)1":{"main":[[]]},"Webhook Start":{"main":[[]]},"When clicking ‚ÄòTest workflow‚Äô":{"main":[[]]},"When Executed by Another Workflow":{"main":[[{"node":"Pulisce Dati","type":"main","index":0}]]},"If":{"main":[[{"node":"No Operation, do nothing","type":"main","index":0}],[{"node":"Wait (10 seconds)","type":"main","index":0}]]},"Wait (10 seconds)":{"main":[[{"node":"HTTP Request (GET Tracking Status)1","type":"main","index":0}]]},"Pulisce Dati":{"main":[[{"node":"Input: Tracking Details","type":"main","index":0}]]},"Input: Tracking Details":{"main":[[{"node":"HTTP Request (POST Tracking)1","type":"main","index":0}]]}}', '{"executionOrder":"v1"}', NULL, '{}', '8c71c6f8-26a8-4687-9a20-17ee3b705369', 1, '{"templateCredsSetupCompleted":true}', NULL, '2025-05-14T16:22:52.682Z', '2025-08-13T18:28:21.000Z', false),
  ('2941934b-7c70-4634-9cc5-b8232d2d1720', 'SUB_CHATBOT_API_TRACK_OK', false, '[{"parameters":{"model":"gpt-4o","options":{}},"id":"e5882d7e-99e9-40cb-a4f0-ab2bc16002e1","name":"OpenAI Chat Model","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1,"position":[-1420,1320],"credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"public":true,"options":{}},"id":"8c9cf921-0656-4111-8612-e0fef1ceb17a","name":"When chat message received","type":"@n8n/n8n-nodes-langchain.chatTrigger","typeVersion":1.1,"position":[-1820,-260],"webhookId":"4ed20ce0-587c-4843-84c1-f8b81943dde2"},{"parameters":{"agent":"openAiFunctionsAgent","promptType":"define","text":"={{ $json.query }}\n","options":{"systemMessage":"=Recupera tutte le informazioni disponibili relative a un ordine cliente, partendo dal{{ $json.query }} .\n\n---\n\n### 1. Verifica ordine (esegui sempre):\n- Usa `GET_ID` con `codice_ordine` per ottenere l''ID numerico interno.\n- Usa `Detail_Orders` con questo ID per recuperare:\n  - data ordine\n  - prodotti acquistati\n  - customer_id\n  - shipping_number (obbligatorio per tracking)\n\n- Usa `Get_Customer` con `customer_id` per ottenere:\n  - nome\n  - email\n\n---\n\n### 2. Tracking spedizione (esegui **sempre** se √® presente `shipping_number`):\n\n**IMPORTANTE: Usa il nodo `Parcelsapp Tool`**\n\n1. Recupera il campo **esattamente chiamato** `shipping_number` dal tool `GET_DETAIL`.\n\n   Esempio struttura XML:\n   ```xml\n   <shipping_number><![CDATA[192226757680]]></shipping_number> "}},"id":"d7840f06-f749-451d-9927-df4db52544cb","name":"RAG AI Agent","type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.6,"position":[-1180,1040],"notes":"Agisci come Milena, operatrice dell‚Äôassistenza clienti GommeGo.\n\nüéØ Obiettivo:\nOffrire assistenza con tono formale, rassicurante, chiaro ed empatico.\n\n‚úÖ Stile:\n\n* Dai sempre del \"Lei\"\n* Usa linguaggio semplice, umano, diretto\n* Ogni 3‚Äì4 risposte, simula un errore di battitura e correggilo\n* Se non conosci il nome del cliente, chiedilo con cortesia\n* Usa il nome ogni 1‚Äì2 risposte quando disponibile\n\nüü¢ Inizio:\n\n> Salve, sono Milena, come posso esserle utile?\n\nüìö **Richieste generiche (resi, pagamenti, spedizioni, condizioni di vendita...)**\n\n* Per ogni richiesta che **NON RIGUARDA UN ORDINE**, devi **obbligatoriamente** usare il tool `Answer questions with a vector store` prima di qualsiasi risposta o valutazione.\n\n  1. Usa **subito** il tool `Answer questions with a vector store` per analizzare il messaggio.\n  2. Se il contenuto √® utile ‚Üí riformulalo in tono umano, chiaro e rassicurante.\n  3. Se il contenuto √® insufficiente:\n\n     * Se l‚Äôargomento √® conosciuto ‚Üí rispondi comunque\n     * Se il messaggio √® vago o confuso ‚Üí chiedi una sola volta di chiarire\n     * Se non ricevi risposta utile ‚Üí chiudi la conversazione in modo gentile\n\n‚ùóÔ∏èNon rispondere mai direttamente se non hai consultato il tool `Answer questions with a vector store`.\nQuesto vale per ogni tema che **non riguarda un ordine**.\n\nüì¶ **Ordini**\n\n* Se manca il numero ordine ‚Üí chiedilo con cortesia\n* Se presente un riferimento (es. VPWJTKCUX):\n\n  1. Usa il tool `GET_ID` per ottenere l''ID numerico\n  2. Passa l‚ÄôID a `Detail_Orders`\n  3. Poi usa **solo i tool necessari** in base alla richiesta:\n\n     * `Get_Customer` (cliente)\n     * `Get_Address_Delivery`, `Get_Address_Invoice` (indirizzi)\n     * `Get_Order_Products` (prodotti)\n     * `Get_Order_State`, `Get_Order_History` (stato)\n     * `Get_Order_Payments`, `Get_Order_Invoices`, `Get_Order_Slips` (pagamenti, fatture, note di credito)\n\n       üëâ Non usare tutti i tool: scegli solo quelli utili alla domanda\n\n       &#x20;üëâ Riformula sempre i dati ottenuti in modo umano, rassicurante e professionale\n\nüö´ **Limitazioni ‚Äì Ambito post-vendita**\nMilena si occupa **esclusivamente di assistenza post-vendita**.\nSe il cliente chiede:\n\n* disponibilit√† di prodotti\n* alternative\n* preventivi o suggerimenti di acquisto\n* offerte commerciali\n* supporto nella scelta\n\nRispondi **solo cos√¨**:\n\n> Per proposte commerciali o informazioni sui prodotti, La invitO a contattare il nostro team di tecnici via email: [supplies@tecsolutions.org](mailto:supplies@tecsolutions.org). Io sar√≤ lieta di supportarLa per qualsiasi ordine gi√† effettuato o richiesta di assistenza.\n\n‚û°Ô∏è Dopo aver fornito questa risposta, **non proseguire oltre sull‚Äôargomento**. Attendi eventuali nuove richieste.\n\n‚ö†Ô∏è **Messaggi incomprensibili**\n\n> Mi scusi, non sono sicura di aver compreso la Sua richiesta. Potrebbe riformularla gentilmente?\n\nüîö **Chiusura**\nSe il cliente ringrazia o non emergono nuove richieste:\n\n> Resto a disposizione, Milena ‚Äì GommeGo\n> Saluti!\n"},{"parameters":{"url":"https://www.gommego.com/api/orders?filter[reference]=[XXXXXX]&output_format=JSON","authentication":"genericCredentialType","genericAuthType":"httpBasicAuth","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-1820,-520],"id":"d808c612-bf90-451f-90a9-70c912fecc3f","name":"Acquisice Ordini da Prestashop","retryOnFail":true,"waitBetweenTries":5000,"credentials":{"httpBasicAuth":{"id":"CDYbffajBgDWgdXn","name":"Prestashop-API"}}},{"parameters":{"toolDescription":"Get the numeric internal order ID from an alphanumeric reference (e.g., WDSLMTPUF). This is the first step in identifying an order.\n","url":"=https://www.gommego.com/api/orders","authentication":"genericCredentialType","genericAuthType":"httpBasicAuth","sendQuery":true,"queryParameters":{"parameters":[{"name":"filter[reference]","value":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI(''parameters0_Value'', `l''agent AI Fornisce il codice del cliente `, ''string'') }}"}]},"options":{}},"type":"n8n-nodes-base.httpRequestTool","typeVersion":4.2,"position":[-1200,1360],"id":"6674a89a-2d96-49a6-b9a7-7001987141de","name":"GET_ID","credentials":{"httpBasicAuth":{"id":"CDYbffajBgDWgdXn","name":"Prestashop-API"}}},{"parameters":{"toolDescription":"Get the delivery address for an order, using its internal numeric ID.\n","url":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI(''URL'', `id viene fornito da nodo AI (es.9965)`, ''string'') }}","authentication":"genericCredentialType","genericAuthType":"httpBasicAuth","sendQuery":true,"queryParameters":{"parameters":[{}]},"options":{}},"type":"n8n-nodes-base.httpRequestTool","typeVersion":4.2,"position":[-1040,1380],"id":"51518df5-e207-4d9f-bce5-82f6f6925fca","name":"GET_DELIVERY ADDRESS","credentials":{"httpBasicAuth":{"id":"CDYbffajBgDWgdXn","name":"Prestashop-API"}}},{"parameters":{"url":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI(''URL'', `ID dell‚Äôordine passato dall‚Äôagente AI`, ''string'') }}","authentication":"genericCredentialType","genericAuthType":"httpBasicAuth","options":{}},"type":"n8n-nodes-base.httpRequestTool","typeVersion":4.2,"position":[-900,1400],"id":"265eb82c-5304-4f14-99b1-562de9aff418","name":"GET_DETAIL2","retryOnFail":true,"credentials":{"httpBasicAuth":{"id":"CDYbffajBgDWgdXn","name":"Prestashop-API"}}},{"parameters":{"url":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI(''URL'', `id viene fornito da nodo AI (es.9965)`, ''string'') }}","authentication":"genericCredentialType","genericAuthType":"httpBasicAuth","sendQuery":true,"queryParameters":{"parameters":[{}]},"options":{}},"type":"n8n-nodes-base.httpRequestTool","typeVersion":4.2,"position":[-760,1420],"id":"78d31a32-38e8-4954-80e0-ea5ca973adc9","name":"GET_CUSTOMER1","credentials":{"httpBasicAuth":{"id":"CDYbffajBgDWgdXn","name":"Prestashop-API"}}},{"parameters":{"language":"python","pythonCode":"import requests\n\ndef run(tracking_number: str) -> str:\n    \"\"\"\n    Invia il tracking_number a n8n e restituisce i dati di tracciamento della spedizione.\n    \"\"\"\n    url = \"https://<TUO_DOMINIO>/webhook/track-shipment\"  # Sostituisci con il tuo dominio n8n\n    payload = {\"trackingId\": tracking_number}\n\n    try:\n        response = requests.post(url, json=payload, timeout=10)\n        response.raise_for_status()\n        return response.text  # oppure response.json() se vuoi fare parsing\n    except Exception as e:\n        return f\"Errore nel recupero tracking: {str(e)}\"\n"},"type":"@n8n/n8n-nodes-langchain.toolCode","typeVersion":1.2,"position":[-1820,260],"id":"5bdc88a7-5e1e-4613-bcc6-8cf05d0ccb7e","name":"Parcelsapp"},{"parameters":{"amount":8},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-1820,0],"id":"34c2be27-45bf-40da-b543-159c8de94294","name":"Wait","webhookId":"a0f89cb9-a127-40f8-81cf-ef16ae3576da"},{"parameters":{"description":"Chiama questo tool quando l''utente ti chiede informazioni sulla spedizione","workflowId":{"__rl":true,"value":"ULm0p4rsvD8rZu57","mode":"list","cachedResultName":"ParcelApp"},"workflowInputs":{"mappingMode":"defineBelow","value":{},"matchingColumns":[],"schema":[{"id":"query","displayName":"query","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[-580,1400],"id":"65e0953e-a479-477c-ad96-497b16ca8d59","name":"ParcelApp","retryOnFail":true},{"parameters":{"inputSource":"jsonExample","jsonExample":"{\n  \"query\": \"WDSLMTPUF\"\n}"},"type":"n8n-nodes-base.executeWorkflowTrigger","typeVersion":1.1,"position":[-1960,1040],"id":"e07f3410-e1f4-4fb2-82f3-3b76046bf16d","name":"When Executed by Another Workflow"},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1.3,"position":[-1820,500],"id":"b6026e58-d88c-4ff1-9323-85aa298e78da","name":"Simple Memory"},{"parameters":{"jsCode":"return [\n  {\n    json: {\n      query: $json.query.replace(/[^\\d]/g, '''')\n    }\n  }\n];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[0,0],"id":"1e0595c6-ff1b-484c-995c-5361eb8a8ef0","name":"Code"},{"parameters":{"jsCode":"const rawShipping = $json.shipping_number;\n\nconst cleanedTracking = rawShipping && typeof rawShipping === ''string''\n  ? rawShipping.replace(/\\D/g, '''')\n  : null;\n\nreturn [{\n  json: {\n    shipping_number: cleanedTracking\n  }\n}];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-1600,440],"id":"85977894-c185-4c45-a0e0-aabde7762e5d","name":"Code1"},{"parameters":{"jsCode":"const raw = $json.query || '''';\n\nconst cleaned = typeof raw === ''string''\n  ? raw.replace(/[^a-zA-Z0-9]/g, '''').trim()\n  : '''';\n\nreturn [{\n  json: {\n    query: cleaned\n  }\n}];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-1400,1040],"id":"cab3465e-2fda-44ba-b7f9-05e9e87d9fd6","name":"Pulisci codice"}]', '{"OpenAI Chat Model":{"ai_languageModel":[[{"node":"RAG AI Agent","type":"ai_languageModel","index":0}]]},"When chat message received":{"main":[[]]},"GET_ID":{"ai_tool":[[{"node":"RAG AI Agent","type":"ai_tool","index":0}]]},"GET_DELIVERY ADDRESS":{"ai_tool":[[{"node":"RAG AI Agent","type":"ai_tool","index":0}]]},"RAG AI Agent":{"main":[[]]},"GET_DETAIL2":{"ai_tool":[[{"node":"RAG AI Agent","type":"ai_tool","index":0}]]},"GET_CUSTOMER1":{"ai_tool":[[{"node":"RAG AI Agent","type":"ai_tool","index":0}]]},"Parcelsapp":{"ai_tool":[[]]},"Wait":{"main":[[]]},"ParcelApp":{"ai_tool":[[{"node":"RAG AI Agent","type":"ai_tool","index":0}]]},"Simple Memory":{"ai_memory":[[]]},"When Executed by Another Workflow":{"main":[[{"node":"Pulisci codice","type":"main","index":0}]]},"Code1":{"main":[[]]},"Pulisci codice":{"main":[[{"node":"RAG AI Agent","type":"main","index":0}]]}}', '{"executionOrder":"v1"}', NULL, '{}', '2a9b67f5-a6d2-45b8-ab3c-e51a0e9d8249', 1, '{"templateCredsSetupCompleted":true}', NULL, '2025-05-15T19:13:51.418Z', '2025-05-23T20:43:04.000Z', true),
  ('8d788e25-6912-4d3d-bdaa-ce665d277675', 'CHATBOT_API_TRACK_OK_CLASSIFIER', false, '[{"parameters":{"model":"gpt-4o","options":{}},"id":"f6fb57c2-6786-48a1-b451-e5d811f57d42","name":"OpenAI Chat Model","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1,"position":[-2000,3000],"credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"public":true,"options":{}},"id":"cb66218e-ed69-48f6-8c21-0060f9c48aa5","name":"When chat message received","type":"@n8n/n8n-nodes-langchain.chatTrigger","typeVersion":1.1,"position":[-2440,2780],"webhookId":"1c5b0a8e-ba10-4c2a-9d75-35f49b71521f"},{"parameters":{"promptType":"define","text":"={{ $(''When chat message received'').item.json.chatInput }}\n","options":{"systemMessage":"## Identit√† e comportamento\n- Sei Milena, assistente clienti GommeGo per supporto post-vendita\n- Usa linguaggio formale, da del \"Lei\" ai clienti\n- Usa il nome del cliente in ogni risposta\n- Simula un errore di battitura ogni 3-4 risposte\n\n## Sequenza obbligatoria (non saltare passaggi)\n1. Saluta: \"Salve, sono Milena, come posso esserle utile?\"\n2. Se il cliente non fornisce il suo nome, chiedi: \"Con chi ho il piacere di parlare?\"\n3. Ottieni il nome prima di procedere oltre\n\n## Gestione richieste non relative a ordini\n- Usa sempre il tool `Answer questions with a vector store`\n- Non rispondere mai senza consultare questo tool\n\n## Gestione ordini - procedura obbligatoria (non saltare passaggi)\n1. **Ottenere il codice ordine**\n   - Controlla attentamente se il cliente ha gi√† fornito un codice alfanumerico (es. WDSLMTPUF) nel messaggio attuale o in messaggi precedenti\n   - Se il codice √® gi√† stato fornito, NON richiedere nuovamente il codice\n   - Se manca completamente il codice, chiedi: \"Potrebbe fornirmi il codice di riferimento del Suo ordine?\"\n\n2. **Verificare l''ordine** - sequenza obbligatoria:\n   - Usa `GET_ID` per ottenere l''ID numerico dall''ordine\n   - Usa `Detail_Orders` con l''ID numerico per ottenere i dettagli dell''ordine e l''ID customer\n   - Usa `Get_Customer` con l''ID customer ottenuto da Detail_Orders per ottenere le informazioni di customer\n \n3. **Verificare l''identit√†**:\n   - Confronta il nome cliente con il nome intestatario\n   - Se non corrispondono, chiedi: \"Per motivi di sicurezza, potrebbe confermarmi l''email dell''ordine?\"\n   - Verifica l''email fornita con quella fornita dal nodo Get_Customer (fino a 3 tentativi)\n   - Se l''email non corrisponde, rispondi: \"Mi dispiace, la mail non corrisponde. Non posso fornire informazioni.\"\n\n4. **Fornire informazioni solo dopo verifica completa**:\n   - Indica data acquisto e prodotti acquistati\n   - Chiedi: \"Quali altre informazioni desidera su questo ordine?\"\n\n5. **Approfondimenti sul tracking della spedizione**:\n   Esegui questa sequenza **solo se il cliente chiede esplicitamente** informazioni sulla consegna, spedizione o stato del pacco:\n\n   **IMPORTANTE: Usa il nodo Parcelsapp Tool \n\n   1. **Prendi il campo `shipping_number` dal tool `GET_DETAIL`**\n      - Usa **esattamente** il campo chiamato `shipping_number`\n      - Non usare `order_reference`, `customer_id`, o altri ID\n\n      > Esempio di struttura XML:  \n      > `<shipping_number><![CDATA[192226757680]]></shipping_number>`  \n      > ‚Üí Il valore corretto da usare √®: `192226757680`\n\nPrima di passare il campo shipping_number al tool Parcelsapp, rimuovi tutti i caratteri che non sono cifre (es. spazi, tabulazioni, newline, ecc).\nUsa solo numeri. Ad esempio:\nSe shipping_number √® \\n 192226757680\\t , il valore corretto da inviare al Tool sar√†: 192226757680\n\n   2. **Chiama il tool `Parcelsapp Tool`**  \n      - Passa il valore di `shipping_number` nel parametro tracking number\n      - Il tool fornir√† automaticamente informazioni dettagliate su:\n        - Stato attuale del pacco\n        - Posizione corrente\n        - Ultimo aggiornamento\n        - Data di consegna prevista/effettiva\n        - Corriere utilizzato\n        - Eventi di tracciamento recenti\n\n   3. **Presenta le informazioni al cliente in modo chiaro**  \n      - Riassumi lo stato in italiano\n      - Indica la posizione attuale e l''ultimo aggiornamento\n      - Menziona la data di consegna prevista se disponibile\n\n6. **Altri approfondimenti**:\n   - Utilizza gli altri tool solo se necessario e richiesto dal cliente\n   - Usa la memoria per evitare chiamate ripetute agli stessi tool\n\n## Limitazioni\nSe il cliente chiede informazioni commerciali, rispondi:\n\"Per proposte commerciali, La invito a contattare: supplies@tecsolutions.org. Posso aiutarLa solo per ordini gi√† effettuati.\"\n\n## Tools disponibili\n(Usa questi strumenti per ottenere e incrociare dati da API aziendali e database)\n\n- GET_ID: Ottiene l''ID numerico interno di un ordine partendo da un codice alfanumerico (es. WDSLMTPUF).\n\n- GET_DETAIL: Recupera i dettagli dell''ordine, incluso il campo \"shipping_number\" usato per il tracciamento.\n\n- GET_CUSTOMER: Restituisce nome e email associati all''ID cliente, utile per verifiche di sicurezza.\n\n- GET_DELIVERY ADDRESS: Fornisce l''indirizzo di consegna dell''ordine.\n\n- Get-invoice: Recupera eventuali note di credito (credit note) associate all''ordine.\n\n- **Parcelsapp Tool** (NUOVO): Traccia la spedizione tramite tracking number e restituisce informazioni dettagliate su stato, posizione, corriere e eventi di tracciamento. Sostituisce il precedente Get_Parcel per un tracking pi√π accurato e dettagliato.\n\n- Answer questions with a vector store: Cerca risposte su politiche aziendali, spedizioni, resi, pagamenti, garanzie e condizioni di vendita.  \n  Obbligatorio per tutte le richieste non relative a ordini.\n\n## Chiusura\n\"Resto a disposizione, [nome cliente]. Milena ‚Äì GommeGo. Saluti!\""}},"id":"eaf37fcf-6b17-4844-a0c9-718731a278ca","name":"RAG AI Agent","type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.6,"position":[-1440,2780],"notes":"Agisci come Milena, operatrice dell‚Äôassistenza clienti GommeGo.\n\nüéØ Obiettivo:\nOffrire assistenza con tono formale, rassicurante, chiaro ed empatico.\n\n‚úÖ Stile:\n\n* Dai sempre del \"Lei\"\n* Usa linguaggio semplice, umano, diretto\n* Ogni 3‚Äì4 risposte, simula un errore di battitura e correggilo\n* Se non conosci il nome del cliente, chiedilo con cortesia\n* Usa il nome ogni 1‚Äì2 risposte quando disponibile\n\nüü¢ Inizio:\n\n> Salve, sono Milena, come posso esserle utile?\n\nüìö **Richieste generiche (resi, pagamenti, spedizioni, condizioni di vendita...)**\n\n* Per ogni richiesta che **NON RIGUARDA UN ORDINE**, devi **obbligatoriamente** usare il tool `Answer questions with a vector store` prima di qualsiasi risposta o valutazione.\n\n  1. Usa **subito** il tool `Answer questions with a vector store` per analizzare il messaggio.\n  2. Se il contenuto √® utile ‚Üí riformulalo in tono umano, chiaro e rassicurante.\n  3. Se il contenuto √® insufficiente:\n\n     * Se l‚Äôargomento √® conosciuto ‚Üí rispondi comunque\n     * Se il messaggio √® vago o confuso ‚Üí chiedi una sola volta di chiarire\n     * Se non ricevi risposta utile ‚Üí chiudi la conversazione in modo gentile\n\n‚ùóÔ∏èNon rispondere mai direttamente se non hai consultato il tool `Answer questions with a vector store`.\nQuesto vale per ogni tema che **non riguarda un ordine**.\n\nüì¶ **Ordini**\n\n* Se manca il numero ordine ‚Üí chiedilo con cortesia\n* Se presente un riferimento (es. VPWJTKCUX):\n\n  1. Usa il tool `GET_ID` per ottenere l''ID numerico\n  2. Passa l‚ÄôID a `Detail_Orders`\n  3. Poi usa **solo i tool necessari** in base alla richiesta:\n\n     * `Get_Customer` (cliente)\n     * `Get_Address_Delivery`, `Get_Address_Invoice` (indirizzi)\n     * `Get_Order_Products` (prodotti)\n     * `Get_Order_State`, `Get_Order_History` (stato)\n     * `Get_Order_Payments`, `Get_Order_Invoices`, `Get_Order_Slips` (pagamenti, fatture, note di credito)\n\n       üëâ Non usare tutti i tool: scegli solo quelli utili alla domanda\n\n       &#x20;üëâ Riformula sempre i dati ottenuti in modo umano, rassicurante e professionale\n\nüö´ **Limitazioni ‚Äì Ambito post-vendita**\nMilena si occupa **esclusivamente di assistenza post-vendita**.\nSe il cliente chiede:\n\n* disponibilit√† di prodotti\n* alternative\n* preventivi o suggerimenti di acquisto\n* offerte commerciali\n* supporto nella scelta\n\nRispondi **solo cos√¨**:\n\n> Per proposte commerciali o informazioni sui prodotti, La invitO a contattare il nostro team di tecnici via email: [supplies@tecsolutions.org](mailto:supplies@tecsolutions.org). Io sar√≤ lieta di supportarLa per qualsiasi ordine gi√† effettuato o richiesta di assistenza.\n\n‚û°Ô∏è Dopo aver fornito questa risposta, **non proseguire oltre sull‚Äôargomento**. Attendi eventuali nuove richieste.\n\n‚ö†Ô∏è **Messaggi incomprensibili**\n\n> Mi scusi, non sono sicura di aver compreso la Sua richiesta. Potrebbe riformularla gentilmente?\n\nüîö **Chiusura**\nSe il cliente ringrazia o non emergono nuove richieste:\n\n> Resto a disposizione, Milena ‚Äì GommeGo\n> Saluti!\n"},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4o-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-1568,3200],"id":"a08a8a36-e72a-4523-82dc-fa39ed22ed51","name":"OpenAI Chat Model1","credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"description":"Condizioni generali di vendita di GommeGo (TEC SRL), e-commerce di pneumatici. Include: informazioni aziendali, modello di business senza magazzini propri, politiche su DOT, tempi di consegna (5-7 giorni lavorativi), garanzie, diritto di recesso (14 giorni), procedure per resi, mancate consegne e prodotti difettosi. Dettagli su spedizioni, pagamenti anticipati (72h), gestione ordini, responsabilit√† e gestione reclami. Informazioni essenziali per assistenza clienti su tutti gli aspetti del processo d''acquisto.","topK":5},"type":"@n8n/n8n-nodes-langchain.toolVectorStore","typeVersion":1.1,"position":[-1760,3002.5],"id":"b1731dc8-cf45-463c-ae3e-81129f77cfd3","name":"Answer questions with a vector store"},{"parameters":{"qdrantCollection":{"__rl":true,"value":"Double","mode":"list","cachedResultName":"Double"},"options":{}},"type":"@n8n/n8n-nodes-langchain.vectorStoreQdrant","typeVersion":1.1,"position":[-1864,3202.5],"id":"6b1a2d55-5c68-4037-a4a5-9d95cba3d081","name":"Qdrant Vector Store","credentials":{"qdrantApi":{"id":"VEHIg9nC5Y5VeHPX","name":"QdrantApi account"}}},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1.2,"position":[-1776,3400],"id":"d8653515-ae26-4697-95dd-b348822b94a3","name":"Embeddings OpenAI2","credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"url":"https://www.gommego.com/api/orders?filter[reference]=[XXXXXX]&output_format=JSON","authentication":"genericCredentialType","genericAuthType":"httpBasicAuth","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-4620,-700],"id":"efee6f6e-77ab-4972-9fa1-e90b7503ec70","name":"Acquisice Ordini da Prestashop","retryOnFail":true,"waitBetweenTries":5000,"credentials":{"httpBasicAuth":{"id":"CDYbffajBgDWgdXn","name":"Prestashop-API"}}},{"parameters":{"toolDescription":"Get the numeric internal order ID from an alphanumeric reference (e.g., WDSLMTPUF). This is the first step in identifying an order.\n","url":"=https://www.gommego.com/api/orders","authentication":"genericCredentialType","genericAuthType":"httpBasicAuth","sendQuery":true,"queryParameters":{"parameters":[{"name":"filter[reference]","value":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI(''parameters0_Value'', `l''agent AI Fornisce il codice del cliente `, ''string'') }}"}]},"options":{}},"type":"n8n-nodes-base.httpRequestTool","typeVersion":4.2,"position":[-1464,3000],"id":"a38f8b6b-000e-433f-bb05-342f39b4392e","name":"GET_ID","credentials":{"httpBasicAuth":{"id":"CDYbffajBgDWgdXn","name":"Prestashop-API"}}},{"parameters":{"contextWindowLength":10},"type":"@n8n/n8n-nodes-langchain.memoryPostgresChat","typeVersion":1.3,"position":[-1880,3000],"id":"fa9944f4-ec71-4c49-9ab7-b280200d3967","name":"Postgres Chat Memory","credentials":{"postgres":{"id":"3JqN7cnp8K5WZ58E","name":"Postgres account"}}},{"parameters":{"toolDescription":"Get the delivery address for an order, using its internal numeric ID.\n","url":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI(''URL'', `id viene fornito da nodo AI (es.9965)`, ''string'') }}","authentication":"genericCredentialType","genericAuthType":"httpBasicAuth","sendQuery":true,"queryParameters":{"parameters":[{}]},"options":{}},"type":"n8n-nodes-base.httpRequestTool","typeVersion":4.2,"position":[-1344,3000],"id":"a11ea80c-efa6-4328-83b1-d6433eff2dd2","name":"GET_DELIVERY ADDRESS","credentials":{"httpBasicAuth":{"id":"CDYbffajBgDWgdXn","name":"Prestashop-API"}}},{"parameters":{"assignments":{"assignments":[{"id":"0b0b9a1b-c761-4f68-8911-549f2cde7835","name":"sessionId","value":"={{ $json.sessionId }}","type":"string"},{"id":"c1f0c5f4-c254-4a35-a42d-23a98cc86cf7","name":"chatInput","value":"={{ $json.chatInput }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-2220,2780],"id":"60e69ac5-e230-41b6-be68-9047882562d0","name":"Chat ID persisente"},{"parameters":{"url":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI(''URL'', `ID dell‚Äôordine passato dall‚Äôagente AI`, ''string'') }}","authentication":"genericCredentialType","genericAuthType":"httpBasicAuth","options":{}},"type":"n8n-nodes-base.httpRequestTool","typeVersion":4.2,"position":[-1740,2460],"id":"def76c42-e440-4d05-a08e-b8c3a803c02a","name":"GET_DETAIL2","retryOnFail":true,"credentials":{"httpBasicAuth":{"id":"CDYbffajBgDWgdXn","name":"Prestashop-API"}}},{"parameters":{"url":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI(''URL'', `id viene fornito da nodo AI (es.9965)`, ''string'') }}","authentication":"genericCredentialType","genericAuthType":"httpBasicAuth","sendQuery":true,"queryParameters":{"parameters":[{}]},"options":{}},"type":"n8n-nodes-base.httpRequestTool","typeVersion":4.2,"position":[-1104,3000],"id":"f094c155-cec9-40d8-9406-039fb1203bcc","name":"GET_CUSTOMER1","credentials":{"httpBasicAuth":{"id":"CDYbffajBgDWgdXn","name":"Prestashop-API"}}},{"parameters":{"language":"python","pythonCode":"import requests\n\ndef run(tracking_number: str) -> str:\n    \"\"\"\n    Invia il tracking_number a n8n e restituisce i dati di tracciamento della spedizione.\n    \"\"\"\n    url = \"https://<TUO_DOMINIO>/webhook/track-shipment\"  # Sostituisci con il tuo dominio n8n\n    payload = {\"trackingId\": tracking_number}\n\n    try:\n        response = requests.post(url, json=payload, timeout=10)\n        response.raise_for_status()\n        return response.text  # oppure response.json() se vuoi fare parsing\n    except Exception as e:\n        return f\"Errore nel recupero tracking: {str(e)}\"\n"},"type":"@n8n/n8n-nodes-langchain.toolCode","typeVersion":1.2,"position":[-2440,920],"id":"e72e00b9-3038-4753-8f59-db39d96f7084","name":"Parcelsapp"},{"parameters":{"amount":8},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[-4620,520],"id":"647fd3cc-9009-4008-8504-d0ad5e21a2ab","name":"Wait","webhookId":"82cfe5f2-5770-4b41-9147-97079f8f817c"},{"parameters":{"description":"Chiama questo tool quando l''utente ti chiede informazioni sulla spedizione","workflowId":{"__rl":true,"value":"ULm0p4rsvD8rZu57","mode":"list","cachedResultName":"ParcelApp"},"workflowInputs":{"mappingMode":"defineBelow","value":{},"matchingColumns":[],"schema":[{"id":"query","displayName":"query","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[-980,3000],"id":"170846bd-b077-4e87-817c-9402da381deb","name":"ParcelApp","retryOnFail":true},{"parameters":{"inputText":"=Classifica la seguente richiesta dell‚Äôutente in una delle categorie: \"Orders info\", \"Commercial\", \"Conversation\".\n\nTesto utente: {{ $json.chatInput }}\n\nRispondi solo con il nome della categoria pi√π adatta, senza aggiungere altro.\n\n\n","categories":{"categories":[{"category":"Tracking","description":"Consegne e Spedizioni"},{"category":"Conversation","description":"conversazione"},{"category":"Cmmercial","description":"Info Commerciali"},{"category":"Amministrazione","description":"mministrazione (Fatture e Crediti)"}]},"options":{"fallback":"other"}},"type":"@n8n/n8n-nodes-langchain.textClassifier","typeVersion":1,"position":[-2440,1160],"id":"c52c95bc-9cec-4636-bad5-38cf4b072d90","name":"Text Classifier"},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4o-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-2352,1380],"id":"af34974a-e0d9-4999-b1bf-931f8fa526cb","name":"OpenAI Chat Model2","credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"options":{}},"type":"n8n-nodes-base.dateTimeTool","typeVersion":2,"position":[-864,3000],"id":"708cb904-0d01-49a9-9e54-23d3d00c277e","name":"Date & Time"},{"parameters":{"model":"gpt-4o","options":{}},"id":"7f0ce845-7d06-43d8-af8f-0a8d30e3f7b3","name":"OpenAI Chat Model3","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1,"position":[-2440,1840],"credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4o-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-2008,2040],"id":"79bc38ff-6132-4351-9db6-bf3d91c4c245","name":"OpenAI Chat Model4","credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"description":"Condizioni generali di vendita di GommeGo (TEC SRL), e-commerce di pneumatici. Include: informazioni aziendali, modello di business senza magazzini propri, politiche su DOT, tempi di consegna (5-7 giorni lavorativi), garanzie, diritto di recesso (14 giorni), procedure per resi, mancate consegne e prodotti difettosi. Dettagli su spedizioni, pagamenti anticipati (72h), gestione ordini, responsabilit√† e gestione reclami. Informazioni essenziali per assistenza clienti su tutti gli aspetti del processo d''acquisto.","topK":5},"type":"@n8n/n8n-nodes-langchain.toolVectorStore","typeVersion":1.1,"position":[-2200,1842.5],"id":"c4160598-cd48-4288-85f5-01b6dd604ac5","name":"Answer questions with a vector store1"},{"parameters":{"qdrantCollection":{"__rl":true,"value":"Double","mode":"list","cachedResultName":"Double"},"options":{}},"type":"@n8n/n8n-nodes-langchain.vectorStoreQdrant","typeVersion":1.1,"position":[-2304,2042.5],"id":"f595ed81-aa8b-4d56-8e69-c0de054d2bf4","name":"Qdrant Vector Store1","credentials":{"qdrantApi":{"id":"VEHIg9nC5Y5VeHPX","name":"QdrantApi account"}}},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1.2,"position":[-2216,2240],"id":"2babb142-1356-4baf-a3ec-44c941461e52","name":"Embeddings OpenAI","credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"toolDescription":"Prende gli ordini dal catalogo li filtra in base alle misure \n","url":"=GET https://www.gommego.com/api/products\n","authentication":"genericCredentialType","genericAuthType":"httpBasicAuth","sendQuery":true,"queryParameters":{"parameters":[{"name":"filter[reference]","value":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI(''parameters0_Value'', `l''agent AI Fornisce il codice del cliente `, ''string'') }}"}]},"options":{}},"type":"n8n-nodes-base.httpRequestTool","typeVersion":4.2,"position":[-1904,1840],"id":"ec09f1f2-a96f-4c78-bac7-36bd10b0ab2f","name":"GET_ID1","credentials":{"httpBasicAuth":{"id":"CDYbffajBgDWgdXn","name":"Prestashop-API"}}},{"parameters":{"contextWindowLength":10},"type":"@n8n/n8n-nodes-langchain.memoryPostgresChat","typeVersion":1.3,"position":[-2320,1840],"id":"abc2ffd1-9c54-467e-a689-178c20241353","name":"Postgres Chat Memory1","credentials":{"postgres":{"id":"3JqN7cnp8K5WZ58E","name":"Postgres account"}}},{"parameters":{"toolDescription":"Get the delivery address for an order, using its internal numeric ID.\n","url":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI(''URL'', `id viene fornito da nodo AI (es.9965)`, ''string'') }}","authentication":"genericCredentialType","genericAuthType":"httpBasicAuth","sendQuery":true,"queryParameters":{"parameters":[{}]},"options":{}},"type":"n8n-nodes-base.httpRequestTool","typeVersion":4.2,"position":[-4620,-440],"id":"e1bf826f-fd14-4ca9-8c1c-9c2b616b03c3","name":"GET_DELIVERY ADDRESS1","credentials":{"httpBasicAuth":{"id":"CDYbffajBgDWgdXn","name":"Prestashop-API"}}},{"parameters":{"url":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI(''URL'', `ID dell‚Äôordine passato dall‚Äôagente AI`, ''string'') }}","authentication":"genericCredentialType","genericAuthType":"httpBasicAuth","options":{}},"type":"n8n-nodes-base.httpRequestTool","typeVersion":4.2,"position":[-1240,3020],"id":"cdb14ac3-9a3c-4447-afcf-907ef89fe248","name":"GET_DETAIL","retryOnFail":true,"credentials":{"httpBasicAuth":{"id":"CDYbffajBgDWgdXn","name":"Prestashop-API"}}},{"parameters":{"url":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI(''URL'', `id viene fornito da nodo AI (es.9965)`, ''string'') }}","authentication":"genericCredentialType","genericAuthType":"httpBasicAuth","sendQuery":true,"queryParameters":{"parameters":[{}]},"options":{}},"type":"n8n-nodes-base.httpRequestTool","typeVersion":4.2,"position":[-4620,40],"id":"f4fbec55-274c-4a42-9156-be677093f5c5","name":"GET_CUSTOMER","credentials":{"httpBasicAuth":{"id":"CDYbffajBgDWgdXn","name":"Prestashop-API"}}},{"parameters":{"description":"Chiama questo tool quando l''utente ti chiede informazioni sulla spedizione","workflowId":{"__rl":true,"value":"ULm0p4rsvD8rZu57","mode":"list","cachedResultName":"ParcelApp"},"workflowInputs":{"mappingMode":"defineBelow","value":{},"matchingColumns":[],"schema":[],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[-4620,280],"id":"e0ba70ec-1bba-4934-9d37-3d5851c5d57a","name":"ParcelApp1","retryOnFail":true},{"parameters":{"options":{}},"type":"n8n-nodes-base.dateTimeTool","typeVersion":2,"position":[-1784,1840],"id":"5cec9bb1-02f0-4d12-a496-5c189c36dbd8","name":"Date & Time1"},{"parameters":{"promptType":"define","text":"={{ $(''When chat message received'').item.json.chatInput }}\n","options":{"systemMessage":"## Identificazione Fascia Qualitativa Richiesta (Budget / Quality / Premium)\n\nDopo aver ottenuto una misura completa (o confermata da SerpAPI), Milena **deve sempre chiedere al cliente** che tipo di fascia desidera tra queste tre:\n\n1. **Budget** ‚Äì pneumatici economici, affidabili ma con prezzo contenuto\n2. **Quality** ‚Äì compromesso tra qualit√† e prezzo (gamma intermedia)\n3. **Premium** ‚Äì marche top per prestazioni, durata e sicurezza\n\n---\n\n### üü¢ Procedura\n\n1. Dopo aver ottenuto la misura completa o confermata:\n\n   > `\"Grazie, [NomeCliente]. Per selezionare le opzioni pi√π adatte, posso chiederLe che tipo di fascia preferisce tra queste tre categorie?\"`\n\n   Elenca sempre in questo ordine:\n   - `\"Budget (prezzo pi√π contenuto)\"`\n   - `\"Quality (fascia intermedia, qualit√†/prezzo equilibrata)\"`\n   - `\"Premium (prestazioni elevate e massima affidabilit√†)\"`\n\n2. Se il cliente specifica una fascia:\n   - Procedi a cercare prodotti con tag/marca corrispondente via `PrestaShop Search Tool`\n   - Rispondi con il link e conferma:\n     > `\"Ecco i pneumatici [Budget/Quality/Premium] disponibili per la misura indicata, [NomeCliente]: [link]. Le vanno bene oppure vuole valutare un''altra fascia?\"`\n\n3. Se il cliente **non risponde chiaramente o √® indeciso**:\n   - Mostra **una selezione mista**, una per fascia:\n     > `\"Per aiutarLa a scegliere, Le mostro un esempio per ciascuna categoria:\"`  \n     > - `Budget: [link1]`  \n     > - `Quality: [link2]`  \n     > - `Premium: [link3]`\n\n4. Se nessun prodotto trovato in quella fascia:\n   - Attiva `Serra Tool` per alternative\n   - Rispondi:\n     > `\"Attualmente non trovo disponibilit√† nella fascia indicata. Verifico opzioni alternative per Lei...\"`\n\n---\n\n## Riferimento Interno:\n\n- In PrestaShop, i prodotti possono essere filtrati per marca, prezzo, o tag (es. \"budget\", \"premium\")\n- Milena pu√≤ usare le marche pi√π note per orientarsi:\n  - **Budget**: Tristar, Goodride, Nankang\n  - **Quality**: Firestone, Kleber, Falken\n  - **Premium**: Michelin, Pirelli, Continental\n\n---\n\n## Nota importante\n\n- Questa domanda sulla fascia va fatta **solo dopo** che le misure del pneumatico sono state ottenute (dal cliente o da SerpAPI).\n- Non chiedere la fascia prima di sapere di che pneumatico si tratta.\n\n"}},"id":"8c2254f8-d323-41f7-b9a5-b860db7c84c2","name":"Commerciale","type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.6,"position":[-2096,1620],"notes":"Agisci come Milena, operatrice dell‚Äôassistenza clienti GommeGo.\n\nüéØ Obiettivo:\nOffrire assistenza con tono formale, rassicurante, chiaro ed empatico.\n\n‚úÖ Stile:\n\n* Dai sempre del \"Lei\"\n* Usa linguaggio semplice, umano, diretto\n* Ogni 3‚Äì4 risposte, simula un errore di battitura e correggilo\n* Se non conosci il nome del cliente, chiedilo con cortesia\n* Usa il nome ogni 1‚Äì2 risposte quando disponibile\n\nüü¢ Inizio:\n\n> Salve, sono Milena, come posso esserle utile?\n\nüìö **Richieste generiche (resi, pagamenti, spedizioni, condizioni di vendita...)**\n\n* Per ogni richiesta che **NON RIGUARDA UN ORDINE**, devi **obbligatoriamente** usare il tool `Answer questions with a vector store` prima di qualsiasi risposta o valutazione.\n\n  1. Usa **subito** il tool `Answer questions with a vector store` per analizzare il messaggio.\n  2. Se il contenuto √® utile ‚Üí riformulalo in tono umano, chiaro e rassicurante.\n  3. Se il contenuto √® insufficiente:\n\n     * Se l‚Äôargomento √® conosciuto ‚Üí rispondi comunque\n     * Se il messaggio √® vago o confuso ‚Üí chiedi una sola volta di chiarire\n     * Se non ricevi risposta utile ‚Üí chiudi la conversazione in modo gentile\n\n‚ùóÔ∏èNon rispondere mai direttamente se non hai consultato il tool `Answer questions with a vector store`.\nQuesto vale per ogni tema che **non riguarda un ordine**.\n\nüì¶ **Ordini**\n\n* Se manca il numero ordine ‚Üí chiedilo con cortesia\n* Se presente un riferimento (es. VPWJTKCUX):\n\n  1. Usa il tool `GET_ID` per ottenere l''ID numerico\n  2. Passa l‚ÄôID a `Detail_Orders`\n  3. Poi usa **solo i tool necessari** in base alla richiesta:\n\n     * `Get_Customer` (cliente)\n     * `Get_Address_Delivery`, `Get_Address_Invoice` (indirizzi)\n     * `Get_Order_Products` (prodotti)\n     * `Get_Order_State`, `Get_Order_History` (stato)\n     * `Get_Order_Payments`, `Get_Order_Invoices`, `Get_Order_Slips` (pagamenti, fatture, note di credito)\n\n       üëâ Non usare tutti i tool: scegli solo quelli utili alla domanda\n\n       &#x20;üëâ Riformula sempre i dati ottenuti in modo umano, rassicurante e professionale\n\nüö´ **Limitazioni ‚Äì Ambito post-vendita**\nMilena si occupa **esclusivamente di assistenza post-vendita**.\nSe il cliente chiede:\n\n* disponibilit√† di prodotti\n* alternative\n* preventivi o suggerimenti di acquisto\n* offerte commerciali\n* supporto nella scelta\n\nRispondi **solo cos√¨**:\n\n> Per proposte commerciali o informazioni sui prodotti, La invitO a contattare il nostro team di tecnici via email: [supplies@tecsolutions.org](mailto:supplies@tecsolutions.org). Io sar√≤ lieta di supportarLa per qualsiasi ordine gi√† effettuato o richiesta di assistenza.\n\n‚û°Ô∏è Dopo aver fornito questa risposta, **non proseguire oltre sull‚Äôargomento**. Attendi eventuali nuove richieste.\n\n‚ö†Ô∏è **Messaggi incomprensibili**\n\n> Mi scusi, non sono sicura di aver compreso la Sua richiesta. Potrebbe riformularla gentilmente?\n\nüîö **Chiusura**\nSe il cliente ringrazia o non emergono nuove richieste:\n\n> Resto a disposizione, Milena ‚Äì GommeGo\n> Saluti!\n"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.toolSerpApi","typeVersion":1,"position":[-1664,1840],"id":"2e0a30e6-1d81-4db6-84f5-adb4530aa75f","name":"SerpAPI","credentials":{"serpApi":{"id":"GmbGJhp2Zky9UqTX","name":"SerpAPI GommeGo"}}}]', '{"OpenAI Chat Model":{"ai_languageModel":[[{"node":"RAG AI Agent","type":"ai_languageModel","index":0}]]},"When chat message received":{"main":[[{"node":"Chat ID persisente","type":"main","index":0}]]},"OpenAI Chat Model1":{"ai_languageModel":[[{"node":"Answer questions with a vector store","type":"ai_languageModel","index":0}]]},"Answer questions with a vector store":{"ai_tool":[[{"node":"RAG AI Agent","type":"ai_tool","index":0}]]},"Qdrant Vector Store":{"ai_vectorStore":[[{"node":"Answer questions with a vector store","type":"ai_vectorStore","index":0}]]},"Embeddings OpenAI2":{"ai_embedding":[[{"node":"Qdrant Vector Store","type":"ai_embedding","index":0}]]},"GET_ID":{"ai_tool":[[{"node":"RAG AI Agent","type":"ai_tool","index":0}]]},"Postgres Chat Memory":{"ai_memory":[[{"node":"RAG AI Agent","type":"ai_memory","index":0}]]},"GET_DELIVERY ADDRESS":{"ai_tool":[[{"node":"RAG AI Agent","type":"ai_tool","index":0}]]},"Chat ID persisente":{"main":[[{"node":"RAG AI Agent","type":"main","index":0}]]},"RAG AI Agent":{"main":[[]]},"GET_DETAIL2":{"ai_tool":[[]]},"GET_CUSTOMER1":{"ai_tool":[[{"node":"RAG AI Agent","type":"ai_tool","index":0}]]},"Parcelsapp":{"ai_tool":[[]]},"Wait":{"main":[[]]},"ParcelApp":{"ai_tool":[[{"node":"RAG AI Agent","type":"ai_tool","index":0}]]},"OpenAI Chat Model2":{"ai_languageModel":[[{"node":"Text Classifier","type":"ai_languageModel","index":0}]]},"Text Classifier":{"main":[[],[],[]]},"Date & Time":{"ai_tool":[[{"node":"RAG AI Agent","type":"ai_tool","index":0}]]},"OpenAI Chat Model3":{"ai_languageModel":[[{"node":"Commerciale","type":"ai_languageModel","index":0}]]},"OpenAI Chat Model4":{"ai_languageModel":[[{"node":"Answer questions with a vector store1","type":"ai_languageModel","index":0}]]},"Answer questions with a vector store1":{"ai_tool":[[{"node":"Commerciale","type":"ai_tool","index":0}]]},"Qdrant Vector Store1":{"ai_vectorStore":[[{"node":"Answer questions with a vector store1","type":"ai_vectorStore","index":0}]]},"Embeddings OpenAI":{"ai_embedding":[[{"node":"Qdrant Vector Store1","type":"ai_embedding","index":0}]]},"GET_ID1":{"ai_tool":[[{"node":"Commerciale","type":"ai_tool","index":0}]]},"Postgres Chat Memory1":{"ai_memory":[[{"node":"Commerciale","type":"ai_memory","index":0}]]},"GET_DELIVERY ADDRESS1":{"ai_tool":[[]]},"GET_DETAIL":{"ai_tool":[[{"node":"RAG AI Agent","type":"ai_tool","index":0}]]},"GET_CUSTOMER":{"ai_tool":[[]]},"ParcelApp1":{"ai_tool":[[]]},"Date & Time1":{"ai_tool":[[{"node":"Commerciale","type":"ai_tool","index":0}]]},"SerpAPI":{"ai_tool":[[{"node":"Commerciale","type":"ai_tool","index":0}]]}}', '{"executionOrder":"v1"}', NULL, '{}', '3e3026e6-ad2d-4400-ba74-6cdd4c382b58', 0, '{"templateCredsSetupCompleted":true}', NULL, '2025-05-20T16:18:11.634Z', '2025-05-21T22:24:51.000Z', false),
  ('3b0c7df2-cd71-41db-a89c-abe972cce6c1', 'CHATBOT COMMERCIALE', false, '[{"parameters":{"model":"gpt-4o","options":{}},"id":"c59494ac-791e-4aca-90c1-8c2163142585","name":"OpenAI Chat Model3","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1,"position":[-200,240],"credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4o-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[60,620],"id":"56d895c8-5b5f-4961-b18e-f17542bc8e52","name":"OpenAI Chat Model4","credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"description":"Condizioni generali di vendita di GommeGo (TEC SRL), e-commerce di pneumatici. Include: informazioni aziendali, modello di business senza magazzini propri, politiche su DOT, tempi di consegna (5-7 giorni lavorativi), garanzie, diritto di recesso (14 giorni), procedure per resi, mancate consegne e prodotti difettosi. Dettagli su spedizioni, pagamenti anticipati (72h), gestione ordini, responsabilit√† e gestione reclami. Informazioni essenziali per assistenza clienti su tutti gli aspetti del processo d''acquisto.","topK":5},"type":"@n8n/n8n-nodes-langchain.toolVectorStore","typeVersion":1.1,"position":[-100,460],"id":"a8d73f20-7631-4356-8b15-ca3df23d2bc5","name":"Answer questions with a vector store1"},{"parameters":{"qdrantCollection":{"__rl":true,"value":"Double","mode":"list","cachedResultName":"Double"},"options":{}},"type":"@n8n/n8n-nodes-langchain.vectorStoreQdrant","typeVersion":1.1,"position":[-240,640],"id":"d9e5a68f-5254-4ea1-8b0b-5c90e665d028","name":"Qdrant Vector Store1","credentials":{"qdrantApi":{"id":"VEHIg9nC5Y5VeHPX","name":"QdrantApi account"}}},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1.2,"position":[-180,820],"id":"5510eadc-bc38-456b-88da-84c1a19545e4","name":"Embeddings OpenAI","credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"toolDescription":"Prende gli ordini dal catalogo li filtra in base alle misure \n","url":"=GET https://www.gommego.com/api/products\n","authentication":"genericCredentialType","genericAuthType":"httpBasicAuth","sendQuery":true,"queryParameters":{"parameters":[{"name":"filter[reference]","value":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI(''parameters0_Value'', `l''agent AI Fornisce il codice del cliente `, ''string'') }}"}]},"options":{}},"type":"n8n-nodes-base.httpRequestTool","typeVersion":4.2,"position":[520,380],"id":"fe9c998f-d517-431d-8dda-cfa0c3db7430","name":"GET_ID1","credentials":{"httpBasicAuth":{"id":"CDYbffajBgDWgdXn","name":"Prestashop-API"}}},{"parameters":{"contextWindowLength":10},"type":"@n8n/n8n-nodes-langchain.memoryPostgresChat","typeVersion":1.3,"position":[-40,240],"id":"119bfadd-08bd-4661-9db7-1117e311589a","name":"Postgres Chat Memory1","credentials":{"postgres":{"id":"3JqN7cnp8K5WZ58E","name":"Postgres account"}}},{"parameters":{"options":{}},"type":"n8n-nodes-base.dateTimeTool","typeVersion":2,"position":[-320,240],"id":"09d5ebbf-8988-4ba8-8e7d-0d4743f09175","name":"Date & Time1"},{"parameters":{"promptType":"define","text":"={{ $(''When chat message received'').item.json.chatInput }}\n","options":{"systemMessage":"## Identificazione Fascia Qualitativa Richiesta (Budget / Quality / Premium)\n\nDopo aver ottenuto una misura completa (o confermata da SerpAPI), Milena **deve sempre chiedere al cliente** che tipo di fascia desidera tra queste tre:\n\n1. **Budget** ‚Äì pneumatici economici, affidabili ma con prezzo contenuto\n2. **Quality** ‚Äì compromesso tra qualit√† e prezzo (gamma intermedia)\n3. **Premium** ‚Äì marche top per prestazioni, durata e sicurezza\n\n---\n\n### üü¢ Procedura\n\n1. Dopo aver ottenuto la misura completa o confermata:\n\n   > `\"Grazie, [NomeCliente]. Per selezionare le opzioni pi√π adatte, posso chiederLe che tipo di fascia preferisce tra queste tre categorie?\"`\n\n   Elenca sempre in questo ordine:\n   - `\"Budget (prezzo pi√π contenuto)\"`\n   - `\"Quality (fascia intermedia, qualit√†/prezzo equilibrata)\"`\n   - `\"Premium (prestazioni elevate e massima affidabilit√†)\"`\n\n2. Se il cliente specifica una fascia:\n   - Procedi a cercare prodotti con tag/marca corrispondente via `PrestaShop Search Tool`\n   - Rispondi con il link e conferma:\n     > `\"Ecco i pneumatici [Budget/Quality/Premium] disponibili per la misura indicata, [NomeCliente]: [link]. Le vanno bene oppure vuole valutare un''altra fascia?\"`\n\n3. Se il cliente **non risponde chiaramente o √® indeciso**:\n   - Mostra **una selezione mista**, una per fascia:\n     > `\"Per aiutarLa a scegliere, Le mostro un esempio per ciascuna categoria:\"`  \n     > - `Budget: [link1]`  \n     > - `Quality: [link2]`  \n     > - `Premium: [link3]`\n\n4. Se nessun prodotto trovato in quella fascia:\n   - Attiva `Serra Tool` per alternative\n   - Rispondi:\n     > `\"Attualmente non trovo disponibilit√† nella fascia indicata. Verifico opzioni alternative per Lei...\"`\n\n---\n\n## Riferimento Interno:\n\n- In PrestaShop, i prodotti possono essere filtrati per marca, prezzo, o tag (es. \"budget\", \"premium\")\n- Milena pu√≤ usare le marche pi√π note per orientarsi:\n  - **Budget**: Tristar, Goodride, Nankang\n  - **Quality**: Firestone, Kleber, Falken\n  - **Premium**: Michelin, Pirelli, Continental\n\n---\n\n## Nota importante\n\n- Questa domanda sulla fascia va fatta **solo dopo** che le misure del pneumatico sono state ottenute (dal cliente o da SerpAPI).\n- Non chiedere la fascia prima di sapere di che pneumatico si tratta.\n\n"}},"id":"0385ab07-a82d-4ada-8bae-210719200f91","name":"Commerciale","type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.6,"position":[0,0],"notes":"Agisci come Milena, operatrice dell‚Äôassistenza clienti GommeGo.\n\nüéØ Obiettivo:\nOffrire assistenza con tono formale, rassicurante, chiaro ed empatico.\n\n‚úÖ Stile:\n\n* Dai sempre del \"Lei\"\n* Usa linguaggio semplice, umano, diretto\n* Ogni 3‚Äì4 risposte, simula un errore di battitura e correggilo\n* Se non conosci il nome del cliente, chiedilo con cortesia\n* Usa il nome ogni 1‚Äì2 risposte quando disponibile\n\nüü¢ Inizio:\n\n> Salve, sono Milena, come posso esserle utile?\n\nüìö **Richieste generiche (resi, pagamenti, spedizioni, condizioni di vendita...)**\n\n* Per ogni richiesta che **NON RIGUARDA UN ORDINE**, devi **obbligatoriamente** usare il tool `Answer questions with a vector store` prima di qualsiasi risposta o valutazione.\n\n  1. Usa **subito** il tool `Answer questions with a vector store` per analizzare il messaggio.\n  2. Se il contenuto √® utile ‚Üí riformulalo in tono umano, chiaro e rassicurante.\n  3. Se il contenuto √® insufficiente:\n\n     * Se l‚Äôargomento √® conosciuto ‚Üí rispondi comunque\n     * Se il messaggio √® vago o confuso ‚Üí chiedi una sola volta di chiarire\n     * Se non ricevi risposta utile ‚Üí chiudi la conversazione in modo gentile\n\n‚ùóÔ∏èNon rispondere mai direttamente se non hai consultato il tool `Answer questions with a vector store`.\nQuesto vale per ogni tema che **non riguarda un ordine**.\n\nüì¶ **Ordini**\n\n* Se manca il numero ordine ‚Üí chiedilo con cortesia\n* Se presente un riferimento (es. VPWJTKCUX):\n\n  1. Usa il tool `GET_ID` per ottenere l''ID numerico\n  2. Passa l‚ÄôID a `Detail_Orders`\n  3. Poi usa **solo i tool necessari** in base alla richiesta:\n\n     * `Get_Customer` (cliente)\n     * `Get_Address_Delivery`, `Get_Address_Invoice` (indirizzi)\n     * `Get_Order_Products` (prodotti)\n     * `Get_Order_State`, `Get_Order_History` (stato)\n     * `Get_Order_Payments`, `Get_Order_Invoices`, `Get_Order_Slips` (pagamenti, fatture, note di credito)\n\n       üëâ Non usare tutti i tool: scegli solo quelli utili alla domanda\n\n       &#x20;üëâ Riformula sempre i dati ottenuti in modo umano, rassicurante e professionale\n\nüö´ **Limitazioni ‚Äì Ambito post-vendita**\nMilena si occupa **esclusivamente di assistenza post-vendita**.\nSe il cliente chiede:\n\n* disponibilit√† di prodotti\n* alternative\n* preventivi o suggerimenti di acquisto\n* offerte commerciali\n* supporto nella scelta\n\nRispondi **solo cos√¨**:\n\n> Per proposte commerciali o informazioni sui prodotti, La invitO a contattare il nostro team di tecnici via email: [supplies@tecsolutions.org](mailto:supplies@tecsolutions.org). Io sar√≤ lieta di supportarLa per qualsiasi ordine gi√† effettuato o richiesta di assistenza.\n\n‚û°Ô∏è Dopo aver fornito questa risposta, **non proseguire oltre sull‚Äôargomento**. Attendi eventuali nuove richieste.\n\n‚ö†Ô∏è **Messaggi incomprensibili**\n\n> Mi scusi, non sono sicura di aver compreso la Sua richiesta. Potrebbe riformularla gentilmente?\n\nüîö **Chiusura**\nSe il cliente ringrazia o non emergono nuove richieste:\n\n> Resto a disposizione, Milena ‚Äì GommeGo\n> Saluti!\n"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.toolSerpApi","typeVersion":1,"position":[-440,240],"id":"fbc13253-9103-46a3-af79-98820f5d0f84","name":"SerpAPI","credentials":{"serpApi":{"id":"GmbGJhp2Zky9UqTX","name":"SerpAPI GommeGo"}}}]', '{"OpenAI Chat Model3":{"ai_languageModel":[[{"node":"Commerciale","type":"ai_languageModel","index":0}]]},"OpenAI Chat Model4":{"ai_languageModel":[[{"node":"Answer questions with a vector store1","type":"ai_languageModel","index":0}]]},"Answer questions with a vector store1":{"ai_tool":[[{"node":"Commerciale","type":"ai_tool","index":0}]]},"Qdrant Vector Store1":{"ai_vectorStore":[[{"node":"Answer questions with a vector store1","type":"ai_vectorStore","index":0}]]},"Embeddings OpenAI":{"ai_embedding":[[{"node":"Qdrant Vector Store1","type":"ai_embedding","index":0}]]},"GET_ID1":{"ai_tool":[[{"node":"Commerciale","type":"ai_tool","index":0}]]},"Postgres Chat Memory1":{"ai_memory":[[{"node":"Commerciale","type":"ai_memory","index":0}]]},"Date & Time1":{"ai_tool":[[{"node":"Commerciale","type":"ai_tool","index":0}]]},"SerpAPI":{"ai_tool":[[{"node":"Commerciale","type":"ai_tool","index":0}]]}}', '{"executionOrder":"v1"}', NULL, '{}', '20041d67-138e-4445-a6c1-4ea4fb8cd70a', 0, NULL, NULL, '2025-05-21T07:24:29.851Z', '2025-05-21T07:27:14.000Z', false),
  ('3b0e8684-b6e9-4be4-a40c-662c4e4ae476', 'CHATBOT_TRACKING', false, '[{"parameters":{"model":"gpt-4o","options":{}},"id":"b1a05943-205c-497c-a785-bd9e05a4de34","name":"OpenAI Chat Model","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1,"position":[-420,480],"credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4o-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-680,-180],"id":"6114cda1-abdd-43f0-b7b1-cb560425745c","name":"OpenAI Chat Model1","credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"description":"Condizioni generali di vendita di GommeGo (TEC SRL), e-commerce di pneumatici. Include: informazioni aziendali, modello di business senza magazzini propri, politiche su DOT, tempi di consegna (5-7 giorni lavorativi), garanzie, diritto di recesso (14 giorni), procedure per resi, mancate consegne e prodotti difettosi. Dettagli su spedizioni, pagamenti anticipati (72h), gestione ordini, responsabilit√† e gestione reclami. Informazioni essenziali per assistenza clienti su tutti gli aspetti del processo d''acquisto.","topK":5},"type":"@n8n/n8n-nodes-langchain.toolVectorStore","typeVersion":1.1,"position":[-400,-260],"id":"49daa572-88a6-4979-896c-e70de718b8e6","name":"Answer questions with a vector store"},{"parameters":{"qdrantCollection":{"__rl":true,"value":"Double","mode":"list","cachedResultName":"Double"},"options":{}},"type":"@n8n/n8n-nodes-langchain.vectorStoreQdrant","typeVersion":1.1,"position":[-780,-360],"id":"48b68fa4-369b-41cd-ba3d-1e5e586629e3","name":"Qdrant Vector Store","credentials":{"qdrantApi":{"id":"VEHIg9nC5Y5VeHPX","name":"QdrantApi account"}}},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1.2,"position":[-980,-360],"id":"6137320e-e208-4908-940b-40d6aa4dd6c9","name":"Embeddings OpenAI2","credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"contextWindowLength":10},"type":"@n8n/n8n-nodes-langchain.memoryPostgresChat","typeVersion":1.3,"position":[-280,520],"id":"e57d636a-f560-474a-a126-43a23de7caf3","name":"Postgres Chat Memory","credentials":{"postgres":{"id":"3JqN7cnp8K5WZ58E","name":"Postgres account"}}},{"parameters":{"toolDescription":"Get the delivery address for an order, using its internal numeric ID.\n","url":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI(''URL'', `id viene fornito da nodo AI (es.9965)`, ''string'') }}","authentication":"genericCredentialType","genericAuthType":"httpBasicAuth","sendQuery":true,"queryParameters":{"parameters":[{}]},"options":{}},"type":"n8n-nodes-base.httpRequestTool","typeVersion":4.2,"position":[100,640],"id":"53aef86b-840b-4fd9-a334-82412ebd0da5","name":"GET_DELIVERY ADDRESS","credentials":{"httpBasicAuth":{"id":"CDYbffajBgDWgdXn","name":"Prestashop-API"}}},{"parameters":{"url":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI(''URL'', `ID dell‚Äôordine passato dall‚Äôagente AI`, ''string'') }}","authentication":"genericCredentialType","genericAuthType":"httpBasicAuth","options":{}},"type":"n8n-nodes-base.httpRequestTool","typeVersion":4.2,"position":[380,620],"id":"f9ef4de3-d045-4e3f-82d6-868944e83ead","name":"GET_DETAIL2","retryOnFail":true,"credentials":{"httpBasicAuth":{"id":"CDYbffajBgDWgdXn","name":"Prestashop-API"}}},{"parameters":{"url":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI(''URL'', `id viene fornito da nodo AI (es.9965)`, ''string'') }}","authentication":"genericCredentialType","genericAuthType":"httpBasicAuth","sendQuery":true,"queryParameters":{"parameters":[{}]},"options":{}},"type":"n8n-nodes-base.httpRequestTool","typeVersion":4.2,"position":[240,580],"id":"35dfe241-d054-443a-b74f-54bb2fb295d0","name":"GET_CUSTOMER1","credentials":{"httpBasicAuth":{"id":"CDYbffajBgDWgdXn","name":"Prestashop-API"}}},{"parameters":{"description":"Chiama questo tool quando l''utente ti chiede informazioni sulla spedizione","workflowId":{"__rl":true,"value":"ULm0p4rsvD8rZu57","mode":"list","cachedResultName":"ParcelApp"},"workflowInputs":{"mappingMode":"defineBelow","value":{},"matchingColumns":[],"schema":[],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[400,477.5],"id":"218cb80b-f0e4-488c-8912-94818345a31d","name":"ParcelApp","retryOnFail":true},{"parameters":{"options":{}},"type":"n8n-nodes-base.dateTimeTool","typeVersion":2,"position":[520,477.5],"id":"6752afaa-6351-4958-9b0d-c58d3c7da247","name":"Date & Time"},{"parameters":{},"type":"n8n-nodes-base.executeWorkflowTrigger","typeVersion":1.1,"position":[-560,100],"id":"44eea06e-7e86-4f1f-8103-ea8171914458","name":"When Executed by Another Workflow"},{"parameters":{"promptType":"define","text":"={{ $(''When chat message received'').item.json.chatInput }}\n","options":{"systemMessage":"## Identit√† e comportamento\n- Sei Milena, assistente clienti GommeGo per supporto post-vendita\n- Usa linguaggio formale, da del \"Lei\" ai clienti\n- Usa il nome del cliente in ogni risposta\n- Simula un errore di battitura ogni 3-4 risposte\n\n## Sequenza obbligatoria (non saltare passaggi)\n1. Saluta: \"Salve, sono Milena, come posso esserle utile?\"\n2. Se il cliente non fornisce il suo nome, chiedi: \"Con chi ho il piacere di parlare?\"\n3. Ottieni il nome prima di procedere oltre\n\n## Gestione richieste non relative a ordini\n- Usa sempre il tool `Answer questions with a vector store`\n- Non rispondere mai senza consultare questo tool\n\n## Gestione ordini - procedura obbligatoria (non saltare passaggi)\n1. **Ottenere il codice ordine**\n   - Controlla attentamente se il cliente ha gi√† fornito un codice alfanumerico (es. WDSLMTPUF) nel messaggio attuale o in messaggi precedenti\n   - Se il codice √® gi√† stato fornito, NON richiedere nuovamente il codice\n   - Se manca completamente il codice, chiedi: \"Potrebbe fornirmi il codice di riferimento del Suo ordine?\"\n\n2. **Verificare l''ordine** - sequenza obbligatoria:\n   - Usa `GET_ID` per ottenere l''ID numerico dall''ordine\n   - Usa `Detail_Orders` con l''ID numerico per ottenere i dettagli dell''ordine e l''ID customer\n   - Usa `Get_Customer` con l''ID customer ottenuto da Detail_Orders per ottenere le informazioni di customer\n \n3. **Verificare l''identit√†**:\n   - Confronta il nome cliente con il nome intestatario\n   - Se non corrispondono, chiedi: \"Per motivi di sicurezza, potrebbe confermarmi l''email dell''ordine?\"\n   - Verifica l''email fornita con quella fornita dal nodo Get_Customer (fino a 3 tentativi)\n   - Se l''email non corrisponde, rispondi: \"Mi dispiace, la mail non corrisponde. Non posso fornire informazioni.\"\n\n4. **Fornire informazioni solo dopo verifica completa**:\n   - Indica data acquisto e prodotti acquistati\n   - Chiedi: \"Quali altre informazioni desidera su questo ordine?\"\n\n5. **Approfondimenti sul tracking della spedizione**:\n   Esegui questa sequenza **solo se il cliente chiede esplicitamente** informazioni sulla consegna, spedizione o stato del pacco:\n\n   **IMPORTANTE: Usa il nodo Parcelsapp Tool \n\n   1. **Prendi il campo `shipping_number` dal tool `GET_DETAIL`**\n      - Usa **esattamente** il campo chiamato `shipping_number`\n      - Non usare `order_reference`, `customer_id`, o altri ID\n\n      > Esempio di struttura XML:  \n      > `<shipping_number><![CDATA[192226757680]]></shipping_number>`  \n      > ‚Üí Il valore corretto da usare √®: `192226757680`\n\nPrima di passare il campo shipping_number al tool Parcelsapp, rimuovi tutti i caratteri che non sono cifre (es. spazi, tabulazioni, newline, ecc).\nUsa solo numeri. Ad esempio:\nSe shipping_number √® \\n 192226757680\\t , il valore corretto da inviare al Tool sar√†: 192226757680\n\n   2. **Chiama il tool `Parcelsapp Tool`**  \n      - Passa il valore di `shipping_number` nel parametro tracking number\n      - Il tool fornir√† automaticamente informazioni dettagliate su:\n        - Stato attuale del pacco\n        - Posizione corrente\n        - Ultimo aggiornamento\n        - Data di consegna prevista/effettiva\n        - Corriere utilizzato\n        - Eventi di tracciamento recenti\n\n   3. **Presenta le informazioni al cliente in modo chiaro**  \n      - Riassumi lo stato in italiano\n      - Indica la posizione attuale e l''ultimo aggiornamento\n      - Menziona la data di consegna prevista se disponibile\n\n6. **Altri approfondimenti**:\n   - Utilizza gli altri tool solo se necessario e richiesto dal cliente\n   - Usa la memoria per evitare chiamate ripetute agli stessi tool\n\n## Limitazioni\nSe il cliente chiede informazioni commerciali, rispondi:\n\"Per proposte commerciali, La invito a contattare: supplies@tecsolutions.org. Posso aiutarLa solo per ordini gi√† effettuati.\"\n\n## Tools disponibili\n(Usa questi strumenti per ottenere e incrociare dati da API aziendali e database)\n\n- GET_ID: Ottiene l''ID numerico interno di un ordine partendo da un codice alfanumerico (es. WDSLMTPUF).\n\n- GET_DETAIL: Recupera i dettagli dell''ordine, incluso il campo \"shipping_number\" usato per il tracciamento.\n\n- GET_CUSTOMER: Restituisce nome e email associati all''ID cliente, utile per verifiche di sicurezza.\n\n- GET_DELIVERY ADDRESS: Fornisce l''indirizzo di consegna dell''ordine.\n\n- Get-invoice: Recupera eventuali note di credito (credit note) associate all''ordine.\n\n- **Parcelsapp Tool** (NUOVO): Traccia la spedizione tramite tracking number e restituisce informazioni dettagliate su stato, posizione, corriere e eventi di tracciamento. Sostituisce il precedente Get_Parcel per un tracking pi√π accurato e dettagliato.\n\n- Answer questions with a vector store: Cerca risposte su politiche aziendali, spedizioni, resi, pagamenti, garanzie e condizioni di vendita.  \n  Obbligatorio per tutte le richieste non relative a ordini.\n\n## Chiusura\n\"Resto a disposizione, [nome cliente]. Milena ‚Äì GommeGo. Saluti!\""}},"id":"6fb65c8a-70b0-4d3c-99a0-c7d45276d9bf","name":"TRACKING","type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.6,"position":[20,260],"notes":"Agisci come Milena, operatrice dell‚Äôassistenza clienti GommeGo.\n\nüéØ Obiettivo:\nOffrire assistenza con tono formale, rassicurante, chiaro ed empatico.\n\n‚úÖ Stile:\n\n* Dai sempre del \"Lei\"\n* Usa linguaggio semplice, umano, diretto\n* Ogni 3‚Äì4 risposte, simula un errore di battitura e correggilo\n* Se non conosci il nome del cliente, chiedilo con cortesia\n* Usa il nome ogni 1‚Äì2 risposte quando disponibile\n\nüü¢ Inizio:\n\n> Salve, sono Milena, come posso esserle utile?\n\nüìö **Richieste generiche (resi, pagamenti, spedizioni, condizioni di vendita...)**\n\n* Per ogni richiesta che **NON RIGUARDA UN ORDINE**, devi **obbligatoriamente** usare il tool `Answer questions with a vector store` prima di qualsiasi risposta o valutazione.\n\n  1. Usa **subito** il tool `Answer questions with a vector store` per analizzare il messaggio.\n  2. Se il contenuto √® utile ‚Üí riformulalo in tono umano, chiaro e rassicurante.\n  3. Se il contenuto √® insufficiente:\n\n     * Se l‚Äôargomento √® conosciuto ‚Üí rispondi comunque\n     * Se il messaggio √® vago o confuso ‚Üí chiedi una sola volta di chiarire\n     * Se non ricevi risposta utile ‚Üí chiudi la conversazione in modo gentile\n\n‚ùóÔ∏èNon rispondere mai direttamente se non hai consultato il tool `Answer questions with a vector store`.\nQuesto vale per ogni tema che **non riguarda un ordine**.\n\nüì¶ **Ordini**\n\n* Se manca il numero ordine ‚Üí chiedilo con cortesia\n* Se presente un riferimento (es. VPWJTKCUX):\n\n  1. Usa il tool `GET_ID` per ottenere l''ID numerico\n  2. Passa l‚ÄôID a `Detail_Orders`\n  3. Poi usa **solo i tool necessari** in base alla richiesta:\n\n     * `Get_Customer` (cliente)\n     * `Get_Address_Delivery`, `Get_Address_Invoice` (indirizzi)\n     * `Get_Order_Products` (prodotti)\n     * `Get_Order_State`, `Get_Order_History` (stato)\n     * `Get_Order_Payments`, `Get_Order_Invoices`, `Get_Order_Slips` (pagamenti, fatture, note di credito)\n\n       üëâ Non usare tutti i tool: scegli solo quelli utili alla domanda\n\n       &#x20;üëâ Riformula sempre i dati ottenuti in modo umano, rassicurante e professionale\n\nüö´ **Limitazioni ‚Äì Ambito post-vendita**\nMilena si occupa **esclusivamente di assistenza post-vendita**.\nSe il cliente chiede:\n\n* disponibilit√† di prodotti\n* alternative\n* preventivi o suggerimenti di acquisto\n* offerte commerciali\n* supporto nella scelta\n\nRispondi **solo cos√¨**:\n\n> Per proposte commerciali o informazioni sui prodotti, La invitO a contattare il nostro team di tecnici via email: [supplies@tecsolutions.org](mailto:supplies@tecsolutions.org). Io sar√≤ lieta di supportarLa per qualsiasi ordine gi√† effettuato o richiesta di assistenza.\n\n‚û°Ô∏è Dopo aver fornito questa risposta, **non proseguire oltre sull‚Äôargomento**. Attendi eventuali nuove richieste.\n\n‚ö†Ô∏è **Messaggi incomprensibili**\n\n> Mi scusi, non sono sicura di aver compreso la Sua richiesta. Potrebbe riformularla gentilmente?\n\nüîö **Chiusura**\nSe il cliente ringrazia o non emergono nuove richieste:\n\n> Resto a disposizione, Milena ‚Äì GommeGo\n> Saluti!\n"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.chatTrigger","typeVersion":1.1,"position":[-280,260],"id":"d5ae89e8-f354-4df2-9f46-5c6ebf2d5a3f","name":"When chat message received","webhookId":"3f532e0f-23a4-4549-8918-29bea7575ef3"},{"parameters":{"toolDescription":"Get the numeric internal order ID from an alphanumeric reference (e.g., WDSLMTPUF). This is the first step in identifying an order.\n","url":"=https://www.gommego.com/api/orders","authentication":"genericCredentialType","genericAuthType":"httpBasicAuth","sendQuery":true,"queryParameters":{"parameters":[{"name":"filter[reference]","value":"={{ /*n8n-auto-generated-fromAI-override*/ $fromAI(''parameters0_Value'', `l''agent AI Fornisce il codice del cliente `, ''string'') }}"}]},"options":{}},"type":"n8n-nodes-base.httpRequestTool","typeVersion":4.2,"position":[0,60],"id":"444023ed-404a-4f1f-ae27-446aa4f2f7ee","name":"GET_ID1","credentials":{"httpBasicAuth":{"id":"CDYbffajBgDWgdXn","name":"Prestashop-API"}}},{"parameters":{"toolDescription":"prendi tutte le informazioni disponibili dell''ordine filtrandolo per refrence (HEXFDMVNG)\n","url":"=https://www.gommego.com/api/orders?filter[reference]={{$json[\"chatInput\"]}}&display=full&output_format=JSON","authentication":"genericCredentialType","genericAuthType":"httpBasicAuth","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Accept","value":"application/json"}]},"options":{},"optimizeResponse":true},"type":"n8n-nodes-base.httpRequestTool","typeVersion":4.2,"position":[-160,580],"id":"d2075cb5-a103-4550-93f8-0e9c54311e55","name":"ORDER","credentials":{"httpBasicAuth":{"id":"CDYbffajBgDWgdXn","name":"Prestashop-API"}}},{"parameters":{"toolDescription":"prendi tutte le informazioni disponibili DEL CLIENTE  filtrandolo per refrence (HEXFDMVNG)\n","url":"=https://www.gommego.com/api/customers/{{$json.orderDetails.id_customer}}&display=full&output_format=JSON","authentication":"genericCredentialType","genericAuthType":"httpBasicAuth","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Accept","value":"application/json"}]},"options":{},"optimizeResponse":true},"type":"n8n-nodes-base.httpRequestTool","typeVersion":4.2,"position":[340,80],"id":"484d4535-584f-45b4-a532-57b067a264fa","name":"CUSTOMER DETAIL","credentials":{"httpBasicAuth":{"id":"CDYbffajBgDWgdXn","name":"Prestashop-API"}}}]', '{"OpenAI Chat Model":{"ai_languageModel":[[{"node":"TRACKING","type":"ai_languageModel","index":0}]]},"OpenAI Chat Model1":{"ai_languageModel":[[{"node":"Answer questions with a vector store","type":"ai_languageModel","index":0}]]},"Answer questions with a vector store":{"ai_tool":[[]]},"Qdrant Vector Store":{"ai_vectorStore":[[{"node":"Answer questions with a vector store","type":"ai_vectorStore","index":0}]]},"Embeddings OpenAI2":{"ai_embedding":[[{"node":"Qdrant Vector Store","type":"ai_embedding","index":0}]]},"Postgres Chat Memory":{"ai_memory":[[{"node":"TRACKING","type":"ai_memory","index":0}]]},"GET_DELIVERY ADDRESS":{"ai_tool":[[{"node":"TRACKING","type":"ai_tool","index":0}]]},"GET_DETAIL2":{"ai_tool":[[{"node":"TRACKING","type":"ai_tool","index":0}]]},"GET_CUSTOMER1":{"ai_tool":[[{"node":"TRACKING","type":"ai_tool","index":0}]]},"ParcelApp":{"ai_tool":[[{"node":"TRACKING","type":"ai_tool","index":0}]]},"Date & Time":{"ai_tool":[[{"node":"TRACKING","type":"ai_tool","index":0}]]},"When Executed by Another Workflow":{"main":[[]]},"When chat message received":{"main":[[{"node":"TRACKING","type":"main","index":0}]]},"ORDER":{"ai_tool":[[{"node":"TRACKING","type":"ai_tool","index":0}]]},"CUSTOMER DETAIL":{"ai_tool":[[]]}}', '{"executionOrder":"v1"}', NULL, '{}', '749b84e4-aa76-417a-8f1e-dc7a6c57a2a3', 0, NULL, NULL, '2025-05-21T07:26:43.716Z', '2025-05-23T20:41:20.000Z', true),
  ('9c56ede9-17bb-4a51-8637-cd6985fcc843', 'CHATBOT_MILENA_V1', false, '[{"parameters":{"public":true,"initialMessages":"Salveüëã\nIl mio nome √® Milena come posso aiutarla oggi?","options":{}},"id":"ec07e55f-99dd-4207-b49f-6638296e03e7","name":"When chat message received","type":"@n8n/n8n-nodes-langchain.chatTrigger","typeVersion":1.1,"position":[-1440,512],"webhookId":"1c5b0a8e-ba10-4c2a-9d75-35f49b71521f"},{"parameters":{"assignments":{"assignments":[{"id":"0b0b9a1b-c761-4f68-8911-549f2cde7835","name":"sessionId","value":"={{ $json.sessionId }}","type":"string"},{"id":"c1f0c5f4-c254-4a35-a42d-23a98cc86cf7","name":"chatInput","value":"={{ $json.chatInput }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-1216,512],"id":"0bd24ef5-3217-48ac-80a1-9978e955d87a","name":"Chat ID persisente"},{"parameters":{"model":{"__rl":true,"value":"gpt-4.1-mini-2025-04-14","mode":"list","cachedResultName":"gpt-4.1-mini-2025-04-14"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-544,976],"id":"e6bb856b-9909-44aa-82e1-2afa24088887","name":"OpenAI Chat Model1","credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"description":"**KNOWLEDGE BASE UFFICIALE GOMMEGO - CONSULTAZIONE OBBLIGATORIA**\n\nQuesto nodo contiene l''intero database di conoscenza aziendale GommeGo: FAQ ufficiali, procedure operative, policy sui prodotti, stati degli ordini, termini dei corrieri, informazioni legali e regole comportamentali di Milena.\n\n**CONTENUTO ESSENZIALE:**\n- FAQ su tracking, spedizioni, DOT, resi, pagamenti\n- Spiegazioni dettagliate di tutti gli stati ordine PrestaShop\n- Policy aziendali ufficiali (DOT 12-14 mesi, procedure resi, etc.)\n- Messaggi rassicuranti pre-approvati per ogni situazione\n- Termini tecnici dei corrieri e loro significato\n- Regole comportamentali e tone of voice aziendale\n\n**USO OBBLIGATORIO:**\nConsulta SEMPRE questo nodo per PRIMO prima di qualsiasi risposta. Contiene le informazioni contestuali essenziali per fornire risposte accurate, coerenti con le policy GommeGo e con il giusto tone rassicurante. Senza questa consultazione, le risposte saranno incomplete e non allineate agli standard aziendali.\n\n**QUANDO USARLO:**\n- Prima interrogazione: input completo dell''utente\n- Seconda interrogazione: dati ottenuti da altri tool per arricchimento\n\nFonte autorevole per essere Milena esperta di GommeGo.","topK":5},"type":"@n8n/n8n-nodes-langchain.toolVectorStore","typeVersion":1.1,"position":[-736,768],"id":"4a201b53-2947-44e7-871b-65e65a038877","name":"Answer questions with a vector store"},{"parameters":{"qdrantCollection":{"__rl":true,"value":"Double","mode":"list","cachedResultName":"Double"},"options":{}},"type":"@n8n/n8n-nodes-langchain.vectorStoreQdrant","typeVersion":1.1,"position":[-880,928],"id":"195aa607-7dd6-4ac9-992e-0132ec41f530","name":"Qdrant Vector Store","credentials":{"qdrantApi":{"id":"VEHIg9nC5Y5VeHPX","name":"QdrantApi account"}}},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1.2,"position":[-896,1120],"id":"94073fd3-460f-4465-a8cf-b96e578e93b6","name":"Embeddings OpenAI2","credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"contextWindowLength":10},"type":"@n8n/n8n-nodes-langchain.memoryPostgresChat","typeVersion":1.3,"position":[-960,800],"id":"fb9b5818-169d-4949-a5ba-1bc64ea0ec04","name":"Postgres Chat Memory","credentials":{"postgres":{"id":"3JqN7cnp8K5WZ58E","name":"Postgres account"}}},{"parameters":{"options":{}},"type":"n8n-nodes-base.dateTimeTool","typeVersion":2,"position":[-464,720],"id":"f50d56c6-3be9-4459-9ad7-21526865338f","name":"Date & Time"},{"parameters":{"options":{"hl":"it"}},"type":"@n8n/n8n-nodes-langchain.toolSerpApi","typeVersion":1,"position":[-352,720],"id":"0c14d074-27c6-43a2-a08b-3422d9c7ce5d","name":"SerpAPI","credentials":{"serpApi":{"id":"GmbGJhp2Zky9UqTX","name":"SerpAPI GommeGo"}}},{"parameters":{"workflowId":{"__rl":true,"value":"el9CwyiWMEpfLfFH","mode":"list","cachedResultName":"CHATBOT COMMERCIALE"},"workflowInputs":{"mappingMode":"defineBelow","value":{},"matchingColumns":[],"schema":[],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[-1440,-288],"id":"122adeac-06e6-4273-9d89-5b161ba9f16b","name":"COMMERCIALE"},{"parameters":{"workflowId":{"__rl":true,"value":"el9CwyiWMEpfLfFH","mode":"list","cachedResultName":"CHATBOT COMMERCIALE"},"workflowInputs":{"mappingMode":"defineBelow","value":{},"matchingColumns":[],"schema":[],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[-1440,-48],"id":"639e2112-5697-4887-bf12-19f8d12975c9","name":"AMMINISTRAZIONE"},{"parameters":{"promptType":"define","text":"={{ $(''When chat message received'').item.json.chatInput }}\n","options":{"systemMessage":"=**Ruolo**: Operatrice assistenza clienti con tono formale, rassicurante ed empatico.\n\n## Obiettivo Primario\n**Rassicurare sempre il cliente** con risposte **specifiche ed efficienti** - Trovare le parole giuste per lasciarlo sereno, fornendo informazioni chiare e mirate.\n\n## Comportamento Base\n- Dai sempre del \"Lei\" \n- **Analizza SUBITO** l''input: se il motivo √® chiaro, **rispondi direttamente**\n- **Chiedi SEMPRE il nome** se non disponibile nelle prime interazioni\n- Usa il nome ogni 1-2 risposte per personalizzare l''assistenza\n- Usa linguaggio semplice, diretto e rassicurante\n- **Risposte specifiche e concise** - NO relazioni epistolari\n- **Richiedi precisione**: Se domanda generica ‚Üí chiedi dettagli specifici\n- **Saluto iniziale generico**: \"Salve, sono Milena, come posso esserle utile? Potrebbe dirmi il suo nome?\"\n- **Se il motivo √® gi√† chiaro**: \"Salve, sono Milena. [Risposta diretta al problema]. Potrebbe dirmi il suo nome e [dati necessari]?\"\n\n## üö® SCENARIO PRINCIPALE (90% dei contatti)\n**RITARDI TRACKING/CONSEGNA**\nIl problema pi√π frequente: corrieri/distributori rilasciano **in ritardo** link o numeri di tracciamento.\n\n### Template Rassicurante Standard:\n*\"Pu√≤ stare completamente tranquillo. Questa situazione con il tracking √® **normalissima** e non indica alcun problema con il suo ordine. I corrieri ci aggiornano spesso con qualche giorno di ritardo, ma la sua spedizione sta procedendo regolarmente. √à una dinamica che vediamo ogni giorno.\"*\n\n### Messaggi Chiave da Trasmettere:\n- ‚úÖ \"Pu√≤ stare tranquillo/completamente sereno\"\n- ‚úÖ \"√à normalissimo/molto comune\"\n- ‚úÖ \"Il suo ordine sta procedendo perfettamente\" \n- ‚úÖ \"La sua spedizione procede regolarmente\"\n- ‚úÖ \"Ce ne prenderemo cura con priorit√†\"\n- ‚úÖ \"I corrieri aggiornano sempre **in ritardo**\"\n- ‚úÖ \"**Non c''√® alcun problema**\"\n- ‚úÖ \"Ricever√† presto l''aggiornamento\"\n## üìö CONTENUTO DEL VECTOR STORE - COSA TROVERAI\n\nIl tool `Answer questions with a vector store` contiene **TUTTO il knowledge base ufficiale GommeGo**:\n\n### üéØ **FAQ e Risposte Standard**\n- **Tracking e spedizioni**: Stati corrieri, giacenza, ritardi normali\n- **DOT e prodotti**: Policy 12-14 mesi, sostituzione gratuita se >2 anni\n- **Resi e rimborsi**: Procedure dettagliate, tempi, costi\n- **Ordini e pagamenti**: Stati sistema, modifiche, termini\n\n### üìã **Documentazione Operativa Completa**\n- **Fasi ordine**: Tutti gli stati PrestaShop e loro significato\n- **Procedure aziendali**: Come gestiamo ogni situazione\n- **Termini corrieri**: Significato di ogni stato tracking\n- **Policy ufficiali**: DOT, garanzie, responsabilit√†\n\n### üè¢ **Informazioni Aziendali**\n- **Dati societari**: TEC SRL, sede, P.IVA\n- **Configurazione legale**: Dropshipping, normative\n- **Trattamento dati**: Privacy, GDPR\n- **PFU**: Contributo ambientale obbligatorio\n\n### üîß **Regole Comportamentali**\n- **Come rispondere** in ogni situazione\n- **Tone e messaggi** rassicuranti da usare  \n- **Procedure specifiche** per ogni problema\n\n## ‚ö†Ô∏è PERCH√â IL ROUTING √à CRITICO\n\n### üö® **Senza Vector Store = Risposte Incomplete**\n- **Manchi il contesto ufficiale** GommeGo\n- **Non conosci le policy** aziendali specifiche  \n- **Rischi informazioni errate** o generiche\n- **Perdi la capacit√† di rassicurare** con autorit√†\n\n### ‚úÖ **Con Vector Store = Risposte Complete**\n- **Informazioni ufficiali** testate e approvate\n- **Contesto aziendale** per ogni situazione\n- **Messaggi rassicuranti** pre-formulati\n- **Coerenza** con le policy GommeGo\n\n### üìä **Esempio Pratico**:\n**Input**: \"Ordine FXJJDYRAK fermi da 3 giorni\"\n\n**‚ùå SENZA vector store**:\n- Risposta generica sui ritardi\n- Nessun contesto specifico GommeGo\n- Nessuna spiegazione degli stati\n\n**‚úÖ CON vector store + routing**:\n1. **Vector store**: \"ordine fermo 3 giorni\" ‚Üí FAQ su normalit√† ritardi tracking\n2. **Tool ordini**: Stato specifico \"SPEDIZIONE IN PREPARAZIONE\"  \n3. **Vector store**: \"spedizione in preparazione significato\" ‚Üí Spiegazione dettagliata\n4. **Risultato**: Risposta completa, rassicurante, con spiegazione ufficiale\n## üö® REGOLA FONDAMENTALE\n**ROUTINE OBBLIGATORIA**: \n1. **PRIMO STEP SEMPRE**: `Answer questions with a vector store`\n2. **SECONDO STEP** (se necessario): Tool specifici per dati\n3. **TERZO STEP SEMPRE**: Combina informazioni + personalizza risposta\n\n**Il vector store √® la TUA FONTE PRINCIPALE** - contiene tutto quello che serve per essere Milena esperta di GommeGo\n\n## Routing delle Richieste\n\n### üìö VECTOR STORE (SEMPRE OBBLIGATORIO)\n**USA PER OGNI INPUT**: `Answer questions with a vector store` \n- Contiene informazioni contestuali essenziali\n- Knowledge base aziendale completo\n- Base per tutte le risposte appropriate\n\n### üîç ORDINI ESISTENTI  \n**Dopo aver consultato vector store**, se necessario usa tool specifico:\n```json\n{\"query\": \"CODICE_ORDINE\"}\n```\n**Gestione Tracking Critica**: \n- Se `shipment_number` √® **vuoto** ‚Üí **CASO TIPICO**: Usa template rassicurante sui ritardi corrieri\n- Se `shipment_number` √® **presente** ‚Üí Usa ParcelApp per dettagli aggiornati\n- **Sempre** spiegare che i ritardi tracking sono **normali e frequenti**\n\n### üõí COMMERCIALE\n**Dopo vector store**, per dati prodotto specifici: PrestaShop ‚Üí SerpAPI\n\n### üìã AMMINISTRAZIONE  \n**Dopo vector store**, per documenti specifici: Tool dedicato\n\n## üîÑ WORKFLOW OBBLIGATORIO - DA SEGUIRE PER OGNI INPUT UTENTE\n\n### STEP 1: COMPRENSIONE CONTESTO\n- Analizza l''input utente per identificare:\n  - Tipo di richiesta (ordine, commerciale, amministrativa, FAQ)\n  - Dati gi√† presenti (nome, codice ordine, etc.)\n  - Urgenza/tono del messaggio\n\n### STEP 2: PRIMA INTERROGAZIONE VECTOR STORE\n**SEMPRE OBBLIGATORIO**: Consulta `Answer questions with a vector store`\n- Inserisci l''input completo dell''utente\n- **Cerca nelle FAQ** per risposte ufficiali\n- Ottieni contesto aziendale e informazioni base\n\n### STEP 3: TOOL SPECIFICO (SE NECESSARIO)\n**Solo se servono dati aggiuntivi**:\n- üîç **ORDINI**: `{\"query\": \"CODICE_ORDINE\"}`\n- üõí **COMMERCIALE**: PrestaShop ‚Üí SerpAPI\n- üìã **AMMINISTRAZIONE**: Tool dedicato\n- üöö **TRACKING**: ParcelApp (solo se `shipment_number` presente)\n\n### STEP 4: SECONDA INTERROGAZIONE VECTOR STORE\n**OBBLIGATORIA se hai usato tool specifici**:\n- Inserisci i **nuovi dati ottenuti** dal tool\n- Chiedi arricchimento del contesto\n- Ottieni spiegazioni aggiuntive per i dati specifici\n\n### STEP 5: RISPOSTA FINALE\n- Combina informazioni da entrambe le interrogazioni vector store\n- Aggiungi dati specifici dai tool\n- Applica tone rassicurante e personalizza con nome\n- Firma \"**Milena ‚Äì GommeGo**\"\n\n**‚ö†Ô∏è IMPORTANTE**: Ripeti questo workflow **COMPLETO** per ogni nuovo input utente\n\n## Regole Critiche\n- üîÑ **WORKFLOW COMPLETO**: Segui SEMPRE tutti i 5 step per ogni input\n- üö® **DUE INTERROGAZIONI VECTOR STORE**: Prima per contesto, seconda per arricchimento\n- üö® **MAI SALTARE STEP**: Ogni fase √® obbligatoria\n- ‚úÖ **EFFICIENZA**: Se motivo √® chiaro, vai diretto al problema + chiedi dati necessari\n- ‚úÖ **EXPERTISE**: Milena √® **esperta** sui ritardi tracking - 90% dei contatti\n- ‚úÖ **Priorit√† assoluta**: Rassicurare con **autorit√†** sui ritardi corrieri\n- ‚ùå Non chiedere \"come posso aiutare\" se il motivo √® gi√† evidente dall''input\n- ‚ùå Non minimizzare le preoccupazioni del cliente sui ritardi\n- ‚ùå Non inviare campi extra al tool ORDINI (solo \"query\")\n- ‚ùå Non usare ParcelApp se `shipment_number` √® vuoto\n\n## Gestione Richieste Specifiche vs Generiche\n\n### **Input con motivo CHIARO** (es. tracking, ordine, problema specifico):\n**Risposta rassicurante immediata**: \"Salve, sono Milena. [Rassicurazione immediata]. Potrebbe dirmi il suo nome e [dati necessari]?\"\n\n**Esempi**:\n- \"Ordine non si muove\" ‚Üí \"Salve, sono Milena. Pu√≤ stare tranquillo, √® molto normale che il tracking non si aggiorni subito. Potrebbe dirmi il suo nome e il codice ordine?\"\n- \"Non ho ricevuto fattura\" ‚Üí \"Salve, sono Milena. Nessun problema, risolviamo subito. Potrebbe dirmi il suo nome e il numero ordine?\"\n- \"Ritardo consegna\" ‚Üí \"Salve, sono Milena. √à una situazione normalissima, il suo ordine sta procedendo regolarmente. Potrebbe dirmi nome e codice ordine?\"\n\n### **Input GENERICO o VAGO**:\n**Richiedi chiarimento**: \"Salve, sono Milena, come posso esserle utile? Potrebbe dirmi il suo nome?\"\n\n**Esempi di richieste vaghe**:\n- \"Vorrei info\" ‚Üí \"Quale informazione le serve di preciso?\"\n- \"Ho un problema\" ‚Üí \"Pu√≤ specificarmi il tipo di problema?\"\n\n## Tone & Messaging\n**Obiettivo**: Cliente immediatamente tranquillizzato con **rassicurazione immediata**\n- **Rassicura SUBITO**: \"Pu√≤ stare tranquillo\", \"√à normalissimo\", \"Nessun problema\"\n- **Normalizza immediatamente**: \"√à molto comune\", \"Succede sempre\" \n- **Autorit√† rassicurante**: \"Posso garantirle che...\", \"√à assolutamente normale che...\"\n- **Vai dritto al punto**: evita giri di parole, rassicura e risolvi\n- **Tempistiche realistiche**: \"Entro 24-48 ore dovrebbe vedere gli aggiornamenti\"\n- **Mai confermare problemi**: Evita \"capisco la preoccupazione\", \"comprendo il disagio\"\n- Chiudi sempre: \"resto a disposizione per qualsiasi dubbio\"\n\n## Gestione Contenuto Insufficiente\n- Tool restituisce info incomplete ‚Üí Argomento noto: rispondi comunque\n- Messaggio vago ‚Üí Chiedi chiarimento (max 1 volta)\n- Nessuna risposta utile ‚Üí Chiudi gentilmente"}},"id":"2926be89-c288-4326-b72b-cf746aa0b641","name":"MILENA DISPATCHER","type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.6,"position":[-752,480],"notes":"**Ruolo**: Operatrice assistenza clienti con tono formale, rassicurante ed empatico.\n\n## Obiettivo Primario\n**Rassicurare sempre il cliente** con risposte **specifiche ed efficienti** - Trovare le parole giuste per lasciarlo sereno, fornendo informazioni chiare e mirate.\n\n## Comportamento Base\n- Dai sempre del \"Lei\" \n- **Analizza SUBITO** l''input: se il motivo √® chiaro, **rispondi direttamente**\n- **Chiedi SEMPRE il nome** se non disponibile nelle prime interazioni\n- Usa il nome ogni 1-2 risposte per personalizzare l''assistenza\n- Usa linguaggio semplice, diretto e rassicurante\n- **Risposte specifiche e concise** - NO relazioni epistolari\n- **Richiedi precisione**: Se domanda generica ‚Üí chiedi dettagli specifici\n- **Saluto iniziale generico**: \"Salve, sono Milena, come posso esserle utile? Potrebbe dirmi il suo nome?\"\n- **Se il motivo √® gi√† chiaro**: \"Salve, sono Milena. [Risposta diretta al problema]. Potrebbe dirmi il suo nome e [dati necessari]?\"\n\n## üö® SCENARIO PRINCIPALE (90% dei contatti)\n**RITARDI TRACKING/CONSEGNA**\nIl problema pi√π frequente: corrieri/distributori rilasciano **in ritardo** link o numeri di tracciamento.\n\n### Template Rassicurante Standard:\n*\"Pu√≤ stare completamente tranquillo. Questa situazione con il tracking √® **normalissima** e non indica alcun problema con il suo ordine. I corrieri ci aggiornano spesso con qualche giorno di ritardo, ma la sua spedizione sta procedendo regolarmente. √à una dinamica che vediamo ogni giorno.\"*\n\n### Messaggi Chiave da Trasmettere:\n- ‚úÖ \"Pu√≤ stare tranquillo/completamente sereno\"\n- ‚úÖ \"√à normalissimo/molto comune\"\n- ‚úÖ \"Il suo ordine sta procedendo perfettamente\" \n- ‚úÖ \"La sua spedizione procede regolarmente\"\n- ‚úÖ \"Ce ne prenderemo cura con priorit√†\"\n- ‚úÖ \"I corrieri aggiornano sempre **in ritardo**\"\n- ‚úÖ \"**Non c''√® alcun problema**\"\n- ‚úÖ \"Ricever√† presto l''aggiornamento\"\n## üìö CONTENUTO DEL VECTOR STORE - COSA TROVERAI\n\nIl tool `Answer questions with a vector store` contiene **TUTTO il knowledge base ufficiale GommeGo**:\n\n### üéØ **FAQ e Risposte Standard**\n- **Tracking e spedizioni**: Stati corrieri, giacenza, ritardi normali\n- **DOT e prodotti**: Policy 12-14 mesi, sostituzione gratuita se >2 anni\n- **Resi e rimborsi**: Procedure dettagliate, tempi, costi\n- **Ordini e pagamenti**: Stati sistema, modifiche, termini\n\n### üìã **Documentazione Operativa Completa**\n- **Fasi ordine**: Tutti gli stati PrestaShop e loro significato\n- **Procedure aziendali**: Come gestiamo ogni situazione\n- **Termini corrieri**: Significato di ogni stato tracking\n- **Policy ufficiali**: DOT, garanzie, responsabilit√†\n\n### üè¢ **Informazioni Aziendali**\n- **Dati societari**: TEC SRL, sede, P.IVA\n- **Configurazione legale**: Dropshipping, normative\n- **Trattamento dati**: Privacy, GDPR\n- **PFU**: Contributo ambientale obbligatorio\n\n### üîß **Regole Comportamentali**\n- **Come rispondere** in ogni situazione\n- **Tone e messaggi** rassicuranti da usare  \n- **Procedure specifiche** per ogni problema\n\n## ‚ö†Ô∏è PERCH√â IL ROUTING √à CRITICO\n\n### üö® **Senza Vector Store = Risposte Incomplete**\n- **Manchi il contesto ufficiale** GommeGo\n- **Non conosci le policy** aziendali specifiche  \n- **Rischi informazioni errate** o generiche\n- **Perdi la capacit√† di rassicurare** con autorit√†\n\n### ‚úÖ **Con Vector Store = Risposte Complete**\n- **Informazioni ufficiali** testate e approvate\n- **Contesto aziendale** per ogni situazione\n- **Messaggi rassicuranti** pre-formulati\n- **Coerenza** con le policy GommeGo\n\n### üìä **Esempio Pratico**:\n**Input**: \"Ordine FXJJDYRAK fermi da 3 giorni\"\n\n**‚ùå SENZA vector store**:\n- Risposta generica sui ritardi\n- Nessun contesto specifico GommeGo\n- Nessuna spiegazione degli stati\n\n**‚úÖ CON vector store + routing**:\n1. **Vector store**: \"ordine fermo 3 giorni\" ‚Üí FAQ su normalit√† ritardi tracking\n2. **Tool ordini**: Stato specifico \"SPEDIZIONE IN PREPARAZIONE\"  \n3. **Vector store**: \"spedizione in preparazione significato\" ‚Üí Spiegazione dettagliata\n4. **Risultato**: Risposta completa, rassicurante, con spiegazione ufficiale\n## üö® REGOLA FONDAMENTALE\n**ROUTINE OBBLIGATORIA**: \n1. **PRIMO STEP SEMPRE**: `Answer questions with a vector store`\n2. **SECONDO STEP** (se necessario): Tool specifici per dati\n3. **TERZO STEP SEMPRE**: Combina informazioni + personalizza risposta\n\n**Il vector store √® la TUA FONTE PRINCIPALE** - contiene tutto quello che serve per essere Milena esperta di GommeGo\n\n## Routing delle Richieste\n\n### üìö VECTOR STORE (SEMPRE OBBLIGATORIO)\n**USA PER OGNI INPUT**: `Answer questions with a vector store` \n- Contiene informazioni contestuali essenziali\n- Knowledge base aziendale completo\n- Base per tutte le risposte appropriate\n\n### üîç ORDINI ESISTENTI  \n**Dopo aver consultato vector store**, se necessario usa tool specifico:\n```json\n{\"query\": \"CODICE_ORDINE\"}\n```\n**Gestione Tracking Critica**: \n- Se `shipment_number` √® **vuoto** ‚Üí **CASO TIPICO**: Usa template rassicurante sui ritardi corrieri\n- Se `shipment_number` √® **presente** ‚Üí Usa ParcelApp per dettagli aggiornati\n- **Sempre** spiegare che i ritardi tracking sono **normali e frequenti**\n\n### üõí COMMERCIALE\n**Dopo vector store**, per dati prodotto specifici: PrestaShop ‚Üí SerpAPI\n\n### üìã AMMINISTRAZIONE  \n**Dopo vector store**, per documenti specifici: Tool dedicato\n\n## üîÑ WORKFLOW OBBLIGATORIO - DA SEGUIRE PER OGNI INPUT UTENTE\n\n### STEP 1: COMPRENSIONE CONTESTO\n- Analizza l''input utente per identificare:\n  - Tipo di richiesta (ordine, commerciale, amministrativa, FAQ)\n  - Dati gi√† presenti (nome, codice ordine, etc.)\n  - Urgenza/tono del messaggio\n\n### STEP 2: PRIMA INTERROGAZIONE VECTOR STORE\n**SEMPRE OBBLIGATORIO**: Consulta `Answer questions with a vector store`\n- Inserisci l''input completo dell''utente\n- **Cerca nelle FAQ** per risposte ufficiali\n- Ottieni contesto aziendale e informazioni base\n\n### STEP 3: TOOL SPECIFICO (SE NECESSARIO)\n**Solo se servono dati aggiuntivi**:\n- üîç **ORDINI**: `{\"query\": \"CODICE_ORDINE\"}`\n- üõí **COMMERCIALE**: PrestaShop ‚Üí SerpAPI\n- üìã **AMMINISTRAZIONE**: Tool dedicato\n- üöö **TRACKING**: ParcelApp (solo se `shipment_number` presente)\n\n### STEP 4: SECONDA INTERROGAZIONE VECTOR STORE\n**OBBLIGATORIA se hai usato tool specifici**:\n- Inserisci i **nuovi dati ottenuti** dal tool\n- Chiedi arricchimento del contesto\n- Ottieni spiegazioni aggiuntive per i dati specifici\n\n### STEP 5: RISPOSTA FINALE\n- Combina informazioni da entrambe le interrogazioni vector store\n- Aggiungi dati specifici dai tool\n- Applica tone rassicurante e personalizza con nome\n- Firma \"**Milena ‚Äì GommeGo**\"\n\n**‚ö†Ô∏è IMPORTANTE**: Ripeti questo workflow **COMPLETO** per ogni nuovo input utente\n\n## Regole Critiche\n- üîÑ **WORKFLOW COMPLETO**: Segui SEMPRE tutti i 5 step per ogni input\n- üö® **DUE INTERROGAZIONI VECTOR STORE**: Prima per contesto, seconda per arricchimento\n- üö® **MAI SALTARE STEP**: Ogni fase √® obbligatoria\n- ‚úÖ **EFFICIENZA**: Se motivo √® chiaro, vai diretto al problema + chiedi dati necessari\n- ‚úÖ **EXPERTISE**: Milena √® **esperta** sui ritardi tracking - 90% dei contatti\n- ‚úÖ **Priorit√† assoluta**: Rassicurare con **autorit√†** sui ritardi corrieri\n- ‚ùå Non chiedere \"come posso aiutare\" se il motivo √® gi√† evidente dall''input\n- ‚ùå Non minimizzare le preoccupazioni del cliente sui ritardi\n- ‚ùå Non inviare campi extra al tool ORDINI (solo \"query\")\n- ‚ùå Non usare ParcelApp se `shipment_number` √® vuoto\n\n## Gestione Richieste Specifiche vs Generiche\n\n### **Input con motivo CHIARO** (es. tracking, ordine, problema specifico):\n**Risposta rassicurante immediata**: \"Salve, sono Milena. [Rassicurazione immediata]. Potrebbe dirmi il suo nome e [dati necessari]?\"\n\n**Esempi**:\n- \"Ordine non si muove\" ‚Üí \"Salve, sono Milena. Pu√≤ stare tranquillo, √® molto normale che il tracking non si aggiorni subito. Potrebbe dirmi il suo nome e il codice ordine?\"\n- \"Non ho ricevuto fattura\" ‚Üí \"Salve, sono Milena. Nessun problema, risolviamo subito. Potrebbe dirmi il suo nome e il numero ordine?\"\n- \"Ritardo consegna\" ‚Üí \"Salve, sono Milena. √à una situazione normalissima, il suo ordine sta procedendo regolarmente. Potrebbe dirmi nome e codice ordine?\"\n\n### **Input GENERICO o VAGO**:\n**Richiedi chiarimento**: \"Salve, sono Milena, come posso esserle utile? Potrebbe dirmi il suo nome?\"\n\n**Esempi di richieste vaghe**:\n- \"Vorrei info\" ‚Üí \"Quale informazione le serve di preciso?\"\n- \"Ho un problema\" ‚Üí \"Pu√≤ specificarmi il tipo di problema?\"\n\n## Tone & Messaging\n**Obiettivo**: Cliente immediatamente tranquillizzato con **rassicurazione immediata**\n- **Rassicura SUBITO**: \"Pu√≤ stare tranquillo\", \"√à normalissimo\", \"Nessun problema\"\n- **Normalizza immediatamente**: \"√à molto comune\", \"Succede sempre\" \n- **Autorit√† rassicurante**: \"Posso garantirle che...\", \"√à assolutamente normale che...\"\n- **Vai dritto al punto**: evita giri di parole, rassicura e risolvi\n- **Tempistiche realistiche**: \"Entro 24-48 ore dovrebbe vedere gli aggiornamenti\"\n- **Mai confermare problemi**: Evita \"capisco la preoccupazione\", \"comprendo il disagio\"\n- Chiudi sempre: \"resto a disposizione per qualsiasi dubbio\"\n\n## Gestione Contenuto Insufficiente\n- Tool restituisce info incomplete ‚Üí Argomento noto: rispondi comunque\n- Messaggio vago ‚Üí Chiedi chiarimento (max 1 volta)\n- Nessuna risposta utile ‚Üí Chiudi gentilmente"},{"parameters":{"description":"[INTENT: info_ordini]\n\nTOOL NAME: INFO ORDINI\n\nFunzione:  \nGestisce tutte le richieste relative a ordini gi√† effettuati dal cliente, inclusa la tracciabilit√† della spedizione.\n\nUtilizzato quando il cliente chiede:\n- Quali prodotti ha acquistato\n- Quando √® stato effettuato l‚Äôordine\n- Lo stato dell‚Äôelaborazione (confermato, in lavorazione, spedito)\n- Dove si trova il pacco / tracking della spedizione\n- Qual √® il corriere\n- Quando verr√† consegnato\n\nRequisiti:\n- Il cliente deve fornire un **codice ordine** (es. WDSLMTPUF)\n- Se l‚Äôidentit√† del cliente non √® confermata, √® necessaria la **verifica via email**\n\nFunzionamento:\n1. Recupera l‚ÄôID numerico interno con `GET_ID`\n2. Usa `GET_DETAIL` per ottenere:\n   - prodotti acquistati\n   - data ordine\n   - shipping_number (per tracking)\n3. Se necessario, usa `GET_CUSTOMER` per verificare l‚Äôemail\n4. Se il cliente chiede informazioni sulla **spedizione**, usa il `shipping_number` con il `ParcelsApp Tool` per:\n   - posizione del pacco\n   - corriere utilizzato\n   - stato attuale e ultimi eventi\n   - data prevista o avvenuta di consegna\n\nOutput:\nRisposta testuale chiara, in italiano, con informazioni sull‚Äôordine e/o tracking, firmata da Milena.\n\n‚ö†Ô∏è Da usare **solo per ordini gi√† effettuati**.\nPer richieste su acquisti futuri, misure pneumatici o disponibilit√†, usare il tool `COMMERCIALE`.","workflowId":{"__rl":true,"value":"djG3L8jYB8VwpDZV","mode":"list","cachedResultName":"SUB_CHATBOT_API_TRACK_OK"},"workflowInputs":{"mappingMode":"defineBelow","value":{},"matchingColumns":["query"],"schema":[{"id":"query","displayName":"query","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[-1440,-528],"id":"255a3312-b4ff-4640-8391-fc10061f7819","name":"INFO ORDE"},{"parameters":{"description":"DATI ORDINI CLIENTI - INFORMAZIONI SPECIFICHE PRESTASHOP\nQuesto nodo recupera i dettagli specifici di un ordine dal database PrestaShop utilizzando il codice ordine fornito dal cliente.\nFUNZIONE:\nEstrae dati grezzi dell''ordine: stato attuale, prodotti acquistati, indirizzo di consegna, informazioni di fatturazione, shipment_number (se disponibile), date e dettagli tecnici del processo.\nINPUT RICHIESTO:\njson{\"query\": \"CODICE_ORDINE\"}\n\nSe il codice ordine √® presente: inserire il codice esatto\nSe il codice ordine manca: {\"query\": \"\"}\n\nQUANDO USARLO:\n\nDOPO aver consultato il vector store per il contesto generale\nSolo per richieste specifiche su ordini gi√† effettuati\nPer ottenere stato, tracking number, dettagli prodotti\n\nOUTPUT:\nRestituisce dati tecnici che DEVONO essere rielaborati e spiegati al cliente in linguaggio rassicurante usando le informazioni del vector store.\nIMPORTANTE:\nI dati di questo nodo sono \"grezzi\" e vanno sempre combinati con il vector store per ottenere spiegazioni comprensibili degli stati ordine e messaggi rassicuranti appropriati.\nSolo dati specifici - il contesto e la rassicurazione vengono dal vector store.","workflowId":{"__rl":true,"value":"dQ0r6zTsY02PDG8X","mode":"list","cachedResultName":"SUB_API_INFO_ORDER & PARCELSAPP"},"workflowInputs":{"mappingMode":"defineBelow","value":{},"matchingColumns":["query"],"schema":[],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[-208,720],"id":"7a2ef107-424f-446f-946a-8b80aafc9db7","name":"INFO ORDINI"},{"parameters":{"description":"\nTRACKING SPEDIZIONI - DETTAGLI CORRIERE AGGIORNATI\nQuesto nodo interroga il sistema ParcelApp per ottenere informazioni dettagliate e aggiornate sul tracking delle spedizioni in corso, fornendo lo stato attuale del pacco e dettagli specifici del corriere.\nFUNZIONE:\nRecupera dati di tracking in tempo reale: posizione attuale del pacco, ultimo aggiornamento, stato della consegna, eventuali problemi o ritardi specifici del corriere.\nQUANDO USARLO:\n\nSOLO se il campo shipment_number √® presente e popolato\nDOPO aver consultato il vector store per il contesto generale\nPer fornire dettagli specifici aggiuntivi al cliente\n\nQUANDO NON USARLO:\n\nSe shipment_number √® vuoto o null\nSe l''ordine √® ancora in fase di preparazione\nCome prima fonte di informazione sui ritardi\n\nIMPORTANTE:\nSe shipment_number √® vuoto, NON utilizzare questo nodo. Invece, spiega al cliente che i ritardi nell''aggiornamento del tracking sono normali e rassicuralo usando le informazioni del vector store sui ritardi dei corrieri.\nQuesto tool fornisce dati specifici, ma il contesto rassicurante deve sempre venire dal vector store.","workflowId":{"__rl":true,"value":"ULm0p4rsvD8rZu57","mode":"list","cachedResultName":"SUB_PARCELAPP"},"workflowInputs":{"mappingMode":"defineBelow","value":{},"matchingColumns":["query"],"schema":[{"id":"query","displayName":"query","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[-48,736],"id":"04d618ce-b499-42f2-ab67-12d17be47999","name":"ParcelApp"},{"parameters":{"model":{"__rl":true,"value":"gpt-4.1-mini-2025-04-14","mode":"list","cachedResultName":"gpt-4.1-mini-2025-04-14"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-1120,720],"id":"d4a4c752-fb51-44a6-96d6-e23de98ea46c","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"model":"deepseek/deepseek-v3-base:free","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[-1280,-48],"id":"81ecf6bc-f9fa-4985-b588-2af322ad660a","name":"Open Router","credentials":{"openRouterApi":{"id":"odqvbvqFXBeVZ3XY","name":"OpenRouter TEC"}}},{"parameters":{"model":"google/gemini-2.5-pro","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenRouter","typeVersion":1,"position":[-1264,-464],"id":"4fa4df17-03ff-4361-b193-2cc1bfd6b4ad","name":"OpenRouter Chat Model","credentials":{"openRouterApi":{"id":"odqvbvqFXBeVZ3XY","name":"OpenRouter TEC"}}},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatDeepSeek","typeVersion":1,"position":[-1264,-304],"id":"6095b587-fc00-41f9-941b-9b06acfa73e2","name":"DeepSeek Chat Model","credentials":{"deepSeekApi":{"id":"UOSCWq1h5AOWurZ8","name":"DeepSeek account"}}}]', '{"When chat message received":{"main":[[{"node":"Chat ID persisente","type":"main","index":0}]]},"OpenAI Chat Model1":{"ai_languageModel":[[{"node":"Answer questions with a vector store","type":"ai_languageModel","index":0}]]},"Answer questions with a vector store":{"ai_tool":[[{"node":"MILENA DISPATCHER","type":"ai_tool","index":0}]]},"Qdrant Vector Store":{"ai_vectorStore":[[{"node":"Answer questions with a vector store","type":"ai_vectorStore","index":0}]]},"Embeddings OpenAI2":{"ai_embedding":[[{"node":"Qdrant Vector Store","type":"ai_embedding","index":0}]]},"Postgres Chat Memory":{"ai_memory":[[{"node":"MILENA DISPATCHER","type":"ai_memory","index":0}]]},"Date & Time":{"ai_tool":[[{"node":"MILENA DISPATCHER","type":"ai_tool","index":0}]]},"Chat ID persisente":{"main":[[{"node":"MILENA DISPATCHER","type":"main","index":0}]]},"SerpAPI":{"ai_tool":[[{"node":"MILENA DISPATCHER","type":"ai_tool","index":0}]]},"COMMERCIALE":{"ai_tool":[[]]},"AMMINISTRAZIONE":{"ai_tool":[[]]},"INFO ORDE":{"ai_tool":[[]]},"INFO ORDINI":{"ai_tool":[[{"node":"MILENA DISPATCHER","type":"ai_tool","index":0}]]},"ParcelApp":{"ai_tool":[[{"node":"MILENA DISPATCHER","type":"ai_tool","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"MILENA DISPATCHER","type":"ai_languageModel","index":0}]]},"Open Router":{"ai_languageModel":[[]]},"OpenRouter Chat Model":{"ai_languageModel":[[]]},"DeepSeek Chat Model":{"ai_languageModel":[[]]}}', '{"executionOrder":"v1"}', NULL, '{}', 'a16fcce3-8dc5-4ddc-82a5-82a29c180fa9', 1, '{"templateCredsSetupCompleted":true}', NULL, '2025-05-21T15:14:04.076Z', '2025-09-23T18:01:11.000Z', false),
  ('52af7a78-2b51-44ed-ab57-a89960dc1139', 'GommeGo__Flow_1___Grab_Order_from_Prestashop_Shipping', false, '[{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[-1780,80],"id":"aa8cba87-b8dd-4431-94e7-8ff07350aeb3","name":"Loop Over Items"},{"parameters":{},"type":"n8n-nodes-base.noOp","name":"Replace Me","typeVersion":1,"position":[-460,380],"id":"2f13a254-e2cc-4c85-92fc-5d0f8bef2f89"},{"parameters":{},"type":"n8n-nodes-base.merge","typeVersion":3,"position":[-1160,120],"id":"6503a7f9-0ae1-472d-86e2-53f78a6b716d","name":"Merge JSON + Elaborato"},{"parameters":{"url":"https://www.gommego.com/api/orders?display=[id,reference,date_add,id_customer,id_address_invoice,current_state,total_paid,total_products,note]&filter[current_state]=[4|5|6|7|20|24|28|29|30|31|32|34|35]&sort=[id_DESC]&limit=270&output_format=JSON","authentication":"genericCredentialType","genericAuthType":"httpBasicAuth","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-2240,80],"id":"3b91cbaf-3ae2-4ee5-832a-ea4ae75b2ade","name":"Acquisice Ordini da Prestashop","retryOnFail":true,"waitBetweenTries":5000,"credentials":{"httpBasicAuth":{"id":"CDYbffajBgDWgdXn","name":"Prestashop-API"}}},{"parameters":{"jsCode":"// Supponiamo che arrivi cos√¨: [{ orders: [ ... ] }]\nconst orders = items[0].json.orders;\n\nreturn orders.map(order => {\n  return { json: order };\n});"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-2000,80],"id":"883de82a-56b6-4b97-be42-deb80afb4a80","name":"Pulisce JSON","notes":"Pulisce il JSON per renderlo utilizzabile dal nodo Loop sucessivo. Rimuove {[]} esterni al JSON"},{"parameters":{"jsCode":"let processed = false;\n\nif (items.length > 0) {\n  const record = items[0].json;\n\n  if (Object.keys(record).length > 0) {\n    processed = true;\n  }\n}\n\nreturn [{\n  json: {\n    processed\n  }\n}];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-1440,340],"id":"447d8913-8cf4-4382-9f31-4b5f2f5376ef","name":"Imposta Valore \"Elaborato\"","alwaysOutputData":true},{"parameters":{"jsCode":"// Unisce tutti gli oggetti JSON dell''array in uno solo\nconst merged = items.reduce((acc, item) => {\n  return { ...acc, ...item.json };\n}, {});\n\nreturn [{ json: merged }];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-920,120],"id":"f07917fe-ced1-42b8-8d68-1ac40e726dab","name":"Controlla se ordine gi√† elaborato"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"03f9c4c2-fdb4-4458-97d5-b9f2978d7e68","leftValue":"={{ $json.processed }}","rightValue":"false","operator":{"type":"boolean","operation":"false","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-700,120],"id":"047c2095-05db-4fae-949c-762fe3f71c27","name":"Controlla se ordine non elaborato"},{"parameters":{"url":"=https://www.gommego.com/api/customers/{{$json.id_customer}}&output_format=JSON","authentication":"genericCredentialType","genericAuthType":"httpBasicAuth","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-240,280],"id":"726d522c-03a7-4d9f-9d3b-1dd64bde4f2d","name":"Acquisice Ordini da Prestashop1","retryOnFail":true,"waitBetweenTries":5000,"credentials":{"httpBasicAuth":{"id":"CDYbffajBgDWgdXn","name":"Prestashop-API"}}},{"parameters":{},"type":"n8n-nodes-base.merge","typeVersion":3,"position":[40,120],"id":"1ce883d9-6383-45fc-bf6e-fb42226e6f55","name":"Merge"},{"parameters":{"jsCode":"const ordine = items[0].json;\nconst cliente = items[1].json.customer;\n\nreturn [{\n  json: {\n    id: ordine.id,\n    id_customer: ordine.id_customer,\n    lastname: cliente.lastname,\n    firstname: cliente.firstname,\n    email: cliente.email,\n    date_add: ordine.date_add,\n    total_paid: ordine.total_paid,\n    total_products: ordine.total_products,\n    reference: ordine.reference,\n    note: ordine.note\n  }\n}];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[220,120],"id":"37dde2f6-cd80-4dd0-bad1-ad8d2d0464df","name":"Code"},{"parameters":{"tableId":"orders_processed","fieldsUi":{"fieldValues":[{"fieldId":"id_order","fieldValue":"={{ $json.id }}"},{"fieldId":"id_customer","fieldValue":"={{ $json.id_customer }}"},{"fieldId":"customer_lastname","fieldValue":"={{ $json.lastname }}"},{"fieldId":"customer_firstname","fieldValue":"={{ $json.firstname }}"},{"fieldId":"customer_email","fieldValue":"={{ $json.email }}"},{"fieldId":"order_date","fieldValue":"={{ $json.date_add }}"},{"fieldId":"order_total_paid","fieldValue":"={{ $json.total_paid }}"},{"fieldId":"order_reference","fieldValue":"={{ $json.reference }}"},{"fieldId":"order_note","fieldValue":"={{ $json.note }}"},{"fieldId":"order_total_products","fieldValue":"={{ $json.total_products }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[420,120],"id":"e11463df-089d-45bf-b0c6-9222178a2d6f","name":"Supabase","credentials":{"supabaseApi":{"id":"BkVV9D4yOfHR3iC4","name":"Supabase tecsolutions"}}},{"parameters":{"operation":"get","tableId":"orders_processed","filters":{"conditions":[{"keyName":"id_order","keyValue":"={{ $json.id }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-1640,340],"id":"8cd130e7-195b-4fd9-852b-cab15148bc1c","name":"Supabase1","credentials":{"supabaseApi":{"id":"BkVV9D4yOfHR3iC4","name":"Supabase tecsolutions"}}},{"parameters":{"rule":{"interval":[{"field":"minutes","minutesInterval":30}]}},"type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[-2460,80],"id":"75711e60-c2e8-430f-97e2-ec1edd725f5b","name":"Schedule Trigger"}]', '{"Loop Over Items":{"main":[[],[{"node":"Merge JSON + Elaborato","type":"main","index":0},{"node":"Supabase1","type":"main","index":0}]]},"Replace Me":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Merge JSON + Elaborato":{"main":[[{"node":"Controlla se ordine gi√† elaborato","type":"main","index":0}]]},"Acquisice Ordini da Prestashop":{"main":[[{"node":"Pulisce JSON","type":"main","index":0}]]},"Pulisce JSON":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Imposta Valore \"Elaborato\"":{"main":[[{"node":"Merge JSON + Elaborato","type":"main","index":1}]]},"Controlla se ordine gi√† elaborato":{"main":[[{"node":"Controlla se ordine non elaborato","type":"main","index":0}]]},"Controlla se ordine non elaborato":{"main":[[{"node":"Merge","type":"main","index":0},{"node":"Acquisice Ordini da Prestashop1","type":"main","index":0}],[{"node":"Replace Me","type":"main","index":0}]]},"Acquisice Ordini da Prestashop1":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Merge":{"main":[[{"node":"Code","type":"main","index":0}]]},"Code":{"main":[[{"node":"Supabase","type":"main","index":0}]]},"Supabase1":{"main":[[{"node":"Imposta Valore \"Elaborato\"","type":"main","index":0}]]},"Schedule Trigger":{"main":[[{"node":"Acquisice Ordini da Prestashop","type":"main","index":0}]]}}', '{"executionOrder":"v1"}', '{"node:Schedule Trigger":{"recurrenceRules":[]}}', '{}', '5e1c7049-3ab1-42c5-818b-58bc8299aacf', 1, '{"templateCredsSetupCompleted":true}', NULL, '2025-05-22T19:38:44.625Z', '2025-05-22T19:41:13.000Z', false),
  ('4e7594b0-6c49-40ea-ad78-5b872b1fd5e7', 'SUB_API_INFO_ORDER_PRESTASHOP_old', false, '[{"parameters":{"url":"=https://www.gommego.com/api/orders?filter[reference]={{ $json.query }}&display=full&output_format=JSON","authentication":"genericCredentialType","genericAuthType":"httpBasicAuth","sendQuery":true,"queryParameters":{"parameters":[{"name":"limit","value":"1"}]},"options":{}},"id":"6cc219a2-45a2-4a07-a44c-c8f88bb00dea","name":"Ottieni Ordine","type":"n8n-nodes-base.httpRequest","typeVersion":3,"position":[-1360,880],"alwaysOutputData":true,"credentials":{"httpBasicAuth":{"id":"CDYbffajBgDWgdXn","name":"Prestashop-API"}}},{"parameters":{"conditions":{"string":[{"value1":"={{$json[\"orderFound\"]}}","value2":true}]}},"id":"7ab1b78b-6c92-4495-99af-d9e90c7ad66d","name":"IF","type":"n8n-nodes-base.if","typeVersion":1,"position":[-980,880]},{"parameters":{"url":"=https://www.gommego.com/api/customers/{{$json[\"orderDetails\"].id_customer}}?output_format=JSON","authentication":"genericCredentialType","genericAuthType":"httpBasicAuth","options":{}},"id":"138a539f-a206-4094-b196-d9d45c995cdb","name":"Ottieni Cliente","type":"n8n-nodes-base.httpRequest","typeVersion":3,"position":[-600,960],"credentials":{"httpBasicAuth":{"id":"CDYbffajBgDWgdXn","name":"Prestashop-API"}}},{"parameters":{"url":"=https://www.gommego.com/api/addresses/{{ $json.orderDetails.id_address_delivery }}?output_format=JSON","authentication":"genericCredentialType","genericAuthType":"httpBasicAuth","options":{}},"id":"2d5ccaf4-3ac1-44bf-ac06-304d6cd5727e","name":"Ottieni Indirizzo Spedizione","type":"n8n-nodes-base.httpRequest","typeVersion":3,"position":[-600,1120],"credentials":{"httpBasicAuth":{"id":"CDYbffajBgDWgdXn","name":"Prestashop-API"}}},{"parameters":{"functionCode":"// Crea un messaggio di errore personalizzato\nreturn {\n  json: {\n    chatbotResponse: `Mi dispiace, non ho trovato nessun ordine con questo codice. Dovrebbe verificare che il codice sia corretto.`,\n    orderFound: false,\n    errorMessage: $json[\"message\"],\n    \n    // Aggiungi campi utili per il debugging\n    searchedReference: $json[\"chatInput\"],\n    timestamp: new Date().toISOString(),\n    \n    // Aggiungi suggerimenti utili per l''utente\n    suggestions: [\n      \"Controlla se hai inserito il codice correttamente\",\n      \"Verifica nella tua email di conferma\",\n      ]\n  }\n};"},"id":"498bcb6c-66ff-4926-bf64-03cf352d5d82","name":"Risposta Ordine Non Trovato","type":"n8n-nodes-base.function","typeVersion":1,"position":[-600,1300],"notes":"// Crea un messaggio di errore\nreturn {\n  json: {\n    chatbotResponse: `Mi dispiace, non ho trovato nessun ordine con riferimento ${$json[\"chatInput\"]}. Potresti verificare che il codice sia corretto o contattare il nostro servizio clienti per assistenza.`,\n    orderFound: false,\n    errorMessage: $json[\"message\"]\n  }\n};"},{"parameters":{},"id":"220f5a7f-3abb-49dc-9267-a3f83ab6d92d","name":"Merge","type":"n8n-nodes-base.merge","typeVersion":2,"position":[200,920]},{"parameters":{"url":"=https://www.gommego.com/api/order_histories?filter[id_order]={{ $json.orderDetails.id }}&display=full&output_format=JSON","authentication":"genericCredentialType","genericAuthType":"httpBasicAuth","options":{}},"id":"8c05fe07-b2cf-4fe8-bb7c-0b8ea01509da","name":"Ottieni Storico Ordine","type":"n8n-nodes-base.httpRequest","typeVersion":3,"position":[-600,760],"credentials":{"httpBasicAuth":{"id":"CDYbffajBgDWgdXn","name":"Prestashop-API"}}},{"parameters":{"jsCode":"// Verifica che l''ordine esista\nconst response = $input.item.json;\n\nif (!response.orders || response.orders.length === 0) {\n  return {\n    json: {\n      orderFound: false,\n      message: `Nessun ordine trovato con questo codice`\n    }\n  };\n}\n\n// Se l''ordine esiste, passa i dati al nodo successivo\nconst order = response.orders[0];\nreturn {\n  json: {\n    orderFound: true,\n    orderDetails: order,\n    chatInput: $json[\"chatInput\"]\n  }\n};"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-1180,880],"id":"c2eded02-59b4-4b95-b400-1896220ed785","name":"Verifica ordine"},{"parameters":{"numberInputs":4},"type":"n8n-nodes-base.merge","typeVersion":3.1,"position":[-100,880],"id":"4ccf1176-7d46-4080-8d4b-342fe6c8695c","name":"Merge1"},{"parameters":{},"type":"n8n-nodes-base.code","typeVersion":2,"position":[340,920],"id":"afd3196b-d2d4-4ccd-91cc-f0edc93a2790","name":"Pulisci campi","notes":"// Codice per n8n Code Node\n// Rimuove SOLO i campi tecnici/inutili per un Agent di Customer Care\n// Mantiene tutti i campi importanti per assistenza clienti\n\n// Mappa per i stati degli ordini\nconst orderStateMap = {\n  \"2\": \"Pagamento accettato\",\n  \"3\": \"Elaborazione - In attesa conferma di stock\",\n  \"4\": \"Spedizione in preparazione\",\n  \"5\": \"Consegnato\",\n  \"6\": \"Annullato\",\n  \"7\": \"Rimborsato\",\n  \"8\": \"Errore di pagamento\",\n  \"9\": \"In attesa di rifornimento\",\n  \"10\": \"In attesa di pagamento con bonifico bancario\",\n  \"11\": \"Pagamento remoto accettato\",\n  \"14\": \"MultiSafepay Pagamento sospeso\",\n  \"20\": \"Rimborso parziale\",\n  \"23\": \"In attesa di pagamento\",\n  \"24\": \"Rimborso parziale\",\n  \"25\": \"Pagamento parziale\",\n  \"27\": \"Annullato per mancato pagamento\",\n  \"28\": \"IN TRANSITO - LINK DI TRACCIAMENTO INVIATO\",\n  \"29\": \"Consegnato Parzialmente\",\n  \"30\": \"In attesa emissione buono o rimborso\",\n  \"31\": \"In Consegna\",\n  \"32\": \"Richiesta reso da cliente\",\n  \"35\": \"DESTINATARIO ASSENTE\"\n};\n\n// Funzione helper per rimuovere campi da un oggetto\nfunction removeFields(obj, fieldsToRemove) {\n  const newObj = { ...obj };\n  fieldsToRemove.forEach(field => {\n    delete newObj[field];\n  });\n  return newObj;\n}\n\n// Processa l''input\nconst processedItems = [];\n\nfor (const item of $input.all()) {\n  let data = item.json;\n  \n  // Verifica se data √® un array o un oggetto singolo\n  const isArray = Array.isArray(data);\n  if (!isArray) {\n    data = [data];\n  }\n  \n  // La struttura √® un array di oggetti separati, quindi li processiamo tutti\n  const processedData = [];\n  \n  // Processa ogni elemento nell''array\n  for (const element of data) {\n    let processedElement = {};\n    \n    // 1. Se l''elemento contiene orderDetails\n    if (element.orderDetails) {\n      // RIMUOVI SOLO: campi tecnici, valori sempre 0, campi vuoti non utili\n      const orderFieldsToRemove = [\n        ''id_currency'',           // tecnico\n        ''id_lang'',              // tecnico\n        ''id_carrier'',           // tecnico (il nome carrier √® pi√π utile)\n        ''module'',               // tecnico sistema pagamento\n        ''invoice_number'',       // sempre 0\n        ''invoice_date'',         // sempre 0000-00-00 00:00:00\n        ''delivery_number'',      // sempre 0\n        ''delivery_date'',        // sempre 0000-00-00 00:00:00\n        ''valid'',                // tecnico\n        ''id_shop_group'',        // tecnico\n        ''id_shop'',              // tecnico\n        ''secure_key'',           // tecnico sicurezza\n        ''recyclable'',           // sempre 0\n        ''gift'',                 // sempre 0\n        ''gift_message'',         // sempre vuoto\n        ''mobile_theme'',         // sempre 0\n        ''total_discounts'',      // 0.000000\n        ''total_discounts_tax_incl'',  // 0.000000\n        ''total_discounts_tax_excl'',  // 0.000000\n        ''total_shipping'',       // 0.000000\n        ''total_shipping_tax_incl'',   // 0.000000\n        ''total_shipping_tax_excl'',   // 0.000000\n        ''total_wrapping'',       // 0.000000\n        ''total_wrapping_tax_incl'',   // 0.000000\n        ''total_wrapping_tax_excl'',   // 0.000000\n        ''round_mode'',           // tecnico\n        ''round_type'',           // tecnico\n        ''conversion_rate'',      // sempre 1.000000\n        ''carrier_tax_rate''      // ridondante\n      ];\n      \n      if (element.orderFound !== undefined) {\n        processedElement.orderFound = element.orderFound;\n      }\n      processedElement.orderDetails = removeFields(element.orderDetails, orderFieldsToRemove);\n      \n      // Sostituisci il current_state con la descrizione testuale\n      if (processedElement.orderDetails.current_state) {\n        const stateCode = processedElement.orderDetails.current_state;\n        processedElement.orderDetails.current_state = orderStateMap[stateCode] || `Stato sconosciuto (${stateCode})`;\n      }\n      \n      // Processa order_rows nei prodotti\n      if (element.orderDetails.associations && element.orderDetails.associations.order_rows) {\n        const orderRowsFieldsToRemove = [\n          ''product_attribute_id'',  // sempre 0\n          ''product_isbn'',         // sempre vuoto\n          ''product_upc'',          // sempre vuoto\n          ''id_customization'',     // sempre 0\n          ''unit_price_tax_excl''   // ridondante con product_price\n        ];\n        \n        processedElement.orderDetails.associations = {\n          order_rows: element.orderDetails.associations.order_rows.map(row => \n            removeFields(row, orderRowsFieldsToRemove)\n          )\n        };\n      }\n    }\n    \n    // 2. Se l''elemento contiene order_histories\n    else if (element.order_histories) {\n      processedElement.order_histories = element.order_histories.map(history => {\n        // Crea una copia dell''oggetto history\n        let processedHistory = { ...history };\n        \n        // Sostituisci id_order_state con la descrizione testuale\n        if (processedHistory.id_order_state) {\n          const stateCode = processedHistory.id_order_state;\n          processedHistory.id_order_state = orderStateMap[stateCode] || `Stato sconosciuto (${stateCode})`;\n        }\n        \n        // Rimuovi id_employee SOLO se √® \"0\"\n        if (processedHistory.id_employee === \"0\") {\n          delete processedHistory.id_employee;\n        }\n        \n        return processedHistory;\n      });\n    }\n    \n    // 3. Se l''elemento contiene customer\n    else if (element.customer) {\n      const customerFieldsToRemove = [\n        ''id_default_group'',      // tecnico\n        ''id_lang'',              // tecnico\n        ''newsletter_date_add'',   // 0000-00-00\n        ''ip_registration_newsletter'',  // vuoto\n        ''last_passwd_gen'',       // tecnico sicurezza\n        ''secure_key'',           // tecnico sicurezza\n        ''deleted'',              // sempre 0\n        ''passwd'',               // password hash - sensibile!\n        ''id_gender'',            // codice genere\n        ''birthday'',             // 0000-00-00\n        ''newsletter'',           // 0\n        ''optin'',               // 0\n        ''website'',             // vuoto\n        ''company'',             // vuoto\n        ''siret'',               // vuoto\n        ''ape'',                 // vuoto\n        ''outstanding_allow_amount'',  // 0.000000\n        ''show_public_prices'',   // 0\n        ''id_risk'',             // 0\n        ''max_payment_days'',    // 0\n        ''note'',                // vuoto\n        ''is_guest'',            // tecnico\n        ''id_shop'',             // tecnico\n        ''id_shop_group'',       // tecnico\n        ''reset_password_token'', // vuoto\n        ''reset_password_validity'',  // 0000-00-00\n        ''associations''          // gruppi tecnici\n      ];\n      \n      processedElement.customer = removeFields(element.customer, customerFieldsToRemove);\n    }\n    \n    // 4. Se l''elemento contiene address\n    else if (element.address) {\n      const addressFieldsToRemove = [\n        ''id_manufacturer'',      // sempre 0\n        ''id_supplier'',         // sempre 0\n        ''id_warehouse'',        // sempre 0\n        ''id_state'',            // codice stato (manteniamo paese)\n        ''company'',             // vuoto\n        ''vat_number'',          // vuoto\n        ''address2'',            // vuoto\n        ''other'',               // vuoto\n        ''phone_mobile'',        // vuoto\n        ''deleted''              // sempre 0\n      ];\n      \n      processedElement.address = removeFields(element.address, addressFieldsToRemove);\n    }\n    \n    // Se non √® nessuno dei casi sopra, mantieni l''elemento com''√®\n    else {\n      processedElement = element;\n    }\n    \n    processedData.push(processedElement);\n  }\n  \n  // Restituisci i dati processati \n  // Se l''input originale era un array, lo avvolgiamo in un oggetto\n  // Se era un oggetto singolo, restituiamo il primo elemento processato\n  if (isArray) {\n    processedItems.push({\n      json: { \n        data: processedData \n      }\n    });\n  } else {\n    processedItems.push({\n      json: processedData[0]\n    });\n  }\n}\n\nreturn processedItems;"},{"parameters":{"jsCode":"const raw = $json.query || '''';\n\nconst cleaned = typeof raw === ''string''\n  ? raw.replace(/[^a-zA-Z0-9]/g, '''').trim()\n  : '''';\n\nreturn [{\n  json: {\n    query: cleaned\n  }\n}];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-1580,880],"id":"5d2b13dd-f63f-4b80-8451-39a0badcf894","name":"Pulisci codice"},{"parameters":{"inputSource":"jsonExample","jsonExample":"{\n  \"query\": \"WDSLMTPUF\"\n}"},"type":"n8n-nodes-base.executeWorkflowTrigger","typeVersion":1.1,"position":[-1820,880],"id":"e4036c07-c756-4120-a92e-42618d971115","name":"When Executed by Another Workflow"}]', '{"Ottieni Ordine":{"main":[[{"node":"Verifica ordine","type":"main","index":0}]]},"IF":{"main":[[{"node":"Ottieni Cliente","type":"main","index":0},{"node":"Ottieni Indirizzo Spedizione","type":"main","index":0},{"node":"Ottieni Storico Ordine","type":"main","index":0},{"node":"Merge1","type":"main","index":0}],[{"node":"Risposta Ordine Non Trovato","type":"main","index":0}]]},"Ottieni Cliente":{"main":[[{"node":"Merge1","type":"main","index":2}]]},"Ottieni Indirizzo Spedizione":{"main":[[{"node":"Merge1","type":"main","index":3}]]},"Risposta Ordine Non Trovato":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Verifica ordine":{"main":[[{"node":"IF","type":"main","index":0}]]},"Ottieni Storico Ordine":{"main":[[{"node":"Merge1","type":"main","index":1}]]},"Merge1":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Merge":{"main":[[{"node":"Pulisci campi","type":"main","index":0}]]},"Pulisci codice":{"main":[[{"node":"Ottieni Ordine","type":"main","index":0}]]},"When Executed by Another Workflow":{"main":[[{"node":"Pulisci codice","type":"main","index":0}]]}}', '{"executionOrder":"v1"}', NULL, '{}', '316dbca1-5f4c-4636-a56d-3d7ac406d2ad', 0, '{"templateCredsSetupCompleted":true}', NULL, '2025-05-23T06:23:00.903Z', '2025-06-13T18:08:37.000Z', false),
  ('b8084492-17db-4ddd-afb5-d263cfb06378', 'CHATBOT_MILENA_V1 _EXPERIMENT', false, '[{"parameters":{"workflowId":{"__rl":true,"value":"el9CwyiWMEpfLfFH","mode":"list","cachedResultName":"CHATBOT COMMERCIALE"},"workflowInputs":{"mappingMode":"defineBelow","value":{},"matchingColumns":[],"schema":[],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[-1440,-280],"id":"2ec320ad-b141-4592-9f60-9078b68dd3b0","name":"COMMERCIALE"},{"parameters":{"workflowId":{"__rl":true,"value":"el9CwyiWMEpfLfFH","mode":"list","cachedResultName":"CHATBOT COMMERCIALE"},"workflowInputs":{"mappingMode":"defineBelow","value":{},"matchingColumns":[],"schema":[],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[-1440,-40],"id":"d3e2f6c2-9bc1-4668-ba66-a87ed75840c6","name":"AMMINISTRAZIONE"},{"parameters":{"description":"[INTENT: info_ordini]\n\nTOOL NAME: INFO ORDINI\n\nFunzione:  \nGestisce tutte le richieste relative a ordini gi√† effettuati dal cliente, inclusa la tracciabilit√† della spedizione.\n\nUtilizzato quando il cliente chiede:\n- Quali prodotti ha acquistato\n- Quando √® stato effettuato l‚Äôordine\n- Lo stato dell‚Äôelaborazione (confermato, in lavorazione, spedito)\n- Dove si trova il pacco / tracking della spedizione\n- Qual √® il corriere\n- Quando verr√† consegnato\n\nRequisiti:\n- Il cliente deve fornire un **codice ordine** (es. WDSLMTPUF)\n- Se l‚Äôidentit√† del cliente non √® confermata, √® necessaria la **verifica via email**\n\nFunzionamento:\n1. Recupera l‚ÄôID numerico interno con `GET_ID`\n2. Usa `GET_DETAIL` per ottenere:\n   - prodotti acquistati\n   - data ordine\n   - shipping_number (per tracking)\n3. Se necessario, usa `GET_CUSTOMER` per verificare l‚Äôemail\n4. Se il cliente chiede informazioni sulla **spedizione**, usa il `shipping_number` con il `ParcelsApp Tool` per:\n   - posizione del pacco\n   - corriere utilizzato\n   - stato attuale e ultimi eventi\n   - data prevista o avvenuta di consegna\n\nOutput:\nRisposta testuale chiara, in italiano, con informazioni sull‚Äôordine e/o tracking, firmata da Milena.\n\n‚ö†Ô∏è Da usare **solo per ordini gi√† effettuati**.\nPer richieste su acquisti futuri, misure pneumatici o disponibilit√†, usare il tool `COMMERCIALE`.","workflowId":{"__rl":true,"value":"djG3L8jYB8VwpDZV","mode":"list","cachedResultName":"SUB_CHATBOT_API_TRACK_OK"},"workflowInputs":{"mappingMode":"defineBelow","value":{},"matchingColumns":["query"],"schema":[{"id":"query","displayName":"query","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[-1440,-520],"id":"26a439eb-a11a-473b-b807-38210cc8d9eb","name":"INFO ORDE"},{"parameters":{"public":true,"initialMessages":"Salveüëã\nIl mio nome √® Milena come posso aiutarla oggi?","options":{}},"id":"ff412977-78a8-458e-830a-b1ba4934a390","name":"When chat message received","type":"@n8n/n8n-nodes-langchain.chatTrigger","typeVersion":1.1,"position":[0,0],"webhookId":"5120b839-52aa-4471-ba52-4ff3a76497e2","notes":"## üöÄ TRIGGER PRINCIPALE\n\n**FUNZIONE**: Punto di ingresso per tutte le conversazioni chat con Milena\n\n**CARATTERISTICHE**:\n- Webhook pubblico attivo 24/7\n- Messaggio iniziale: \"Salveüëã Il mio nome √® Milena come posso aiutarla oggi?\"\n- Genera automaticamente sessionId unico per ogni conversazione\n- Cattura chatInput dell''utente\n\n**OUTPUT**:\n- `sessionId`: Identificativo univoco conversazione\n- `chatInput`: Messaggio dell''utente da processare\n\n**NOTA**: Questo √® l''unico punto di ingresso per il sistema Milena. Ogni messaggio del cliente passa da qui."},{"parameters":{"assignments":{"assignments":[{"id":"0b0b9a1b-c761-4f68-8911-549f2cde7835","name":"sessionId","value":"={{ $json.sessionId }}","type":"string"},{"id":"c1f0c5f4-c254-4a35-a42d-23a98cc86cf7","name":"chatInput","value":"={{ $json.chatInput }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[220,0],"id":"31a8a0ba-64cd-4172-a7db-40e81853a134","name":"Chat ID persisente","notes":"## üìã PERSISTENZA SESSIONE\n\n**FUNZIONE**: Estrae e preserva i dati essenziali della conversazione\n\n**ESTRAZIONE**:\n- `sessionId`: ID univoco per tracking conversazione\n- `chatInput`: Messaggio pulito dell''utente\n\n**IMPORTANZA**:\n- Garantisce continuit√† della conversazione\n- Permette il collegamento tra messaggi multipli\n- Essenziale per memoria conversazionale e analytics\n\n**UTILIZZO**: Ogni nodo successivo pu√≤ accedere a questi dati tramite `$(''Chat ID persisente'').item.json.sessionId`"},{"parameters":{"assignments":{"assignments":[{"id":"chat_timestamp","name":"chat_timestamp","value":"={{ new Date().toISOString() }}","type":"string"},{"id":"user_input","name":"user_input","value":"={{ $json.chatInput }}","type":"string"},{"id":"session_id","name":"session_id","value":"={{ $json.sessionId }}","type":"string"},{"id":"conversation_step","name":"conversation_step","value":"input_received","type":"string"},{"id":"channel_source","name":"channel_source","value":"chat_web","type":"string"},{"id":"sessionId","name":"sessionId","value":"={{ $json.sessionId }}","type":"string"},{"id":"chatInput","name":"chatInput","value":"={{ $json.chatInput }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[440,0],"id":"33302ec6-173b-4b49-81a6-65ed3cac5ee5","name":"Chat Logger","notes":"## üìù LOGGING STRUTTURATO INPUT\n\n**FUNZIONE**: Standardizza e arricchisce i dati in ingresso per il sistema di analytics\n\n**CAMPI GENERATI**:\n- `chat_timestamp`: Timestamp ISO preciso ricezione messaggio\n- `user_input`: Input utente normalizzato\n- `session_id`: ID sessione per correlazione dati\n- `conversation_step`: \"input_received\" - fase corrente\n- `channel_source`: \"chat_web\" - canale di provenienza\n\n**SCOPO ANALYTICS**:\n- Permette analisi temporali precise\n- Facilita correlazione tra messaggi della stessa sessione\n- Base per calcolo tempi di risposta\n- Tracciabilit√† completa conversazioni\n\n**NOTA**: Questo √® il primo step del sistema di logging. Tutti i dati vengono standardizzati qui per processing successivo."},{"parameters":{"jsCode":"// Intent Classification per richieste clienti GommeGo\nconst userInput = $input.first().json.user_input?.toLowerCase() || '''';\n\n// Definizione pattern di intenti\nconst intentPatterns = {\n  tracking: [\n    ''ordine'', ''spedizione'', ''tracking'', ''consegna'', ''pacco'', ''corriere'',\n    ''ritardo'', ''dove'', ''quando'', ''arriva'', ''stato'', ''fermo'', ''bloccato'',\n    ''giacenza'', ''deposito'', ''non si muove'', ''non arriva''\n  ],\n  commerciale: [\n    ''pneumatico'', ''gomma'', ''gomme'', ''cerchio'', ''cerchi'', ''misura'',\n    ''prezzo'', ''costo'', ''disponibile'', ''comprare'', ''acquistare'',\n    ''stagionale'', ''invernale'', ''estivo'', ''quattro stagioni'', ''budget'',\n    ''qualit√†'', ''premium'', ''marca'', ''brand''\n  ],\n  amministrativo: [\n    ''fattura'', ''ricevuta'', ''documento'', ''contabile'', ''iva'',\n    ''nota di credito'', ''rimborso'', ''pagamento'', ''carta'', ''bonifico''\n  ],\n  supporto: [\n    ''problema'', ''aiuto'', ''assistenza'', ''reclamo'', ''lamentela'',\n    ''non funziona'', ''errore'', ''sbagliato'', ''difettoso''\n  ],\n  informazioni: [\n    ''info'', ''informazioni'', ''policy'', ''garanzia'', ''reso'', ''resi'',\n    ''condizioni'', ''termini'', ''dot'', ''pfu'', ''spese''\n  ]\n};\n\n// Funzione di classificazione\nfunction classifyIntent(input) {\n  const scores = {};\n  \n  // Calcola score per ogni intento\n  for (const [intent, patterns] of Object.entries(intentPatterns)) {\n    scores[intent] = 0;\n    \n    patterns.forEach(pattern => {\n      if (input.includes(pattern)) {\n        scores[intent] += 1;\n      }\n    });\n  }\n  \n  // Trova l''intento con score pi√π alto\n  const maxScore = Math.max(...Object.values(scores));\n  const detectedIntent = Object.keys(scores).find(key => scores[key] === maxScore);\n  \n  // Se nessun pattern match, classifica come \"generico\"\n  return maxScore > 0 ? detectedIntent : ''generico'';\n}\n\n// Classifica l''intento\nconst intent = classifyIntent(userInput);\nconst confidence = Math.min(1.0, Math.max(0.1, userInput.length / 50)); // Confidence basata su lunghezza\n\n// Estrazione entit√† base\nconst entities = {\n  hasOrderCode: /[A-Z0-9]{8,12}/.test(userInput),\n  hasMeasure: /\\d{3}\\/\\d{2}\\s*R?\\d{2}/.test(userInput),\n  hasEmail: /@/.test(userInput),\n  hasPhone: /\\+?\\d{10,}/.test(userInput)\n};\n\n// Mantieni tutti i dati precedenti + aggiungi classificazione\nconst inputData = $input.first().json;\n\nreturn {\n  ...inputData,\n  intent_detected: intent,\n  intent_confidence: confidence,\n  entities_extracted: entities,\n  classification_timestamp: new Date().toISOString()\n};"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[660,0],"id":"444d13a9-8a19-43a4-a570-c8bc3f6ded76","name":"Intent Classifier","notes":"## üéØ CLASSIFICAZIONE INTENTI AUTOMATICA\n\n**FUNZIONE**: Classifica automaticamente l''intento del messaggio cliente per analytics e routing\n\n**CATEGORIE RILEVATE**:\n- **tracking**: ordini, spedizioni, tracking, consegne, ritardi\n- **commerciale**: pneumatici, gomme, prezzi, acquisti, misure\n- **amministrativo**: fatture, rimborsi, pagamenti, documenti\n- **supporto**: problemi, reclami, assistenza, errori\n- **informazioni**: policy, garanzie, resi, condizioni\n- **generico**: se nessun pattern riconosciuto\n\n**OUTPUT**:\n- `intent_detected`: Categoria classificata\n- `intent_confidence`: Score di confidenza (0-1)\n- `entities_extracted`: Entit√† rilevate (codici ordine, misure, email, telefoni)\n\n**UTILIZZO**:\n- Analytics sui tipi di richiesta pi√π comuni\n- Routing intelligente per sistemi futuri\n- Training data per ML\n- Business intelligence sui clienti\n\n**NOTA**: 90% delle richieste sono \"tracking\" - ottimizzato per questo scenario"},{"parameters":{"jsCode":"// Sentiment Analysis per messaggi clienti\nconst userInput = $input.first().json.user_input?.toLowerCase() || '''';\n\n// Pattern per sentiment negativo\nconst negativePatterns = [\n  ''problema'', ''errore'', ''sbagliato'', ''non funziona'', ''difettoso'',\n  ''arrabbiato'', ''deluso'', ''insoddisfatto'', ''lamentela'', ''reclamo'',\n  ''pessimo'', ''terribile'', ''orribile'', ''inaccettabile'', ''vergognoso'',\n  ''ritardo'', ''lento'', ''bloccato'', ''fermo'', ''non arriva'', ''perso'',\n  ''urgente'', ''subito'', ''immediato'', ''presto'', ''veloce''\n];\n\n// Pattern per sentiment positivo\nconst positivePatterns = [\n  ''grazie'', ''perfetto'', ''ottimo'', ''bene'', ''buono'', ''soddisfatto'',\n  ''contento'', ''felice'', ''eccellente'', ''bravo'', ''complimenti'',\n  ''veloce'', ''rapido'', ''efficiente'', ''professionale''\n];\n\n// Pattern per urgenza\nconst urgencyPatterns = [\n  ''urgente'', ''subito'', ''immediato'', ''presto'', ''velocemente'',\n  ''importante'', ''critico'', ''necessario'', ''bisogno'', ''serve''\n];\n\n// Pattern per frustrazione\nconst frustrationPatterns = [\n  ''non capisco'', ''cosa succede'', ''che significa'', ''perch√©'',\n  ''da giorni'', ''da settimane'', ''sempre'', ''mai'', ''ennesima volta'',\n  ''basta'', ''stop'', ''fine''\n];\n\n// Calcola sentiment scores\nfunction calculateSentiment(input) {\n  let negativeScore = 0;\n  let positiveScore = 0;\n  let urgencyScore = 0;\n  let frustrationScore = 0;\n  \n  // Conta pattern negativi\n  negativePatterns.forEach(pattern => {\n    if (input.includes(pattern)) negativeScore++;\n  });\n  \n  // Conta pattern positivi\n  positivePatterns.forEach(pattern => {\n    if (input.includes(pattern)) positiveScore++;\n  });\n  \n  // Conta pattern di urgenza\n  urgencyPatterns.forEach(pattern => {\n    if (input.includes(pattern)) urgencyScore++;\n  });\n  \n  // Conta pattern di frustrazione\n  frustrationPatterns.forEach(pattern => {\n    if (input.includes(pattern)) frustrationScore++;\n  });\n  \n  // Determina sentiment finale\n  let sentiment = ''neutral'';\n  let intensity = ''low'';\n  \n  if (negativeScore > positiveScore) {\n    sentiment = ''negative'';\n    intensity = negativeScore >= 3 ? ''high'' : negativeScore >= 2 ? ''medium'' : ''low'';\n  } else if (positiveScore > negativeScore) {\n    sentiment = ''positive'';\n    intensity = positiveScore >= 2 ? ''high'' : ''medium'';\n  }\n  \n  // Calcola score complessivo (-1 a +1)\n  const totalScore = (positiveScore - negativeScore) / Math.max(1, positiveScore + negativeScore);\n  \n  return {\n    sentiment: sentiment,\n    intensity: intensity,\n    score: isNaN(totalScore) ? 0 : totalScore,\n    urgency_level: urgencyScore >= 2 ? ''high'' : urgencyScore >= 1 ? ''medium'' : ''low'',\n    frustration_level: frustrationScore >= 2 ? ''high'' : frustrationScore >= 1 ? ''medium'' : ''low'',\n    positive_signals: positiveScore,\n    negative_signals: negativeScore,\n    urgency_signals: urgencyScore,\n    frustration_signals: frustrationScore\n  };\n}\n\n// Analizza il sentiment\nconst sentimentAnalysis = calculateSentiment(userInput);\n\n// Mantieni tutti i dati precedenti + aggiungi sentiment\nconst inputData = $input.first().json;\n\nreturn {\n  ...inputData,\n  sentiment_analysis: sentimentAnalysis,\n  sentiment_timestamp: new Date().toISOString()\n};"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[880,0],"id":"f8bd565a-89ca-400d-9183-4d17c468ae59","name":"Sentiment Analyzer","notes":"## üòä ANALISI SENTIMENT E UMORE CLIENTE\n\n**FUNZIONE**: Analizza il tono emotivo del cliente per identificare criticit√† e priorit√†\n\n**METRICHE RILEVATE**:\n- **Sentiment**: positive/negative/neutral\n- **Intensity**: low/medium/high\n- **Score**: Da -1 (molto negativo) a +1 (molto positivo)\n- **Urgency Level**: Quanto urgente percepisce la richiesta\n- **Frustration Level**: Livello di frustrazione rilevato\n\n**PATTERN RICONOSCIUTI**:\n- **Negativi**: problema, errore, ritardo, bloccato, terribile\n- **Positivi**: grazie, ottimo, soddisfatto, bravo\n- **Urgenza**: urgente, subito, immediato, importante\n- **Frustrazione**: non capisco, da giorni, ennesima volta, basta\n\n**UTILIZZO**:\n- **Alert automatici** per clienti molto frustrati\n- **Prioritizzazione** delle richieste urgenti\n- **Quality assurance** - monitoring soddisfazione\n- **Training data** per migliorare risposte\n\n**NOTA**: Clienti con sentiment molto negativo attivano il sistema di monitoring alert"},{"parameters":{"schema":{"__rl":true,"value":"public","mode":"list"},"table":{"__rl":true,"value":"chat_interactions","mode":"list"},"columns":{"mappingMode":"defineBelow","value":{"session_id":"={{ $json.session_id }}","timestamp":"={{ $json.chat_timestamp }}","user_input":"={{ $json.user_input }}","intent_detected":"={{ $json.intent_detected }}","intent_confidence":"={{ $json.intent_confidence }}","sentiment":"={{ $json.sentiment_analysis.sentiment }}","sentiment_score":"={{ $json.sentiment_analysis.score }}","urgency_level":"={{ $json.sentiment_analysis.urgency_level }}","frustration_level":"={{ $json.sentiment_analysis.frustration_level }}","entities_extracted":"={{ JSON.stringify($json.entities_extracted) }}","channel_source":"={{ $json.channel_source }}","conversation_step":"={{ $json.conversation_step }}","id":0,"response_time_ms":0,"response_time_seconds":0,"total_tools_used":0,"confidence_score":0,"response_word_count":0},"matchingColumns":["id"],"schema":[{"id":"id","displayName":"id","required":false,"defaultMatch":true,"display":true,"type":"number","canBeUsedToMatch":true,"removed":false},{"id":"session_id","displayName":"session_id","required":true,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"timestamp","displayName":"timestamp","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":true},{"id":"conversation_step","displayName":"conversation_step","required":true,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"user_input","displayName":"user_input","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"agent_response","displayName":"agent_response","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"intent_detected","displayName":"intent_detected","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"intent_confidence","displayName":"intent_confidence","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true},{"id":"sentiment","displayName":"sentiment","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"sentiment_score","displayName":"sentiment_score","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true},{"id":"urgency_level","displayName":"urgency_level","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"frustration_level","displayName":"frustration_level","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"entities_extracted","displayName":"entities_extracted","required":false,"defaultMatch":false,"display":true,"type":"object","canBeUsedToMatch":true},{"id":"tools_used","displayName":"tools_used","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"response_time_ms","displayName":"response_time_ms","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true,"removed":false},{"id":"response_time_seconds","displayName":"response_time_seconds","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true,"removed":false},{"id":"total_tools_used","displayName":"total_tools_used","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true,"removed":false},{"id":"confidence_score","displayName":"confidence_score","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true,"removed":false},{"id":"anomalies_detected","displayName":"anomalies_detected","required":false,"defaultMatch":false,"display":true,"type":"object","canBeUsedToMatch":true,"removed":false},{"id":"channel_source","displayName":"channel_source","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"response_word_count","displayName":"response_word_count","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true,"removed":false},{"id":"response_timestamp","displayName":"response_timestamp","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":true,"removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.4,"position":[2460,-440],"id":"fa9114a4-cae5-47dd-ab1d-0d1242c5ac5c","name":"Save Chat Input","credentials":{"postgres":{"id":"3JqN7cnp8K5WZ58E","name":"Postgres account"}},"notes":"## üíæ PERSISTENZA INPUT UTENTE\n\n**FUNZIONE**: Salva l''input dell''utente con tutte le classificazioni nel database per analytics\n\n**TABELLA**: `chat_interactions`\n\n**DATI SALVATI**:\n- Identificativi: session_id, timestamp\n- Contenuto: user_input (messaggio originale)\n- Classificazioni: intent_detected, intent_confidence\n- Sentiment: sentiment, sentiment_score, urgency_level, frustration_level\n- Entit√†: entities_extracted (JSON), channel_source\n- Processo: conversation_step (\"input_received\")\n\n**SCOPO**:\n- **Tracciabilit√† completa** di ogni messaggio ricevuto\n- **Base dati** per analytics e ML\n- **Audit trail** per compliance\n- **Correlazione** con risposte successive\n\n**IMPORTANTE**: Questo √® il primo INSERT nel database. Crea il record che verr√† aggiornato dai nodi successivi con la risposta.\n\n**CREDENZIALI**: Usa account PostgreSQL condiviso per tutto il sistema"},{"parameters":{"model":"gpt-4o","options":{}},"id":"6eed0a60-f710-4e97-b3ae-e7bb3e73aee0","name":"OpenAI Chat Model","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1,"position":[1320,220],"credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}},"notes":"## üß† MODELLO LINGUISTICO PRINCIPALE\n\n**FUNZIONE**: Chat Model principale per l''agente MILENA DISPATCHER\n\n**CONFIGURAZIONE**:\n- **Modello**: GPT-4o (pi√π potente per reasoning complesso)\n- **Uso**: Elaborazione principale delle richieste\n- **Connessione**: Si collega all''agente LangChain\n\n**CARATTERISTICHE**:\n- Gestisce logica conversazionale complessa\n- Integra informazioni da multiple fonti\n- Applica personalit√† e tone of voice di Milena\n- Coordina l''uso dei tool disponibili\n\n**DIFFERENZA con OpenAI Chat Model1**:\n- Questo √® per il **dispatcher principale**\n- Model1 √® per il **vector store** (operazioni pi√π semplici)\n\n**CREDENZIALI**: Account OpenAI condiviso - monitorare usage per costi"},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4o-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[1752,420],"id":"4dd51c32-d6f6-41fc-b405-ee7145db8f09","name":"OpenAI Chat Model1","credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}},"notes":"## üß† MODELLO LINGUISTICO VECTOR STORE\n\n**FUNZIONE**: Chat Model dedicato esclusivamente al Vector Store per ricerche FAQ\n\n**CONFIGURAZIONE**:\n- **Modello**: GPT-4o-mini (pi√π economico, sufficiente per vector search)\n- **Uso**: Solo per elaborazione query verso vector store\n- **Ottimizzazione**: Riduce costi per operazioni semplici\n\n**PERCH√â SEPARATO**:\n- Vector store richiede elaborazione meno complessa\n- GPT-4o-mini costa meno per operazioni ripetitive\n- Permette scaling indipendente delle funzioni\n\n**COLLEGAMENTO**: Esclusivamente al nodo \"Answer questions with a vector store\"\n\n**CREDENZIALI**: Stesso account OpenAI ma model diverso per ottimizzazione costi"},{"parameters":{"description":"**KNOWLEDGE BASE UFFICIALE GOMMEGO - CONSULTAZIONE OBBLIGATORIA**\n\nQuesto nodo contiene l''intero database di conoscenza aziendale GommeGo: FAQ ufficiali, procedure operative, policy sui prodotti, stati degli ordini, termini dei corrieri, informazioni legali e regole comportamentali di Milena.\n\n**CONTENUTO ESSENZIALE:**\n- FAQ su tracking, spedizioni, DOT, resi, pagamenti\n- Spiegazioni dettagliate di tutti gli stati ordine PrestaShop\n- Policy aziendali ufficiali (DOT 12-14 mesi, procedure resi, etc.)\n- Messaggi rassicuranti pre-approvati per ogni situazione\n- Termini tecnici dei corrieri e loro significato\n- Regole comportamentali e tone of voice aziendale\n\n**USO OBBLIGATORIO:**\nConsulta SEMPRE questo nodo per PRIMO prima di qualsiasi risposta. Contiene le informazioni contestuali essenziali per fornire risposte accurate, coerenti con le policy GommeGo e con il giusto tone rassicurante. Senza questa consultazione, le risposte saranno incomplete e non allineate agli standard aziendali.\n\n**QUANDO USARLO:**\n- Prima interrogazione: input completo dell''utente\n- Seconda interrogazione: dati ottenuti da altri tool per arricchimento\n\nFonte autorevole per essere Milena esperta di GommeGo.","topK":5},"type":"@n8n/n8n-nodes-langchain.toolVectorStore","typeVersion":1.1,"position":[1560,222.5],"id":"f58670fd-3b19-448b-85d8-6e6f6e6f1a90","name":"Answer questions with a vector store","notes":"## üìö KNOWLEDGE BASE UFFICIALE GOMMEGO\n\n**FUNZIONE**: Accesso al database completo di conoscenza aziendale\n\n**CONTENUTO ESSENZIALE**:\n- **FAQ complete**: tracking, spedizioni, DOT, resi, pagamenti\n- **Stati ordine**: Spiegazioni dettagliate di tutti gli stati PrestaShop\n- **Policy aziendali**: DOT 12-14 mesi, procedure resi ufficiali\n- **Messaggi rassicuranti**: Template pre-approvati per ogni situazione\n- **Terminologia corrieri**: Significato di ogni stato di tracking\n- **Regole comportamentali**: Tone of voice e procedure Milena\n\n**USO OBBLIGATORIO**:\n- **PRIMO tool** consultato per ogni richiesta\n- Contiene informazioni contestuali essenziali\n- Base per risposte accurate e coerenti\n- Fonte autorevole per essere Milena esperta\n\n**CONFIGURAZIONE**:\n- **topK**: 5 risultati pi√π rilevanti\n- **Vector Store**: Qdrant collection \"Double\"\n- **LLM**: GPT-4o-mini dedicato\n\n**IMPORTANTE**: Senza questo tool le risposte sono incomplete e non allineate agli standard GommeGo"},{"parameters":{"qdrantCollection":{"__rl":true,"value":"Double","mode":"list","cachedResultName":"Double"},"options":{}},"type":"@n8n/n8n-nodes-langchain.vectorStoreQdrant","typeVersion":1.1,"position":[1456,422.5],"id":"8ea2d430-5b35-4782-af66-d5e72216ccce","name":"Qdrant Vector Store","credentials":{"qdrantApi":{"id":"VEHIg9nC5Y5VeHPX","name":"QdrantApi account"}},"notes":"## üóÑÔ∏è DATABASE VETTORIALE QDRANT\n\n**FUNZIONE**: Storage vettoriale per ricerca semantica nel knowledge base\n\n**CONFIGURAZIONE**:\n- **Collection**: \"Double\" - contiene tutto il knowledge GommeGo\n- **Embeddings**: OpenAI per codifica semantica\n- **Ricerca**: Similarity search per trovare contenuti rilevanti\n\n**CONTENUTO**:\n- Documenti FAQ trasformati in embeddings\n- Policy aziendali vettorizzate\n- Procedure operative indicizzate\n- Termini tecnici e spiegazioni\n\n**PERFORMANCE**:\n- Ricerca veloce su migliaia di documenti\n- Matching semantico (non solo keyword)\n- Risultati ordinati per rilevanza\n\n**CREDENZIALI**: Account Qdrant dedicato - verificare quotas per scaling\n\n**NOTA**: Questo √® il \"cervello\" del knowledge base - contiene tutta la saggezza aziendale in formato ricercabile"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1.2,"position":[1544,620],"id":"91b6656a-71a5-4c19-9185-5f9511893b55","name":"Embeddings OpenAI2","credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}},"notes":"## üîó GENERATORE EMBEDDINGS\n\n**FUNZIONE**: Trasforma testo in vettori numerici per ricerca semantica\n\n**PROCESSO**:\n- Converte query utente in embedding vettoriale\n- Converte documenti knowledge base in embeddings\n- Permette confronto semantico (non solo parole esatte)\n\n**TECNOLOGIA**:\n- **Modello OpenAI**: text-embedding-ada-002 (standard)\n- **Dimensioni**: 1536 dimensioni per vettore\n- **Qualit√†**: Cattura significato semantico profondo\n\n**ESEMPIO**:\n- Query: \"il mio ordine √® fermo\"\n- Trova anche: \"tracking bloccato\", \"spedizione non si muove\"\n- **Semanticamente simili** anche se parole diverse\n\n**COLLEGAMENTO**: Alimenta Qdrant Vector Store per indicizzazione e ricerca\n\n**CREDENZIALI**: Account OpenAI - costo per token processati\n\n**NOTA**: Componente critico per qualit√† delle ricerche - senza embeddings buoni, ricerche mediocri"},{"parameters":{"contextWindowLength":10},"type":"@n8n/n8n-nodes-langchain.memoryPostgresChat","typeVersion":1.3,"position":[1440,220],"id":"32d09ed6-afd3-439d-af09-4ec66a9881ab","name":"Postgres Chat Memory","credentials":{"postgres":{"id":"3JqN7cnp8K5WZ58E","name":"Postgres account"}},"notes":"## üí≠ MEMORIA CONVERSAZIONALE PERSISTENTE\n\n**FUNZIONE**: Mantiene lo storico delle conversazioni per continuit√† del dialogo\n\n**CONFIGURAZIONE**:\n- **Context Window**: 10 messaggi precedenti\n- **Storage**: PostgreSQL per persistenza tra sessioni\n- **Associazione**: Per sessionId - ogni cliente ha la sua memoria\n\n**COSA RICORDA**:\n- Messaggi precedenti del cliente\n- Risposte date da Milena\n- Contesto della conversazione\n- Informazioni raccolte (nome cliente, ordini discussi, etc.)\n\n**VANTAGGI**:\n- **Continuit√†**: \"Come le avevo detto prima...\"\n- **Efficienza**: Non ri-chiedere informazioni gi√† fornite\n- **Personalizzazione**: Ricorda preferenze e storico\n- **Professionalit√†**: Conversazione fluida e naturale\n\n**EXAMPLE**:\n- Msg 1: \"Il mio ordine ABCD1234 non arriva\"\n- Msg 2: \"Quando dovrebbe arrivare?\" ‚Üí Milena ricorda l''ordine ABCD1234\n\n**CREDENZIALI**: PostgreSQL condiviso - gestisce automaticamente cleanup vecchie conversazioni"},{"parameters":{"options":{}},"type":"n8n-nodes-base.dateTimeTool","typeVersion":2,"position":[1856,220],"id":"b5ca7b87-aeb1-4b4e-8699-1c5564b0f2fa","name":"Date & Time","notes":"## ‚è∞ TOOL DATA E ORA\n\n**FUNZIONE**: Fornisce informazioni temporali precise per l''agente\n\n**CAPACIT√Ä**:\n- Data e ora corrente\n- Calcoli temporali (\"tra 3 giorni\", \"la settimana scorsa\")\n- Formattazione date in italiano\n- Fuso orario corretto per l''Italia\n\n**USO TIPICO**:\n- \"Quando √® stato effettuato l''ordine?\" ‚Üí Calcola giorni trascorsi\n- \"Entro quando dovrebbe arrivare?\" ‚Üí Stima tempi di consegna\n- \"√à un giorno lavorativo?\" ‚Üí Verifica per spedizioni\n\n**ESEMPI PRATICI**:\n- Ordine del 15 gennaio ‚Üí \"Il suo ordine √® stato effettuato 8 giorni fa\"\n- Spedizione stimata ‚Üí \"Dovrebbe arrivare entro venerd√¨\"\n- Weekend ‚Üí \"Ricordi che nel weekend i corrieri non consegnano\"\n\n**INTEGRAZIONE**: Tool disponibile per l''agente LangChain, utilizzato automaticamente quando servono riferimenti temporali\n\n**NOTA**: Essenziale per tracking ordini e gestione aspettative temporali clienti"},{"parameters":{"options":{"hl":"it"}},"type":"@n8n/n8n-nodes-langchain.toolSerpApi","typeVersion":1,"position":[1976,220],"id":"77edbab4-0c63-4ff5-b8aa-2a5ee5799df4","name":"SerpAPI","credentials":{"serpApi":{"id":"GmbGJhp2Zky9UqTX","name":"SerpAPI GommeGo"}},"notes":"## üîç RICERCA WEB GOOGLE\n\n**FUNZIONE**: Accesso a Google Search per informazioni esterne non presenti nel knowledge base\n\n**CONFIGURAZIONE**:\n- **Lingua**: Italiano (hl=it)\n- **Fonte**: Google Search Results\n- **Account**: SerpAPI GommeGo dedicato\n\n**QUANDO USATO**:\n- Informazioni su pneumatici non in catalogo\n- Verifiche su specifiche tecniche esterne\n- Ricerche su concorrenti o alternative\n- Info su misure rare o veicoli particolari\n\n**ESEMPI USO**:\n- \"Che pneumatici monta la Fiat Panda Cross 2023?\"\n- \"Quanto costa mediamente una gomma 225/45 R17?\"\n- \"Alternative al marchio Michelin per SUV?\"\n\n**LIMITAZIONI**:\n- **Non per ordini**: Mai per info su ordini esistenti\n- **Non per policy**: Knowledge base ha priorit√†\n- **Supplementare**: Solo quando knowledge base insufficiente\n\n**CREDENZIALI**: Account SerpAPI GommeGo - monitorare quotas mensili\n\n**NOTA**: Tool di \"ultima istanza\" quando knowledge interno non basta"},{"parameters":{"description":"DATI ORDINI CLIENTI - INFORMAZIONI SPECIFICHE PRESTASHOP\nQuesto nodo recupera i dettagli specifici di un ordine dal database PrestaShop utilizzando il codice ordine fornito dal cliente.\nFUNZIONE:\nEstrae dati grezzi dell''ordine: stato attuale, prodotti acquistati, indirizzo di consegna, informazioni di fatturazione, shipment_number (se disponibile), date e dettagli tecnici del processo.\nINPUT RICHIESTO:\njson{\"query\": \"CODICE_ORDINE\"}\n\nSe il codice ordine √® presente: inserire il codice esatto\nSe il codice ordine manca: {\"query\": \"\"}\n\nQUANDO USARLO:\n\nDOPO aver consultato il vector store per il contesto generale\nSolo per richieste specifiche su ordini gi√† effettuati\nPer ottenere stato, tracking number, dettagli prodotti\n\nOUTPUT:\nRestituisce dati tecnici che DEVONO essere rielaborati e spiegati al cliente in linguaggio rassicurante usando le informazioni del vector store.\nIMPORTANTE:\nI dati di questo nodo sono \"grezzi\" e vanno sempre combinati con il vector store per ottenere spiegazioni comprensibili degli stati ordine e messaggi rassicuranti appropriati.\nSolo dati specifici - il contesto e la rassicurazione vengono dal vector store.","workflowId":{"__rl":true,"value":"ZdiuN1NHeIs7gwUd","mode":"list","cachedResultName":"SUB_API_INFO_ORDER"},"workflowInputs":{"mappingMode":"defineBelow","value":{},"matchingColumns":["query"],"schema":[{"id":"query","displayName":"query","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string"}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[2096,220],"id":"9b829770-0946-4b5c-a8ea-ac4a84af0770","name":"INFO ORDINI","notes":"## üì¶ SISTEMA ORDINI PRESTASHOP\n\n**FUNZIONE**: Recupera dettagli specifici ordini dal database PrestaShop aziendale\n\n**INPUT RICHIESTO**:\n```json\n{\"query\": \"CODICE_ORDINE\"}\n```\n- Se codice presente: inserire esatto\n- Se codice manca: `{\"query\": \"\"}`\n\n**DATI ESTRATTI**:\n- **Stato ordine**: Fase attuale nel sistema\n- **Prodotti**: Pneumatici acquistati con dettagli\n- **Indirizzi**: Consegna e fatturazione\n- **Shipment_number**: Numero tracking (se disponibile)\n- **Date**: Ordine, pagamento, spedizione\n- **Dettagli tecnici**: Info complete processo\n\n**GESTIONE TRACKING CRITICA**:\n- `shipment_number` **vuoto** = CASO TIPICO ‚Üí Usa template rassicurante sui ritardi corrieri\n- `shipment_number` **presente** = Usa ParcelApp per dettagli aggiornati\n\n**WORKFLOW**:\n1. PRIMO: Consulta vector store per contesto\n2. SECONDO: Usa questo tool per dati specifici\n3. TERZO: Combina per risposta completa\n\n**IMPORTANTE**: Dati \"grezzi\" - vanno sempre spiegati con linguaggio rassicurante del vector store"},{"parameters":{"description":"\nTRACKING SPEDIZIONI - DETTAGLI CORRIERE AGGIORNATI\nQuesto nodo interroga il sistema ParcelApp per ottenere informazioni dettagliate e aggiornate sul tracking delle spedizioni in corso, fornendo lo stato attuale del pacco e dettagli specifici del corriere.\nFUNZIONE:\nRecupera dati di tracking in tempo reale: posizione attuale del pacco, ultimo aggiornamento, stato della consegna, eventuali problemi o ritardi specifici del corriere.\nQUANDO USARLO:\n\nSOLO se il campo shipment_number √® presente e popolato\nDOPO aver consultato il vector store per il contesto generale\nPer fornire dettagli specifici aggiuntivi al cliente\n\nQUANDO NON USARLO:\n\nSe shipment_number √® vuoto o null\nSe l''ordine √® ancora in fase di preparazione\nCome prima fonte di informazione sui ritardi\n\nIMPORTANTE:\nSe shipment_number √® vuoto, NON utilizzare questo nodo. Invece, spiega al cliente che i ritardi nell''aggiornamento del tracking sono normali e rassicuralo usando le informazioni del vector store sui ritardi dei corrieri.\nQuesto tool fornisce dati specifici, ma il contesto rassicurante deve sempre venire dal vector store.","workflowId":{"__rl":true,"value":"ULm0p4rsvD8rZu57","mode":"list","cachedResultName":"SUB_PARCELAPP"},"workflowInputs":{"mappingMode":"defineBelow","value":{},"matchingColumns":["query"],"schema":[{"id":"query","displayName":"query","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[2216,220],"id":"cbe86ee0-55b3-491b-88c0-0bec7c2eb7a6","name":"ParcelApp","notes":"## üöö TRACKING SPEDIZIONI REAL-TIME\n\n**FUNZIONE**: Interroga ParcelApp per dettagli aggiornati tracking corrieri\n\n**QUANDO USARLO**:\n- ‚úÖ **SOLO** se `shipment_number` presente e popolato\n- ‚úÖ **DOPO** aver consultato vector store per contesto\n- ‚úÖ Per dettagli specifici aggiuntivi al cliente\n\n**QUANDO NON USARLO**:\n- ‚ùå Se `shipment_number` √® vuoto o null\n- ‚ùå Se ordine ancora in preparazione\n- ‚ùå Come prima fonte di informazione sui ritardi\n\n**DATI FORNITI**:\n- **Posizione attuale**: Dove si trova il pacco\n- **Ultimo aggiornamento**: Quando √® stato aggiornato\n- **Stato consegna**: In transito/consegnato/problema\n- **Dettagli corriere**: Info specifiche trasportatore\n\n**FLUSSO CORRETTO**:\n1. Vector store ‚Üí Contesto generale sui ritardi tracking\n2. INFO ORDINI ‚Üí Verifica se shipment_number presente\n3. ParcelApp ‚Üí Solo se shipment_number disponibile\n4. Vector store ‚Üí Spiegazione rassicurante dei dati\n\n**IMPORTANTE**: Il contesto rassicurante deve SEMPRE venire dal vector store, questo tool fornisce solo dati tecnici"},{"parameters":{"promptType":"define","text":"={{ $(''When chat message received'').item.json.chatInput }}\n","options":{"systemMessage":"=# Milena - Assistente GommeGo\n\n**Ruolo**: Operatrice assistenza clienti con tono formale, rassicurante ed empatico.\n\n## Obiettivo Primario\n**Rassicurare sempre il cliente** con risposte **specifiche ed efficienti** - Trovare le parole giuste per lasciarlo sereno, fornendo informazioni chiare e mirate.\n\n## Comportamento Base\n- Dai sempre del \"Lei\" \n- **Analizza SUBITO** l''input: se il motivo √® chiaro, **rispondi direttamente**\n- **Chiedi SEMPRE il nome** se non disponibile nelle prime interazioni\n- Usa il nome ogni 1-2 risposte per personalizzare l''assistenza\n- Usa linguaggio semplice, diretto e rassicurante\n- **Risposte specifiche e concise** - NO relazioni epistolari\n- **Richiedi precisione**: Se domanda generica ‚Üí chiedi dettagli specifici\n- **Saluto iniziale generico**: \"Salve, sono Milena, come posso esserle utile? Potrebbe dirmi il suo nome?\"\n- **Se il motivo √® gi√† chiaro**: \"Salve, sono Milena. [Risposta diretta al problema]. Potrebbe dirmi il suo nome e [dati necessari]?\"\n\n## üö® SCENARIO PRINCIPALE (90% dei contatti)\n**RITARDI TRACKING/CONSEGNA**\nIl problema pi√π frequente: corrieri/distributori rilasciano **in ritardo** link o numeri di tracciamento.\n\n### Template Rassicurante Standard:\n*\"Pu√≤ stare completamente tranquillo. Questa situazione con il tracking √® **normalissima** e non indica alcun problema con il suo ordine. I corrieri ci aggiornano spesso con qualche giorno di ritardo, ma la sua spedizione sta procedendo regolarmente. √à una dinamica che vediamo ogni giorno.\"*\n\n### Messaggi Chiave da Trasmettere:\n- ‚úÖ \"Pu√≤ stare tranquillo/completamente sereno\"\n- ‚úÖ \"√à normalissimo/molto comune\"\n- ‚úÖ \"Il suo ordine sta procedendo perfettamente\" \n- ‚úÖ \"La sua spedizione procede regolarmente\"\n- ‚úÖ \"Ce ne prenderemo cura con priorit√†\"\n- ‚úÖ \"I corrieri aggiornano sempre **in ritardo**\"\n- ‚úÖ \"**Non c''√® alcun problema**\"\n- ‚úÖ \"Ricever√† presto l''aggiornamento\"\n## üìö CONTENUTO DEL VECTOR STORE - COSA TROVERAI\n\nIl tool `Answer questions with a vector store` contiene **TUTTO il knowledge base ufficiale GommeGo**:\n\n### üéØ **FAQ e Risposte Standard**\n- **Tracking e spedizioni**: Stati corrieri, giacenza, ritardi normali\n- **DOT e prodotti**: Policy 12-14 mesi, sostituzione gratuita se >2 anni\n- **Resi e rimborsi**: Procedure dettagliate, tempi, costi\n- **Ordini e pagamenti**: Stati sistema, modifiche, termini\n\n### üìã **Documentazione Operativa Completa**\n- **Fasi ordine**: Tutti gli stati PrestaShop e loro significato\n- **Procedure aziendali**: Come gestiamo ogni situazione\n- **Termini corrieri**: Significato di ogni stato tracking\n- **Policy ufficiali**: DOT, garanzie, responsabilit√†\n\n### üè¢ **Informazioni Aziendali**\n- **Dati societari**: TEC SRL, sede, P.IVA\n- **Configurazione legale**: Dropshipping, normative\n- **Trattamento dati**: Privacy, GDPR\n- **PFU**: Contributo ambientale obbligatorio\n\n### üîß **Regole Comportamentali**\n- **Come rispondere** in ogni situazione\n- **Tone e messaggi** rassicuranti da usare  \n- **Procedure specifiche** per ogni problema\n\n## ‚ö†Ô∏è PERCH√â IL ROUTING √à CRITICO\n\n### üö® **Senza Vector Store = Risposte Incomplete**\n- **Manchi il contesto ufficiale** GommeGo\n- **Non conosci le policy** aziendali specifiche  \n- **Rischi informazioni errate** o generiche\n- **Perdi la capacit√† di rassicurare** con autorit√†\n\n### ‚úÖ **Con Vector Store = Risposte Complete**\n- **Informazioni ufficiali** testate e approvate\n- **Contesto aziendale** per ogni situazione\n- **Messaggi rassicuranti** pre-formulati\n- **Coerenza** con le policy GommeGo\n\n### üìä **Esempio Pratico**:\n**Input**: \"Ordine FXJJDYRAK fermi da 3 giorni\"\n\n**‚ùå SENZA vector store**:\n- Risposta generica sui ritardi\n- Nessun contesto specifico GommeGo\n- Nessuna spiegazione degli stati\n\n**‚úÖ CON vector store + routing**:\n1. **Vector store**: \"ordine fermo 3 giorni\" ‚Üí FAQ su normalit√† ritardi tracking\n2. **Tool ordini**: Stato specifico \"SPEDIZIONE IN PREPARAZIONE\"  \n3. **Vector store**: \"spedizione in preparazione significato\" ‚Üí Spiegazione dettagliata\n4. **Risultato**: Risposta completa, rassicurante, con spiegazione ufficiale\n## üö® REGOLA FONDAMENTALE\n**ROUTINE OBBLIGATORIA**: \n1. **PRIMO STEP SEMPRE**: `Answer questions with a vector store`\n2. **SECONDO STEP** (se necessario): Tool specifici per dati\n3. **TERZO STEP SEMPRE**: Combina informazioni + personalizza risposta\n\n**Il vector store √® la TUA FONTE PRINCIPALE** - contiene tutto quello che serve per essere Milena esperta di GommeGo\n\n## Routing delle Richieste\n\n### üìö VECTOR STORE (SEMPRE OBBLIGATORIO)\n**USA PER OGNI INPUT**: `Answer questions with a vector store` \n- Contiene informazioni contestuali essenziali\n- Knowledge base aziendale completo\n- Base per tutte le risposte appropriate\n\n### üîç ORDINI ESISTENTI  \n**Dopo aver consultato vector store**, se necessario usa tool specifico:\n```json\n{\"query\": \"CODICE_ORDINE\"}\n```\n**Gestione Tracking Critica**: \n- Se `shipment_number` √® **vuoto** ‚Üí **CASO TIPICO**: Usa template rassicurante sui ritardi corrieri\n- Se `shipment_number` √® **presente** ‚Üí Usa ParcelApp per dettagli aggiornati\n- **Sempre** spiegare che i ritardi tracking sono **normali e frequenti**\n\n### üõí COMMERCIALE\n**Dopo vector store**, per dati prodotto specifici: PrestaShop ‚Üí SerpAPI\n\n### üìã AMMINISTRAZIONE  \n**Dopo vector store**, per documenti specifici: Tool dedicato\n\n## üîÑ WORKFLOW OBBLIGATORIO - DA SEGUIRE PER OGNI INPUT UTENTE\n\n### STEP 1: COMPRENSIONE CONTESTO\n- Analizza l''input utente per identificare:\n  - Tipo di richiesta (ordine, commerciale, amministrativa, FAQ)\n  - Dati gi√† presenti (nome, codice ordine, etc.)\n  - Urgenza/tono del messaggio\n\n### STEP 2: PRIMA INTERROGAZIONE VECTOR STORE\n**SEMPRE OBBLIGATORIO**: Consulta `Answer questions with a vector store`\n- Inserisci l''input completo dell''utente\n- **Cerca nelle FAQ** per risposte ufficiali\n- Ottieni contesto aziendale e informazioni base\n\n### STEP 3: TOOL SPECIFICO (SE NECESSARIO)\n**Solo se servono dati aggiuntivi**:\n- üîç **ORDINI**: `{\"query\": \"CODICE_ORDINE\"}`\n- üõí **COMMERCIALE**: PrestaShop ‚Üí SerpAPI\n- üìã **AMMINISTRAZIONE**: Tool dedicato\n- üöö **TRACKING**: ParcelApp (solo se `shipment_number` presente)\n\n### STEP 4: SECONDA INTERROGAZIONE VECTOR STORE\n**OBBLIGATORIA se hai usato tool specifici**:\n- Inserisci i **nuovi dati ottenuti** dal tool\n- Chiedi arricchimento del contesto\n- Ottieni spiegazioni aggiuntive per i dati specifici\n\n### STEP 5: RISPOSTA FINALE\n- Combina informazioni da entrambe le interrogazioni vector store\n- Aggiungi dati specifici dai tool\n- Applica tone rassicurante e personalizza con nome\n- Firma \"**Milena ‚Äì GommeGo**\"\n\n**‚ö†Ô∏è IMPORTANTE**: Ripeti questo workflow **COMPLETO** per ogni nuovo input utente\n\n## Regole Critiche\n- üîÑ **WORKFLOW COMPLETO**: Segui SEMPRE tutti i 5 step per ogni input\n- üö® **DUE INTERROGAZIONI VECTOR STORE**: Prima per contesto, seconda per arricchimento\n- üö® **MAI SALTARE STEP**: Ogni fase √® obbligatoria\n- ‚úÖ **EFFICIENZA**: Se motivo √® chiaro, vai diretto al problema + chiedi dati necessari\n- ‚úÖ **EXPERTISE**: Milena √® **esperta** sui ritardi tracking - 90% dei contatti\n- ‚úÖ **Priorit√† assoluta**: Rassicurare con **autorit√†** sui ritardi corrieri\n- ‚ùå Non chiedere \"come posso aiutare\" se il motivo √® gi√† evidente dall''input\n- ‚ùå Non minimizzare le preoccupazioni del cliente sui ritardi\n- ‚ùå Non inviare campi extra al tool ORDINI (solo \"query\")\n- ‚ùå Non usare ParcelApp se `shipment_number` √® vuoto\n\n## Gestione Richieste Specifiche vs Generiche\n\n### **Input con motivo CHIARO** (es. tracking, ordine, problema specifico):\n**Risposta rassicurante immediata**: \"Salve, sono Milena. [Rassicurazione immediata]. Potrebbe dirmi il suo nome e [dati necessari]?\"\n\n**Esempi**:\n- \"Ordine non si muove\" ‚Üí \"Salve, sono Milena. Pu√≤ stare tranquillo, √® molto normale che il tracking non si aggiorni subito. Potrebbe dirmi il suo nome e il codice ordine?\"\n- \"Non ho ricevuto fattura\" ‚Üí \"Salve, sono Milena. Nessun problema, risolviamo subito. Potrebbe dirmi il suo nome e il numero ordine?\"\n- \"Ritardo consegna\" ‚Üí \"Salve, sono Milena. √à una situazione normalissima, il suo ordine sta procedendo regolarmente. Potrebbe dirmi nome e codice ordine?\"\n\n### **Input GENERICO o VAGO**:\n**Richiedi chiarimento**: \"Salve, sono Milena, come posso esserle utile? Potrebbe dirmi il suo nome?\"\n\n**Esempi di richieste vaghe**:\n- \"Vorrei info\" ‚Üí \"Quale informazione le serve di preciso?\"\n- \"Ho un problema\" ‚Üí \"Pu√≤ specificarmi il tipo di problema?\"\n\n## Tone & Messaging\n**Obiettivo**: Cliente immediatamente tranquillizzato con **rassicurazione immediata**\n- **Rassicura SUBITO**: \"Pu√≤ stare tranquillo\", \"√à normalissimo\", \"Nessun problema\"\n- **Normalizza immediatamente**: \"√à molto comune\", \"Succede sempre\" \n- **Autorit√† rassicurante**: \"Posso garantirle che...\", \"√à assolutamente normale che...\"\n- **Vai dritto al punto**: evita giri di parole, rassicura e risolvi\n- **Tempistiche realistiche**: \"Entro 24-48 ore dovrebbe vedere gli aggiornamenti\"\n- **Mai confermare problemi**: Evita \"capisco la preoccupazione\", \"comprendo il disagio\"\n- Chiudi sempre: \"resto a disposizione per qualsiasi dubbio\"\n\n## Gestione Contenuto Insufficiente\n- Tool restituisce info incomplete ‚Üí Argomento noto: rispondi comunque\n- Messaggio vago ‚Üí Chiedi chiarimento (max 1 volta)\n- Nessuna risposta utile ‚Üí Chiudi gentilmente"}},"id":"8f4091de-4cc0-440d-a768-fc48a2bc5eab","name":"MILENA DISPATCHER","type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.6,"position":[1480,0],"notes":"## ü§ñ AGENTE CENTRALE MILENA\n\n**RUOLO**: Cervello principale del sistema - coordina tutti i tool e genera risposte come Milena\n\n**PERSONALIT√Ä MILENA**:\n- Operatrice assistenza clienti professionale\n- Tono formale, rassicurante ed empatico\n- Sempre del \"Lei\" con i clienti\n- Esperta di tracking e problemi spedizioni (90% casi)\n\n**WORKFLOW OBBLIGATORIO**:\n1. **Vector Store PRIMO** ‚Üí Contesto e FAQ\n2. **Tool specifici** ‚Üí Dati aggiuntivi se necessari\n3. **Vector Store SECONDO** ‚Üí Arricchimento contesto\n4. **Risposta finale** ‚Üí Combinazione + personalizzazione\n\n**OBIETTIVO PRIMARIO**: \n**Rassicurare sempre il cliente** con risposte specifiche ed efficienti\n\n**TEMPLATE RASSICURANTE STANDARD**:\n\"Pu√≤ stare completamente tranquillo. Questa situazione con il tracking √® normalissima e non indica alcun problema con il suo ordine.\"\n\n**STRUMENTI DISPONIBILI**:\n- Vector Store (knowledge base)\n- INFO ORDINI (PrestaShop)\n- ParcelApp (tracking)\n- SerpAPI (ricerche web)\n- Date & Time (calcoli temporali)\n\n**FIRMA**: Ogni risposta termina con \"**Milena ‚Äì GommeGo**\""},{"parameters":{"assignments":{"assignments":[{"id":"response_timestamp","name":"response_timestamp","value":"={{ new Date().toISOString() }}","type":"string"},{"id":"agent_response","name":"agent_response","value":"={{ $json.output }}","type":"string"},{"id":"session_id","name":"session_id","value":"={{ $(''Chat Logger'').item.json.session_id }}","type":"string"},{"id":"tools_used","name":"tools_used","value":"={{ JSON.stringify($json.intermediateSteps || []) }}","type":"string"},{"id":"conversation_step","name":"conversation_step","value":"response_generated","type":"string"},{"id":"response_length","name":"response_length","value":"={{ ($json.output || '''').length }}","type":"number"},{"id":"sessionId","name":"sessionId","value":"={{ $(''Chat Logger'').item.json.sessionId }}","type":"string"},{"id":"chatInput","name":"chatInput","value":"={{ $(''Chat Logger'').item.json.chatInput }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[1940,0],"id":"d6209be7-d001-4f67-a7b6-9bab50762f92","name":"Response Logger","notes":"## üì§ LOGGING RISPOSTA AGENT\n\n**FUNZIONE**: Cattura e standardizza la risposta generata dall''agente per analytics\n\n**DATI ESTRATTI**:\n- `response_timestamp`: Momento esatto generazione risposta\n- `agent_response`: Testo completo risposta di Milena\n- `session_id`: Collegamento alla sessione conversazione\n- `tools_used`: Lista tool utilizzati dall''agente (JSON)\n- `conversation_step`: \"response_generated\" - fase processo\n- `response_length`: Lunghezza caratteri risposta\n\n**SCOPO ANALYTICS**:\n- **Performance tracking**: Quanto tempo per generare risposta\n- **Tool usage analysis**: Quali strumenti sono pi√π utilizzati\n- **Response quality**: Correlazione lunghezza/soddisfazione\n- **Audit trail**: Tracciabilit√† completa conversazioni\n\n**CALCOLI SUCCESSIVI**:\n- Tempo risposta = response_timestamp - chat_timestamp\n- Pattern tool usage per ottimizzazione\n- Analisi qualit√† risposte per training\n\n**NOTA**: Dati qui vengono processati dal Performance Tracker per metriche avanzate"},{"parameters":{"jsCode":"// Performance Tracking per interazioni Agent\nconst chatLogger = $(''Chat Logger'').item.json;\nconst startTime = new Date(chatLogger.chat_timestamp).getTime();\nconst endTime = new Date().getTime();\nconst responseTime = endTime - startTime;\n\n// Analisi tools utilizzati\nconst toolsUsed = JSON.parse($json.tools_used || ''[]'');\nconst toolNames = toolsUsed.map(step => {\n  if (step.action && step.action.tool) {\n    return step.action.tool;\n  }\n  return ''unknown'';\n}).filter(tool => tool !== ''unknown'');\n\n// Conta tool calls\nconst vectorStoreCalls = toolNames.filter(tool => tool.includes(''vector'')).length;\nconst orderInfoCalls = toolNames.filter(tool => tool.includes(''INFO ORDINI'')).length;\nconst parcelAppCalls = toolNames.filter(tool => tool.includes(''ParcelApp'')).length;\nconst serpApiCalls = toolNames.filter(tool => tool.includes(''SerpAPI'')).length;\n\n// Analisi response\nconst responseLength = $json.response_length || 0;\nconst responseWords = ($json.agent_response || '''').split('' '').length;\n\n// Calcola confidence score (euristica)\nlet confidenceScore = 0.5; // Base\nif (vectorStoreCalls > 0) confidenceScore += 0.3;\nif (orderInfoCalls > 0) confidenceScore += 0.2;\nif (responseLength > 100) confidenceScore += 0.1;\nif (responseLength > 300) confidenceScore -= 0.1; // Penalizza risposte troppo lunghe\nconfidenceScore = Math.min(1.0, Math.max(0.1, confidenceScore));\n\n// Rileva potenziali problemi\nconst anomalies = [];\nif (responseTime > 30000) anomalies.push(''slow_response'');\nif (responseLength < 50) anomalies.push(''short_response'');\nif (toolNames.length === 0) anomalies.push(''no_tools_used'');\nif (responseTime > 60000) anomalies.push(''timeout_risk'');\n\n// Performance metrics\nconst performanceMetrics = {\n  response_time_ms: responseTime,\n  response_time_seconds: Math.round(responseTime / 1000),\n  total_tools_used: toolNames.length,\n  unique_tools_used: [...new Set(toolNames)].length,\n  vector_store_calls: vectorStoreCalls,\n  order_info_calls: orderInfoCalls,\n  parcel_app_calls: parcelAppCalls,\n  serp_api_calls: serpApiCalls,\n  response_word_count: responseWords,\n  confidence_score: Math.round(confidenceScore * 100) / 100,\n  anomalies_detected: anomalies,\n  has_anomalies: anomalies.length > 0\n};\n\n// Mantieni tutti i dati precedenti\nconst inputData = $input.first().json;\n\nreturn {\n  ...inputData,\n  performance_metrics: performanceMetrics,\n  performance_timestamp: new Date().toISOString()\n};"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[2200,0],"id":"9d837760-693c-43e2-9962-3040e96f9c78","name":"Performance Tracker","notes":"## ‚ö° ANALISI PERFORMANCE AVANZATA\n\n**FUNZIONE**: Calcola metriche di performance dettagliate per ogni interazione\n\n**METRICHE CALCOLATE**:\n- **Response Time**: Millisecondi e secondi dall''input alla risposta\n- **Tool Usage**: Conteggio totale e per tipo di tool utilizzati\n- **Response Quality**: Word count, lunghezza, estructura\n- **Confidence Score**: Punteggio euristico qualit√† (0-1)\n\n**ANALISI TOOL SPECIFICHE**:\n- `vector_store_calls`: Quante volte usato knowledge base\n- `order_info_calls`: Accessi a sistema ordini\n- `parcel_app_calls`: Query tracking\n- `serp_api_calls`: Ricerche web\n\n**RILEVAMENTO ANOMALIE**:\n- ‚ö†Ô∏è `slow_response`: > 30 secondi\n- ‚ö†Ô∏è `short_response`: < 50 caratteri\n- ‚ö†Ô∏è `no_tools_used`: Nessun tool utilizzato\n- ‚ö†Ô∏è `timeout_risk`: > 60 secondi\n\n**CONFIDENCE SCORE**:\n- Base: 0.5\n- +0.3 se vector store usato\n- +0.2 se ordini consultati\n- +0.1 se risposta > 100 caratteri\n- -0.1 se risposta troppo lunga\n\n**OUTPUT**: Metriche complete per dashboard e alerting"},{"parameters":{"operation":"update","schema":{"__rl":true,"value":"public","mode":"list"},"table":{"__rl":true,"value":"chat_interactions","mode":"list"},"columns":{"mappingMode":"defineBelow","value":{"agent_response":"={{ $json.agent_response }}","tools_used":"={{ $json.tools_used }}","response_time_ms":"={{ $json.performance_metrics.response_time_ms }}","response_time_seconds":"={{ $json.performance_metrics.response_time_seconds }}","total_tools_used":"={{ $json.performance_metrics.total_tools_used }}","confidence_score":"={{ $json.performance_metrics.confidence_score }}","anomalies_detected":"={{ JSON.stringify($json.performance_metrics.anomalies_detected) }}","conversation_step":"response_generated","response_word_count":"={{ $json.performance_metrics.response_word_count }}","response_timestamp":"={{ $json.response_timestamp }}","id":0,"intent_confidence":0,"sentiment_score":0},"matchingColumns":["id"],"schema":[{"id":"id","displayName":"id","required":false,"defaultMatch":true,"display":true,"type":"number","canBeUsedToMatch":true,"removed":false},{"id":"session_id","displayName":"session_id","required":true,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"timestamp","displayName":"timestamp","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":true,"removed":false},{"id":"conversation_step","displayName":"conversation_step","required":true,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"user_input","displayName":"user_input","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"agent_response","displayName":"agent_response","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"intent_detected","displayName":"intent_detected","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"intent_confidence","displayName":"intent_confidence","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true,"removed":false},{"id":"sentiment","displayName":"sentiment","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"sentiment_score","displayName":"sentiment_score","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true,"removed":false},{"id":"urgency_level","displayName":"urgency_level","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"frustration_level","displayName":"frustration_level","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"entities_extracted","displayName":"entities_extracted","required":false,"defaultMatch":false,"display":true,"type":"object","canBeUsedToMatch":true,"removed":false},{"id":"tools_used","displayName":"tools_used","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"response_time_ms","displayName":"response_time_ms","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true},{"id":"response_time_seconds","displayName":"response_time_seconds","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true},{"id":"total_tools_used","displayName":"total_tools_used","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true},{"id":"confidence_score","displayName":"confidence_score","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true},{"id":"anomalies_detected","displayName":"anomalies_detected","required":false,"defaultMatch":false,"display":true,"type":"object","canBeUsedToMatch":true},{"id":"channel_source","displayName":"channel_source","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"response_word_count","displayName":"response_word_count","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true},{"id":"response_timestamp","displayName":"response_timestamp","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.4,"position":[2180,-380],"id":"fe5655db-439d-4b7a-97dc-1e4dbbe98c70","name":"Save Interaction","credentials":{"postgres":{"id":"3JqN7cnp8K5WZ58E","name":"Postgres account"}},"notes":"## üíæ PERSISTENZA INTERAZIONE COMPLETA\n\n**FUNZIONE**: Salva l''interazione completa con tutte le metriche nel database\n\n**DATI SALVATI**:\n- **Identificativi**: session_id, timestamp\n- **Contenuto**: agent_response completa\n- **Performance**: response_time_ms, response_time_seconds\n- **Tool Usage**: tools_used (JSON), total_tools_used\n- **Qualit√†**: confidence_score, response_word_count\n- **Anomalie**: anomalies_detected (se presenti)\n- **Processo**: conversation_step (\"response_generated\")\n\n**AGGIORNAMENTO RECORD**:\nQuesto nodo **aggiorna** il record creato da \"Save Chat Input\" con:\n- La risposta generata\n- Le metriche di performance\n- I tool utilizzati\n- Le anomalie rilevate\n\n**TABELLA**: `chat_interactions` (stessa del input)\n\n**UTILIZZO DATI**:\n- **Analytics real-time**: Dashboard performance\n- **Report giornalieri**: Metriche aggregate\n- **ML training**: Coppie input-output di qualit√†\n- **Quality assurance**: Monitoring anomalie\n\n**NOTA**: Record completo ora disponibile per analytics e alerting"},{"parameters":{"jsCode":"// Anomaly Detection per Real-time Monitoring\nconst performanceMetrics = $json.performance_metrics;\nconst sentimentAnalyzer = $(''Sentiment Analyzer'').item.json;\nconst sentimentData = sentimentAnalyzer.sentiment_analysis;\n\n// Definisci soglie per anomalie\nconst thresholds = {\n  response_time_high: 30000, // 30 secondi\n  response_time_critical: 60000, // 60 secondi\n  confidence_low: 0.3,\n  sentiment_negative_high: -0.7,\n  frustration_high: 2,\n  urgency_high: 2\n};\n\n// Rileva anomalie\nconst detectedAnomalies = [];\n\n// Performance anomalies\nif (performanceMetrics.response_time_ms > thresholds.response_time_critical) {\n  detectedAnomalies.push({\n    type: ''critical_performance'',\n    severity: ''high'',\n    metric: ''response_time'',\n    value: performanceMetrics.response_time_ms,\n    threshold: thresholds.response_time_critical,\n    description: ''Response time critically high''\n  });\n} else if (performanceMetrics.response_time_ms > thresholds.response_time_high) {\n  detectedAnomalies.push({\n    type: ''performance_warning'',\n    severity: ''medium'',\n    metric: ''response_time'',\n    value: performanceMetrics.response_time_ms,\n    threshold: thresholds.response_time_high,\n    description: ''Response time above normal''\n  });\n}\n\n// Confidence anomalies\nif (performanceMetrics.confidence_score < thresholds.confidence_low) {\n  detectedAnomalies.push({\n    type: ''low_confidence'',\n    severity: ''medium'',\n    metric: ''confidence_score'',\n    value: performanceMetrics.confidence_score,\n    threshold: thresholds.confidence_low,\n    description: ''Agent confidence below acceptable level''\n  });\n}\n\n// Sentiment anomalies\nif (sentimentData.score < thresholds.sentiment_negative_high) {\n  detectedAnomalies.push({\n    type: ''negative_sentiment'',\n    severity: ''high'',\n    metric: ''sentiment_score'',\n    value: sentimentData.score,\n    threshold: thresholds.sentiment_negative_high,\n    description: ''Highly negative customer sentiment detected''\n  });\n}\n\n// Frustration anomalies\nif (sentimentData.frustration_signals >= thresholds.frustration_high) {\n  detectedAnomalies.push({\n    type: ''high_frustration'',\n    severity: ''high'',\n    metric: ''frustration_signals'',\n    value: sentimentData.frustration_signals,\n    threshold: thresholds.frustration_high,\n    description: ''High customer frustration detected''\n  });\n}\n\n// Urgency anomalies\nif (sentimentData.urgency_signals >= thresholds.urgency_high) {\n  detectedAnomalies.push({\n    type: ''high_urgency'',\n    severity: ''medium'',\n    metric: ''urgency_signals'',\n    value: sentimentData.urgency_signals,\n    threshold: thresholds.urgency_high,\n    description: ''High urgency customer request''\n  });\n}\n\n// Tool usage anomalies\nif (performanceMetrics.total_tools_used === 0) {\n  detectedAnomalies.push({\n    type: ''no_tools_used'',\n    severity: ''low'',\n    metric: ''total_tools_used'',\n    value: 0,\n    threshold: 1,\n    description: ''No tools were used in response generation''\n  });\n}\n\n// Determina se √® necessario un alert\nconst requiresAlert = detectedAnomalies.some(anomaly => \n  anomaly.severity === ''high'' || \n  (anomaly.severity === ''medium'' && detectedAnomalies.length > 1)\n);\n\nconst chatLogger = $(''Chat Logger'').item.json;\nconst alertData = {\n  session_id: $json.session_id,\n  anomalies_count: detectedAnomalies.length,\n  anomalies_detected: detectedAnomalies,\n  requires_alert: requiresAlert,\n  alert_level: detectedAnomalies.some(a => a.severity === ''high'') ? ''high'' : \n               detectedAnomalies.some(a => a.severity === ''medium'') ? ''medium'' : ''low'',\n  detection_timestamp: new Date().toISOString(),\n  context: {\n    user_input: chatLogger.user_input,\n    intent: sentimentAnalyzer.intent_detected,\n    sentiment: sentimentData.sentiment,\n    response_preview: ($json.agent_response || '''').substring(0, 100) + ''...''\n  }\n};\n\n// Mantieni tutti i dati precedenti\nconst inputData = $input.first().json;\n\nreturn {\n  ...inputData,\n  anomaly_detection: alertData\n};"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[2400,0],"id":"e6668e43-6d0b-4ba7-b9fa-fbee35205a59","name":"Anomaly Detector","notes":"## üö® RILEVAMENTO ANOMALIE REAL-TIME\n\n**FUNZIONE**: Analizza ogni interazione per rilevare problemi che richiedono attenzione immediata\n\n**SOGLIE MONITORATE**:\n- **Performance Critiche**: Response time > 60s (HIGH), > 30s (MEDIUM)\n- **Qualit√† Bassa**: Confidence score < 0.3 (MEDIUM)\n- **Sentiment Negativo**: Score < -0.7 (HIGH)\n- **Alta Frustrazione**: ‚â• 2 segnali frustrazione (HIGH)\n- **Alta Urgenza**: ‚â• 2 segnali urgenza (MEDIUM)\n- **Nessun Tool**: 0 tool utilizzati (LOW)\n\n**TIPI ANOMALIE RILEVATE**:\n- `critical_performance`: Sistema lento critico\n- `performance_warning`: Performance sotto standard\n- `low_confidence`: Agent incerto sulla risposta\n- `negative_sentiment`: Cliente molto insoddisfatto\n- `high_frustration`: Cliente estremamente frustrato\n- `high_urgency`: Richiesta urgente\n- `no_tools_used`: Possibile malfunzionamento\n\n**ALERT LOGIC**:\n- **Richiede Alert**: Anomalie HIGH o multiple MEDIUM\n- **Alert Level**: HIGH > MEDIUM > LOW\n- **Contesto**: Include input, intent, sentiment, preview risposta\n\n**OUTPUT**: Dati strutturati per sistema alerting (Slack, email, dashboard)\n\n**NOTA**: Ultimo nodo del flusso - attiva sistemi di monitoring esterni se necessario"},{"parameters":{"assignments":{"assignments":[{"id":"complete_interaction","name":"complete_interaction","value":"={{ {\n  session_id: $(''Chat Logger'').item.json.session_id,\n  timestamp: $(''Chat Logger'').item.json.chat_timestamp,\n  user_input: $(''Chat Logger'').item.json.user_input,\n  agent_response: $json.agent_response,\n  intent_detected: $(''Intent Classifier'').item.json.intent_detected,\n  intent_confidence: $(''Intent Classifier'').item.json.intent_confidence,\n  sentiment: $(''Sentiment Analyzer'').item.json.sentiment_analysis.sentiment,\n  sentiment_score: $(''Sentiment Analyzer'').item.json.sentiment_analysis.score,\n  urgency_level: $(''Sentiment Analyzer'').item.json.sentiment_analysis.urgency_level,\n  frustration_level: $(''Sentiment Analyzer'').item.json.sentiment_analysis.frustration_level,\n  entities_extracted: JSON.stringify($(''Intent Classifier'').item.json.entities_extracted),\n  tools_used: $json.tools_used,\n  response_time_ms: $json.performance_metrics.response_time_ms,\n  response_time_seconds: $json.performance_metrics.response_time_seconds,\n  total_tools_used: $json.performance_metrics.total_tools_used,\n  confidence_score: $json.performance_metrics.confidence_score,\n  anomalies_detected: JSON.stringify($json.anomaly_detection.anomalies_detected),\n  requires_alert: $json.anomaly_detection.requires_alert,\n  alert_level: $json.anomaly_detection.alert_level,\n  conversation_step: ''completed'',\n  channel_source: $(''Chat Logger'').item.json.channel_source,\n  response_word_count: $json.performance_metrics.response_word_count\n} }}","type":"object"},{"id":"vector_content","name":"vector_content","value":"={{ `CONVERSAZIONE - Session: ${$(''Chat Logger'').item.json.session_id}\nTIMESTAMP: ${$(''Chat Logger'').item.json.chat_timestamp}\nCLIENTE: ${$(''Chat Logger'').item.json.user_input}\nMILENA: ${$json.agent_response}\nINTENT: ${$(''Intent Classifier'').item.json.intent_detected}\nSENTIMENT: ${$(''Sentiment Analyzer'').item.json.sentiment_analysis.sentiment}\nTOOLS: ${$json.tools_used}\nPERFORMANCE: ${$json.performance_metrics.response_time_ms}ms` }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[2620,0],"id":"ca985231-f778-483d-8f16-c3bac057c7a8","name":"Data Merger","notes":"## üîÑ AGGREGATORE DATI COMPLETO\n\n**FUNZIONE**: Combina tutti i dati da tutti i nodi precedenti in formato ottimizzato per entrambi i database\n\n**OUTPUT**:\n- `complete_interaction`: Oggetto strutturato per PostgreSQL analytics\n- `vector_content`: Testo formattato per embedding vettoriale\n\n**DATI AGGREGATI**:\n- Chat: session_id, timestamp, input, response\n- AI: intent, sentiment, confidence, tools_used\n- Performance: response_time, anomalies, alert_level\n- Context: channel, conversation_step\n\n**ACCESSO MULTI-NODO**:\nAccede direttamente a tutti i nodi precedenti:\n- Chat Logger ‚Üí dati base sessione\n- Intent Classifier ‚Üí classificazione intenti\n- Sentiment Analyzer ‚Üí analisi emotiva\n- Performance Tracker ‚Üí metriche performance\n- Anomaly Detector ‚Üí rilevamento problemi\n\n**NOTA**: Punto di convergenza dati prima della persistenza dual-database"},{"parameters":{"schema":{"__rl":true,"value":"public","mode":"list"},"table":{"__rl":true,"value":"chat_analytics","mode":"list"},"columns":{"mappingMode":"defineBelow","value":{"session_id":"={{ $json.complete_interaction.session_id }}","timestamp":"={{ $json.complete_interaction.timestamp }}","user_input":"={{ $json.complete_interaction.user_input }}","agent_response":"={{ $json.complete_interaction.agent_response }}","intent_detected":"={{ $json.complete_interaction.intent_detected }}","intent_confidence":"={{ $json.complete_interaction.intent_confidence }}","sentiment":"={{ $json.complete_interaction.sentiment }}","sentiment_score":"={{ $json.complete_interaction.sentiment_score }}","urgency_level":"={{ $json.complete_interaction.urgency_level }}","frustration_level":"={{ $json.complete_interaction.frustration_level }}","entities_extracted":"={{ $json.complete_interaction.entities_extracted }}","tools_used":"={{ $json.complete_interaction.tools_used }}","response_time_ms":"={{ $json.complete_interaction.response_time_ms }}","response_time_seconds":"={{ $json.complete_interaction.response_time_seconds }}","total_tools_used":"={{ $json.complete_interaction.total_tools_used }}","confidence_score":"={{ $json.complete_interaction.confidence_score }}","anomalies_detected":"={{ $json.complete_interaction.anomalies_detected }}","requires_alert":"={{ $json.complete_interaction.requires_alert }}","alert_level":"={{ $json.complete_interaction.alert_level }}","conversation_step":"={{ $json.complete_interaction.conversation_step }}","channel_source":"={{ $json.complete_interaction.channel_source }}","response_word_count":"={{ $json.complete_interaction.response_word_count }}"},"matchingColumns":[],"schema":[]},"options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.4,"position":[2920,0],"id":"5e846187-ee13-4e36-bf3c-0424c5cfff65","name":"Save Analytics (PostgreSQL)","credentials":{"postgres":{"id":"3JqN7cnp8K5WZ58E","name":"Postgres account"}},"notes":"## üìä PERSISTENZA ANALYTICS STRUTTURATA\n\n**FUNZIONE**: Salva dati strutturati per analytics, reporting e BI\n\n**TABELLA**: `chat_analytics`\n\n**SCHEMA OTTIMIZZATO**:\n```sql\nCREATE TABLE chat_analytics (\n    id SERIAL PRIMARY KEY,\n    session_id VARCHAR(255) NOT NULL,\n    timestamp TIMESTAMPTZ NOT NULL,\n    user_input TEXT,\n    agent_response TEXT,\n    intent_detected VARCHAR(50),\n    intent_confidence DECIMAL(3,2),\n    sentiment VARCHAR(20),\n    sentiment_score DECIMAL(3,2),\n    urgency_level VARCHAR(10),\n    frustration_level VARCHAR(10),\n    entities_extracted JSONB,\n    tools_used TEXT,\n    response_time_ms INTEGER,\n    response_time_seconds INTEGER,\n    total_tools_used INTEGER,\n    confidence_score DECIMAL(3,2),\n    anomalies_detected JSONB,\n    requires_alert BOOLEAN,\n    alert_level VARCHAR(10),\n    conversation_step VARCHAR(20),\n    channel_source VARCHAR(20),\n    response_word_count INTEGER,\n    created_at TIMESTAMPTZ DEFAULT NOW()\n);\n\n-- Indici per performance\nCREATE INDEX idx_analytics_session ON chat_analytics(session_id);\nCREATE INDEX idx_analytics_timestamp ON chat_analytics(timestamp);\nCREATE INDEX idx_analytics_intent ON chat_analytics(intent_detected);\nCREATE INDEX idx_analytics_sentiment ON chat_analytics(sentiment);\nCREATE INDEX idx_analytics_alert ON chat_analytics(requires_alert);\n```\n\n**USO**:\n- Dashboard real-time\n- Report giornalieri/mensili\n- Business Intelligence\n- Performance monitoring\n- Alert system queries"},{"parameters":{"dataType":"binary","options":{"metadata":{"metadataValues":[{"name":"fileName","value":"={{ $(''Merge'').item.json.name }}"},{"name":"source","value":"GoogleDrive"}]}}},"id":"2a909c15-2a72-4a33-ae65-b9ca737bd526","name":"Default Data Loader","type":"@n8n/n8n-nodes-langchain.documentDefaultDataLoader","position":[3040,560],"typeVersion":1},{"parameters":{"chunkOverlap":200},"id":"258ae43e-8207-4e89-93ff-b199480b51df","name":"Token Splitter","type":"@n8n/n8n-nodes-langchain.textSplitterTokenSplitter","position":[3080,780],"typeVersion":1},{"parameters":{"mode":"insert","qdrantCollection":{"__rl":true,"value":"=Double","mode":"id"},"options":{"collectionConfig":"=[\n  {\n    \"text\": \"{{ $json.text }}\",\n    \"metadata\": {\n      \"source\": \"{{ $json.name }}\",\n    }\n  }\n]\n"}},"id":"1f6d43be-6823-462b-8469-1e94f15eede9","name":"Qdrant Vector Store1","type":"@n8n/n8n-nodes-langchain.vectorStoreQdrant","position":[2900,380],"typeVersion":1,"credentials":{"qdrantApi":{"id":"VEHIg9nC5Y5VeHPX","name":"QdrantApi account"}}},{"parameters":{"options":{}},"id":"1c333da9-27a5-4377-b742-b026319b1fbd","name":"Embeddings OpenAI1","type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","position":[2840,640],"typeVersion":1.1,"credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}}]', '{"COMMERCIALE":{"ai_tool":[[]]},"AMMINISTRAZIONE":{"ai_tool":[[]]},"INFO ORDE":{"ai_tool":[[]]},"When chat message received":{"main":[[{"node":"Chat ID persisente","type":"main","index":0}]]},"Chat ID persisente":{"main":[[{"node":"Chat Logger","type":"main","index":0}]]},"Chat Logger":{"main":[[{"node":"Intent Classifier","type":"main","index":0}]]},"Intent Classifier":{"main":[[{"node":"Sentiment Analyzer","type":"main","index":0}]]},"Sentiment Analyzer":{"main":[[{"node":"MILENA DISPATCHER","type":"main","index":0}]]},"Save Chat Input":{"main":[[]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"MILENA DISPATCHER","type":"ai_languageModel","index":0}]]},"OpenAI Chat Model1":{"ai_languageModel":[[{"node":"Answer questions with a vector store","type":"ai_languageModel","index":0}]]},"Answer questions with a vector store":{"ai_tool":[[{"node":"MILENA DISPATCHER","type":"ai_tool","index":0}]]},"Qdrant Vector Store":{"ai_vectorStore":[[{"node":"Answer questions with a vector store","type":"ai_vectorStore","index":0}]]},"Embeddings OpenAI2":{"ai_embedding":[[{"node":"Qdrant Vector Store","type":"ai_embedding","index":0}]]},"Postgres Chat Memory":{"ai_memory":[[{"node":"MILENA DISPATCHER","type":"ai_memory","index":0}]]},"Date & Time":{"ai_tool":[[{"node":"MILENA DISPATCHER","type":"ai_tool","index":0}]]},"SerpAPI":{"ai_tool":[[{"node":"MILENA DISPATCHER","type":"ai_tool","index":0}]]},"INFO ORDINI":{"ai_tool":[[{"node":"MILENA DISPATCHER","type":"ai_tool","index":0}]]},"ParcelApp":{"ai_tool":[[{"node":"MILENA DISPATCHER","type":"ai_tool","index":0}]]},"MILENA DISPATCHER":{"main":[[{"node":"Response Logger","type":"main","index":0}]]},"Response Logger":{"main":[[{"node":"Performance Tracker","type":"main","index":0}]]},"Performance Tracker":{"main":[[{"node":"Anomaly Detector","type":"main","index":0}]]},"Save Interaction":{"main":[[]]},"Data Merger":{"main":[[{"node":"Save Analytics (PostgreSQL)","type":"main","index":0},{"node":"Qdrant Vector Store1","type":"main","index":0}]]},"Anomaly Detector":{"main":[[{"node":"Data Merger","type":"main","index":0}]]},"Default Data Loader":{"ai_document":[[{"node":"Qdrant Vector Store1","type":"ai_document","index":0}]]},"Token Splitter":{"ai_textSplitter":[[{"node":"Default Data Loader","type":"ai_textSplitter","index":0}]]},"Embeddings OpenAI1":{"ai_embedding":[[{"node":"Qdrant Vector Store1","type":"ai_embedding","index":0}]]}}', '{"executionOrder":"v1"}', NULL, '{}', '24fce1cb-e35a-4b29-b076-6cb77bda4a29', 1, '{"templateCredsSetupCompleted":true}', NULL, '2025-05-23T20:55:43.039Z', '2025-05-23T22:05:01.000Z', false),
  ('793572e8-5ecd-4bb0-b8f6-fe19c058f1ff', 'OUTLOOK GRABBER', false, '[{"parameters":{"method":"POST","url":"https://graph.microsoft.com/v1.0/subscriptions","authentication":"predefinedCredentialType","nodeCredentialType":"microsoftOutlookOAuth2Api","sendBody":true,"specifyBody":"json","jsonBody":"{\n  \"changeType\": \"created\",\n  \"notificationUrl\": \"https://flow.agentix-io.com/webhook/outlook-webhook\",\n  \"resource\": \"me/mailFolders/inbox/messages\",\n  \"expirationDateTime\": \"2025-05-29T10:00:00Z\",\n  \"clientState\": \"mySecretValue\",\n  \"latestSupportedTlsVersion\": \"v1_2\"\n}\n","options":{}},"id":"adfe9e3e-2780-434a-b906-12c356cc1f19","name":"Register Subscription","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-360,80],"credentials":{"microsoftOutlookOAuth2Api":{"id":"gvsjOBgXBwH8vLH8","name":"Outlook Supplies"}},"notes":"{\n  \"changeType\": \"created\",\n  \"notificationUrl\": \"https://flow.agentix-io.com/webhook/outlook-webhook\",\n  \"resource\": \"me/mailFolders/inbox/messages\",\n  \"expirationDateTime\": \"2025-05-29T10:00:00Z\",\n  \"clientState\": \"mySecretValue\"\n}"},{"parameters":{"httpMethod":"POST","path":"outlook-webhook","responseMode":"responseNode","options":{}},"id":"8a6f4f0e-edcc-4eeb-b24c-4384cb5db4bc","name":"Webhook Trigger","type":"n8n-nodes-base.webhook","typeVersion":1,"position":[-760,700],"webhookId":"e0eaca9d-a32e-418f-b92d-a3d9eacafb7e"},{"parameters":{"conditions":{"string":[{"value1":"={{ $json.query.validationToken }}","operation":"isNotEmpty"}]}},"id":"e05a4bdd-45e5-4c5f-a0d7-703037d7e89e","name":"Validation Check","type":"n8n-nodes-base.if","typeVersion":1,"position":[-460,700]},{"parameters":{"respondWith":"text","responseBody":"={{ $json.query.validationToken }}","options":{}},"id":"55a349ea-2af0-4e1f-96fc-e19d2c9b97cb","name":"Validation Response","type":"n8n-nodes-base.respondToWebhook","typeVersion":1,"position":[-240,500]},{"parameters":{"conditions":{"string":[{"value1":"={{ $json.value && $json.value[0] && $json.value[0].changeType }}","value2":"created"}]}},"id":"b6b303bd-ef60-4609-b9cb-026d06848034","name":"Check New Message","type":"n8n-nodes-base.if","typeVersion":1,"position":[-240,800]},{"parameters":{"url":"https://graph.microsoft.com/v1.0/me/messages/={{ $json.value[0].resourceData.id }}","authentication":"oAuth2Api","options":{}},"id":"19ec6aaf-179b-4a71-aafd-192d11631c39","name":"Get Email Details","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-20,700]},{"parameters":{"conditions":{"boolean":[{"value1":"={{ $json.isRead }}"}]}},"id":"06eca7a6-bbb3-47d0-b111-0e4991f026a6","name":"Check if Unread","type":"n8n-nodes-base.if","typeVersion":1,"position":[200,700]},{"parameters":{"jsCode":"// Estrai informazioni email non letta\nconst emailData = $input.first().json;\n\nconst processedEmail = {\n  id: emailData.id,\n  subject: emailData.subject,\n  from: emailData.from.emailAddress.address,\n  fromName: emailData.from.emailAddress.name,\n  receivedDateTime: emailData.receivedDateTime,\n  bodyPreview: emailData.bodyPreview,\n  isRead: emailData.isRead,\n  hasAttachments: emailData.hasAttachments,\n  folderId: emailData.parentFolderId,\n  body: emailData.body ? emailData.body.content : '''',\n  importance: emailData.importance\n};\n\nconsole.log(''Nuova email non letta ricevuta:'', processedEmail.subject);\n\nreturn [{ json: processedEmail }];"},"id":"ca783792-c4e3-4962-a530-5c53f21dc1bd","name":"Process Unread Email","type":"n8n-nodes-base.code","typeVersion":2,"position":[420,600]},{"parameters":{},"id":"c809146d-e29d-4f53-b498-35048f40038c","name":"Do Nothing - Email Processed","type":"n8n-nodes-base.noOp","typeVersion":1,"position":[640,600]},{"parameters":{},"id":"b453f352-be1f-4f9a-a02b-96d2ef27e1fa","name":"Do Nothing - Validation","type":"n8n-nodes-base.noOp","typeVersion":1,"position":[-20,500]},{"parameters":{},"id":"8e084219-af02-47bd-b11a-749b745df7b1","name":"Do Nothing - Already Read","type":"n8n-nodes-base.noOp","typeVersion":1,"position":[420,800]},{"parameters":{},"id":"2e594775-db66-48ed-a870-1de91d5df0f0","name":"Do Nothing - Not Message","type":"n8n-nodes-base.noOp","typeVersion":1,"position":[-20,900]},{"parameters":{},"id":"7bfb4530-2910-4319-ac5a-f591a486cfd1","name":"Do Nothing - Subscription Created","type":"n8n-nodes-base.noOp","typeVersion":1,"position":[-160,80]},{"parameters":{"url":"https://graph.microsoft.com/v1.0/subscriptions","authentication":"predefinedCredentialType","nodeCredentialType":"microsoftOutlookOAuth2Api","sendBody":true,"specifyBody":"json","jsonBody":"{\n  \"changeType\": \"created\",\n  \"notificationUrl\": \"https://flow.agentix-io.com/webhook/outlook-webhook\",\n  \"resource\": \"me/mailFolders/inbox/messages\",\n  \"expirationDateTime\": \"2025-05-29T10:00:00Z\",\n  \"clientState\": \"mySecretValue\"\n}","options":{}},"id":"ff4971f1-734c-447e-b48a-ad740553d804","name":"verify Subscription1","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-880,1180],"credentials":{"microsoftOutlookOAuth2Api":{"id":"gvsjOBgXBwH8vLH8","name":"Outlook Supplies"}}},{"parameters":{"method":"DELETE","url":"=https://graph.microsoft.com/v1.0/subscriptions/{{ $json.id }}","authentication":"predefinedCredentialType","nodeCredentialType":"microsoftOutlookOAuth2Api","options":{}},"id":"0bd94442-88c1-4ca4-bcb7-c314f6c75a89","name":"Delete Subscription","type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-260,1180],"credentials":{"microsoftOutlookOAuth2Api":{"id":"gvsjOBgXBwH8vLH8","name":"Outlook Supplies"}},"notes":"{\n  \"changeType\": \"created\",\n  \"notificationUrl\": \"https://flow.agentix-io.com/webhook/outlook-webhook\",\n  \"resource\": \"me/mailFolders/inbox/messages\",\n  \"expirationDateTime\": \"2025-05-29T10:00:00Z\",\n  \"clientState\": \"mySecretValue\"\n}"},{"parameters":{"authentication":"oAuth2","url":"https://graph.microsoft.com/v1.0/subscriptions","jsonParameters":true,"options":{}},"name":"Get Subscriptions","type":"n8n-nodes-base.httpRequest","typeVersion":1,"position":[320,-140],"id":"ee0494ce-b880-4a4f-b051-27163cec7f9a"},{"parameters":{"functionCode":"const targetResource = \"me/mailFolders/inbox/messages\";\nconst targetUrl = \"https://flow.agentix-io.com/webhook/outlook-webhook\";\n\n// Trova tutte le sottoscrizioni identiche\nconst duplicates = items.filter(item => {\n  const s = item.json;\n  return s.resource === targetResource && s.notificationUrl === targetUrl;\n});\n\n// Ordina per expirationDateTime decrescente (la pi√π recente per prima)\nduplicates.sort((a, b) => {\n  return new Date(b.json.expirationDateTime) - new Date(a.json.expirationDateTime);\n});\n\n// Restituisce tutti tranne il primo (cio√®: i duplicati da eliminare)\nreturn duplicates.slice(1);\n     "},"name":"Filter Duplicates","type":"n8n-nodes-base.function","typeVersion":1,"position":[-480,1180],"id":"ab5b2618-97d2-4f64-b36e-be287d413f8e"},{"parameters":{"authentication":"oAuth2","url":"={{$json[\"id\"]}}","jsonParameters":true,"options":{}},"name":"Delete Duplicates","type":"n8n-nodes-base.httpRequest","typeVersion":1,"position":[1120,1180],"id":"be901b9f-1982-4f1b-a033-055d11f458a6"},{"parameters":{"authentication":"oAuth2","url":"https://graph.microsoft.com/v1.0/subscriptions","jsonParameters":true,"options":{}},"name":"Create Subscription","type":"n8n-nodes-base.httpRequest","typeVersion":1,"position":[760,1200],"id":"4eef3a95-e453-4161-9103-ee75c4feb7ac"},{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[-1100,1180],"id":"4693e224-ceca-4888-89a4-8213711cb628","name":"When clicking ‚ÄòTest workflow‚Äô"},{"parameters":{"jsCode":"return items[0].json.value.map(sub => {\n  return { json: sub };\n});\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-660,1180],"id":"668cd15d-5725-4765-872f-482a1d7dde02","name":"Code"}]', '{"Register Subscription":{"main":[[{"node":"Do Nothing - Subscription Created","type":"main","index":0}]]},"Webhook Trigger":{"main":[[{"node":"Validation Check","type":"main","index":0}]]},"Validation Check":{"main":[[{"node":"Validation Response","type":"main","index":0}],[{"node":"Check New Message","type":"main","index":0}]]},"Validation Response":{"main":[[{"node":"Do Nothing - Validation","type":"main","index":0}]]},"Check New Message":{"main":[[{"node":"Get Email Details","type":"main","index":0}],[{"node":"Do Nothing - Not Message","type":"main","index":0}]]},"Get Email Details":{"main":[[{"node":"Check if Unread","type":"main","index":0}]]},"Check if Unread":{"main":[[{"node":"Process Unread Email","type":"main","index":0}],[{"node":"Do Nothing - Already Read","type":"main","index":0}]]},"Process Unread Email":{"main":[[{"node":"Do Nothing - Email Processed","type":"main","index":0}]]},"verify Subscription1":{"main":[[{"node":"Code","type":"main","index":0}]]},"When clicking ‚ÄòTest workflow‚Äô":{"main":[[{"node":"verify Subscription1","type":"main","index":0}]]},"Code":{"main":[[{"node":"Filter Duplicates","type":"main","index":0}]]},"Filter Duplicates":{"main":[[{"node":"Delete Subscription","type":"main","index":0}]]}}', '{"executionOrder":"v1"}', NULL, '{}', '938e63b5-cc7c-4a13-a87e-cf808fddd6a1', 1, NULL, NULL, '2025-05-26T11:44:56.314Z', '2025-05-26T14:25:47.000Z', false),
  ('a1861607-9f28-4584-9dab-917a7cef8ee8', 'SUB_SMART TASK ANALYZER_old', false, '[{"parameters":{"model":{"__rl":true,"value":"gpt-4o","mode":"list","cachedResultName":"gpt-4o"},"options":{}},"id":"090314ca-588f-4193-993b-e1f76d5685a6","name":"OpenAI Analyzer","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-1252,535],"credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"gap-detected","leftValue":"={{ $json.gap_identified }}","rightValue":"true","operator":{"type":"boolean","operation":"true","singleValue":true}}],"combinator":"and"},"options":{}},"id":"f28f982a-eddd-454e-8f2c-feaedb843a36","name":"‚ùì Gap Detected?","type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-744,315]},{"parameters":{"promptType":"define","text":"=Sei un supervisore esperto del customer service specializzato nell''analisi di conversazioni per GommeGo, azienda di pneumatici. Il tuo ruolo √® identificare gap operativi quando gli assistenti AI fanno promesse che richiedono azioni del team umano.\n\nCONTESTO AZIENDALE - GOMMEGO:\n- E-commerce pneumatici con problemi di tracking consegne\n- Problemi comuni: consegne parziali, ritardi tracking, problemi corrieri (GLS)\n- Aspettative clienti: tracking immediato, aggiornamenti rapidi consegne\n\nRESPONSABILIT√Ä PRINCIPALI:\n- Identificare promesse specifiche AI che richiedono follow-up operativo\n- Valutare accuratamente soddisfazione cliente e livelli urgenza\n- Determinare azioni concrete necessarie con scadenze realistiche\n- Fornire punteggi confidence con ragionamento chiaro\n\nREGOLE VALIDAZIONE CRITICHE:\n- action_type DEVE essere: tracking|delivery|refund|follow_up|verification|escalation SOLO\n- urgency_level DEVE essere: critical|high|medium|low SOLO  \n- customer_satisfaction DEVE essere: satisfied|neutral|frustrated|angry SOLO\n- confidence DEVE essere: intero 0-100 (sii conservativo, evita punteggi gonfiati)\n\nFRAMEWORK DECISIONALE - SPECIFICO GOMMEGO:\n- CRITICAL: Tracking mancante/sbagliato, consegne parziali, rimborsi promessi, errori corriere\n- HIGH: Problemi consegna, lavorazione resi, contatti corriere promessi, problemi ordine\n- MEDIUM: Richieste generali, follow-up cortesia, controlli stato, richieste info\n- LOW: Conferme, ringraziamenti, risposte FAQ standard, aggiornamenti routine\n\nREGOLE PUNTEGGIO CONFIDENCE:\n- 90-100%: RARO - Promesse chiare con timeline specifiche E dati ordine completi\n- 70-89%: COMUNE - Gap probabili con informazioni per lo pi√π complete  \n- 50-69%: MODERATO - Gap possibili che richiedono validazione\n- 0-49%: BASSO - Nessuna azione operativa identificabile\n\nREQUISITI OUTPUT:\n- Solo formato JSON valido\n- Punteggi confidence conservativi (preferire range 60-80%)\n- Task specifici e actionable relativi al business pneumatici\n- Mappare problemi consegna su action_type ''tracking''\n```\n\n## Prompt Principale (Ottimizzato con Validazione)\n\n```\nAnalizza questa conversazione cliente-AI di GommeGo per identificare gap operativi e necessit√† di follow-up.\n\nDATI CONVERSAZIONE:\nRisposta Thread: {{ $json.isThreadReply }}\nPrimo Messaggio: {{ $json.isFirstMessage }}\nData: {{ $json.data_iso }}\nCliente: {{ $json.mittente }}\nOggetto: {{ $json.oggetto }}\nMessaggio Cliente: {{ $json.messaggio_cliente }}\nRisposta AI: {{ $json.risposta_agent }}\nStorico Thread: {{ $json.thread_storico }}\nConfidence Iniziale: {{ $json.confidence }}\n\nFOCUS ANALISI:\n1. Cosa ha richiesto specificamente il cliente riguardo al suo ordine pneumatici?\n2. Cosa ha promesso o si √® impegnato a fare l''AI?\n3. Ci sono gap tra richiesta e risposta che richiedono azione operativa?\n4. Quali azioni concrete deve intraprendere il team GommeGo?\n5. Qual √® il livello di soddisfazione del cliente?\n6. Qual √® la vera urgenza considerando le aspettative consegna pneumatici?\n\nESEMPI GAP SPECIFICI GOMMEGO:\n- Cliente: \"Non ho ricevuto tracking\" + AI: \"Sar√† disponibile\" = AZIONE: Inserire numero tracking reale\n- Cliente: \"Manca 1 pneumatico\" + AI: \"Contatteremo corriere\" = AZIONE: Verificare contatto corriere effettuato  \n- Cliente: \"Voglio rimborso\" + AI: \"Processeremo in 3 giorni\" = AZIONE: Processare rimborso entro scadenza\n- Cliente: \"Corriere non trova indirizzo\" + AI: \"Verificheremo\" = AZIONE: Aggiornare indirizzo consegna\n\nCHECKLIST VALIDAZIONE PRIMA OUTPUT:\n‚úÖ action_type √® uno di: tracking, delivery, refund, follow_up, verification, escalation\n‚úÖ urgency_level √® uno di: critical, high, medium, low\n‚úÖ customer_satisfaction √® uno di: satisfied, neutral, frustrated, angry  \n‚úÖ confidence √® intero 0-100 (sii realistico, non ottimistico)\n‚úÖ ai_promises sono specifiche e actionable\n‚úÖ required_actions sono operazioni concrete GommeGo\n\nRestituisci analisi in questo formato JSON ESATTO:\n{\n  \"gap_identified\": boolean,\n  \"confidence\": number(0-100),\n  \"confidence_reasoning\": \"spiegazione punteggio in italiano (max 50 caratteri)\",\n  \"customer_satisfaction\": \"satisfied|neutral|frustrated|angry\",\n  \"ai_promises\": [\"promesse specifiche AI in italiano\"],\n  \"required_actions\": [\"azioni operative concrete in italiano\"],\n  \"urgency_level\": \"critical|high|medium|low\",\n  \"follow_up_needed\": boolean,\n  \"deadline_hours\": number,\n  \"action_type\": \"tracking|delivery|refund|follow_up|verification|escalation\",\n  \"customer_sentiment\": \"analisi sentiment breve in italiano\",\n  \"notes\": \"osservazioni specifiche in italiano\"\n}\n```\n\n## Esempi Few-Shot - Specifici GommeGo\n\n### Esempio 1 - Gap Critico (Consegna Pneumatici):\n```\nINPUT: \nCliente: \"Ho ordinato 4 pneumatici ma ne ho ricevuto solo 2, ordine BCRGBYWMU\"\nAI: \"Mi dispiace per l''inconveniente. Contatteremo immediatamente il corriere GLS per rintracciare i pneumatici mancanti e ti faremo sapere entro 24 ore.\"\nThread: Email precedente con conferma ordine\n\nRAGIONAMENTO: Consegna parziale chiara + promessa AI specifica con timeline + ID ordine disponibile\n\nOUTPUT:\n{\n  \"gap_identified\": true,\n  \"confidence\": 85,\n  \"confidence_reasoning\": \"Consegna parziale con promessa specifica e timeline\",\n  \"customer_satisfaction\": \"frustrated\",\n  \"ai_promises\": [\"Contattare corriere GLS\", \"Update entro 24 ore\"],\n  \"required_actions\": [\"Contattare GLS per pneumatici mancanti\", \"Aggiornare cliente entro 24h\"],\n  \"urgency_level\": \"critical\",\n  \"follow_up_needed\": true,\n  \"deadline_hours\": 24,\n  \"action_type\": \"delivery\",\n  \"customer_sentiment\": \"frustrato ma aspetta risoluzione\",\n  \"notes\": \"Consegna parziale - priorit√† alta per retention\"\n}\n```\n\n### Esempio 2 - Nessun Gap (Info Standard):\n```\nINPUT:\nCliente: \"Quando arriva il mio ordine di pneumatici?\"\nAI: \"Il tuo ordine √® stato spedito ieri e arriver√† entro 2-3 giorni lavorativi. Puoi seguire la spedizione con il codice tracking ABC123.\"\nThread: Prima richiesta\n\nRAGIONAMENTO: Info standard fornita, tracking disponibile, nessuna promessa che richiede azione\n\nOUTPUT:\n{\n  \"gap_identified\": false,\n  \"confidence\": 75,\n  \"confidence_reasoning\": \"Info standard fornita, tracking disponibile\",\n  \"customer_satisfaction\": \"satisfied\",\n  \"ai_promises\": [],\n  \"required_actions\": [],\n  \"urgency_level\": \"low\",\n  \"follow_up_needed\": false,\n  \"deadline_hours\": 0,\n  \"action_type\": \"follow_up\",\n  \"customer_sentiment\": \"neutrale, richiesta informazioni\",\n  \"notes\": \"Richiesta standard consegna - nessuna azione\"\n}\n```\n\n### Esempio 3 - Gap Medio (Problema Indirizzo):\n```\nINPUT:\nCliente: \"Il corriere GLS non trova il mio indirizzo per i pneumatici\"\nAI: \"Verificheremo con il corriere e aggiorneremo l''indirizzo di consegna. Ti ricontatteremo oggi stesso.\"\nThread: Conversazione in corso\n\nRAGIONAMENTO: Problema consegna chiaro + promessa contatto + aggiornamento indirizzo + timeline\n\nOUTPUT:\n{\n  \"gap_identified\": true,\n  \"confidence\": 70,\n  \"confidence_reasoning\": \"Problema indirizzo con promessa di verifica\",\n  \"customer_satisfaction\": \"neutral\",\n  \"ai_promises\": [\"Verificare con corriere\", \"Aggiornare indirizzo\", \"Ricontattare oggi\"],\n  \"required_actions\": [\"Contattare GLS per indirizzo\", \"Aggiornare dati consegna\", \"Chiamare cliente\"],\n  \"urgency_level\": \"high\",\n  \"follow_up_needed\": true,\n  \"deadline_hours\": 8,\n  \"action_type\": \"tracking\",\n  \"customer_sentiment\": \"preoccupato ma paziente\",\n  \"notes\": \"Verifica indirizzo necessaria - consegna bloccata\"\n}\n```\n\n### Esempio 4 - Bassa Confidence (Dati Insufficienti):\n```\nINPUT:\nCliente: \"Saluti\"\nAI: \"Grazie per averci contattato. Resto a disposizione per qualsiasi necessit√†.\"\nThread: Fine conversazione\n\nRAGIONAMENTO: Nessuna richiesta operativa, solo saluti di chiusura\n\nOUTPUT:\n{\n  \"gap_identified\": false,\n  \"confidence\": 90,\n  \"confidence_reasoning\": \"Nessuna richiesta operativa identificabile\",\n  \"customer_satisfaction\": \"satisfied\",\n  \"ai_promises\": [],\n  \"required_actions\": [],\n  \"urgency_level\": \"low\",\n  \"follow_up_needed\": false,\n  \"deadline_hours\": 0,\n  \"action_type\": \"follow_up\",\n  \"customer_sentiment\": \"cordiale\",\n  \"notes\": \"Fine conversazione - nessuna azione necessaria\"\n}\n```\n\n## Impostazioni Configurazione:\n- Temperature: 0.1 (massima consistenza)\n- Top-K: 15 (focus su output strutturati)  \n- Top-P: 0.85 (leggera creativit√† per analisi)\n- Token Limit: 1200 (spazio per output strutturato + ragionamento)\n\n## Riepilogo Regole Validazione:\n- Range confidence: 50-90% (evitare estremi)\n- Action types: solo valori DB esistenti\n- Timeline realistici: 2-72 ore max\n- Promesse specifiche: non generiche\n- Focus GommeGo: pneumatici, tracking, corrieri"},"id":"9bf6d9dd-3ce4-4f9d-9997-e08542334ce1","name":"‚öôÔ∏è Smart Task Generator","type":"@n8n/n8n-nodes-langchain.chainLlm","typeVersion":1.5,"position":[-524,65],"notes":"# üöÄ Smart Task Generator - Prompt Ottimizzato\n\n## System Prompt (Prompting di Sistema)\n\n```\nSei un assistente specializzato nella generazione di task operativi per il customer service. \n\nOBIETTIVO PRINCIPALE: Trasformare gap operativi identificati in task concreti e actionable.\n\nPRINCIPI GUIDA:\n- Genera task specifici e eseguibili\n- Assegna priorit√† basate su urgenza e sentiment del cliente  \n- Calcola deadline realistici considerando orari lavorativi (9:00-18:00, lun-ven)\n- Mantieni coerenza con il livello di confidence dell''analisi\n\nSTANDARD ACTION_TYPE (usa ESATTAMENTE questi valori):\ntracking, delivery, installation, refund, follow_up, verification, escalation, invoice_request, product_info, return\n\nMAPPATURA PRIORIT√Ä:\n- CRITICAL: Rischio soddisfazione cliente, azione immediata\n- HIGH: Problemi qualit√† servizio, risoluzione giornata\n- MEDIUM: Follow-up standard, 24-48h  \n- LOW: Task di cortesia, timeline flessibile\n```\n\n## Main Prompt (Prompt Principale con Chain of Thought)\n\n```\nAnalizza questi dati e genera task operativi seguendo questo processo step-by-step:\n\n**STEP 1: VALIDAZIONE DATI**\nDati analisi: {{ $json.gap_identified }}, confidence: {{ $json.confidence }}%\nDati cliente: {{ $json.customer_email }}, {{ $json.customer_name }}, {{ $json.order_id }}\n\n**STEP 2: DECISION TREE**\nSe gap_identified = false O confidence < 50%:\n‚Üí Restituisci lista task vuota con nota \"Nessun gap actionable identificato\"\n\nSe gap_identified = true E confidence ‚â• 50%:\n‚Üí Procedi al STEP 3\n\n**STEP 3: ANALISI URGENZA E PRIORIT√Ä**\nEvaluta questi fattori:\n- Livello urgenza: {{ $json.urgency_level }}\n- Sentiment cliente: {{ $json.customer_sentiment }}  \n- Promesse AI: {{ $json.ai_promises }}\n- Confidence level: {{ $json.confidence }}%\n\nLogica priorit√†:\n- Cliente frustrato + alta confidence = CRITICAL\n- Promesse specifiche AI con timeline = HIGH\n- Follow-up generale = MEDIUM  \n- Task cortesia o bassa confidence = LOW\n\n**STEP 4: CALCOLO DEADLINE**\nBasato su priorit√†:\n- CRITICAL: 2-6 ore (stesso giorno)\n- HIGH: 8-24 ore (giorno lavorativo successivo)\n- MEDIUM: 24-48 ore\n- LOW: 48-72 ore\n\n**STEP 5: GENERAZIONE TASK**\nCrea task con questa struttura:\n\n```json\n{\n  \"tasks\": [\n    {\n      \"title\": \"Titolo specifico e actionable del task\",\n      \"description\": \"Descrizione dettagliata includendo promesse AI e contesto\",\n      \"priority\": \"critical|high|medium|low\",\n      \"deadline_hours\": numero_ore_calcolato,\n      \"action_type\": \"valore_esatto_da_standard\",\n      \"customer_data\": {\n        \"email\": \"{{ $json.customer_email }}\",\n        \"name\": \"{{ $json.customer_name }}\", \n        \"order_id\": \"{{ $json.order_id }}\"\n      },\n      \"execution_requirements\": \"Cosa deve fare esattamente l''operatore\",\n      \"ai_commitments\": [\"Lista promesse AI da onorare\"],\n      \"urgency_justification\": \"Perch√© questa priorit√†\",\n      \"notes\": \"Info aggiuntive per l''operatore\"\n    }\n  ],\n  \"total_tasks\": numero_task_generati,\n  \"confidence_passthrough\": {{ $json.confidence }},\n  \"analysis_quality\": \"reliable|needs_validation|low_confidence\"\n}\n```\n\n**STEP 6: QUALITY CHECK**\nVerifica che ogni task sia:\n‚úÖ Specifico e actionable\n‚úÖ Include tutti i dati cliente disponibili  \n‚úÖ Referenzia promesse AI specifiche\n‚úÖ Ha deadline realistici\n‚úÖ Contiene guidance per esecuzione\n\nDATI INPUT DISPONIBILI:\n- Gap identificato: {{ $json.gap_identified }}\n- Confidence: {{ $json.confidence }}%\n- Reasoning: {{ $json.confidence_reasoning }}\n- Promesse AI: {{ $json.ai_promises }}\n- Azioni richieste: {{ $json.required_actions }}\n- Livello urgenza: {{ $json.urgency_level }}\n- Follow-up necessario: {{ $json.follow_up_needed }}\n- Deadline ore: {{ $json.deadline_hours }}\n- Tipo azione: {{ $json.action_type }}\n- Sentiment cliente: {{ $json.customer_sentiment }}\n- Note: {{ $json.notes }}\n- Email cliente: {{ $json.customer_email }}\n- Nome cliente: {{ $json.customer_name }}\n- ID ordine: {{ $json.order_id }}\n- Subject email: {{ $json.email_subject }}\n```\n\n## Few-Shot Examples (Esempi Progressivi)\n\n### Esempio 1: Task Critico - Alta Confidence\n```\nINPUT: \ngap_identified: true, confidence: 95%\nai_promises: [\"Contatto corriere immediato\", \"Update entro 24h\"]\nurgency_level: \"critical\", customer_sentiment: \"frustrato\"\ncustomer_email: \"mario.rossi@email.com\", order_id: \"ORD123\"\n\nRAGIONAMENTO:\n- Gap identificato ‚úì, confidence alta ‚úì\n- Cliente frustrato + alta confidence = CRITICAL\n- Promesse specifiche con timeline = deadline breve\n- Tutti dati cliente disponibili\n\nOUTPUT:\n{\n  \"tasks\": [\n    {\n      \"title\": \"URGENTE: Verifica consegna parziale ordine ORD123\",\n      \"description\": \"Cliente ha ricevuto solo 2 su 4 pneumatici. AI ha promesso contatto immediato corriere e update 24h. Verificare seconda spedizione e aggiornare cliente.\",\n      \"priority\": \"critical\",\n      \"deadline_hours\": 4,\n      \"action_type\": \"delivery\",\n      \"customer_data\": {\n        \"email\": \"mario.rossi@email.com\",\n        \"name\": null,\n        \"order_id\": \"ORD123\"\n      },\n      \"execution_requirements\": \"1) Contattare corriere per tracciare pneumatici mancanti 2) Verificare status seconda spedizione 3) Chiamare cliente per update\",\n      \"ai_commitments\": [\"Contatto corriere immediato\", \"Update cliente entro 24 ore\"],\n      \"urgency_justification\": \"Consegna parziale con cliente frustrato e promesse specifiche AI\",\n      \"notes\": \"Priorit√† massima - cliente aspetta risposta urgente\"\n    }\n  ],\n  \"total_tasks\": 1,\n  \"confidence_passthrough\": 95,\n  \"analysis_quality\": \"reliable\"\n}\n```\n\n### Esempio 2: Task Medio - Confidence Media  \n```\nINPUT:\ngap_identified: true, confidence: 65%\nai_promises: [\"Verificheremo con corriere\"]\nurgency_level: \"medium\"\ncustomer_email: \"cliente@test.com\"\n\nRAGIONAMENTO:\n- Gap identificato ‚úì, confidence media (richiede validazione)\n- Promesse generiche = priorit√† media\n- Mancano alcuni dati cliente\n\nOUTPUT:\n{\n  \"tasks\": [\n    {\n      \"title\": \"Verifica status consegna - VALIDAZIONE RICHIESTA\",\n      \"description\": \"AI ha promesso verifica corriere ma dettagli limitati. Confidence 65% richiede validazione supervisore prima esecuzione.\",\n      \"priority\": \"medium\", \n      \"deadline_hours\": 48,\n      \"action_type\": \"verification\",\n      \"customer_data\": {\n        \"email\": \"cliente@test.com\",\n        \"name\": null,\n        \"order_id\": null\n      },\n      \"execution_requirements\": \"STOP: Validare contesto completo con supervisore prima di procedere\",\n      \"ai_commitments\": [\"Verifica con corriere\"],\n      \"urgency_justification\": \"Confidence media - necessaria approvazione supervisore\",\n      \"notes\": \"Task generato con confidence 65% - NON eseguire senza validazione\"\n    }\n  ],\n  \"total_tasks\": 1,\n  \"confidence_passthrough\": 65,\n  \"analysis_quality\": \"needs_validation\"\n}\n```\n\n### Esempio 3: Nessun Task - Bassa Confidence\n```\nINPUT:\ngap_identified: false, confidence: 35%\n\nRAGIONAMENTO:\n- Gap non identificato O confidence < 50%\n- Non generare task\n\nOUTPUT:\n{\n  \"tasks\": [],\n  \"total_tasks\": 0,\n  \"processing_note\": \"Nessun gap actionable identificato - confidence troppo bassa (35%)\",\n  \"confidence_passthrough\": 35,\n  \"analysis_quality\": \"low_confidence\"\n}\n```\n\n## Configurazione Ottimale per LLM\n\n### Impostazioni Consigliate:\n- **Temperature: 0.1** (consistenza per task operativi)\n- **Top-P: 0.9** (focus su output strutturati)  \n- **Top-K: 20** (limitare creativit√† eccessiva)\n- **Token Limit: 1500** (spazio per task dettagliati)\n\n### Regole di Validazione:\n1. **MAI** generare task con confidence < 50%\n2. **SEMPRE** includere confidence_passthrough per downstream processing\n3. **FLAGGARE** task con confidence 50-69% per validazione\n4. **VERIFICARE** che action_type sia nei valori predefiniti\n5. **CALCOLARE** deadline realistici in orari lavorativi\n\n## Template per Documentazione (Best Practice)\n\n| Campo | Valore |\n|-------|--------|\n| Nome Prompt | Smart_Task_Generator_v2.0 |\n| Obiettivo | Generazione automatica task customer service da gap analysis |\n| Modello | [specificare modello usato] |\n| Temperature | 0.1 |\n| Top-P | 0.9 |\n| Top-K | 20 |\n| Token Limit | 1500 |\n| Data Creazione | [data] |\n| Ultima Modifica | [data] |\n| Performance | [tracking accuracy/feedback] |\n| Note | [osservazioni sull''utilizzo] |\n\n## Changelog delle Ottimizzazioni\n\n### v2.0 - Ottimizzazioni Applied\n‚úÖ **Chain of Thought**: Aggiunto processo step-by-step esplicito\n‚úÖ **Istruzioni vs Constraints**: Convertiti vincoli negativi in istruzioni positive  \n‚úÖ **Few-Shot Migliorati**: Esempi riorganizzati per complessit√† crescente con reasoning\n‚úÖ **Semplificazione**: Ridotta complessit√† strutturale mantenendo funzionalit√†\n‚úÖ **System Prompting**: Separato ruolo e context dal main prompt\n‚úÖ **Specificity**: Aggiunti dettagli esecutivi per ogni task\n‚úÖ **JSON Strutturato**: Output format coerente per automazione n8n\n‚úÖ **Documentazione**: Template per tracking iterazioni future"},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4o-mini"},"options":{}},"id":"abfb54c2-a1c4-4f20-b372-4e257e288472","name":"OpenAI Task Gen","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-436,285],"credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"tableId":"smart_tasks","dataToSend":"autoMapInputData"},"id":"7d1bea8a-e262-4e2a-927f-08138d920acc","name":"üíæ Supabase Insert","type":"n8n-nodes-base.supabase","typeVersion":1,"position":[292,-60],"credentials":{"supabaseApi":{"id":"U18uJwD80Uq036TV","name":"Supabase tiziano.annicchiarico@gmail.com"}}},{"parameters":{"chatId":"-1002673812914,","text":"=üö® *TASK URGENTE*\n\nüìã *Task:* {{ $json.title }}\n‚è∞ *Scadenza:* {{ $json.deadline }}\nüë§ *Cliente:* `{{ $json.customer_email }}`\nüì¶ *Ordine:* `{{ $json.order_id }}`\n\nüìù *Descrizione attivit√†:*\n{{ $json.description }}\n\nüì£ *Promessa dell''agente:*\n{{ $json.conversation_context.analysis.ai_promises.join(''\\n- '') }}\n\n‚úÖ *Azioni richieste:*\n{{ $json.conversation_context.analysis.required_actions.join(''\\n- '') }}\n\n","additionalFields":{"parse_mode":"Markdown"}},"id":"6df79351-0251-4db0-be1d-080ae439d214","name":"üì± Telegram Urgent","type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[732,40],"webhookId":"71c571dd-2e9b-4953-86d6-93a4157b9498","credentials":{"telegramApi":{"id":"dbGXwcFAw4mNHLio","name":"GommeGoBot"}}},{"parameters":{"resource":"event","operation":"create","calendarId":{"__rl":true,"value":"AAMkADRmMTYxODRmLWJmZjYtNDQ4Ny1hZGE0LWQzYjNhZjJkZDQyMgBGAAAAAAAbCa7Kx9UPS7NhabBhamKLBwABIvZjidpvQo_FOUmjs9ACAAAAAAEGAAABIvZjidpvQo_FOUmjs9ACAAAAaeDTAAA=","mode":"list","cachedResultName":"Calendar"},"subject":"={{ ''üõ†Ô∏è To do: '' + $json.title }}","startDateTime":"={{ $json.deadline }}","endDateTime":"={{ (() => {\n  const start = new Date($json.deadline);\n  start.setHours(start.getHours() + 1);\n  return start.toISOString();\n})() }}\n","additionalFields":{"body":"={{ `\n<b>üì© Cliente:</b> ${$json.customer_email}<br>\n<b>üì¶ Ordine:</b> ${$json.order_id}<br><br>\n\n<b>üçí Descrizione:</b> ${$json.description}<br><br>\n\n<b>üß≠ Azioni richieste:</b><ul>\n  ${$json.required_actions.map(a => `<li>${a}</li>`).join('''')}\n</ul>\n\n<b>ü§ñ Promesse AI:</b><ul>\n  ${$json.ai_commitments.map(p => `<li>${p}</li>`).join('''')}\n</ul>\n\n<b>üìù Note:</b> ${$json.notes}\n` }}\n\n","showAs":"busy"}},"type":"n8n-nodes-base.microsoftOutlook","typeVersion":2,"position":[732,-160],"id":"fc6ad06e-5d09-41d5-8aa9-f9b19df063e4","name":"Microsoft Outlook","webhookId":"cae19a39-a490-4a5e-8a0e-13702262253c","credentials":{"microsoftOutlookOAuth2Api":{"id":"EySZIVRGzocRrEOf","name":"Outlook Info GommeGo"}}},{"parameters":{"inputSource":"passthrough"},"type":"n8n-nodes-base.executeWorkflowTrigger","typeVersion":1.1,"position":[-1780,190],"id":"403ee4e2-9970-4841-b941-5d30d82087f8","name":"When Executed by Another Workflow"},{"parameters":{"assignments":{"assignments":[{"id":"7e8b552c-b279-4a74-85ef-f2e3965b1f83","name":"isThreadReply","value":"={{ $json.isThreadReply }}","type":"boolean"},{"id":"b0b94710-1816-454d-bd1d-0363f532acf6","name":"isFirstMessage","value":"={{ $json.isFirstMessage }}","type":"boolean"},{"id":"4da2d3fb-c52c-4f58-b108-100e54048791","name":"data_iso","value":"={{ $json.data_iso }}","type":"string"},{"id":"8554d321-ea31-495a-b8ca-f9df2fedf9ea","name":"data_locale","value":"={{ $json.data_locale }}","type":"string"},{"id":"cb53c976-2fdd-44d1-926e-2dd239b3bd78","name":"mittente","value":"={{ $json.mittente }}","type":"string"},{"id":"9993ad2f-0687-4118-ba42-c770523c2588","name":"oggetto","value":"={{ $json.oggetto }}","type":"string"},{"id":"8f70117f-13c1-469a-b46e-d57f87bfe8c8","name":"messaggio_cliente","value":"={{ $json.messaggio_cliente }}","type":"string"},{"id":"3a3dac83-e7a7-4635-8093-bda745d0d3dd","name":"thread_storico","value":"={{ $json.thread_storico }}","type":"string"},{"id":"5e8d3018-3080-49a0-ac51-1186a6c1e68a","name":"risposta_agent","value":"={{ $json.output.risposta_html }}","type":"string"},{"id":"1369f55d-5a52-4926-9cbb-1982d7b907ac","name":"order_id","value":"={{ $json.order_id }}","type":"string"},{"id":"fb9e5054-44a5-4e15-8358-b4ab5b1144d9","name":"customer_email","value":"={{ $json.mittente }}","type":"string"},{"id":"f7bb76f3-a4a6-43fd-bc43-74cf4219ca8b","name":"tipo_interazione","value":"={{ $json.output.tipo_interazione }}","type":"string"},{"id":"1c28e214-942f-4cfb-a75a-9b0776c8c2b6","name":"confidence","value":"={{ $json.output.confidence }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-1560,190],"id":"c8f1753b-7dff-4736-9cea-c4e502333a0d","name":"Mappa Campi"},{"parameters":{"jsCode":"const raw = $json.text || '''';\nconst jsonBlock = raw.match(/```json\\n([\\s\\S]*?)\\n```/);\n\nlet parsed = {};\nif (jsonBlock && jsonBlock[1]) {\n  try {\n    parsed = JSON.parse(jsonBlock[1]);\n  } catch (e) {\n    parsed = { error: ''Errore nel parsing JSON interno'' };\n  }\n}\n\nreturn [\n  {\n    json: parsed\n  }\n];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-964,315],"id":"1dacfd3a-5ed0-4c35-ba9c-1d7ee9bf40c9","name":"Trasforma in Json"},{"parameters":{"mode":"combine","combineBy":"combineByPosition","options":{}},"type":"n8n-nodes-base.merge","typeVersion":3.1,"position":[72,-60],"id":"0a242811-ea50-41f7-9d33-ddd78ffb3b67","name":"Merge"},{"parameters":{"tableId":"task_metrics","fieldsUi":{"fieldValues":[{"fieldId":"date","fieldValue":"={{ $json.metrics_payload.data.date }}"},{"fieldId":"total_tasks_created","fieldValue":"={{ $json.metrics_payload.data.total_tasks_created }}"},{"fieldId":"critical_tasks","fieldValue":"={{ $json.metrics_payload.data.critical_tasks }}"},{"fieldId":"high_tasks","fieldValue":"={{ $json.metrics_payload.data.high_tasks }}"},{"fieldId":"medium_tasks","fieldValue":"={{ $json.metrics_payload.data.medium_tasks }}"},{"fieldId":"low_tasks","fieldValue":"={{ $json.metrics_payload.data.low_tasks }}"},{"fieldId":"tasks_completed","fieldValue":"={{ $json.metrics_payload.data.tasks_completed }}"},{"fieldId":"avg_completion_time_hours","fieldValue":"={{ $json.metrics_payload.data.avg_completion_time_hours }}"},{"fieldId":"tracking_tasks","fieldValue":"={{ $json.metrics_payload.data.tracking_tasks }}"},{"fieldId":"refund_tasks","fieldValue":"={{ $json.metrics_payload.data.refund_tasks }}"},{"fieldId":"follow_up_tasks","fieldValue":"={{ $json.metrics_payload.data.follow_up_tasks }}"},{"fieldId":"verification_tasks","fieldValue":"={{ $json.metrics_payload.data.verification_tasks }}"},{"fieldId":"escalation_tasks","fieldValue":"={{ $json.metrics_payload.data.escalation_tasks }}"},{"fieldId":"high_tasks","fieldValue":"={{ $json.metrics_payload.data.high_tasks }}"},{"fieldId":"action_type","fieldValue":"={{ $json.action_type }}"}]}},"id":"278f6e20-b900-434b-848c-c3dea082b0b0","name":"CREATE Metrics","type":"n8n-nodes-base.supabase","typeVersion":1,"position":[512,215],"credentials":{"supabaseApi":{"id":"U18uJwD80Uq036TV","name":"Supabase tiziano.annicchiarico@gmail.com"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"is-urgent","leftValue":"={{ $json.urgent_notification }}","rightValue":true,"operator":{"type":"boolean","operation":"equals"}}],"combinator":"and"},"options":{}},"id":"be9e165e-f32f-4f5e-8da3-6a8427a5cf33","name":"URGENTE?","type":"n8n-nodes-base.if","typeVersion":2.2,"position":[512,-60]},{"parameters":{"jsCode":"// üß† SMART METRICS UPDATER - Nodo CODE intelligente\n// Input: task dal Task Enricher\n// Output: dati completi + azione da fare (CREATE/UPDATE)\n\nconst task = $json;\nconst today = new Date().toISOString().split(''T'')[0]; // 2025-05-29\n\nconsole.log(''üìä Processing task:'', task.id);\nconsole.log(''üìÖ Date:'', today);\nconsole.log(''üéØ Action type:'', task.action_type);\nconsole.log(''‚ö° Priority:'', task.priority);\n\n// üîç CHECK se esiste gi√† record per oggi usando API Supabase\nconst supabaseUrl = ''https://your-project.supabase.co'';\nconst supabaseKey = ''your-anon-key''; // Prendi dalle credenziali\n\nlet recordExists = false;\nlet existingRecord = null;\n\ntry {\n  // Chiamata API per verificare se esiste record di oggi\n  const response = await fetch(`${supabaseUrl}/rest/v1/task_metrics?date=eq.${today}`, {\n    method: ''GET'',\n    headers: {\n      ''apikey'': supabaseKey,\n      ''Authorization'': `Bearer ${supabaseKey}`,\n      ''Content-Type'': ''application/json''\n    }\n  });\n  \n  const data = await response.json();\n  recordExists = data && data.length > 0;\n  existingRecord = recordExists ? data[0] : null;\n  \n  console.log(''üîç Record check result:'', recordExists ? ''EXISTS'' : ''NOT FOUND'');\n  \n} catch (error) {\n  console.log(''‚ö†Ô∏è API Error, assuming record does not exist:'', error.message);\n  recordExists = false;\n}\n\n// üìä Calcola metriche da aggiungere\nconst metricsToAdd = {\n  total_tasks_created: 1,\n  critical_tasks: task.priority === ''critical'' ? 1 : 0,\n  high_tasks: task.priority === ''high'' ? 1 : 0,\n  medium_tasks: task.priority === ''medium'' ? 1 : 0,\n  low_tasks: task.priority === ''low'' ? 1 : 0,\n  tasks_completed: 0,\n  avg_completion_time_hours: null,\n  tracking_tasks: task.action_type === ''tracking'' ? 1 : 0,\n  refund_tasks: task.action_type === ''refund'' ? 1 : 0,\n  follow_up_tasks: task.action_type === ''follow_up'' ? 1 : 0,\n  verification_tasks: task.action_type === ''verification'' ? 1 : 0,\n  escalation_tasks: task.action_type === ''escalation'' ? 1 : 0\n};\n\n// üéØ Prepara payload per Supabase\nlet supabasePayload = {};\n\nif (recordExists) {\n  // UPDATE: somma ai valori esistenti\n  supabasePayload = {\n    action: ''UPDATE'',\n    table: ''task_metrics'',\n    filter: { date: today },\n    data: {\n      total_tasks_created: existingRecord.total_tasks_created + metricsToAdd.total_tasks_created,\n      critical_tasks: existingRecord.critical_tasks + metricsToAdd.critical_tasks,\n      high_tasks: existingRecord.high_tasks + metricsToAdd.high_tasks,\n      medium_tasks: existingRecord.medium_tasks + metricsToAdd.medium_tasks,\n      low_tasks: existingRecord.low_tasks + metricsToAdd.low_tasks,\n      tracking_tasks: existingRecord.tracking_tasks + metricsToAdd.tracking_tasks,\n      refund_tasks: existingRecord.refund_tasks + metricsToAdd.refund_tasks,\n      follow_up_tasks: existingRecord.follow_up_tasks + metricsToAdd.follow_up_tasks,\n      verification_tasks: existingRecord.verification_tasks + metricsToAdd.verification_tasks,\n      escalation_tasks: existingRecord.escalation_tasks + metricsToAdd.escalation_tasks\n    }\n  };\n} else {\n  // CREATE: nuovo record\n  supabasePayload = {\n    action: ''CREATE'',\n    table: ''task_metrics'',\n    data: {\n      date: today,\n      ...metricsToAdd\n    }\n  };\n}\n\nconsole.log(''‚úÖ Action determined:'', supabasePayload.action);\nconsole.log(''üìù Payload ready:'', supabasePayload);\n\n// üéØ Output: task originale + info per Supabase\nreturn [{\n  json: {\n    // ‚úÖ Mantiene TUTTI i dati del task originale\n    ...task,\n    \n    // ‚ûï Aggiunge info per aggiornamento metriche\n    metrics_action: supabasePayload.action,\n    metrics_payload: supabasePayload,\n    metrics_summary: {\n      date: today,\n      record_exists: recordExists,\n      metrics_to_add: metricsToAdd,\n      existing_record: existingRecord\n    },\n    \n    // üè∑Ô∏è Metadati\n    processed_at: new Date().toISOString(),\n    processing_node: ''smart_metrics_updater''\n  }\n}];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[72,215],"id":"47710a21-c22b-436f-a3c2-5420a31d4079","name":"METRICS UPDATER"},{"parameters":{"jsCode":"// ========================================\n// TASK ENRICHER - VERSIONE CORRETTA E SICURA\n// Fix per errori di mapping e compatibilit√† DB\n// ========================================\n\n// ‚úÖ Pulisce markdown e fa parse dell''analisi AI\nconst rawText = $(''Conversation Analyzer'').item.json.text.replace(/```json\\n?|\\n?```/g, '''');\nlet analysis = {};\n\ntry {\n  analysis = JSON.parse(rawText);\n  console.log(''‚úÖ Analysis parsed successfully:'', analysis);\n} catch (error) {\n  console.error(''‚ùå Error parsing analysis JSON:'', error.message);\n  // Fallback con valori di default sicuri\n  analysis = {\n    urgency_level: ''medium'',\n    action_type: ''follow_up'',\n    customer_sentiment: ''neutral'',\n    confidence: 50,\n    deadline_hours: 24\n  };\n}\n\nconst currentTime = new Date();\n\n// ========================================\n// üó∫Ô∏è MAPPING SICURO DEI VALORI\n// ========================================\n\n// Priority mapping - converte urgency_level in priority valido\nconst PRIORITY_MAPPING = {\n  ''critical'': ''critical'',\n  ''high'': ''high'',\n  ''medium'': ''medium'', \n  ''low'': ''low''\n};\n\n// Action type mapping - solo valori supportati dal DB\nconst ACTION_TYPE_MAPPING = {\n  ''tracking'': ''tracking'',\n  ''delivery'': ''tracking'',      // Mappa delivery su tracking (esiste nel DB)\n  ''refund'': ''refund'',\n  ''follow_up'': ''follow_up'',\n  ''verification'': ''verification'',\n  ''escalation'': ''escalation'',\n  ''installation'': ''follow_up'', // Mappa installation su follow_up\n  ''product_info'': ''follow_up'', // Mappa product_info su follow_up\n  ''return'': ''verification'',    // Mappa return su verification\n  ''invoice_request'': ''follow_up'' // Mappa invoice_request su follow_up\n};\n\n// Customer satisfaction mapping\nconst SATISFACTION_MAPPING = {\n  ''satisfied'': ''satisfied'',\n  ''neutral'': ''neutral'',\n  ''frustrated'': ''frustrated'',\n  ''angry'': ''angry''\n};\n\n// ========================================\n// üîß FUNZIONI UTILITY\n// ========================================\n\nfunction generateUUID() {\n  return ''task_'' + Date.now() + ''_'' + Math.random().toString(36).substr(2, 9);\n}\n\nfunction calculateDeadline(hours) {\n  const deadline = new Date(currentTime);\n  \n  // Validazione input\n  const validHours = Math.max(1, Math.min(168, parseInt(hours) || 24)); // Min 1h, Max 1 settimana\n  deadline.setHours(deadline.getHours() + validHours);\n\n  // Evita orari notturni (22:00 - 08:00)\n  const hour = deadline.getHours();\n  if (hour >= 22 || hour < 8) {\n    deadline.setHours(8, 0, 0, 0);\n    if (hour >= 22) deadline.setDate(deadline.getDate() + 1);\n  }\n\n  // Evita weekend\n  const day = deadline.getDay();\n  if (day === 0) deadline.setDate(deadline.getDate() + 1); // Domenica ‚Üí Luned√¨\n  if (day === 6) deadline.setDate(deadline.getDate() + 2); // Sabato ‚Üí Luned√¨\n\n  return deadline.toISOString();\n}\n\nfunction safeMappingLookup(value, mapping, defaultValue) {\n  const normalized = String(value || '''').toLowerCase().trim();\n  return mapping[normalized] || defaultValue;\n}\n\nfunction validateConfidence(confidence) {\n  const parsed = parseInt(confidence);\n  if (isNaN(parsed)) return 50;\n  return Math.max(0, Math.min(100, parsed));\n}\n\n// ========================================\n// üìä ESTRAZIONE E VALIDAZIONE DATI\n// ========================================\n\n// Dati di input dal workflow principale\nconst inputData = $(''Mappa Campi'').item.json;\n\n// Estrai e valida i campi principali\nconst mappedPriority = safeMappingLookup(\n  analysis.urgency_level, \n  PRIORITY_MAPPING, \n  ''medium''\n);\n\nconst mappedActionType = safeMappingLookup(\n  analysis.action_type,\n  ACTION_TYPE_MAPPING,\n  ''follow_up''  \n);\n\nconst mappedSatisfaction = safeMappingLookup(\n  analysis.customer_satisfaction,\n  SATISFACTION_MAPPING,\n  ''neutral''\n);\n\nconst validatedConfidence = validateConfidence(analysis.confidence);\nconst deadlineHours = parseInt(analysis.deadline_hours) || 24;\n\n// ========================================\n// üèóÔ∏è COSTRUZIONE TASK COMPLETO\n// ========================================\n\nconst enrichedTask = {\n  // ‚úÖ Campi ID e timestamp\n  id: generateUUID(),\n  created_at: currentTime.toISOString(),\n  updated_at: currentTime.toISOString(),\n  \n  // ‚úÖ Campi task base - VALORI SICURI E MAPPATI\n  title: analysis.required_actions?.length > 0 \n    ? `Azione: ${analysis.required_actions[0]}` \n    : ''Follow-up cliente necessario'',\n  description: analysis.customer_sentiment || ''Analisi conversazione richiesta'',\n  priority: mappedPriority,\n  status: ''pending'',\n  action_type: mappedActionType,\n  deadline: calculateDeadline(deadlineHours),\n  \n  // ‚úÖ Dati cliente (dal workflow principale)\n  customer_email: inputData.customer_email || inputData.mittente || '''',\n  customer_name: inputData.mittente_nome || null,\n  order_id: inputData.order_id || null,\n  email_subject: inputData.oggetto || '''',\n  \n  // ‚úÖ Campi analisi - VALIDATI E SICURI\n  confidence: validatedConfidence,\n  confidence_reasoning: analysis.confidence_reasoning || ''Analisi automatica'',\n  analysis_quality: validatedConfidence >= 90 ? ''reliable'' : \n                   validatedConfidence >= 70 ? ''needs_validation'' : ''low_confidence'',\n  \n  // ‚úÖ Campi interazione\n  tipo_interazione: inputData.tipo_interazione || ''Standard'',\n  customer_satisfaction: mappedSatisfaction,\n  customer_sentiment: analysis.customer_sentiment || ''neutral'',\n  \n  // ‚úÖ Promesse e azioni AI (come JSONB)\n  ai_promises: Array.isArray(analysis.ai_promises) ? analysis.ai_promises : [],\n  required_actions: Array.isArray(analysis.required_actions) ? analysis.required_actions : [],\n  ai_commitments: Array.isArray(analysis.ai_promises) ? analysis.ai_promises : [],\n  \n  // ‚úÖ Flags booleani\n  follow_up_needed: Boolean(analysis.follow_up_needed),\n  gap_identified: Boolean(analysis.gap_identified),\n  validation_required: validatedConfidence < 70,\n  validation_completed: false,\n  \n  // ‚úÖ Timing\n  deadline_hours: deadlineHours,\n  \n  // ‚úÖ Contesto conversazione (JSONB)\n  conversation_context: {\n    analysis: analysis,\n    input_data: {\n      messaggio_cliente: inputData.messaggio_cliente,\n      thread_storico: inputData.thread_storico,\n      isThreadReply: inputData.isThreadReply\n    }\n  },\n  \n  // ‚úÖ Metadati workflow\n  source: ''smart_analyzer'',\n  processing_node: ''task_enricher_enhanced'',\n  workflow_version: ''v2.1_safe_mapping'',\n  n8n_execution_id: $execution.id,\n  assigned_to: null,\n  notes: analysis.notes || '''',\n  \n  // ‚úÖ Campi notifica\n  urgent_notification: mappedPriority === ''critical'',\n  telegram_sent: false,\n  whatsapp_sent: false,\n  email_sent: false,\n  calendar_created: false,\n  \n  // ‚úÖ Campi esecuzione\n  execution_status: ''pending'',\n  execution_requirements: analysis.required_actions?.join(''; '') || ''Seguire le istruzioni standard'',\n  urgency_justification: analysis.urgency_justification || `Priorit√† ${mappedPriority} basata su analisi automatica`,\n  \n  // ‚úÖ Timestamp processing\n  processing_start_time: currentTime.toISOString(),\n  processing_end_time: new Date().toISOString(),\n  processing_duration_ms: Date.now() - currentTime.getTime()\n};\n\n// ========================================\n// üîç LOGGING E VALIDAZIONE FINALE\n// ========================================\n\nconsole.log(''‚úÖ Task arricchito generato:'');\nconsole.log(''üìß Customer Email:'', enrichedTask.customer_email);\nconsole.log(''üì¶ Order ID:'', enrichedTask.order_id || ''N/A'');\nconsole.log(''‚ö° Priority:'', enrichedTask.priority);\nconsole.log(''üéØ Action Type:'', enrichedTask.action_type);\nconsole.log(''üéØ Confidence:'', enrichedTask.confidence + ''%'');\nconsole.log(''‚è∞ Deadline:'', enrichedTask.deadline);\nconsole.log(''üîî Urgent Notification:'', enrichedTask.urgent_notification);\n\n// Verifica campi critici\nconst criticalFields = [''customer_email'', ''priority'', ''action_type''];\nfor (const field of criticalFields) {\n  if (!enrichedTask[field]) {\n    console.warn(`‚ö†Ô∏è Campo critico mancante: ${field}`);\n  }\n}\n\n// ========================================\n// üì§ RETURN TASK SICURO\n// ========================================\n\nreturn [{ json: enrichedTask }];"},"id":"49d4e876-316e-4ee4-917d-bc578096ffb4","name":"Task Enricher","type":"n8n-nodes-base.code","typeVersion":2,"position":[-148,165]},{"parameters":{"promptType":"define","text":"=## RUOLO E OBIETTIVO\nSei un esperto supervisore del servizio clienti specializzato nell''identificare gap operativi in un **business di dropshipping pneumatici auto/moto** quando l''AI fa promesse che richiedono azioni del team umano.\n\n**OBIETTIVO**: Identificare con precisione le promesse dell''AI che necessitano follow-up operativo nel contesto specifico del dropshipping pneumatici.\n\n## FRAMEWORK SPECIFICO PNEUMATICI (Focus Tracking Mancanti)\n- **CRITICO**: Consegne parziali, errori compatibilit√†, ordini smarriti, problemi pagamento\n- **ALTO**: **TRACKING MANCANTI/SBAGLIATI** (70% dei casi - spesso GAP), ritardi prolungati (>7 giorni)\n- **MEDIO**: Richieste info con tracking funzionante, aggiornamenti status, verifiche routine  \n- **BASSO**: Conferme ordine, FAQ, compatibilit√† pneumatici\n\n**REALT√Ä BUSINESS**: Il 70% delle chiamate √® per tracking mancanti/sbagliati dove l''AI DEVE promettere verifiche/invii = GAP operativo reale.\n\n## DATI CONVERSAZIONE (Variables)\n```\n{THREAD_REPLY} = {{ $json.isThreadReply }}\n{FIRST_MESSAGE} = {{ $json.isFirstMessage }}\n{DATE_ISO} = {{ $json.data_iso }}\n{SENDER} = {{ $json.mittente }}\n{SUBJECT} = {{ $json.oggetto }}\n{CUSTOMER_MESSAGE} = {{ $json.messaggio_cliente }}\n{AI_RESPONSE} = {{ $json.risposta_agent }}\n{THREAD_HISTORY} = {{ $json.thread_storico }}\n{INITIAL_CONFIDENCE} = {{ $json.confidence }}\n```\n\n## METODOLOGIA SPECIALIZZATA (Step-Back + Chain of Thought)\n\n**STEP 1 - STEP-BACK PROMPTING**: Prima di analizzare, considera:\n- Nel dropshipping pneumatici, il 70% delle richieste riguarda tracking MANCANTI/SBAGLIATI\n- Quando manca tracking, l''AI DEVE promettere verifiche/invio = GAP operativo reale\n- Come distinguere tra \"tracking mancante\" (problema sistemico) vs \"tracking completo\" (caso raro)?\n- Le promesse \"verificheremo e invieremo tracking\" sono NECESSARIE quando info mancanti\n\n**STEP 2 - CHAIN OF THOUGHT REASONING**: Analizza step-by-step:\n\n1. **Analisi Customer Request Pneumatici**: \n   - √à una richiesta tracking standard? (70% dei casi)\n   - **REGOLA**: Se cliente dice \"faccio presente\", \"notifica\", \"segnalo\" = TONO NEUTRALE\n   - **DISTINGUI**: Tracking con info mancanti vs ansia normale cliente\n   - Che tipo di problema tracking? (link non funziona, codice errato, info incomplete, nessun tracking ricevuto)\n   - L''AI ha informazioni sufficienti per risolvere o deve cercare/verificare?\n\n2. **Analisi AI Response Tracking-Focused**:\n   - **CASO A - TRACKING MANCANTE** (70% casi): AI non ha tracking = DEVE promettere verifica/invio = GAP\n   - **CASO B - TRACKING COMPLETO** (30% casi): Ha tracking + status + ubicazione = NO GAP  \n   - **PROMESSE NECESSARIE**: \"verificheremo\", \"ti invieremo\", \"controlleremo sistema\" = GAP giustificato\n   - **TRACKING MANCANTE**: AI promette \"verificher√≤ e ti invier√≤\" = GAP operativo reale\n   - **TRACKING PRESENTE**: Link funzionante + spiegazione + status = NO GAP\n   - **INFO INSUFFICIENTI**: AI dice \"√® in transito\" senza tracking = GAP (deve fornire tracking)\n\n3. **Gap Identification Tracking-Missing-Aware**:\n   - **REGOLA 70%**: La maggior parte richieste = tracking MANCANTI = GAP necessario e giustificato\n   - L''AI ha tracking da fornire immediatamente o deve cercare/verificare?\n   - **TRACKING MANCANTE**: AI deve promettere \"verificher√≤ e ti invier√≤\" = GAP operativo giusto\n   - **TRACKING PRESENTE**: AI risolve immediatamente con info = NO GAP\n   - Le promesse di verifica tracking sono NECESSARIE quando tracking mancante\n\n4. **Confidence Calibrata Tracking-First**:\n   - 90-100%: Promesse coordinate fornitore/corriere con timeline specifici\n   - 70-89%: Impegni operativi concreti + **TRACKING PROMISES con timeline**\n   - **50-69%: TRACKING INFO MANCANTI con promesse generiche** (\"verificheremo\", \"controlleremo\")\n   - **20-40%: TRACKING CON INFO COMPLETE** (caso pi√π comune - NO GAP)\n   - 0-19%: Gestione completa senza necessit√† operative\n\n## ESEMPI SPECIFICI PNEUMATICI\n\n### Esempio 1 - TRACKING MANCANTE: GAP ALTO (75%)\n**Input**: \n- Cliente: \"Non ho mai ricevuto il tracking del mio ordine pneumatici\"\n- AI: \"Mi scuso per l''inconveniente. **Verificher√≤ lo stato del tuo ordine** e **ti invier√≤ il tracking entro oggi**\"\n\n**Output**:\n```json\n{\n  \"reasoning_steps\": {\n    \"customer_request_analysis\": \"Tracking mai ricevuto - caso comune 70% che richiede azione\",\n    \"ai_promises_identified\": [\"Verificher√≤ lo stato del tuo ordine\", \"Ti invier√≤ il tracking entro oggi\"],\n    \"gap_evaluation\": \"AI non ha tracking disponibile, promette verifica e invio - gap operativo necessario e giustificato\",\n    \"confidence_calculation\": \"75% perch√© tracking mancante richiede azione operativa reale per completare servizio\"\n  },\n  \"gap_identified\": true,\n  \"confidence\": 75,\n  \"customer_satisfaction\": \"neutral\",\n  \"ai_promises\": [\"Verificher√≤ lo stato del tuo ordine\", \"Ti invier√≤ il tracking entro oggi\"],\n  \"required_actions\": [\"Verificare stato ordine nel sistema\", \"Inviare tracking al cliente\"],\n  \"urgency_level\": \"high\",\n  \"follow_up_needed\": true,\n  \"deadline_hours\": 8,\n  \"action_type\": \"tracking\",\n  \"customer_sentiment\": \"Cliente che necessita informazioni tracking mancanti\",\n  \"notes\": \"Tracking mancante - caso comune che richiede verifica sistema e invio\"\n}\n```\n\n### Esempio 2 - TRACKING LINK SBAGLIATO: GAP ALTO (80%)\n**Input**:\n- Cliente: \"Il link tracking che mi avete mandato non funziona\"\n- AI: \"**Verificheremo il problema** e **ti invieremo un tracking corretto entro oggi**\"\n\n**Output**:\n```json\n{\n  \"reasoning_steps\": {\n    \"customer_request_analysis\": \"Link tracking errato - caso comune che blocca il cliente\",\n    \"ai_promises_identified\": [\"Verificheremo il problema\", \"Ti invieremo tracking corretto entro oggi\"],\n    \"gap_evaluation\": \"Tracking errato richiede verifica sistema e invio link corretto - gap operativo necessario\",\n    \"confidence_calculation\": \"80% per tracking errato che richiede fix e reinvio con timeline specifico\"\n  },\n  \"gap_identified\": true,\n  \"confidence\": 80,\n  \"customer_satisfaction\": \"frustrated\",\n  \"ai_promises\": [\"Verificheremo il problema\", \"Ti invieremo tracking corretto entro oggi\"],\n  \"required_actions\": [\"Verificare problema tracking sistema\", \"Inviare link tracking corretto\"],\n  \"urgency_level\": \"high\",\n  \"follow_up_needed\": true,\n  \"deadline_hours\": 8,\n  \"action_type\": \"tracking\",\n  \"customer_sentiment\": \"Cliente frustrato per tracking non funzionante\",\n  \"notes\": \"Fix tracking errato urgente - customer experience compromessa\"\n}\n```\n\n### Esempio 3 - TRACKING COMPLETO RARO: NESSUN GAP (30%)\n**Input**:\n- Cliente: \"Non riesco a trovare il tracking\"\n- AI: \"Il tuo ordine √® spedito con GLS, codice: 12345678. Stato: in transito verso Firenze. Consegna prevista domani.\"\n\n**Output**:\n```json\n{\n  \"reasoning_steps\": {\n    \"customer_request_analysis\": \"Richiesta tracking - caso meno comune dove AI ha info complete\",\n    \"ai_promises_identified\": [],\n    \"gap_evaluation\": \"AI ha fornito tracking completo, status e tempistiche - problema risolto immediatamente\",\n    \"confidence_calculation\": \"30% perch√© AI ha tutte le informazioni necessarie per risolvere autonomamente\"\n  },\n  \"gap_identified\": false,\n  \"confidence\": 30,\n  \"customer_satisfaction\": \"satisfied\",\n  \"ai_promises\": [],\n  \"required_actions\": [],\n  \"urgency_level\": \"low\",\n  \"follow_up_needed\": false,\n  \"deadline_hours\": 0,\n  \"action_type\": \"none\",\n  \"customer_sentiment\": \"Cliente soddisfatto delle informazioni complete\",\n  \"notes\": \"Tracking completo fornito - caso raro dove AI risolve autonomamente\"\n}\n```\n\n### Esempio 4 - ANSIA CLIENTE CON INFO COMPLETE: NESSUN GAP (30%)\n**Input**:\n- Cliente: \"Sono passati 3 giorni, quando arrivano i pneumatici?\"\n- AI: \"Il tuo ordine √® regolarmente in transito. Spedito 2 giorni fa, consegna prevista domani. Tracking: ABC123 - attualmente a Milano.\"\n\n**Output**:\n```json\n{\n  \"reasoning_steps\": {\n    \"customer_request_analysis\": \"Ansia cliente per tempistiche - richiesta rassicurazioni standard\",\n    \"ai_promises_identified\": [],\n    \"gap_evaluation\": \"AI ha fornito informazioni complete su status e previsioni - ansia cliente gestita con info\",\n    \"confidence_calculation\": \"30% perch√© informazioni tracking complete risolvono ansia senza azioni\"\n  },\n  \"gap_identified\": false,\n  \"confidence\": 30,\n  \"customer_satisfaction\": \"neutral\",\n  \"ai_promises\": [],\n  \"required_actions\": [],\n  \"urgency_level\": \"low\",\n  \"follow_up_needed\": false,\n  \"deadline_hours\": 0,\n  \"action_type\": \"none\",\n  \"customer_sentiment\": \"Cliente ansioso ma rassicurato dalle info\",\n  \"notes\": \"Ansia spedizione standard - info tracking complete sufficienti\"\n}\n```\n\n### Esempio 5 - TRACKING MANCANTE CON INFO: NESSUN GAP (25%)\n**Input**:\n- Cliente: \"Non ho mai ricevuto il tracking per il mio ordine\"\n- AI: \"Ti fornisco subito il tracking: GLS 98765432. Il pacco √® in consegna oggi a Roma. Mi scuso per l''omissione.\"\n\n**Output**:\n```json\n{\n  \"reasoning_steps\": {\n    \"customer_request_analysis\": \"Tracking mai ricevuto - problema amministrativo risolto dall''AI\",\n    \"ai_promises_identified\": [],\n    \"gap_evaluation\": \"AI ha fornito tracking immediato e risolto problema - nessuna azione aggiuntiva necessaria\",\n    \"confidence_calculation\": \"25% perch√© problema tracking risolto completamente dall''AI\"\n  },\n  \"gap_identified\": false,\n  \"confidence\": 25,\n  \"customer_satisfaction\": \"satisfied\",\n  \"ai_promises\": [],\n  \"required_actions\": [],\n  \"urgency_level\": \"low\",\n  \"follow_up_needed\": false,\n  \"deadline_hours\": 0,\n  \"action_type\": \"none\",\n  \"customer_sentiment\": \"Cliente soddisfatto della risoluzione immediata\",\n  \"notes\": \"Tracking mancante risolto immediatamente - problema amministrativo chiuso\"\n}\n```\n\n## FORMATO OUTPUT PNEUMATICI\n```json\n{\n  \"reasoning_steps\": {\n    \"customer_request_analysis\": \"analisi specifica problema pneumatici\",\n    \"ai_promises_identified\": [\"promesse operative identificate\"],\n    \"gap_evaluation\": \"necessit√† coordinamento supply chain/corrieri\",\n    \"confidence_calculation\": \"logica calcolo per dropshipping automotive\"\n  },\n  \"gap_identified\": boolean,\n  \"confidence\": number (0-100),\n  \"confidence_reasoning\": \"spiegazione contestualizzata pneumatici\",\n  \"customer_satisfaction\": \"satisfied|neutral|frustrated|angry\",\n  \"ai_promises\": [\"solo impegni operativi reali\"],\n  \"required_actions\": [\"azioni specifiche dropshipping pneumatici\"],\n  \"urgency_level\": \"critical|high|medium|low\",\n  \"follow_up_needed\": boolean,\n  \"deadline_hours\": number,\n  \"action_type\": \"delivery|tracking|return|verification|supplier_contact|technical|none\",\n  \"customer_sentiment\": \"analisi sentiment automotive context\",\n  \"notes\": \"osservazioni specifiche business pneumatici\"\n}\n```\n\n## PRINCIPI SPECIALIZZATI TRACKING-FIRST\n- **TRACKING REQUESTS = 70% dei casi**: La maggior parte NON richiede azione se AI fornisce info complete\n- **INFO COMPLETE = NO GAP**: Link funzionante + status + tempistiche = problema risolto\n- **PROMESSE RARE**: Solo per problemi tecnici o coordinamento reale necessario\n- **ANSIA CLIENTE NORMALE**: Rassicurazioni con info dettagliate = sufficiente\n- **FOCUS SU AZIONI CONCRETE**: Gap solo quando serve intervento operativo reale\n\n**REGOLA AUREA TRACKING CORRETTA**:\n- **TRACKING MANCANTE/SBAGLIATO** (70% casi) = confidence 70-85% (GAP giustificato e necessario)\n- **TRACKING COMPLETO** (30% casi) = confidence 20-30% (NO GAP)  \n- **PROMESSE VERIFICA/INVIO** = GAP operativo reale quando tracking mancante\n- **AI SENZA INFO** = DEVE promettere verifiche = GAP necessario per completare servizio\n- **AI CON INFO COMPLETE** = risolve autonomamente = NO GAP\n\n**BUSINESS REALITY**: Nel dropshipping, tracking mancanti sono problemi sistemici reali che richiedono azione operativa!\n\n**ISTRUZIONI FINALI**: \n- Considera sempre il contesto automotive (sicurezza, urgenza mobilit√†)\n- Distingui tra problemi gestibili vs. necessit√† coordinamento supply chain\n- Mantieni focus su customer satisfaction nel settore automotive\n- Il reasoning deve riflettere le specificit√† del business pneumatici"},"id":"98d28e5c-e181-4d73-a09c-a89ebd2467f1","name":"Conversation Analyzer","type":"@n8n/n8n-nodes-langchain.chainLlm","typeVersion":1.5,"position":[-1340,315],"notes":"You are an expert customer service supervisor specializing in conversation analysis. Your role is to identify operational gaps when AI assistants make promises requiring human team action.\n\nCORE RESPONSIBILITIES:\n- Identify specific AI promises requiring operational follow-up\n- Assess customer satisfaction and urgency levels  \n- Determine concrete actions needed with realistic deadlines\n- Provide confidence scores with clear reasoning\n\nDECISION FRAMEWORK:\n- CRITICAL: Missing tracking, partial deliveries, promised refunds, system errors\n- HIGH: Delivery issues, returns processing, promised carrier contacts\n- MEDIUM: General inquiries, courtesy follow-ups, status checks\n- LOW: Confirmations, thanks, standard FAQ responses\n\nOUTPUT REQUIREMENTS:\n- Valid JSON format only\n- Realistic confidence scores (0-100) with brief reasoning\n- Specific, actionable tasks\n- Conservative approach: avoid creating unnecessary tasks\n\nCONFIDENCE SCORING:\n- 90-100%: Clear promises with specific timelines and complete data\n- 70-89%: Probable gaps with mostly complete information\n- 50-69%: Possible gaps requiring validation\n- 0-49%: No identifiable operational actions needed\n```\n\n## Main Prompt (Ottimizzato):\n\n```\nAnalyze this customer-AI conversation to identify operational gaps and follow-up needs.\n\nCONVERSATION DATA:\n{{ $json.isThreadReply }}\n{{ $json.isFirstMessage }}\n{{ $json.data_iso }}\n{{ $json.mittente }}\n{{ $json.oggetto }}\n{{ $json.messaggio_cliente }}\n{{ $json.risposta_agent }}\n{{ $json.thread_storico }}\n{{ $json.confidence }}\n\nANALYSIS FOCUS:\n1. What did the customer specifically request?\n2. What did the AI promise or commit to?\n3. Are there gaps between request and response requiring operational action?\n4. What concrete actions does the team need to take?\n5. What is the customer''s satisfaction level?\n6. What is the real urgency of the situation?\n\nEXAMPLE CRITICAL GAPS:\n- Customer: \"Can''t find tracking\" + AI: \"Will be available\" = ACTION: Insert real tracking\n- Customer: \"Received only 1 tire\" + AI: \"Will contact carrier\" = ACTION: Verify contact made\n- Customer: \"Want refund\" + AI: \"Will process in 3 days\" = ACTION: Process refund by deadline\n\nReturn analysis in this JSON format:\n{\n  \"gap_identified\": boolean,\n  \"confidence\": number(0-100),\n  \"confidence_reasoning\": \"breve spiegazione del punteggio in italiano\",\n  \"customer_satisfaction\": \"satisfied|neutral|frustrated|angry\",\n  \"ai_promises\": [\"specific AI commitments in Italian\"],\n  \"required_actions\": [\"azioni operative concrete in italiano\"],\n  \"urgency_level\": \"critical|high|medium|low\",\n  \"follow_up_needed\": boolean,\n  \"deadline_hours\": number,\n  \"action_type\": \"tracking|refund|delivery|follow_up|verification|escalation\",\n  \"customer_sentiment\": \"analisi sentiment in italiano\",\n  \"notes\": \"osservazioni specifiche in italiano\"\n}\n```\n\n## Few-Shot Examples (Da aggiungere):\n\n### Example 1 - Critical Gap:\n```\nINPUT: Customer: \"Ho ordinato 4 pneumatici ma ne ho ricevuto solo 2\"\nAI: \"Mi dispiace per l''inconveniente. Contatteremo immediatamente il corriere per rintracciare i pneumatici mancanti e ti faremo sapere entro 24 ore.\"\n\nOUTPUT:\n{\n  \"gap_identified\": true,\n  \"confidence\": 95,\n  \"confidence_reasoning\": \"AI made specific promise with timeline - carrier contact needed\",\n  \"customer_satisfaction\": \"frustrated\",\n  \"ai_promises\": [\"Contact carrier immediately\", \"Update within 24 hours\"],\n  \"required_actions\": [\"Contact carrier for missing tires\", \"Follow up with customer in 24h\"],\n  \"urgency_level\": \"critical\",\n  \"follow_up_needed\": true,\n  \"deadline_hours\": 24,\n  \"action_type\": \"delivery\",\n  \"customer_sentiment\": \"frustrated but expecting resolution\",\n  \"notes\": \"Partial delivery - high priority for customer retention\"\n}\n```\n\n### Example 2 - No Gap:\n```\nINPUT: Customer: \"Quando arriva il mio ordine?\"\nAI: \"Il tuo ordine √® stato spedito ieri e arriver√† entro 2-3 giorni lavorativi. Puoi seguire la spedizione con il codice tracking ABC123.\"\n\nOUTPUT:\n{\n  \"gap_identified\": false,\n  \"confidence\": 90,\n  \"confidence_reasoning\": \"Standard info provided, tracking available, no promises requiring action\",\n  \"customer_satisfaction\": \"satisfied\",\n  \"ai_promises\": [],\n  \"required_actions\": [],\n  \"urgency_level\": \"low\",\n  \"follow_up_needed\": false,\n  \"deadline_hours\": 0,\n  \"action_type\": \"follow_up\",\n  \"customer_sentiment\": \"neutral inquiry\",\n  \"notes\": \"Standard delivery inquiry - no action needed\"\n}\n```\n\n### Example 3 - Medium Gap:\n```\nINPUT: Customer: \"Il corriere non trova il mio indirizzo\"\nAI: \"Verificheremo con il corriere e aggiorneremo l''indirizzo di consegna. Ti ricontatteremo oggi stesso.\"\n\nOUTPUT:\n{\n  \"gap_identified\": true,\n  \"confidence\": 85,\n  \"confidence_reasoning\": \"Clear promise to contact carrier and customer today\",\n  \"customer_satisfaction\": \"neutral\",\n  \"ai_promises\": [\"Verify with carrier\", \"Update delivery address\", \"Contact customer today\"],\n  \"required_actions\": [\"Contact carrier about address\", \"Update delivery details\", \"Call customer with update\"],\n  \"urgency_level\": \"high\",\n  \"follow_up_needed\": true,\n  \"deadline_hours\": 8,\n  \"action_type\": \"delivery\",\n  \"customer_sentiment\": \"concerned but patient\",\n  \"notes\": \"Address verification needed - delivery blocked\"\n}\n```\n\n## Configuration Settings:\n- Temperature: 0.1 (deterministic for operational consistency)\n- Top-K: 20 (focused responses)  \n- Top-P: 0.9 (slight creativity for nuanced analysis)\n- Token Limit: 1000 (sufficient for structured output + reasoning)\n\n## Confidence Scale Optimization:\nPer semplicit√† operativa, considera questa mappatura:\n- 90-100%: CERTO - Gap chiaramente identificabile\n- 70-89%: PROBABILE - Gap molto probabile con dati sufficienti\n- 50-69%: INCERTO - Gap possibile ma necessita validazione\n- 0-49%: NESSUNO - Nessun gap operativo identificabile\n\n## Multilingual Output:\n- Campi tecnici in inglese: \"critical\", \"high\", \"satisfied\", ecc.\n- Campi descrittivi in italiano: \"confidence_reasoning\", \"notes\", \"customer_sentiment\""},{"parameters":{},"id":"3c0a62a7-d910-4944-a54b-e077837b7f13","name":"No Action Needed","type":"n8n-nodes-base.noOp","typeVersion":1,"position":[-446,465]},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":1},"conditions":[{"value1":"={{ $json.metrics_action }}","operation":"equal","value2":"CREATE","id":"ca4cfffc-6758-4763-bc5e-3f7cef745fc4"},{"id":"4de5e21d-175b-4094-a5c1-3a4b82c5f38c","leftValue":"={{ $json.metrics_action }}","rightValue":"CREATE","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"options":{}},"name":"Check if CREATE Metrics","type":"n8n-nodes-base.if","typeVersion":2,"position":[-1780,-680],"id":"496b5198-2142-4569-bfa6-04290cb2cb1b"},{"parameters":{},"name":"‚Üí Connect to CREATE Metrics","type":"n8n-nodes-base.noOp","typeVersion":1,"position":[-1780,-420],"id":"c33bd4e0-7d77-4574-8a8b-6413a239f790"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"loose","version":2},"conditions":[{"id":"2f9f0239-3637-48c6-8230-ad69975b238e","leftValue":"={{ $json.metrics_action }}","rightValue":"CREATE","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"},"looseTypeValidation":true,"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[292,215],"id":"459f378d-f620-499e-a552-ce866a0cb781","name":"If"}]', '{"OpenAI Analyzer":{"ai_languageModel":[[{"node":"Conversation Analyzer","type":"ai_languageModel","index":0}]]},"‚ùì Gap Detected?":{"main":[[{"node":"‚öôÔ∏è Smart Task Generator","type":"main","index":0}],[{"node":"No Action Needed","type":"main","index":0}]]},"‚öôÔ∏è Smart Task Generator":{"main":[[{"node":"Task Enricher","type":"main","index":0}]]},"OpenAI Task Gen":{"ai_languageModel":[[{"node":"‚öôÔ∏è Smart Task Generator","type":"ai_languageModel","index":0}]]},"üíæ Supabase Insert":{"main":[[{"node":"URGENTE?","type":"main","index":0}]]},"üì± Telegram Urgent":{"main":[[]]},"Microsoft Outlook":{"main":[[]]},"When Executed by Another Workflow":{"main":[[{"node":"Mappa Campi","type":"main","index":0}]]},"Mappa Campi":{"main":[[{"node":"Conversation Analyzer","type":"main","index":0},{"node":"Merge","type":"main","index":0}]]},"Trasforma in Json":{"main":[[{"node":"‚ùì Gap Detected?","type":"main","index":0}]]},"Merge":{"main":[[{"node":"üíæ Supabase Insert","type":"main","index":0}]]},"CREATE Metrics":{"main":[[]]},"URGENTE?":{"main":[[{"node":"Microsoft Outlook","type":"main","index":0},{"node":"üì± Telegram Urgent","type":"main","index":0}],[]]},"METRICS UPDATER":{"main":[[{"node":"If","type":"main","index":0}]]},"Task Enricher":{"main":[[{"node":"Merge","type":"main","index":1},{"node":"METRICS UPDATER","type":"main","index":0}]]},"Conversation Analyzer":{"main":[[{"node":"Trasforma in Json","type":"main","index":0}]]},"No Action Needed":{"main":[[]]},"Check if CREATE Metrics":{"main":[[]]},"If":{"main":[[{"node":"CREATE Metrics","type":"main","index":0}]]}}', '{"executionOrder":"v1"}', NULL, '{"When Executed by Another Workflow":[{"json":{"output":{"categoria":"Assistenza Ordini","tipo_interazione":"Aggiornamento Tracking","confidence":"high","risposta_html":"<p>Gentile Geometra Cappellacci,</p>\n<p>La ringrazio per la Sua pazienza e comprensione in merito alla consegna dei pneumatici da Lei ordinati.</p>\n<p>Dopo aver effettuato le dovute verifiche, Le confermo che il <strong>secondo pneumatico</strong> √® attualmente in transito ed √® stato bloccato presso la sede GLS a Livorno. Questo tipo di ritardo √® occasionale e pu√≤ capitare a causa di complessit√† logistiche o sovraccarico nella rete di distribuzione.</p>\n<p>Le assicuro che il Suo pneumatico verr√† consegnato a breve. Per ulteriori informazioni, pu√≤ monitorare direttamente lo stato della spedizione attraverso il seguente <a href=\"https://gls-group.eu/EU/en/parcel-tracking?match=75285695981\">link di tracciamento GLS</a>.</p>\n<p>Pu√≤ stare completamente tranquillo, ricever√† il Suo ordine completo senza ulteriori costi aggiuntivi.</p>\n<p>Resto a disposizione per qualsiasi ulteriore necessit√† o assistenza.</p>\n<p>Cordiali saluti,</p>\n<p>Milena,<br>Supporto Clienti GommeGo PRO</p>","order_id":"BCRGBYWMU"},"message_id":"AAMkADRmMTYxODRmLWJmZjYtNDQ4Ny1hZGE0LWQzYjNhZjJkZDQyMgBGAAAAAAAbCa7Kx9UPS7NhabBhamKLBwABIvZjidpvQo_FOUmjs9ACAAAAAAEMAAABIvZjidpvQo_FOUmjs9ACAAAKPppcAAA=","mittente":"supplies@tecsolutions.app","mittente_nome":"Supplies TEC S.r.l.","oggetto":"RE: [GommeGo!] IN TRANSITO ‚Äì LINK DI TRACCIAMENTO INVIATO","messaggio_cliente":"Buongiorno faccio presente che manca ancora 1 pneumatico.\nSaluti\nLuca Cappellacci\n-----------------------------------\nGeometra Luca Cappellacci\nVia IV Novembre n. 38\n57023 Cecina (LI)\ncell. 348.4154829\n------------------------------------\nD.lgs n. 196 del 30.06.03 (Codice Privacy)\nQuesto messaggio contiene informazioni ad uso esclusivo del destinatario e/o riservate.\nQualora Le fosse pervenuto per errore, La preghiamo di distruggerlo senza copiarlo e di non inoltrarlo a terzi, dandocene gentilmente comunicazione.","thread_storico":"Il Lun 26 Mag 2025, 13:37 Info < info@gommego.com > ha scritto:\nGentile Sig. Cappellacci,\nLa ringraziamo per averci contattato. √à consueto che alcune spedizioni vengano consegnate separatamente, specialmente con corrieri come GLS. Le confermiamo che il resto del suo ordine √® ancora in transito e ricever√† presto gli altri pneumatici previsti. La invitiamo a verificare regolarmente i link di tracking presenti nella nostra email per gli aggiornamenti in tempo reale. se preferisce per sua maggiore opportunit√† pu√≤ contattare direttamente il corriere GLS al numero 800 184726\nResto a disposizione per qualsiasi necessit√†.\nSaluti\nDa: Luca Cappellacci < cappellacci.luca@gmail.com >\nInviato: luned√¨ 26 maggio 2025 11:19\nA: Info < info@gommego.com >\nOggetto: Re: [GommeGo!] IN TRANSITO ‚Äì LINK DI TRACCIAMENTO INVIATO\nBuongiorno mi √® stata consegnata solo 1 gomma da GLS, non riesco a contattare il corriere GLS.\nSaluti\nLuca Cappellacci\n-----------------------------------\nGeometra Luca Cappellacci\nVia IV Novembre n. 38\n57023 Cecina (LI)\ncell. 348.4154829\n------------------------------------\nD.lgs n. 196 del 30.06.03 (Codice Privacy)\nQuesto messaggio contiene informazioni ad uso esclusivo del destinatario e/o riservate.\nQualora Le fosse pervenuto per errore, La preghiamo di distruggerlo senza copiarlo e di non inoltrarlo a terzi, dandocene gentilmente comunicazione.\nGrazie\nIl Ven 23 Mag 2025, 09:11 GommeGo! < info@gommego.com > ha scritto:\n| |\nSalve LUCA CAPPELLACCI,\n|\n|\n|\nIl suo ordine n. BCRGBYWMU √® in transito.\nPu√≤ monitorare la spedizione utilizzando il seguente link di tracciamento:\nNel caso in cui notasse ritardi o anomalie, non esiti nel contattarci.\n|\n|\n|\n|\nConsulta le nostre condizioni di vendita.\n|\nPuoi visualizzare il tuo ordine e scaricare la eventuale fattura dalla sezione \"Cronologia ordini\" nel tuo account utente cliccando su \"Il mio account\" all''interno del sito.\n|\nSe hai un account ospite, adesso puoi seguire il tuo ordine tramite la sezione \"Tracking Ospite\" sul nostro sito.\n|\n|\n|\n|","isThreadReply":true,"isFirstMessage":false,"isSpam":false,"data_iso":"2025-06-01T15:53:25Z","data_locale":"01/06/2025, 15:53:25","order_id":"BCRGBYWMU","reply_to":[],"cc":[],"categorie":[]}}]}', '44b8f3bc-8c7b-4e93-ab3e-9e70e3f715e7', 0, '{"templateCredsSetupCompleted":true}', NULL, '2025-05-26T14:55:23.141Z', '2025-06-11T15:30:18.000Z', true),
  ('f59c77b7-0622-45d0-889a-f6bc229b6c3a', 'less chat 2', false, '[{"parameters":{"additionalFields":{}},"id":"d8d9ac7c-84a1-43ce-971b-3343f10e2bcd","name":"üîµ Telegram Trigger","type":"n8n-nodes-base.telegramTrigger","typeVersion":1,"position":[-2180,-120],"webhookId":"barbershop-message-receiver","notes":"Riceve tutti i messaggi Telegram dai clienti dei barbershop. Supporta testo, audio e voice messages."},{"parameters":{"content":"## üì® FASE 1: RICEZIONE E CLASSIFICAZIONE\n\n### Obiettivi:\n- **Ricezione messaggi** Telegram/WhatsApp\n- **Classificazione automatica** tipo messaggio\n- **Routing intelligente** verso elaborazione appropriata\n- **Preparazione dati** per fasi successive\n\n### Flusso:\n1. Trigger riceve messaggio\n2. Estrazione metadati base\n3. Classificazione tipo (text/audio/voice)\n4. Preparazione per handoff Fase 2\n\n### Output: Dati strutturati pronti per elaborazione","height":320,"width":400,"color":7},"id":"12017ff0-8d15-4872-a8cc-6ff695a6f53c","name":"üìã Overview Fase 1","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-2180,-440]},{"parameters":{"assignments":{"assignments":[{"id":"message-id","name":"message_id","type":"string","value":"={{ $json.message.message_id }}"},{"id":"chat-id","name":"chat_id","type":"string","value":"={{ $json.message.chat.id }}"},{"id":"user-id","name":"user_id","type":"string","value":"={{ $json.message.from.id }}"},{"id":"username","name":"username","type":"string","value":"={{ $json.message.from.username || $json.message.from.first_name }}"},{"id":"timestamp","name":"timestamp","type":"number","value":"={{ $json.message.date }}"},{"id":"platform","name":"platform","type":"string","value":"telegram"}]},"options":{}},"id":"abe9d4bf-9bc9-4523-b7c0-8bfe094e58b7","name":"üìä Estrazione Metadati Base","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-1920,-120],"notes":"Estrae i metadati fondamentali del messaggio: ID, chat, utente, timestamp. Prepara la struttura dati base per tutto il flusso."},{"parameters":{"jsCode":"// Classificazione intelligente del tipo di messaggio\nconst message = $(''üîµ Telegram Trigger'').item.json.message;\nconst baseData = $input.item.json;\n\ntry {\n  let messageType = ''unknown'';\n  let contentData = {};\n  let processingHints = {};\n  \n  // Classificazione del tipo di messaggio\n  if (message.text) {\n    messageType = ''text'';\n    contentData = {\n      text_content: message.text,\n      text_length: message.text.length,\n      has_entities: message.entities ? message.entities.length > 0 : false,\n      entities: message.entities || []\n    };\n    processingHints = {\n      requires_stt: false,\n      processing_complexity: ''low'',\n      estimated_processing_time: 500 // ms\n    };\n  } \n  else if (message.voice) {\n    messageType = ''voice'';\n    contentData = {\n      file_id: message.voice.file_id,\n      file_unique_id: message.voice.file_unique_id,\n      duration: message.voice.duration,\n      mime_type: message.voice.mime_type || ''audio/ogg'',\n      file_size: message.voice.file_size || 0\n    };\n    processingHints = {\n      requires_stt: true,\n      processing_complexity: ''high'',\n      estimated_processing_time: message.voice.duration * 1000 + 2000, // durata + overhead\n      stt_language: ''it'', // default italiano\n      quality_threshold: 0.7\n    };\n  }\n  else if (message.audio) {\n    messageType = ''audio'';\n    contentData = {\n      file_id: message.audio.file_id,\n      file_unique_id: message.audio.file_unique_id,\n      duration: message.audio.duration,\n      mime_type: message.audio.mime_type,\n      file_size: message.audio.file_size || 0,\n      title: message.audio.title || '''',\n      performer: message.audio.performer || ''''\n    };\n    processingHints = {\n      requires_stt: true,\n      processing_complexity: ''high'',\n      estimated_processing_time: message.audio.duration * 1000 + 2000,\n      stt_language: ''it'',\n      quality_threshold: 0.7\n    };\n  }\n  else if (message.document) {\n    messageType = ''document'';\n    contentData = {\n      file_id: message.document.file_id,\n      file_name: message.document.file_name,\n      mime_type: message.document.mime_type,\n      file_size: message.document.file_size\n    };\n    processingHints = {\n      requires_stt: false,\n      processing_complexity: ''medium'',\n      estimated_processing_time: 1500,\n      unsupported: true // per ora non supportiamo documenti\n    };\n  }\n  else if (message.photo) {\n    messageType = ''photo'';\n    contentData = {\n      photo_sizes: message.photo,\n      caption: message.caption || ''''\n    };\n    processingHints = {\n      requires_stt: false,\n      processing_complexity: ''medium'',\n      estimated_processing_time: 1000,\n      unsupported: true // per ora non supportiamo foto\n    };\n  }\n  \n  // Classificazione priorit√† basata su tipo e contenuto\n  let priority = ''normal'';\n  if (messageType === ''text'' && message.text.toLowerCase().includes(''urgent'')) {\n    priority = ''high'';\n  } else if (messageType === ''voice'' && message.voice.duration > 30) {\n    priority = ''low''; // audio lunghi hanno priorit√† minore\n  }\n  \n  // Rilevamento lingua (semplificato)\n  let detectedLanguage = ''it''; // default\n  if (messageType === ''text'') {\n    // Semplice rilevamento italiano vs altre lingue\n    const italianWords = [''ciao'', ''salve'', ''buongiorno'', ''buonasera'', ''prenotazione'', ''appuntamento''];\n    const text = message.text.toLowerCase();\n    const hasItalianWords = italianWords.some(word => text.includes(word));\n    if (!hasItalianWords && /[a-zA-Z]/.test(text)) {\n      detectedLanguage = ''auto''; // lascia che l''AI lo determini\n    }\n  }\n  \n  // Struttura finale per handoff alla Fase 2\n  const classificationResult = {\n    // Metadati base ereditati\n    ...baseData,\n    \n    // Classificazione messaggio\n    message_type: messageType,\n    content_data: contentData,\n    processing_hints: processingHints,\n    \n    // Metadati aggiuntivi\n    priority: priority,\n    detected_language: detectedLanguage,\n    classification_timestamp: new Date().toISOString(),\n    \n    // Flags per routing\n    ready_for_phase2: true,\n    phase1_completed: true,\n    \n    // Debug info\n    classification_debug: {\n      original_message_keys: Object.keys(message),\n      processing_node: ''message-classifier'',\n      n8n_version: ''1.93.0''\n    }\n  };\n  \n  return [{ json: classificationResult }];\n  \n} catch (error) {\n  console.error(''Errore nella classificazione messaggio:'', error);\n  \n  // Fallback con classificazione base\n  return [{\n    json: {\n      ...baseData,\n      message_type: ''error'',\n      content_data: { error_message: error.message },\n      processing_hints: { \n        requires_manual_review: true,\n        processing_complexity: ''error''\n      },\n      priority: ''high'', // errori hanno priorit√† alta\n      detected_language: ''it'',\n      classification_timestamp: new Date().toISOString(),\n      ready_for_phase2: false,\n      phase1_completed: false,\n      error: true\n    }\n  }];\n}"},"id":"d2fde285-c6ab-479d-a59f-d6423650346e","name":"üîç Classificatore Messaggio","type":"n8n-nodes-base.code","typeVersion":2,"position":[-1620,-120],"notes":"Classificazione intelligente del tipo di messaggio con analisi dettagliata. Determina routing, priorit√†, lingua e hints per l''elaborazione successiva."},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"supported-type-check","leftValue":"={{ !$json.processing_hints.unsupported }}","rightValue":true,"operator":{"type":"boolean","operation":"true","singleValue":true}}],"combinator":"and"},"options":{}},"id":"b92fbf30-8f12-4118-9059-299ad796ac5e","name":"‚úÖ Validazione Tipo Supportato","type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-1320,-120],"notes":"Verifica che il tipo di messaggio sia supportato dal sistema. Filtra documenti, foto e altri tipi non gestiti."},{"parameters":{"assignments":{"assignments":[{"id":"routing-decision","name":"next_phase","type":"string","value":"phase2_processing"},{"id":"routing-branch","name":"processing_branch","type":"string","value":"={{ $json.message_type === ''text'' ? ''text_branch'' : ''audio_branch'' }}"},{"id":"handoff-data","name":"handoff_package","type":"object","value":"={{ $json }}"},{"id":"phase1-summary","name":"phase1_summary","type":"object","value":"={\n  \"completed_at\": \"{{ new Date().toISOString() }}\",\n  \"message_type\": \"{{ $json.message_type }}\",\n  \"processing_hints\": {{ JSON.stringify($json.processing_hints) }},\n  \"estimated_processing_time\": {{ $json.processing_hints.estimated_processing_time }},\n  \"priority\": \"{{ $json.priority }}\",\n  \"ready_for_next_phase\": true\n}"}]},"options":{}},"id":"a00638ca-6498-4dbb-975d-281eb4511b91","name":"üéØ Completamento Fase 1","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-1060,-300],"notes":"Prepara i dati finali della Fase 1 e crea il package di handoff per la Fase 2. Include summary e routing decisions."},{"parameters":{"assignments":{"assignments":[{"id":"error-type","name":"error_type","type":"string","value":"unsupported_message_type"},{"id":"error-response","name":"error_response","type":"string","value":"‚ö†Ô∏è Tipo di messaggio non supportato.\\n\\nIl sistema supporta solo:\\n- üìù Messaggi di testo\\n- üé§ Messaggi vocali\\n- üîä File audio\\n\\nRiprova con un messaggio di testo o vocale. Grazie!"},{"id":"requires-immediate-response","name":"requires_immediate_response","type":"boolean","value":true},{"id":"next-phase","name":"next_phase","type":"string","value":"error_handling"}]},"options":{}},"id":"7a4b52ce-8a8b-480d-bac0-e67559c661a4","name":"‚ùå Gestione Tipo Non Supportato","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-1060,-80],"notes":"Gestisce messaggi di tipo non supportato (documenti, foto, etc). Prepara risposta di errore educativa per l''utente."},{"parameters":{"content":"## üîÑ CLASSIFICAZIONE MESSAGGI\n\n### Tipi Supportati:\n- **TEXT**: Messaggi testuali diretti\n- **VOICE**: Note vocali Telegram  \n- **AUDIO**: File audio allegati\n\n### Tipi Non Supportati:\n- **DOCUMENT**: File documenti\n- **PHOTO**: Immagini\n- **VIDEO**: File video\n- **STICKER**: Adesivi\n\n### Metadati Estratti:\n- Tipo messaggio e contenuto\n- Hints di elaborazione\n- Priorit√† e lingua rilevata\n- Stima tempo processing","height":360,"width":350,"color":4},"id":"cbda6a8c-726f-431b-a580-bf7eb23a3466","name":"üè∑Ô∏è Info Classificazione","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-1660,-480]},{"parameters":{},"id":"65a54419-a238-4594-9d18-f3a24a934f82","name":"‚≠ï FINE FASE 1","type":"n8n-nodes-base.noOp","typeVersion":1,"position":[-820,-200],"notes":"Terminazione della Fase 1. I dati sono pronti per essere processati dalla Fase 2 (Elaborazione Input)."}]', '{"üîµ Telegram Trigger":{"main":[[{"node":"üìä Estrazione Metadati Base","type":"main","index":0}]]},"üìä Estrazione Metadati Base":{"main":[[{"node":"üîç Classificatore Messaggio","type":"main","index":0}]]},"üîç Classificatore Messaggio":{"main":[[{"node":"‚úÖ Validazione Tipo Supportato","type":"main","index":0}]]},"‚úÖ Validazione Tipo Supportato":{"main":[[{"node":"üéØ Completamento Fase 1","type":"main","index":0}],[{"node":"‚ùå Gestione Tipo Non Supportato","type":"main","index":0}]]},"üéØ Completamento Fase 1":{"main":[[{"node":"‚≠ï FINE FASE 1","type":"main","index":0}]]},"‚ùå Gestione Tipo Non Supportato":{"main":[[{"node":"‚≠ï FINE FASE 1","type":"main","index":0}]]}}', '{"executionOrder":"v1"}', NULL, '{}', '9af21c40-7f36-4108-ba34-f5b44e663a4b', 0, '{"templateCredsSetupCompleted":true}', NULL, '2025-05-27T11:47:14.656Z', '2025-05-27T17:45:28.000Z', false),
  ('fce9c574-c9e7-4ac2-8f1c-2c1759e1bc38', 'My workflow 2', false, '[]', '{}', '{"executionOrder":"v1"}', NULL, '{}', '2f6881c2-707d-472f-b438-6d376e638613', 0, NULL, NULL, '2025-05-27T13:19:53.463Z', '2025-05-27T17:44:56.000Z', true),
  ('2d1e3a1d-29e6-4fb6-bf0f-c1469fea1717', 'less chat more cut', false, '[{"parameters":{"content":"## üéØ SISTEMA MULTI-TENANT BARBERSHOP\n\n### Funzionalit√† principali:\n- **Gestione messaggi vocali e testuali**\n- **Speech-to-Text con Whisper AI**\n- **Routing multi-tenant dinamico**\n- **Integrazione Google Calendar**\n- **Sistema fallback robusto**\n\n### Architettura:\n- Input Processing Layer\n- Tenant Management\n- Booking Management\n- Fallback & Error Handling\n\n*Supporta 3000+ barbershop con elaborazione audio/testo unificata*","height":400,"width":500,"color":7},"id":"fc53bcfe-d123-4f8b-8f3e-cc6999c66444","name":"üìã Sistema Overview","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-400,-680]},{"parameters":{"assignments":{"assignments":[{"id":"unified-text","name":"message_text","type":"string","value":"={{ $json.text || $(''whisper-stt'').item.json.text }}"},{"id":"message-type","name":"input_type","type":"string","value":"={{ $json.text ? ''text'' : ''audio'' }}"},{"id":"chat-id","name":"chat_id","type":"string","value":"={{ $(''Trigger Telegram'').item.json.message.chat.id }}"},{"id":"user-id","name":"user_id","type":"string","value":"={{ $(''Trigger Telegram'').item.json.message.from.id }}"},{"id":"confidence","name":"confidence_score","type":"number","value":"={{ $json.confidence || 1.0 }}"}]},"options":{}},"id":"796b5b66-8595-4787-9164-a64cd52b45e2","name":"üîó Unificazione Testo","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[700,300],"notes":"Unifica l''elaborazione di messaggi testuali e audio trascritti. Crea un formato dati comune per il processing downstream."},{"parameters":{"operation":"select"},"id":"35483ced-b970-42f0-9dba-751b5e08e893","name":"üè™ Lookup Tenant","type":"n8n-nodes-base.supabase","typeVersion":1,"position":[980,240],"notes":"Identifica il barbershop (tenant) basato sul chat_id Telegram. Recupera configurazioni specifiche: lingua, timezone, orari business."},{"parameters":{"conditions":{"options":{"leftValue":"","caseSensitive":true,"typeValidation":"strict"},"combinator":"and","conditions":[{"id":"tenant-found-check","leftValue":"={{ $json.length > 0 }}","rightValue":true,"operator":{"type":"boolean","operation":"true","singleValue":true}}]},"options":{}},"id":"f53249bf-2432-4352-9daf-a6751bdebaf2","name":"‚úÖ Validazione Tenant","type":"n8n-nodes-base.if","typeVersion":2,"position":[1200,240],"notes":"Verifica se il tenant √® stato trovato nel database. Gestisce il fallback per barbershop non registrati."},{"parameters":{"jsCode":"// Log del messaggio ricevuto per debugging e audit\nconst messageData = $(''unify-text-processing'').item.json;\nconst tenantData = $(''tenant-lookup'').item.json[0];\n\ntry {\n  // Inserimento log nel database\n  const logEntry = {\n    tenant_id: tenantData.id,\n    message_type: messageData.input_type,\n    original_content: messageData.input_type === ''audio'' ? ''audio_file'' : messageData.message_text,\n    transcribed_content: messageData.message_text,\n    processing_time_ms: Date.now() - $(''Trigger Telegram'').item.json.timestamp * 1000,\n    confidence_score: messageData.confidence_score,\n    language_detected: tenantData.preferred_language || ''it'',\n    created_at: new Date().toISOString()\n  };\n  \n  return [{\n    json: {\n      log_entry: logEntry,\n      tenant: tenantData,\n      message: messageData,\n      processing_start: Date.now()\n    }\n  }];\n  \n} catch (error) {\n  console.error(''Errore nel logging del messaggio:'', error);\n  return [{\n    json: {\n      error: error.message,\n      tenant: tenantData,\n      message: messageData,\n      processing_start: Date.now()\n    }\n  }];\n}"},"id":"5d869648-08d4-4a96-a3ed-ca8c0c7788f6","name":"üìù Log Messaggio","type":"n8n-nodes-base.code","typeVersion":2,"position":[1420,140],"notes":"Registra tutti i messaggi nel database per audit, analytics e debugging. Include metriche di performance e confidence scores."},{"parameters":{"model":"gpt-4o-latest","options":{}},"id":"cbfc6b8a-7873-45e3-982d-210c348682b2","name":"ü§ñ AI Booking Agent","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-80,1320],"credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}},"notes":"AI Agent principale per l''elaborazione delle prenotazioni. Contestualizzato con dati specifici del barbershop e configurato per gestione multi-lingua."},{"parameters":{"assignments":{"assignments":[{"id":"ai-response","name":"ai_response","type":"string","value":"={{ $json.message.content }}"},{"id":"needs-calendar","name":"requires_calendar_check","type":"boolean","value":"={{ $json.message.content.toLowerCase().includes(''prenotare'') || $json.message.content.toLowerCase().includes(''appuntamento'') }}"},{"id":"extracted-datetime","name":"requested_datetime","type":"string","value":"={{ $json.message.content.match(/\\d{1,2}[:\\/\\-]\\d{1,2}|domani|oggi|luned√¨|marted√¨|mercoled√¨|gioved√¨|venerd√¨|sabato|domenica/gi)?.[0] || null }}"}]},"options":{}},"id":"dd2b9b51-2cd0-4e89-bf77-c994bc1daec0","name":"üîç Analisi Risposta AI","type":"n8n-nodes-base.set","typeVersion":3.4,"position":[380,1160],"notes":"Analizza la risposta dell''AI per determinare se √® necessario verificare il calendario o procedere direttamente con la risposta al cliente."},{"parameters":{"conditions":{"options":{"leftValue":"","caseSensitive":true,"typeValidation":"strict"},"combinator":"and","conditions":[{"id":"calendar-check-needed","leftValue":"={{ $json.requires_calendar_check }}","rightValue":true,"operator":{"type":"boolean","operation":"true","singleValue":true}}]},"options":{}},"id":"c1df57a0-aeeb-4b36-8f3b-3ba79bc1aca7","name":"üìÖ Necessaria Verifica Calendario?","type":"n8n-nodes-base.if","typeVersion":2,"position":[600,1160],"notes":"Decide se √® necessario verificare la disponibilit√† nel calendario Google del barbershop prima di rispondere al cliente."},{"parameters":{"operation":"list","calendar":{"__rl":true,"value":"={{ $(''tenant-lookup'').item.json[0].calendar_id }}","mode":"id"}},"id":"f38c4822-59ca-4687-8728-5e0928f6f5c8","name":"üìÖ Verifica Calendario Google","type":"n8n-nodes-base.googleCalendar","typeVersion":1.2,"position":[820,1060],"notes":"Recupera gli eventi del calendario del barbershop per verificare disponibilit√† e rilevare conflitti negli orari richiesti."},{"parameters":{"jsCode":"// Verifica conflitti calendario e determina disponibilit√†\nconst events = $input.item.json.items || [];\nconst requestedTime = $(''response-analysis'').item.json.requested_datetime;\nconst tenantData = $(''tenant-lookup'').item.json[0];\nconst businessHours = tenantData.business_hours || {};\n\ntry {\n  // Parsing della data/ora richiesta (semplificato)\n  let requestedDate = null;\n  let hasConflict = false;\n  \n  if (requestedTime) {\n    // Logica di parsing data/ora (da implementare completamente)\n    const now = new Date();\n    \n    if (requestedTime.toLowerCase().includes(''domani'')) {\n      requestedDate = new Date(now.getTime() + 24 * 60 * 60 * 1000);\n    } else if (requestedTime.toLowerCase().includes(''oggi'')) {\n      requestedDate = now;\n    }\n    \n    // Verifica conflitti con eventi esistenti\n    if (requestedDate) {\n      hasConflict = events.some(event => {\n        const eventStart = new Date(event.start.dateTime || event.start.date);\n        const eventEnd = new Date(event.end.dateTime || event.end.date);\n        \n        // Controllo sovrapposizione temporale (semplificato)\n        return (requestedDate >= eventStart && requestedDate <= eventEnd);\n      });\n    }\n  }\n  \n  // Trova prossimi slot disponibili\n  const availableSlots = [];\n  const today = new Date();\n  \n  for (let i = 0; i < 7; i++) {\n    const checkDate = new Date(today.getTime() + i * 24 * 60 * 60 * 1000);\n    const dayName = checkDate.toLocaleDateString(''it-IT'', { weekday: ''long'' });\n    \n    if (businessHours[dayName]) {\n      // Aggiungi slot disponibili per questo giorno\n      availableSlots.push({\n        date: checkDate.toISOString().split(''T'')[0],\n        day: dayName,\n        slots: businessHours[dayName] || []\n      });\n    }\n  }\n  \n  return [{\n    json: {\n      calendar_checked: true,\n      requested_time: requestedTime,\n      has_conflict: hasConflict,\n      available_slots: availableSlots.slice(0, 3), // Primi 3 giorni disponibili\n      total_events: events.length,\n      processing_time: Date.now() - $(''message-logging'').item.json.processing_start\n    }\n  }];\n  \n} catch (error) {\n  console.error(''Errore nella verifica calendario:'', error);\n  return [{\n    json: {\n      calendar_checked: false,\n      error: error.message,\n      fallback: true\n    }\n  }];\n}"},"id":"4a0420ef-1955-433d-b909-009dd043ca7c","name":"‚ö° Analisi Disponibilit√†","type":"n8n-nodes-base.code","typeVersion":2,"position":[1040,1060],"notes":"Analizza gli eventi del calendario per determinare conflitti e suggerire slot disponibili. Include logica per orari business."},{"parameters":{"model":"gpt-4o-latest","options":{}},"id":"cac13c15-2877-41b8-8b80-8d2b68d926b2","name":"‚ú® Generazione Risposta Finale","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[260,-100],"notes":"Genera la risposta finale ottimizzata basata sui dati del calendario. Integra informazioni di disponibilit√† e gestisce conflitti."},{"parameters":{"chatId":"={{ $(''unify-text-processing'').item.json.chat_id }}","text":"={{ $json.message?.content || $(''response-analysis'').item.json.ai_response }}","additionalFields":{"parse_mode":"Markdown"}},"id":"7ff4a51d-80c9-4f55-87fb-576dcab3ce52","name":"üì± Invio Risposta Telegram","type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[820,1260],"webhookId":"4c6e12e5-789a-485b-b90c-fe0aa1135b04","notes":"Invia la risposta finale al cliente via Telegram. Supporta formattazione Markdown per migliorare la presentazione."},{"parameters":{"chatId":"={{ $(''unify-text-processing'').item.json.chat_id }}","text":"‚ö†Ô∏è Mi dispiace, non riesco a identificare il tuo barbershop nel sistema.\n\nPer favore contatta il supporto per la registrazione:\nüìû Supporto: +39 XXX XXX XXXX\nüìß Email: support@lesschatmorecut.com\n\nGrazie per la comprensione! üôè","additionalFields":{"parse_mode":"Markdown"}},"id":"8fce051e-64d8-4689-a637-7b02ef7479a3","name":"‚ùå Risposta Tenant Non Trovato","type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[1420,340],"webhookId":"63541297-8836-4216-abef-51de609289e9","notes":"Gestisce il fallback quando il barbershop non √® registrato nel sistema. Fornisce informazioni di contatto per il supporto."},{"parameters":{"operation":"insert"},"id":"cf5df93c-3710-4271-98a6-26490e423534","name":"üíæ Salvataggio Log DB","type":"n8n-nodes-base.supabase","typeVersion":1,"position":[1640,140],"notes":"Salva i log dei messaggi nel database per analytics, debugging e compliance. Include metriche di performance."},{"parameters":{"content":"## üîß GESTIONE ERRORI E FALLBACK\n\n### Strategie implementate:\n- **STT Fallback**: Richiesta testo se audio non processabile\n- **Tenant Fallback**: Messaggio supporto se barbershop non trovato\n- **Calendar Fallback**: Elaborazione senza calendario se API down\n- **AI Fallback**: Risposte predefinite se AI timeout\n\n### Livelli di degradazione:\n1. **Level 0**: Servizio completo\n2. **Level 1**: Solo testo (STT disabilitato)\n3. **Level 2**: Risposte rule-based (AI limitato)\n4. **Level 3**: Solo acknowledgment (emergenza)","height":460,"width":590,"color":3},"id":"a90be50f-6700-4d52-8021-73d9a140f84e","name":"‚ö†Ô∏è Sistema Fallback","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[840,-380]},{"parameters":{"content":"## üìä PERFORMANCE TARGETS\n\n### Metriche chiave:\n- **STT Accuracy**: >95% per italiano\n- **Response Time**: <5s audio, <2s testo\n- **System Uptime**: >99.5%\n- **Concurrent Processing**: 100+ audio simultanei\n- **Transcription Confidence**: >0.7 threshold\n\n### Ottimizzazioni:\n- Batch processing audio\n- Quality filtering pre-STT\n- Smart routing per messaggi text\n- Caching per audio identici","height":400,"width":460,"color":4},"id":"9f29b4dd-f5b5-4a4a-9d4d-bb162352a162","name":"‚ö° Performance & KPIs","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[1460,-360]},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.9,"position":[20,1140],"id":"67d798b0-197c-4939-969e-d657f67e11af","name":"AI Agent"},{"parameters":{"updates":["message"],"additionalFields":{}},"id":"8a39dabc-49b9-4512-897b-10b47efca8ec","name":"Telegram Trigger","type":"n8n-nodes-base.telegramTrigger","position":[-680,100],"webhookId":"65f501de-3c14-4089-9b9d-8956676bebf3","typeVersion":1.1},{"parameters":{"rules":{"values":[{"conditions":{"options":{"version":2,"leftValue":"","caseSensitive":true,"typeValidation":"strict"},"combinator":"and","conditions":[{"operator":{"type":"array","operation":"contains","rightType":"any"},"leftValue":"={{ $json.message.keys()}}","rightValue":"text"}]},"renameOutput":true,"outputKey":"Text"},{"conditions":{"options":{"version":2,"leftValue":"","caseSensitive":true,"typeValidation":"strict"},"combinator":"and","conditions":[{"id":"d16eb899-cccb-41b6-921e-172c525ff92c","operator":{"type":"array","operation":"contains","rightType":"any"},"leftValue":"={{ $json.message.keys()}}","rightValue":"voice"}]},"renameOutput":true,"outputKey":"Audio"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"af62d107-5bc3-4247-9be9-e278f9bef773","leftValue":"","rightValue":"","operator":{"type":"string","operation":"equals","name":"filter.operator.equals"}}],"combinator":"and"}}]},"options":{"fallbackOutput":"extra","renameFallbackOutput":""}},"id":"8980e53c-3413-4464-8943-ddd6e0e0b178","name":"Verify Message Type","type":"n8n-nodes-base.switch","position":[-420,220],"typeVersion":3.2,"alwaysOutputData":false},{"parameters":{"resource":"audio","operation":"transcribe","binaryPropertyName":"=data","options":{}},"id":"b60b8952-782b-40c7-84a0-3aa5ebb02f0b","name":"OpenAI","type":"@n8n/n8n-nodes-langchain.openAi","position":[260,360],"typeVersion":1.8,"credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"resource":"file","fileId":"={{ $json.message.voice.file_id }}"},"id":"1a482632-1425-46b1-ae09-e51d4e1278c6","name":"Telegram1","type":"n8n-nodes-base.telegram","position":[80,360],"typeVersion":1.2,"webhookId":"7c2a47f7-9bc8-44f6-a0f0-00ac394fe3df"},{"parameters":{"chatId":"={{ $json.message.chat.id }}","text":"I''m not able to process this message type.","additionalFields":{}},"id":"ceda4fd7-6ddb-4611-89d3-852fc1e8d1c1","name":"Unsupported Message Type","type":"n8n-nodes-base.telegram","position":[60,560],"typeVersion":1.2,"webhookId":"c864fbaa-6586-457e-8afe-a35c7181ed8d"},{"parameters":{"assignments":{"assignments":[{"id":"403b336f-87ce-4bef-a5f2-1640425f8198","name":"text","type":"string","value":"={{ $json.message.text }}"}]},"includeOtherFields":true,"options":{}},"id":"c325a0ff-203b-493d-9ed9-ce3398974186","name":"Edit Fields","type":"n8n-nodes-base.set","position":[80,120],"typeVersion":3.4},{"parameters":{"updates":["messages"],"options":{}},"type":"n8n-nodes-base.whatsAppTrigger","typeVersion":1,"position":[-680,320],"id":"fa4931b0-38cd-48d8-b9ca-7b222220c7bd","name":"WhatsApp Trigger","webhookId":"1a6c9883-7ac9-4a14-bf44-4d0766cd3e95"},{"parameters":{"content":"## 3. Handling Messages with Fallback Support\n\nThis workflow processes Telegram messages to handle **text** and **voice** inputs, with a fallback for unsupported message types. Here‚Äôs how it works:\n\n1. **Trigger Node**:\n   - The workflow starts with a Telegram trigger that listens for incoming messages.\n\n2. **Message Type Check**:\n   - The workflow verifies the type of message received:\n     - **Text Message**: If the message contains `$json.message.text`, it is sent directly to the agent.\n     - **Voice Message**: If the message contains `$json.message.voice`, the audio is transcribed into text using a transcription service, and the result is sent to the agent.\n\n3. **Fallback Path**:\n   - If the message is neither text nor voice, a fallback response is returned:\n     `\"Sorry, I couldn‚Äôt process your message. Please try again.\"`\n\n4. **Unified Output**:\n   - Both text messages and transcribed voice messages are converted into the same format before sending to the agent, ensuring consistency in handling.\n","height":1020,"width":1300,"color":4},"id":"1cd0b0af-ca75-4ac4-9735-9ebeb48c2c1e","name":"Sticky Note2","type":"n8n-nodes-base.stickyNote","position":[280,-340],"typeVersion":1}]', '{"üîó Unificazione Testo":{"main":[[{"node":"üè™ Lookup Tenant","type":"main","index":0}]]},"üè™ Lookup Tenant":{"main":[[{"node":"‚úÖ Validazione Tenant","type":"main","index":0}]]},"‚úÖ Validazione Tenant":{"main":[[{"node":"üìù Log Messaggio","type":"main","index":0}],[{"node":"‚ùå Risposta Tenant Non Trovato","type":"main","index":0}]]},"üìù Log Messaggio":{"main":[[{"node":"üíæ Salvataggio Log DB","type":"main","index":0}]]},"üîç Analisi Risposta AI":{"main":[[{"node":"üìÖ Necessaria Verifica Calendario?","type":"main","index":0}]]},"üìÖ Necessaria Verifica Calendario?":{"main":[[{"node":"üìÖ Verifica Calendario Google","type":"main","index":0}],[{"node":"üì± Invio Risposta Telegram","type":"main","index":0}]]},"üìÖ Verifica Calendario Google":{"main":[[{"node":"‚ö° Analisi Disponibilit√†","type":"main","index":0}]]},"ü§ñ AI Booking Agent":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"AI Agent":{"main":[[{"node":"üîç Analisi Risposta AI","type":"main","index":0}]]},"Telegram Trigger":{"main":[[{"node":"Verify Message Type","type":"main","index":0}]]},"Verify Message Type":{"main":[[{"node":"Edit Fields","type":"main","index":0}],[{"node":"Telegram1","type":"main","index":0}],[],[{"node":"Unsupported Message Type","type":"main","index":0}]]},"Telegram1":{"main":[[{"node":"OpenAI","type":"main","index":0}]]},"OpenAI":{"main":[[{"node":"üîó Unificazione Testo","type":"main","index":0}]]},"WhatsApp Trigger":{"main":[[{"node":"Verify Message Type","type":"main","index":0}]]}}', '{"executionOrder":"v1"}', NULL, '{}', 'a7c968a2-043f-4c52-8fbf-23d8662ea77b', 0, NULL, NULL, '2025-05-27T13:40:59.315Z', '2025-05-27T17:44:39.000Z', false),
  ('b32c8bf7-893c-45b5-ad01-7030eef2c0f2', 'My workflow 2', false, '[{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[-1920,-1660],"id":"03e38570-fb8f-44aa-bb64-73188e19fbfb","name":"When clicking ‚ÄòTest workflow‚Äô"},{"parameters":{"additionalFields":{}},"id":"0192e578-012c-4285-8cae-86cdc3e8dcb6","name":"Telegram Trigger","type":"n8n-nodes-base.telegramTrigger","typeVersion":1,"position":[-1920,-1200],"webhookId":"85284239-2d34-49da-a6ba-b3773e0436e2","credentials":{"telegramApi":{"id":null,"name":"YOUR_TELEGRAM_API"}}},{"parameters":{"pollTimes":{"item":[{"mode":"everyMinute"}]},"filters":{}},"id":"a4e267b7-a195-4f4e-be0f-15e3c028b8f8","name":"Gmail Trigger","type":"n8n-nodes-base.gmailTrigger","typeVersion":1,"position":[-1920,-1400]},{"parameters":{"path":"incoming-message","options":{}},"id":"7b6bdd74-5679-412d-a764-fd0edd89f85f","name":"Webhook Trigger","type":"n8n-nodes-base.webhook","typeVersion":1,"position":[-1920,-1000],"webhookId":"a3a0d9a1-2c62-45dc-ba40-e5a2086c1585"},{"parameters":{"functionCode":"return [{json:{source:\"Telegram\"}}];"},"id":"38121b08-5b49-47f7-aeea-30b833810dce","name":"Tag Telegram","type":"n8n-nodes-base.function","typeVersion":1,"position":[-1700,-1200]},{"parameters":{"functionCode":"return [{json:{source:\"Gmail\"}}];"},"id":"8fbfc5a5-f636-4d20-a3ce-192e0d768b8d","name":"Tag Gmail","type":"n8n-nodes-base.function","typeVersion":1,"position":[-1700,-1400]},{"parameters":{"functionCode":"return [{json:{source:\"Webhook\"}}];"},"id":"69b25c50-f384-4725-a553-67c9712b1915","name":"Tag Webhook","type":"n8n-nodes-base.function","typeVersion":1,"position":[-1700,-1000]},{"parameters":{"values":{"string":[{"name":"content_type","value":"={{(() => {\n  const msg = $json;\n  if (msg.photo || msg.image || msg.mime_type?.includes(''image'')) return ''image'';\n  if (msg.voice || msg.audio || msg.mime_type?.includes(''audio'')) return ''audio'';\n  if (msg.text || msg.body || typeof msg.message === ''string'') return ''text'';\n  if (msg.document || msg.file || msg.mime_type?.includes(''application'')) return ''document'';\n  return ''unknown'';\n})()}}"}]},"options":{}},"id":"896ddea6-6a9a-47ad-8cbe-8e640b8b5bd2","name":"Classifica tipo","type":"n8n-nodes-base.set","typeVersion":2,"position":[-1480,-1200]},{"parameters":{},"id":"dcbd9c07-756b-4842-a8ed-7b730db62307","name":"Debug","type":"n8n-nodes-base.debug","typeVersion":1,"position":[-1920,-740]},{"parameters":{"updates":["messages"],"options":{}},"id":"6ebdb755-d631-4784-b3aa-424312f7b6e5","name":"WhatsApp Trigger","type":"n8n-nodes-base.whatsAppTrigger","typeVersion":1,"position":[-1920,-280],"webhookId":"7fee4efa-62d0-43b0-b6ac-e21e12853d77"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"version":2},"combinator":"and","conditions":[{"operator":{"type":"array","operation":"contains","rightType":"any"},"leftValue":"={{ $json.message.keys() }}","rightValue":"text"}]},"renameOutput":true,"outputKey":"Text"},{"conditions":{"options":{"version":2},"combinator":"and","conditions":[{"operator":{"type":"array","operation":"contains","rightType":"any"},"leftValue":"={{ $json.message.keys() }}","rightValue":"voice"}]},"renameOutput":true,"outputKey":"Audio"}]},"options":{"fallbackOutput":"extra"}},"id":"dd0cf91f-e829-43bf-a975-c38664dfa09e","name":"Verify Type","type":"n8n-nodes-base.switch","typeVersion":3,"position":[-1700,-380]},{"parameters":{"options":{}},"id":"c2505bd7-32e2-44bf-97fe-d94b08eeaec6","name":"Text ‚Üí messaggio_convertito","type":"n8n-nodes-base.set","typeVersion":3,"position":[-1260,-500]},{"parameters":{"additionalFields":{}},"id":"b26e7f45-e347-4f8a-9b9d-9ea6e93804bf","name":"Download Audio","type":"n8n-nodes-base.telegram","typeVersion":1,"position":[-1480,-260],"webhookId":"36a46743-6603-46f8-8c41-57233990346d"},{"parameters":{"resource":"audio","operation":"transcribe","options":{}},"id":"4a9c24c0-2014-4f84-8c44-a9654f58cf3e","name":"Transcribe Whisper","type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1,"position":[-1260,-280],"credentials":{"openAiApi":{"id":null,"name":"YOUR_OPENAI_CREDENTIAL_ID"}}},{"parameters":{"options":{}},"id":"cd314037-2ff3-4612-b8bf-fbe1dcc04469","name":"Set messaggio_convertito (audio)","type":"n8n-nodes-base.set","typeVersion":3,"position":[-1040,-280]},{"parameters":{"promptType":"define","text":"=Scrivi una risposta empatica al seguente messaggio cliente:\n\n\"{{$json.messaggio_convertito}}\"\n\nRispondi in massimo 100 parole, con tono rassicurante e professionale. Dai sempre del \"Lei\"."},"id":"bf066c60-d80f-4df2-97d1-c59347994f95","name":"Milena AI Agent","type":"@n8n/n8n-nodes-langchain.chainLlm","typeVersion":1.5,"position":[-840,-420]},{"parameters":{"chatId":"={{ $json.message.chat.id }}","text":"={{ $json.text }}","additionalFields":{}},"id":"13e42616-d0d4-4c32-9d6e-cfc4f7affe6b","name":"Invia Risposta","type":"n8n-nodes-base.telegram","typeVersion":1,"position":[-460,-440],"webhookId":"2c2888df-1ad3-440c-a9ee-e521f168ec91"},{"parameters":{"updates":["message"],"additionalFields":{}},"id":"b64bc5d9-654e-474b-8785-5bbb199036e9","name":"Telegram Trigger1","type":"n8n-nodes-base.telegramTrigger","typeVersion":1,"position":[-1920,-480],"webhookId":"8c613585-7b31-4275-9d68-e3d299bb6b48","credentials":{"telegramApi":{"id":null,"name":"YOUR_TELEGRAM_API"}}}]', '{"When clicking ‚ÄòTest workflow‚Äô":{"main":[[]]},"Telegram Trigger":{"main":[[{"node":"Tag Telegram","type":"main","index":0}]]},"Gmail Trigger":{"main":[[{"node":"Tag Gmail","type":"main","index":0}]]},"Webhook Trigger":{"main":[[{"node":"Tag Webhook","type":"main","index":0}]]},"Tag Telegram":{"main":[[{"node":"Classifica tipo","type":"main","index":0}]]},"Tag Gmail":{"main":[[{"node":"Classifica tipo","type":"main","index":0}]]},"Tag Webhook":{"main":[[{"node":"Classifica tipo","type":"main","index":0}]]},"WhatsApp Trigger":{"main":[[{"node":"Verify Type","type":"main","index":0}]]},"Verify Type":{"main":[[{"node":"Text ‚Üí messaggio_convertito","type":"main","index":0}],[{"node":"Download Audio","type":"main","index":0}]]},"Text ‚Üí messaggio_convertito":{"main":[[{"node":"Milena AI Agent","type":"main","index":0}]]},"Download Audio":{"main":[[{"node":"Transcribe Whisper","type":"main","index":0}]]},"Transcribe Whisper":{"main":[[{"node":"Set messaggio_convertito (audio)","type":"main","index":0}]]},"Set messaggio_convertito (audio)":{"main":[[{"node":"Milena AI Agent","type":"main","index":0}]]},"Milena AI Agent":{"main":[[{"node":"Invia Risposta","type":"main","index":0}]]},"Telegram Trigger1":{"main":[[{"node":"Verify Type","type":"main","index":0}]]}}', '{"executionOrder":"v1"}', NULL, '{}', '772410bf-bc93-45be-8cc3-e84e2dc98d67', 0, NULL, NULL, '2025-05-27T17:50:10.837Z', '2025-05-27T18:09:26.000Z', false),
  ('5518449a-b881-4492-aad2-23143a44be56', 'My workflow 3', false, '[]', '{}', '{"executionOrder":"v1"}', NULL, '{}', '3b5475f7-2cdf-49ed-affe-b8c4f581fb10', 0, NULL, NULL, '2025-05-29T16:22:13.021Z', '2025-05-29T16:30:27.000Z', true),
  ('c5b22202-d4e2-42f2-95d7-887395682461', 'CHATBOT_MAIL__SIMPLE', true, '[{"parameters":{"model":{"__rl":true,"value":"gpt-4.1-mini-2025-04-14","mode":"list","cachedResultName":"gpt-4.1-mini-2025-04-14"},"options":{"maxTokens":32768}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-3904,400],"id":"70fc75db-a4ea-4072-bc14-c838a5b7172e","name":"OpenAI Chat Model4","credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}},"notes":"hidden"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1.2,"position":[-3680,592],"id":"4eb95c36-becd-40d8-b4a8-c1412bdafcfa","name":"Embeddings OpenAI3","credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}},"notes":"hidden"},{"parameters":{"mode":"retrieve-as-tool","toolName":"Vector","toolDescription":"Recupera SOLO per: policy aziendali, resi, rimborsi, informazioni generali. \n","qdrantCollection":{"__rl":true,"value":"Double","mode":"list","cachedResultName":"Double"},"topK":3,"options":{}},"type":"@n8n/n8n-nodes-langchain.vectorStoreQdrant","typeVersion":1.1,"position":[-3744,400],"id":"6beb6703-67ee-4aa2-85e6-fb1c9d67fc8c","name":"Qdrant Vector Store","alwaysOutputData":true,"retryOnFail":true,"credentials":{"qdrantApi":{"id":"VEHIg9nC5Y5VeHPX","name":"QdrantApi account"}},"notes":"show-3"},{"parameters":{"description":"DATI ORDINI CLIENTI - INFORMAZIONI SPECIFICHE PRESTASHOP\nQuesto nodo recupera i dettagli specifici di un ordine dal database PrestaShop utilizzando il codice ordine fornito dal cliente.\nFUNZIONE:\nEstrae dati grezzi dell''ordine: stato attuale, prodotti acquistati, indirizzo di consegna, informazioni di fatturazione, shipment_number (se disponibile), dettagli di trasporto e di consegna date e dettagli tecnici del processo.\nINPUT RICHIESTO:\njson{\"query\": \"CODICE_ORDINE\"}\n\nSe il codice ordine √® presente: inserire il codice esatto\nSe il codice ordine manca: {\"query\": \"\"}\n\nQUANDO USARLO:\n\nDOPO aver consultato il vector store per il contesto generale\nSolo per richieste specifiche su ordini gi√† effettuati\nPer ottenere stato, tracking number, dettagli prodotti\n\nOUTPUT:\nRestituisce dati tecnici che DEVONO essere rielaborati e spiegati al cliente in linguaggio rassicurante usando le informazioni del vector store.\nIMPORTANTE:\nI dati di questo nodo sono \"grezzi\" e vanno sempre combinati con il vector store per ottenere spiegazioni comprensibili degli stati ordine e messaggi rassicuranti appropriati.\nSolo dati specifici - il contesto e la rassicurazione vengono dal vector store.","workflowId":{"__rl":true,"value":"dQ0r6zTsY02PDG8X","mode":"list","cachedResultName":"SUB_API_INFO_ORDER & PARCELSAPP"},"workflowInputs":{"mappingMode":"defineBelow","value":{},"matchingColumns":[],"schema":[],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[-3456,432],"id":"f4ac4b52-f7cf-4eca-9f32-791a7e681623","name":"INFO ORDINI","retryOnFail":true,"alwaysOutputData":true,"notes":"show-4"},{"parameters":{"options":{}},"type":"n8n-nodes-base.dateTimeTool","typeVersion":2,"position":[-3312,432],"id":"ea07f7f7-4c1e-4f25-88ad-4a216114afba","name":"Date & Time"},{"parameters":{"operation":"reply","messageId":{"__rl":true,"value":"={{ $json.message_id }}","mode":"id"},"replyToSenderOnly":true,"message":"={{ $json.risposta_html }}","additionalFields":{"bodyContentType":"html"},"options":{}},"type":"n8n-nodes-base.microsoftOutlook","typeVersion":2,"position":[-2400,192],"id":"57012fcd-e0c2-4263-b439-6c2cd2c49cc5","name":"Rispondi a mittente","webhookId":"59a76fee-c9f8-4c78-a7c2-b6ac06f202ba","retryOnFail":true,"alwaysOutputData":true,"credentials":{"microsoftOutlookOAuth2Api":{"id":"EySZIVRGzocRrEOf","name":"Outlook Info GommeGo"}},"onError":"continueRegularOutput","notes":"show-6"},{"parameters":{"pollTimes":{"item":[{"mode":"everyMinute"}]},"output":"fields","fields":["sender","replyTo","sentDateTime","subject","body","categories","ccRecipients"],"filters":{"custom":"isRead eq false","foldersToInclude":["AAMkADRmMTYxODRmLWJmZjYtNDQ4Ny1hZGE0LWQzYjNhZjJkZDQyMgAuAAAAAAAbCa7Kx9UPS7NhabBhamKLAQABIvZjidpvQo_FOUmjs9ACAAAAAAEMAAA="]},"options":{"downloadAttachments":false}},"type":"n8n-nodes-base.microsoftOutlookTrigger","typeVersion":1,"position":[-4640,384],"id":"10f308c0-93f6-4b7f-b378-6a8702732047","name":"Ricezione Mail","credentials":{"microsoftOutlookOAuth2Api":{"id":"EySZIVRGzocRrEOf","name":"Outlook Info GommeGo"}},"notes":"show-1"},{"parameters":{"operation":"move","messageId":{"__rl":true,"value":"={{ $json.id }}","mode":"id"},"folderId":{"__rl":true,"value":"AAMkADRmMTYxODRmLWJmZjYtNDQ4Ny1hZGE0LWQzYjNhZjJkZDQyMgAuAAAAAAAbCa7Kx9UPS7NhabBhamKLAQABIvZjidpvQo_FOUmjs9ACAAAAnNEhAAA=","mode":"list","cachedResultName":"GESTITI","cachedResultUrl":"https://outlook.office365.com/mail/AAMkADRmMTYxODRmLWJmZjYtNDQ4Ny1hZGE0LWQzYjNhZjJkZDQyMgAuAAAAAAAbCa7Kx9UPS7NhabBhamKLAQABIvZjidpvQo_FOUmjs9ACAAAAnNEhAAA%3D"}},"type":"n8n-nodes-base.microsoftOutlook","typeVersion":2,"position":[-4336,544],"id":"996d88ed-0764-4fba-8259-08e43c3c124d","name":"Sposta mail","webhookId":"bce38c0a-4722-439a-8039-27d2d03af1db","alwaysOutputData":true,"retryOnFail":true,"credentials":{"microsoftOutlookOAuth2Api":{"id":"EySZIVRGzocRrEOf","name":"Outlook Info GommeGo"}}},{"parameters":{"mode":"combine","combineBy":"combineByPosition","options":{}},"type":"n8n-nodes-base.merge","typeVersion":3.1,"position":[-2816,272],"id":"dfae6732-158c-4fdf-a171-e244416acd52","name":"MERGE DI TUTTI I DATI"},{"parameters":{"jsonSchemaExample":"{\n  \"categoria\": \"string\",\n  \"tipo_interazione\": \"string\", \n  \"confidence\": \"number\",\n  \"risposta_html\": \"string\",\n  \"order_id\": \"string\"\n}"},"type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.2,"position":[-3040,432],"id":"8fb74f0b-a7be-4ad9-ab7c-fd7fd673ae99","name":"Formatta risposta","notes":"{\n  \"categoria\": \"Resi\",\n  \"tipo_interazione\": \"Lamentela\",\n  \"confidence\": 95,\n  \"risposta_html\": \"<p>Gentile Cliente...</p>\",\n  \"thread_storico\": \"Testo storico della conversazione\"\n  }\n"},{"parameters":{"jsCode":"return $input.all().map(item => {\n  const corpo = item.json.output?.risposta_html || \n                item.json.risposta_html || \n                ''ERRORE: Campo risposta non trovato'';\n                \n  const messageId = item.json.message_id || '''';\n  \n  const firmaHtml = `\n    <div style=\"margin-top: 20px; margin-bottom: 20px;\">\n      <img src=\"https://i.ibb.co/QFNDm6xL/White-and-Teal-Minimalist-Marketing-Email-Signature.png\" \n           alt=\"Firma Milena Dobrev - GommeGo\" \n           style=\"max-width: 450px; width: 100%; height: auto; display: block;\" />\n    </div>\n  `.trim();\n\n  const fullHtml = `\n    <div style=\"font-family: Arial, sans-serif; font-size: 14px; color: #333; background-color: #fff;\">\n      ${corpo}\n      ${firmaHtml}\n    </div>\n  `.trim();\n\n  return {\n    json: {\n      message_id: messageId,\n      risposta_html: fullHtml\n    }\n  };\n});"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-2624,192],"id":"4ddaaec0-d257-433d-bec7-8fbcd6035719","name":"1- Firma & Thread Formatter","notes":"return $input.all().map(item => {\n  const corpo = item.json.text || '''';\n  const storico = item.json.thread_storico || '''';\n  \n  const firmaHtml = `\n    <div style=\"margin-top: 20px; margin-: 20px;\">\n      <img src=\"https://i.ibb.co/QFNDm6xL/White-and-Teal-Minimalist-Marketing-Email-Signature.png\" \n           alt=\"Firma Milena Dobrev - GommeGo\" \n           style=\"max-width: 450px; width: 100%; height: auto; display: block;\" />\n    </div>\n  `.trim();\n\n  // Funzione per formattare lo storico come email tradizionale\n  const formatStoricoEmail = (storicoText) => {\n    if (!storicoText) return '''';\n    \n    // Decodifica entit√† HTML\n    let cleanText = storicoText\n      .replace(/&lt;/g, ''<'')\n      .replace(/&gt;/g, ''>'')\n      .replace(/&amp;/g, ''&'')\n      .replace(/&quot;/g, ''\"'');\n    \n    // Cerca pattern specifici per dividere il contenuto\n    let formattedStorico = '''';\n    \n    // Estrai informazioni del mittente (pattern: \"Il giorno ... ha scritto:\")\n    const mittenteMatch = cleanText.match(/Il giorno (.+?), alle ore (.+?), (.+?) ha scritto:/);\n    if (mittenteMatch) {\n      const data = mittenteMatch[1];\n      const ora = mittenteMatch[2];\n      const mittente = mittenteMatch[3];\n      \n      formattedStorico += `<div style=\"margin-bottom: 4px;\"><strong>Da:</strong> ${mittente}</div>`;\n      formattedStorico += `<div style=\"margin-bottom: 4px;\"><strong>Inviato:</strong> ${data} ${ora}</div>`;\n    }\n    \n    // Estrai oggetto\n    const oggettoMatch = cleanText.match(/Oggetto:\\s*(.+?)(?=Gentile|$)/);\n    if (oggettoMatch) {\n      formattedStorico += `<div style=\"margin-bottom: 12px;\"><strong>Oggetto:</strong> ${oggettoMatch[1].trim()}</div>`;\n    }\n    \n    // Estrai il corpo del messaggio (tutto quello che viene dopo \"Oggetto:\")\n    const corpoMatch = cleanText.match(/Oggetto:.*?(Gentile[\\s\\S]*)/);\n    if (corpoMatch) {\n      let corpoMessaggio = corpoMatch[1].trim();\n      \n      // Dividi il testo in frasi per creare paragrafi\n      const frasi = corpoMessaggio.split(/\\.\\s+/).filter(frase => frase.trim().length > 0);\n      \n      formattedStorico += ''<div style=\"margin-top: 15px; line-height: 1.5;\">'';\n      frasi.forEach((frase, index) => {\n        let testoFrase = frase.trim();\n        if (!testoFrase.endsWith(''.'') && index < frasi.length - 1) {\n          testoFrase += ''.'';\n        }\n        formattedStorico += `<div style=\"margin-bottom: 8px;\">${testoFrase}</div>`;\n      });\n      formattedStorico += ''</div>'';\n    }\n    \n    // Se non trova il pattern strutturato, mostra il testo iniziale + quello formattato\n    const testoIniziale = cleanText.split(''Il giorno'')[0].trim();\n    if (testoIniziale) {\n      formattedStorico = `<div style=\"margin-bottom: 15px; font-style: italic;\">${testoIniziale}</div>` + formattedStorico;\n    }\n    \n    return formattedStorico;\n  };\n\n  const storicoFormattato = storico ? `\n    <div style=\"margin-top: 30px; border-top: 1px solid #e1e1e1; padding-top: 15px;\">\n      <div style=\"font-size: 12px; color: #666; margin-bottom: 15px; font-weight: bold;\">\n        ------ Messaggio originale ------\n      </div>\n      <div style=\"font-size: 13px; color: #555; font-family: Arial, sans-serif;\">\n        ${formatStoricoEmail(storico)}\n      </div>\n    </div>\n  ` : '''';\n\n  const fullHtml = `\n    <div style=\"font-family: Arial, sans-serif; font-size: 14px; color: #333; background-color: #fff;\">\n      ${corpo}\n      ${firmaHtml}\n      ${storicoFormattato}\n    </div>\n  `.trim();\n\n  item.json.text = fullHtml;\n  return item;\n});"},{"parameters":{"workflowId":{"__rl":true,"value":"NSeM24op3A6ify6Z","mode":"list","cachedResultName":"SUB_SMART TASK ANALYZER"},"workflowInputs":{"mappingMode":"defineBelow","value":{},"matchingColumns":[],"schema":[],"attemptToConvertTypes":false,"convertFieldsToString":true},"options":{}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[-2624,384],"id":"8c1b299e-f4f1-40ff-9700-17e26b72ef6a","name":"2 - Execute Workflow","notes":"show-7"},{"parameters":{"jsCode":"return $input.all().map(item => {\n  const json = item.json;\n  const html = json.body?.content || '''';\n  const messageId = json.id || '''';\n  const subject = json.subject || '''';\n  const sentDateTime = json.sentDateTime || new Date().toISOString();\n  const categories = json.categories || [];\n  const ccRecipients = json.ccRecipients?.map(c => c.emailAddress?.address) || [];\n  const replyTo = json.replyTo?.map(r => r.emailAddress?.address) || [];\n  const senderName = json.sender?.emailAddress?.name || '''';\n  const senderEmail = json.sender?.emailAddress?.address || '''';\n\n  // ========================================\n  // üß† ENHANCED ORDER EXTRACTION ENGINE v2.0\n  // ========================================\n  \n  function extractOrderIds(text, source = ''unknown'') {\n    if (!text) return [];\n    \n    const orderIds = [];\n    \n    // üéØ PATTERN GOMMEGO SPECIFICI (Priority 1)\n    const gommegoPatterns = [\n      /Il suo ordine n\\.?\\s*([A-Z0-9]{6,12})\\s*√® in transito/gi,\n      /ORDINE N\\.?\\s*([A-Z0-9]{6,12})\\s*√à STATO CONFERMATO/gi,\n      /ordine n\\.?\\s*([A-Z0-9]{6,12})\\s*√® stato/gi,\n      /Your order n\\.?\\s*([A-Z0-9]{6,12})/gi\n    ];\n    \n    // üîç PATTERN GENERICI (Priority 2)\n    const genericPatterns = [\n      /(?:ordine|order)[\\s\\n]*(?:n\\.?|no\\.?|#)?\\s*([A-Z0-9]{6,12})/gi,\n      /\\b([A-Z]{2,4}[A-Z0-9]{4,8})\\b/g, // Codici standalone tipo BCRGBYWMU\n      /#([A-Z0-9]{6,12})\\b/g,\n      /N\\.?\\s*([A-Z0-9]{6,12})\\b/g\n    ];\n    \n    // üìß EMAIL TEMPLATE PATTERNS (Priority 3)\n    const templatePatterns = [\n      /<td[^>]*>.*?(?:ordine|order)[^<]*?([A-Z0-9]{6,12}).*?<\\/td>/gi,\n      /<div[^>]*>.*?(?:ordine|order)[^<]*?([A-Z0-9]{6,12}).*?<\\/div>/gi,\n      /tracking[^a-z]*?([A-Z0-9]{6,12})/gi\n    ];\n    \n    // Estrai con pattern GommeGo (massima priorit√†)\n    gommegoPatterns.forEach(pattern => {\n      let match;\n      while ((match = pattern.exec(text)) !== null) {\n        orderIds.push({\n          id: match[1].toUpperCase(),\n          source: source,\n          confidence: 95,\n          pattern: ''gommego_specific'',\n          context: match[0]\n        });\n      }\n    });\n    \n    // Se non trovato con pattern specifici, usa generici\n    if (orderIds.length === 0) {\n      genericPatterns.forEach(pattern => {\n        let match;\n        while ((match = pattern.exec(text)) !== null) {\n          const orderId = match[1].toUpperCase();\n          // Validazione lunghezza\n          if (orderId.length >= 6 && orderId.length <= 12) {\n            orderIds.push({\n              id: orderId,\n              source: source,\n              confidence: 80,\n              pattern: ''generic'',\n              context: match[0]\n            });\n          }\n        }\n      });\n    }\n    \n    // Pattern HTML come ultimo tentativo\n    if (orderIds.length === 0) {\n      templatePatterns.forEach(pattern => {\n        let match;\n        while ((match = pattern.exec(text)) !== null) {\n          const orderId = match[1].toUpperCase();\n          if (orderId.length >= 6 && orderId.length <= 12) {\n            orderIds.push({\n              id: orderId,\n              source: source,\n              confidence: 70,\n              pattern: ''html_template'',\n              context: match[0]\n            });\n          }\n        }\n      });\n    }\n    \n    return orderIds;\n  }\n\n  // ========================================\n  // üîÑ CONVERSIONE HTML A TESTO INTELLIGENTE\n  // ========================================\n  \n  function htmlToText(htmlContent) {\n    return htmlContent\n      // Rimuovi contenuti nascosti\n      .replace(/<style[\\s\\S]*?>[\\s\\S]*?<\\/style>/gi, '''')\n      .replace(/<script[\\s\\S]*?>[\\s\\S]*?<\\/script>/gi, '''')\n      .replace(/<!--[\\s\\S]*?-->/gi, '''')\n      \n      // Converti strutture HTML mantenendo spazi\n      .replace(/<br\\s*\\/?>/gi, ''\\n'')\n      .replace(/<\\/p>/gi, ''\\n\\n'')\n      .replace(/<\\/div>/gi, ''\\n'')\n      .replace(/<\\/td>/gi, '' | '')\n      .replace(/<\\/tr>/gi, ''\\n'')\n      .replace(/<\\/h[1-6]>/gi, ''\\n\\n'')\n      .replace(/<\\/li>/gi, ''\\n'')\n      .replace(/<p[^>]*>/gi, ''\\n'')\n      .replace(/<h[1-6][^>]*>/gi, ''\\n--- '')\n      .replace(/<li[^>]*>/gi, ''‚Ä¢ '')\n      \n      // Rimuovi TUTTI i tag HTML\n      .replace(/<[^>]+>/g, '' '')\n      \n      // Decodifica entit√† HTML\n      .replace(/&nbsp;/g, '' '')\n      .replace(/&lt;/g, ''<'')\n      .replace(/&gt;/g, ''>'')\n      .replace(/&amp;/g, ''&'')\n      .replace(/&quot;/g, ''\"'')\n      .replace(/&#39;/g, \"''\")\n      .replace(/&apos;/g, \"''\")\n      .replace(/&euro;/g, ''‚Ç¨'')\n      \n      // Pulizia finale\n      .replace(/\\r\\n/g, ''\\n'')\n      .replace(/\\r/g, ''\\n'')\n      .replace(/\\n{3,}/g, ''\\n\\n'')\n      .replace(/[ \\t]+/g, '' '')\n      .replace(/^\\s+/gm, '''')\n      .replace(/\\s+$/gm, '''')\n      .trim();\n  }\n\n  // ========================================\n  // üéØ ESTRAZIONE MULTI-SOURCE ORDER ID\n  // ========================================\n  \n  const tuttoTestuale = htmlToText(html);\n  const righe = tuttoTestuale.split(''\\n'').filter(r => r.trim().length > 0);\n  \n  // Trova fine messaggio cliente\n  const indiceFineRisposta = righe.findIndex(riga => {\n    const r = riga.toLowerCase().trim();\n    return (\n      r.startsWith(''il giorno'') ||\n      r.startsWith(''il ven'') || r.startsWith(''il lun'') || r.startsWith(''il mar'') ||\n      r.startsWith(''il mer'') || r.startsWith(''il gio'') || r.startsWith(''il sab'') || r.startsWith(''il dom'') ||\n      r.includes(''ha scritto:'') || r.includes(''ha inviato:'') || r.includes(''wrote:'') ||\n      r.startsWith(''from:'') || r.startsWith(''da:'') || r.startsWith(''sent:'') ||\n      r.includes(''@gommego.com'') || r.includes(''info@'') || r.includes(''noreply@'') ||\n      r.includes(''-----original message-----'') || r.includes(''messaggio originale'') ||\n      r.match(/\\d{1,2}\\/\\d{1,2}\\/\\d{4}/) || r.match(/\\d{4}-\\d{2}-\\d{2}/) ||\n      r.includes(''2025,'') || r.includes(''2024,'')\n    );\n  });\n\n  // Separa messaggio cliente da thread\n  const messaggioClienteTestuale = indiceFineRisposta !== -1\n    ? righe.slice(0, indiceFineRisposta).join(''\\n'')\n    : tuttoTestuale;\n    \n  const threadStoricoTestuale = indiceFineRisposta !== -1\n    ? righe.slice(indiceFineRisposta).join(''\\n'').trim()\n    : '''';\n\n  // ========================================\n  // üîç RICERCA ORDER ID CON PRIORIT√Ä\n  // ========================================\n  \n  let allOrderIds = [];\n  \n  // Priority 1: Subject line\n  allOrderIds = allOrderIds.concat(extractOrderIds(subject, ''subject''));\n  \n  // Priority 2: Messaggio cliente diretto\n  allOrderIds = allOrderIds.concat(extractOrderIds(messaggioClienteTestuale, ''customer_message''));\n  \n  // Priority 3: Thread storico (email precedenti)\n  allOrderIds = allOrderIds.concat(extractOrderIds(threadStoricoTestuale, ''thread_history''));\n  \n  // Priority 4: Raw HTML (ultimo tentativo)\n  if (allOrderIds.length === 0) {\n    allOrderIds = allOrderIds.concat(extractOrderIds(html, ''raw_html''));\n  }\n  \n  // ========================================\n  // üéØ SELEZIONE BEST ORDER ID\n  // ========================================\n  \n  let bestOrderId = null;\n  let orderIdConfidence = 0;\n  let orderIdSource = ''not_found'';\n  let orderIdContext = '''';\n  \n  if (allOrderIds.length > 0) {\n    // Ordina per confidence e priorit√† source\n    allOrderIds.sort((a, b) => {\n      if (a.confidence !== b.confidence) return b.confidence - a.confidence;\n      \n      const sourcePriority = {\n        ''subject'': 4,\n        ''customer_message'': 3,\n        ''thread_history'': 2,\n        ''raw_html'': 1\n      };\n      \n      return (sourcePriority[a.source] || 0) - (sourcePriority[b.source] || 0);\n    });\n    \n    // Rimuovi duplicati mantenendo il migliore\n    const uniqueOrderIds = allOrderIds.filter((order, index, arr) => \n      arr.findIndex(o => o.id === order.id) === index\n    );\n    \n    bestOrderId = uniqueOrderIds[0].id;\n    orderIdConfidence = uniqueOrderIds[0].confidence;\n    orderIdSource = uniqueOrderIds[0].source;\n    orderIdContext = uniqueOrderIds[0].context;\n  }\n\n  // ========================================\n  // üîÑ PULIZIA MESSAGGIO CLIENTE\n  // ========================================\n  \n  const messaggioClientePulito = messaggioClienteTestuale\n    .replace(/\\n\\s*saluti\\s*$/i, '''')\n    .replace(/\\n\\s*cordiali saluti\\s*$/i, '''')\n    .replace(/\\n\\s*distinti saluti\\s*$/i, '''')\n    .replace(/\\n\\s*grazie\\s*$/i, '''')\n    .replace(/\\n\\s*thanks?\\s*$/i, '''')\n    .replace(/\\n\\s*best regards?\\s*$/i, '''')\n    .trim();\n\n  // ========================================\n  // üìä THREAD REPLY DETECTION\n  // ========================================\n  \n  const subjectLower = subject.trim().toLowerCase();\n  const isThreadReply = \n    subjectLower.startsWith(''re:'') || \n    subjectLower.startsWith(''fw:'') || \n    subjectLower.startsWith(''fwd:'') ||\n    subjectLower.startsWith(''r:'') ||\n    subjectLower.startsWith(''inoltro:'') ||\n    !!json.inReplyTo ||\n    threadStoricoTestuale.length > 50;\n\n  const isFirstMessage = !isThreadReply;\n\n  // ========================================\n  // üö´ SPAM DETECTION\n  // ========================================\n  \n  const isSpam = senderEmail.includes(''noreply@'') || \n                 senderEmail.includes(''no-reply@'') ||\n                 senderEmail.includes(''info@gommego.com'') ||\n                 senderEmail.includes(''sistema@'') ||\n                 subject.toLowerCase().includes(''nuovo ordine'') ||\n                 messaggioClientePulito.length < 10;\n\n  // ========================================\n  // üì§ OUTPUT ESSENZIALE - TOKEN OPTIMIZED\n  // ========================================\n  \n  return {\n    json: {\n      // ‚úÖ CORE FIELDS (same as before)\n      message_id: messageId,\n      mittente: senderEmail,\n      mittente_nome: senderName,\n      oggetto: subject,\n      messaggio_cliente: messaggioClientePulito,\n      thread_storico: threadStoricoTestuale,\n      \n      // ‚úÖ ESSENTIAL METADATA\n      isThreadReply,\n      isFirstMessage,\n      isSpam,\n      data_iso: sentDateTime,\n      data_locale: new Date(sentDateTime).toLocaleString(''it-IT''),\n      \n      // üéØ NEW: ORDER ID (clean result only)\n      order_id: bestOrderId,\n      \n      // ‚úÖ MINIMAL METADATA for workflow\n      reply_to: replyTo,\n      cc: ccRecipients,\n      categorie: categories\n    }\n  };\n});"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-4176,288],"id":"4ab0ed92-91be-42ae-80dd-92edc06f7977","name":"1 - Clean Data for Agent1","alwaysOutputData":true,"notes":"hidden"},{"parameters":{"promptType":"define","text":"=Write the text to reply to the following message from a customer.\nLast message (to answer):\n\"{{ $json.messaggio_cliente }}\"\nSubject: {{$json.oggetto}}\nFrom: {{$json.mittente}}\nPrevious thread:\n\"{{$json.thread_storico}}\"\norder id:{{ $json.order_id }}\n\n","hasOutputParser":true,"options":{"systemMessage":"=Sei Milena, assistente email professionale di GommeGo. Il tuo obiettivo primario √® rassicurare i clienti con risposte email complete che risolvano definitivamente le loro richieste.\n\n## ROLE DEFINITION\n- **Ruolo**: Operatrice post-vendita empatica e professionale\n- **Tono**: Sempre formale (\"Lei\"), rassicurante, definitivo\n- **Output**: Email HTML formali che chiudono le pratiche\n\n## CORE WORKFLOW (3 STEP OBBLIGATORI)\n\n### STEP 1: ANALISI INPUT\nAnalizza sempre:\n- `messaggio_cliente`: Richiesta specifica\n- `order_id`: Se presente, procedi con verifiche; se vuoto, richiedi gentilmente \n- `thread_storico`: Context conversazioni precedenti\n\n**REGOLA SPECIALE ORDER ID**: Se `order_id` = \"000000\" ‚Üí Richiedi SEMPRE il NUMERO ORDINE per poter procedere\n\n### STEP 2: TOOLS SEQUENCE - DECISION TREE OBBLIGATORIO\n\n**PRIMA valuta il tipo di richiesta:**\n\n1. **Se order_id presente (Numero Ordine)** ‚Üí USA INFO ORDINI per verificare dati ordine\n2. **Se domanda su policy/tempi/procedure/pagamenti/resi** ‚Üí USA SEMPRE Vector Store\n3. **Se informazioni generali su azienda** ‚Üí USA SEMPRE Vector Store\n4. **Date & Time** se hai necessit√† di calcolare i tempi\n\n**QUANDO USARE VECTOR STORE (OBBLIGATORIO):**\n- Domande su policy aziendali (tempi spedizione, pagamenti, resi, procedure)\n- Richieste di informazioni generali sull''azienda\n- Casi complessi che richiedono context aziendale\n- **ESEMPIO**: \"Quanto tempo ci mettete per spedire?\" ‚Üí USA Vector Store\n\n**QUANDO NON USARE VECTOR STORE:**\n- Richieste tracking semplici con order_id (Numero Ordine) valido\n- Domande dirette su ordini specifici con dati disponibili\n- Casi standard gi√† coperti dagli esempi senza necessit√† di policy\n\n### STEP 3: RISPOSTA EMAIL\nCombina informazioni e applica template rassicurante appropriato.\n\n## SCENARIO PRINCIPALE (90% CASI): RITARDI TRACKING\n\n**Messaggio Chiave**: \"Pu√≤ stare completamente tranquillo. I ritardi nel tracking sono normalissimi - i corrieri aggiornano sempre con qualche giorno di ritardo, ma il suo ordine procede regolarmente.\"\n\n## SCENARIO 2: ESCALATION A SUPPLIES\n\n**Trigger**: \"danneggiato\", \"difettoso\", \"reso\", \"rimborso\", \"modifica indirizzo\"\n\n**Processo**: \n1. Interroga Vector Store per raccogliere info \n2. Redirect con informazioni contestuali\n\n**Template**: \"Gentile Cliente. Per questa specifica richiesta la invito a scrivere a supplies@tecsolutions.app - il team specializzato si metter√† immediatamente a sua disposizione.\"\n\n## TEMPLATE RISPOSTA BASE\n\n```\nGentile {Nome/Cliente},\n\nHo verificato {specifiche_ordine} e posso confermarle che {rassicurazione_specifica}.\n\n{dettagli_situazione_con_normalizzazione}\n\n{azione_intrapresa_o_prossimi_step}\n\nResto a disposizione per qualsiasi necessit√†.\nCordiali saluti.\n```\n\n## ESEMPI FEW-SHOT\n\n### ESEMPIO 1: Tracking Mancante\n**Input**: \n```\nmessaggio_cliente: \"Non ho ancora il tracking del mio ordine\"\norder_id: \"ABC123\"\nshipment_number: null\n```\n\n**Process**: USA INFO ORDINI (order_id presente - Numero Ordine)\n\n**Output**:\n```\nGentile Cliente,\n\nHo verificato il suo ordine ABC123 e posso confermarle che sta procedendo regolarmente secondo i nostri standard.\n\nPer quanto riguarda il tracking, pu√≤ stare completamente tranquillo. √à normalissimo che i corrieri rilascino il numero di tracciamento con qualche giorno di ritardo rispetto alla presa in carico. Questa dinamica la vediamo quotidianamente e non indica alcun problema.\n\nIl suo ordine √® stato regolarmente evaso e ricever√† il link di tracciamento entro 24-48 ore dalla presa in carico del corriere.\n\nResto a disposizione per qualsiasi necessit√†.\nCordiali saluti.\n```\n\n### ESEMPIO 2: Informazioni Generali\n**Input**: \n```\nmessaggio_cliente: \"Quanto tempo ci mettete per spedire la merce?\"\norder_id: null\n```\n\n**Process**: USA Vector Store (informazione generale su policy aziendale)\n\n**Output**: Fornisci risposta basata su policy ufficiali aziendali\n\n### ESEMPIO 3: Prodotto Mancante\n**Input**: \n```\nmessaggio_cliente: \"Manca ancora 1 pneumatico\"\norder_id: \"XYZ789\"\nshipment_number: \"SP123456\"\n```\n\n**Process**: USA INFO ORDINI (order_id presente - Numero Ordine)\n\n**Output**:\n```\nGentile Cliente,\n\nHo verificato il suo ordine XYZ789 e posso confermarle che il pneumatico mancante √® regolarmente in viaggio.\n\n√à normalissimo che alcuni ordini vengano consegnati in pi√π spedizioni separate per motivi logistici. Secondo il tracking aggiornato, la seconda spedizione √® in transito e arriver√† entro i prossimi 2-3 giorni lavorativi.\n\nIl suo ordine √® completo e ricever√† tutti i prodotti ordinati.\n\nResto a disposizione per qualsiasi necessit√†.\nCordiali saluti.\n```\n\n### ESEMPIO 4: Order ID Mancante\n**Input**: \n```\nmessaggio_cliente: \"Quando arriva il mio ordine?\"\norder_id: null\n```\n\n**Process**: Richiedi order_id (nessun tool necessario)\n\n**Output**:\n```\nGentile Cliente,\n\nSar√≤ felice di aiutarla a verificare lo stato del suo ordine.\n\nPer assisterla nel modo pi√π preciso ed efficiente, pu√≤ gentilmente indicarmi il numero del suo ordine? Lo trova nell''email di conferma che ha ricevuto al momento dell''acquisto.\n\nUna volta in possesso di questa informazione, potr√≤ fornirle tutti i dettagli aggiornati sulla spedizione.\n\nResto a disposizione per qualsiasi necessit√†.\nCordiali saluti.\n```\n\n### ESEMPIO 5: Order ID = \"000000\"\n**Input**: \n```\nmessaggio_cliente: \"Non ho ricevuto il tracking del mio ordine\"\norder_id: \"000000\"\n```\n\n**Process**: Richiedi codice cliente (nessun tool utile)\n\n**Output**:\n```\nGentile Cliente,\n\nPer poter verificare lo stato del suo ordine e fornirle tutte le informazioni aggiornate, ho bisogno del suo codice cliente.\n\nPu√≤ gentilmente indicarmi il codice cliente associato al suo account? Lo trova nelle comunicazioni precedenti o nell''area riservata del nostro sito.\n\nUna volta ricevuto il codice cliente, potr√≤ immediatamente assisterla con tutti i dettagli del suo ordine.\n\nResto a disposizione per qualsiasi necessit√†.\nCordiali saluti.\n```\n\n## REGOLE CRITICHE\n- ‚úÖ USA Vector Store OBBLIGATORIO per policy/tempi/pagamenti/resi/informazioni generali\n- ‚úÖ USA INFO ORDINI quando order_id presente (Numero Ordine)\n- ‚úÖ Richiedi order_id se mancante\n- ‚úÖ **SE order_id = \"000000\" ‚Üí Richiedi SEMPRE codice cliente**\n- ‚úÖ Rassicura SEMPRE il cliente\n- ‚ùå Mai promesse irrealistiche su tracking\n\n## FRASI CHIAVE RASSICURANTI\n- \"Pu√≤ stare completamente tranquillo\"\n- \"√à normalissimo che...\"\n- \"Posso confermarle che...\"\n- \"Il suo ordine procede regolarmente\"\n- \"I corrieri aggiornano sempre in ritardo\""}},"id":"082b0e50-6099-44d0-8d8a-304b5d089357","name":"Milena - Assistente GommeGo","type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.7,"position":[-3440,112],"alwaysOutputData":true,"retryOnFail":true,"notes":"Show-2"},{"parameters":{"description":"\nTRACKING SPEDIZIONI - DETTAGLI CORRIERE AGGIORNATI\nQuesto nodo interroga il sistema ParcelApp per ottenere informazioni dettagliate e aggiornate sul tracking delle spedizioni in corso, fornendo lo stato attuale del pacco e dettagli specifici del corriere.\nFUNZIONE:\nRecupera dati di tracking in tempo reale: posizione attuale del pacco, ultimo aggiornamento, stato della consegna, eventuali problemi o ritardi specifici del corriere.\nQUANDO USARLO:\n\nSOLO se il campo shipment_number √® presente e popolato\nDOPO aver consultato il vector store per il contesto generale\nPer fornire dettagli specifici aggiuntivi al cliente\n\nQUANDO NON USARLO:\n\nSe shipment_number √® vuoto o null\nSe l''ordine √® ancora in fase di preparazione\nCome prima fonte di informazione sui ritardi\n\nIMPORTANTE:\nSe shipment_number √® vuoto, NON utilizzare questo nodo. Invece, spiega al cliente che i ritardi nell''aggiornamento del tracking sono normali e rassicuralo usando le informazioni del vector store sui ritardi dei corrieri.\nQuesto tool fornisce dati specifici, ma il contesto rassicurante deve sempre venire dal vector store.","workflowId":{"__rl":true,"value":"ULm0p4rsvD8rZu57","mode":"list","cachedResultName":"SUB_PARCELAPP"},"workflowInputs":{"mappingMode":"defineBelow","value":{},"matchingColumns":["query"],"schema":[{"id":"query","displayName":"query","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[-3184,432],"id":"25d924a8-736e-4b25-93f9-249e50d3478b","name":"ParcelApp","alwaysOutputData":true,"notes":"show-5"},{"parameters":{"tableId":"email_processing_log","dataToSend":"autoMapInputData"},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-1920,192],"id":"667cb2eb-e671-404a-836f-196d685d71ba","name":" SUPABASE INSERT","retryOnFail":true,"alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"U18uJwD80Uq036TV","name":"Supabase tiziano.annicchiarico@gmail.com"}},"onError":"continueRegularOutput"},{"parameters":{"jsCode":"// =====================================================\n// üìä EMAIL COMPLETE DATA COLLECTOR v4.1 - ORDER_ID FIX\n// Usa order_id gi√† estratto dal Clean Data Agent\n// =====================================================\n\ntry {\n  const startTime = Date.now();\n  \n  // === RECUPERA DATI DAI NODI ===\n  let cleanData = {};\n  let aiClassification = {};\n  let taskAnalysis = {};\n  \n  try {\n    cleanData = $(''1 - Clean Data for Agent1'').item.json || {};\n  } catch (e) {\n    cleanData = {\n      mittente: $json.sender?.emailAddress?.address || '''',\n      mittente_nome: $json.sender?.emailAddress?.name || null,\n      oggetto: $json.subject || '''',\n      messaggio_cliente: '''',\n      thread_storico: '''',\n      order_id: null  // Fallback\n    };\n  }\n  \n  try {\n    const mergeData = $(''MERGE DI TUTTI I DATI'').item.json || {};\n    aiClassification = {\n      categoria: mergeData.categoria || mergeData.output?.categoria || ''Unknown'',\n      confidence: mergeData.confidence || mergeData.output?.confidence || 0,\n      tipo_interazione: mergeData.tipo_interazione || mergeData.output?.tipo_interazione || ''Standard''\n    };\n  } catch (e) {\n    aiClassification = { categoria: ''Unknown'', confidence: 0, tipo_interazione: ''Standard'' };\n  }\n  \n  try {\n    const taskData = $(''2 - Execute Workflow'').item.json || {};\n    taskAnalysis = {\n      gap_identified: taskData.gap_identified || false,\n      customer_satisfaction: taskData.customer_satisfaction || ''unknown'',\n      required_actions: taskData.required_actions || [],\n      ai_promises: taskData.ai_promises || [],\n      sentiment: taskData.customer_sentiment || ''neutral'',\n      urgency_level: taskData.urgency_level || null,\n      follow_up_needed: taskData.follow_up_needed || false,\n      task_created: taskData.task_created || false,\n      created_task_id: taskData.created_task_id || null\n    };\n  } catch (e) {\n    taskAnalysis = {\n      gap_identified: false,\n      customer_satisfaction: ''unknown'',\n      required_actions: [],\n      ai_promises: [],\n      sentiment: ''neutral'',\n      urgency_level: null,\n      follow_up_needed: false,\n      task_created: false,\n      created_task_id: null\n    };\n  }\n  \n  const currentData = $json || {};\n  \n  // === ESTRAZIONE DATI ===\n  const customerEmail = cleanData.mittente || currentData.sender?.emailAddress?.address || '''';\n  const customerName = cleanData.mittente_nome || currentData.sender?.emailAddress?.name || null;\n  const subject = cleanData.oggetto || currentData.subject || '''';\n  const messageText = cleanData.messaggio_cliente || '''';\n  const aiResponse = currentData.risposta_html || currentData.text || '''';\n  \n  // === EMAIL ID GARANTITO ===\n  const emailId = currentData.message_id || \n                 cleanData.message_id || \n                 currentData.id || \n                 `email_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n  \n  if (!emailId) {\n    throw new Error(''‚ùå email_id cannot be null'');\n  }\n  \n  // === ORDER ID - USA VALORE GI√Ä ESTRATTO ===\n  const extractedOrderId = cleanData.order_id || null;\n  \n  // === PERFORMANCE METRICS ===\n  const responseLength = aiResponse.length;\n  const processingTime = responseLength > 0 ? Math.max(1000, responseLength * 2) : 1000;\n  const aiProcessingTime = Math.round(processingTime * 0.6);\n  \n  // === JSONB OBJECTS ===\n  const conversationContext = {\n    message_length: messageText.length,\n    thread_length: (cleanData.thread_storico || '''').length,\n    is_thread_reply: cleanData.isThreadReply || false,\n    is_first_message: cleanData.isFirstMessage !== false,\n    subject: subject,\n    customer_email: customerEmail,\n    extracted_order_id: extractedOrderId\n  };\n  \n  const aiAnalysis = {\n    gap_identified: taskAnalysis.gap_identified,\n    customer_satisfaction: taskAnalysis.customer_satisfaction,\n    required_actions: taskAnalysis.required_actions,\n    ai_promises: taskAnalysis.ai_promises,\n    sentiment: taskAnalysis.sentiment,\n    follow_up_needed: taskAnalysis.follow_up_needed,\n    classification: aiClassification.categoria,\n    confidence: parseInt(aiClassification.confidence) || 0,\n    interaction_type: aiClassification.tipo_interazione\n  };\n  \n  const processingSteps = [\n    { step: ''received'', timestamp: new Date(Date.now() - processingTime).toISOString(), duration_ms: 0 },\n    { step: ''ai_processed'', timestamp: new Date(Date.now() - 400).toISOString(), duration_ms: aiProcessingTime },\n    { step: ''completed'', timestamp: new Date().toISOString(), duration_ms: 400 }\n  ];\n  \n  // === OUTPUT COMPLETO PER INSERT ===\n  const emailRecord = {\n    email_id: emailId,\n    sender_email: customerEmail,  // Campo richiesto dal DB\n    customer_email: customerEmail,\n    customer_name: customerName,\n    order_id: extractedOrderId,  // ‚úÖ USA ORDER_ID ESTRATTO DAL CLEAN DATA AGENT\n    subject: subject,\n    body_length: parseInt(messageText.length) || 0,\n    is_thread_reply: conversationContext.is_thread_reply,\n    ai_response_generated: responseLength > 0,\n    ai_response_length: parseInt(responseLength) || 0,\n    ai_model_used: ''gpt-4o'',\n    ai_processing_time_ms: parseInt(aiProcessingTime) || 0,\n    final_classification: aiClassification.categoria,\n    final_confidence: parseInt(aiClassification.confidence) || null,\n    interaction_type: aiClassification.tipo_interazione,\n    status: ''completed'',\n    total_processing_time_ms: parseInt(processingTime) || 0,\n    processing_start_time: new Date(Date.now() - processingTime).toISOString(),\n    processing_end_time: new Date().toISOString(),\n    send_attempted: true,\n    send_successful: true,\n    send_time: new Date().toISOString(),\n    send_error: null,\n    has_task_created: taskAnalysis.task_created,\n    task_id: taskAnalysis.created_task_id,\n    gap_detected: taskAnalysis.gap_identified,\n    urgency_level: taskAnalysis.urgency_level,\n    ai_analysis: aiAnalysis,\n    conversation_context: conversationContext,\n    processing_steps: processingSteps,\n    workflow_version: ''optimized_v4.1_order_fix'',\n    n8n_execution_id: $execution.id,\n    updated_at: new Date().toISOString()\n  };\n  \n  console.log(''‚úÖ EMAIL RECORD PREPARED FOR INSERT'');\n  console.log(''üìß Email ID:'', emailId);\n  console.log(''üë§ Customer:'', customerEmail);\n  console.log(''üì¶ Order ID:'', extractedOrderId || ''NOT_FOUND'');\n  console.log(''ü§ñ Classification:'', aiClassification.categoria, `(${aiClassification.confidence}%)`);\n  console.log(''üìä Fields ready:'', Object.keys(emailRecord).length);\n  \n  return [{ json: emailRecord }];\n  \n} catch (error) {\n  console.error(''‚ùå DATA COLLECTOR ERROR:'', error.message);\n  \n  // FALLBACK MINIMAL RECORD\n  const fallbackRecord = {\n    email_id: $json?.id || `error_${Date.now()}`,\n    sender_email: $json?.sender?.emailAddress?.address || ''unknown@error.com'',\n    customer_email: $json?.sender?.emailAddress?.address || ''unknown@error.com'',\n    order_id: null,  // Fallback order_id\n    status: ''error'',\n    send_error: error.message,\n    ai_response_generated: false,\n    processing_end_time: new Date().toISOString(),\n    workflow_version: ''optimized_v4.1_error'',\n    n8n_execution_id: $execution.id,\n    updated_at: new Date().toISOString()\n  };\n  \n  return [{ json: fallbackRecord }];\n}"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-2160,192],"id":"18cbb76e-86a1-41d7-b62c-f4bddf0d03dc","name":" EMAIL DATA COLLECTOR "},{"parameters":{"jsCode":"// SUCCESS LOGGING\nconst emailId = $json.email_id || ''unknown'';\nconst insertedId = $json.id || ''no-id'';\n\nconsole.log(''üéâ SUPABASE INSERT SUCCESS!'');\nconsole.log(''üìß Email ID:'', emailId);\nconsole.log(''üÜî Supabase ID:'', insertedId);\nconsole.log(''‚úÖ Email tracking completed successfully'');\n\nreturn [{\n  json: {\n    success: true,\n    email_id: emailId,\n    supabase_id: insertedId,\n    message: ''Email successfully tracked'',\n    timestamp: new Date().toISOString()\n  }\n}];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-1680,192],"id":"b44e771e-0078-4779-a108-e454b7aa8217","name":"SUCCESS LOG"},{"parameters":{"path":"assistenza-gommego","formTitle":"Richiesta Assistenza GommeGo","formDescription":"Compila il form per ricevere assistenza rapida e precisa","formFields":{"values":[{"fieldLabel":"Email","fieldType":"email","placeholder":"tua-email@esempio.com","requiredField":true},{"fieldLabel":"Nome e Cognome","placeholder":"Mario Rossi","requiredField":true},{"fieldLabel":"Telefono","placeholder":"+39 123 456 7890 (opzionale per urgenze)"},{"fieldLabel":"Tipo di Richiesta","fieldType":"dropdown","fieldOptions":{"values":[{"option":"stato_ordine| Stato del mio ordine"},{"option":"problema_consegna|Problema con la consegna"},{"option":"reso_cambio|Reso o cambio prodotto"},{"option":"rimborso|Richiesta rimborso"},{"option":"info_generali| Informazioni generali"},{"option":"assistenza_tecnica|Assistenza tecnica prodotto"}]},"requiredField":true},{"fieldLabel":"Numero Ordine","placeholder":"Es: BCRGBYWMU (se disponibile)"},{"fieldLabel":"Data Ordine","fieldType":"date"},{"fieldLabel":"Numero Tracking","placeholder":"Codice tracking (se disponibile)"},{"fieldLabel":"Oggetto","placeholder":"Riassumi in poche parole la tua richiesta","requiredField":true},{"fieldLabel":"Messaggio Dettagliato","fieldType":"textarea","placeholder":"Descrivi nel dettaglio la tua richiesta...","requiredField":true},{"fieldLabel":"√à una richiesta urgente?","fieldType":"checkbox"},{"fieldLabel":"Motivo Urgenza","placeholder":"Se urgente, specifica il motivo"}]},"options":{"appendAttribution":false,"buttonLabel":"Invia Richiesta","respondWithOptions":{"values":{"formSubmittedText":"La tua richiesta √® stata ricevuta!"}},"ignoreBots":true,"customCss":":root {\n\t--font-family: ''Open Sans'', sans-serif;\n\t--font-weight-normal: 400;\n\t--font-weight-bold: 600;\n\t--font-size-body: 12px;\n\t--font-size-label: 14px;\n\t--font-size-test-notice: 12px;\n\t--font-size-input: 14px;\n\t--font-size-header: 20px;\n\t--font-size-paragraph: 14px;\n\t--font-size-link: 12px;\n\t--font-size-error: 12px;\n\t--font-size-html-h1: 28px;\n\t--font-size-html-h2: 20px;\n\t--font-size-html-h3: 16px;\n\t--font-size-html-h4: 14px;\n\t--font-size-html-h5: 12px;\n\t--font-size-html-h6: 10px;\n\t--font-size-subheader: 14px;\n\t\n\t/* Colori GommeGo */\n\t--gommego-blue: #1B4F99;\n\t--gommego-blue-dark: #0F3A7A;\n\t--gommego-orange: #F39019;\n\t--gommego-orange-dark: #E57E00;\n\t--gommego-white: #FFFFFF;\n\t\n\t/* Colors - Personalizzati per GommeGo */\n\t--color-background: #f8f9fb;\n\t--color-test-notice-text: var(--gommego-orange);\n\t--color-test-notice-bg: #FFF4E6;\n\t--color-test-notice-border: #FFD9A6;\n\t--color-card-bg: #ffffff;\n\t--color-card-border: #e1e8ef;\n\t--color-card-shadow: rgba(27, 79, 153, 0.08);\n\t--color-link: var(--gommego-blue);\n\t--color-header: var(--gommego-blue-dark);\n\t--color-label: #2c3e50;\n\t--color-input-border: #d4dde6;\n\t--color-input-text: #34495e;\n\t--color-focus-border: var(--gommego-orange);\n\t--color-submit-btn-bg: var(--gommego-orange);\n\t--color-submit-btn-text: #ffffff;\n\t--color-error: #e74c3c;\n\t--color-required: var(--gommego-orange);\n\t--color-clear-button-bg: #95a5a6;\n\t--color-html-text: #2c3e50;\n\t--color-html-link: var(--gommego-orange);\n\t--color-header-subtext: #7f8c8d;\n\t\n\t/* Border Radii */\n\t--border-radius-card: 12px;\n\t--border-radius-input: 8px;\n\t--border-radius-clear-btn: 50%;\n\t--card-border-radius: 12px;\n\t\n\t/* Spacing */\n\t--padding-container-top: 24px;\n\t--padding-card: 28px;\n\t--padding-test-notice-vertical: 12px;\n\t--padding-test-notice-horizontal: 24px;\n\t--margin-bottom-card: 20px;\n\t--padding-form-input: 14px;\n\t--card-padding: 28px;\n\t--card-margin-bottom: 20px;\n\t\n\t/* Dimensions */\n\t--container-width: 480px;\n\t--submit-btn-height: 52px;\n\t--checkbox-size: 20px;\n\t\n\t/* Others */\n\t--box-shadow-card: 0px 6px 24px 0px var(--color-card-shadow);\n\t--opacity-placeholder: 0.6;\n}\n\n/* Stili aggiuntivi per il branding GommeGo */\n.form-submit button {\n\tbackground: linear-gradient(135deg, var(--gommego-orange) 0%, var(--gommego-orange-dark) 100%);\n\tfont-weight: 600;\n\ttext-transform: uppercase;\n\tletter-spacing: 0.5px;\n\ttransition: all 0.3s ease;\n\tbox-shadow: 0 4px 12px rgba(243, 144, 25, 0.3);\n}\n\n.form-submit button:hover {\n\ttransform: translateY(-2px);\n\tbox-shadow: 0 6px 20px rgba(243, 144, 25, 0.4);\n}\n\n.form-header {\n\tbackground: linear-gradient(135deg, var(--gommego-blue) 0%, var(--gommego-blue-dark) 100%);\n\tcolor: white;\n\tpadding: 20px;\n\tmargin: -28px -28px 24px -28px;\n\tborder-radius: 12px 12px 0 0;\n\ttext-align: center;\n}\n\n.form-label {\n\tcolor: var(--gommego-blue-dark);\n\tfont-weight: 500;\n}\n\ninput:focus, \ntextarea:focus, \nselect:focus {\n\tborder-color: var(--gommego-orange);\n\toutline: none;\n\tbox-shadow: 0 0 0 3px rgba(243, 144, 25, 0.1);\n}\n\n/* Checkbox personalizzata */\ninput[type=\"checkbox\"]:checked {\n\taccent-color: var(--gommego-orange);\n}\n\n/* Dropdown stile GommeGo */\nselect {\n\tbackground-image: url(\"data:image/svg+xml,%3Csvg width=''12'' height=''8'' viewBox=''0 0 12 8'' fill=''none'' xmlns=''http://www.w3.org/2000/svg''%3E%3Cpath d=''M1 1.5L6 6.5L11 1.5'' stroke=''%231B4F99'' stroke-width=''2'' stroke-linecap=''round'' stroke-linejoin=''round''/%3E%3C/svg%3E\");\n\tbackground-repeat: no-repeat;\n\tbackground-position: right 12px center;\n\tpadding-right: 40px;\n}\n\n/* Success message stile */\n.form-submit-success {\n\tbackground: linear-gradient(135deg, #27ae60 0%, #229954 100%);\n\tcolor: white;\n\tpadding: 20px;\n\tborder-radius: 8px;\n\ttext-align: center;\n\tfont-weight: 500;\n}\n\n/* Loading state */\n.form-submit button:disabled {\n\tbackground: #95a5a6;\n\tcursor: not-allowed;\n\topacity: 0.7;\n}\n\n/* Error messages con icona */\n.form-error {\n\tcolor: var(--color-error);\n\tfont-size: var(--font-size-error);\n\tmargin-top: 4px;\n\tdisplay: flex;\n\talign-items: center;\n\tgap: 4px;\n}\n\n.form-error:before {\n\tcontent: \"‚ö†Ô∏è\";\n\tfont-size: 14px;\n}\n\n/* Placeholder animato */\ninput::placeholder,\ntextarea::placeholder {\n\ttransition: opacity 0.3s ease;\n}\n\ninput:focus::placeholder,\ntextarea:focus::placeholder {\n\topacity: 0.3;\n}\n\n/* Badge per campi obbligatori */\n.form-label span.required {\n\tcolor: var(--gommego-orange);\n\tfont-weight: bold;\n\tmargin-left: 2px;\n}\n\n/* Animazione ingresso form */\n@keyframes fadeInUp {\n\tfrom {\n\t\topacity: 0;\n\t\ttransform: translateY(20px);\n\t}\n\tto {\n\t\topacity: 1;\n\t\ttransform: translateY(0);\n\t}\n}\n\n.form-card {\n\tanimation: fadeInUp 0.5s ease-out;\n}"}},"type":"n8n-nodes-base.formTrigger","typeVersion":2.1,"position":[-3968,-416],"id":"84d9640a-2905-4803-a596-e3e2317eb5db","name":"Form Assistenza GommeGo","webhookId":"assistenza-gommego"},{"parameters":{"jsCode":"// Processa i dati del form per il workflow principale\nconst formData = $input.first().json;\n\n// Estrai il valore reale dal dropdown (prima del |)\nconst tipoRichiesta = formData[''Tipo di Richiesta''].split(''|'')[0];\n\n// Mappa tipo richiesta a categoria per il workflow\nconst categoriaMapping = {\n  ''stato_ordine'': ''Tracking'',\n  ''problema_consegna'': ''Spedizione'',\n  ''reso_cambio'': ''Resi'',\n  ''rimborso'': ''Rimborsi'',\n  ''info_generali'': ''Informazioni'',\n  ''assistenza_tecnica'': ''Assistenza''\n};\n\n// Determina priorit√† base\nconst prioritaMapping = {\n  ''rimborso'': ''high'',\n  ''reso_cambio'': ''high'',\n  ''problema_consegna'': ''medium'',\n  ''stato_ordine'': ''low'',\n  ''info_generali'': ''low'',\n  ''assistenza_tecnica'': ''medium''\n};\n\n// Crea oggetto strutturato per il workflow principale\nconst processedData = {\n  // Simula struttura email per compatibilit√†\n  id: `form_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\n  \n  // Dati mittente\n  sender: {\n    emailAddress: {\n      address: formData.Email,\n      name: formData[''Nome e Cognome'']\n    }\n  },\n  \n  // Contenuto\n  subject: formData.Oggetto,\n  body: {\n    content: formData[''Messaggio Dettagliato'']\n  },\n  \n  // Metadata aggiuntivi dal form\n  form_data: {\n    tipo_richiesta: tipoRichiesta,\n    categoria: categoriaMapping[tipoRichiesta],\n    telefono: formData.Telefono || null,\n    order_id: formData[''Numero Ordine''] || null,\n    data_ordine: formData[''Data Ordine''] || null,\n    tracking_number: formData[''Numero Tracking''] || null,\n    is_urgent: formData[''√à una richiesta urgente?''] || false,\n    motivo_urgenza: formData[''Motivo Urgenza''] || null,\n    priorita_base: prioritaMapping[tipoRichiesta],\n    source: ''web_form'',\n    timestamp: new Date().toISOString()\n  },\n  \n  // Override per urgenze\n  priority: formData[''√à una richiesta urgente?''] ? ''critical'' : prioritaMapping[tipoRichiesta],\n  \n  // Flag per workflow\n  isFromForm: true,\n  sentDateTime: new Date().toISOString()\n};\n\n// Aggiungi messaggio formattato che include tutti i dati\nprocessedData.messaggio_completo = `\nTIPO RICHIESTA: ${formData[''Tipo di Richiesta''].split(''|'')[1]}\n${formData[''Numero Ordine''] ? `ORDINE N¬∞: ${formData[''Numero Ordine'']}` : ''''}\n${formData[''Data Ordine''] ? `DATA ORDINE: ${formData[''Data Ordine'']}` : ''''}\n${formData[''Numero Tracking''] ? `TRACKING: ${formData[''Numero Tracking'']}` : ''''}\n${formData.Telefono ? `TELEFONO: ${formData.Telefono}` : ''''}\n${formData[''√à una richiesta urgente?''] ? `‚ö†Ô∏è URGENTE: ${formData[''Motivo Urgenza''] || ''Non specificato''}` : ''''}\n\n--- MESSAGGIO ---\n${formData[''Messaggio Dettagliato'']}\n`.trim();\n\nreturn processedData;"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-3728,-416],"id":"a32fcfb7-af7e-41c3-ac35-da02fa7fb757","name":"Processa Dati Form"},{"parameters":{"content":"\nL‚Äôagent Ai elabora le mail ricevute dalla casella info@gommego.com e risponde ai clienti  elaborando le ripsonde interrogando questi tools:\n\nDatabase Vettoriale con Knoledege aziendale\nAPI prestashop per info Ordine e Cliente\nAPI ParcelpsApp.com per Tracking consegne\n\nOutput: Mail Outlook di risposta firmattata con Firma aziendale\n\nL‚Äôagent innesca anche il Sub WF Task Analyzer","height":301,"width":741,"color":4},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-4464,-832],"id":"94502ec3-d167-4111-be55-30145bf73571","name":"Sticky Note"},{"parameters":{"operation":"upsert","schema":{"__rl":true,"mode":"list","value":"public"},"table":{"__rl":true,"value":"return_orders","mode":"list","cachedResultName":"return_orders"},"columns":{"mappingMode":"defineBelow","value":{"order_found":false,"foto_allegate":false,"reso_autorizzato":false,"order_products_0_quantity":"={{ $json.order_products_0_quantity }}","order_products_1_quantity":"={{ $json[\"order_products_1_quantity\"] || null }}","giorni_trascorsi":"={{ $json[\"giorni passati\"] }}","order_reference":"={{ $json[\"Nr Ordine\"] }}","customer_full_name":"={{ $json[\"Nome e Cognome cliente\"] }}","customer_email":"={{ $json[\"Email di conferma ordine\"] }}","data_ricezione_merce":"={{ $json[\"Data ricezione merce\"] }}","data_inoltro_richiesta":"={{ $json[\"data inoltro richiesta\"] }}","motivo_restituzione":"={{ $json[\"Motivo della restituzione \"] }}","descrizione_problema":"={{ $json[\"Descrizione del problema \"] }}","nome_foto_allegata":"={{ $json[\"Nome Foto Allegata\"] }}","testo_estratto":"={{ $json.testo_estratto }}","descrizione_immagine":"={{ $json.descrizione_immagine }}","order_products_0_name":"={{ $json.order_products_0_name }}","order_products_0_reference":"={{ $json.order_products_0_reference }}","order_products_0_ean":"={{ $json.order_products_0_ean }}","order_products_0_unit_price":"={{ $json.order_products_0_unit_price }}","order_products_0_total_price":"={{ $json.order_products_0_total_price }}","order_products_1_reference":"{{ $json[\"order_products_1_reference\"] || null }}","order_products_1_ean":"{{ $json[\"order_products_1_ean\"] || null }}","order_products_1_name":"{{ $json[\"order_products_1_name\"] || null }}","order_products_1_unit_price":"{{ $json[\"order_products_1_unit_price\"] || null }}","order_products_1_total_price":"{{ $json[\"order_products_1_total_price\"] || null }}","shipment_arrival_date":"={{ $json.shipment_arrival_date }}","shipment_tracking_number":"={{ $json.shipment_tracking_number }}","shipment_tracking_url":"={{ $json.shipment_tracking_url }}","codice_richiesta_form":"={{ $json.codice_richiesta }}"},"matchingColumns":["order_reference"],"schema":[{"id":"order_found","displayName":"order_found","required":false,"defaultMatch":false,"display":true,"type":"boolean","canBeUsedToMatch":false},{"id":"rma_id","displayName":"rma_id","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"customer_full_name","displayName":"customer_full_name","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"customer_email","displayName":"customer_email","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"order_reference","displayName":"order_reference","required":true,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"data_ricezione_merce","displayName":"data_ricezione_merce","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":false},{"id":"data_inoltro_richiesta","displayName":"data_inoltro_richiesta","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":false},{"id":"motivo_restituzione","displayName":"motivo_restituzione","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"descrizione_problema","displayName":"descrizione_problema","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"foto_allegate","displayName":"foto_allegate","required":false,"defaultMatch":false,"display":true,"type":"boolean","canBeUsedToMatch":false},{"id":"nome_foto_allegata","displayName":"nome_foto_allegata","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"testo_estratto","displayName":"testo_estratto","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"descrizione_immagine","displayName":"descrizione_immagine","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"order_products_0_name","displayName":"order_products_0_name","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"order_products_0_reference","displayName":"order_products_0_reference","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"order_products_0_ean","displayName":"order_products_0_ean","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"order_products_0_quantity","displayName":"order_products_0_quantity","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":false},{"id":"order_products_0_unit_price","displayName":"order_products_0_unit_price","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"order_products_0_total_price","displayName":"order_products_0_total_price","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"order_products_1_name","displayName":"order_products_1_name","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"order_products_1_reference","displayName":"order_products_1_reference","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"order_products_1_ean","displayName":"order_products_1_ean","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"order_products_1_quantity","displayName":"order_products_1_quantity","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":false},{"id":"order_products_1_unit_price","displayName":"order_products_1_unit_price","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"order_products_1_total_price","displayName":"order_products_1_total_price","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"shipment_arrival_date","displayName":"shipment_arrival_date","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":false},{"id":"shipment_tracking_number","displayName":"shipment_tracking_number","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"shipment_tracking_url","displayName":"shipment_tracking_url","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"reso_autorizzato","displayName":"reso_autorizzato","required":false,"defaultMatch":false,"display":true,"type":"boolean","canBeUsedToMatch":false},{"id":"giorni_trascorsi","displayName":"giorni_trascorsi","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":false},{"id":"codice_richiesta_form","displayName":"codice_richiesta_form","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false,"removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[-2304,-400],"id":"da4ca9ed-817c-4b33-8109-ceb72af6cd83","name":"UPSERT_SUPA_RMA","credentials":{"postgres":{"id":"jBT1O3LaStZrwqsC","name":"Postgres Supabase TEC"}}},{"parameters":{"method":"POST","url":"http://localhost:3001/api/webhook/n8n/execution-complete","sendHeaders":true,"headerParameters":{"parameters":[{"name":"X-Webhook-Secret","value":"pilotpro-webhook-2025-secure"}]},"sendBody":true,"specifyBody":"json","jsonBody":"= {\n    \"executionId\": \"{{ $execution.id }}\",\n    \"workflowId\": \"{{ $workflow.id }}\",\n    \"tenantId\": \"client_simulation_a\",\n    \"status\": \"{{ $execution.executionStatus }}\",\n    \"workflowName\": \"{{ $workflow.name }}\"\n  }","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-4128,544],"id":"a28814f9-4a7a-456b-a466-54828909a600","name":"HTTP Request"}]', '{"OpenAI Chat Model4":{"ai_languageModel":[[{"node":"Milena - Assistente GommeGo","type":"ai_languageModel","index":0}]]},"Embeddings OpenAI3":{"ai_embedding":[[{"node":"Qdrant Vector Store","type":"ai_embedding","index":0}]]},"Qdrant Vector Store":{"ai_tool":[[{"node":"Milena - Assistente GommeGo","type":"ai_tool","index":0}]]},"INFO ORDINI":{"ai_tool":[[{"node":"Milena - Assistente GommeGo","type":"ai_tool","index":0}]]},"Date & Time":{"ai_tool":[[{"node":"Milena - Assistente GommeGo","type":"ai_tool","index":0}]]},"Rispondi a mittente":{"main":[[{"node":" EMAIL DATA COLLECTOR ","type":"main","index":0}],[]]},"Ricezione Mail":{"main":[[{"node":"Sposta mail","type":"main","index":0},{"node":"1 - Clean Data for Agent1","type":"main","index":0}]]},"MERGE DI TUTTI I DATI":{"main":[[{"node":"1- Firma & Thread Formatter","type":"main","index":0},{"node":"2 - Execute Workflow","type":"main","index":0}]]},"Formatta risposta":{"ai_outputParser":[[{"node":"Milena - Assistente GommeGo","type":"ai_outputParser","index":0}]]},"1- Firma & Thread Formatter":{"main":[[{"node":"Rispondi a mittente","type":"main","index":0}]]},"1 - Clean Data for Agent1":{"main":[[{"node":"Milena - Assistente GommeGo","type":"main","index":0},{"node":"MERGE DI TUTTI I DATI","type":"main","index":1}]]},"Milena - Assistente GommeGo":{"main":[[{"node":"MERGE DI TUTTI I DATI","type":"main","index":0}]]},"ParcelApp":{"ai_tool":[[{"node":"Milena - Assistente GommeGo","type":"ai_tool","index":0}]]},"2 - Execute Workflow":{"main":[[]]}," SUPABASE INSERT":{"main":[[{"node":"SUCCESS LOG","type":"main","index":0}],[]]}," EMAIL DATA COLLECTOR ":{"main":[[{"node":" SUPABASE INSERT","type":"main","index":0}]]},"SUCCESS LOG":{"main":[[]]},"Form Assistenza GommeGo":{"main":[[]]},"Processa Dati Form":{"main":[[]]},"Sposta mail":{"main":[[]]}}', '{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","errorWorkflow":"1LreJWx0H8iEqkgn","timeSavedPerExecution":15}', '{"node:Microsoft Outlook Trigger":{"lastTimeChecked":"2025-05-24T14:52:05.004+02:00"},"node:Ricezione Mail":{"lastTimeChecked":"2025-10-08T15:06:19.005+02:00"}}', '{}', 'd865e0c9-bb4d-4128-b3d8-8ca4604f691b', 2, '{"templateCredsSetupCompleted":true}', NULL, '2025-05-30T08:05:44.643Z', '2025-09-04T16:56:16.000Z', false),
  ('88fec904-cee4-459c-add5-7f1e9a8edad1', 'SUB TASK_v2', false, '[{"parameters":{"inputSource":"passthrough"},"type":"n8n-nodes-base.executeWorkflowTrigger","typeVersion":1.1,"position":[-3060,1880],"id":"12187bc3-e866-4a30-9e48-63d43b8f7dc9","name":"üîÑ Workflow Trigger"},{"parameters":{"assignments":{"assignments":[{"id":"data-mapping-1","name":"customer_email","value":"={{ $json.mittente }}","type":"string"},{"id":"data-mapping-2","name":"customer_name","value":"={{ $json.mittente_nome }}","type":"string"},{"id":"data-mapping-3","name":"order_id","value":"={{ $json.order_id }}","type":"string"},{"id":"data-mapping-4","name":"email_subject","value":"={{ $json.oggetto }}","type":"string"},{"id":"data-mapping-5","name":"customer_message","value":"={{ $json.messaggio_cliente }}","type":"string"},{"id":"data-mapping-6","name":"thread_history","value":"={{ $json.thread_storico }}","type":"string"},{"id":"data-mapping-7","name":"ai_response","value":"={{ $json.output.risposta_html }}","type":"string"},{"id":"data-mapping-8","name":"interaction_type","value":"={{ $json.output.tipo_interazione }}","type":"string"},{"id":"data-mapping-9","name":"initial_confidence","value":"={{ $json.output.confidence }}","type":"string"},{"id":"data-mapping-10","name":"is_thread_reply","value":"={{ $json.isThreadReply }}","type":"boolean"},{"id":"data-mapping-11","name":"processing_timestamp","value":"={{ new Date().toISOString() }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-2840,1880],"id":"f23fa855-f7f4-473e-9b70-1b6bf6892bf9","name":"üìã Data Mapper"},{"parameters":{"model":{"__rl":true,"value":"gpt-4o","mode":"list","cachedResultName":"gpt-4o"},"options":{"temperature":0.1}},"id":"96cac8db-0b2d-4b2f-b800-d59464188f08","name":"üß† Conversation Analyzer LLM","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-2620,2200],"credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"promptType":"define","text":"=## RUOLO E OBIETTIVO\nSei un esperto supervisore del servizio clienti specializzato nell''identificare gap operativi in un **business di dropshipping pneumatici auto/moto** quando l''AI fa promesse che richiedono azioni del team umano.\n\n**OBIETTIVO**: Identificare con precisione le promesse dell''AI che necessitano follow-up operativo nel contesto specifico del dropshipping pneumatici.\n\n## FRAMEWORK SPECIFICO PNEUMATICI (Focus Tracking Mancanti)\n- **CRITICO**: Consegne parziali, errori compatibilit√†, ordini smarriti, problemi pagamento\n- **ALTO**: **TRACKING MANCANTI/SBAGLIATI** (70% dei casi - spesso GAP), ritardi prolungati (>7 giorni)\n- **MEDIO**: Richieste info con tracking funzionante, aggiornamenti status, verifiche routine  \n- **BASSO**: Conferme ordine, FAQ, compatibilit√† pneumatici\n\n**REALT√Ä BUSINESS**: Il 70% delle chiamate √® per tracking mancanti/sbagliati dove l''AI DEVE promettere verifiche/invii = GAP operativo reale.\n\n## DATI CONVERSAZIONE (Variables)\n```\n{THREAD_REPLY} = {{ $json.isThreadReply }}\n{FIRST_MESSAGE} = {{ $json.isFirstMessage }}\n{DATE_ISO} = {{ $json.data_iso }}\n{SENDER} = {{ $json.mittente }}\n{SUBJECT} = {{ $json.oggetto }}\n{CUSTOMER_MESSAGE} = {{ $json.messaggio_cliente }}\n{AI_RESPONSE} = {{ $json.risposta_agent }}\n{THREAD_HISTORY} = {{ $json.thread_storico }}\n{INITIAL_CONFIDENCE} = {{ $json.confidence }}\n```\n\n## METODOLOGIA SPECIALIZZATA (Step-Back + Chain of Thought)\n\n**STEP 1 - STEP-BACK PROMPTING**: Prima di analizzare, considera:\n- Nel dropshipping pneumatici, il 70% delle richieste riguarda tracking MANCANTI/SBAGLIATI\n- Quando manca tracking, l''AI DEVE promettere verifiche/invio = GAP operativo reale\n- Come distinguere tra \"tracking mancante\" (problema sistemico) vs \"tracking completo\" (caso raro)?\n- Le promesse \"verificheremo e invieremo tracking\" sono NECESSARIE quando info mancanti\n\n**STEP 2 - CHAIN OF THOUGHT REASONING**: Analizza step-by-step:\n\n1. **Analisi Customer Request Pneumatici**: \n   - √à una richiesta tracking standard? (70% dei casi)\n   - **REGOLA**: Se cliente dice \"faccio presente\", \"notifica\", \"segnalo\" = TONO NEUTRALE\n   - **DISTINGUI**: Tracking con info mancanti vs ansia normale cliente\n   - Che tipo di problema tracking? (link non funziona, codice errato, info incomplete, nessun tracking ricevuto)\n   - L''AI ha informazioni sufficienti per risolvere o deve cercare/verificare?\n\n2. **Analisi AI Response Tracking-Focused**:\n   - **CASO A - TRACKING MANCANTE** (70% casi): AI non ha tracking = DEVE promettere verifica/invio = GAP\n   - **CASO B - TRACKING COMPLETO** (30% casi): Ha tracking + status + ubicazione = NO GAP  \n   - **PROMESSE NECESSARIE**: \"verificheremo\", \"ti invieremo\", \"controlleremo sistema\" = GAP giustificato\n   - **TRACKING MANCANTE**: AI promette \"verificher√≤ e ti invier√≤\" = GAP operativo reale\n   - **TRACKING PRESENTE**: Link funzionante + spiegazione + status = NO GAP\n   - **INFO INSUFFICIENTI**: AI dice \"√® in transito\" senza tracking = GAP (deve fornire tracking)\n\n3. **Gap Identification Tracking-Missing-Aware**:\n   - **REGOLA 70%**: La maggior parte richieste = tracking MANCANTI = GAP necessario e giustificato\n   - L''AI ha tracking da fornire immediatamente o deve cercare/verificare?\n   - **TRACKING MANCANTE**: AI deve promettere \"verificher√≤ e ti invier√≤\" = GAP operativo giusto\n   - **TRACKING PRESENTE**: AI risolve immediatamente con info = NO GAP\n   - Le promesse di verifica tracking sono NECESSARIE quando tracking mancante\n\n4. **Confidence Calibrata Tracking-First**:\n   - 90-100%: Promesse coordinate fornitore/corriere con timeline specifici\n   - 70-89%: Impegni operativi concreti + **TRACKING PROMISES con timeline**\n   - **50-69%: TRACKING INFO MANCANTI con promesse generiche** (\"verificheremo\", \"controlleremo\")\n   - **20-40%: TRACKING CON INFO COMPLETE** (caso pi√π comune - NO GAP)\n   - 0-19%: Gestione completa senza necessit√† operative\n\n## ESEMPI SPECIFICI PNEUMATICI\n\n### Esempio 1 - TRACKING MANCANTE: GAP ALTO (75%)\n**Input**: \n- Cliente: \"Non ho mai ricevuto il tracking del mio ordine pneumatici\"\n- AI: \"Mi scuso per l''inconveniente. **Verificher√≤ lo stato del tuo ordine** e **ti invier√≤ il tracking entro oggi**\"\n\n**Output**:\n```json\n{\n  \"reasoning_steps\": {\n    \"customer_request_analysis\": \"Tracking mai ricevuto - caso comune 70% che richiede azione\",\n    \"ai_promises_identified\": [\"Verificher√≤ lo stato del tuo ordine\", \"Ti invier√≤ il tracking entro oggi\"],\n    \"gap_evaluation\": \"AI non ha tracking disponibile, promette verifica e invio - gap operativo necessario e giustificato\",\n    \"confidence_calculation\": \"75% perch√© tracking mancante richiede azione operativa reale per completare servizio\"\n  },\n  \"gap_identified\": true,\n  \"confidence\": 75,\n  \"customer_satisfaction\": \"neutral\",\n  \"ai_promises\": [\"Verificher√≤ lo stato del tuo ordine\", \"Ti invier√≤ il tracking entro oggi\"],\n  \"required_actions\": [\"Verificare stato ordine nel sistema\", \"Inviare tracking al cliente\"],\n  \"urgency_level\": \"high\",\n  \"follow_up_needed\": true,\n  \"deadline_hours\": 8,\n  \"action_type\": \"tracking\",\n  \"customer_sentiment\": \"Cliente che necessita informazioni tracking mancanti\",\n  \"notes\": \"Tracking mancante - caso comune che richiede verifica sistema e invio\"\n}\n```\n\n### Esempio 2 - TRACKING LINK SBAGLIATO: GAP ALTO (80%)\n**Input**:\n- Cliente: \"Il link tracking che mi avete mandato non funziona\"\n- AI: \"**Verificheremo il problema** e **ti invieremo un tracking corretto entro oggi**\"\n\n**Output**:\n```json\n{\n  \"reasoning_steps\": {\n    \"customer_request_analysis\": \"Link tracking errato - caso comune che blocca il cliente\",\n    \"ai_promises_identified\": [\"Verificheremo il problema\", \"Ti invieremo tracking corretto entro oggi\"],\n    \"gap_evaluation\": \"Tracking errato richiede verifica sistema e invio link corretto - gap operativo necessario\",\n    \"confidence_calculation\": \"80% per tracking errato che richiede fix e reinvio con timeline specifico\"\n  },\n  \"gap_identified\": true,\n  \"confidence\": 80,\n  \"customer_satisfaction\": \"frustrated\",\n  \"ai_promises\": [\"Verificheremo il problema\", \"Ti invieremo tracking corretto entro oggi\"],\n  \"required_actions\": [\"Verificare problema tracking sistema\", \"Inviare link tracking corretto\"],\n  \"urgency_level\": \"high\",\n  \"follow_up_needed\": true,\n  \"deadline_hours\": 8,\n  \"action_type\": \"tracking\",\n  \"customer_sentiment\": \"Cliente frustrato per tracking non funzionante\",\n  \"notes\": \"Fix tracking errato urgente - customer experience compromessa\"\n}\n```\n\n### Esempio 3 - TRACKING COMPLETO RARO: NESSUN GAP (30%)\n**Input**:\n- Cliente: \"Non riesco a trovare il tracking\"\n- AI: \"Il tuo ordine √® spedito con GLS, codice: 12345678. Stato: in transito verso Firenze. Consegna prevista domani.\"\n\n**Output**:\n```json\n{\n  \"reasoning_steps\": {\n    \"customer_request_analysis\": \"Richiesta tracking - caso meno comune dove AI ha info complete\",\n    \"ai_promises_identified\": [],\n    \"gap_evaluation\": \"AI ha fornito tracking completo, status e tempistiche - problema risolto immediatamente\",\n    \"confidence_calculation\": \"30% perch√© AI ha tutte le informazioni necessarie per risolvere autonomamente\"\n  },\n  \"gap_identified\": false,\n  \"confidence\": 30,\n  \"customer_satisfaction\": \"satisfied\",\n  \"ai_promises\": [],\n  \"required_actions\": [],\n  \"urgency_level\": \"low\",\n  \"follow_up_needed\": false,\n  \"deadline_hours\": 0,\n  \"action_type\": \"none\",\n  \"customer_sentiment\": \"Cliente soddisfatto delle informazioni complete\",\n  \"notes\": \"Tracking completo fornito - caso raro dove AI risolve autonomamente\"\n}\n```\n\n### Esempio 4 - ANSIA CLIENTE CON INFO COMPLETE: NESSUN GAP (30%)\n**Input**:\n- Cliente: \"Sono passati 3 giorni, quando arrivano i pneumatici?\"\n- AI: \"Il tuo ordine √® regolarmente in transito. Spedito 2 giorni fa, consegna prevista domani. Tracking: ABC123 - attualmente a Milano.\"\n\n**Output**:\n```json\n{\n  \"reasoning_steps\": {\n    \"customer_request_analysis\": \"Ansia cliente per tempistiche - richiesta rassicurazioni standard\",\n    \"ai_promises_identified\": [],\n    \"gap_evaluation\": \"AI ha fornito informazioni complete su status e previsioni - ansia cliente gestita con info\",\n    \"confidence_calculation\": \"30% perch√© informazioni tracking complete risolvono ansia senza azioni\"\n  },\n  \"gap_identified\": false,\n  \"confidence\": 30,\n  \"customer_satisfaction\": \"neutral\",\n  \"ai_promises\": [],\n  \"required_actions\": [],\n  \"urgency_level\": \"low\",\n  \"follow_up_needed\": false,\n  \"deadline_hours\": 0,\n  \"action_type\": \"none\",\n  \"customer_sentiment\": \"Cliente ansioso ma rassicurato dalle info\",\n  \"notes\": \"Ansia spedizione standard - info tracking complete sufficienti\"\n}\n```\n\n### Esempio 5 - TRACKING MANCANTE CON INFO: NESSUN GAP (25%)\n**Input**:\n- Cliente: \"Non ho mai ricevuto il tracking per il mio ordine\"\n- AI: \"Ti fornisco subito il tracking: GLS 98765432. Il pacco √® in consegna oggi a Roma. Mi scuso per l''omissione.\"\n\n**Output**:\n```json\n{\n  \"reasoning_steps\": {\n    \"customer_request_analysis\": \"Tracking mai ricevuto - problema amministrativo risolto dall''AI\",\n    \"ai_promises_identified\": [],\n    \"gap_evaluation\": \"AI ha fornito tracking immediato e risolto problema - nessuna azione aggiuntiva necessaria\",\n    \"confidence_calculation\": \"25% perch√© problema tracking risolto completamente dall''AI\"\n  },\n  \"gap_identified\": false,\n  \"confidence\": 25,\n  \"customer_satisfaction\": \"satisfied\",\n  \"ai_promises\": [],\n  \"required_actions\": [],\n  \"urgency_level\": \"low\",\n  \"follow_up_needed\": false,\n  \"deadline_hours\": 0,\n  \"action_type\": \"none\",\n  \"customer_sentiment\": \"Cliente soddisfatto della risoluzione immediata\",\n  \"notes\": \"Tracking mancante risolto immediatamente - problema amministrativo chiuso\"\n}\n```\n\n## FORMATO OUTPUT PNEUMATICI\n```json\n{\n  \"reasoning_steps\": {\n    \"customer_request_analysis\": \"analisi specifica problema pneumatici\",\n    \"ai_promises_identified\": [\"promesse operative identificate\"],\n    \"gap_evaluation\": \"necessit√† coordinamento supply chain/corrieri\",\n    \"confidence_calculation\": \"logica calcolo per dropshipping automotive\"\n  },\n  \"gap_identified\": boolean,\n  \"confidence\": number (0-100),\n  \"confidence_reasoning\": \"spiegazione contestualizzata pneumatici\",\n  \"customer_satisfaction\": \"satisfied|neutral|frustrated|angry\",\n  \"ai_promises\": [\"solo impegni operativi reali\"],\n  \"required_actions\": [\"azioni specifiche dropshipping pneumatici\"],\n  \"urgency_level\": \"critical|high|medium|low\",\n  \"follow_up_needed\": boolean,\n  \"deadline_hours\": number,\n  \"action_type\": \"delivery|tracking|return|verification|supplier_contact|technical|none\",\n  \"customer_sentiment\": \"analisi sentiment automotive context\",\n  \"notes\": \"osservazioni specifiche business pneumatici\"\n}\n```\n\n## PRINCIPI SPECIALIZZATI TRACKING-FIRST\n- **TRACKING REQUESTS = 70% dei casi**: La maggior parte NON richiede azione se AI fornisce info complete\n- **INFO COMPLETE = NO GAP**: Link funzionante + status + tempistiche = problema risolto\n- **PROMESSE RARE**: Solo per problemi tecnici o coordinamento reale necessario\n- **ANSIA CLIENTE NORMALE**: Rassicurazioni con info dettagliate = sufficiente\n- **FOCUS SU AZIONI CONCRETE**: Gap solo quando serve intervento operativo reale\n\n**REGOLA AUREA TRACKING CORRETTA**:\n- **TRACKING MANCANTE/SBAGLIATO** (70% casi) = confidence 70-85% (GAP giustificato e necessario)\n- **TRACKING COMPLETO** (30% casi) = confidence 20-30% (NO GAP)  \n- **PROMESSE VERIFICA/INVIO** = GAP operativo reale quando tracking mancante\n- **AI SENZA INFO** = DEVE promettere verifiche = GAP necessario per completare servizio\n- **AI CON INFO COMPLETE** = risolve autonomamente = NO GAP\n\n**BUSINESS REALITY**: Nel dropshipping, tracking mancanti sono problemi sistemici reali che richiedono azione operativa!\n\n**ISTRUZIONI FINALI**: \n- Considera sempre il contesto automotive (sicurezza, urgenza mobilit√†)\n- Distingui tra problemi gestibili vs. necessit√† coordinamento supply chain\n- Mantieni focus su customer satisfaction nel settore automotive\n- Il reasoning deve riflettere le specificit√† del business pneumatici"},"id":"f4283c75-3081-4475-b3f8-43469140d2ee","name":"üîç Conversation Analyzer","type":"@n8n/n8n-nodes-langchain.chainLlm","typeVersion":1.5,"position":[-2620,2010]},{"parameters":{"jsCode":"// üîÑ JSON EXTRACTOR E VALIDATOR v3.0 - SMART TEXT/JSON HANDLER\n// Gestisce sia JSON che testo semplice dal Conversation Analyzer\n\nconst inputText = $json.text || '''';\nconsole.log(''üì• Raw input length:'', inputText.length);\nconsole.log(''üì• Input preview:'', inputText.substring(0, 200) + ''...'');\n\nlet analysis = {};\nlet parseSuccess = false;\nlet inputType = ''unknown'';\n\n// 1Ô∏è‚É£ DETERMINA TIPO DI INPUT\nif (inputText.trim().startsWith(''{'') && inputText.trim().endsWith(''}'')) {\n  inputType = ''json'';\n} else if (inputText.includes(''VALUTAZIONE GAP'') || inputText.includes(''CRITICAL'') || inputText.includes(''HIGH'')) {\n  inputType = ''documentation'';\n} else {\n  inputType = ''text'';\n}\n\nconsole.log(''üîç Input type detected:'', inputType);\n\n// 2Ô∏è‚É£ GESTIONE BASATA SUL TIPO\nif (inputType === ''json'') {\n  // PARSING JSON STANDARD\n  try {\n    let cleanText = inputText.replace(/```json\\n?|\\n?```/g, '''').trim();\n    analysis = JSON.parse(cleanText);\n    parseSuccess = true;\n    console.log(''‚úÖ JSON parsed successfully'');\n  } catch (error) {\n    console.error(''‚ùå JSON parse error:'', error.message);\n    parseSuccess = false;\n  }\n} else {\n  // ANALISI DIRETTA PER TESTO/DOCUMENTAZIONE\n  console.log(''üìù Analyzing text content directly...'');\n  \n  // Recupera i dati originali dal Data Mapper per l''analisi\n  const customerData = $(''üìã Data Mapper'').item.json;\n  const customerMessage = customerData.customer_message || '''';\n  const aiResponse = customerData.ai_response || '''';\n  const orderID = customerData.order_id;\n  \n  console.log(''üìã Customer message:'', customerMessage.substring(0, 100));\n  console.log(''ü§ñ AI response preview:'', aiResponse.substring(0, 100));\n  console.log(''üì¶ Order ID:'', orderID);\n  \n  // LOGICA DI ANALISI DIRETTA\n  analysis = analyzeDirectly(customerMessage, aiResponse, orderID);\n  parseSuccess = true;\n}\n\n// 3Ô∏è‚É£ VALIDAZIONE E FALLBACK\nif (!parseSuccess || typeof analysis.gap_identified === ''undefined'') {\n  console.warn(''‚ö†Ô∏è Using fallback values'');\n  analysis = {\n    gap_identified: false,\n    confidence: 30,\n    confidence_reasoning: ''Errore parsing - analisi fallback'',\n    customer_satisfaction: ''neutral'',\n    ai_promises: [],\n    required_actions: [],\n    urgency_level: ''low'',\n    follow_up_needed: false,\n    deadline_hours: 24,\n    action_type: ''follow_up'',\n    customer_sentiment: ''neutrale'',\n    notes: ''ATTENZIONE: Analisi fallback utilizzata''\n  };\n}\n\n// 4Ô∏è‚É£ SANITIZZAZIONE\nanalysis.confidence = Math.max(0, Math.min(100, parseInt(analysis.confidence) || 0));\nanalysis.deadline_hours = Math.max(1, parseInt(analysis.deadline_hours) || 24);\nanalysis.gap_identified = Boolean(analysis.gap_identified);\nanalysis.follow_up_needed = Boolean(analysis.follow_up_needed);\nanalysis.ai_promises = Array.isArray(analysis.ai_promises) ? analysis.ai_promises : [];\nanalysis.required_actions = Array.isArray(analysis.required_actions) ? analysis.required_actions : [];\n\n// 5Ô∏è‚É£ VALIDAZIONE ENUM\nconst validSatisfaction = [''satisfied'', ''neutral'', ''frustrated'', ''angry''];\nconst validUrgency = [''critical'', ''high'', ''medium'', ''low''];\nconst validActions = [''tracking'', ''delivery'', ''refund'', ''follow_up'', ''verification'', ''escalation''];\n\nif (!validSatisfaction.includes(analysis.customer_satisfaction)) {\n  analysis.customer_satisfaction = ''neutral'';\n}\nif (!validUrgency.includes(analysis.urgency_level)) {\n  analysis.urgency_level = ''low'';\n}\nif (!validActions.includes(analysis.action_type)) {\n  analysis.action_type = ''follow_up'';\n}\n\n// 6Ô∏è‚É£ LOGGING\nconsole.log(''üìä Final Analysis Results:'');\nconsole.log(''- Input Type:'', inputType);\nconsole.log(''- Parse Success:'', parseSuccess);\nconsole.log(''- Gap Identified:'', analysis.gap_identified);\nconsole.log(''- Confidence:'', analysis.confidence + ''%'');\nconsole.log(''- Urgency:'', analysis.urgency_level);\nconsole.log(''- Action Type:'', analysis.action_type);\n\n// 7Ô∏è‚É£ OUTPUT\nreturn [{\n  json: {\n    ...analysis,\n    _metadata: {\n      input_type: inputType,\n      parsing_success: parseSuccess,\n      validation_timestamp: new Date().toISOString(),\n      input_length: inputText.length\n    }\n  }\n}];\n\n// üîß FUNZIONE DI ANALISI DIRETTA\nfunction analyzeDirectly(customerMessage, aiResponse, orderID) {\n  console.log(''üîç Starting direct analysis...'');\n  \n  const message = customerMessage.toLowerCase();\n  const response = aiResponse.toLowerCase();\n  \n  // RILEVAMENTO PROMESSE AI CRITICHE\n  const criticalPromises = [\n    ''rimborso'', ''rimborseremo'', ''restituiremo'',\n    ''sostituiremo'', ''sostituizione'', ''cambieremo'',\n    ''contatteremo'', ''vi contatteremo'', ''vi chiameremo''\n  ];\n  \n  const hasCriticalPromises = criticalPromises.some(promise => response.includes(promise));\n  \n  // RILEVAMENTO SPIEGAZIONI COMPLETE\n  const hasCompleteInfo = response.includes(''tracking'') || \n                         response.includes(''in transito'') || \n                         response.includes(''spedizione'') ||\n                         response.includes(''corriere'') ||\n                         response.includes(''consegna'');\n  \n  // RILEVAMENTO PROBLEMI CLIENTE\n  const hasShippingIssue = message.includes(''manca'') || \n                          message.includes(''non ho ricevuto'') ||\n                          message.includes(''ritardo'') ||\n                          message.includes(''problema'');\n  \n  // LOGICA DECISIONALE\n  let urgency_level = ''low'';\n  let gap_identified = false;\n  let confidence = 70;\n  \n  if (hasCriticalPromises) {\n    urgency_level = ''high'';\n    gap_identified = true;\n    confidence = 85;\n  } else if (hasShippingIssue && !hasCompleteInfo) {\n    urgency_level = ''medium'';\n    gap_identified = true;\n    confidence = 75;\n  } else if (hasShippingIssue && hasCompleteInfo) {\n    // CASO SPECIFICO: Cliente segnala problema MA AI ha spiegato tutto\n    urgency_level = ''low'';\n    gap_identified = false;\n    confidence = 80;\n  }\n  \n  return {\n    gap_identified: gap_identified,\n    confidence: confidence,\n    confidence_reasoning: `Analisi diretta basata su promesse AI: ${hasCriticalPromises}, info complete: ${hasCompleteInfo}`,\n    customer_satisfaction: hasShippingIssue ? ''frustrated'' : ''neutral'',\n    ai_promises: hasCriticalPromises ? [''Contatto/verifica promesso''] : [],\n    required_actions: gap_identified ? [''tracking'', ''follow_up''] : [],\n    urgency_level: urgency_level,\n    follow_up_needed: gap_identified,\n    deadline_hours: urgency_level === ''high'' ? 8 : urgency_level === ''medium'' ? 24 : 48,\n    action_type: hasShippingIssue ? ''tracking'' : ''follow_up'',\n    customer_sentiment: hasShippingIssue ? ''preoccupato per spedizione'' : ''neutrale'',\n    notes: `Analisi diretta - Order: ${orderID}, Issue: ${hasShippingIssue}, Promises: ${hasCriticalPromises}`\n  };\n}"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-2244,2135],"id":"beeb2023-8254-4814-acd4-77dd75d34b64","name":"üîß JSON Extractor & Validator"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"gap-detected","leftValue":"={{ $json.gap_identified }}","rightValue":"true","operator":{"type":"boolean","operation":"true","singleValue":true}},{"id":"confidence-check","leftValue":"={{ $json.confidence }}","rightValue":50,"operator":{"type":"number","operation":"gte"}}],"combinator":"and"},"options":{}},"id":"20c6a40a-89c5-4af0-bac7-8bf7d65df1fb","name":"‚ùì Should Create Task?","type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-2024,2135]},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4o-mini"},"options":{"temperature":0.1}},"id":"39514974-4934-46fc-9ad0-8e4afa2a2cbf","name":"‚öôÔ∏è Enhanced Task Generator LLM","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-1760,1940],"credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"promptType":"define","text":"=# ‚öôÔ∏è ENHANCED TASK GENERATOR - GommeGo Operations\n\n## RUOLO\nSei un task manager specializzato nella creazione di task operativi strutturati per il team customer service GommeGo.\n\n## CONTESTO OPERATIVO\n- **Azienda**: GommeGo - E-commerce pneumatici\n- **Team**: Customer service con focus su post-vendita\n- **Processi**: Tracking spedizioni, gestione resi, risoluzione problemi consegna\n\n## DATI ANALISI RICEVUTI\n**Gap Identificato**:{{ $json.gap_identified }} \n**Confidence**: {{ $json.confidence }}\n**Promesse AI**: {{ $json.ai_promises }}\n**Azioni Richieste**: {{ $json.required_actions }}\n**Urgenza**: {{ $json.urgency_level }}\n**Tipo Azione**: {{ $json.required_actions }}\n**Scadenza Ore**: {{ $json.deadline_hours }}\n**Note**: {{ $json.notes }}\n\n## DATI CLIENTE\n**Email**: {{ $(''üìã Data Mapper'').item.json.customer_email }}\n**Nome**: {{ $(''üìã Data Mapper'').item.json.customer_name }}\n**Ordine**: {{ $(''üìã Data Mapper'').item.json.order_id }}\n**Oggetto**: {{ $(''üìã Data Mapper'').item.json.email_subject }}\n**Messaggio**:{{ $(''üìã Data Mapper'').item.json.customer_message }} \n\n## LOGICA CREAZIONE TASK\n\n### PRIORIT√Ä MAPPING\n- **CRITICAL** ‚Üí priority: \"critical\", deadline: 2-6 ore\n- **HIGH** ‚Üí priority: \"high\", deadline: 8-24 ore  \n- **MEDIUM** ‚Üí priority: \"medium\", deadline: 24-48 ore\n- **LOW** ‚Üí priority: \"low\", deadline: 48-72 ore\n\n### SPECIALIZZAZIONE PER TIPO\n\n**TRACKING**: \n- Titolo: \"Verifica tracking ordine [ORDER_ID]\"\n- Focus: Aggiornamento sistemi, contatto corriere\n\n**DELIVERY**:\n- Titolo: \"Problema consegna ordine [ORDER_ID]\"\n- Focus: Coordinamento logistico, aggiornamento cliente\n\n**REFUND**:\n- Titolo: \"Elaborazione rimborso ordine [ORDER_ID]\"\n- Focus: Processo amministrativo, timeline compliance\n\n**VERIFICATION**:\n- Titolo: \"Verifica tecnica ordine [ORDER_ID]\"\n- Focus: Controllo qualit√†, validazione dati\n\n## TEMPLATE TASK STRUTTURATO\n\nGenera UN SINGOLO TASK con questa struttura ESATTA:\n\n{\n  \"title\": \"Titolo specifico e actionable\",\n  \"description\": \"Descrizione dettagliata del problema e azioni necessarie. Include: contesto cliente, promesse AI specifiche, risultato atteso.\",\n  \"priority\": \"critical|high|medium|low\",\n  \"action_type\": \"[MANTIENI VALORE RICEVUTO]\",\n  \"deadline_hours\": [CALCOLO BASATO SU PRIORITY],\n  \"customer_context\": {\n    \"email\": \"[EMAIL_CLIENTE]\",\n    \"name\": \"[NOME_CLIENTE]\",\n    \"order_id\": \"[ORDER_ID]\",\n    \"subject\": \"[OGGETTO_EMAIL]\",\n    \"issue_summary\": \"Riassunto problema in max 100 caratteri\"\n  },\n  \"ai_commitments\": [\"Lista promesse AI da onorare\"],\n  \"execution_steps\": [\n    \"Passo 1: Azione specifica con dettagli\",\n    \"Passo 2: Seconda azione con modalit√†\", \n    \"Passo 3: Follow-up e comunicazione cliente\"\n  ],\n  \"success_criteria\": \"Condizioni che definiscono il completamento task\",\n  \"escalation_trigger\": \"Quando escalare a supervisore\",\n  \"notes\": \"Informazioni aggiuntive per l''operatore\",\n  \"confidence_level\": [CONFIDENCE_RICEVUTA],\n  \"validation_required\": [true se confidence < 70, false altrimenti]\n}\n\n## ESEMPIO PRATICO\n\nSe ricevi:\n- action_type: \"tracking\"\n- urgency_level: \"high\" \n- order_id: \"BCRGBYWMU\"\n- ai_promises: [\"Contatteremo corriere\", \"Update entro 24h\"]\n\nGenera:\n```json\n{\n  \"title\": \"URGENTE: Verifica tracking ordine BCRGBYWMU\",\n  \"description\": \"Cliente segnala mancanza pneumatico da consegna parziale. AI ha promesso contatto corriere e aggiornamento entro 24h. Necessario contattare GLS e aggiornare cliente con tracking reale.\",\n  \"priority\": \"high\",\n  \"action_type\": \"tracking\",\n  \"deadline_hours\": 16,\n  \"customer_context\": {\n    \"email\": \"cliente@email.com\",\n    \"name\": \"Mario Rossi\",\n    \"order_id\": \"BCRGBYWMU\", \n    \"subject\": \"Problema consegna\",\n    \"issue_summary\": \"Consegna parziale - manca 1 pneumatico\"\n  },\n  \"ai_commitments\": [\"Contattare corriere GLS\", \"Fornire update entro 24 ore\"],\n  \"execution_steps\": [\n    \"Contattare GLS con numero ordine per localizzare pneumatico mancante\",\n    \"Verificare stato seconda spedizione nei sistemi interni\",\n    \"Chiamare cliente per comunicare aggiornamenti e nuovo ETA\"\n  ],\n  \"success_criteria\": \"Cliente informato su tracking reale e ETA confermato\",\n  \"escalation_trigger\": \"Se corriere non fornisce info entro 4 ore\",\n  \"notes\": \"Priorit√† alta - cliente gi√† frustrato per consegna parziale\",\n  \"confidence_level\": 85,\n  \"validation_required\": false\n}\n```\n\n## OUTPUT FINALE\n\nRestituisci SOLO il JSON del task (senza markdown o testo aggiuntivo)."},"id":"ce3582a2-cfe4-48b1-817a-0043f91b0f01","name":"‚öôÔ∏è Enhanced Task Generator","type":"@n8n/n8n-nodes-langchain.chainLlm","typeVersion":1.5,"position":[-1800,1760]},{"parameters":{"jsCode":"// üèóÔ∏è TASK ENRICHER v6.0 - Ultra Simplified for Merge\n// Usa solo i dati essenziali dal merge per creare il task DB-ready\n\nconsole.log(''üèóÔ∏è === TASK ENRICHER v6.0 - ULTRA SIMPLIFIED ==='');\nconst startTime = Date.now();\n\ntry {\n  // ===============================================\n  // üì• ESTRAZIONE DATI DAL MERGE (3 INPUT)\n  // ===============================================\n  \n  const allInputs = $input.all();\n  console.log(`üì• Received ${allInputs.length} inputs from merge`);\n  \n  // Input 1: Customer Data (Data Mapper)\n  const customerData = allInputs[0]?.json || {};\n  \n  // Input 2: Analysis Data (Conversation Analyzer)  \n  const analysisRaw = allInputs[1]?.json?.text || ''{}'';\n  let analysisData = {};\n  try {\n    analysisData = JSON.parse(analysisRaw);\n  } catch (e) {\n    console.warn(''‚ö†Ô∏è Analysis parsing failed, using defaults'');\n    analysisData = { confidence: 50, gap_identified: false };\n  }\n  \n  // Input 3: Task Data (Enhanced Task Generator)\n  const taskRaw = allInputs[2]?.json?.text || ''{}'';\n  let taskData = {};\n  try {\n    taskData = JSON.parse(taskRaw);\n  } catch (e) {\n    console.warn(''‚ö†Ô∏è Task parsing failed, using defaults'');\n    taskData = { title: ''Task automatico'', priority: ''medium'' };\n  }\n  \n  console.log(''‚úÖ Data extracted successfully:'');\n  console.log(`- Customer: ${customerData.customer_email}`);\n  console.log(`- Order ID: ${customerData.order_id}`);\n  console.log(`- Analysis confidence: ${analysisData.confidence}`);\n  console.log(`- Task title: ${taskData.title}`);\n  \n  // ===============================================\n  // üèóÔ∏è BUILD FINAL TASK (DB-READY)\n  // ===============================================\n  \n  // Generate unique task ID\n  const taskId = `task_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n  \n  // Calculate deadline\n  const deadlineHours = parseInt(taskData.deadline_hours) || 24;\n  const deadline = new Date();\n  deadline.setHours(deadline.getHours() + deadlineHours);\n  \n  // Adjust for business hours\n  const hour = deadline.getHours();\n  const day = deadline.getDay();\n  if (hour >= 22 || hour < 8) {\n    deadline.setHours(8, 0, 0, 0);\n    if (hour >= 22) deadline.setDate(deadline.getDate() + 1);\n  }\n  if (day === 0) deadline.setDate(deadline.getDate() + 1);\n  if (day === 6) deadline.setDate(deadline.getDate() + 2);\n  \n  // Final task object for Supabase\n  const finalTask = {\n    // Required DB fields\n    id: taskId,\n    created_at: new Date().toISOString(),\n    updated_at: new Date().toISOString(),\n    \n    // Task info\n    title: taskData.title || ''Task automatico'',\n    description: taskData.description || ''Task generato automaticamente'',\n    priority: taskData.priority || ''medium'',\n    status: ''pending'',\n    action_type: taskData.action_type || ''follow_up'',\n    deadline: deadline.toISOString(),\n    \n    // Customer info\n    customer_email: customerData.customer_email || ''unknown@email.com'',\n    customer_name: customerData.customer_name || null,\n    order_id: customerData.order_id || null,\n    email_subject: customerData.email_subject || '''',\n    \n    // Conversation context (JSONB field)\n    conversation_context: {\n      customer_message: customerData.customer_message || '''',\n      ai_response: customerData.ai_response || '''',\n      thread_history: customerData.thread_history || '''',\n      is_thread_reply: customerData.is_thread_reply || false,\n      interaction_type: customerData.interaction_type || ''unknown'',\n      \n      analysis: {\n        confidence: parseInt(analysisData.confidence) || 50,\n        customer_satisfaction: analysisData.customer_satisfaction || ''neutral'',\n        customer_sentiment: analysisData.customer_sentiment || ''neutrale'',\n        ai_promises: analysisData.ai_promises || [],\n        required_actions: analysisData.required_actions || [],\n        gap_identified: Boolean(analysisData.gap_identified),\n        urgency_level: analysisData.urgency_level || ''medium''\n      },\n      \n      task_generation: {\n        ai_commitments: taskData.ai_commitments || [],\n        execution_steps: taskData.execution_steps || [],\n        success_criteria: taskData.success_criteria || '''',\n        escalation_trigger: taskData.escalation_trigger || '''',\n        confidence_level: parseInt(taskData.confidence_level) || 50,\n        validation_required: Boolean(taskData.validation_required)\n      }\n    },\n    \n    // Workflow fields\n    source: ''smart_analyzer'',\n    assigned_to: null,\n    notes: taskData.notes || '''',\n    \n    // Notification flags\n    urgent_notification: taskData.priority === ''critical'' || taskData.priority === ''high'',\n    telegram_sent: false,\n    whatsapp_sent: false,\n    email_sent: false,\n    calendar_created: false\n  };\n  \n  // ===============================================\n  // üìä FINAL LOGGING\n  // ===============================================\n  \n  const processingTime = Date.now() - startTime;\n  console.log(''üéâ TASK CREATION COMPLETED'');\n  console.log(''='' .repeat(40));\n  console.log(''üÜî Task ID:'', finalTask.id);\n  console.log(''üë§ Customer:'', finalTask.customer_email);\n  console.log(''üì¶ Order:'', finalTask.order_id);\n  console.log(''‚ö° Priority:'', finalTask.priority);\n  console.log(''üéØ Action:'', finalTask.action_type);\n  console.log(''üîî Urgent:'', finalTask.urgent_notification);\n  console.log(''üìä Confidence:'', finalTask.conversation_context.analysis.confidence);\n  console.log(''‚è±Ô∏è Processing:'', processingTime + ''ms'');\n  console.log(''='' .repeat(40));\n  \n  return [{ json: finalTask }];\n  \n} catch (error) {\n  console.error(''üí• ERROR in Task Enricher:'', error.message);\n  \n  // Emergency fallback\n  const emergencyTask = {\n    id: `emergency_${Date.now()}`,\n    created_at: new Date().toISOString(),\n    updated_at: new Date().toISOString(),\n    title: ''ERRORE - Revisione richiesta'',\n    description: `Errore nel Task Enricher: ${error.message}`,\n    priority: ''critical'',\n    status: ''pending'',\n    action_type: ''escalation'',\n    deadline: new Date(Date.now() + 2 * 60 * 60 * 1000).toISOString(),\n    customer_email: ''system@error.com'',\n    customer_name: null,\n    order_id: null,\n    email_subject: ''Sistema Error'',\n    conversation_context: {\n      analysis: { confidence: 0 },\n      processing: { \n        error: error.message,\n        timestamp: new Date().toISOString()\n      }\n    },\n    source: ''emergency_fallback'',\n    assigned_to: null,\n    notes: `ERRORE: ${error.message}`,\n    urgent_notification: true,\n    telegram_sent: false,\n    whatsapp_sent: false,\n    email_sent: false,\n    calendar_created: false\n  };\n  \n  return [{ json: emergencyTask }];\n}"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-1180,1760],"id":"cae28639-305c-4e47-a2d5-effe55c60dce","name":"üèóÔ∏è Task Enricher"},{"parameters":{"tableId":"smart_tasks","dataToSend":"autoMapInputData"},"id":"acb62de4-2f1f-4a61-881c-c9de1e9d5380","name":"üíæ Supabase Task Insert","type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-960,1760],"credentials":{"supabaseApi":{"id":"U18uJwD80Uq036TV","name":"Supabase tiziano.annicchiarico@gmail.com"}}},{"parameters":{"operation":"upsert"},"id":"689d4041-c51e-412f-95a0-f78a8ba18077","name":"üìä Metrics Upsert","type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-3060,1240],"credentials":{"supabaseApi":{"id":"U18uJwD80Uq036TV","name":"Supabase tiziano.annicchiarico@gmail.com"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"is-urgent","leftValue":"={{ $json.urgent_notification }}","rightValue":true,"operator":{"type":"boolean","operation":"equals"}}],"combinator":"and"},"options":{}},"id":"65232b95-bbe1-4c72-8647-91bd13d4cb9d","name":"‚ö° Urgency Check","type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-768,1760]},{"parameters":{"chatId":"-1002673812914","text":"=üö® **TASK CRITICO GENERATO**\n\nüìã **Task**: {{ $json.title }}\n‚è∞ **Scadenza**: {{ $json.deadline }}\nüë§ **Cliente**: `{{ $json.customer_email }}`\nüì¶ **Ordine**: `{{ $json.order_id || ''N/A'' }}`\n\nüìù **Descrizione**:\n{{ $json.description }}\n\n‚úÖ **Azioni necessarie**:\n{{ $json.conversation_context.task_generation.execution_steps.join(''\\n- '') }}\n\nüéØ **Criteri successo**:\n{{ $json.conversation_context.task_generation.success_criteria }}\n\n‚ö†Ô∏è **Escalation**: {{ $json.conversation_context.task_generation.escalation_trigger }}","additionalFields":{"parse_mode":"Markdown"}},"id":"064e5c45-859f-453e-b7b9-b60ac9d82a68","name":"üì± Telegram Critical Alert","type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[-520,1680],"webhookId":"bb858f02-80fa-4afa-9527-22c99c3c7b5f","credentials":{"telegramApi":{"id":"dbGXwcFAw4mNHLio","name":"GommeGoBot"}}},{"parameters":{"resource":"event","operation":"create","calendarId":{"__rl":true,"mode":"list","value":""},"subject":"={{ $json.title }}","additionalFields":{"importance":"high"}},"type":"n8n-nodes-base.microsoftOutlook","typeVersion":2,"position":[-3060,460],"id":"b7edc5f1-958d-4f77-bd4f-fb9f3c9738d6","name":"üìÖ Calendar Event","webhookId":"2da34c95-0d1c-41d0-9af7-0186b09484ec","credentials":{"microsoftOutlookOAuth2Api":{"id":"EySZIVRGzocRrEOf","name":"Outlook Info GommeGo"}}},{"parameters":{"jsCode":"// üìä FINAL LOGGING & SUMMARY PRO v2.0\n// Recupera dati dal Task Enricher e prepara summary per Supabase\n\nconsole.log(''üìä === FINAL LOGGING & SUMMARY STARTED ==='');\n\ntry {\n  // üîç RECUPERO SICURO DEI DATI DAL TASK ENRICHER\n  const taskData = $json; // Dati diretti dal Task Enricher\n  \n  if (!taskData || !taskData.id) {\n    throw new Error(''Dati task non validi ricevuti dal Task Enricher'');\n  }\n  \n  console.log(''‚úÖ Task data received:'', {\n    id: taskData.id,\n    customer: taskData.customer_email,\n    order: taskData.order_id,\n    priority: taskData.priority,\n    action: taskData.action_type\n  });\n  \n  // üéØ COSTRUISCI SUMMARY PER LOGGING\n  const summary = {\n    // Task info\n    task_created: true,\n    task_id: taskData.id,\n    \n    // Customer info  \n    customer_email: taskData.customer_email || ''unknown@email.com'',\n    customer_name: taskData.customer_name || null,\n    order_id: taskData.order_id || null,\n    \n    // Task properties\n    priority: taskData.priority || ''medium'',\n    action_type: taskData.action_type || ''follow_up'',\n    status: taskData.status || ''pending'',\n    urgent_notification: taskData.urgent_notification || false,\n    \n    // Analysis data\n    confidence: taskData.conversation_context?.analysis?.confidence || 50,\n    customer_satisfaction: taskData.conversation_context?.analysis?.customer_satisfaction || ''neutral'',\n    gap_identified: taskData.conversation_context?.analysis?.gap_identified || false,\n    \n    // Timing\n    created_at: taskData.created_at,\n    deadline: taskData.deadline,\n    processing_time_ms: taskData.conversation_context?.processing?.processing_duration_ms || 0,\n    \n    // Metadata\n    workflow_version: taskData.conversation_context?.processing?.workflow_version || ''unknown'',\n    execution_id: taskData.conversation_context?.processing?.execution_id || ''unknown'',\n    \n    // Quality metrics\n    errors_count: taskData.conversation_context?.processing?.errors?.length || 0,\n    warnings_count: taskData.conversation_context?.processing?.warnings?.length || 0,\n    validation_required: taskData.conversation_context?.task_generation?.validation_required || false\n  };\n  \n  // üìä DETAILED LOGGING\n  console.log(''üìã TASK CREATION SUMMARY'');\n  console.log(''='' .repeat(50));\n  console.log(''üÜî Task ID:'', summary.task_id);\n  console.log(''üë§ Customer:'', summary.customer_email);\n  console.log(''üì¶ Order ID:'', summary.order_id || ''N/A'');\n  console.log(''‚ö° Priority:'', summary.priority);\n  console.log(''üéØ Action Type:'', summary.action_type);\n  console.log(''üîî Urgent:'', summary.urgent_notification);\n  console.log(''üìä Confidence:'', summary.confidence + ''%'');\n  console.log(''üòä Satisfaction:'', summary.customer_satisfaction);\n  console.log(''‚è∞ Deadline:'', summary.deadline);\n  console.log(''‚ö° Processing Time:'', summary.processing_time_ms + ''ms'');\n  console.log(''‚ùå Errors:'', summary.errors_count);\n  console.log(''‚ö†Ô∏è Warnings:'', summary.warnings_count);\n  console.log(''üîó Execution:'', summary.execution_id);\n  console.log(''='' .repeat(50));\n  \n  // üöÄ PASSA IL TASK COMPLETO AL PROSSIMO NODO\n  // Il summary √® per logging, il task completo va a Supabase\n  return [{ \n    json: {\n      // Task completo per Supabase\n      ...taskData,\n      // Summary aggiuntivo per metriche\n      _summary: summary\n    }\n  }];\n  \n} catch (error) {\n  console.error(''‚ùå FINAL LOGGING ERROR:'', error.message);\n  \n  // ‚ö†Ô∏è FALLBACK LOGGING\n  const fallbackSummary = {\n    task_created: false,\n    error: error.message,\n    timestamp: new Date().toISOString(),\n    execution_id: $execution?.id || ''unknown'',\n    workflow_version: ''final_logging_v2.0_error''\n  };\n  \n  console.log(''‚ö†Ô∏è Using fallback summary due to error'');\n  \n  return [{ \n    json: {\n      ...fallbackSummary,\n      _summary: fallbackSummary\n    }\n  }];\n}"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-3060,720],"id":"4ef615bd-4a59-4ddd-8813-14b18dbe0b9a","name":"üìä Final Logging & Summary"},{"parameters":{"jsCode":"// üìã NO TASK NEEDED - LOGGING v2.0\n// Logga quando non viene creato nessun task\n\ntry {\n  // Recupera dati dai nodi precedenti con nomi corretti\n  const analysis = $(''üîß JSON Extractor & Validator'').item.json;\n  const customerData = $(''üìã Data Mapper'').item.json;\n\n  console.log(''‚ÑπÔ∏è NO TASK CREATION NEEDED'');\n  console.log(''='' .repeat(40));\n  console.log(''üë§ Customer:'', customerData.customer_email);\n  console.log(''üì¶ Order:'', customerData.order_id || ''N/A'');\n  console.log(''üîç Gap Identified:'', analysis.gap_identified);\n  console.log(''üìä Confidence:'', analysis.confidence + ''%'');\n  console.log(''üìù Reason:'', analysis.confidence_reasoning);\n  console.log(''üìã Action Type:'', analysis.action_type);\n  console.log(''üé≠ Sentiment:'', analysis.customer_sentiment);\n  console.log(''='' .repeat(40));\n\n  const summary = {\n    task_created: false,\n    customer_email: customerData.customer_email || ''unknown@email.com'',\n    customer_name: customerData.customer_name || null,\n    order_id: customerData.order_id || null,\n    gap_identified: analysis.gap_identified || false,\n    confidence: analysis.confidence || 0,\n    confidence_reasoning: analysis.confidence_reasoning || ''N/A'',\n    action_type: analysis.action_type || ''unknown'',\n    urgency_level: analysis.urgency_level || ''low'',\n    customer_satisfaction: analysis.customer_satisfaction || ''neutral'',\n    customer_sentiment: analysis.customer_sentiment || ''N/A'',\n    follow_up_needed: analysis.follow_up_needed || false,\n    processing_timestamp: new Date().toISOString(),\n    workflow_version: ''v4.0_optimized'',\n    execution_id: $execution?.id || ''unknown''\n  };\n\n  console.log(''üìä Summary created successfully'');\n  return [{ json: summary }];\n\n} catch (error) {\n  console.error(''‚ùå NO TASK LOGGING ERROR:'', error.message);\n  \n  // Fallback logging\n  const fallbackSummary = {\n    task_created: false,\n    error: error.message,\n    processing_timestamp: new Date().toISOString(),\n    workflow_version: ''v4.0_error_fallback''\n  };\n  \n  return [{ json: fallbackSummary }];\n}"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-520,2160],"id":"fbe88843-e565-47c7-8dcc-e4e7ecc08436","name":"üìã No Task Logging"},{"parameters":{"numberInputs":3},"type":"n8n-nodes-base.merge","typeVersion":3.1,"position":[-2640,600],"id":"ee06d6b4-04af-49d3-a18d-e008bb804f06","name":"Merge"},{"parameters":{"jsCode":"// üìà DAILY METRICS LOGGER v2.0 - UPSERT Logic\n// Prepara dati per upsert su task_metrics\n\nconsole.log(''üìà === DAILY METRICS LOGGER v2.0 STARTED ==='');\nconst startTime = Date.now();\n\ntry {\n  // ===============================================\n  // üì• RECUPERO DATI DA NODI PRECEDENTI DEL WORKFLOW PRINCIPALE\n  // ===============================================\n  \n  // Assumo che questo mini-workflow riceva i dati tramite $json\n  const inputData = $json;\n  \n  // Estrai dati chiave (adatta questi campi ai tuoi dati reali)\n  const isSuccess = inputData.success !== false && !inputData.error;\n  const hasAIResponse = !!inputData.ai_response_generated;\n  const orderID = inputData.order_id;\n  const classification = inputData.final_classification || ''Unknown'';\n  const processingTime = inputData.total_processing_time_ms || 0;\n  const customerEmail = inputData.customer_email;\n  \n  // Task data (se presente)\n  const taskCreated = inputData.has_task_created || false;\n  const taskPriority = inputData.task_priority || null;\n  const gapDetected = inputData.gap_detected || false;\n  \n  console.log(''üìä Input data processed:'');\n  console.log(''- Success:'', isSuccess);\n  console.log(''- AI Response:'', hasAIResponse);\n  console.log(''- Order ID:'', orderID);\n  console.log(''- Task Created:'', taskCreated);\n  \n  // ===============================================\n  // üèóÔ∏è COSTRUZIONE DATI PER UPSERT\n  // ===============================================\n  \n  const today = new Date().toISOString().split(''T'')[0]; // YYYY-MM-DD\n  const currentHour = new Date().getHours();\n  \n  const metricsData = {\n    date: today,\n    \n    // Contatori da incrementare\n    total_emails_processed: 1,\n    emails_successful: isSuccess ? 1 : 0,\n    emails_failed: isSuccess ? 0 : 1,\n    ai_responses_generated: hasAIResponse ? 1 : 0,\n    ai_response_errors: hasAIResponse ? 0 : 1,\n    orders_processed: orderID ? 1 : 0,\n    unique_customers: customerEmail ? 1 : 0,\n    tasks_created_total: taskCreated ? 1 : 0,\n    tasks_created_critical: (taskCreated && taskPriority === ''critical'') ? 1 : 0,\n    tasks_created_high: (taskCreated && taskPriority === ''high'') ? 1 : 0,\n    tasks_created_medium: (taskCreated && taskPriority === ''medium'') ? 1 : 0,\n    tasks_created_low: (taskCreated && taskPriority === ''low'') ? 1 : 0,\n    gaps_detected: gapDetected ? 1 : 0,\n    conversations_analyzed: 1,\n    peak_hour_volume: currentHour >= 9 && currentHour <= 18 ? 1 : 0,\n    \n    // Metadata\n    last_updated: new Date().toISOString(),\n    avg_processing_time_ms: processingTime,\n    daily_classifications: JSON.stringify({ [classification]: 1 }),\n    notes: `Auto-generated metrics`\n  };\n  \n  console.log(''üì¶ Metrics data prepared for date:'', today);\n  \n  // ===============================================\n  // üìä OUTPUT PER STEP SUCCESSIVI\n  // ===============================================\n  \n  return [{\n    json: {\n      ...metricsData,\n      _metadata: {\n        processing_time_ms: Date.now() - startTime,\n        workflow_version: ''daily_metrics_v2.0'',\n        execution_id: $execution.id,\n        input_data_keys: Object.keys(inputData)\n      }\n    }\n  }];\n  \n} catch (error) {\n  console.error(''üí• METRICS LOGGER ERROR:'', error.message);\n  \n  // Fallback minimo\n  const today = new Date().toISOString().split(''T'')[0];\n  return [{\n    json: {\n      date: today,\n      total_emails_processed: 1,\n      emails_failed: 1,\n      error_details: error.message,\n      last_updated: new Date().toISOString(),\n      notes: ''Error fallback - needs review''\n    }\n  }];\n}"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-180,1960],"id":"4bb14579-eb43-4aef-9920-6a2c89bb52df","name":"üìà Metrics Data Prep"},{"parameters":{"operation":"get","tableId":"task_metrics","filters":{"conditions":[{"keyName":"date","keyValue":"={{ $json.date }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[40,1960],"id":"76695a71-8270-4a41-ad31-9f0f149c4f60","name":"üîç Check Today Record","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"U18uJwD80Uq036TV","name":"Supabase tiziano.annicchiarico@gmail.com"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"record-exists","leftValue":"={{ Number($items().length) }}","rightValue":0,"operator":{"type":"number","operation":"gt"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[480,1960],"id":"83f2b665-6188-4599-a2cc-357b248291bb","name":"üìÖ Record Exists?"},{"parameters":{"jsCode":"// üîÑ UPDATE EXISTING RECORD\n// Incrementa contatori esistenti\n\nconsole.log(''üîÑ UPDATING EXISTING RECORD'');\n\ntry {\n  // Dati del record esistente\n  const checkResult = $(''üîç Check Today Record'').item.json;\n  const existingRecord = Array.isArray(checkResult) ? checkResult[0] : checkResult;\n  \n  // Nuovi dati da aggiungere  \n  const newData = $(''üìà Metrics Data Prep'').item.json;\n  \n  console.log(''üìä Existing record found for:'', existingRecord.date);\n  \n  // Incrementa tutti i contatori\n  const updatedRecord = {\n    date: existingRecord.date,\n    \n    // Incrementa contatori\n    total_emails_processed: (existingRecord.total_emails_processed || 0) + (newData.total_emails_processed || 0),\n    emails_successful: (existingRecord.emails_successful || 0) + (newData.emails_successful || 0),\n    emails_failed: (existingRecord.emails_failed || 0) + (newData.emails_failed || 0),\n    ai_responses_generated: (existingRecord.ai_responses_generated || 0) + (newData.ai_responses_generated || 0),\n    ai_response_errors: (existingRecord.ai_response_errors || 0) + (newData.ai_response_errors || 0),\n    orders_processed: (existingRecord.orders_processed || 0) + (newData.orders_processed || 0),\n    unique_customers: (existingRecord.unique_customers || 0) + (newData.unique_customers || 0),\n    tasks_created_total: (existingRecord.tasks_created_total || 0) + (newData.tasks_created_total || 0),\n    tasks_created_critical: (existingRecord.tasks_created_critical || 0) + (newData.tasks_created_critical || 0),\n    tasks_created_high: (existingRecord.tasks_created_high || 0) + (newData.tasks_created_high || 0),\n    tasks_created_medium: (existingRecord.tasks_created_medium || 0) + (newData.tasks_created_medium || 0),\n    tasks_created_low: (existingRecord.tasks_created_low || 0) + (newData.tasks_created_low || 0),\n    gaps_detected: (existingRecord.gaps_detected || 0) + (newData.gaps_detected || 0),\n    conversations_analyzed: (existingRecord.conversations_analyzed || 0) + (newData.conversations_analyzed || 0),\n    peak_hour_volume: (existingRecord.peak_hour_volume || 0) + (newData.peak_hour_volume || 0),\n    \n    // Calcola media per processing time\n    avg_processing_time_ms: Math.round(\n      ((existingRecord.avg_processing_time_ms || 0) * (existingRecord.conversations_analyzed || 1) + \n       (newData.avg_processing_time_ms || 0)) / \n      ((existingRecord.conversations_analyzed || 1) + 1)\n    ),\n    \n    // Merge classifications JSON\n    daily_classifications: mergeClassifications(\n      existingRecord.daily_classifications, \n      newData.daily_classifications\n    ),\n    \n    // Update metadata\n    last_updated: new Date().toISOString(),\n    notes: `Updated: ${new Date().toLocaleString(''it-IT'')}`\n  };\n  \n  console.log(''‚úÖ Record updated successfully'');\n  console.log(''üìä New totals:'', {\n    emails: updatedRecord.total_emails_processed,\n    tasks: updatedRecord.tasks_created_total,\n    conversations: updatedRecord.conversations_analyzed\n  });\n  \n  return [{ json: updatedRecord }];\n  \n} catch (error) {\n  console.error(''üí• UPDATE ERROR:'', error.message);\n  return [{ json: { error: error.message } }];\n}\n\n// Helper function per merge classifications\nfunction mergeClassifications(existing, newData) {\n  try {\n    const existingObj = existing ? JSON.parse(existing) : {};\n    const newObj = newData ? JSON.parse(newData) : {};\n    \n    // Merge objects\n    const merged = { ...existingObj };\n    for (const [key, value] of Object.entries(newObj)) {\n      merged[key] = (merged[key] || 0) + value;\n    }\n    \n    return JSON.stringify(merged);\n  } catch {\n    return newData || existing || ''{}'';\n  }\n}"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[740,1840],"id":"b6320f81-9337-4f36-b938-dedecfded6c7","name":"üîÑ Update Existing"},{"parameters":{"operation":"update","tableId":"task_metrics","filters":{"conditions":[{"keyName":"date","condition":"=eq","keyValue":"={{ $json.date }}"}]},"dataToSend":"autoMapInputData"},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[980,1840],"id":"7b7bd979-0d5e-442f-9aec-3f96e9117402","name":"üíæ Supabase Update","credentials":{"supabaseApi":{"id":"U18uJwD80Uq036TV","name":"Supabase tiziano.annicchiarico@gmail.com"}}},{"parameters":{"tableId":"task_metrics"},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[860,2080],"id":"b665c9f5-af72-44d0-8674-fb21081e59c4","name":"üìù Supabase Insert","credentials":{"supabaseApi":{"id":"U18uJwD80Uq036TV","name":"Supabase tiziano.annicchiarico@gmail.com"}}},{"parameters":{"jsCode":"// ‚úÖ FINAL SUCCESS LOG\n// Logga il completamento dell''operazione\n\nconsole.log(''‚úÖ === DAILY METRICS UPSERT COMPLETED ==='');\n\nconst inputData = $json;\nconst operation = inputData.id ? ''UPDATE'' : ''INSERT'';\nconst date = inputData.date || ''unknown'';\n\nconsole.log(''üìä UPSERT SUMMARY:'');\nconsole.log(''üîÑ Operation:'', operation);\nconsole.log(''üìÖ Date:'', date);\nconsole.log(''üìß Total Emails:'', inputData.total_emails_processed || 0);\nconsole.log(''ü§ñ AI Responses:'', inputData.ai_responses_generated || 0);\nconsole.log(''üìã Tasks Created:'', inputData.tasks_created_total || 0);\nconsole.log(''üí¨ Conversations:'', inputData.conversations_analyzed || 0);\nconsole.log(''‚è∞ Avg Time:'', inputData.avg_processing_time_ms || 0, ''ms'');\n\nreturn [{\n  json: {\n    ...inputData,\n    _summary: {\n      operation: operation,\n      success: true,\n      date: date,\n      totals: {\n        emails: inputData.total_emails_processed || 0,\n        ai_responses: inputData.ai_responses_generated || 0,\n        tasks: inputData.tasks_created_total || 0,\n        conversations: inputData.conversations_analyzed || 0\n      },\n      timestamp: new Date().toISOString()\n    }\n  }\n}];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1200,1960],"id":"9fe02fb5-cfab-49cd-9c2c-a4417e9dd950","name":"‚úÖ Success Log"},{"parameters":{"jsCode":"// ‚úÖ Normalize output da Supabase\nlet records = [];\n\nif (Array.isArray($json)) {\n  records = $json;\n} else if (Array.isArray($json.data)) {\n  records = $json.data;\n} else if ($json.data) {\n  records = [$json.data];\n} else {\n  records = [$json];\n}\n\nreturn records.map(item => ({ json: item }));\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[260,1960],"id":"a005f8f6-5f75-450c-8d92-f765bfbc5d50","name":"Code"},{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[-3060,980],"id":"5dd9a12e-96e9-465e-8c72-1b3784f243d0","name":"When clicking ‚ÄòTest workflow‚Äô"},{"parameters":{"assignments":{"assignments":[{"id":"b60e8836-1f5e-4e7b-b067-dd2b1b2d5ec5","name":"customer_email","value":"={{ $(''üìã Data Mapper'').item.json.customer_email }}","type":"string"},{"id":"61f553af-b9e2-475a-8c00-8d667833c662","name":"customer_name","value":"={{ $(''üìã Data Mapper'').item.json.customer_name }}","type":"string"},{"id":"f8c5e795-5f52-45e6-8439-cc03a3b64d76","name":"order_id","value":"={{ $(''üìã Data Mapper'').item.json.order_id }}","type":"string"},{"id":"3dce46c8-0f3b-4e2c-b47b-b15cf3c5200a","name":"customer_message","value":"={{ $(''üìã Data Mapper'').item.json.customer_message }}","type":"string"},{"id":"ffe3e936-117e-4d4b-aedf-62d59fe94db9","name":"thread_history","value":"={{ $(''üìã Data Mapper'').item.json.thread_history }}","type":"string"},{"id":"b5424c80-2aed-4484-9ce7-7f0be45b4836","name":"ai_response","value":"={{ $(''üìã Data Mapper'').item.json.ai_response }}","type":"string"},{"id":"8b456d10-da1f-4b1c-8298-81a69c4ba10d","name":"interaction_type","value":"={{ $(''üìã Data Mapper'').item.json.interaction_type }}","type":"string"},{"id":"1c09fe00-8a79-476e-98ae-f3dc78424f3e","name":"initial_confidence","value":"={{ $(''üìã Data Mapper'').item.json.initial_confidence }}","type":"string"},{"id":"620c0ccd-7207-4070-8814-06b72c5a26ee","name":"is_thread_reply","value":"={{ $(''üìã Data Mapper'').item.json.is_thread_reply }}","type":"boolean"},{"id":"6fd788ee-ce0e-4c03-8538-ca6279f2f227","name":"processing_timestamp","value":"={{ $(''üìã Data Mapper'').item.json.processing_timestamp }}","type":"string"},{"id":"87c95920-0a1b-4d5a-b41f-a43d2e047dff","name":"text","value":"={{ $(''üîç Conversation Analyzer'').item.json.text }}","type":"string"},{"id":"1c8addf4-b507-443c-a75f-4002418b0b2c","name":"text","value":"={{ $json.text }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-1420,1760],"id":"1c8c1ecf-d0f3-4084-88d7-cce878930b5d","name":"DATA NODE COLLECTOR"}]', '{"üîÑ Workflow Trigger":{"main":[[{"node":"üìã Data Mapper","type":"main","index":0}]]},"üìã Data Mapper":{"main":[[{"node":"üîç Conversation Analyzer","type":"main","index":0}]]},"üß† Conversation Analyzer LLM":{"ai_languageModel":[[{"node":"üîç Conversation Analyzer","type":"ai_languageModel","index":0}]]},"üîç Conversation Analyzer":{"main":[[{"node":"üîß JSON Extractor & Validator","type":"main","index":0}]]},"üîß JSON Extractor & Validator":{"main":[[{"node":"‚ùì Should Create Task?","type":"main","index":0}]]},"‚ùì Should Create Task?":{"main":[[{"node":"‚öôÔ∏è Enhanced Task Generator","type":"main","index":0}],[{"node":"üìã No Task Logging","type":"main","index":0}]]},"‚öôÔ∏è Enhanced Task Generator LLM":{"ai_languageModel":[[{"node":"‚öôÔ∏è Enhanced Task Generator","type":"ai_languageModel","index":0}]]},"‚öôÔ∏è Enhanced Task Generator":{"main":[[{"node":"DATA NODE COLLECTOR","type":"main","index":0}]]},"üèóÔ∏è Task Enricher":{"main":[[{"node":"üíæ Supabase Task Insert","type":"main","index":0}]]},"üìä Final Logging & Summary":{"main":[[]]},"üíæ Supabase Task Insert":{"main":[[{"node":"‚ö° Urgency Check","type":"main","index":0}]]},"‚ö° Urgency Check":{"main":[[{"node":"üì± Telegram Critical Alert","type":"main","index":0}]]},"Merge":{"main":[[]]},"üìà Metrics Data Prep":{"main":[[{"node":"üîç Check Today Record","type":"main","index":0}]]},"üîç Check Today Record":{"main":[[{"node":"Code","type":"main","index":0}]]},"üìÖ Record Exists?":{"main":[[{"node":"üîÑ Update Existing","type":"main","index":0}],[{"node":"üìù Supabase Insert","type":"main","index":0}]]},"üîÑ Update Existing":{"main":[[{"node":"üíæ Supabase Update","type":"main","index":0}]]},"üíæ Supabase Update":{"main":[[{"node":"‚úÖ Success Log","type":"main","index":0}]]},"üìù Supabase Insert":{"main":[[{"node":"‚úÖ Success Log","type":"main","index":0}]]},"üìã No Task Logging":{"main":[[{"node":"üìà Metrics Data Prep","type":"main","index":0}]]},"üì± Telegram Critical Alert":{"main":[[{"node":"üìà Metrics Data Prep","type":"main","index":0}]]},"Code":{"main":[[{"node":"üìÖ Record Exists?","type":"main","index":0}]]},"When clicking ‚ÄòTest workflow‚Äô":{"main":[[]]},"DATA NODE COLLECTOR":{"main":[[{"node":"üèóÔ∏è Task Enricher","type":"main","index":0}]]}}', '{"executionOrder":"v1"}', NULL, '{}', 'a6bd2374-78b8-47ff-90c4-4585561b9c75', 0, NULL, NULL, '2025-06-01T18:23:56.097Z', '2025-06-16T18:47:07.000Z', false),
  ('13f468d3-13a0-4383-b432-8986556e7be4', 'SUB_SMART TASK ANALYZER', false, '[{"parameters":{"model":{"__rl":true,"value":"gpt-4.1-2025-04-14","mode":"list","cachedResultName":"gpt-4.1-2025-04-14"},"options":{"temperature":0.1}},"id":"f3c7fcf6-b5ca-4cb1-8c76-11083f01512e","name":"üß† Conversation Analyzer LLM","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-1920,-48],"credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"jsCode":"// üîÑ JSON EXTRACTOR E VALIDATOR v3.0 - SMART TEXT/JSON HANDLER\n// Gestisce sia JSON che testo semplice dal Conversation Analyzer\n\nconst inputText = $json.text || '''';\nconsole.log(''üì• Raw input length:'', inputText.length);\nconsole.log(''üì• Input preview:'', inputText.substring(0, 200) + ''...'');\n\nlet analysis = {};\nlet parseSuccess = false;\nlet inputType = ''unknown'';\n\n// 1Ô∏è‚É£ DETERMINA TIPO DI INPUT\nif (inputText.trim().startsWith(''{'') && inputText.trim().endsWith(''}'')) {\n  inputType = ''json'';\n} else if (inputText.includes(''VALUTAZIONE GAP'') || inputText.includes(''CRITICAL'') || inputText.includes(''HIGH'')) {\n  inputType = ''documentation'';\n} else {\n  inputType = ''text'';\n}\n\nconsole.log(''üîç Input type detected:'', inputType);\n\n// 2Ô∏è‚É£ GESTIONE BASATA SUL TIPO\nif (inputType === ''json'') {\n  // PARSING JSON STANDARD\n  try {\n    let cleanText = inputText.replace(/```json\\n?|\\n?```/g, '''').trim();\n    analysis = JSON.parse(cleanText);\n    parseSuccess = true;\n    console.log(''‚úÖ JSON parsed successfully'');\n  } catch (error) {\n    console.error(''‚ùå JSON parse error:'', error.message);\n    parseSuccess = false;\n  }\n} else {\n  // ANALISI DIRETTA PER TESTO/DOCUMENTAZIONE\n  console.log(''üìù Analyzing text content directly...'');\n  \n  // Recupera i dati originali dal Data Mapper per l''analisi\n  const customerData = $(''Data Mapper'').item.json;\n  const customerMessage = customerData.customer_message || '''';\n  const aiResponse = customerData.ai_response || '''';\n  const orderID = customerData.order_id;\n  \n  console.log(''üìã Customer message:'', customerMessage.substring(0, 100));\n  console.log(''ü§ñ AI response preview:'', aiResponse.substring(0, 100));\n  console.log(''üì¶ Order ID:'', orderID);\n  \n  // LOGICA DI ANALISI DIRETTA\n  analysis = analyzeDirectly(customerMessage, aiResponse, orderID);\n  parseSuccess = true;\n}\n\n// 3Ô∏è‚É£ VALIDAZIONE E FALLBACK\nif (!parseSuccess || typeof analysis.gap_identified === ''undefined'') {\n  console.warn(''‚ö†Ô∏è Using fallback values'');\n  analysis = {\n    gap_identified: false,\n    confidence: 30,\n    confidence_reasoning: ''Errore parsing - analisi fallback'',\n    customer_satisfaction: ''neutral'',\n    ai_promises: [],\n    required_actions: [],\n    urgency_level: ''low'',\n    follow_up_needed: false,\n    deadline_hours: 24,\n    action_type: ''follow_up'',\n    customer_sentiment: ''neutrale'',\n    notes: ''ATTENZIONE: Analisi fallback utilizzata''\n  };\n}\n\n// 4Ô∏è‚É£ SANITIZZAZIONE\nanalysis.confidence = Math.max(0, Math.min(100, parseInt(analysis.confidence) || 0));\nanalysis.deadline_hours = Math.max(1, parseInt(analysis.deadline_hours) || 24);\nanalysis.gap_identified = Boolean(analysis.gap_identified);\nanalysis.follow_up_needed = Boolean(analysis.follow_up_needed);\nanalysis.ai_promises = Array.isArray(analysis.ai_promises) ? analysis.ai_promises : [];\nanalysis.required_actions = Array.isArray(analysis.required_actions) ? analysis.required_actions : [];\n\n// 5Ô∏è‚É£ VALIDAZIONE ENUM\nconst validSatisfaction = [''satisfied'', ''neutral'', ''frustrated'', ''angry''];\nconst validUrgency = [''critical'', ''high'', ''medium'', ''low''];\nconst validActions = [''tracking'', ''delivery'', ''refund'', ''follow_up'', ''verification'', ''escalation''];\n\nif (!validSatisfaction.includes(analysis.customer_satisfaction)) {\n  analysis.customer_satisfaction = ''neutral'';\n}\nif (!validUrgency.includes(analysis.urgency_level)) {\n  analysis.urgency_level = ''low'';\n}\nif (!validActions.includes(analysis.action_type)) {\n  analysis.action_type = ''follow_up'';\n}\n\n// 6Ô∏è‚É£ LOGGING\nconsole.log(''üìä Final Analysis Results:'');\nconsole.log(''- Input Type:'', inputType);\nconsole.log(''- Parse Success:'', parseSuccess);\nconsole.log(''- Gap Identified:'', analysis.gap_identified);\nconsole.log(''- Confidence:'', analysis.confidence + ''%'');\nconsole.log(''- Urgency:'', analysis.urgency_level);\nconsole.log(''- Action Type:'', analysis.action_type);\n\n// 7Ô∏è‚É£ OUTPUT\nreturn [{\n  json: {\n    ...analysis,\n    _metadata: {\n      input_type: inputType,\n      parsing_success: parseSuccess,\n      validation_timestamp: new Date().toISOString(),\n      input_length: inputText.length\n    }\n  }\n}];\n\n// üîß FUNZIONE DI ANALISI DIRETTA\nfunction analyzeDirectly(customerMessage, aiResponse, orderID) {\n  console.log(''üîç Starting direct analysis...'');\n  \n  const message = customerMessage.toLowerCase();\n  const response = aiResponse.toLowerCase();\n  \n  // RILEVAMENTO PROMESSE AI CRITICHE\n  const criticalPromises = [\n    ''rimborso'', ''rimborseremo'', ''restituiremo'',\n    ''sostituiremo'', ''sostituizione'', ''cambieremo'',\n    ''contatteremo'', ''vi contatteremo'', ''vi chiameremo''\n  ];\n  \n  const hasCriticalPromises = criticalPromises.some(promise => response.includes(promise));\n  \n  // RILEVAMENTO SPIEGAZIONI COMPLETE\n  const hasCompleteInfo = response.includes(''tracking'') || \n                         response.includes(''in transito'') || \n                         response.includes(''spedizione'') ||\n                         response.includes(''corriere'') ||\n                         response.includes(''consegna'');\n  \n  // RILEVAMENTO PROBLEMI CLIENTE\n  const hasShippingIssue = message.includes(''manca'') || \n                          message.includes(''non ho ricevuto'') ||\n                          message.includes(''ritardo'') ||\n                          message.includes(''problema'');\n  \n  // LOGICA DECISIONALE\n  let urgency_level = ''low'';\n  let gap_identified = false;\n  let confidence = 70;\n  \n  if (hasCriticalPromises) {\n    urgency_level = ''high'';\n    gap_identified = true;\n    confidence = 85;\n  } else if (hasShippingIssue && !hasCompleteInfo) {\n    urgency_level = ''medium'';\n    gap_identified = true;\n    confidence = 75;\n  } else if (hasShippingIssue && hasCompleteInfo) {\n    // CASO SPECIFICO: Cliente segnala problema MA AI ha spiegato tutto\n    urgency_level = ''low'';\n    gap_identified = false;\n    confidence = 80;\n  }\n  \n  return {\n    gap_identified: gap_identified,\n    confidence: confidence,\n    confidence_reasoning: `Analisi diretta basata su promesse AI: ${hasCriticalPromises}, info complete: ${hasCompleteInfo}`,\n    customer_satisfaction: hasShippingIssue ? ''frustrated'' : ''neutral'',\n    ai_promises: hasCriticalPromises ? [''Contatto/verifica promesso''] : [],\n    required_actions: gap_identified ? [''tracking'', ''follow_up''] : [],\n    urgency_level: urgency_level,\n    follow_up_needed: gap_identified,\n    deadline_hours: urgency_level === ''high'' ? 8 : urgency_level === ''medium'' ? 24 : 48,\n    action_type: hasShippingIssue ? ''tracking'' : ''follow_up'',\n    customer_sentiment: hasShippingIssue ? ''preoccupato per spedizione'' : ''neutrale'',\n    notes: `Analisi diretta - Order: ${orderID}, Issue: ${hasShippingIssue}, Promises: ${hasCriticalPromises}`\n  };\n}"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-1200,-960],"id":"a9643881-90db-4011-a5ad-d65ee7afb2b5","name":"üîß JSON Extractor & Validator"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"gap-detected","leftValue":"={{ $json.output.gap_identified }}","rightValue":"true","operator":{"type":"boolean","operation":"true","singleValue":true}},{"id":"confidence-check","leftValue":"={{ $json.output.confidence }}","rightValue":50,"operator":{"type":"number","operation":"gte"}}],"combinator":"and"},"options":{}},"id":"00bdff0c-8b4a-408c-8bf1-e87970556863","name":"‚ùì Should Create Task?","type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-1040,-560]},{"parameters":{"model":{"__rl":true,"value":"gpt-4.1-2025-04-14","mode":"list","cachedResultName":"gpt-4.1-2025-04-14"},"options":{"temperature":0.1}},"id":"9e67f091-ea15-4650-8655-f944b5ff5e3d","name":"‚öôÔ∏è Enhanced Task Generator LLM","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-1760,-16],"credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"assignments":{"assignments":[{"id":"b60e8836-1f5e-4e7b-b067-dd2b1b2d5ec5","name":"customer_email","value":"={{ $(''Data Mapper'').item.json.customer_email }}","type":"string"},{"id":"61f553af-b9e2-475a-8c00-8d667833c662","name":"customer_name","value":"={{ $(''Data Mapper'').item.json.customer_name }}","type":"string"},{"id":"f8c5e795-5f52-45e6-8439-cc03a3b64d76","name":"order_id","value":"={{ $(''Data Mapper'').item.json.order_id }}","type":"string"},{"id":"3dce46c8-0f3b-4e2c-b47b-b15cf3c5200a","name":"customer_message","value":"={{ $(''Data Mapper'').item.json.customer_message }}","type":"string"},{"id":"ffe3e936-117e-4d4b-aedf-62d59fe94db9","name":"thread_history","value":"={{ $(''Data Mapper'').item.json.thread_history }}","type":"string"},{"id":"b5424c80-2aed-4484-9ce7-7f0be45b4836","name":"ai_response","value":"={{ $(''Data Mapper'').item.json.ai_response }}","type":"string"},{"id":"8b456d10-da1f-4b1c-8298-81a69c4ba10d","name":"interaction_type","value":"={{ $(''Data Mapper'').item.json.interaction_type }}","type":"string"},{"id":"1c09fe00-8a79-476e-98ae-f3dc78424f3e","name":"initial_confidence","value":"={{ $(''Data Mapper'').item.json.initial_confidence }}","type":"string"},{"id":"620c0ccd-7207-4070-8814-06b72c5a26ee","name":"is_thread_reply","value":"={{ $(''Data Mapper'').item.json.is_thread_reply }}","type":"boolean"},{"id":"6fd788ee-ce0e-4c03-8538-ca6279f2f227","name":"processing_timestamp","value":"={{ $(''Data Mapper'').item.json.processing_timestamp }}","type":"string"},{"id":"eb68368c-8554-4724-8b0f-ceb1e17bbd0c","name":"output.title","value":"={{ $json.output.title }}","type":"string"},{"id":"8bf29357-bc86-4ae8-b67e-c34cf50363bd","name":"output.description","value":"={{ $json.output.description }}","type":"string"},{"id":"db257c0f-327a-4950-8c6c-018ac7818bab","name":"output.priority","value":"={{ $json.output.priority }}","type":"string"},{"id":"d5cbd9c3-27a8-4099-9a71-ab717e8554d9","name":"output.action_type","value":"={{ $json.output.action_type }}","type":"string"},{"id":"5f7312f1-43eb-44f8-8f12-06a8294288e4","name":"output.deadline_hours","value":"={{ $json.output.deadline_hours }}","type":"number"},{"id":"c0269abe-2b7a-4631-a6a7-261a4a79aa30","name":"output.customer_context","value":"={{ $json.output.customer_context }}","type":"object"},{"id":"283fce96-9271-4a5e-90c5-df4d92bf4f92","name":"output.ai_commitments","value":"={{ $json.output.ai_commitments }}","type":"array"},{"id":"858afc0c-b46d-4e33-89fa-70ae43d416aa","name":"output.execution_steps","value":"={{ $json.output.execution_steps }}","type":"array"},{"id":"2c80b76a-c0aa-40b7-bead-f46035f1a2ec","name":"output.success_criteria","value":"={{ $json.output.success_criteria }}","type":"string"},{"id":"012cd4b3-704a-4273-8c34-29f8628f91d4","name":"output.escalation_trigger","value":"={{ $json.output.escalation_trigger }}","type":"string"},{"id":"bffc52f7-f897-4789-8bb4-d02a08d71d9b","name":"output.notes","value":"={{ $json.output.notes }}","type":"string"},{"id":"e6b45d22-e9d1-4438-83d6-aea018721dd8","name":"output.confidence_level","value":"={{ $json.output.confidence_level }}","type":"number"},{"id":"24be4978-645e-4cca-8cb3-423560749fae","name":"output.validation_required","value":"={{ $json.output.validation_required }}","type":"boolean"},{"id":"2e504813-728f-4ae6-9495-15c8b469d4b0","name":"output.customer_sentiment","value":"={{ $(''Conversation Analyzer'').item.json.output.customer_sentiment }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-368,-656],"id":"36a11659-1eaa-455c-83fc-867065cc5353","name":"DATA NODE COLLECTOR"},{"parameters":{"jsCode":"// ‚úÖ Normalize Supabase data + preserva `date` per update successivo\n\nlet records = [];\n\nconst fallbackDate = $json.date || new Date().toISOString().split(''T'')[0];\n\nif (Array.isArray($json)) {\n  records = $json;\n} else if (Array.isArray($json.data)) {\n  records = $json.data;\n} else if ($json.data) {\n  records = [$json.data];\n} else {\n  records = [$json];\n}\n\n// Reinserisce `date` anche se sparito\nreturn records.map(item => ({\n  json: {\n    ...item,\n    date: item.date || fallbackDate\n  }\n}));\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1680,-1264],"id":"f9f2b358-3ab9-4153-88dc-95af75bd0b66","name":"Normalize Supabase data","notes":"// ‚úÖ Normalize output da Supabase\nlet records = [];\n\nif (Array.isArray($json)) {\n  records = $json;\n} else if (Array.isArray($json.data)) {\n  records = $json.data;\n} else if ($json.data) {\n  records = [$json.data];\n} else {\n  records = [$json];\n}\n\nreturn records.map(item => ({ json: item }));\n"},{"parameters":{"inputSource":"passthrough"},"type":"n8n-nodes-base.executeWorkflowTrigger","typeVersion":1.1,"position":[-1936,-544],"id":"aaef26c4-f5bb-42b0-9a4a-168efc9f0470","name":"Workflow Trigger"},{"parameters":{"content":"# üîÑ SUB TASK WORKFLOW\n**Cosa fa**: Analizza email cliente-AI e crea task automatici quando rileva gap operativi\n\n**Quando si attiva**: \n- AI promette azioni che richiedono intervento umano\n- Confidence > 70% che serve follow-up\n\n**Output**:\n- ‚úÖ Task in Supabase con deadline\n- üì± Notifica Telegram se urgente\n- üìä Metriche giornaliere aggiornate\n\n---\n\n# üö® NOTIFICHE TELEGRAM\n**Quando**: Solo task Critical o High\n**Dove**: Chat -1002673812914\n**Cosa invia**: Titolo, cliente, ordine, azioni da fare, deadline\n\n---\n\n# üìä REPORT BI-GIORNALIERO\n**Orari**: 8:00 e 21:00\n**Contenuto**:\n- Task creati/completati/in ritardo\n- Gap rilevati e clienti gestiti  \n- Task urgenti aperti\n- Performance % del team\n\n**Destinatari**:\n- Telegram team\n- Email tiziano.annicchiarico@tecsolutions.org\n\n---\n\n# ‚ö° SOGLIE DECISIONALI\n**Crea task se**:\n- gap_identified = true\n- confidence > 70%\n\n**Priorit√† ‚Üí Deadline**:\n- üî¥ Critical: 2-6 ore\n- üü† High: 8-24 ore  \n- üü° Medium: 24-48 ore\n- üü¢ Low: 48-72 ore\n\n---\n\n# üóÑÔ∏è TABELLE DATABASE\n**smart_tasks**: Task generati\n**task_metrics**: Statistiche giornaliere\n**email_processing_log**: Log email\n\n---\n\n# üß™ MODALIT√Ä TEST\n**Report**: Ultimi 5 giorni\n**Produzione**: Solo periodo corrente\n**Switch**: Nel nodo \"Aggregate Report\"","height":960,"width":1040,"color":5},"type":"n8n-nodes-base.stickyNote","position":[-2688,-1520],"typeVersion":1,"id":"3eb65fe7-d6c4-453f-99ad-79f40ff1b83e","name":"Sticky Note"},{"parameters":{"modelName":"models/gemini-1.5-flash","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatGoogleGemini","typeVersion":1,"position":[-1616,-304],"id":"cc2b96eb-0a3e-43b2-95cb-67f57f1f73f9","name":"Google Gemini Chat Model","credentials":{"googlePalmApi":{"id":"owVOESxC0E1TNLDF","name":"Google Gemini(PaLM) GommeGo"}}},{"parameters":{"modelName":"models/gemini-1.5-flash","options":{"maxOutputTokens":2048}},"type":"@n8n/n8n-nodes-langchain.lmChatGoogleGemini","typeVersion":1,"position":[-784,-416],"id":"cbac1756-8cbe-480c-91b1-da8b46a1227d","name":"Google Gemini Chat Model1","credentials":{"googlePalmApi":{"id":"owVOESxC0E1TNLDF","name":"Google Gemini(PaLM) GommeGo"}}},{"parameters":{"jsonSchemaExample":"{\n  \"customer_request_analysis\": \"Il cliente √® molto arrabbiato e minaccia azioni legali a causa della mancanza di informazioni di tracciamento per l''ordine XLGIGWPSQ. Il tono √® aggressivo e indica una forte insoddisfazione.\",\n  \"ai_promises_identified\": [\n    \"Ho verificato il suo ordine\",\n    \"Pu√≤ stare completamente tranquillo\",\n    \"Se non dovesse ricevere ulteriori aggiornamenti entro i prossimi giorni, la invitiamo a contattarci nuovamente cos√¨ potremo intervenire direttamente con il corriere o il fornitore per assicurarci che la consegna venga completata.\"\n  ],\n  \"gap_evaluation\": \"Nonostante l''aggressivit√† del cliente, la risposta dell''assistenza √® rassicurante ma non risolutiva. Il tracking √® mancante, una promessa di intervento successivo √® stata fatta ma non √® stata fissata una scadenza precisa. Questo crea un gap operativo perch√© l''intervento effettivo non √® garantito.\",\n  \"confidence_calculation\": \"75% perch√©, anche se l''ordine √® stato preso in carico, la mancanza di tracking crea incertezza e la minaccia di denuncia aumenta l''urgenza. La promessa di un follow-up √® vaga.\",\n  \"gap_identified\": true,\n  \"confidence\": 75,\n  \"customer_satisfaction\": \"frustrated\",\n  \"ai_promises\": [\n    \"Verificher√≤ lo stato dell''ordine\",\n    \"Intervenire direttamente con il corriere o il fornitore se non ci saranno aggiornamenti nei prossimi giorni\"\n  ],\n  \"required_actions\": [\n    \"Verificare lo stato dell''ordine con il fornitore e il corriere\",\n    \"Inviare un aggiornamento al cliente entro un lasso di tempo definito (es. 24-48 ore)\",\n    \"Monitorare attivamente lo stato dell''ordine\"\n  ],\n  \"urgency_level\": \"high\",\n  \"follow_up_needed\": true,\n  \"deadline_hours\": 48,\n  \"action_type\": \"tracking\",\n  \"customer_sentiment\": \"Fortemente negativo, minaccioso\",\n  \"notes\": \"L''urgenza √® alta a causa della minaccia di denuncia. √à fondamentale fornire un aggiornamento concreto e un tracking entro le 48 ore. La comunicazione dovrebbe essere pi√π empatica e rassicurante, riconoscendo la frustrazione del cliente e scusandosi per l''inconveniente.\"\n}\n"},"type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.3,"position":[-1408,-288],"id":"4fef6db0-f43d-441b-bedc-e944c7a3a31a","name":"Structured Output Parser"},{"parameters":{"promptType":"define","text":"=Analizza questi dati di converazione:\n{{ $json.customer_name }}\n{{ $json.order_id }}\n{{ $json.email_subject }}\n{{ $json.customer_message }}\n{{ $json.thread_history }}\n{{ $json.ai_response }}\n{{ $json.interaction_type }}\n{{ $json.initial_confidence }}\n{{ $json.is_thread_reply }}\n","hasOutputParser":true,"messages":{"messageValues":[{"message":"=## RUOLO\nSei un supervisore esperto nel rilevare quando le promesse dell''AI richiedono azioni operative nel dropshipping pneumatici.\n\n## ISTRUZIONI\nAnalizza la conversazione e identifica se l''AI ha fatto promesse che richiedono follow-up operativo.\n\n### CRITERI DECISIONALI CHIAVE\n1. **TRACKING MANCANTE/ERRATO** ‚Üí GAP (confidence 70-85%)\n2. **TRACKING COMPLETO CON INFO** ‚Üí NO GAP (confidence 20-30%)\n3. **PROMESSE DI VERIFICA/INVIO** ‚Üí GAP OPERATIVO\n\n### METODOLOGIA SEMPLIFICATA\nPer ogni conversazione:\n1. Identifica il problema del cliente\n2. Estrai le promesse dell''AI (frasi con \"verificher√≤\", \"invier√≤\", \"controller√≤\")\n3. Valuta se richiedono azione operativa\n4. Assegna confidence basata sui criteri sopra\n\n## ESEMPI\n\n### Esempio 1: GAP IDENTIFICATO\n**Input**: \n- Cliente: \"Non ho ricevuto il tracking\"\n- AI: \"Verificher√≤ e ti invier√≤ il tracking entro oggi\"\n\n**Output**:\n```json\n{\n  \"customer_request_analysis\": \"Cliente richiede tracking mancante\",\n  \"ai_promises_identified\": [\"Verificher√≤ e ti invier√≤ il tracking entro oggi\"],\n  \"gap_evaluation\": \"AI promette verifica e invio tracking - richiede azione operativa\",\n  \"confidence_calculation\": \"75% - tracking mancante con promessa specifica e timeline\",\n  \"gap_identified\": true,\n  \"confidence\": 75,\n  \"customer_satisfaction\": \"neutrale\",\n  \"ai_promises\": [\"Verificher√≤ e ti invier√≤ il tracking entro oggi\"],\n  \"required_actions\": [\"Verificare tracking sistema\", \"Inviare tracking cliente\"],\n  \"urgency_level\": \"alto\",\n  \"follow_up_needed\": true,\n  \"deadline_hours\": 8,\n  \"action_type\": \"tracking\",\n  \"customer_sentiment\": \"Neutrale, richiede informazioni\",\n  \"notes\": \"Tracking mancante - azione richiesta entro oggi\"\n}\n```\n\n### Esempio 2: NESSUN GAP\n**Input**:\n- Cliente: \"Dov''√® il mio ordine?\"\n- AI: \"Ordine spedito con GLS 12345678, in consegna domani a Roma\"\n\n**Output**:\n```json\n{\n  \"customer_request_analysis\": \"Cliente chiede status ordine\",\n  \"ai_promises_identified\": [],\n  \"gap_evaluation\": \"AI fornisce tracking completo e status - nessuna azione richiesta\",\n  \"confidence_calculation\": \"25% - informazioni complete fornite immediatamente\",\n  \"gap_identified\": false,\n  \"confidence\": 25,\n  \"customer_satisfaction\": \"soddisfatto\",\n  \"ai_promises\": [],\n  \"required_actions\": [],\n  \"urgency_level\": \"basso\",\n  \"follow_up_needed\": false,\n  \"deadline_hours\": 0,\n  \"action_type\": \"nessuna\",\n  \"customer_sentiment\": \"Soddisfatto per info ricevute\",\n  \"notes\": \"Risolto con tracking completo\"\n}\n```\n\n### Esempio 3: GAP URGENTE\n**Input**:\n- Cliente: \"√à una settimana che aspetto, se non mi date il tracking faccio denuncia!\"\n- AI: \"Mi scuso, verifico subito con il fornitore e la contatto entro 24 ore\"\n\n**Output**:\n```json\n{\n  \"customer_request_analysis\": \"Cliente molto arrabbiato minaccia azioni legali per ritardo e tracking mancante\",\n  \"ai_promises_identified\": [\"verifico subito con il fornitore\", \"la contatto entro 24 ore\"],\n  \"gap_evaluation\": \"Promesse di verifica fornitore e contatto - gap operativo urgente\",\n  \"confidence_calculation\": \"85% - minaccia denuncia e promesse con timeline specifico\",\n  \"gap_identified\": true,\n  \"confidence\": 85,\n  \"customer_satisfaction\": \"arrabbiato\",\n  \"ai_promises\": [\"verifico subito con il fornitore\", \"la contatto entro 24 ore\"],\n  \"required_actions\": [\"Contatto urgente fornitore\", \"Recupero tracking\", \"Callback cliente entro 24h\"],\n  \"urgency_level\": \"critico\",\n  \"follow_up_needed\": true,\n  \"deadline_hours\": 24,\n  \"action_type\": \"contatto_fornitore\",\n  \"customer_sentiment\": \"Molto arrabbiato, minaccioso\",\n  \"notes\": \"Priorit√† massima - rischio escalation legale\"\n}\n```\n\n## REGOLE OUTPUT JSON\n1. Tutti i campi sono obbligatori\n2. `confidence` sempre numero intero 0-100\n3. `customer_satisfaction`: solo \"soddisfatto\"|\"neutrale\"|\"frustrato\"|\"arrabbiato\"\n4. `urgency_level`: solo \"critico\"|\"alto\"|\"medio\"|\"basso\"\n5. `action_type`: solo \"consegna\"|\"tracking\"|\"reso\"|\"verifica\"|\"contatto_fornitore\"|\"tecnico\"|\"nessuna\"\n6. Array vuoti [] quando non applicabile, mai null\n7. `deadline_hours`: 0 se follow_up_needed √® false\n\n## FOCUS OPERATIVO\n- **70% dei casi** sono tracking mancanti che richiedono azione\n- Distingui tra \"info complete fornite\" vs \"promesse di azione futura\"\n- Timeline specifiche aumentano urgenza e confidence\n- Tono cliente (\"faccio presente\" = neutrale, \"denuncio\" = arrabbiato)"}]}},"id":"14ecc965-dd00-45d3-a3d9-9f478c1eb074","name":"Conversation Analyzer","type":"@n8n/n8n-nodes-langchain.chainLlm","typeVersion":1.5,"position":[-1488,-560],"retryOnFail":true,"notes":"# RUOLO E OBIETTIVO\nSei un esperto supervisore del servizio clienti specializzato nell''identificare gap operativi in un **business di dropshipping pneumatici auto/moto** quando l''AI fa promesse che richiedono azioni del team umano.\n\n**OBIETTIVO**: Identificare con precisione le promesse dell''AI che necessitano follow-up operativo nel contesto specifico del dropshipping pneumatici.\n\n## FRAMEWORK SPECIFICO PNEUMATICI (Focus Tracking Mancanti)\n- **CRITICO**: Consegne parziali, errori compatibilit√†, ordini smarriti, problemi pagamento\n- **ALTO**: **TRACKING MANCANTI/SBAGLIATI** (70% dei casi - spesso GAP), ritardi prolungati (>7 giorni)\n- **MEDIO**: Richieste info con tracking funzionante, aggiornamenti status, verifiche routine  \n- **BASSO**: Conferme ordine, FAQ, compatibilit√† pneumatici\n\n**REALT√Ä BUSINESS**: Il 70% delle chiamate √® per tracking mancanti/sbagliati dove l''AI DEVE promettere verifiche/invii = GAP operativo reale.\n\n\n## METODOLOGIA SPECIALIZZATA (Step-Back + Chain of Thought)\n\n**STEP 1 - STEP-BACK PROMPTING**: Prima di analizzare, considera:\n- Nel dropshipping pneumatici, il 70% delle richieste riguarda tracking MANCANTI/SBAGLIATI\n- Quando manca tracking, l''AI DEVE promettere verifiche/invio = GAP operativo reale\n- Come distinguere tra \"tracking mancante\" (problema sistemico) vs \"tracking completo\" (caso raro)?\n- Le promesse \"verificheremo e invieremo tracking\" sono NECESSARIE quando info mancanti\n\n**STEP 2 - CHAIN OF THOUGHT REASONING**: Analizza step-by-step:\n\n1. **Analisi Customer Request Pneumatici**: \n   - √à una richiesta tracking standard? (70% dei casi)\n   - **REGOLA**: Se cliente dice \"faccio presente\", \"notifica\", \"segnalo\" = TONO NEUTRALE\n   - **DISTINGUI**: Tracking con info mancanti vs ansia normale cliente\n   - Che tipo di problema tracking? (link non funziona, codice errato, info incomplete, nessun tracking ricevuto)\n   - L''AI ha informazioni sufficienti per risolvere o deve cercare/verificare?\n\n2. **Analisi AI Response Tracking-Focused**:\n   - **CASO A - TRACKING MANCANTE** (70% casi): AI non ha tracking = DEVE promettere verifica/invio = GAP\n   - **CASO B - TRACKING COMPLETO** (30% casi): Ha tracking + status + ubicazione = NO GAP  \n   - **PROMESSE NECESSARIE**: \"verificheremo\", \"ti invieremo\", \"controlleremo sistema\" = GAP giustificato\n   - **TRACKING MANCANTE**: AI promette \"verificher√≤ e ti invier√≤\" = GAP operativo reale\n   - **TRACKING PRESENTE**: Link funzionante + spiegazione + status = NO GAP\n   - **INFO INSUFFICIENTI**: AI dice \"√® in transito\" senza tracking = GAP (deve fornire tracking)\n\n3. **Gap Identification Tracking-Missing-Aware**:\n   - **REGOLA 70%**: La maggior parte richieste = tracking MANCANTI = GAP necessario e giustificato\n   - L''AI ha tracking da fornire immediatamente o deve cercare/verificare?\n   - **TRACKING MANCANTE**: AI deve promettere \"verificher√≤ e ti invier√≤\" = GAP operativo giusto\n   - **TRACKING PRESENTE**: AI risolve immediatamente con info = NO GAP\n   - Le promesse di verifica tracking sono NECESSARIE quando tracking mancante\n\n4. **Confidence Calibrata Tracking-First**:\n   - 90-100%: Promesse coordinate fornitore/corriere con timeline specifici\n   - 70-89%: Impegni operativi concreti + **TRACKING PROMISES con timeline**\n   - **50-69%: TRACKING INFO MANCANTI con promesse generiche** (\"verificheremo\", \"controlleremo\")\n   - **20-40%: TRACKING CON INFO COMPLETE** (caso pi√π comune - NO GAP)\n   - 0-19%: Gestione completa senza necessit√† operative\n\n## ESEMPI SPECIFICI PNEUMATICI\n\n### Esempio 1 - TRACKING MANCANTE: GAP ALTO (75%)\n**Input**: \n- Cliente: \"Non ho mai ricevuto il tracking del mio ordine pneumatici\"\n- AI: \"Mi scuso per l''inconveniente. **Verificher√≤ lo stato del tuo ordine** e **ti invier√≤ il tracking entro oggi**\"\n\n**Output**:\n```json\n{\n  \"reasoning_steps\": {\n    \"customer_request_analysis\": \"Tracking mai ricevuto - caso comune 70% che richiede azione\",\n    \"ai_promises_identified\": [\"Verificher√≤ lo stato del tuo ordine\", \"Ti invier√≤ il tracking entro oggi\"],\n    \"gap_evaluation\": \"AI non ha tracking disponibile, promette verifica e invio - gap operativo necessario e giustificato\",\n    \"confidence_calculation\": \"75% perch√© tracking mancante richiede azione operativa reale per completare servizio\"\n  },\n  \"gap_identified\": true,\n  \"confidence\": 75,\n  \"customer_satisfaction\": \"neutral\",\n  \"ai_promises\": [\"Verificher√≤ lo stato del tuo ordine\", \"Ti invier√≤ il tracking entro oggi\"],\n  \"required_actions\": [\"Verificare stato ordine nel sistema\", \"Inviare tracking al cliente\"],\n  \"urgency_level\": \"high\",\n  \"follow_up_needed\": true,\n  \"deadline_hours\": 8,\n  \"action_type\": \"tracking\",\n  \"customer_sentiment\": \"Cliente che necessita informazioni tracking mancanti\",\n  \"notes\": \"Tracking mancante - caso comune che richiede verifica sistema e invio\"\n}\n```\n\n### Esempio 2 - TRACKING LINK SBAGLIATO: GAP ALTO (80%)\n**Input**:\n- Cliente: \"Il link tracking che mi avete mandato non funziona\"\n- AI: \"**Verificheremo il problema** e **ti invieremo un tracking corretto entro oggi**\"\n\n**Output**:\n```json\n{\n  \"reasoning_steps\": {\n    \"customer_request_analysis\": \"Link tracking errato - caso comune che blocca il cliente\",\n    \"ai_promises_identified\": [\"Verificheremo il problema\", \"Ti invieremo tracking corretto entro oggi\"],\n    \"gap_evaluation\": \"Tracking errato richiede verifica sistema e invio link corretto - gap operativo necessario\",\n    \"confidence_calculation\": \"80% per tracking errato che richiede fix e reinvio con timeline specifico\"\n  },\n  \"gap_identified\": true,\n  \"confidence\": 80,\n  \"customer_satisfaction\": \"frustrated\",\n  \"ai_promises\": [\"Verificheremo il problema\", \"Ti invieremo tracking corretto entro oggi\"],\n  \"required_actions\": [\"Verificare problema tracking sistema\", \"Inviare link tracking corretto\"],\n  \"urgency_level\": \"high\",\n  \"follow_up_needed\": true,\n  \"deadline_hours\": 8,\n  \"action_type\": \"tracking\",\n  \"customer_sentiment\": \"Cliente frustrato per tracking non funzionante\",\n  \"notes\": \"Fix tracking errato urgente - customer experience compromessa\"\n}\n```\n\n### Esempio 3 - TRACKING COMPLETO RARO: NESSUN GAP (30%)\n**Input**:\n- Cliente: \"Non riesco a trovare il tracking\"\n- AI: \"Il tuo ordine √® spedito con GLS, codice: 12345678. Stato: in transito verso Firenze. Consegna prevista domani.\"\n\n**Output**:\n```json\n{\n  \"reasoning_steps\": {\n    \"customer_request_analysis\": \"Richiesta tracking - caso meno comune dove AI ha info complete\",\n    \"ai_promises_identified\": [],\n    \"gap_evaluation\": \"AI ha fornito tracking completo, status e tempistiche - problema risolto immediatamente\",\n    \"confidence_calculation\": \"30% perch√© AI ha tutte le informazioni necessarie per risolvere autonomamente\"\n  },\n  \"gap_identified\": false,\n  \"confidence\": 30,\n  \"customer_satisfaction\": \"satisfied\",\n  \"ai_promises\": [],\n  \"required_actions\": [],\n  \"urgency_level\": \"low\",\n  \"follow_up_needed\": false,\n  \"deadline_hours\": 0,\n  \"action_type\": \"none\",\n  \"customer_sentiment\": \"Cliente soddisfatto delle informazioni complete\",\n  \"notes\": \"Tracking completo fornito - caso raro dove AI risolve autonomamente\"\n}\n```\n\n### Esempio 4 - ANSIA CLIENTE CON INFO COMPLETE: NESSUN GAP (30%)\n**Input**:\n- Cliente: \"Sono passati 3 giorni, quando arrivano i pneumatici?\"\n- AI: \"Il tuo ordine √® regolarmente in transito. Spedito 2 giorni fa, consegna prevista domani. Tracking: ABC123 - attualmente a Milano.\"\n\n**Output**:\n```json\n{\n  \"reasoning_steps\": {\n    \"customer_request_analysis\": \"Ansia cliente per tempistiche - richiesta rassicurazioni standard\",\n    \"ai_promises_identified\": [],\n    \"gap_evaluation\": \"AI ha fornito informazioni complete su status e previsioni - ansia cliente gestita con info\",\n    \"confidence_calculation\": \"30% perch√© informazioni tracking complete risolvono ansia senza azioni\"\n  },\n  \"gap_identified\": false,\n  \"confidence\": 30,\n  \"customer_satisfaction\": \"neutral\",\n  \"ai_promises\": [],\n  \"required_actions\": [],\n  \"urgency_level\": \"low\",\n  \"follow_up_needed\": false,\n  \"deadline_hours\": 0,\n  \"action_type\": \"none\",\n  \"customer_sentiment\": \"Cliente ansioso ma rassicurato dalle info\",\n  \"notes\": \"Ansia spedizione standard - info tracking complete sufficienti\"\n}\n```\n\n### Esempio 5 - TRACKING MANCANTE CON INFO: NESSUN GAP (25%)\n**Input**:\n- Cliente: \"Non ho mai ricevuto il tracking per il mio ordine\"\n- AI: \"Ti fornisco subito il tracking: GLS 98765432. Il pacco √® in consegna oggi a Roma. Mi scuso per l''omissione.\"\n\n**Output**:\n```json\n{\n  \"reasoning_steps\": {\n    \"customer_request_analysis\": \"Tracking mai ricevuto - problema amministrativo risolto dall''AI\",\n    \"ai_promises_identified\": [],\n    \"gap_evaluation\": \"AI ha fornito tracking immediato e risolto problema - nessuna azione aggiuntiva necessaria\",\n    \"confidence_calculation\": \"25% perch√© problema tracking risolto completamente dall''AI\"\n  },\n  \"gap_identified\": false,\n  \"confidence\": 25,\n  \"customer_satisfaction\": \"satisfied\",\n  \"ai_promises\": [],\n  \"required_actions\": [],\n  \"urgency_level\": \"low\",\n  \"follow_up_needed\": false,\n  \"deadline_hours\": 0,\n  \"action_type\": \"none\",\n  \"customer_sentiment\": \"Cliente soddisfatto della risoluzione immediata\",\n  \"notes\": \"Tracking mancante risolto immediatamente - problema amministrativo chiuso\"\n}\n```\n\n## FORMATO OUTPUT PNEUMATICI\n```json\n{\n  \"reasoning_steps\": {\n    \"customer_request_analysis\": \"analisi specifica problema pneumatici\",\n    \"ai_promises_identified\": [\"promesse operative identificate\"],\n    \"gap_evaluation\": \"necessit√† coordinamento supply chain/corrieri\",\n    \"confidence_calculation\": \"logica calcolo per dropshipping automotive\"\n  },\n  \"gap_identified\": boolean,\n  \"confidence\": number (0-100),\n  \"confidence_reasoning\": \"spiegazione contestualizzata pneumatici\",\n  \"customer_satisfaction\": \"satisfied|neutral|frustrated|angry\",\n  \"ai_promises\": [\"solo impegni operativi reali\"],\n  \"required_actions\": [\"azioni specifiche dropshipping pneumatici\"],\n  \"urgency_level\": \"critical|high|medium|low\",\n  \"follow_up_needed\": boolean,\n  \"deadline_hours\": number,\n  \"action_type\": \"delivery|tracking|return|verification|supplier_contact|technical|none\",\n  \"customer_sentiment\": \"analisi sentiment automotive context\",\n  \"notes\": \"osservazioni specifiche business pneumatici\"\n}\n```\n\n## PRINCIPI SPECIALIZZATI TRACKING-FIRST\n- **TRACKING REQUESTS = 70% dei casi**: La maggior parte NON richiede azione se AI fornisce info complete\n- **INFO COMPLETE = NO GAP**: Link funzionante + status + tempistiche = problema risolto\n- **PROMESSE RARE**: Solo per problemi tecnici o coordinamento reale necessario\n- **ANSIA CLIENTE NORMALE**: Rassicurazioni con info dettagliate = sufficiente\n- **FOCUS SU AZIONI CONCRETE**: Gap solo quando serve intervento operativo reale\n\n**REGOLA AUREA TRACKING CORRETTA**:\n- **TRACKING MANCANTE/SBAGLIATO** (70% casi) = confidence 70-85% (GAP giustificato e necessario)\n- **TRACKING COMPLETO** (30% casi) = confidence 20-30% (NO GAP)  \n- **PROMESSE VERIFICA/INVIO** = GAP operativo reale quando tracking mancante\n- **AI SENZA INFO** = DEVE promettere verifiche = GAP necessario per completare servizio\n- **AI CON INFO COMPLETE** = risolve autonomamente = NO GAP\n\n**BUSINESS REALITY**: Nel dropshipping, tracking mancanti sono problemi sistemici reali che richiedono azione operativa!\n\n**ISTRUZIONI FINALI**: \n- Considera sempre il contesto automotive (sicurezza, urgenza mobilit√†)\n- Distingui tra problemi gestibili vs. necessit√† coordinamento supply chain\n- Mantieni focus su customer satisfaction nel settore automotive\n- Il reasoning deve riflettere le specificit√† del business pneumatici"},{"parameters":{"jsonSchemaExample":"{\n \"title\": \"URGENTE: Verifica tracking ordine BCRGBYWMU\",\n \"description\": \"Cliente segnala mancanza pneumatico da consegna parziale. AI ha promesso contatto corriere e aggiornamento entro 24h. Necessario contattare GLS e aggiornare cliente con tracking reale.\",\n \"priority\": \"high\",\n \"action_type\": \"tracking\",\n \"deadline_hours\": 16,\n \"customer_context\": {\n \"email\": \"cliente@email.com\",\n \"name\": \"Mario Rossi\",\n \"order_id\": \"BCRGBYWMU\", \n \"subject\": \"Problema consegna\",\n \"issue_summary\": \"Consegna parziale - manca 1 pneumatico\"\n },\n \"ai_commitments\": [\"Contattare corriere GLS\", \"Fornire update entro 24 ore\"],\n \"execution_steps\": [\n \"Contattare GLS con numero ordine per localizzare pneumatico mancante\",\n \"Verificare stato seconda spedizione nei sistemi interni\",\n \"Chiamare cliente per comunicare aggiornamenti e nuovo ETA\"\n ],\n \"success_criteria\": \"Cliente informato su tracking reale e ETA confermato\",\n \"escalation_trigger\": \"Se corriere non fornisce info entro 4 ore\",\n \"notes\": \"Priorit√† alta - cliente gi√† frustrato per consegna parziale\",\n \"confidence_level\": 85,\n \"validation_required\": false\n}"},"type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.3,"position":[-608,-448],"id":"5aebe846-b31a-44b4-bb09-d32f848b4967","name":"Structured Output Parser1"},{"parameters":{"promptType":"define","text":"=Analizza questi dati :\n{{ $json.output.customer_request_analysis }}\n{{ $json.output.ai_promises_identified }}\n{{ $json.output.gap_evaluation }}\n{{ $json.output.confidence_calculation }}\n{{ $json.output.gap_identified }}\n{{ $json.output.confidence }}\n{{ $json.output.ai_promises }}\n{{ $json.output.required_actions }}\n{{ $json.output.urgency_level }}\n{{ $json.output.follow_up_needed }}\n{{ $json.output.deadline_hours }}\n{{ $json.output.action_type }}\n{{ $json.output.customer_sentiment }}\n{{ $json.output.notes }}\n{{ $json.output.customer_satisfaction }}","hasOutputParser":true,"messages":{"messageValues":[{"message":"=# CREAZIONE TASK PER CUSTOMER SERVICE GOMMEGO\n\nSei un task manager che crea task operativi strutturati per il team customer service di GommeGo basandoti sull''analisi dei gap delle conversazioni AI-cliente.\n\n## VARIABILI INPUT\n- customer_email: {{ $(''Data Mapper'').item.json.customer_email }}\n- customer_name: {{ $(''Data Mapper'').item.json.customer_name }}\n- order_id: {{ $(''Data Mapper'').item.json.order_id }}\n- email_subject: {{ $(''Data Mapper'').item.json.email_subject }}\n- customer_message: {{ $(''Data Mapper'').item.json.customer_message }}\n- gap_analysis: {{ $json.output.confidence_calculation }}\n\n## COMPITO\nCrea un task JSON basato sull''analisi del gap. Segui queste regole di priorit√†:\n- urgenza \"critico\" O linguaggio minaccioso ‚Üí priority \"critical\" (2-6 ore)\n- urgenza \"alto\" O promessa < 24h ‚Üí priority \"high\" (8-16 ore)\n- urgenza \"medio\" ‚Üí priority \"medium\" (24-48 ore)\n- altri casi ‚Üí priority \"low\" (48-72 ore)\n\n## ESEMPI\n\n### Input 1:\n```\ncliente: mario.rossi@email.com, ordine GG2024-1234\ngap_analysis: {\n  \"urgency_level\": \"critico\",\n  \"ai_promises\": [\"verifico subito\", \"contatto entro 24 ore\"],\n  \"customer_sentiment\": \"Molto arrabbiato\"\n}\n```\n\n### Output 1:\n```json\n{\n  \"title\": \"URGENTE: Verifica tracking ordine GG2024-1234\",\n  \"description\": \"Cliente minaccia azioni. AI ha promesso verifica e contatto 24h. Necessario tracking immediato.\",\n  \"priority\": \"critical\",\n  \"action_type\": \"tracking\",\n  \"deadline_hours\": 4,\n  \"customer_context\": {\n    \"email\": \"mario.rossi@email.com\",\n    \"name\": \"Mario Rossi\",\n    \"order_id\": \"GG2024-1234\",\n    \"subject\": \"Ordine mai arrivato\",\n    \"issue_summary\": \"Ritardo settimanale, minacce legali\"\n  },\n  \"ai_commitments\": [\"verifico subito\", \"contatto entro 24 ore\"],\n  \"execution_steps\": [\n    \"Contattare corriere per tracking immediato\",\n    \"Verificare sistemi per anomalie spedizione\",\n    \"Chiamare cliente entro 4 ore con soluzione\"\n  ],\n  \"success_criteria\": \"Tracking comunicato e consegna confermata\",\n  \"escalation_trigger\": \"Corriere non risponde entro 2 ore\",\n  \"notes\": \"Cliente critico - massima priorit√†\",\n  \"confidence_level\": 85,\n  \"validation_required\": true\n}\n```\n\n### Input 2:\n```\ncliente: laura.bianchi@email.com, ordine GG2024-5678\ngap_analysis: {\n  \"urgency_level\": \"alto\",\n  \"ai_promises\": [\"verificher√≤ magazzino\", \"invio tracking\"],\n  \"customer_sentiment\": \"Neutrale\"\n}\n```\n\n### Output 2:\n```json\n{\n  \"title\": \"Problema consegna ordine GG2024-5678\",\n  \"description\": \"Manca 1/4 pneumatici. AI ha promesso verifica e tracking. Necessario completare spedizione.\",\n  \"priority\": \"high\",\n  \"action_type\": \"delivery\",\n  \"deadline_hours\": 12,\n  \"customer_context\": {\n    \"email\": \"laura.bianchi@email.com\",\n    \"name\": \"Laura Bianchi\",\n    \"order_id\": \"GG2024-5678\",\n    \"subject\": \"Manca pneumatico\",\n    \"issue_summary\": \"Consegna parziale 3/4\"\n  },\n  \"ai_commitments\": [\"verificher√≤ magazzino\", \"invio tracking\"],\n  \"execution_steps\": [\n    \"Verificare disponibilit√† pneumatico mancante\",\n    \"Creare spedizione express supplementare\",\n    \"Email cliente con tracking e tempistiche\"\n  ],\n  \"success_criteria\": \"Pneumatico spedito con tracking comunicato\",\n  \"escalation_trigger\": \"Pneumatico non disponibile\",\n  \"notes\": \"Cliente collaborativo\",\n  \"confidence_level\": 75,\n  \"validation_required\": true\n}\n```\n\nGenera task JSON seguendo gli esempi sopra. Includi tutti i campi mostrati. Imposta validation_required=true se confidence<70 o priority=\"critical\"."}]}},"id":"6b32dc18-e241-4d74-a87c-996eec3f4b8f","name":"Task Generator","type":"@n8n/n8n-nodes-langchain.chainLlm","typeVersion":1.5,"position":[-736,-656],"retryOnFail":true,"notes":"## RUOLO\nSei un task manager specializzato nella creazione di task operativi strutturati per il team customer service GommeGo.\n\n## CONTESTO OPERATIVO\n- Azienda: GommeGo - E-commerce pneumatici\n- Team: Customer service con focus su post-vendita\n- Processi: Tracking spedizioni, gestione resi, risoluzione problemi consegna\n\nANALIZZA I DATI DI  ANALISI RICEVUTI E I DATI CLIENTE\nEmail: {{ $(''üìã Data Mapper'').item.json.customer_email }}\nNome: {{ $(''üìã Data Mapper'').item.json.customer_name }}\nOrdine: {{ $(''üìã Data Mapper'').item.json.order_id }}\nOggetto: {{ $(''üìã Data Mapper'').item.json.email_subject }}\nMessaggio:{{ $(''üìã Data Mapper'').item.json.customer_message }} \n\n\n## LOGICA CREAZIONE TASK\n\n### PRIORIT√Ä MAPPING\n- CRITICAL ‚Üí priority: \"critical\", deadline: 2-6 ore\n- HIGH ‚Üí priority: \"high\", deadline: 8-24 ore \n- MEDIUM ‚Üí priority: \"medium\", deadline: 24-48 ore\n- LOW ‚Üí priority: \"low\", deadline: 48-72 ore\n\n### SPECIALIZZAZIONE PER TIPO\n\nTRACKING: \n- Titolo: \"Verifica tracking ordine [ORDER_ID]\"\n- Focus: Aggiornamento sistemi, contatto corriere\n\nDELIVERY:\n- Titolo: \"Problema consegna ordine [ORDER_ID]\"\n- Focus: Coordinamento logistico, aggiornamento cliente\n\nREFUND:\n- Titolo: \"Elaborazione rimborso ordine [ORDER_ID]\"\n- Focus: Processo amministrativo, timeline compliance\n\nVERIFICATION:\n- Titolo: \"Verifica tecnica ordine [ORDER_ID]\"\n- Focus: Controllo qualit√†, validazione dati\n"},{"parameters":{"tableId":"smart_tasks","dataToSend":"autoMapInputData"},"id":"88bd9955-4858-4fe0-89aa-22c4424bcdbf","name":"Supabase Task Insert","type":"n8n-nodes-base.supabase","typeVersion":1,"position":[80,-656],"credentials":{"supabaseApi":{"id":"U18uJwD80Uq036TV","name":"Supabase tiziano.annicchiarico@gmail.com"}}},{"parameters":{"jsCode":"// üìã NO TASK NEEDED - LOGGING v2.0\n// Logga quando non viene creato nessun task\n\ntry {\n  // Recupera dati dai nodi precedenti con nomi corretti\n  const analysis = $(''üîß JSON Extractor & Validator'').item.json;\n  const customerData = $(''Data Mapper'').item.json;\n\n  console.log(''‚ÑπÔ∏è NO TASK CREATION NEEDED'');\n  console.log(''='' .repeat(40));\n  console.log(''üë§ Customer:'', customerData.customer_email);\n  console.log(''üì¶ Order:'', customerData.order_id || ''N/A'');\n  console.log(''üîç Gap Identified:'', analysis.gap_identified);\n  console.log(''üìä Confidence:'', analysis.confidence + ''%'');\n  console.log(''üìù Reason:'', analysis.confidence_reasoning);\n  console.log(''üìã Action Type:'', analysis.action_type);\n  console.log(''üé≠ Sentiment:'', analysis.customer_sentiment);\n  console.log(''='' .repeat(40));\n\n  const summary = {\n    task_created: false,\n    customer_email: customerData.customer_email || ''unknown@email.com'',\n    customer_name: customerData.customer_name || null,\n    order_id: customerData.order_id || null,\n    gap_identified: analysis.gap_identified || false,\n    confidence: analysis.confidence || 0,\n    confidence_reasoning: analysis.confidence_reasoning || ''N/A'',\n    action_type: analysis.action_type || ''unknown'',\n    urgency_level: analysis.urgency_level || ''low'',\n    customer_satisfaction: analysis.customer_satisfaction || ''neutral'',\n    customer_sentiment: analysis.customer_sentiment || ''N/A'',\n    follow_up_needed: analysis.follow_up_needed || false,\n    processing_timestamp: new Date().toISOString(),\n    workflow_version: ''v4.0_optimized'',\n    execution_id: $execution?.id || ''unknown''\n  };\n\n  console.log(''üìä Summary created successfully'');\n  return [{ json: summary }];\n\n} catch (error) {\n  console.error(''‚ùå NO TASK LOGGING ERROR:'', error.message);\n  \n  // Fallback logging\n  const fallbackSummary = {\n    task_created: false,\n    error: error.message,\n    processing_timestamp: new Date().toISOString(),\n    workflow_version: ''v4.0_error_fallback''\n  };\n  \n  return [{ json: fallbackSummary }];\n}"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[528,-528],"id":"5474414a-a226-4e59-b74c-a7838095797f","name":"No Task Logging"},{"parameters":{"operation":"get","tableId":"task_metrics","filters":{"conditions":[{"keyName":"date","keyValue":"={{ $(''Event Logger Prep'').item.json.date }}"},{}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[1504,-1264],"id":"016b0f18-c95f-437e-ae3e-637d82141f1b","name":"Check Today Record","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"U18uJwD80Uq036TV","name":"Supabase tiziano.annicchiarico@gmail.com"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"record-exists","leftValue":"={{ Number($items().length) }}","rightValue":0,"operator":{"type":"number","operation":"gt"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[1856,-1264],"id":"f027d896-6348-4767-9a69-18603cf27388","name":"Record Exists?"},{"parameters":{"jsCode":"// UPDATE EXISTING RECORD\n// Incrementa contatori esistenti e preserva il campo `date`\n\nconsole.log(''üîÑ UPDATING EXISTING RECORD'');\n\ntry {\n  // Dati del record esistente\n  const checkResult = $(''Check Today Record'').item.json;\n  const existingRecord = Array.isArray(checkResult) ? checkResult[0] : checkResult;\n\n  // Fallback se date mancante\n  if (!existingRecord.date) {\n    existingRecord.date = new Date().toISOString().split(''T'')[0];\n  }\n\n  // Nuovi dati da aggiungere\n  const newData = $(''Event Logger Prep'').item.json;\n\n  console.log(''üìÖ Existing record found for date:'', existingRecord.date);\n\n  // Incrementa tutti i contatori\n  const updatedRecord = {\n    date: existingRecord.date,\n\n    total_emails_processed: (existingRecord.total_emails_processed || 0) + (newData.total_emails_processed || 0),\n    emails_successful: (existingRecord.emails_successful || 0) + (newData.emails_successful || 0),\n    emails_failed: (existingRecord.emails_failed || 0) + (newData.emails_failed || 0),\n    ai_responses_generated: (existingRecord.ai_responses_generated || 0) + (newData.ai_responses_generated || 0),\n    ai_response_errors: (existingRecord.ai_response_errors || 0) + (newData.ai_response_errors || 0),\n    orders_processed: (existingRecord.orders_processed || 0) + (newData.orders_processed || 0),\n    unique_customers: (existingRecord.unique_customers || 0) + (newData.unique_customers || 0),\n    tasks_created_total: (existingRecord.tasks_created_total || 0) + (newData.tasks_created_total || 0),\n    tasks_created_critical: (existingRecord.tasks_created_critical || 0) + (newData.tasks_created_critical || 0),\n    tasks_created_high: (existingRecord.tasks_created_high || 0) + (newData.tasks_created_high || 0),\n    tasks_created_medium: (existingRecord.tasks_created_medium || 0) + (newData.tasks_created_medium || 0),\n    tasks_created_low: (existingRecord.tasks_created_low || 0) + (newData.tasks_created_low || 0),\n    gaps_detected: (existingRecord.gaps_detected || 0) + (newData.gaps_detected || 0),\n    conversations_analyzed: (existingRecord.conversations_analyzed || 0) + (newData.conversations_analyzed || 0),\n    peak_hour_volume: (existingRecord.peak_hour_volume || 0) + (newData.peak_hour_volume || 0),\n\n    avg_processing_time_ms: Math.round(\n      ((existingRecord.avg_processing_time_ms || 0) * (existingRecord.conversations_analyzed || 1) +\n       (newData.avg_processing_time_ms || 0)) /\n      ((existingRecord.conversations_analyzed || 1) + 1)\n    ),\n\n    daily_classifications: mergeClassifications(\n      existingRecord.daily_classifications,\n      newData.daily_classifications\n    ),\n\n    last_updated: new Date().toISOString(),\n    notes: `Updated: ${new Date().toLocaleString(''it-IT'')}`\n  };\n\n  console.log(''‚úÖ Record updated successfully'');\n  console.log(''üìä Totali:'', {\n    emails: updatedRecord.total_emails_processed,\n    tasks: updatedRecord.tasks_created_total,\n    conversations: updatedRecord.conversations_analyzed\n  });\n\n  return [{\n    json: {\n      ...updatedRecord,\n      date: existingRecord.date\n    }\n  }];\n\n} catch (error) {\n  console.error(''üí• UPDATE ERROR:'', error.message);\n  return [{ json: { error: error.message } }];\n}\n\n// Funzione di merge classificazioni\nfunction mergeClassifications(existing, newData) {\n  try {\n    const existingObj = existing ? JSON.parse(existing) : {};\n    const newObj = newData ? JSON.parse(newData) : {};\n\n    const merged = { ...existingObj };\n    for (const [key, value] of Object.entries(newObj)) {\n      merged[key] = (merged[key] || 0) + value;\n    }\n\n    return JSON.stringify(merged);\n  } catch {\n    return newData || existing || ''{}'';\n  }\n}"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[2048,-1280],"id":"9fed5e27-2a8e-4fdd-b1b6-5df120f28619","name":"Update Existing","notes":"// üîÑ UPDATE EXISTING RECORD\n// Incrementa contatori esistenti\n\nconsole.log(''üîÑ UPDATING EXISTING RECORD'');\n\ntry {\n  // Dati del record esistente\n  const checkResult = $(''üîç Check Today Record'').item.json;\n  const existingRecord = Array.isArray(checkResult) ? checkResult[0] : checkResult;\n  \n  // Nuovi dati da aggiungere  \n  const newData = $(''üìà Metrics Data Prep'').item.json;\n  \n  console.log(''üìä Existing record found for:'', existingRecord.date);\n  \n  // Incrementa tutti i contatori\n  const updatedRecord = {\n    date: existingRecord.date,\n    \n    // Incrementa contatori\n    total_emails_processed: (existingRecord.total_emails_processed || 0) + (newData.total_emails_processed || 0),\n    emails_successful: (existingRecord.emails_successful || 0) + (newData.emails_successful || 0),\n    emails_failed: (existingRecord.emails_failed || 0) + (newData.emails_failed || 0),\n    ai_responses_generated: (existingRecord.ai_responses_generated || 0) + (newData.ai_responses_generated || 0),\n    ai_response_errors: (existingRecord.ai_response_errors || 0) + (newData.ai_response_errors || 0),\n    orders_processed: (existingRecord.orders_processed || 0) + (newData.orders_processed || 0),\n    unique_customers: (existingRecord.unique_customers || 0) + (newData.unique_customers || 0),\n    tasks_created_total: (existingRecord.tasks_created_total || 0) + (newData.tasks_created_total || 0),\n    tasks_created_critical: (existingRecord.tasks_created_critical || 0) + (newData.tasks_created_critical || 0),\n    tasks_created_high: (existingRecord.tasks_created_high || 0) + (newData.tasks_created_high || 0),\n    tasks_created_medium: (existingRecord.tasks_created_medium || 0) + (newData.tasks_created_medium || 0),\n    tasks_created_low: (existingRecord.tasks_created_low || 0) + (newData.tasks_created_low || 0),\n    gaps_detected: (existingRecord.gaps_detected || 0) + (newData.gaps_detected || 0),\n    conversations_analyzed: (existingRecord.conversations_analyzed || 0) + (newData.conversations_analyzed || 0),\n    peak_hour_volume: (existingRecord.peak_hour_volume || 0) + (newData.peak_hour_volume || 0),\n    \n    // Calcola media per processing time\n    avg_processing_time_ms: Math.round(\n      ((existingRecord.avg_processing_time_ms || 0) * (existingRecord.conversations_analyzed || 1) + \n       (newData.avg_processing_time_ms || 0)) / \n      ((existingRecord.conversations_analyzed || 1) + 1)\n    ),\n    \n    // Merge classifications JSON\n    daily_classifications: mergeClassifications(\n      existingRecord.daily_classifications, \n      newData.daily_classifications\n    ),\n    \n    // Update metadata\n    last_updated: new Date().toISOString(),\n    notes: `Updated: ${new Date().toLocaleString(''it-IT'')}`\n  };\n  \n  console.log(''‚úÖ Record updated successfully'');\n  console.log(''üìä New totals:'', {\n    emails: updatedRecord.total_emails_processed,\n    tasks: updatedRecord.tasks_created_total,\n    conversations: updatedRecord.conversations_analyzed\n  });\n  \n  return [{ json: updatedRecord }];\n  \n} catch (error) {\n  console.error(''üí• UPDATE ERROR:'', error.message);\n  return [{ json: { error: error.message } }];\n}\n\n// Helper function per merge classifications\nfunction mergeClassifications(existing, newData) {\n  try {\n    const existingObj = existing ? JSON.parse(existing) : {};\n    const newObj = newData ? JSON.parse(newData) : {};\n    \n    // Merge objects\n    const merged = { ...existingObj };\n    for (const [key, value] of Object.entries(newObj)) {\n      merged[key] = (merged[key] || 0) + value;\n    }\n    \n    return JSON.stringify(merged);\n  } catch {\n    return newData || existing || ''{}'';\n  }\n}"},{"parameters":{"operation":"update","tableId":"task_metrics","dataToSend":"autoMapInputData"},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[1312,-1264],"id":"cf6ae0e5-5fe5-4f9b-93b9-679c7c670a85","name":"Supabase Update","credentials":{"supabaseApi":{"id":"U18uJwD80Uq036TV","name":"Supabase tiziano.annicchiarico@gmail.com"}}},{"parameters":{"tableId":"task_events","dataToSend":"autoMapInputData"},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[944,-528],"id":"0940a27d-b6c4-45e9-bd4a-b62287463af7","name":"Supabase Insert","credentials":{"supabaseApi":{"id":"U18uJwD80Uq036TV","name":"Supabase tiziano.annicchiarico@gmail.com"}}},{"parameters":{"jsCode":"// FINAL SUCCESS LOG\n// Logga il completamento dell''operazione\n\nconsole.log(''‚úÖ === DAILY METRICS UPSERT COMPLETED ==='');\n\nconst inputData = $json;\nconst operation = inputData.id ? ''UPDATE'' : ''INSERT'';\nconst date = inputData.date || ''unknown'';\n\nconsole.log(''üìä UPSERT SUMMARY:'');\nconsole.log(''üîÑ Operation:'', operation);\nconsole.log(''üìÖ Date:'', date);\nconsole.log(''üìß Total Emails:'', inputData.total_emails_processed || 0);\nconsole.log(''ü§ñ AI Responses:'', inputData.ai_responses_generated || 0);\nconsole.log(''üìã Tasks Created:'', inputData.tasks_created_total || 0);\nconsole.log(''üí¨ Conversations:'', inputData.conversations_analyzed || 0);\nconsole.log(''‚è∞ Avg Time:'', inputData.avg_processing_time_ms || 0, ''ms'');\n\nreturn [{\n  json: {\n    ...inputData,\n    _summary: {\n      operation: operation,\n      success: true,\n      date: date,\n      totals: {\n        emails: inputData.total_emails_processed || 0,\n        ai_responses: inputData.ai_responses_generated || 0,\n        tasks: inputData.tasks_created_total || 0,\n        conversations: inputData.conversations_analyzed || 0\n      },\n      timestamp: new Date().toISOString()\n    }\n  }\n}];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1280,-544],"id":"cad6fed5-d5cf-4874-8ce4-ee768a4bc0de","name":"Success Log"},{"parameters":{"assignments":{"assignments":[{"id":"data-mapping-1","name":"customer_email","value":"={{ $json.mittente }}","type":"string"},{"id":"data-mapping-2","name":"customer_name","value":"={{ $json.mittente_nome }}","type":"string"},{"id":"data-mapping-3","name":"order_id","value":"={{ $json.order_id }}","type":"string"},{"id":"data-mapping-4","name":"email_subject","value":"={{ $json.oggetto }}","type":"string"},{"id":"data-mapping-5","name":"customer_message","value":"={{ $json.messaggio_cliente }}","type":"string"},{"id":"data-mapping-6","name":"thread_history","value":"={{ $json.thread_storico }}","type":"string"},{"id":"data-mapping-7","name":"ai_response","value":"={{ $json.output.risposta_html }}","type":"string"},{"id":"data-mapping-8","name":"interaction_type","value":"={{ $json.output.tipo_interazione }}","type":"string"},{"id":"data-mapping-9","name":"initial_confidence","value":"={{ $json.output.confidence }}","type":"string"},{"id":"data-mapping-10","name":"is_thread_reply","value":"={{ $json.isThreadReply }}","type":"boolean"},{"id":"data-mapping-11","name":"processing_timestamp","value":"={{ new Date().toISOString() }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-1712,-560],"id":"65542ea4-8931-4bee-8fbf-a2d919f4930a","name":"Data Mapper"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"is-urgent","leftValue":"={{ $json.urgent_notification }}","rightValue":true,"operator":{"type":"boolean","operation":"equals"}}],"combinator":"and"},"options":{}},"id":"9e91a379-3bf2-471d-b60c-84f0391f03a0","name":"Urgency Check","type":"n8n-nodes-base.if","typeVersion":2.2,"position":[304,-656]},{"parameters":{"jsCode":"// üìä TASK EVENT LOGGER v2.0 - ENHANCED FOR ANALYTICS\n// Ogni esecuzione = 1 evento ricco di dati per dashboard\n\nconsole.log(''üìä === TASK EVENT LOGGER v2.0 - ANALYTICS READY ==='');\nconst startTime = Date.now();\n\ntry {\n  // ===============================================\n  // üì• IDENTIFICAZIONE TIPO EVENTO\n  // ===============================================\n  \n  let eventData = {};\n  let eventType = ''unknown'';\n  let taskWasCreated = false;\n  \n  // Determina che tipo di evento stiamo loggando\n  if ($json.ok !== undefined && $json.result) {\n    eventType = ''urgent_task_created'';\n    taskWasCreated = true;\n    try {\n      eventData = $(''Urgency Check'').item.json || {};\n    } catch (e) {\n      console.warn(''‚ö†Ô∏è Could not retrieve task data:'', e.message);\n    }\n  } else if ($json.task_created === false) {\n    eventType = ''email_processed_no_task'';\n    taskWasCreated = false;\n    eventData = $json;\n  } else if ($json.conversation_context || $json.title) {\n    eventType = ''task_created'';\n    taskWasCreated = true;\n    eventData = $json;\n  } else {\n    eventType = ''email_processed'';\n    eventData = $json;\n  }\n  \n  // ===============================================\n  // üèóÔ∏è COSTRUZIONE EVENTO ARRICCHITO\n  // ===============================================\n  \n  const now = new Date();\n  const eventId = `evt_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n  \n  // Estrai info base\n  const customerEmail = eventData.customer_email || null;\n  const customerName = eventData.customer_name || null;\n  const orderId = eventData.order_id || null;\n  const priority = eventData.priority || null;\n  \n  // ===============================================\n  // üìà CALCOLO METRICHE PER DASHBOARD\n  // ===============================================\n  \n  // Info da conversation_context\n  let dashboardMetrics = {\n    // PERFORMANCE METRICS\n    response_generated: true,\n    ai_model_used: ''gpt-4.1-mini'',\n    \n    // BUSINESS METRICS\n    has_order: !!orderId,\n    is_returning_customer: false, // Potresti verificare in DB\n    channel: ''email'',\n    \n    // TIME METRICS\n    is_business_hours: (now.getHours() >= 9 && now.getHours() <= 18),\n    is_weekend: (now.getDay() === 0 || now.getDay() === 6),\n    response_sla: ''immediate'', // immediate, same_day, next_day\n    \n    // CATEGORIZATION\n    category: null,\n    subcategory: null,\n    tags: []\n  };\n  \n  if (eventData.conversation_context) {\n    const ctx = eventData.conversation_context;\n    const analysis = ctx.analysis || {};\n    const taskGen = ctx.task_generation || {};\n    \n    // SENTIMENT & SATISFACTION\n    dashboardMetrics.gap_identified = analysis.gap_identified || false;\n    dashboardMetrics.confidence_score = analysis.confidence || 0;\n    dashboardMetrics.customer_satisfaction = analysis.customer_satisfaction || ''neutral'';\n    dashboardMetrics.customer_sentiment = analysis.customer_sentiment || ''neutral'';\n    dashboardMetrics.urgency_level = analysis.urgency_level || ''low'';\n    \n    // COMPLEXITY METRICS\n    dashboardMetrics.ai_promises_count = (analysis.ai_promises || []).length;\n    dashboardMetrics.required_actions_count = (analysis.required_actions || []).length;\n    dashboardMetrics.execution_steps_count = (taskGen.execution_steps || []).length;\n    \n    // CONVERSATION METRICS\n    dashboardMetrics.is_first_contact = !ctx.is_thread_reply;\n    dashboardMetrics.thread_length = ctx.thread_history ? 1 : 0;\n    dashboardMetrics.message_length = (ctx.customer_message || '''').length;\n    dashboardMetrics.response_length = (ctx.ai_response || '''').length;\n    dashboardMetrics.message_complexity = calculateComplexity(ctx.customer_message || '''');\n    \n    // ACTION TYPE & CATEGORY\n    dashboardMetrics.action_type = eventData.action_type || ''unknown'';\n    dashboardMetrics.category = mapActionToCategory(eventData.action_type);\n    dashboardMetrics.subcategory = analysis.classification || null;\n    \n    // RISK & PRIORITY SCORES\n    dashboardMetrics.risk_score = calculateRiskScore(analysis, dashboardMetrics);\n    dashboardMetrics.priority_score = calculatePriorityScore(priority, dashboardMetrics);\n    \n    // TAGS per filtraggio rapido\n    dashboardMetrics.tags = generateTags(eventData, analysis, dashboardMetrics);\n  }\n  \n  // ===============================================\n  // üí∞ BUSINESS VALUE METRICS\n  // ===============================================\n  \n  const businessMetrics = {\n    // CUSTOMER VALUE\n    customer_tier: determineCustomerTier(customerEmail),\n    potential_churn_risk: dashboardMetrics.customer_satisfaction === ''angry'',\n    requires_follow_up: dashboardMetrics.gap_identified,\n    \n    // OPERATIONAL COST\n    estimated_handling_time: estimateHandlingTime(priority, dashboardMetrics.action_type),\n    automation_success: !taskWasCreated,\n    human_intervention_required: taskWasCreated,\n    \n    // SLA & COMPLIANCE\n    sla_at_risk: priority === ''critical'' || priority === ''high'',\n    deadline_hours: getDeadlineHours(priority),\n    \n    // RESOLUTION METRICS\n    first_contact_resolution: !dashboardMetrics.gap_identified && !taskWasCreated,\n    escalation_required: eventData.conversation_context?.task_generation?.escalation_trigger ? true : false\n  };\n  \n  // ===============================================\n  // üéØ EVENTO FINALE ARRICCHITO\n  // ===============================================\n  \n  const taskEvent = {\n    // === IDENTIFICAZIONE ===\n    event_id: eventId,\n    event_type: eventType,\n    event_timestamp: now.toISOString(),\n    \n    // === TEMPORALI PER AGGREGAZIONI ===\n    event_date: now.toISOString().split(''T'')[0],\n    event_hour: now.getHours(),\n    event_day_of_week: now.getDay(),\n    event_week: Math.ceil((now.getDate() + new Date(now.getFullYear(), now.getMonth(), 1).getDay()) / 7),\n    event_month: now.getMonth() + 1,\n    event_quarter: Math.ceil((now.getMonth() + 1) / 3),\n    event_year: now.getFullYear(),\n    \n    // === TASK INFO ===\n    task_created: taskWasCreated,\n    task_id: taskWasCreated ? (eventData.id || eventData.task_id || null) : null,\n    task_priority: priority,\n    task_title: eventData.title || null,\n    task_deadline: eventData.deadline || null,\n    \n    // === CUSTOMER INFO ===\n    customer_email: customerEmail,\n    customer_name: customerName,\n    customer_domain: customerEmail ? customerEmail.split(''@'')[1] : null,\n    order_id: orderId,\n    \n    // === PERFORMANCE ===\n    processing_time_ms: Date.now() - startTime,\n    workflow_execution_id: $execution.id,\n    workflow_name: $execution.workflowData?.name || ''unknown'',\n    \n    // === DASHBOARD METRICS ===\n    dashboard_metrics: dashboardMetrics,\n    \n    // === BUSINESS METRICS ===\n    business_metrics: businessMetrics,\n    \n    // === RAW DATA (compresso) ===\n    raw_input_summary: {\n      input_type: typeof $json,\n      input_keys_count: Object.keys($json).length,\n      has_telegram_response: $json.ok !== undefined,\n      has_conversation_context: !!eventData.conversation_context\n    }\n  };\n  \n  console.log(''‚úÖ Rich event prepared:'', {\n    id: taskEvent.event_id,\n    type: taskEvent.event_type,\n    customer: taskEvent.customer_email,\n    priority: taskEvent.task_priority,\n    risk_score: dashboardMetrics.risk_score,\n    tags: dashboardMetrics.tags\n  });\n  \n  return [{ json: taskEvent }];\n  \n} catch (error) {\n  console.error(''üí• EVENT LOGGER ERROR:'', error.message);\n  \n  const errorEvent = {\n    event_id: `error_${Date.now()}`,\n    event_type: ''processing_error'',\n    event_timestamp: new Date().toISOString(),\n    event_date: new Date().toISOString().split(''T'')[0],\n    error_message: error.message,\n    error_stack: error.stack,\n    workflow_execution_id: $execution.id\n  };\n  \n  return [{ json: errorEvent }];\n}\n\n// ===============================================\n// üîß FUNZIONI HELPER\n// ===============================================\n\nfunction calculateComplexity(message) {\n  if (!message) return ''low'';\n  const wordCount = message.split(/\\s+/).length;\n  if (wordCount > 100) return ''high'';\n  if (wordCount > 50) return ''medium'';\n  return ''low'';\n}\n\nfunction mapActionToCategory(actionType) {\n  const categoryMap = {\n    ''tracking'': ''shipping'',\n    ''delivery'': ''shipping'',\n    ''refund'': ''financial'',\n    ''return'': ''financial'',\n    ''verification'': ''support'',\n    ''escalation'': ''critical'',\n    ''follow_up'': ''support''\n  };\n  return categoryMap[actionType] || ''general'';\n}\n\nfunction calculateRiskScore(analysis, metrics) {\n  let score = 0;\n  if (metrics.customer_satisfaction === ''angry'') score += 30;\n  if (metrics.customer_satisfaction === ''frustrated'') score += 20;\n  if (metrics.urgency_level === ''critical'') score += 25;\n  if (metrics.urgency_level === ''high'') score += 15;\n  if (metrics.gap_identified) score += 10;\n  if (analysis.ai_promises?.includes(''rimborso'')) score += 20;\n  return Math.min(score, 100);\n}\n\nfunction calculatePriorityScore(priority, metrics) {\n  const priorityBase = {\n    ''critical'': 100,\n    ''high'': 75,\n    ''medium'': 50,\n    ''low'': 25\n  };\n  let score = priorityBase[priority] || 0;\n  \n  // Boost per fattori aggiuntivi\n  if (metrics.customer_satisfaction === ''angry'') score += 10;\n  if (metrics.is_first_contact) score -= 5;\n  \n  return Math.min(Math.max(score, 0), 100);\n}\n\nfunction generateTags(eventData, analysis, metrics) {\n  const tags = [];\n  \n  // Priority tags\n  if (eventData.priority) tags.push(`priority:${eventData.priority}`);\n  \n  // Sentiment tags\n  if (metrics.customer_satisfaction !== ''neutral'') {\n    tags.push(`sentiment:${metrics.customer_satisfaction}`);\n  }\n  \n  // Action tags\n  if (metrics.action_type) tags.push(`action:${metrics.action_type}`);\n  \n  // Special tags\n  if (metrics.gap_identified) tags.push(''gap_detected'');\n  if (metrics.risk_score > 50) tags.push(''high_risk'');\n  if (metrics.is_weekend) tags.push(''weekend'');\n  if (!metrics.is_business_hours) tags.push(''after_hours'');\n  if (analysis.ai_promises?.length > 0) tags.push(''has_promises'');\n  \n  return tags;\n}\n\nfunction determineCustomerTier(email) {\n  // Logica semplice - potresti integrarla con DB\n  if (!email) return ''unknown'';\n  if (email.includes(''tecsolutions'')) return ''internal'';\n  if (email.endsWith(''.com'')) return ''business'';\n  return ''standard'';\n}\n\nfunction estimateHandlingTime(priority, actionType) {\n  const baseTime = {\n    ''critical'': 30,\n    ''high'': 20,\n    ''medium'': 15,\n    ''low'': 10\n  };\n  \n  const actionMultiplier = {\n    ''refund'': 2,\n    ''escalation'': 1.5,\n    ''tracking'': 0.5\n  };\n  \n  const time = baseTime[priority] || 15;\n  const multiplier = actionMultiplier[actionType] || 1;\n  \n  return Math.round(time * multiplier);\n}\n\nfunction getDeadlineHours(priority) {\n  const deadlines = {\n    ''critical'': 2,\n    ''high'': 8,\n    ''medium'': 24,\n    ''low'': 48\n  };\n  return deadlines[priority] || 24;\n}"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[752,-528],"id":"4ccc6653-ce8c-428b-9166-637f60119f17","name":"Event Logger Prep","notes":"/// üìà DAILY METRICS LOGGER v5.0 - TELEGRAM FIX\n// Gestisce correttamente l''output di Telegram e No Task Logging\n\nconsole.log(''üìà === DAILY METRICS LOGGER v5.0 - TELEGRAM FIX ==='');\nconst startTime = Date.now();\n\ntry {\n  // ===============================================\n  // üì• DEBUG COMPLETO INPUT\n  // ===============================================\n  \n  console.log(''üîç FULL INPUT:'', JSON.stringify($json, null, 2));\n  console.log(''üîç INPUT TYPE:'', typeof $json);\n  console.log(''üîç INPUT KEYS:'', Object.keys($json));\n  \n  // ===============================================\n  // üîÑ IDENTIFICAZIONE SORGENTE E RECUPERO DATI\n  // ===============================================\n  \n  let inputData = {};\n  let sourcePath = ''unknown'';\n  let taskWasCreated = false;\n  \n  // Caso 1: Output di Telegram (ha \"ok\" e \"result\")\n  if ($json.ok !== undefined && $json.result) {\n    console.log(''üì± Detected Telegram output'');\n    sourcePath = ''telegram_path'';\n    taskWasCreated = true;\n    \n    // RECUPERA I DATI DEL TASK DAL NODO PRECEDENTE\n    // Il task √® nell''output del nodo Urgency Check, non in Telegram\n    try {\n      // Prova a recuperare i dati dal nodo Urgency Check\n      const urgencyCheckData = $(''‚ö° Urgency Check'').item.json;\n      if (urgencyCheckData) {\n        inputData = urgencyCheckData;\n        console.log(''‚úÖ Retrieved task data from Urgency Check'');\n      }\n    } catch (e) {\n      console.warn(''‚ö†Ô∏è Could not retrieve from Urgency Check:'', e.message);\n      \n      // Fallback: prova dal Supabase Insert\n      try {\n        const supabaseData = $(''üíæ Supabase Task Insert'').item.json;\n        if (supabaseData) {\n          inputData = supabaseData;\n          console.log(''‚úÖ Retrieved task data from Supabase Insert'');\n        }\n      } catch (e2) {\n        console.error(''‚ùå Could not retrieve task data'');\n      }\n    }\n  }\n  // Caso 2: Output di No Task Logging\n  else if ($json.task_created === false) {\n    console.log(''üìã Detected No Task Logging output'');\n    sourcePath = ''no_task_path'';\n    taskWasCreated = false;\n    inputData = $json;\n  }\n  // Caso 3: Altri casi (potrebbe essere il task diretto)\n  else if ($json.conversation_context || $json.title) {\n    console.log(''üì¶ Detected direct task data'');\n    sourcePath = ''direct_task'';\n    taskWasCreated = true;\n    inputData = $json;\n  }\n  \n  console.log(''üîç Source path:'', sourcePath);\n  console.log(''üìã Task created:'', taskWasCreated);\n  console.log(''üìä Data keys:'', Object.keys(inputData).slice(0, 10));\n  \n  // ===============================================\n  // üîÑ ESTRAZIONE DATI UNIFICATA\n  // ===============================================\n  \n  // Dati comuni\n  const customerEmail = inputData.customer_email || null;\n  const customerName = inputData.customer_name || null;\n  const orderId = inputData.order_id || null;\n  \n  // Inizializza metricsInfo con defaults\n  let metricsInfo = {\n    isSuccess: true,\n    hasAIResponse: true,\n    taskCreated: taskWasCreated,\n    taskPriority: null,\n    gapDetected: false,\n    confidence: 0,\n    classification: ''unknown'',\n    processingTime: 100,\n    urgencyLevel: ''low'',\n    customerSatisfaction: ''neutral'',\n    customerSentiment: ''neutral'',\n    actionType: ''unknown''\n  };\n  \n  // Estrai dati basandosi sul percorso\n  if (taskWasCreated && inputData.conversation_context) {\n    // Task creato - estrai dai campi del task\n    metricsInfo.taskPriority = inputData.priority || ''medium'';\n    metricsInfo.gapDetected = inputData.conversation_context?.analysis?.gap_identified !== false;\n    metricsInfo.confidence = inputData.conversation_context?.analysis?.confidence || \n                            inputData.conversation_context?.task_generation?.confidence_level || 70;\n    metricsInfo.classification = inputData.action_type || ''task_action'';\n    metricsInfo.urgencyLevel = inputData.conversation_context?.analysis?.urgency_level || \n                              inputData.priority || ''medium'';\n    metricsInfo.customerSatisfaction = inputData.conversation_context?.analysis?.customer_satisfaction || ''neutral'';\n    metricsInfo.customerSentiment = inputData.conversation_context?.analysis?.customer_sentiment || ''neutral'';\n    metricsInfo.actionType = inputData.action_type || ''follow_up'';\n    \n    // Processing time basato su priority\n    if (inputData.priority === ''critical'') metricsInfo.processingTime = 500;\n    else if (inputData.priority === ''high'') metricsInfo.processingTime = 300;\n    else if (inputData.priority === ''medium'') metricsInfo.processingTime = 200;\n    else metricsInfo.processingTime = 100;\n  }\n  else if (!taskWasCreated) {\n    // No task - estrai dal summary\n    metricsInfo.gapDetected = inputData.gap_identified || false;\n    metricsInfo.confidence = inputData.confidence || 0;\n    metricsInfo.classification = inputData.action_type || ''no_action_needed'';\n    metricsInfo.urgencyLevel = inputData.urgency_level || ''low'';\n    metricsInfo.customerSatisfaction = inputData.customer_satisfaction || ''neutral'';\n    metricsInfo.customerSentiment = inputData.customer_sentiment || ''neutral'';\n    metricsInfo.actionType = inputData.action_type || ''none'';\n    metricsInfo.processingTime = 50;\n  }\n  \n  console.log(''üìä Extracted metrics:'', metricsInfo);\n  \n  // ===============================================\n  // üèóÔ∏è COSTRUZIONE DATI PER UPSERT\n  // ===============================================\n  \n  const today = new Date().toISOString().split(''T'')[0];\n  const currentHour = new Date().getHours();\n  \n  const metricsData = {\n    date: today,\n    \n    // Contatori\n    total_emails_processed: 1,\n    emails_successful: 1,\n    emails_failed: 0,\n    ai_responses_generated: 1,\n    ai_response_errors: 0,\n    orders_processed: orderId ? 1 : 0,\n    unique_customers: customerEmail ? 1 : 0,\n    \n    // Task counters\n    tasks_created_total: taskWasCreated ? 1 : 0,\n    tasks_created_critical: (taskWasCreated && metricsInfo.taskPriority === ''critical'') ? 1 : 0,\n    tasks_created_high: (taskWasCreated && metricsInfo.taskPriority === ''high'') ? 1 : 0,\n    tasks_created_medium: (taskWasCreated && metricsInfo.taskPriority === ''medium'') ? 1 : 0,\n    tasks_created_low: (taskWasCreated && metricsInfo.taskPriority === ''low'') ? 1 : 0,\n    \n    // Altri contatori\n    gaps_detected: metricsInfo.gapDetected ? 1 : 0,\n    conversations_analyzed: 1,\n    peak_hour_volume: (currentHour >= 9 && currentHour <= 18) ? 1 : 0,\n    \n    // Metadata\n    last_updated: new Date().toISOString(),\n    avg_processing_time_ms: metricsInfo.processingTime,\n    daily_classifications: JSON.stringify({ \n      [metricsInfo.classification]: 1,\n      [`action_${metricsInfo.actionType}`]: 1,\n      [`satisfaction_${metricsInfo.customerSatisfaction}`]: 1,\n      [`urgency_${metricsInfo.urgencyLevel}`]: 1\n    }),\n    notes: `Generated from ${sourcePath} - ${taskWasCreated ? ''Task created'' : ''No task needed''} - Customer: ${customerEmail || ''unknown''}`\n  };\n  \n  console.log(''üì¶ Metrics prepared successfully'');\n  console.log(''üìä Summary:'', {\n    date: today,\n    path: sourcePath,\n    task: taskWasCreated,\n    priority: metricsInfo.taskPriority,\n    customer: customerEmail\n  });\n  \n  // ===============================================\n  // üì§ OUTPUT\n  // ===============================================\n  \n  return [{\n    json: {\n      ...metricsData,\n      _metadata: {\n        processing_time_ms: Date.now() - startTime,\n        workflow_version: ''daily_metrics_v5.0'',\n        execution_id: $execution.id,\n        source_path: sourcePath,\n        task_created: taskWasCreated,\n        telegram_detected: $json.ok !== undefined,\n        data_source: inputData.id ? ''task_data'' : ''summary_data''\n      }\n    }\n  }];\n  \n} catch (error) {\n  console.error(''üí• METRICS LOGGER ERROR:'', error.message);\n  console.error(''Stack:'', error.stack);\n  \n  // Fallback completo\n  const today = new Date().toISOString().split(''T'')[0];\n  return [{\n    json: {\n      date: today,\n      total_emails_processed: 1,\n      emails_successful: 0,\n      emails_failed: 1,\n      ai_responses_generated: 0,\n      ai_response_errors: 1,\n      orders_processed: 0,\n      unique_customers: 0,\n      tasks_created_total: 0,\n      tasks_created_critical: 0,\n      tasks_created_high: 0,\n      tasks_created_medium: 0,\n      tasks_created_low: 0,\n      gaps_detected: 0,\n      conversations_analyzed: 1,\n      peak_hour_volume: 0,\n      last_updated: new Date().toISOString(),\n      avg_processing_time_ms: 0,\n      daily_classifications: JSON.stringify({ error: 1 }),\n      notes: `Error: ${error.message} - Input keys: ${Object.keys($json || {}).join('', '')}`,\n      _metadata: {\n        error: true,\n        error_message: error.message,\n        raw_input_keys: Object.keys($json || {})\n      }\n    }\n  }];\n}"},{"parameters":{"chatId":"-1002673812914","text":"=üö® **TASK CRITICO GENERATO**\n\nüìã **Task**: {{ $json.title }}\n‚è∞ **Scadenza**: {{ $json.deadline }}\nüë§ **Cliente**: `{{ $json.customer_email }}`\nüì¶ **Ordine**: `{{ $json.order_id || ''N/A'' }}`\n\nüìù **Descrizione**:\n{{ $json.description }}\n\n‚úÖ **Azioni necessarie**:\n{{ $json.conversation_context.task_generation.execution_steps.join(''\\n- '') }}\n\nüéØ **Criteri successo**:\n{{ $json.conversation_context.task_generation.success_criteria }}\n\n‚ö†Ô∏è **Escalation**: {{ $json.conversation_context.task_generation.escalation_trigger }}","additionalFields":{"appendAttribution":false,"parse_mode":"Markdown"}},"id":"e37724d8-c2ad-4ccb-a8ca-7695dc2a1958","name":"Telegram Critical Alert","type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[544,-816],"webhookId":"bb858f02-80fa-4afa-9527-22c99c3c7b5f","credentials":{"telegramApi":{"id":"dbGXwcFAw4mNHLio","name":"GommeGoBot"}}},{"parameters":{"jsCode":"// üèóÔ∏è TASK ENRICHER v6.0 - FIXED VERSION\n// Gestisce correttamente la struttura dati unificata\n\nconsole.log(''üèóÔ∏è === TASK ENRICHER v6.0 - FIXED ==='');\nconst startTime = Date.now();\n\ntry {\n  // ===============================================\n  // üì• ESTRAZIONE DATI DALL''INPUT UNIFICATO\n  // ===============================================\n  \n  // L''input √® un singolo oggetto che contiene tutti i dati\n  const inputData = $json;\n  \n  console.log(''üì• Input structure detected: Single unified object'');\n  console.log(''üìß Processing email from:'', inputData.customer_email);\n  \n  // Estrai i dati del task dall''oggetto ''output''\n  const taskData = inputData.output || {};\n  \n  // I dati del cliente sono al livello principale\n  const customerData = {\n    customer_email: inputData.customer_email,\n    customer_name: inputData.customer_name,\n    order_id: inputData.order_id,\n    email_subject: inputData.email_subject || ''Denuncia polizia postale'', // dal customer_context\n    customer_message: inputData.customer_message,\n    ai_response: inputData.ai_response,\n    thread_history: inputData.thread_history,\n    is_thread_reply: inputData.is_thread_reply,\n    interaction_type: inputData.interaction_type,\n    initial_confidence: inputData.initial_confidence\n  };\n  \n  // I dati di analisi sono parte del taskData\n  const analysisData = {\n    confidence: parseInt(taskData.confidence_level) || 70,\n    gap_identified: true, // implicito dal fatto che c''√® un task\n    customer_satisfaction: taskData.customer_sentiment?.includes(''arrabbiato'') ? ''angry'' : ''frustrated'',\n    customer_sentiment: taskData.customer_sentiment || ''Molto arrabbiato, minaccioso'',\n    ai_promises: taskData.ai_commitments || [],\n    required_actions: taskData.execution_steps || [],\n    urgency_level: taskData.priority || ''high''\n  };\n  \n  console.log(''‚úÖ Data extracted successfully:'');\n  console.log(`- Customer: ${customerData.customer_email}`);\n  console.log(`- Order ID: ${customerData.order_id}`);\n  console.log(`- Task priority: ${taskData.priority}`);\n  console.log(`- Task title: ${taskData.title}`);\n  \n  // ===============================================\n  // üèóÔ∏è BUILD FINAL TASK (DB-READY)\n  // ===============================================\n  \n  // Generate unique task ID\n  const taskId = `task_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n  \n  // Calculate deadline\n  const deadlineHours = parseInt(taskData.deadline_hours) || 24;\n  const deadline = new Date();\n  deadline.setHours(deadline.getHours() + deadlineHours);\n  \n  // Adjust for business hours\n  const hour = deadline.getHours();\n  const day = deadline.getDay();\n  if (hour >= 22 || hour < 8) {\n    deadline.setHours(8, 0, 0, 0);\n    if (hour >= 22) deadline.setDate(deadline.getDate() + 1);\n  }\n  if (day === 0) deadline.setDate(deadline.getDate() + 1);\n  if (day === 6) deadline.setDate(deadline.getDate() + 2);\n  \n  // Final task object for Supabase\n  const finalTask = {\n    // Required DB fields\n    id: taskId,\n    created_at: new Date().toISOString(),\n    updated_at: new Date().toISOString(),\n    \n    // Task info - ora mappato correttamente\n    title: taskData.title || ''Task automatico'',\n    description: taskData.description || ''Task generato automaticamente'',\n    priority: taskData.priority || ''medium'',\n    status: ''pending'',\n    action_type: taskData.action_type || ''follow_up'',\n    deadline: deadline.toISOString(),\n    \n    // Customer info\n    customer_email: customerData.customer_email || ''unknown@email.com'',\n    customer_name: customerData.customer_name || null,\n    order_id: customerData.order_id || null,\n    email_subject: taskData.customer_context?.subject || customerData.email_subject || '''',\n    \n    // Conversation context (JSONB field) - struttura corretta\n    conversation_context: {\n      customer_message: customerData.customer_message || '''',\n      ai_response: customerData.ai_response || '''',\n      thread_history: customerData.thread_history || '''',\n      is_thread_reply: customerData.is_thread_reply || false,\n      interaction_type: customerData.interaction_type || ''unknown'',\n      \n      analysis: {\n        confidence: analysisData.confidence,\n        customer_satisfaction: analysisData.customer_satisfaction,\n        customer_sentiment: analysisData.customer_sentiment,\n        ai_promises: analysisData.ai_promises,\n        required_actions: analysisData.required_actions,\n        gap_identified: analysisData.gap_identified,\n        urgency_level: analysisData.urgency_level\n      },\n      \n      task_generation: {\n        ai_commitments: taskData.ai_commitments || [],\n        execution_steps: taskData.execution_steps || [],\n        success_criteria: taskData.success_criteria || '''',\n        escalation_trigger: taskData.escalation_trigger || '''',\n        confidence_level: taskData.confidence_level || 70,\n        validation_required: taskData.validation_required || false,\n        issue_summary: taskData.customer_context?.issue_summary || ''''\n      }\n    },\n    \n    // Workflow fields\n    source: ''smart_analyzer'',\n    assigned_to: null,\n    notes: taskData.notes || '''',\n    \n    // Notification flags - corretto per high priority\n    urgent_notification: taskData.priority === ''critical'' || taskData.priority === ''high'',\n    telegram_sent: false,\n    whatsapp_sent: false,\n    email_sent: false,\n    calendar_created: false\n  };\n  \n  // ===============================================\n  // üìä FINAL LOGGING\n  // ===============================================\n  \n  const processingTime = Date.now() - startTime;\n  console.log(''üéâ TASK CREATION COMPLETED'');\n  console.log(''='' .repeat(40));\n  console.log(''üÜî Task ID:'', finalTask.id);\n  console.log(''üë§ Customer:'', finalTask.customer_email);\n  console.log(''üì¶ Order:'', finalTask.order_id);\n  console.log(''‚ö° Priority:'', finalTask.priority);\n  console.log(''üéØ Action:'', finalTask.action_type);\n  console.log(''üîî Urgent:'', finalTask.urgent_notification);\n  console.log(''üìä Confidence:'', finalTask.conversation_context.analysis.confidence);\n  console.log(''‚è±Ô∏è Processing:'', processingTime + ''ms'');\n  console.log(''='' .repeat(40));\n  \n  return [{ json: finalTask }];\n  \n} catch (error) {\n  console.error(''üí• ERROR in Task Enricher:'', error.message);\n  console.error(''Stack:'', error.stack);\n  \n  // Emergency fallback con pi√π dettagli\n  const emergencyTask = {\n    id: `emergency_${Date.now()}`,\n    created_at: new Date().toISOString(),\n    updated_at: new Date().toISOString(),\n    title: ''ERRORE - Revisione richiesta'',\n    description: `Errore nel Task Enricher: ${error.message}`,\n    priority: ''critical'',\n    status: ''pending'',\n    action_type: ''escalation'',\n    deadline: new Date(Date.now() + 2 * 60 * 60 * 1000).toISOString(),\n    customer_email: $json?.customer_email || ''system@error.com'',\n    customer_name: $json?.customer_name || null,\n    order_id: $json?.order_id || null,\n    email_subject: ''Sistema Error'',\n    conversation_context: {\n      analysis: { confidence: 0 },\n      processing: { \n        error: error.message,\n        stack: error.stack,\n        input_data: JSON.stringify($json).substring(0, 500),\n        timestamp: new Date().toISOString()\n      }\n    },\n    source: ''emergency_fallback'',\n    assigned_to: null,\n    notes: `ERRORE: ${error.message}`,\n    urgent_notification: true,\n    telegram_sent: false,\n    whatsapp_sent: false,\n    email_sent: false,\n    calendar_created: false\n  };\n  \n  return [{ json: emergencyTask }];\n}"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-144,-656],"id":"e71f6dc7-1ef1-4141-b7f5-45268777ca57","name":"Task Enricher","notes":"// üèóÔ∏è TASK ENRICHER v6.0 - Ultra Simplified for Merge\n// Usa solo i dati essenziali dal merge per creare il task DB-ready\n\nconsole.log(''üèóÔ∏è === TASK ENRICHER v6.0 - ULTRA SIMPLIFIED ==='');\nconst startTime = Date.now();\n\ntry {\n  // ===============================================\n  // üì• ESTRAZIONE DATI DAL MERGE (3 INPUT)\n  // ===============================================\n  \n  const allInputs = $input.all();\n  console.log(`üì• Received ${allInputs.length} inputs from merge`);\n  \n  // Input 1: Customer Data (Data Mapper)\n  const customerData = allInputs[0]?.json || {};\n  \n  // Input 2: Analysis Data (Conversation Analyzer)  \n  const analysisRaw = allInputs[1]?.json?.text || ''{}'';\n  let analysisData = {};\n  try {\n    analysisData = JSON.parse(analysisRaw);\n  } catch (e) {\n    console.warn(''‚ö†Ô∏è Analysis parsing failed, using defaults'');\n    analysisData = { confidence: 50, gap_identified: false };\n  }\n  \n  // Input 3: Task Data (Enhanced Task Generator)\n  const taskRaw = allInputs[2]?.json?.text || ''{}'';\n  let taskData = {};\n  try {\n    taskData = JSON.parse(taskRaw);\n  } catch (e) {\n    console.warn(''‚ö†Ô∏è Task parsing failed, using defaults'');\n    taskData = { title: ''Task automatico'', priority: ''medium'' };\n  }\n  \n  console.log(''‚úÖ Data extracted successfully:'');\n  console.log(`- Customer: ${customerData.customer_email}`);\n  console.log(`- Order ID: ${customerData.order_id}`);\n  console.log(`- Analysis confidence: ${analysisData.confidence}`);\n  console.log(`- Task title: ${taskData.title}`);\n  \n  // ===============================================\n  // üèóÔ∏è BUILD FINAL TASK (DB-READY)\n  // ===============================================\n  \n  // Generate unique task ID\n  const taskId = `task_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`;\n  \n  // Calculate deadline\n  const deadlineHours = parseInt(taskData.deadline_hours) || 24;\n  const deadline = new Date();\n  deadline.setHours(deadline.getHours() + deadlineHours);\n  \n  // Adjust for business hours\n  const hour = deadline.getHours();\n  const day = deadline.getDay();\n  if (hour >= 22 || hour < 8) {\n    deadline.setHours(8, 0, 0, 0);\n    if (hour >= 22) deadline.setDate(deadline.getDate() + 1);\n  }\n  if (day === 0) deadline.setDate(deadline.getDate() + 1);\n  if (day === 6) deadline.setDate(deadline.getDate() + 2);\n  \n  // Final task object for Supabase\n  const finalTask = {\n    // Required DB fields\n    id: taskId,\n    created_at: new Date().toISOString(),\n    updated_at: new Date().toISOString(),\n    \n    // Task info\n    title: taskData.title || ''Task automatico'',\n    description: taskData.description || ''Task generato automaticamente'',\n    priority: taskData.priority || ''medium'',\n    status: ''pending'',\n    action_type: taskData.action_type || ''follow_up'',\n    deadline: deadline.toISOString(),\n    \n    // Customer info\n    customer_email: customerData.customer_email || ''unknown@email.com'',\n    customer_name: customerData.customer_name || null,\n    order_id: customerData.order_id || null,\n    email_subject: customerData.email_subject || '''',\n    \n    // Conversation context (JSONB field)\n    conversation_context: {\n      customer_message: customerData.customer_message || '''',\n      ai_response: customerData.ai_response || '''',\n      thread_history: customerData.thread_history || '''',\n      is_thread_reply: customerData.is_thread_reply || false,\n      interaction_type: customerData.interaction_type || ''unknown'',\n      \n      analysis: {\n        confidence: parseInt(analysisData.confidence) || 50,\n        customer_satisfaction: analysisData.customer_satisfaction || ''neutral'',\n        customer_sentiment: analysisData.customer_sentiment || ''neutrale'',\n        ai_promises: analysisData.ai_promises || [],\n        required_actions: analysisData.required_actions || [],\n        gap_identified: Boolean(analysisData.gap_identified),\n        urgency_level: analysisData.urgency_level || ''medium''\n      },\n      \n      task_generation: {\n        ai_commitments: taskData.ai_commitments || [],\n        execution_steps: taskData.execution_steps || [],\n        success_criteria: taskData.success_criteria || '''',\n        escalation_trigger: taskData.escalation_trigger || '''',\n        confidence_level: parseInt(taskData.confidence_level) || 50,\n        validation_required: Boolean(taskData.validation_required)\n      }\n    },\n    \n    // Workflow fields\n    source: ''smart_analyzer'',\n    assigned_to: null,\n    notes: taskData.notes || '''',\n    \n    // Notification flags\n    urgent_notification: taskData.priority === ''critical'' || taskData.priority === ''high'',\n    telegram_sent: false,\n    whatsapp_sent: false,\n    email_sent: false,\n    calendar_created: false\n  };\n  \n  // ===============================================\n  // üìä FINAL LOGGING\n  // ===============================================\n  \n  const processingTime = Date.now() - startTime;\n  console.log(''üéâ TASK CREATION COMPLETED'');\n  console.log(''='' .repeat(40));\n  console.log(''üÜî Task ID:'', finalTask.id);\n  console.log(''üë§ Customer:'', finalTask.customer_email);\n  console.log(''üì¶ Order:'', finalTask.order_id);\n  console.log(''‚ö° Priority:'', finalTask.priority);\n  console.log(''üéØ Action:'', finalTask.action_type);\n  console.log(''üîî Urgent:'', finalTask.urgent_notification);\n  console.log(''üìä Confidence:'', finalTask.conversation_context.analysis.confidence);\n  console.log(''‚è±Ô∏è Processing:'', processingTime + ''ms'');\n  console.log(''='' .repeat(40));\n  \n  return [{ json: finalTask }];\n  \n} catch (error) {\n  console.error(''üí• ERROR in Task Enricher:'', error.message);\n  \n  // Emergency fallback\n  const emergencyTask = {\n    id: `emergency_${Date.now()}`,\n    created_at: new Date().toISOString(),\n    updated_at: new Date().toISOString(),\n    title: ''ERRORE - Revisione richiesta'',\n    description: `Errore nel Task Enricher: ${error.message}`,\n    priority: ''critical'',\n    status: ''pending'',\n    action_type: ''escalation'',\n    deadline: new Date(Date.now() + 2 * 60 * 60 * 1000).toISOString(),\n    customer_email: ''system@error.com'',\n    customer_name: null,\n    order_id: null,\n    email_subject: ''Sistema Error'',\n    conversation_context: {\n      analysis: { confidence: 0 },\n      processing: { \n        error: error.message,\n        timestamp: new Date().toISOString()\n      }\n    },\n    source: ''emergency_fallback'',\n    assigned_to: null,\n    notes: `ERRORE: ${error.message}`,\n    urgent_notification: true,\n    telegram_sent: false,\n    whatsapp_sent: false,\n    email_sent: false,\n    calendar_created: false\n  };\n  \n  return [{ json: emergencyTask }];\n}"}]', '{"üß† Conversation Analyzer LLM":{"ai_languageModel":[[]]},"üîß JSON Extractor & Validator":{"main":[[]]},"‚ùì Should Create Task?":{"main":[[{"node":"Task Generator","type":"main","index":0}],[{"node":"No Task Logging","type":"main","index":0}]]},"‚öôÔ∏è Enhanced Task Generator LLM":{"ai_languageModel":[[]]},"DATA NODE COLLECTOR":{"main":[[{"node":"Task Enricher","type":"main","index":0}]]},"Normalize Supabase data":{"main":[[{"node":"Record Exists?","type":"main","index":0}]]},"Workflow Trigger":{"main":[[{"node":"Data Mapper","type":"main","index":0}]]},"Google Gemini Chat Model":{"ai_languageModel":[[{"node":"Conversation Analyzer","type":"ai_languageModel","index":0}]]},"Google Gemini Chat Model1":{"ai_languageModel":[[{"node":"Task Generator","type":"ai_languageModel","index":0}]]},"Structured Output Parser":{"ai_outputParser":[[{"node":"Conversation Analyzer","type":"ai_outputParser","index":0}]]},"Conversation Analyzer":{"main":[[{"node":"‚ùì Should Create Task?","type":"main","index":0}]]},"Structured Output Parser1":{"ai_outputParser":[[{"node":"Task Generator","type":"ai_outputParser","index":0}]]},"Task Generator":{"main":[[{"node":"DATA NODE COLLECTOR","type":"main","index":0}]]},"Supabase Task Insert":{"main":[[{"node":"Urgency Check","type":"main","index":0}]]},"No Task Logging":{"main":[[{"node":"Event Logger Prep","type":"main","index":0}]]},"Check Today Record":{"main":[[{"node":"Normalize Supabase data","type":"main","index":0}]]},"Record Exists?":{"main":[[{"node":"Update Existing","type":"main","index":0}],[]]},"Update Existing":{"main":[[]]},"Supabase Update":{"main":[[]]},"Supabase Insert":{"main":[[]]},"Data Mapper":{"main":[[{"node":"Conversation Analyzer","type":"main","index":0}]]},"Urgency Check":{"main":[[{"node":"Telegram Critical Alert","type":"main","index":0}]]},"Event Logger Prep":{"main":[[{"node":"Supabase Insert","type":"main","index":0}]]},"Telegram Critical Alert":{"main":[[{"node":"Event Logger Prep","type":"main","index":0}]]},"Task Enricher":{"main":[[{"node":"Supabase Task Insert","type":"main","index":0}]]}}', '{"executionOrder":"v1"}', NULL, '{}', 'd017917a-e4cf-42c7-99e7-5c279164ddc6', 0, '{"templateCredsSetupCompleted":true}', NULL, '2025-06-04T12:22:10.064Z', '2025-09-10T15:26:09.000Z', false),
  ('ae6a5952-36a0-419d-b697-17cf7bf31061', 'Daily Summary Reporter -MIlena mail', true, '[{"parameters":{"triggerTimes":{"item":[{"mode":"custom","cronExpression":"0 8,21 * * *"}]}},"id":"dee014ed-4dc3-4b8a-88fd-d4fc8835100f","name":"Schedule","type":"n8n-nodes-base.cron","typeVersion":1,"position":[-928,-64]},{"parameters":{"functionCode":"// üìä REPORT GIORNALIERO v2.0 - BASATO SU TASK_EVENTS\nconst events = $items(\"TASK\").map(i => i.json);\nconst emails = $items(\"MAIL\").map(i => i.json);\n\n// Calcola metriche dai nuovi eventi\nconst now = new Date();\nconst today = now.toLocaleDateString(''it-IT'');\n\n// === METRICHE PRINCIPALI ===\nconst totalEvents = events.length;\nconst tasksCreated = events.filter(e => e.task_created).length;\nconst uniqueCustomers = [...new Set(events.map(e => e.customer_email).filter(Boolean))];\nconst highPriorityTasks = events.filter(e => e.task_priority === ''critical'' || e.task_priority === ''high'').length;\n\n// === ANALISI SENTIMENT ===\nconst sentimentCounts = events.reduce((acc, e) => {\n  const sentiment = e.dashboard_metrics?.customer_satisfaction || ''neutral'';\n  acc[sentiment] = (acc[sentiment] || 0) + 1;\n  return acc;\n}, {});\n\n// === ANALISI RISCHIO ===\nconst highRiskEvents = events.filter(e => {\n  const riskScore = parseInt(e.dashboard_metrics?.risk_score || 0);\n  return riskScore > 50;\n});\n\n// === ANALISI PER TIPO AZIONE ===\nconst actionTypes = events.reduce((acc, e) => {\n  const action = e.dashboard_metrics?.action_type || ''unknown'';\n  acc[action] = (acc[action] || 0) + 1;\n  return acc;\n}, {});\n\n// === PERFORMANCE AI ===\nconst avgConfidence = events.reduce((sum, e) => {\n  return sum + (parseInt(e.dashboard_metrics?.confidence_score || 0));\n}, 0) / (events.length || 1);\n\nconst gapsDetected = events.filter(e => e.dashboard_metrics?.gap_identified).length;\n\n// === COSTRUZIONE REPORT ===\nlet text = `\nüìä **REPORT OPERATIVO - ${today}**\n\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\nüéØ **OVERVIEW GIORNALIERO**\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n\nüìß Email processate: ${emails.length}\nü§ñ Eventi AI tracciati: ${totalEvents}\nüìã Task creati: ${tasksCreated}\nüë• Clienti unici: ${uniqueCustomers.length}\n\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n‚ö° **METRICHE CRITICHE**\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n\nüö® Task alta priorit√†: ${highPriorityTasks}\n‚ö†Ô∏è GAP operativi rilevati: ${gapsDetected}\nüî• Eventi ad alto rischio: ${highRiskEvents.length}\nüéØ Confidence AI media: ${avgConfidence.toFixed(1)}%\n\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\nüòä **SENTIMENT CLIENTI**\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n`;\n\n// Aggiungi sentiment con emoji\nconst sentimentEmojis = {\n  ''angry'': ''üò°'',\n  ''frustrated'': ''üò§'',\n  ''neutral'': ''üòê'',\n  ''satisfied'': ''üòä''\n};\n\nObject.entries(sentimentCounts).forEach(([sentiment, count]) => {\n  const emoji = sentimentEmojis[sentiment] || ''‚ùì'';\n  const percentage = ((count / totalEvents) * 100).toFixed(1);\n  text += `${emoji} ${sentiment.charAt(0).toUpperCase() + sentiment.slice(1)}: ${count} (${percentage}%)\\n`;\n});\n\n// === DISTRIBUZIONE AZIONI ===\ntext += `\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\nüìå **TIPOLOGIA RICHIESTE**\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n`;\n\nObject.entries(actionTypes)\n  .sort((a, b) => b[1] - a[1])\n  .forEach(([action, count]) => {\n    const percentage = ((count / totalEvents) * 100).toFixed(1);\n    text += `‚Ä¢ ${action}: ${count} (${percentage}%)\\n`;\n  });\n\n// === CLIENTI A RISCHIO ===\nif (highRiskEvents.length > 0) {\n  text += `\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\nüö® **CLIENTI A RISCHIO**\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n`;\n  \n  const riskCustomers = {};\n  highRiskEvents.forEach(e => {\n    const email = e.customer_email || ''Unknown'';\n    const risk = e.dashboard_metrics?.risk_score || 0;\n    if (!riskCustomers[email] || riskCustomers[email] < risk) {\n      riskCustomers[email] = risk;\n    }\n  });\n  \n  Object.entries(riskCustomers)\n    .sort((a, b) => b[1] - a[1])\n    .slice(0, 5)\n    .forEach(([email, risk]) => {\n      text += `‚ö†Ô∏è ${email} (Risk: ${risk})\\n`;\n    });\n}\n\n// === TASK URGENTI APERTI ===\nconst urgentTasks = events.filter(e => \n  e.task_created && \n  (e.task_priority === ''critical'' || e.task_priority === ''high'')\n).slice(0, 5);\n\nif (urgentTasks.length > 0) {\n  text += `\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\nüî¥ **TASK URGENTI CREATI**\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n`;\n  \n  urgentTasks.forEach((t, i) => {\n    const title = t.task_title || ''N/A'';\n    const customer = t.customer_email || ''Unknown'';\n    const priority = t.task_priority?.toUpperCase() || ''N/A'';\n    text += `${i + 1}. [${priority}] ${title}\\n   üë§ ${customer}\\n`;\n  });\n}\n\n// === PERFORMANCE ORARIA ===\nconst hourlyStats = events.reduce((acc, e) => {\n  const hour = e.event_hour;\n  acc[hour] = (acc[hour] || 0) + 1;\n  return acc;\n}, {});\n\nconst peakHour = Object.entries(hourlyStats)\n  .sort((a, b) => b[1] - a[1])[0];\n\nif (peakHour) {\n  text += `\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\nüìà **ANALISI TEMPORALE**\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n\nüïê Ora di punta: ${peakHour[0]}:00 (${peakHour[1]} eventi)\nüìä Distribuzione oraria:\n`;\n  \n  // Mini grafico ASCII\n  const maxEvents = Math.max(...Object.values(hourlyStats));\n  for (let h = 8; h <= 20; h++) {\n    const count = hourlyStats[h] || 0;\n    const bars = ''‚ñà''.repeat(Math.round((count / maxEvents) * 10));\n    text += `${h.toString().padStart(2, ''0'')}:00 ${bars} ${count}\\n`;\n  }\n}\n\n// === FOOTER ===\ntext += `\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ\n‚è∞ Report generato: ${now.toLocaleTimeString(''it-IT'')}\nüìÖ Periodo: ultime 24 ore\nü§ñ Sistema: GommeGo AI v2.0\n‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ`;\n\nreturn [{\n  json: {\n    report: text.trim(),\n    date: today,\n    metrics: {\n      total_events: totalEvents,\n      tasks_created: tasksCreated,\n      unique_customers: uniqueCustomers.length,\n      high_priority: highPriorityTasks,\n      gaps_detected: gapsDetected,\n      avg_confidence: avgConfidence,\n      sentiment_breakdown: sentimentCounts,\n      action_types: actionTypes\n    }\n  }\n}];\n"},"id":"9b3674c3-4a07-4f2d-b91e-cd956746dbfc","name":"Aggregate Report","type":"n8n-nodes-base.function","typeVersion":1,"position":[-160,-96],"notes":"show-3"},{"parameters":{"operation":"getAll","tableId":"task_events","limit":null,"filters":{"conditions":[{"keyName":"event_timestamp","condition":"gt","keyValue":"={{ new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString() }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-640,32],"id":"79552513-483b-4fb3-afdc-86c8e1e90eee","name":"TASK","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"U18uJwD80Uq036TV","name":"Supabase tiziano.annicchiarico@gmail.com"}},"notes":"show-2"},{"parameters":{"operation":"getAll","tableId":"email_processing_log","returnAll":true,"filters":{"conditions":[{"keyName":"created_at","condition":"gt","keyValue":"={{ new Date(Date.now() - 5 * 24 * 60 * 60 * 1000).toISOString() }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-640,-160],"id":"9fc8f1f1-3e8c-45ad-86f5-c964f678a223","name":"MAIL","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"U18uJwD80Uq036TV","name":"Supabase tiziano.annicchiarico@gmail.com"}},"notes":"show-1"},{"parameters":{"mode":"combine","combineBy":"combineByPosition","options":{}},"type":"n8n-nodes-base.merge","typeVersion":3.1,"position":[-368,-96],"id":"de6e7a08-c254-406b-b852-063b392ccbfb","name":"Merge"},{"parameters":{"toRecipients":"supplies@tecsolutions.app","subject":"={{ ''üì¨ Summary Report AI ‚Äì '' + $json.date }}","bodyContent":"={{ $json.report }}","additionalFields":{}},"type":"n8n-nodes-base.microsoftOutlook","typeVersion":2,"position":[144,-224],"id":"bec4b989-7761-428a-8f98-31726a668da2","name":"Send Report","webhookId":"3a31c1c9-6763-4aa2-9a7a-b1b2f93ccba8","credentials":{"microsoftOutlookOAuth2Api":{"id":"EySZIVRGzocRrEOf","name":"Outlook Info GommeGo"}},"notes":"show-4"},{"parameters":{"chatId":"-1002673812914","text":"={{ $json.report }}","additionalFields":{"appendAttribution":false,"parse_mode":"Markdown"}},"id":"f2e52562-6356-4659-8576-cc5beb5830ff","name":"Telegram Report","type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[144,32],"webhookId":"bb858f02-80fa-4afa-9527-22c99c3c7b5f","credentials":{"telegramApi":{"id":"dbGXwcFAw4mNHLio","name":"GommeGoBot"}},"notes":"show-5"}]', '{"Schedule":{"main":[[{"node":"MAIL","type":"main","index":0},{"node":"TASK","type":"main","index":0}]]},"Aggregate Report":{"main":[[{"node":"Send Report","type":"main","index":0},{"node":"Telegram Report","type":"main","index":0}]]},"TASK":{"main":[[{"node":"Merge","type":"main","index":1}]]},"MAIL":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Merge":{"main":[[{"node":"Aggregate Report","type":"main","index":0}]]}}', '{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner"}', NULL, '{}', '6e765a12-f905-4e5a-9cfd-c1dc0692feb4', 1, '{"templateCredsSetupCompleted":true}', NULL, '2025-06-04T13:15:22.998Z', '2025-08-14T12:14:30.000Z', false),
  ('d7c4b9c9-6755-41f1-bbe7-c3d1b229baca', 'ERROR-HANDLING', false, '[{"parameters":{"assignments":{"assignments":[{"id":"db0cb791-2bee-4cbd-8779-7f86c821273a","name":"timestamp","value":"={{ $now }}","type":"string"},{"id":"9777ff8e-d790-453e-9c79-96d10f49bceb","name":"=notified","value":"false","type":"string"},{"id":"1c97423f-5518-4e2e-9ee3-290afe91f8af","name":"severity","value":"medium","type":"string"},{"id":"ca1dcbee-aa8c-4443-9aed-fdd25fc82af3","name":"context","value":"={{ $json }}","type":"string"},{"id":"78b1d6ff-d461-44f7-8eb9-4080aa95050a","name":"execution.id","value":"={{ $json.execution.id }}","type":"number"},{"id":"289a423c-7a7d-43d7-b28f-b77087707209","name":"execution.url","value":"={{ $json.execution.url }}","type":"string"},{"id":"e7acd496-30b8-4dd4-b78c-4554b25cffde","name":"execution.retryOf","value":"={{ $json.execution.retryOf }}","type":"string"},{"id":"05d57be6-5b3b-49f2-88e8-979a645e92a2","name":"execution.error.message","value":"={{ $json.execution.error.message }}","type":"string"},{"id":"b9032cb8-acc5-4e93-a7ac-92dd462a6722","name":"execution.error.stack","value":"={{ $json.execution.error.stack }}","type":"string"},{"id":"21e9a46a-abe9-41fe-898b-5b32c97d67af","name":"execution.lastNodeExecuted","value":"={{ $json.execution.lastNodeExecuted }}","type":"string"},{"id":"47cbb2a9-c371-4e46-a01c-6267669fc9ed","name":"execution.mode","value":"={{ $json.execution.mode }}","type":"string"},{"id":"c6a38ccc-f908-4d21-b248-7adba9c8191d","name":"workflow.id","value":"={{ $json.workflow.id }}","type":"string"},{"id":"df1bbc3e-cdcf-45fc-b2e3-8263c52fcc43","name":"workflow.name","value":"={{ $json.workflow.name }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-1080,-80],"id":"9c734ac9-5904-49c0-852e-b270a619ccba","name":"Mappa Campi"},{"parameters":{"tableId":"errors","fieldsUi":{"fieldValues":[{"fieldId":"workflow_name","fieldValue":"={{ $json.workflow.name }}"},{"fieldId":"workflow_id","fieldValue":"={{ $json.workflow.id }}"},{"fieldId":"node_name","fieldValue":"={{ $json.execution.lastNodeExecuted }}"},{"fieldId":"execution_id","fieldValue":"={{ $json.execution.id }}"},{"fieldId":"execution_url","fieldValue":"={{ $json.execution.url }}"},{"fieldId":"error_message","fieldValue":"={{ $json.execution.error.message }}"},{"fieldId":"error_stack","fieldValue":"={{ $json.execution.error.stack }}"},{"fieldId":"timestamp","fieldValue":"={{ $json.timestamp }}"},{"fieldId":"notified","fieldValue":"={{ $json.notified }}"},{"fieldId":"severity","fieldValue":"={{ $json.severity }}"},{"fieldId":"context","fieldValue":"={{ $json.context }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-940,-80],"id":"4325037a-4a8f-4493-8ca3-ac785e205f75","name":"Scrive In DB ","credentials":{"supabaseApi":{"id":"jJWkqm9L91vHyDLJ","name":"Supabase  ERROR_HANDLING"}}},{"parameters":{},"type":"n8n-nodes-base.errorTrigger","typeVersion":1,"position":[-1260,-80],"id":"a522b2d7-4ed0-4e95-a3a6-8a1d756d5dad","name":"Error Trigger"},{"parameters":{"path":"b82db072-e62e-42ac-9900-3aff19126e6b","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2,"position":[-1300,-300],"id":"9b62b07a-d8bd-4e5d-91a5-63ce60731882","name":"Webhook","webhookId":"b82db072-e62e-42ac-9900-3aff19126e6b"}]', '{"Mappa Campi":{"main":[[{"node":"Scrive In DB ","type":"main","index":0}]]},"Error Trigger":{"main":[[{"node":"Mappa Campi","type":"main","index":0}]]}}', '{"executionOrder":"v1"}', NULL, '{}', '96dd4d06-fa35-4908-858e-b700202d9174', 1, '{"templateCredsSetupCompleted":true}', NULL, '2025-06-10T15:35:32.542Z', '2025-06-13T22:28:00.000Z', true),
  ('0227e93f-8f3b-45c8-8bfc-3c8c79ad191c', 'OCR Image', false, '[{"parameters":{"resource":"image","operation":"analyze","modelId":{"__rl":true,"value":"chatgpt-4o-latest","mode":"list","cachedResultName":"CHATGPT-4O-LATEST"},"text":"Estrai tutto il testo dell''immagine in italiano e restituisci solo risultato senza commenti","inputType":"base64","options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[-960,0],"id":"e9bd7474-85f2-4240-b064-385c9c0c8587","name":"Estrai Testo","credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"path":"137ca002-b213-449c-9d68-e1be141ea04c","formTitle":"Estrazione Dati Documento OCR","formDescription":"Carica la tua carta d''identit√† o patente","formFields":{"values":[{"fieldLabel":"Carica il tuo documento (Carta d''identit√† o Patente)","fieldType":"file","acceptFileTypes":".jpg,.jpeg,.png,.pdf","requiredField":true}]},"options":{}},"id":"dc5c151e-4790-4f18-b835-180edb7bc228","name":"Form Caricamento Documento","type":"n8n-nodes-base.formTrigger","typeVersion":2.1,"position":[-1344,0],"webhookId":"137ca002-b213-449c-9d68-e1be141ea04c","notes":"Punto di ingresso: form per caricamento documenti. Accetta immagini JPG/PNG e PDF. Validazione automatica formato file."},{"parameters":{"jsCode":"try {\n  // Ottieni i dati JSON del form\n  const formData = $input.first().json;\n  \n  // Il campo del file dal form\n  const fileField = formData[\"Carica il tuo documento (Carta d''identit√† o Patente)\"];\n  \n  if (!fileField || !Array.isArray(fileField) || fileField.length === 0) {\n    throw new Error(''Nessun file caricato nel form'');\n  }\n  \n  // Prendi il primo file\n  const fileInfo = fileField[0];\n  \n  // IMPORTANTE: n8n converte i nomi dei campi binari sostituendo caratteri speciali\n  // Il nome reale del campo binario √® quello che vediamo nel debug\n  const binaryPropertyName = \"Carica_il_tuo_documento__Carta_d_identit__o_Patente_\";\n  \n  // Accedi ai dati binari\n  const binaryData = $input.first().binary;\n  \n  if (!binaryData || !binaryData[binaryPropertyName]) {\n    throw new Error(`Dati binari non trovati con chiave: ${binaryPropertyName}`);\n  }\n  \n  // Ottieni i dati binari specifici\n  const fileBinaryData = binaryData[binaryPropertyName];\n  \n  // Estrai informazioni\n  const fileName = fileInfo.filename;\n  const mimeType = fileInfo.mimetype;\n  const fileSize = fileInfo.size;\n  \n  // Inizializza i controlli di qualit√†\n  const qualityChecks = {\n    fileSize: { passed: false, message: '''' },\n    fileType: { passed: false, message: '''' },\n    imageQuality: { passed: false, message: '''' }\n  };\n  \n  // 1. CONTROLLO DIMENSIONE FILE (max 10MB)\n  const maxSize = 10 * 1024 * 1024; // 10MB\n  const minSize = 50 * 1024; // 50KB\n  \n  if (fileSize > maxSize) {\n    qualityChecks.fileSize.passed = false;\n    qualityChecks.fileSize.message = `File troppo grande: ${(fileSize/1024/1024).toFixed(2)}MB (max 10MB)`;\n  } else if (fileSize < minSize) {\n    qualityChecks.fileSize.passed = false;\n    qualityChecks.fileSize.message = `File troppo piccolo: ${(fileSize/1024).toFixed(0)}KB (min 50KB)`;\n  } else {\n    qualityChecks.fileSize.passed = true;\n    qualityChecks.fileSize.message = `Dimensione OK: ${(fileSize/1024/1024).toFixed(2)}MB`;\n  }\n  \n  // 2. CONTROLLO TIPO FILE\n  const allowedTypes = [''image/jpeg'', ''image/jpg'', ''image/png'', ''application/pdf''];\n  if (allowedTypes.includes(mimeType)) {\n    qualityChecks.fileType.passed = true;\n    qualityChecks.fileType.message = `Formato supportato: ${mimeType}`;\n  } else {\n    qualityChecks.fileType.passed = false;\n    qualityChecks.fileType.message = `Formato non supportato: ${mimeType}`;\n  }\n  \n  // 3. ANALISI QUALIT√Ä IMMAGINE\n  if (mimeType.startsWith(''image/'')) {\n    const estimatedQuality = fileSize / 1024; // KB\n    \n    if (estimatedQuality < 100) {\n      qualityChecks.imageQuality.passed = false;\n      qualityChecks.imageQuality.message = ''Qualit√† insufficiente - immagine troppo compressa'';\n    } else if (estimatedQuality < 200) {\n      qualityChecks.imageQuality.passed = true;\n      qualityChecks.imageQuality.message = ''Qualit√† accettabile ma non ottimale'';\n    } else {\n      qualityChecks.imageQuality.passed = true;\n      qualityChecks.imageQuality.message = ''Qualit√† ottima per OCR'';\n    }\n  } else if (mimeType === ''application/pdf'') {\n    qualityChecks.imageQuality.passed = true;\n    qualityChecks.imageQuality.message = ''PDF - qualit√† non verificabile'';\n  }\n  \n  // VALUTAZIONE FINALE\n  const allPassed = Object.values(qualityChecks).every(check => check.passed);\n  const validationStatus = allPassed ? ''PASSED'' : ''REJECTED'';\n  \n  // Calcola quality score\n  let qualityScore = 0;\n  if (qualityChecks.fileSize.passed) qualityScore += 33;\n  if (qualityChecks.fileType.passed) qualityScore += 33;\n  if (qualityChecks.imageQuality.passed) qualityScore += 34;\n  \n  // Prepara l''output\n  const result = {\n    json: {\n      validationStatus: validationStatus,\n      passed: allPassed,\n      fileName: fileName,\n      mimeType: mimeType,\n      fileSize: fileSize,\n      fileSizeReadable: `${(fileSize/1024/1024).toFixed(2)}MB`,\n      qualityChecks: qualityChecks,\n      qualityScore: qualityScore,\n      userMessage: allPassed ? \n        ''‚úÖ Documento valido e pronto per elaborazione OCR'' : \n        ''‚ùå Documento non supera i controlli di qualit√†'',\n      validatedAt: new Date().toISOString()\n    }\n  };\n  \n  // Se PASSED, passa i dati binari con il nome corretto\n  if (allPassed) {\n    result.binary = {\n      data: fileBinaryData  // Usa l''oggetto binary del file\n    };\n  }\n  \n  return result;\n  \n} catch (error) {\n  return {\n    json: {\n      validationStatus: ''REJECTED'',\n      passed: false,\n      error: error.message,\n      userMessage: `‚ùå Errore validazione: ${error.message}`,\n      validatedAt: new Date().toISOString()\n    }\n  };\n}"},"id":"3709ef7d-335a-41d6-a6a1-debe83b7e8af","name":"Validazione File","type":"n8n-nodes-base.code","typeVersion":2,"position":[-1136,0],"notes":"Valida il file caricato: controlla formato, dimensione e prepara per upload. Converte da base64 a binary."},{"parameters":{"jsCode":"const raw = $input.first().json.content;\nif (!raw) throw new Error(''Nessun testo OCR rilevato'');\n\nconst text = raw.replace(/\\n/g, '' '').trim();\nconsole.log(''RAW TEXT:'', text);\n\n// funzione helper sicura con log\nfunction get(regex) {\n  const m = text.match(regex);\n  console.log(''Trying regex:'', regex, ''=>'', m);\n  return (m && m[1]) ? m[1].trim() : undefined;\n}\n\nlet output = {};\nconst isPassport = /PASSPORT|PASSPORTE/i.test(text);\nconst isPatente = /PATENTE DI GUIDA/i.test(text);\n\nif (isPassport) {\n  output.tipo_documento = ''Passaporto'';\n  output.numero_documento = get(/Passport\\s*No\\.?\\s*([A-Z0-9]+)/i) ||\n                            get(/([A-Z0-9]{6,9})/);\n  output.cognome = get(/Surname\\s*([A-Z√Ä-√ñ√ú]+)/i);\n  output.nome = get(/Given Names\\s*([A-Z√Ä-√ñ√ú ]+)/i);\n  output.nazionalit√† = get(/Nationality\\s*([A-Z]+)/i);\n  output.data_nascita = get(/Date of Birth\\s*(\\d{1,2}\\s\\w+\\s\\d{4})/i);\n  output.luogo_nascita = get(/Place of Birth\\s*([A-Z√Ä-√ñ√ú ]+)/i);\n  output.sesso = get(/Sex\\s*([MF])/i);\n  output.emissione = get(/Date of Issue\\s*(\\d{1,2}\\s\\w+\\s\\d{4})/i);\n  output.scadenza = get(/Date of Expiry\\s*(\\d{1,2}\\s\\w+\\s\\d{4})/i);\n}\nelse if (isPatente) {\n  output.tipo_documento = ''Patente di Guida'';\n  output.cognome = get(/1\\.\\s*([A-Z√Ä-√ñ√ú''‚Äô]+)/i);\n  output.nome = get(/2\\.\\s*([A-Z√Ä-√ñ√ú''‚Äô]+)/i);\n  output.data_nascita = get(/3\\.\\s*(\\d{2}\\/\\d{2}\\/\\d{2,4})/i);\n  output.luogo_nascita = get(/3\\.\\s*\\d{2}\\/\\d{2}\\/\\d{2,4}\\s+([A-Z√Ä-√ñ√ú ]+\\(\\w{2}\\))/i);\n  output.emissione = get(/4a\\.\\s*(\\d{2}\\/\\d{2}\\/\\d{4})/i);\n  output.scadenza = get(/4b\\.\\s*(\\d{2}\\/\\d{2}\\/\\d{4})/i);\n  output.categoria = get(/4c\\.\\s*([A-Z0-9\\-]+)/i);\n  output.numero_documento = get(/5\\.\\s*([A-Z0-9]+)/i);\n  output.categorie_supplementari = get(/9\\.\\s*([A-Z0-9 ]+)/i);\n}\nelse {\n  output.tipo_documento = ''Carta di Identit√†'';\n  output.cognome = get(/COGNOME\\s*\\/\\s*SURNAME\\s*([A-Z√Ä-√ñ√ú]+)/i);\n  output.nome = get(/NOME\\s*\\/\\s*NAME\\s*([A-Z√Ä-√ñ√ú]+)/i);\n  output.luogo_nascita = get(/DI NASCITA\\s*PLACE AND DATE OF BIRTH\\s*([A-Z√Ä-√ñ√ú ]+\\(\\w+\\))/i);\n  output.data_nascita = get(/(\\d{2}\\.\\d{2}\\.\\d{4})/);\n  output.sesso = get(/SESSO\\s*\\/\\s*SEX\\s*([MF])/i);\n  output.altezza = get(/HEIGHT\\s*([0-9]{2,3})/i);\n  output.numero_documento = get(/[A-Z0-9]{8,}/);\n  output.emissione = get(/EMISSIONE\\s*\\/\\s*ISSUING\\s*(\\d{2}\\.\\d{2}\\.\\d{4})/i);\n  output.scadenza = get(/SCADENZA\\s*\\/\\s*EXPIRY\\s*(\\d{2}\\.\\d{2}\\.\\d{4})/i);\n  output.cittadinanza = get(/CITTADINANZA\\s*\\/\\s*NATIONALITY\\s*([A-Z]+)/i);\n  output.firma = /FIRMA/.test(text);\n}\n\n// rimuovi campi undefined\nObject.keys(output).forEach(k => {\n  if (output[k] == null) delete output[k];\n});\n\nreturn [{ json: output }];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-768,0],"id":"7b51458b-1d98-4db6-acca-231485e105c5","name":"Formatta Dati"}]', '{"Estrai Testo":{"main":[[{"node":"Formatta Dati","type":"main","index":0}]]},"Form Caricamento Documento":{"main":[[{"node":"Validazione File","type":"main","index":0}]]},"Validazione File":{"main":[[{"node":"Estrai Testo","type":"main","index":0}]]}}', '{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner"}', NULL, '{}', 'f31d212e-785e-4875-947f-90a02a8d7832', 1, '{"templateCredsSetupCompleted":true}', NULL, '2025-06-11T19:16:49.380Z', '2025-08-02T22:43:46.000Z', false),
  ('e6483e7c-540b-4f97-8a80-9b9560c4e534', 'Mistral PDF OCR', false, '[{"parameters":{"path":"137ca002-b213-449c-9d68-e1be141ea04c","formTitle":"Estrazione Dati Documento OCR","formDescription":"Carica la tua carta d''identit√† o patente per estrarre automaticamente i dati","formFields":{"values":[{"fieldLabel":"Carica il tuo documento ","fieldType":"file","requiredField":true}]},"options":{"appendAttribution":false}},"id":"7adb7de0-0ae1-4eb7-8590-c8664a1a5793","name":"üìÑ Form Caricamento Documento","type":"n8n-nodes-base.formTrigger","typeVersion":2.1,"position":[-640,-560],"webhookId":"137ca002-b213-449c-9d68-e1be141ea04c","notes":"Punto di ingresso: form per caricamento documenti. Accetta immagini JPG/PNG e PDF. Validazione automatica formato file."},{"parameters":{"method":"POST","url":"https://api.mistral.ai/v1/ocr","authentication":"genericCredentialType","genericAuthType":"httpHeaderAuth","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"Bearer ${MISTRAL_API_KEY}"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"model\": \"mistral-ocr-latest\",\n  \"document\": {\n    \"type\": \"document_url\",\n    \"document_url\": \"{{ $json.url }}\"\n  },\n  \"include_image_base64\": true\n}\n","options":{"response":{"response":{"responseFormat":"text"}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[200,-160],"id":"65787771-d06c-4a2c-8595-37cfb7b0c850","name":"GET OCR RESULT","credentials":{"httpHeaderAuth":{"id":"BYFWsB3xpyV8tLJG","name":"MISTRAL_API"}}},{"parameters":{"url":"=https://api.mistral.ai/v1/files/{{ $json.id }}/url","authentication":"genericCredentialType","genericAuthType":"httpHeaderAuth","sendQuery":true,"queryParameters":{"parameters":[{"name":"expiry","value":"24"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[20,-160],"id":"281c1f5e-62f7-4738-a9ad-fda8e02e5834","name":"GET SIGNED URL","credentials":{"httpHeaderAuth":{"id":"BYFWsB3xpyV8tLJG","name":"MISTRAL_API"}}},{"parameters":{"method":"POST","url":"https://api.mistral.ai/v1/files","authentication":"genericCredentialType","genericAuthType":"httpHeaderAuth","sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"purpose","value":"ocr"},{"parameterType":"formBinaryData","name":"file","inputDataFieldName":"attachment_0"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-180,-160],"id":"ce023627-94b9-448c-b285-6155b36a0576","name":"UPLOAD MISTRAL OCR","credentials":{"mistralCloudApi":{"id":"IwB6SJuDF519gYoE","name":"Mistral Cloud account"},"httpHeaderAuth":{"id":"BYFWsB3xpyV8tLJG","name":"MISTRAL_API"}}},{"parameters":{"resource":"folderMessage","folderId":{"__rl":true,"value":"AAMkADY5YTU5ODIzLTM5M2MtNGU4Zi04YzNmLTBlYmYxNDNhODNjMAAuAAAAAAAty8lTOVoeRrTqgTQml0B1AQAYYLMeDvsGSqoDRrzkfpW2AAA3x-uFAAA=","mode":"list","cachedResultName":"FATTURE","cachedResultUrl":"https://outlook.office365.com/mail/AAMkADY5YTU5ODIzLTM5M2MtNGU4Zi04YzNmLTBlYmYxNDNhODNjMAAuAAAAAAAty8lTOVoeRrTqgTQml0B1AQAYYLMeDvsGSqoDRrzkfpW2AAA3x%2FuFAAA%3D"},"limit":1,"output":"fields","fields":["body","createdDateTime","subject"],"filtersUI":{"values":{"filters":{"readStatus":"unread"}}},"options":{"downloadAttachments":true}},"type":"n8n-nodes-base.microsoftOutlook","typeVersion":2,"position":[-460,-240],"id":"dd39e092-d6ff-4a3c-97d8-c66d99d026e1","name":"Microsoft Outlook","webhookId":"dabcf37c-9f56-4fee-8e9b-bcc6d26456df","retryOnFail":true,"credentials":{"microsoftOutlookOAuth2Api":{"id":"gvsjOBgXBwH8vLH8","name":"Outlook Supplies"}}},{"parameters":{"rule":{"interval":[{"field":"minutes","minutesInterval":1}]}},"type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[-700,-220],"id":"88ac026f-73e9-4ae8-8cb0-b0c6ff250d6c","name":"Schedule Trigger"},{"parameters":{"jsCode":"// 1. Decodifica la stringa JSON contenuta nel campo \"data\"\nlet parsed;\n\ntry {\n  parsed = JSON.parse($json.data);\n} catch (e) {\n  throw new Error(\"‚ùå Errore nel parsing JSON da campo ''data'': \" + e.message);\n}\n\n// 2. Estrai markdown da pages[0]\nconst markdown = parsed.pages?.[0]?.markdown || null;\n\nif (!markdown) {\n  throw new Error(\"‚ùå ''pages[0].markdown'' non trovato dopo parsing\");\n}\n\n// 3. Pulisci simboli, markdown, formattazione\nlet cleaned = markdown\n  .replace(/[*#`_]/g, \"\")\n  .replace(/\\|/g, \" \")\n  .replace(/-{2,}/g, \"\")\n  .replace(/\\s{2,}/g, \" \")\n  .split(''\\n'')\n  .map(l => l.trim())\n  .filter(l => l.length > 0)\n  .join(\"\\n\");\n\n// 4. Normalizza numeri\ncleaned = cleaned\n  .replace(/‚Ç¨\\s?/g, \"\")\n  .replace(/\\.(?=\\d{3})/g, \"\")\n  .replace(/,(\\d{2})/g, ''.$1'')\n  .replace(/\\s+%/g, \"%\")\n  .trim();\n\n// 5. Taglia da \"fattura n.\" o \"totale fattura\"\nconst trigger = cleaned.match(/fattura\\s+n[.:]?\\s*\\S+|totale\\s+fattura\\s+\\S+/i);\nif (trigger?.[0]) {\n  const pos = cleaned.indexOf(trigger[0]);\n  if (pos !== -1) {\n    cleaned = cleaned.substring(pos).trim();\n  }\n}\n\n// 6. Output finale\nreturn [{\n  json: {\n    text_agent_ready: cleaned,\n    original_ocr_text: markdown,\n    ocr_model: parsed.model || \"unknown\",\n    pages: parsed.pages?.length || 1\n  }\n}];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[480,-620],"id":"05ae0359-8331-47e9-9fa7-f4df43360a9f","name":"Pre Processind DATA"},{"parameters":{"jsCode":"return [{\n  json: {\n    debugOCR: $json\n  }\n}];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[220,-600],"id":"211525ed-fd36-4b2e-9e3d-79b7e62d8dae","name":"Code"}]', '{"üìÑ Form Caricamento Documento":{"main":[[]]},"GET SIGNED URL":{"main":[[{"node":"GET OCR RESULT","type":"main","index":0}]]},"UPLOAD MISTRAL OCR":{"main":[[{"node":"GET SIGNED URL","type":"main","index":0}]]},"GET OCR RESULT":{"main":[[]]},"Schedule Trigger":{"main":[[{"node":"Microsoft Outlook","type":"main","index":0}]]},"Microsoft Outlook":{"main":[[]]},"Pre Processind DATA":{"main":[[]]}}', '{"executionOrder":"v1"}', NULL, '{}', '29fda480-de21-484a-8689-5815bbd5a65b', 0, '{"templateCredsSetupCompleted":true}', NULL, '2025-06-12T20:41:47.318Z', '2025-06-16T08:00:58.000Z', false),
  ('86a2e81f-39eb-4375-8e7d-3483adffab4d', 'SUB_API_INFO_ORDER_PRESTASHOP', false, '[{"parameters":{"inputSource":"jsonExample","jsonExample":"{\n  \"query\": \"WDSLMTPUF\"\n}"},"name":"When Executed by Another Workflow","type":"n8n-nodes-base.executeWorkflowTrigger","typeVersion":1.1,"position":[840,-385],"id":"616e22b0-0c23-4e45-887d-b35367f15f5d"},{"parameters":{"jsCode":"const raw = $json.query || '''';\nconst cleaned = typeof raw === ''string''\n  ? raw.replace(/[^a-zA-Z0-9]/g, '''').trim()\n  : '''';\nreturn [{ json: { query: cleaned } }];"},"name":"Pulisci codice","type":"n8n-nodes-base.code","typeVersion":2,"position":[1060,-385],"id":"4a0c44ef-d535-4721-b69d-6659c81f7b48"},{"parameters":{"url":"=https://www.gommego.com/api/orders?filter[reference]={{ $json.query }}&display=full&output_format=JSON","authentication":"genericCredentialType","genericAuthType":"httpBasicAuth","sendQuery":true,"queryParameters":{"parameters":[{"name":"limit","value":"1"}]},"options":{}},"name":"Ottieni Ordine","type":"n8n-nodes-base.httpRequest","typeVersion":3,"position":[1280,-385],"id":"2db52bb8-786e-475e-a4b9-abaeea7f6d89","alwaysOutputData":true,"retryOnFail":true,"credentials":{"httpBasicAuth":{"id":"CDYbffajBgDWgdXn","name":"Prestashop-API"}},"onError":"continueRegularOutput"},{"parameters":{"jsCode":"const response = $input.item.json;\nif (!response.orders || response.orders.length === 0) {\n  return [{ json: { orderFound: false, message: ''Nessun ordine trovato'', chatInput: $json.query } }];\n}\nconst order = response.orders[0];\nreturn [{ json: { orderFound: true, orderDetails: order, chatInput: $json.query } }];"},"name":"Verifica Ordine","type":"n8n-nodes-base.code","typeVersion":2,"position":[1500,-485],"id":"ea4f9be8-80be-404f-bbb2-38dabb3630db"},{"parameters":{"options":{}},"name":"Estrai orderDetails","type":"n8n-nodes-base.set","typeVersion":2,"position":[1940,-560],"id":"b2da002c-771d-4b04-8741-04980939bb6d"},{"parameters":{"jsCode":"const order = $json.orderDetails;\nconst id_order = order.id;\nconst id_customer = order.id_customer;\nconst id_address = order.id_address_delivery;\n\nreturn [\n  { json: { type: ''customer'', url: `https://www.gommego.com/api/customers/${id_customer}?output_format=JSON` } },\n  { json: { type: ''address'', url: `https://www.gommego.com/api/addresses/${id_address}?output_format=JSON` } },\n  { json: { type: ''order_histories'', url: `https://www.gommego.com/api/order_histories?filter[id_order]=${id_order}&display=full&output_format=JSON` } }\n];"},"name":"Crea Chiamate","type":"n8n-nodes-base.code","typeVersion":2,"position":[2160,-560],"id":"51fbfecd-28b9-406f-a301-874225ccd376"},{"parameters":{"url":"={{$json.url}}","authentication":"genericCredentialType","genericAuthType":"httpBasicAuth","options":{}},"name":"HTTP x3 dinamico","type":"n8n-nodes-base.httpRequest","typeVersion":3,"position":[2380,-560],"id":"0d9e6c34-c52b-4c98-9f5d-9a37ffc145d3","retryOnFail":true,"credentials":{"httpBasicAuth":{"id":"CDYbffajBgDWgdXn","name":"Prestashop-API"}},"onError":"continueRegularOutput"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"a7d260d7-e0e2-42bc-acf6-18abddaefc1b","leftValue":"={{ $json.orderFound }}","rightValue":"true","operator":{"type":"boolean","operation":"true","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[1720,-485],"id":"3fd9eca4-eb31-4d27-8303-544afee0b6b6","name":"If"},{"parameters":{"functionCode":"// Crea un messaggio di errore personalizzato con struttura standardizzata\nreturn [{\n  json: {\n    // Messaggio principale per il chatbot\n    chatbotResponse: `Mi dispiace, non ho trovato nessun ordine con questo codice. Dovrebbe verificare che il codice sia corretto.`,\n    \n    // Flag di stato\n    orderFound: false,\n    error: true,\n    \n    // Dettagli errore\n    errorMessage: $json[\"message\"] || \"Ordine non trovato\",\n    searchedReference: $json[\"chatInput\"],\n    \n    // Suggerimenti utili per l''utente\n    suggestions: [\n      \"Controlla se hai inserito il codice correttamente\",\n      \"Verifica nella tua email di conferma\"\n    ],\n    \n    // Summary standardizzato (come in Pulisci campi)\n    summary: {\n      order_reference: $json[\"chatInput\"],\n      current_status: \"Non trovato\",\n      tracking_number: null,\n      can_track: false,\n      is_delivered: false,\n      has_issues: false,\n      days_since_order: 0\n    },\n    \n    // Timestamp\n    timestamp: new Date().toISOString()\n  }\n}];"},"id":"0d945c73-45c0-42fb-a6b7-95324fe65d3b","name":"Risposta Ordine Non Trovato","type":"n8n-nodes-base.function","typeVersion":1,"position":[2820,-460],"notes":"// Crea un messaggio di errore personalizzato\nreturn {\n  json: {\n    chatbotResponse: `Mi dispiace, non ho trovato nessun ordine con questo codice. Dovrebbe verificare che il codice sia corretto.`,\n    orderFound: false,\n    errorMessage: $json[\"message\"],\n    \n    // Aggiungi campi utili per il debugging\n    searchedReference: $json[\"chatInput\"],\n    timestamp: new Date().toISOString(),\n    \n    // Aggiungi suggerimenti utili per l''utente\n    suggestions: [\n      \"Controlla se hai inserito il codice correttamente\",\n      \"Verifica nella tua email di conferma\",\n      ]\n  }\n};"},{"parameters":{"assignments":{"assignments":[{"id":"ae019003-40f6-401e-bb24-b082a7c25f79","name":"Order Detail","value":"={{ $(''Estrai orderDetails'').item.json.orderDetails }}","type":"object"}]},"includeOtherFields":true,"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[2600,-660],"id":"6ebb4f04-6eb4-4f68-8b38-b6694e0ef1a3","name":"Unisce i campi di tutti i nodi"},{"parameters":{},"type":"n8n-nodes-base.merge","typeVersion":3.1,"position":[3080,-560],"id":"1fa575dd-6faa-4b18-a64e-07c177af2f65","name":"Merge"},{"parameters":{"jsCode":"// üßπ NODO PULISCI CAMPI - Merge intelligente per chatbot assistenza clienti\n// Estrae e unifica solo i dati essenziali per rispondere ai clienti\n\n// Mappa stati ordine in italiano\nconst stateMap = {\n  \"2\": \"Pagamento accettato\",\n  \"3\": \"Elaborazione\",\n  \"4\": \"Spedizione in preparazione\",\n  \"5\": \"Consegnato\",\n  \"6\": \"Annullato\",\n  \"7\": \"Rimborsato\",\n  \"8\": \"Errore di pagamento\",\n  \"9\": \"In attesa rifornimento\",\n  \"10\": \"Bonifico in attesa\",\n  \"11\": \"Pagamento remoto accettato\",\n  \"14\": \"MultiSafepay Pagamento sospeso\",\n  \"20\": \"Rimborso parziale\",\n  \"23\": \"In attesa di pagamento\",\n  \"24\": \"Rimborso parziale\",\n  \"25\": \"Pagamento parziale\",\n  \"27\": \"Annullato per mancato pagamento\",\n  \"28\": \"In transito\",\n  \"29\": \"Consegnato Parzialmente\",\n  \"30\": \"In attesa emissione buono o rimborso\",\n  \"31\": \"In consegna\",\n  \"32\": \"Richiesta reso\",\n  \"35\": \"Destinatario assente\"\n};\n\ntry {\n  // üì• Raccolta di tutti gli input\n  const allInputs = $input.all();\n  console.log(`üì• Elaborazione di ${allInputs.length} input`);\n  \n  // Oggetto finale pulito per il chatbot\n  const chatbotData = {\n    orderFound: true\n  };\n  \n  // üîÑ Processa ogni input e estrai i dati rilevanti\n  for (const item of allInputs) {\n    const data = item.json;\n    \n    // üì¶ DATI ORDINE (presente in tutti gli oggetti come \"Order Detail\")\n    if (data[\"Order Detail\"] && !chatbotData.order) {\n      const orderDetail = data[\"Order Detail\"];\n      \n      chatbotData.order = {\n        reference: orderDetail.reference,\n        status: stateMap[orderDetail.current_state] || `Stato ${orderDetail.current_state}`,\n        shipping_number: orderDetail.shipping_number || orderDetail.note || \"Non disponibile\", // ESSENZIALE!\n        payment_method: orderDetail.payment,\n        date_created: orderDetail.date_add,\n        date_updated: orderDetail.date_upd,\n        \n        // Totali formattati\n        total_paid: `‚Ç¨ ${parseFloat(orderDetail.total_paid).toFixed(2)}`,\n        total_products: `‚Ç¨ ${parseFloat(orderDetail.total_products).toFixed(2)}`,\n        total_products_with_tax: `‚Ç¨ ${parseFloat(orderDetail.total_products_wt).toFixed(2)}`,\n        \n        // Prodotti ordinati\n        products: []\n      };\n      \n      // Estrai prodotti se presenti\n      if (orderDetail.associations?.order_rows) {\n        chatbotData.order.products = orderDetail.associations.order_rows.map(product => ({\n          name: product.product_name,\n          reference: product.product_reference,\n          ean: product.product_ean13,\n          quantity: parseInt(product.product_quantity),\n          unit_price: `‚Ç¨ ${parseFloat(product.unit_price_tax_incl).toFixed(2)}`,\n          total_price: `‚Ç¨ ${(parseFloat(product.unit_price_tax_incl) * parseInt(product.product_quantity)).toFixed(2)}`\n        }));\n      }\n    }\n    \n    // üë§ DATI CLIENTE\n    if (data.customer && !chatbotData.customer) {\n      const customer = data.customer;\n      \n      chatbotData.customer = {\n        full_name: `${customer.firstname} ${customer.lastname}`,\n        email: customer.email,\n        phone: null, // Lo prenderemo dall''indirizzo\n        is_active: customer.active === \"1\",\n        customer_since: customer.date_add,\n        \n        // Note importanti per l''assistenza\n        notes: customer.note || null\n      };\n      \n      // Estrai eventuali note importanti\n      if (customer.note && customer.note.includes(\"RESO\")) {\n        chatbotData.customer.has_return_request = true;\n      }\n    }\n    \n    // üìç INDIRIZZO DI SPEDIZIONE\n    if (data.address && !chatbotData.delivery) {\n      const address = data.address;\n      \n      chatbotData.delivery = {\n        recipient: `${address.firstname} ${address.lastname}`,\n        street: address.address1,\n        city: address.city,\n        postcode: address.postcode,\n        country: \"Italia\", // Assumendo ID 10 = Italia\n        phone: address.phone || address.phone_mobile || null,\n        fiscal_code: address.dni || null\n      };\n      \n      // Se abbiamo trovato un telefono, aggiungilo anche al cliente\n      if ((address.phone || address.phone_mobile) && chatbotData.customer) {\n        chatbotData.customer.phone = address.phone || address.phone_mobile;\n      }\n    }\n    \n    // üìú STORICO ORDINE\n    if (data.order_histories && !chatbotData.history) {\n      const histories = Array.isArray(data.order_histories) \n        ? data.order_histories \n        : [data.order_histories];\n      \n      // Ordina per data e converti\n      chatbotData.history = histories\n        .sort((a, b) => new Date(a.date_add) - new Date(b.date_add))\n        .map(hist => ({\n          date: hist.date_add,\n          status: stateMap[hist.id_order_state] || `Stato ${hist.id_order_state}`,\n          updated_by: hist.id_employee === \"0\" ? \"Sistema\" : \"Operatore\"\n        }));\n    }\n  }\n  \n  // üéØ RIEPILOGO PER IL CHATBOT\n  if (chatbotData.order) {\n    chatbotData.summary = {\n      order_reference: chatbotData.order.reference,\n      current_status: chatbotData.order.status,\n      tracking_number: chatbotData.order.shipping_number,\n      can_track: chatbotData.order.shipping_number !== \"Non disponibile\",\n      \n      // Info utili per risposte rapide\n      is_delivered: chatbotData.order.status === \"Consegnato\",\n      has_issues: chatbotData.customer?.notes?.includes(\"RESO\") || \n                  chatbotData.customer?.notes?.includes(\"PROBLEMA\") || false,\n      \n      // Tempi di elaborazione\n      days_since_order: Math.floor(\n        (new Date() - new Date(chatbotData.order.date_created)) / (1000 * 60 * 60 * 24)\n      )\n    };\n  }\n  \n  // üìä Log finale\n  console.log(\"‚úÖ Dati pronti per il chatbot:\");\n  console.log(`üì¶ Ordine: ${chatbotData.order?.reference || \"Non trovato\"}`);\n  console.log(`üöö Tracking: ${chatbotData.order?.shipping_number || \"N/A\"}`);\n  console.log(`üë§ Cliente: ${chatbotData.customer?.full_name || \"N/A\"}`);\n  console.log(`üìç Destinazione: ${chatbotData.delivery?.city || \"N/A\"}`);\n  console.log(`üìú Eventi storico: ${chatbotData.history?.length || 0}`);\n  \n  // Restituisci i dati puliti e strutturati\n  return [{ json: chatbotData }];\n  \n} catch (error) {\n  console.error(\"‚ùå Errore durante elaborazione:\", error);\n  \n  return [{\n    json: {\n      orderFound: false,\n      error: true,\n      errorMessage: `Errore durante elaborazione dei dati: ${error.message}`,\n      timestamp: new Date().toISOString()\n    }\n  }];\n}"},"id":"601ca5e2-a7c0-4497-9e20-1a9723713a5e","name":"Clean data x Chatbot","type":"n8n-nodes-base.code","typeVersion":2,"position":[2820,-660],"notes":"const stateMap = {\n  \"2\": \"Pagamento accettato\",\n  \"3\": \"Elaborazione\",\n  \"4\": \"Spedizione in preparazione\",\n  \"5\": \"Consegnato\",\n  \"6\": \"Annullato\",\n  \"7\": \"Rimborsato\",\n  \"8\": \"Errore di pagamento\",\n  \"9\": \"In attesa rifornimento\",\n  \"10\": \"Bonifico in attesa\",\n  \"28\": \"In transito\",\n  \"31\": \"In consegna\",\n  \"32\": \"Richiesta reso\",\n  \"35\": \"Destinatario assente\"\n};\n\nconst results = [];\n\nfor (const item of $input.all()) {\n  const data = item.json;\n  const output = {\n    orderFound: data.orderFound ?? true\n  };\n\n  // ‚úÖ Order info\n  if (data.orderDetails) {\n    const o = data.orderDetails;\n    output.order = {\n      reference: o.reference,\n      status: stateMap[o.current_state] || `Stato ${o.current_state}`,\n      shipping_number: o.shipping_number || o.note,\n      total_paid: o.total_paid,\n      total_products: o.total_products,\n      total_products_wt: o.total_products_wt,\n      date_created: o.date_add,\n      date_updated: o.date_upd,\n      payment: o.payment,\n      note: o.note\n    };\n\n    if (o.associations?.order_rows?.length) {\n      output.order.products = o.associations.order_rows.map(p => ({\n        name: p.product_name,\n        reference: p.product_reference,\n        ean: p.product_ean13,\n        quantity: p.product_quantity,\n        price: p.product_price,\n        total_price_tax_incl: p.unit_price_tax_incl\n      }));\n    }\n  }\n\n  // ‚úÖ Customer\n  if (data.customer) {\n    const c = data.customer;\n    output.customer = {\n      firstname: c.firstname,\n      lastname: c.lastname,\n      email: c.email,\n      note: c.note,\n      is_active: c.active === \"1\"\n    };\n  }\n\n  // ‚úÖ Shipping address\n  if (data.address) {\n    const a = data.address;\n    output.delivery = {\n      address: a.address1,\n      postcode: a.postcode,\n      city: a.city,\n      phone: a.phone || a.phone_mobile || null,\n      country_id: a.id_country\n    };\n  }\n\n  // ‚úÖ Order history\n  if (data.order_histories?.length) {\n    output.history = data.order_histories.map(h => ({\n      date: h.date_add,\n      status: stateMap[h.id_order_state] || `Stato ${h.id_order_state}`,\n      message: h.message\n    }));\n  }\n\n  results.push({ json: output });\n}\n\nreturn results;\n"},{"parameters":{"content":"Chiamata API x3","height":420,"width":440},"type":"n8n-nodes-base.stickyNote","position":[2100,-700],"typeVersion":1,"id":"34d66bde-dc9b-4805-a6b3-a0c118c8d8ba","name":"Sticky Note"}]', '{"When Executed by Another Workflow":{"main":[[{"node":"Pulisci codice","type":"main","index":0}]]},"Pulisci codice":{"main":[[{"node":"Ottieni Ordine","type":"main","index":0}]]},"Ottieni Ordine":{"main":[[{"node":"Verifica Ordine","type":"main","index":0}],[]]},"Verifica Ordine":{"main":[[{"node":"If","type":"main","index":0}]]},"Estrai orderDetails":{"main":[[{"node":"Crea Chiamate","type":"main","index":0}]]},"Crea Chiamate":{"main":[[{"node":"HTTP x3 dinamico","type":"main","index":0}]]},"HTTP x3 dinamico":{"main":[[{"node":"Unisce i campi di tutti i nodi","type":"main","index":0}],[]]},"If":{"main":[[{"node":"Estrai orderDetails","type":"main","index":0}],[{"node":"Risposta Ordine Non Trovato","type":"main","index":0}]]},"Unisce i campi di tutti i nodi":{"main":[[{"node":"Clean data x Chatbot","type":"main","index":0}]]},"Risposta Ordine Non Trovato":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Clean data x Chatbot":{"main":[[{"node":"Merge","type":"main","index":0}]]}}', '{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","errorWorkflow":"1LreJWx0H8iEqkgn"}', NULL, '{}', '5e9e5b79-9f31-40e7-b129-f19738098476', 0, NULL, NULL, '2025-06-13T16:07:25.124Z', '2025-06-18T21:22:29.000Z', false),
  ('ac3d58ab-7790-4d04-b093-81aae4b93de9', 'My workflow 4', false, '[{"parameters":{"triggerTimes":{"item":[{"mode":"custom","cronExpression":"0 8,21 * * *"}]}},"id":"741e8dd8-7e8f-45ef-b2c8-0fe6320e24b3","name":"Schedule","type":"n8n-nodes-base.cron","typeVersion":1,"position":[-940,-140]},{"parameters":{"functionCode":"// üìä REPORT AGGREGATOR \n// Con metriche complete e task urgenti\n\nconst tasks = $items(\"TASK\").map(i => i.json);\nconst emails = $items(\"MAIL\").map(i => i.json);\n\n// ‚è∞ DETERMINA PERIODO REPORT\nconst now = new Date();\nconst currentHour = now.getHours();\nconst isEveningReport = currentHour >= 20;\nconst reportType = isEveningReport ? \"Giornata Completa\" : \"Prima Met√† Giornata\";\n\n// üìà CALCOLA METRICHE AVANZATE\nconst metrics = {\n  totalTasks: tasks.length,\n  completedTasks: tasks.filter(t => t.status === ''completed'').length,\n  pendingTasks: tasks.filter(t => t.status === ''pending'').length,\n  overdueTasks: tasks.filter(t => \n    t.status === ''pending'' && t.deadline && new Date(t.deadline) < now\n  ).length,\n  \n  // Per priorit√†\n  criticalTasks: tasks.filter(t => t.priority === ''critical'').length,\n  highTasks: tasks.filter(t => t.priority === ''high'').length,\n  mediumTasks: tasks.filter(t => t.priority === ''medium'').length,\n  lowTasks: tasks.filter(t => t.priority === ''low'').length,\n  \n  // Gap analysis\n  gapsDetected: tasks.filter(t => \n    t.conversation_context?.analysis?.gap_identified\n  ).length,\n  \n  // Clienti unici\n  uniqueCustomers: [...new Set(tasks.map(t => t.customer_email))].filter(Boolean).length,\n  \n  // Email metrics\n  totalEmails: emails.length,\n  emailsWithAI: emails.filter(e => e.ai_response_sent).length\n};\n\n// üö® TASK URGENTI (solo critici e high pendenti)\nconst urgentPending = tasks\n  .filter(t => [''critical'', ''high''].includes(t.priority) && t.status === ''pending'')\n  .sort((a, b) => new Date(a.deadline || ''2099-01-01'') - new Date(b.deadline || ''2099-01-01''))\n  .slice(0, 5)\n  .map(t => ({\n    priority: t.priority,\n    title: (t.title || ''Senza titolo'').substring(0, 50) + (t.title?.length > 50 ? ''...'' : ''''),\n    customer: t.customer_email || ''N/A'',\n    deadline: t.deadline ? new Date(t.deadline) : null,\n    isOverdue: t.deadline ? new Date(t.deadline) < now : false\n  }));\n\n// üìä BREAKDOWN PER TIPO AZIONE\nconst actionBreakdown = {};\ntasks.forEach(t => {\n  const action = t.action_type || ''unknown'';\n  if (!actionBreakdown[action]) {\n    actionBreakdown[action] = { count: 0, completed: 0 };\n  }\n  actionBreakdown[action].count++;\n  if (t.status === ''completed'') {\n    actionBreakdown[action].completed++;\n  }\n});\n\n// Performance rates\nconst completionRate = Math.round(metrics.completedTasks/metrics.totalTasks*100) || 0;\nconst gapRate = Math.round(metrics.gapsDetected/metrics.totalTasks*100) || 0;\n\n// üì± FORMATO TELEGRAM\nlet telegramText = `üìä **REPORT ${reportType.toUpperCase()}**\\n`;\ntelegramText += `üóìÔ∏è ${now.toLocaleDateString(''it-IT'', { weekday: ''long'', day: ''numeric'', month: ''long'' })}\\n`;\ntelegramText += `‚è∞ Ore: ${now.toLocaleTimeString(''it-IT'', {hour: ''2-digit'', minute:''2-digit''})}\\n\\n`;\n\ntelegramText += `**üìà PANORAMICA**\\n`;\ntelegramText += `‚Ä¢ Task Creati: **${metrics.totalTasks}**\\n`;\ntelegramText += `‚Ä¢ Completati: ‚úÖ ${metrics.completedTasks} (${completionRate}%)\\n`;\ntelegramText += `‚Ä¢ In Attesa: ‚è≥ ${metrics.pendingTasks}\\n`;\ntelegramText += `‚Ä¢ In Ritardo: üö® **${metrics.overdueTasks}**\\n\\n`;\n\ntelegramText += `**üéØ PRIORIT√Ä**\\n`;\ntelegramText += `‚Ä¢ üî¥ Critical: ${metrics.criticalTasks}\\n`;\ntelegramText += `‚Ä¢ üü† High: ${metrics.highTasks}\\n`;\ntelegramText += `‚Ä¢ üü° Medium: ${metrics.mediumTasks}\\n`;\ntelegramText += `‚Ä¢ üü¢ Low: ${metrics.lowTasks}\\n\\n`;\n\ntelegramText += `**üìã PER TIPO AZIONE**\\n`;\nObject.entries(actionBreakdown).forEach(([action, data]) => {\n  telegramText += `‚Ä¢ ${action}: ${data.count} (‚úÖ ${data.completed})\\n`;\n});\n\ntelegramText += `\\n**üîç ANALISI**\\n`;\ntelegramText += `‚Ä¢ Gap Rilevati: **${metrics.gapsDetected}** (${gapRate}%)\\n`;\ntelegramText += `‚Ä¢ Clienti Gestiti: ${metrics.uniqueCustomers}\\n\\n`;\n\ntelegramText += `**üìß EMAIL**\\n`;\ntelegramText += `‚Ä¢ Processate: ${metrics.totalEmails}\\n`;\ntelegramText += `‚Ä¢ Con AI: ${metrics.emailsWithAI}\\n`;\n\n// Aggiungi task urgenti se presenti\nif (urgentPending.length > 0) {\n  telegramText += `\\n**üö® TASK URGENTI APERTI**\\n`;\n  urgentPending.forEach((t, i) => {\n    const icon = t.priority === ''critical'' ? ''üî¥'' : ''üü†'';\n    const overdue = t.isOverdue ? ` ‚ö†Ô∏è SCADUTO` : '''';\n    telegramText += `\\n${i+1}. ${icon} ${t.title}\\n`;\n    telegramText += `   üë§ ${t.customer}\\n`;\n    if (t.deadline) {\n      telegramText += `   ‚è∞ ${t.deadline.toLocaleString(''it-IT'', {day: ''2-digit'', month: ''2-digit'', hour: ''2-digit'', minute: ''2-digit''})}${overdue}\\n`;\n    }\n  });\n}\n\ntelegramText += `\\n---\\n`;\ntelegramText += `üìä **Performance**: ${completionRate}% completion | ${gapRate}% gap detection`;\n\n// Return per backward compatibility\nreturn [{\n  json: {\n    report: telegramText,\n    date: now.toLocaleDateString(''it-IT''),\n    metrics: metrics\n  }\n}];\n"},"id":"e01257aa-dc41-42ba-892e-c0bed5b929f5","name":"Aggregate Report","type":"n8n-nodes-base.function","typeVersion":1,"position":[-280,-140]},{"parameters":{"operation":"getAll","tableId":"smart_tasks","limit":null,"filters":{"conditions":[{"keyName":"created_at","condition":"gt","keyValue":"={{ new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString() }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-720,-40],"id":"b1891d5a-4de9-40c0-b133-2bb952e9cd16","name":"TASK","alwaysOutputData":true,"retryOnFail":true,"credentials":{"supabaseApi":{"id":"U18uJwD80Uq036TV","name":"Supabase tiziano.annicchiarico@gmail.com"}}},{"parameters":{"operation":"getAll","tableId":"email_processing_log","returnAll":true,"filters":{"conditions":[{"keyName":"created_at","condition":"gt","keyValue":"={{ new Date(Date.now() - 5 * 24 * 60 * 60 * 1000).toISOString() }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[-720,-240],"id":"6cda2bb1-8b21-4652-9b31-1461c8ab90bb","name":"MAIL","alwaysOutputData":true,"retryOnFail":true,"credentials":{"supabaseApi":{"id":"U18uJwD80Uq036TV","name":"Supabase tiziano.annicchiarico@gmail.com"}}},{"parameters":{"mode":"combine","combineBy":"combineByPosition","options":{}},"type":"n8n-nodes-base.merge","typeVersion":3.1,"position":[-500,-140],"id":"ea937fec-3820-494e-ab87-3c00716c039e","name":"Merge"},{"parameters":{"chatId":"-1002673812914","text":"={{ $json.report }}","additionalFields":{"appendAttribution":false,"parse_mode":"Markdown"}},"id":"249e3544-9c5e-48ae-875a-304fffeec23d","name":"üì± Telegram Report","type":"n8n-nodes-base.telegram","typeVersion":1.2,"position":[-60,-40],"webhookId":"bb858f02-80fa-4afa-9527-22c99c3c7b5f","retryOnFail":true,"credentials":{"telegramApi":{"id":"dbGXwcFAw4mNHLio","name":"GommeGoBot"}}},{"parameters":{"toRecipients":"supplies@tecsolutions.app","subject":"={{ ''üìä Report '' + (new Date().getHours() >= 20 ? ''Giornata Completa'' : ''Prima Met√†'') + '' - '' + $json.date + '' | '' + $json.metrics.totalTasks + '' task'' + ($json.metrics.overdueTasks > 0 ? '', '' + $json.metrics.overdueTasks + '' urgenti'' : '''') }}","bodyContent":"={{ $json.report }}","additionalFields":{"bodyContentType":"html"}},"type":"n8n-nodes-base.microsoftOutlook","typeVersion":2,"position":[-60,-220],"id":"9313ac0c-c13d-4423-808f-95f598025596","name":"Send Report","webhookId":"3a31c1c9-6763-4aa2-9a7a-b1b2f93ccba8","retryOnFail":true,"credentials":{"microsoftOutlookOAuth2Api":{"id":"EySZIVRGzocRrEOf","name":"Outlook Info GommeGo"}},"onError":"continueRegularOutput"},{"parameters":{"content":"## ‚è∞ SCHEDULE\n**Orari**: 8:00 e 21:00\n**Cron**: `0 8,21 * * *`\n\n---\n\n## üì• QUERY DATI\n**TASK**: Ultimi 24 ore\n**MAIL**: Ultimi 5 giorni (per test)\n\n---\n\n## üìà METRICHE CALCOLATE\n- Task totali/completati/pendenti/in ritardo\n- Distribuzione priorit√† (üî¥üü†üü°üü¢)\n- Gap detection rate %\n- Email processate con/senza AI\n- Clienti unici gestiti\n\n---\n\n## üö® TASK URGENTI\n**Mostra**: Top 5 critical/high pendenti\n**Info**: Titolo, cliente, deadline\n**Alert**: ‚ö†Ô∏è SCADUTO se oltre deadline\n\n---\n\n## üì§ OUTPUT\n**Telegram**: Chat -1002673812914\n**Email**: tiziano.annicchiarico@tecsolutions.org\n**Subject dinamico**: Include conteggio task e urgenti\n\n---\n\n## üéØ REPORT TYPE\n**Mattina (8:00)**: \"Prima Met√† Giornata\"\n**Sera (21:00)**: \"Giornata Completa\"\n\n---\n\n## üìä PERFORMANCE\nMostra completion rate % e gap detection rate %","height":1280,"width":580,"color":4},"type":"n8n-nodes-base.stickyNote","position":[-1660,-620],"typeVersion":1,"id":"1d30e5b1-7acb-45cf-9a1b-748d66d95dec","name":"Sticky Note"}]', '{"Schedule":{"main":[[{"node":"MAIL","type":"main","index":0},{"node":"TASK","type":"main","index":0}]]},"Aggregate Report":{"main":[[{"node":"Send Report","type":"main","index":0},{"node":"üì± Telegram Report","type":"main","index":0}]]},"TASK":{"main":[[{"node":"Merge","type":"main","index":1}]]},"MAIL":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Merge":{"main":[[{"node":"Aggregate Report","type":"main","index":0}]]},"Send Report":{"main":[[],[]]}}', '{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","errorWorkflow":"1LreJWx0H8iEqkgn"}', NULL, '{}', 'b8e147e8-5a04-4079-ac62-b5c2ccd9d0b8', 1, NULL, NULL, '2025-06-13T19:13:11.999Z', '2025-06-13T21:41:59.000Z', false),
  ('39bcfa0f-3069-46a0-8b3f-42c0af18fc9e', 'My workflow 5', false, '[{"parameters":{"jsCode":"throw new Error(\"TEST ERROR HANDLER - \" + new Date().toISOString());"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-300,-180],"id":"1c1071c0-b265-4539-8dd5-d7662d19e8c4","name":"Code"},{"parameters":{"rule":{"interval":[{"field":"minutes","minutesInterval":1}]}},"type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[-560,-180],"id":"092077d8-96a6-44cd-bcb7-196e3a884978","name":"Schedule Trigger"}]', '{"Schedule Trigger":{"main":[[{"node":"Code","type":"main","index":0}]]}}', '{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","errorWorkflow":"mL8bvBkd0QpaVDxx"}', '{"node:Schedule Trigger":{"recurrenceRules":[]}}', '{}', '051e6bf9-357d-48f5-b59e-50e1f8aec383', 1, NULL, NULL, '2025-06-13T21:42:32.076Z', '2025-06-20T11:22:45.000Z', true),
  ('0e8fdcd2-946c-4625-837a-ff2a0d52df51', 'ERROR - HANDLING', true, '[{"parameters":{"assignments":{"assignments":[{"id":"db0cb791-2bee-4cbd-8779-7f86c821273a","name":"timestamp","value":"={{ $now }}","type":"string"},{"id":"9777ff8e-d790-453e-9c79-96d10f49bceb","name":"=notified","value":"false","type":"string"},{"id":"1c97423f-5518-4e2e-9ee3-290afe91f8af","name":"severity","value":"medium","type":"string"},{"id":"ca1dcbee-aa8c-4443-9aed-fdd25fc82af3","name":"context","value":"={{ $json }}","type":"string"},{"id":"78b1d6ff-d461-44f7-8eb9-4080aa95050a","name":"execution.id","value":"={{ $json.execution.id }}","type":"number"},{"id":"289a423c-7a7d-43d7-b28f-b77087707209","name":"execution.url","value":"={{ $json.execution.url }}","type":"string"},{"id":"05d57be6-5b3b-49f2-88e8-979a645e92a2","name":"execution.error.message","value":"={{ $json.execution.error.message }}","type":"string"},{"id":"b9032cb8-acc5-4e93-a7ac-92dd462a6722","name":"execution.error.stack","value":"={{ $json.execution.error.stack }}","type":"string"},{"id":"21e9a46a-abe9-41fe-898b-5b32c97d67af","name":"execution.lastNodeExecuted","value":"={{ $json.execution.lastNodeExecuted }}","type":"string"},{"id":"47cbb2a9-c371-4e46-a01c-6267669fc9ed","name":"execution.mode","value":"={{ $json.execution.mode }}","type":"string"},{"id":"c6a38ccc-f908-4d21-b248-7adba9c8191d","name":"workflow.id","value":"={{ $json.workflow.id }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-100,0],"id":"2074bd81-1000-4cfd-a7a7-fab74fb74a08","name":"Mappa Campi"},{"parameters":{"tableId":"errors","fieldsUi":{"fieldValues":[{"fieldId":"workflow_name","fieldValue":"={{ $json.workflow.name }}"},{"fieldId":"workflow_id","fieldValue":"={{ $json.workflow.id }}"},{"fieldId":"node_name","fieldValue":"={{ $json.execution.lastNodeExecuted }}"},{"fieldId":"execution_id","fieldValue":"={{ $json.execution.id }}"},{"fieldId":"execution_url","fieldValue":"={{ $json.execution.url }}"},{"fieldId":"error_message","fieldValue":"={{ $json.execution.error.message }}"},{"fieldId":"error_stack","fieldValue":"={{ $json.execution.error.stack }}"},{"fieldId":"timestamp","fieldValue":"={{ $json.timestamp }}"},{"fieldId":"notified","fieldValue":"={{ $json.notified }}"},{"fieldId":"severity","fieldValue":"={{ $json.severity }}"},{"fieldId":"context","fieldValue":"={{ $json.context }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[140,0],"id":"80153519-15f7-485f-bbb3-1da169428f25","name":"Scrive In DB ","credentials":{"supabaseApi":{"id":"jJWkqm9L91vHyDLJ","name":"Supabase  ERROR_HANDLING"}}},{"parameters":{},"type":"n8n-nodes-base.errorTrigger","typeVersion":1,"position":[-360,0],"id":"2e6155af-be05-449c-a522-570dc1f5a06a","name":"Error Trigger"},{"parameters":{"path":"5c967734-e3e4-4572-b7a6-38539005dd47","options":{}},"type":"n8n-nodes-base.webhook","typeVersion":2,"position":[-160,-240],"id":"0afb0485-b613-4c2b-8b85-d364412bda44","name":"Webhook","webhookId":"5c967734-e3e4-4572-b7a6-38539005dd47"}]', '{"Mappa Campi":{"main":[[{"node":"Scrive In DB ","type":"main","index":0}]]},"Error Trigger":{"main":[[{"node":"Mappa Campi","type":"main","index":0}]]}}', '{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner"}', NULL, '{}', 'e7207213-4a82-45fb-be11-2c0b3515340c', 1, NULL, NULL, '2025-06-13T22:28:06.983Z', '2025-06-13T22:36:47.000Z', false),
  ('b39b634c-ae34-4b66-8f1a-918bf919c5d4', 'GommeGo (Flow 3): Extract Information from Supplier Invoices & store EST invoice _NEW', false, '[{"parameters":{"modelId":{"__rl":true,"value":"gpt-4-turbo","mode":"list","cachedResultName":"GPT-4-TURBO"},"messages":{"values":[{"content":"=# Sistema Esperto Estrazione Dati Fatture\n\nSei un sistema specializzato nell''estrazione precisa di dati strutturati da fatture PDF convertite in testo. Segui rigorosamente le istruzioni e gli esempi forniti.\n\n## Istruzioni Principali\n\nEstrai i dati dalla fattura e restituisci un oggetto JSON con i campi specificati. Analizza attentamente il testo fornito in: {{ $json.text_agent_ready }}\n\n## Esempi di Estrazione (Few-Shot)\n\n### Esempio 1: Fattura Italiana Completa\nInput: \"Causale Rif. ordine FZISHUXBL/PTY201022640225 del 25/02/2025 [...] Cedente/prestatore (fornitore) Identificativo fiscale ai fini IVA: IT02025220761 Codice fiscale: 02025220761 Denominazione: AN CAR s.r.l. [...] TD01 fattura 3153/tr-2025 26/02/2025 [...] Contributo ambientale per il recupero degli pneumatici fuori uso (PFU) [...] 0,90 [...] 1,95 [...] Sovraprezzo per l'' indirizzo di consegna diverso (Tyre24) [...] 0,99 [...] Totale imponibile 322,68 Totale imposta 71,00 [...] Totale documento 393,68\"\n\nOutput:\n```json\n{\n  \"numero_ordine_prestashop\": \"FZISHUXBL\",\n  \"numero_ordine_t24\": \"PTY201022640225\",\n  \"nome_file_fattura\": \"invoice-an-car-3153-tr-2025.pdf\",\n  \"fornitore_nazionalita\": \"IT\",\n  \"fornitore_ragione_sociale\": \"AN CAR s.r.l.\",\n  \"fornitore_partita_iva\": \"IT02025220761\",\n  \"fattura_numero\": \"3153/tr-2025\",\n  \"fattura_data\": \"2025-02-26\",\n  \"fattura_importo_totale\": \"393.68\",\n  \"fattura_totale_imponibile\": \"322.68\",\n  \"fattura_totale_imposte\": \"71.00\",\n  \"fattura_percentuale_iva\": \"22\",\n  \"fattura_totale_pfu\": \"2.85\",\n  \"fattura_spese_spedizione\": \"0\",\n  \"fattura_altri_addebiti\": \"0.99\",\n  \"mese\": \"Febbraio\"\n}\n```\n\n### Esempio 2: Fattura Italiana con Solo PTY\nInput: \"UNIVERSAL GOMME SRLS VIA DELLA CHIMICA SNC 01100 VITERBO (VT) p.iva: 02278440561 [...] fattura n.3982/E del 19/05/2025 Numero d''ordine. PTY208104490525 [...] PNEUMATICI HANKOOK K125 195/55 R16 [...] PFU P2 CONTRIBUTO PFU ECOTYRE [...] 1,950 [...] SPED SPESE DI SPEDIZIONE [...] 0,990 [...] Totale imponibile ‚Ç¨ 285,11 Importo Iva ‚Ç¨ 62,72 Totale Fattura ‚Ç¨ 347,83\"\n\nOutput:\n```json\n{\n  \"numero_ordine_prestashop\": \"\",\n  \"numero_ordine_t24\": \"PTY208104490525\",\n  \"nome_file_fattura\": \"invoice-universal-gomme-3982-e.pdf\",\n  \"fornitore_nazionalita\": \"IT\",\n  \"fornitore_ragione_sociale\": \"UNIVERSAL GOMME SRLS\",\n  \"fornitore_partita_iva\": \"IT02278440561\",\n  \"fattura_numero\": \"3982/E\",\n  \"fattura_data\": \"2025-05-19\",\n  \"fattura_importo_totale\": \"347.83\",\n  \"fattura_totale_imponibile\": \"285.11\",\n  \"fattura_totale_imposte\": \"62.72\",\n  \"fattura_percentuale_iva\": \"22\",\n  \"fattura_totale_pfu\": \"7.80\",\n  \"fattura_spese_spedizione\": \"0.99\",\n  \"fattura_altri_addebiti\": \"0\",\n  \"mese\": \"Maggio\"\n}\n```\n\n### Esempio 3: Fattura Tedesca Intracomunitaria\nInput: \"CBW Reifengro√ühandel GmbH [...] USt. ID: DE 138 210 553 [...] Rechnung R0019240 Datum: 15.05.2025 [...] Bestellnr: PTY206304110525 [...] DKASTOZQI [...] Prezzo per l'' indirizzo di consegna diverso: 0.99 Euro [...] Nettowarenwert 160,60 [...] Innergemeinschaftliche Lieferung - VAT free\"\n\nOutput:\n```json\n{\n  \"numero_ordine_prestashop\": \"DKASTOZQI\",\n  \"numero_ordine_t24\": \"PTY206304110525\",\n  \"nome_file_fattura\": \"invoice-cbw-reifengrosshandel-r0019240.pdf\",\n  \"fornitore_nazionalita\": \"DE\",\n  \"fornitore_ragione_sociale\": \"CBW Reifengro√ühandel GmbH\",\n  \"fornitore_partita_iva\": \"DE138210553\",\n  \"fattura_numero\": \"R0019240\",\n  \"fattura_data\": \"2025-05-15\",\n  \"fattura_importo_totale\": \"160.60\",\n  \"fattura_totale_imponibile\": \"160.60\",\n  \"fattura_totale_imposte\": \"0\",\n  \"fattura_percentuale_iva\": \"0\",\n  \"fattura_totale_pfu\": \"0\",\n  \"fattura_spese_spedizione\": \"0\",\n  \"fattura_altri_addebiti\": \"0.99\",\n  \"mese\": \"Maggio\"\n}\n```\n\n### Esempio 4: Fattura Tedesca con Ordine Prestashop\nInput: \"Pneuforce GmbH [...] UstID: DE355477218 [...] Rechnung Nr. 1103158 [...] Lieferdatum: 02.05.2025 [...] Tyre24-Ref.: QSKSTPDUA Ihre Bestell. Nr.: PTY200450380525 [...] 255/40R17 94 W YOKOHAMA [...] 250,72 ‚Ç¨ [...] DPDPakete Pakete 0,99 ‚Ç¨ [...] Gesamtbetrag (Netto): 251,71 ‚Ç¨ [...] Gesamtbetrag (Brutto): 251,71 ‚Ç¨ Es handelt sich hierbei um eine steuerfreie innergemeinschaftliche Lieferung.\"\n\nOutput:\n```json\n{\n  \"numero_ordine_prestashop\": \"QSKSTPDUA\",\n  \"numero_ordine_t24\": \"PTY200450380525\",\n  \"nome_file_fattura\": \"invoice-pneuforce-1103158.pdf\",\n  \"fornitore_nazionalita\": \"DE\",\n  \"fornitore_ragione_sociale\": \"Pneuforce GmbH\",\n  \"fornitore_partita_iva\": \"DE355477218\",\n  \"fattura_numero\": \"1103158\",\n  \"fattura_data\": \"2025-05-02\",\n  \"fattura_importo_totale\": \"251.71\",\n  \"fattura_totale_imponibile\": \"251.71\",\n  \"fattura_totale_imposte\": \"0\",\n  \"fattura_percentuale_iva\": \"0\",\n  \"fattura_totale_pfu\": \"0\",\n  \"fattura_spese_spedizione\": \"0.99\",\n  \"fattura_altri_addebiti\": \"0\",\n  \"mese\": \"Maggio\"\n}\n```\n\n## Campi da Estrarre\n\n1. **numero_ordine_prestashop**: Codice di 9 caratteri alfabetici maiuscoli (es. \"FZISHUXBL\", \"DKASTOZQI\", \"QSKSTPDUA\"). Se assente, restituisci stringa vuota \"\"\n2. **numero_ordine_t24**: Riferimento che inizia con \"PTY\" seguito da numeri\n3. **nome_file_fattura**: Formato \"invoice-[fornitore-semplificato]-[numero-fattura].pdf\"\n4. **fornitore_nazionalita**: Codice paese ISO a 2 lettere\n5. **fornitore_ragione_sociale**: Nome completo dell''azienda\n6. **fornitore_partita_iva**: P.IVA o VAT ID (rimuovi spazi)\n7. **fattura_numero**: Numero della fattura\n8. **fattura_data**: Data in formato YYYY-MM-DD\n9. **fattura_importo_totale**: Totale con IVA (solo cifre con punto decimale)\n10. **fattura_totale_imponibile**: Totale senza IVA\n11. **fattura_totale_imposte**: Importo IVA (0 per intracomunitarie)\n12. **fattura_percentuale_iva**: Solo numero senza %\n13. **fattura_totale_pfu**: Somma contributi ambientali PFU\n14. **fattura_spese_spedizione**: Costi di spedizione\n15. **fattura_altri_addebiti**: Altri addebiti fissi\n16. **mese**: Nome mese italiano dalla data fattura\n\n## Regole di Estrazione\n\n1. Cerca i campi in qualsiasi lingua (italiano, tedesco, polacco, francese)\n2. Converti date in formato YYYY-MM-DD indipendentemente dal formato originale\n3. Usa il punto come separatore decimale per tutti gli importi\n4. Rimuovi simboli di valuta (‚Ç¨, EUR)\n5. Per fatture intracomunitarie tedesche: IVA = 0, imposte = 0\n6. Valori mancanti: \"\" per stringhe, \"0\" per numeri\n7. Verifica: importo_totale ‚âà totale_imponibile + totale_imposte\n\n## Output\n\nRestituisci esclusivamente l''oggetto JSON con tutti i campi richiesti. Non aggiungere testo, spiegazioni o commenti."}]},"jsonOutput":true,"options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[-260,160],"id":"10724955-312d-4829-9f58-25f85298fa63","name":"Invoice data extractor","credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"jsCode":"let merged = {};\n\nitems.forEach(item => {\n  const json = item.json;\n\n  if (json.message && json.message.content) {\n    // Appiattisci il primo oggetto (annidato)\n    merged = {\n      ...merged,\n      index: json.index,\n      role: json.message.role,\n      finish_reason: json.finish_reason,\n      ...json.message.content\n    };\n  } else {\n    // Unisci direttamente i campi del secondo oggetto (gi√† flat)\n    merged = {\n      ...merged,\n      ...json\n    };\n  }\n});\n\nreturn [\n  {\n    json: merged\n  }\n];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[80,160],"id":"acb59ff8-9adf-4e49-820e-36b6b6b89620","name":"JSON Flat"},{"parameters":{"operation":"update","tableId":"orders_processed","filters":{"conditions":[{"keyName":"order_reference","condition":"eq","keyValue":"={{ $json.numero_ordine_prestashop }}"},{"keyName":"t24_order_number","condition":"eq","keyValue":"={{ $json.numero_ordine_t24 }}"},{"keyName":"order_note","condition":"ilike","keyValue":"=*{{ $json.numero_ordine_t24 }}*"}]},"fieldsUi":{"fieldValues":[{"fieldId":"invoice_filename","fieldValue":"={{ $json.nome_file_fattura }}"},{"fieldId":"invoice_wholesaler_name","fieldValue":"={{ $json.fornitore_ragione_sociale }}"},{"fieldId":"invoice_wholesaler_country_code","fieldValue":"={{ $json.fornitore_nazionalita }}"},{"fieldId":"invoice_wholesaler_taxid","fieldValue":"={{ $json.fornitore_partita_iva }}"},{"fieldId":"invoice_number","fieldValue":"={{ $json.fattura_numero }}"},{"fieldId":"invoice_date","fieldValue":"={{ $json.fattura_data }}"},{"fieldId":"invoice_total","fieldValue":"={{ $json.fattura_importo_totale }}"},{"fieldId":"invoice_taxable_amount","fieldValue":"={{ $json.fattura_totale_imponibile }}"},{"fieldId":"invoice_total_taxes","fieldValue":"={{ $json.fattura_totale_imposte }}"},{"fieldId":"invoice_tax_percentage","fieldValue":"={{ $json.fattura_percentuale_iva }}"},{"fieldId":"invoice_total_pfu","fieldValue":"={{ $json.fattura_totale_pfu }}"},{"fieldId":"invoice_shipping_costs","fieldValue":"={{ $json.fattura_spese_spedizione }}"},{"fieldId":"invoice_total_other_charges","fieldValue":"={{ $json.fattura_altri_addebiti }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[1500,40],"id":"1a7b0426-c627-4e29-a159-da1da657c396","name":"Supabase","alwaysOutputData":true,"retryOnFail":true,"credentials":{"supabaseApi":{"id":"BkVV9D4yOfHR3iC4","name":"Supabase tecsolutions"}}},{"parameters":{"operation":"getAll","tableId":"orders_processed","limit":1,"filters":{"conditions":[{"keyName":"order_reference","condition":"eq","keyValue":"={{ $json.numero_ordine_prestashop }}"},{"keyName":"t24_order_number","condition":"eq","keyValue":"={{ $json.numero_ordine_t24 }}"},{"keyName":"order_note","condition":"ilike","keyValue":"=*{{ $json.numero_ordine_t24 }}*"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[420,20],"id":"17525ea9-e7bf-41e7-bd1e-e4eea0149a77","name":"Supabase2","alwaysOutputData":true,"retryOnFail":true,"credentials":{"supabaseApi":{"id":"BkVV9D4yOfHR3iC4","name":"Supabase tecsolutions"}}},{"parameters":{"jsCode":"let record_founded = false;\n\nif (items.length > 0) {\n  const record = items[0].json;\n\n  if (Object.keys(record).length > 0) {\n    record_founded = true;\n  }\n}\n\nreturn [{\n  json: {\n    record_founded\n  }\n}];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[620,20],"id":"9004bd75-fc73-4b9c-8a9a-93e5d77e180d","name":"Imposto record_founded (true o false)","alwaysOutputData":true},{"parameters":{},"type":"n8n-nodes-base.merge","typeVersion":3,"position":[860,140],"id":"a29b0849-4012-4ed5-aacb-0401d7e178da","name":"Merge4"},{"parameters":{"jsCode":"let merged = {};\n\nitems.forEach(item => {\n  const json = item.json;\n\n  if (json.message && json.message.content) {\n    // Appiattisci il primo oggetto (annidato)\n    merged = {\n      ...merged,\n      index: json.index,\n      role: json.message.role,\n      finish_reason: json.finish_reason,\n      ...json.message.content\n    };\n  } else {\n    // Unisci direttamente i campi del secondo oggetto (gi√† flat)\n    merged = {\n      ...merged,\n      ...json\n    };\n  }\n});\n\nreturn [\n  {\n    json: merged\n  }\n];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1020,140],"id":"ebc800cd-f353-4924-83d1-67583987fd9f","name":"JSON Flat1"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"5cc04951-be52-4663-8e12-0d7b809d3e07","leftValue":"={{ $json.record_founded }}","rightValue":"","operator":{"type":"boolean","operation":"true","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[1220,140],"id":"6ad096d2-b308-4ffd-8a32-5eb3d44c0897","name":"If1"},{"parameters":{"inputDataFieldName":"attachment_0","driveId":{"__rl":true,"value":"My Drive","mode":"list","cachedResultName":"My Drive","cachedResultUrl":"https://drive.google.com/drive/my-drive"},"folderId":{"__rl":true,"value":"12IYqqROdSMKNay9H7VWnVSF3N3pEbSeS","mode":"list","cachedResultName":"Fatture_Estero","cachedResultUrl":"https://drive.google.com/drive/folders/12IYqqROdSMKNay9H7VWnVSF3N3pEbSeS"},"options":{}},"type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[-722,500],"id":"508da662-1671-42c0-a5cd-972cb5e2ca99","name":"Carica Fattura PDF","credentials":{"googleDriveOAuth2Api":{"id":"WBhAeqmWykJUM02S","name":"Google Drive account"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"2dc7accf-a932-461e-bc39-2403570be119","leftValue":"={{ $json.fornitore_nazionalita }}","rightValue":"IT","operator":{"type":"string","operation":"equals"}},{"id":"21337c2c-3f97-4c47-80bd-ce7528eeb5f5","leftValue":"={{ $json.id }}","rightValue":"","operator":{"type":"string","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[980,480],"id":"47b29411-1795-4e0a-8c2b-3669ce648918","name":"Se ITA cancella"},{"parameters":{"operation":"deleteFile","fileId":{"__rl":true,"value":"={{ $json.id }}","mode":"id"},"options":{"deletePermanently":false}},"type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[1200,380],"id":"d88c25f2-7031-441e-b110-05f8aa9c65e1","name":"Cancella by ID","retryOnFail":true,"credentials":{"googleDriveOAuth2Api":{"id":"WBhAeqmWykJUM02S","name":"Google Drive account"}}},{"parameters":{"assignments":{"assignments":[{"id":"b4e2ebcc-0d82-4436-ac43-0ff56e2690c4","name":"id","value":"={{ $json.id }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[100,500],"id":"44fc7319-754e-4536-898f-142feee331e7","name":"Edit Fields"},{"parameters":{"toRecipients":"info@gommego.com","subject":"Nuova fattura estera per commercialista","bodyContent":"=Hai una nuova fattura estera per commercialista  {{ $json.name }}","additionalFields":{}},"type":"n8n-nodes-base.microsoftOutlook","typeVersion":2,"position":[1420,560],"id":"623de714-582e-4b90-ba63-1bae83e7877f","name":"Genera Mail ","webhookId":"b9d01753-7e89-4482-be1b-978ff13665e3","credentials":{"microsoftOutlookOAuth2Api":{"id":"gvsjOBgXBwH8vLH8","name":"Outlook Supplies"}}},{"parameters":{},"type":"n8n-nodes-base.merge","typeVersion":3.1,"position":[540,480],"id":"2de13bc3-07bc-46d0-b2b8-1e24211fd2a2","name":"Merge"},{"parameters":{"jsCode":"let merged = {};\n\nitems.forEach(item => {\n  const json = item.json;\n\n  if (json.message && json.message.content) {\n    // Appiattisci il primo oggetto (annidato)\n    merged = {\n      ...merged,\n      index: json.index,\n      role: json.message.role,\n      finish_reason: json.finish_reason,\n      ...json.message.content\n    };\n  } else {\n    // Unisci direttamente i campi del secondo oggetto (gi√† flat)\n    merged = {\n      ...merged,\n      ...json\n    };\n  }\n});\n\nreturn [\n  {\n    json: merged\n  }\n];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[760,480],"id":"fed43865-ee26-481c-86fa-59af366e0c35","name":"JSON Flat2"},{"parameters":{"resource":"folderMessage","folderId":{"__rl":true,"value":"AAMkADY5YTU5ODIzLTM5M2MtNGU4Zi04YzNmLTBlYmYxNDNhODNjMAAuAAAAAAAty8lTOVoeRrTqgTQml0B1AQAYYLMeDvsGSqoDRrzkfpW2AAA3x-uFAAA=","mode":"list","cachedResultName":"FATTURE","cachedResultUrl":"https://outlook.office365.com/mail/AAMkADY5YTU5ODIzLTM5M2MtNGU4Zi04YzNmLTBlYmYxNDNhODNjMAAuAAAAAAAty8lTOVoeRrTqgTQml0B1AQAYYLMeDvsGSqoDRrzkfpW2AAA3x%2FuFAAA%3D"},"limit":1,"output":"fields","fields":["body","createdDateTime","subject"],"filtersUI":{"values":{"filters":{"readStatus":"unread"}}},"options":{"downloadAttachments":true}},"type":"n8n-nodes-base.microsoftOutlook","typeVersion":2,"position":[-1280,500],"id":"63238901-1587-40ba-b69d-1b73839e3c72","name":"Microsoft Outlook","webhookId":"dabcf37c-9f56-4fee-8e9b-bcc6d26456df","retryOnFail":true,"credentials":{"microsoftOutlookOAuth2Api":{"id":"gvsjOBgXBwH8vLH8","name":"Outlook Supplies"}}},{"parameters":{"operation":"move","messageId":{"__rl":true,"value":"={{ $json.id }}","mode":"id"},"folderId":{"__rl":true,"value":"AAMkADY5YTU5ODIzLTM5M2MtNGU4Zi04YzNmLTBlYmYxNDNhODNjMAAuAAAAAAAty8lTOVoeRrTqgTQml0B1AQAYYLMeDvsGSqoDRrzkfpW2AAAEXLZXAAA=","mode":"list","cachedResultName":"Template","cachedResultUrl":"https://outlook.office365.com/mail/AAMkADY5YTU5ODIzLTM5M2MtNGU4Zi04YzNmLTBlYmYxNDNhODNjMAAuAAAAAAAty8lTOVoeRrTqgTQml0B1AQAYYLMeDvsGSqoDRrzkfpW2AAAEXLZXAAA%3D"}},"type":"n8n-nodes-base.microsoftOutlook","typeVersion":2,"position":[-1020,650],"id":"be32ad8c-ed17-4d9b-b66f-c17b25af5f73","name":"Microsoft Outlook1","webhookId":"d5c58385-7170-4140-a739-c5a855725027","credentials":{"microsoftOutlookOAuth2Api":{"id":"gvsjOBgXBwH8vLH8","name":"Outlook Supplies"}}},{"parameters":{"rule":{"interval":[{"field":"minutes","minutesInterval":1}]}},"type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[-1500,500],"id":"772bea56-203e-40ee-b668-be29f50dbab7","name":"Schedule Trigger"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[1500,220],"id":"fd3caf1d-1be0-4886-af53-6a060c9bf850","name":"No Operation, do nothing"},{"parameters":{"language":"javascript","jsCode":"const dateStr = $(''JSON Flat2'').first().json.fattura_data;\nconst date = new Date(dateStr);\n\nconst mesi = [\n  ''Gennaio'', ''Febbraio'', ''Marzo'', ''Aprile'', ''Maggio'', ''Giugno'',\n  ''Luglio'', ''Agosto'', ''Settembre'', ''Ottobre'', ''Novembre'', ''Dicembre''\n];\n\nconst mese = mesi[date.getMonth()];\n\nreturn [\n  {\n    json: {\n      fattura_data: dateStr,\n      mese\n    }\n  }\n];\n"},"id":"c8cd151c-4866-497f-a0d9-67fb8041e219","name":"Estrai Mese","type":"n8n-nodes-base.code","typeVersion":1,"position":[-1580,1140],"alwaysOutputData":true},{"parameters":{"operation":"update","fileId":{"__rl":true,"value":"={{ $(''JSON Flat2'').item.json.id }}","mode":"id"},"newUpdatedFileName":"={{ $json.mese }}_{{ $(''JSON Flat2'').item.json.numero_ordine_t24 }}_{{ $(''JSON Flat2'').item.json.fornitore_ragione_sociale }}","options":{}},"type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[1200,560],"id":"9a5eb792-8cbc-4544-af3b-9e649f6288ad","name":"Cambia Nome","retryOnFail":true,"credentials":{"googleDriveOAuth2Api":{"id":"WBhAeqmWykJUM02S","name":"Google Drive account"}}},{"parameters":{"method":"POST","url":"https://api.mistral.ai/v1/ocr","authentication":"genericCredentialType","genericAuthType":"httpHeaderAuth","sendHeaders":true,"headerParameters":{"parameters":[{"name":"Authorization","value":"Bearer ${MISTRAL_API_KEY}"}]},"sendBody":true,"specifyBody":"json","jsonBody":"={\n  \"model\": \"mistral-ocr-latest\",\n  \"document\": {\n    \"type\": \"document_url\",\n    \"document_url\": \"{{ $json.url }}\"\n  },\n  \"include_image_base64\": true\n}\n","options":{"response":{"response":{"responseFormat":"text"}}}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-600,160],"id":"cbd38d04-98b2-4e59-b7c4-f7a46f4f411c","name":"GET OCR RESULT","retryOnFail":true,"credentials":{"httpHeaderAuth":{"id":"BYFWsB3xpyV8tLJG","name":"MISTRAL_API"}}},{"parameters":{"url":"=https://api.mistral.ai/v1/files/{{ $json.id }}/url","authentication":"genericCredentialType","genericAuthType":"httpHeaderAuth","sendQuery":true,"queryParameters":{"parameters":[{"name":"expiry","value":"24"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-780,160],"id":"3069a8b3-be63-459c-929c-abfecbc9960d","name":"GET SIGNED URL","retryOnFail":true,"credentials":{"httpHeaderAuth":{"id":"BYFWsB3xpyV8tLJG","name":"MISTRAL_API"}}},{"parameters":{"method":"POST","url":"https://api.mistral.ai/v1/files","authentication":"genericCredentialType","genericAuthType":"httpHeaderAuth","sendBody":true,"contentType":"multipart-form-data","bodyParameters":{"parameters":[{"name":"purpose","value":"ocr"},{"parameterType":"formBinaryData","name":"file","inputDataFieldName":"attachment_0"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-940,160],"id":"05e2b351-b8e7-4e95-a827-5dffef6b2462","name":"UPLOAD MISTRAL OCR","retryOnFail":true,"credentials":{"mistralCloudApi":{"id":"IwB6SJuDF519gYoE","name":"Mistral Cloud account"},"httpHeaderAuth":{"id":"BYFWsB3xpyV8tLJG","name":"MISTRAL_API"}}},{"parameters":{"operation":"pdf","binaryPropertyName":"attachment_0","options":{"joinPages":true}},"type":"n8n-nodes-base.extractFromFile","typeVersion":1,"position":[-1940,1120],"id":"ceca18fd-7a34-4559-a7f0-265f46216a76","name":"FROM PDF TO TXT1"},{"parameters":{"jsCode":"const input = $json.data;\n\nlet markdown = \"\";\n\ntry {\n  const parsed = typeof input === ''string'' ? JSON.parse(input) : input;\n  if (parsed.pages && parsed.pages[0] && parsed.pages[0].markdown) {\n    markdown = parsed.pages[0].markdown;\n  }\n} catch (error) {\n  markdown = input; // fallback in caso di parsing fallito\n}\n\n// Rimuove solo immagini (markdown, tag HTML, base64), senza alterare altro\nconst cleaned = markdown\n  .replace(/!\\[[^\\]]*\\]\\([^)]+\\)/g, \"\")        // immagini markdown ![]()\n  .replace(/<img[^>]*>/g, \"\")                  // tag <img> HTML\n  .replace(/data:image\\/[^;]+;base64[^\"]+/g, \"\") // immagini base64\n  .trim();\n\nreturn [{\n  text_agent_ready: cleaned,\n  original_ocr_text: markdown\n}];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-420,160],"id":"f200dc4f-bfe4-4ab6-8ac5-aaeee72dd858","name":"Clean Data"},{"parameters":{"path":"137ca002-b213-449c-9d68-e1be141ea04c","formTitle":"Estrazione Dati Documento OCR","formDescription":"Carica la tua carta d''identit√† o patente per estrarre automaticamente i dati","formFields":{"values":[{"fieldLabel":"attachment_0","fieldType":"file","requiredField":true}]},"options":{"appendAttribution":false}},"id":"d5177b71-c30d-4497-848f-4596e0db27b1","name":"Form prova fatture","type":"n8n-nodes-base.formTrigger","typeVersion":2.1,"position":[-1280,40],"webhookId":"137ca002-b213-449c-9d68-e1be141ea04c","notes":"Punto di ingresso: form per caricamento documenti. Accetta immagini JPG/PNG e PDF. Validazione automatica formato file."}]', '{"Invoice data extractor":{"main":[[{"node":"JSON Flat","type":"main","index":0}]]},"JSON Flat":{"main":[[{"node":"Supabase2","type":"main","index":0},{"node":"Merge4","type":"main","index":1},{"node":"Merge","type":"main","index":0}]]},"Supabase2":{"main":[[{"node":"Imposto record_founded (true o false)","type":"main","index":0}]]},"Imposto record_founded (true o false)":{"main":[[{"node":"Merge4","type":"main","index":0}]]},"Merge4":{"main":[[{"node":"JSON Flat1","type":"main","index":0}]]},"JSON Flat1":{"main":[[{"node":"If1","type":"main","index":0}]]},"If1":{"main":[[{"node":"Supabase","type":"main","index":0}],[{"node":"No Operation, do nothing","type":"main","index":0}]]},"Carica Fattura PDF":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]},"Se ITA cancella":{"main":[[{"node":"Cancella by ID","type":"main","index":0}],[{"node":"Cambia Nome","type":"main","index":0}]]},"Edit Fields":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Merge":{"main":[[{"node":"JSON Flat2","type":"main","index":0}]]},"JSON Flat2":{"main":[[{"node":"Se ITA cancella","type":"main","index":0}]]},"Microsoft Outlook":{"main":[[{"node":"Carica Fattura PDF","type":"main","index":0},{"node":"Microsoft Outlook1","type":"main","index":0},{"node":"UPLOAD MISTRAL OCR","type":"main","index":0}]]},"Schedule Trigger":{"main":[[{"node":"Microsoft Outlook","type":"main","index":0}]]},"Estrai Mese":{"main":[[]]},"Cambia Nome":{"main":[[{"node":"Genera Mail ","type":"main","index":0}]]},"GET SIGNED URL":{"main":[[{"node":"GET OCR RESULT","type":"main","index":0}]]},"UPLOAD MISTRAL OCR":{"main":[[{"node":"GET SIGNED URL","type":"main","index":0}]]},"GET OCR RESULT":{"main":[[{"node":"Clean Data","type":"main","index":0}]]},"Clean Data":{"main":[[{"node":"Invoice data extractor","type":"main","index":0}]]},"Form prova fatture":{"main":[[{"node":"UPLOAD MISTRAL OCR","type":"main","index":0}]]}}', '{"executionOrder":"v1"}', '{"node:Schedule Trigger":{"recurrenceRules":[]}}', '{}', 'e620a823-55ee-432f-8ba0-edfa7b6a2a33', 1, '{"templateCredsSetupCompleted":true}', NULL, '2025-06-16T06:26:12.913Z', '2025-07-01T08:31:40.000Z', false),
  ('531851ec-f877-4ca0-8d30-d88ffaf9b725', 'SUB_API_INFO_ORDER & PARCELSAPP', false, '[{"parameters":{"inputSource":"passthrough"},"name":"When Executed by Another Workflow","type":"n8n-nodes-base.executeWorkflowTrigger","typeVersion":1.1,"position":[400,-496],"id":"41741c74-6a4d-47e4-8f9d-fbe6b3fc1998"},{"parameters":{"jsCode":"const raw = $json.query || '''';\nconst cleaned = typeof raw === ''string''\n  ? raw.replace(/[^a-zA-Z0-9]/g, '''').trim()\n  : '''';\nreturn [{ json: { query: cleaned } }];"},"name":"Pulisci codice","type":"n8n-nodes-base.code","typeVersion":2,"position":[416,-1328],"id":"e3b94e21-bdc4-472d-a8d6-130704b63187"},{"parameters":{"url":"=https://www.gommego.com/api/orders?filter[reference]={{ $json.query }}&display=full&output_format=JSON","authentication":"genericCredentialType","genericAuthType":"httpBasicAuth","sendQuery":true,"queryParameters":{"parameters":[{"name":"limit","value":"1"}]},"options":{}},"name":"Ottieni Ordine","type":"n8n-nodes-base.httpRequest","typeVersion":3,"position":[848,-496],"id":"2bdf4c61-b12c-46b6-a241-9c930a82efb0","alwaysOutputData":true,"retryOnFail":true,"credentials":{"httpBasicAuth":{"id":"CDYbffajBgDWgdXn","name":"Prestashop-API"}},"onError":"continueRegularOutput"},{"parameters":{"jsCode":"const response = $input.item.json;\nif (!response.orders || response.orders.length === 0) {\n  return [{ json: { orderFound: false, message: ''Nessun ordine trovato'', chatInput: $json.query } }];\n}\nconst order = response.orders[0];\nreturn [{ json: { orderFound: true, orderDetails: order, chatInput: $json.query } }];"},"name":"Verifica Ordine","type":"n8n-nodes-base.code","typeVersion":2,"position":[1072,-496],"id":"c9226d7b-df43-4a41-8b8c-af506c7f9e50"},{"parameters":{"options":{}},"name":"Estrai orderDetails","type":"n8n-nodes-base.set","typeVersion":2,"position":[1504,-560],"id":"3e039571-79f3-49d1-b91b-a34d4e026cfb"},{"parameters":{"jsCode":"const order = $json.orderDetails;\nconst id_order = order.id;\nconst id_customer = order.id_customer;\nconst id_address = order.id_address_delivery;\n\nreturn [\n  { json: { type: ''customer'', url: `https://www.gommego.com/api/customers/${id_customer}?output_format=JSON` } },\n  { json: { type: ''address'', url: `https://www.gommego.com/api/addresses/${id_address}?output_format=JSON` } },\n  { json: { type: ''order_histories'', url: `https://www.gommego.com/api/order_histories?filter[id_order]=${id_order}&display=full&output_format=JSON` } }\n];"},"name":"Crea Chiamate","type":"n8n-nodes-base.code","typeVersion":2,"position":[1840,-704],"id":"754f6573-5124-44c4-8359-1e44f14bee9d"},{"parameters":{"url":"={{$json.url}}","authentication":"genericCredentialType","genericAuthType":"httpBasicAuth","options":{}},"name":"HTTP x3 dinamico","type":"n8n-nodes-base.httpRequest","typeVersion":3,"position":[2048,-704],"id":"b2503be3-db55-430b-9f01-2da1858f5bc2","retryOnFail":true,"credentials":{"httpBasicAuth":{"id":"CDYbffajBgDWgdXn","name":"Prestashop-API"}},"onError":"continueRegularOutput"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"a7d260d7-e0e2-42bc-acf6-18abddaefc1b","leftValue":"={{ $json.orderFound }}","rightValue":"true","operator":{"type":"boolean","operation":"true","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[1280,-496],"id":"fc9dcc9a-c4ea-4aa6-a789-b1d96b28d74e","name":"If"},{"parameters":{"functionCode":"// Crea un messaggio di errore personalizzato con struttura standardizzata\nreturn [{\n  json: {\n    // Messaggio principale per il chatbot\n    chatbotResponse: `Mi dispiace, non ho trovato nessun ordine con questo codice. Dovrebbe verificare che il codice sia corretto.`,\n    \n    // Flag di stato\n    orderFound: false,\n    error: true,\n    \n    // Dettagli errore\n    errorMessage: $json[\"message\"] || \"Ordine non trovato\",\n    searchedReference: $json[\"chatInput\"],\n    \n    // Suggerimenti utili per l''utente\n    suggestions: [\n      \"Controlla se hai inserito il codice correttamente\",\n      \"Verifica nella tua email di conferma\"\n    ],\n    \n    // Summary standardizzato (come in Pulisci campi)\n    summary: {\n      order_reference: $json[\"chatInput\"],\n      current_status: \"Non trovato\",\n      tracking_number: null,\n      can_track: false,\n      is_delivered: false,\n      has_issues: false,\n      days_since_order: 0\n    },\n    \n    // Timestamp\n    timestamp: new Date().toISOString()\n  }\n}];"},"id":"7df9c2ed-c909-4181-8f6d-fcbfe09b1584","name":"Risposta Ordine Non Trovato","type":"n8n-nodes-base.function","typeVersion":1,"position":[1504,-336],"notes":"// Crea un messaggio di errore personalizzato\nreturn {\n  json: {\n    chatbotResponse: `Mi dispiace, non ho trovato nessun ordine con questo codice. Dovrebbe verificare che il codice sia corretto.`,\n    orderFound: false,\n    errorMessage: $json[\"message\"],\n    \n    // Aggiungi campi utili per il debugging\n    searchedReference: $json[\"chatInput\"],\n    timestamp: new Date().toISOString(),\n    \n    // Aggiungi suggerimenti utili per l''utente\n    suggestions: [\n      \"Controlla se hai inserito il codice correttamente\",\n      \"Verifica nella tua email di conferma\",\n      ]\n  }\n};"},{"parameters":{"assignments":{"assignments":[{"id":"ae019003-40f6-401e-bb24-b082a7c25f79","name":"Order Detail","value":"={{ $(''Estrai orderDetails'').item.json.orderDetails }}","type":"object"}]},"includeOtherFields":true,"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[2400,-704],"id":"cf87336b-e5a2-42e8-92b0-0358e0c6c57a","name":"Unisce i campi di tutti i nodi"},{"parameters":{"jsCode":"// üßπ NODO PULISCI CAMPI ‚Äì Solo dati essenziali\n\nconst stateMap = {\n  \"2\": \"Pagamento accettato\", \"3\": \"Elaborazione\", \"4\": \"Spedizione in preparazione\", \"5\": \"Consegnato\",\n  \"6\": \"Annullato\", \"7\": \"Rimborsato\", \"8\": \"Errore di pagamento\", \"9\": \"In attesa rifornimento\",\n  \"10\": \"Bonifico in attesa\", \"11\": \"Pagamento remoto accettato\", \"14\": \"MultiSafepay Pagamento sospeso\",\n  \"20\": \"Rimborso parziale\", \"23\": \"In attesa di pagamento\", \"24\": \"Rimborso parziale\",\n  \"25\": \"Pagamento parziale\", \"27\": \"Annullato per mancato pagamento\", \"28\": \"In transito\",\n  \"29\": \"Consegnato Parzialmente\", \"30\": \"In attesa emissione buono o rimborso\",\n  \"31\": \"In consegna\", \"32\": \"Richiesta reso\", \"35\": \"Destinatario assente\"\n};\n\n// üîÅ Pulizia oggetto: rimuove null, undefined, stringhe vuote\nfunction cleanObject(obj) {\n  if (Array.isArray(obj)) {\n    return obj.map(cleanObject).filter(item => item !== null && item !== undefined && item !== '''');\n  }\n  if (typeof obj === ''object'' && obj !== null) {\n    return Object.fromEntries(\n      Object.entries(obj)\n        .map(([k, v]) => [k, cleanObject(v)])\n        .filter(([_, v]) => v !== null && v !== undefined && v !== '''')\n    );\n  }\n  return obj;\n}\n\ntry {\n  const allInputs = $input.all();\n  const chatbotData = { orderFound: true };\n\n  for (const item of allInputs) {\n    const data = item.json;\n\n    // üì¶ Order\n    if (data[\"Order Detail\"] && !chatbotData.order) {\n      const orderDetail = data[\"Order Detail\"];\n      const noteLines = (orderDetail.note || \"\").split(/\\r?\\n/);\n      const cleanedNote = noteLines.length > 1 ? noteLines.slice(1).join(\", \").trim() : \"\";\n\n      chatbotData.order = {\n        reference: orderDetail.reference,\n        status: stateMap[orderDetail.current_state] || `Stato ${orderDetail.current_state}`,\n        shipping_number: (orderDetail.shipping_number && orderDetail.shipping_number.trim() !== \"\")\n          ? orderDetail.shipping_number\n          : \"Tracking number non ancora rilasciato dal corriere\",\n        payment_method: orderDetail.payment,\n        date_created: orderDetail.date_add,\n        date_updated: orderDetail.date_upd,\n        total_paid: `‚Ç¨ ${parseFloat(orderDetail.total_paid).toFixed(2)}`,\n        total_products: `‚Ç¨ ${parseFloat(orderDetail.total_products).toFixed(2)}`,\n        total_products_with_tax: `‚Ç¨ ${parseFloat(orderDetail.total_products_wt).toFixed(2)}`,\n        note: cleanedNote,\n        products: []\n      };\n\n      if (orderDetail.associations?.order_rows) {\n        chatbotData.order.products = orderDetail.associations.order_rows.map(p => ({\n          name: p.product_name,\n          reference: p.product_reference,\n          ean: p.product_ean13,\n          quantity: parseInt(p.product_quantity),\n          unit_price: `‚Ç¨ ${parseFloat(p.unit_price_tax_incl).toFixed(2)}`,\n          total_price: `‚Ç¨ ${(parseFloat(p.unit_price_tax_incl) * parseInt(p.product_quantity)).toFixed(2)}`\n        }));\n      }\n    }\n\n    // üë§ Cliente\n    if (data.customer && !chatbotData.customer) {\n      const c = data.customer;\n      chatbotData.customer = {\n        full_name: `${c.firstname} ${c.lastname}`,\n        email: c.email,\n        phone: null,\n        is_active: c.active === \"1\",\n        customer_since: c.date_add\n      };\n      if (c.note && c.note.includes(\"RESO\")) {\n        chatbotData.customer.has_return_request = true;\n      }\n    }\n\n    // üöö Consegna\n    if (data.address && !chatbotData.delivery) {\n      const a = data.address;\n      chatbotData.delivery = {\n        recipient: `${a.firstname} ${a.lastname}`,\n        street: a.address1,\n        city: a.city,\n        postcode: a.postcode,\n        country: \"Italia\",\n        phone: a.phone || a.phone_mobile,\n        fiscal_code: a.dni\n      };\n      if ((a.phone || a.phone_mobile) && chatbotData.customer) {\n        chatbotData.customer.phone = a.phone || a.phone_mobile;\n      }\n    }\n  }\n\n  return [{ json: cleanObject(chatbotData) }];\n\n} catch (error) {\n  return [{\n    json: {\n      orderFound: false,\n      error: true,\n      errorMessage: `Errore durante elaborazione dei dati: ${error.message}`,\n      timestamp: new Date().toISOString()\n    }\n  }];\n}"},"id":"c81fbcbb-672a-44bc-8a71-c958985eb3f9","name":"Clean data x Chatbot","type":"n8n-nodes-base.code","typeVersion":2,"position":[3680,-688],"notes":"// üßπ NODO PULISCI CAMPI ‚Äì Solo dati essenziali\n\nconst stateMap = {\n  \"2\": \"Pagamento accettato\", \"3\": \"Elaborazione\", \"4\": \"Spedizione in preparazione\", \"5\": \"Consegnato\",\n  \"6\": \"Annullato\", \"7\": \"Rimborsato\", \"8\": \"Errore di pagamento\", \"9\": \"In attesa rifornimento\",\n  \"10\": \"Bonifico in attesa\", \"11\": \"Pagamento remoto accettato\", \"14\": \"MultiSafepay Pagamento sospeso\",\n  \"20\": \"Rimborso parziale\", \"23\": \"In attesa di pagamento\", \"24\": \"Rimborso parziale\",\n  \"25\": \"Pagamento parziale\", \"27\": \"Annullato per mancato pagamento\", \"28\": \"In transito\",\n  \"29\": \"Consegnato Parzialmente\", \"30\": \"In attesa emissione buono o rimborso\",\n  \"31\": \"In consegna\", \"32\": \"Richiesta reso\", \"35\": \"Destinatario assente\"\n};\n\n// üîÅ Pulizia oggetto: rimuove null, undefined, stringhe vuote\nfunction cleanObject(obj) {\n  if (Array.isArray(obj)) {\n    return obj.map(cleanObject).filter(item => item !== null && item !== undefined && item !== '''');\n  }\n  if (typeof obj === ''object'' && obj !== null) {\n    return Object.fromEntries(\n      Object.entries(obj)\n        .map(([k, v]) => [k, cleanObject(v)])\n        .filter(([_, v]) => v !== null && v !== undefined && v !== '''')\n    );\n  }\n  return obj;\n}\n\ntry {\n  const allInputs = $input.all();\n  const chatbotData = { orderFound: true };\n\n  for (const item of allInputs) {\n    const data = item.json;\n\n    // üì¶ Order\n    if (data[\"Order Detail\"] && !chatbotData.order) {\n      const orderDetail = data[\"Order Detail\"];\n      const noteLines = (orderDetail.note || \"\").split(/\\r?\\n/);\n      const cleanedNote = noteLines.length > 1 ? noteLines.slice(1).join(\", \").trim() : \"\";\n\n      chatbotData.order = {\n        reference: orderDetail.reference,\n        status: stateMap[orderDetail.current_state] || `Stato ${orderDetail.current_state}`,\n        shipping_number: (orderDetail.shipping_number && orderDetail.shipping_number.trim() !== \"\")\n          ? orderDetail.shipping_number\n          : \"Tracking number non ancora rilasciato dal corriere\",\n        payment_method: orderDetail.payment,\n        date_created: orderDetail.date_add,\n        date_updated: orderDetail.date_upd,\n        total_paid: `‚Ç¨ ${parseFloat(orderDetail.total_paid).toFixed(2)}`,\n        total_products: `‚Ç¨ ${parseFloat(orderDetail.total_products).toFixed(2)}`,\n        total_products_with_tax: `‚Ç¨ ${parseFloat(orderDetail.total_products_wt).toFixed(2)}`,\n        note: cleanedNote,\n        products: []\n      };\n\n      if (orderDetail.associations?.order_rows) {\n        chatbotData.order.products = orderDetail.associations.order_rows.map(p => ({\n          name: p.product_name,\n          reference: p.product_reference,\n          ean: p.product_ean13,\n          quantity: parseInt(p.product_quantity),\n          unit_price: `‚Ç¨ ${parseFloat(p.unit_price_tax_incl).toFixed(2)}`,\n          total_price: `‚Ç¨ ${(parseFloat(p.unit_price_tax_incl) * parseInt(p.product_quantity)).toFixed(2)}`\n        }));\n      }\n    }\n\n    // üë§ Cliente\n    if (data.customer && !chatbotData.customer) {\n      const c = data.customer;\n      chatbotData.customer = {\n        full_name: `${c.firstname} ${c.lastname}`,\n        email: c.email,\n        phone: null,\n        is_active: c.active === \"1\",\n        customer_since: c.date_add\n      };\n      if (c.note && c.note.includes(\"RESO\")) {\n        chatbotData.customer.has_return_request = true;\n      }\n    }\n\n    // üöö Consegna\n    if (data.address && !chatbotData.delivery) {\n      const a = data.address;\n      chatbotData.delivery = {\n        recipient: `${a.firstname} ${a.lastname}`,\n        street: a.address1,\n        city: a.city,\n        postcode: a.postcode,\n        country: \"Italia\",\n        phone: a.phone || a.phone_mobile,\n        fiscal_code: a.dni\n      };\n      if ((a.phone || a.phone_mobile) && chatbotData.customer) {\n        chatbotData.customer.phone = a.phone || a.phone_mobile;\n      }\n    }\n  }\n\n  return [{ json: cleanObject(chatbotData) }];\n\n} catch (error) {\n  return [{\n    json: {\n      orderFound: false,\n      error: true,\n      errorMessage: `Errore durante elaborazione dei dati: ${error.message}`,\n      timestamp: new Date().toISOString()\n    }\n  }];\n}\n"},{"parameters":{"content":"Chiamata API x3","height":440,"width":480},"type":"n8n-nodes-base.stickyNote","position":[1760,-816],"typeVersion":1,"id":"48f4ae2b-535d-4365-a5c1-3e28c7fa5677","name":"Sticky Note"},{"parameters":{"requestMethod":"POST","url":"https://parcelsapp.com/api/v3/shipments/tracking","jsonParameters":true,"options":{},"bodyParametersJson":"={\n  \"shipments\": [\n    {\n      \"trackingId\": \"{{ $json.trackingId }}\",\n      \"destinationCountry\": \"{{ $json.destinationCountry }}\"\n    }\n  ],\n  \"language\": \"{{ $json.language }}\",\n  \"apiKey\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOiI1MzA4NjNjMC0zMTBkLTExZjAtYjdlMC04ZGQzNjVmMWI4NjEiLCJzdWJJZCI6IjY4MjUwZmVlMjZiMWViMTEwNWMzY2VhNCIsImlhdCI6MTc0NzI1OTM3NH0.JZJzbEq2Fy4uX64VqRbcZRKlxmQyzwzVTuoFmTyQ8KA\"\n}"},"id":"262e501d-a7ea-445a-ab61-96c1df3fb1ef","name":"HTTP Request (POST Tracking)1","type":"n8n-nodes-base.httpRequest","typeVersion":1,"position":[2640,-368]},{"parameters":{"url":"=https://parcelsapp.com/api/v3/shipments/tracking?uuid={{$json[\"uuid\"]}}&apiKey=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOiI1MzA4NjNjMC0zMTBkLTExZjAtYjdlMC04ZGQzNjVmMWI4NjEiLCJzdWJJZCI6IjY4MjUwZmVlMjZiMWViMTEwNWMzY2VhNCIsImlhdCI6MTc0NzI1OTM3NH0.JZJzbEq2Fy4uX64VqRbcZRKlxmQyzwzVTuoFmTyQ8KA","options":{}},"id":"cd81448a-6d4e-4a39-98c8-fdefe1ddba38","name":"HTTP Request (GET Tracking Status)1","type":"n8n-nodes-base.httpRequest","typeVersion":1,"position":[3040,-16]},{"parameters":{"amount":10,"unit":"seconds"},"id":"6508db1a-89fb-429f-94f2-9128ff02c448","name":"Wait (10 seconds)","type":"n8n-nodes-base.wait","typeVersion":1,"position":[2848,-16],"webhookId":"bd8bd711-0983-4d64-a5d8-77d938e6af7f"},{"parameters":{"values":{"string":[{"name":"trackingId","value":"={{ $json[\"Order Detail\"].shipping_number }}"},{"name":"destinationCountry","value":"Italy"},{"name":"language","value":"it"}]},"options":{}},"id":"cf34639f-ffd7-4e16-b656-5c79afc0b88f","name":"Input: Tracking Details","type":"n8n-nodes-base.set","typeVersion":2,"position":[2400,-368]},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"32a785f7-c0af-4504-8aef-542974964f04","leftValue":"={{ $json.done }}","rightValue":"true","operator":{"type":"boolean","operation":"true","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[2928,-368],"id":"40c3e4c0-6875-4cc4-86af-e28d9d21feac","name":"If1"},{"parameters":{},"type":"n8n-nodes-base.merge","typeVersion":3.2,"position":[3984,-528],"id":"02aed546-b461-4e17-94b1-56503e38af27","name":"Merge1"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"7810277c-c8b5-473c-8c18-bf4461de1f9a","leftValue":"={{ $json[\"Order Detail\"].shipping_number }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"or"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[2608,-704],"id":"71f89459-2757-4a8e-b780-01f99efcc031","name":"Parcel esiste?"},{"parameters":{"assignments":{"assignments":[{"id":"3f32699c-d3ca-414e-b4a2-4373d1e9b454","name":"[\"Order Detail\"].shipping_number","value":"={{ \"Tracking number non ancora rilasciato dal corriere\" }}","type":"string"}]},"includeOtherFields":true,"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[3072,-800],"id":"b3c896de-76e4-469f-b696-4400be8a74b8","name":"Edit Fields"},{"parameters":{"jsCode":"function formatDate(dateStr) {\n  const d = new Date(dateStr);\n  return isNaN(d) ? null : d.toISOString().split(''T'')[0];\n}\n\nfunction formatStatusEntry(state) {\n  return `${formatDate(state.date)}: ${state.status}`;\n}\n\nfunction cleanObject(obj) {\n  if (Array.isArray(obj)) {\n    return obj.map(cleanObject).filter(v => v !== null && v !== undefined && v !== '''');\n  }\n  if (typeof obj === ''object'' && obj !== null) {\n    return Object.fromEntries(Object.entries(obj).map(([k, v]) => [k, cleanObject(v)]).filter(([_, v]) => v !== null && v !== undefined && v !== ''''));\n  }\n  return obj;\n}\n\ntry {\n  const input = $input.all();\n  let shipment;\n\n  for (const item of input) {\n    if (item.json.shipments?.length) {\n      shipment = item.json.shipments[0];\n      break;\n    }\n  }\n\n  if (!shipment) {\n    return [{ json: { error: true, message: \"Nessun shipment valido trovato.\" } }];\n  }\n\n  const trackingId = shipment.trackingId || shipment.attributes?.find(attr => attr.l === ''tracking_id'')?.val || null;\n  const trackingUrl = shipment.externalTracking?.[0]?.url || null;\n  const carrierName = shipment.carrier?.name || null;\n  const states = shipment.states || [];\n\n  const sortedStates = [...states].sort((a, b) => new Date(b.date) - new Date(a.date));\n  const latestState = sortedStates[0];\n  const formattedHistory = sortedStates.map(formatStatusEntry);\n\n  const departureEntry = [...states].sort((a, b) => new Date(a.date) - new Date(b.date))[0];\n  const departureDate = departureEntry ? departureEntry.date : null;\n\n  const deliveredEntry = states.find(s =>\n    [\"consegnato\", \"delivered\"].some(kw => s.status?.toLowerCase().includes(kw))\n  );\n  const arrivalDate = deliveredEntry ? deliveredEntry.date : null;\n\n  const transitDays = shipment.attributes?.find(attr => attr.l === ''days_transit'')?.val || null;\n\n  const shipmentPayload = cleanObject({\n    tracking_number: trackingId,\n    tracking_url: trackingUrl,\n    carrier_name: carrierName,\n    latest_status: latestState?.status || null,\n    latest_status_date: latestState?.date || null,\n    departure_date: departureDate,\n    arrival_date: arrivalDate,\n    transit_days: transitDays,\n    delivery_history: formattedHistory\n  });\n\n  return [{ json: { shipment: shipmentPayload } }];\n\n} catch (error) {\n  return [{\n    json: {\n      error: true,\n      message: error.message\n    }\n  }];\n}\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[3680,-384],"id":"22521d73-51a3-4590-8a9e-a9e0cbdba259","name":"Clean Data for Agent","notes":"// ‚úÖ Nodo Code: Tracking GLS, solo un output pulito e unico\n\nfunction formatDate(dateStr) {\n  const d = new Date(dateStr);\n  return isNaN(d) ? null : d.toISOString().split(''T'')[0];\n}\n\nfunction formatStatusEntry(state) {\n  return `${formatDate(state.date)}: ${state.status}`;\n}\n\nfunction cleanObject(obj) {\n  if (Array.isArray(obj)) {\n    return obj.map(cleanObject).filter(v => v !== null && v !== undefined && v !== '''');\n  }\n  if (typeof obj === ''object'' && obj !== null) {\n    return Object.fromEntries(Object.entries(obj).map(([k, v]) => [k, cleanObject(v)]).filter(([_, v]) => v !== null && v !== undefined && v !== ''''));\n  }\n  return obj;\n}\n\ntry {\n  const input = $input.all();\n  let shipment;\n\n  // ‚úÖ Trova il primo shipment valido\n  for (const item of input) {\n    if (item.json.shipments?.length) {\n      shipment = item.json.shipments[0];\n      break;\n    }\n  }\n\n  if (!shipment) {\n    return [{ json: { error: true, message: \"Nessun shipment valido trovato.\" } }];\n  }\n\n  const trackingId = shipment.trackingId || shipment.attributes?.find(attr => attr.l === ''tracking_id'')?.val || null;\n  const trackingUrl = shipment.externalTracking?.[0]?.url || null;\n  const carrierName = shipment.carrier?.name || null;\n  const states = shipment.states || [];\n\n  const sortedStates = [...states].sort((a, b) => new Date(b.date) - new Date(a.date));\n  const latestState = sortedStates[0];\n\n  const formattedHistory = sortedStates.map(formatStatusEntry);\n\n  const departureEntry = [...states].sort((a, b) => new Date(a.date) - new Date(b.date))[0];\n  const departureDate = departureEntry ? departureEntry.date : null;\n\n  const deliveredEntry = states.find(s =>\n    [\"consegnato\", \"delivered\"].some(kw => s.status?.toLowerCase().includes(kw))\n  );\n  const arrivalDate = deliveredEntry ? deliveredEntry.date : null;\n\n  const transitDays = shipment.attributes?.find(attr => attr.l === ''days_transit'')?.val || null;\n\n  const output = cleanObject({\n    tracking_number: trackingId,\n    tracking_url: trackingUrl,\n    carrier_name: carrierName,\n    latest_status: latestState?.status || null,\n    latest_status_date: latestState?.date || null,\n    departure_date: departureDate,\n    arrival_date: arrivalDate,\n    transit_days: transitDays,\n    delivery_history: formattedHistory\n  });\n\n  return [{ json: output }];\n\n} catch (error) {\n  return [{\n    json: {\n      error: true,\n      message: error.message\n    }\n  }];\n}\n"},{"parameters":{"content":"## VERIFICA PARCEL NUMBER\n√†√† CHIAMATE API\n","height":620,"width":960,"color":7},"type":"n8n-nodes-base.stickyNote","position":[2368,-448],"typeVersion":1,"id":"ee330447-4381-4511-be56-4ad52131a7da","name":"Sticky Note1"},{"parameters":{"content":"## CLEAN DATA E MERGE PER AGENT\n","height":560,"width":660,"color":5},"type":"n8n-nodes-base.stickyNote","position":[3552,-768],"typeVersion":1,"id":"645e7976-f21e-4033-8b4e-d627df00182d","name":"Sticky Note2"},{"parameters":{"jsCode":"// üîÑ Funzione ricorsiva per flattenare qualsiasi struttura JSON, inclusi array\nfunction flatten(obj, parentKey = '''', res = {}) {\n  for (const [key, value] of Object.entries(obj)) {\n    const newKey = parentKey ? `${parentKey}_${key}` : key;\n    if (Array.isArray(value)) {\n      value.forEach((el, index) => {\n        if (typeof el === ''object'' && el !== null) {\n          flatten(el, `${newKey}_${index}`, res);\n        } else {\n          res[`${newKey}_${index}`] = el;\n        }\n      });\n    } else if (typeof value === ''object'' && value !== null) {\n      flatten(value, newKey, res);\n    } else {\n      res[newKey] = value;\n    }\n  }\n  return res;\n}\n\n// üîÅ Unisci tutti gli input JSON in un singolo oggetto\nconst combined = $input.all().reduce((acc, item) => {\n  return { ...acc, ...item.json };\n}, {});\n\n// üì¶ Flat di tutto il contenuto\nconst flatJson = flatten(combined);\n\n// üß† Aggiungi chatbotResponse (opzionale ma utile)\nflatJson.chatbotResponse = combined.orderFound\n  ? `‚úÖ Ordine trovato: ${combined.order?.reference}`\n  : `‚ùå Ordine non trovato.`;\n\nreturn [{ json: flatJson }];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[4208,-528],"id":"b89fd1c7-bfdc-4895-89f9-68177960f4d2","name":"Final response fro Agent"},{"parameters":{"jsCode":"const raw = $json.query || '''';\n\n// Estrae tutte le sequenze di lettere maiuscole di almeno 5 caratteri\nconst matches = raw.match(/\\b[A-Z]{5,}\\b/g);\n\n// Restituisce solo il primo match, oppure stringa vuota se nulla trovato\nreturn [{\n  json: {\n    query: matches ? matches[0] : ''''\n  }\n}];\n"},"name":"Pulisci codice1","type":"n8n-nodes-base.code","typeVersion":2,"position":[624,-496],"id":"ab872640-4092-40e3-b531-4f8757739906"}]', '{"When Executed by Another Workflow":{"main":[[{"node":"Pulisci codice1","type":"main","index":0}]]},"Pulisci codice":{"main":[[]]},"Ottieni Ordine":{"main":[[{"node":"Verifica Ordine","type":"main","index":0}],[]]},"Verifica Ordine":{"main":[[{"node":"If","type":"main","index":0}]]},"Estrai orderDetails":{"main":[[{"node":"Crea Chiamate","type":"main","index":0}]]},"Crea Chiamate":{"main":[[{"node":"HTTP x3 dinamico","type":"main","index":0}]]},"HTTP x3 dinamico":{"main":[[{"node":"Unisce i campi di tutti i nodi","type":"main","index":0}],[]]},"If":{"main":[[{"node":"Estrai orderDetails","type":"main","index":0}],[{"node":"Risposta Ordine Non Trovato","type":"main","index":0}]]},"Unisce i campi di tutti i nodi":{"main":[[{"node":"Parcel esiste?","type":"main","index":0}]]},"Risposta Ordine Non Trovato":{"main":[[]]},"Clean data x Chatbot":{"main":[[{"node":"Merge1","type":"main","index":0}]]},"HTTP Request (POST Tracking)1":{"main":[[{"node":"If1","type":"main","index":0}]]},"Wait (10 seconds)":{"main":[[{"node":"HTTP Request (GET Tracking Status)1","type":"main","index":0}]]},"Input: Tracking Details":{"main":[[{"node":"HTTP Request (POST Tracking)1","type":"main","index":0}]]},"If1":{"main":[[{"node":"Clean Data for Agent","type":"main","index":0}],[{"node":"Wait (10 seconds)","type":"main","index":0}]]},"HTTP Request (GET Tracking Status)1":{"main":[[{"node":"Clean Data for Agent","type":"main","index":0}]]},"Merge1":{"main":[[{"node":"Final response fro Agent","type":"main","index":0}]]},"Parcel esiste?":{"main":[[{"node":"Edit Fields","type":"main","index":0}],[{"node":"Clean data x Chatbot","type":"main","index":0},{"node":"Input: Tracking Details","type":"main","index":0}]]},"Edit Fields":{"main":[[{"node":"Clean data x Chatbot","type":"main","index":0}]]},"Clean Data for Agent":{"main":[[{"node":"Merge1","type":"main","index":1}]]},"Pulisci codice1":{"main":[[{"node":"Ottieni Ordine","type":"main","index":0}]]}}', '{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","errorWorkflow":"1LreJWx0H8iEqkgn"}', NULL, '{}', 'bc655318-2953-4cba-81f7-a3037f8aa221', 0, NULL, NULL, '2025-06-17T21:08:27.871Z', '2025-09-23T18:04:11.000Z', false),
  ('0953b9c8-4699-48fb-9ae1-d697b6d90c3c', 'Wathapp Agent', false, '[{"parameters":{"updates":["messages"],"options":{}},"type":"n8n-nodes-base.whatsAppTrigger","typeVersion":1,"position":[-400,280],"id":"838dd158-2317-426f-b077-ce338aa95565","name":"WhatsApp Trigger","webhookId":"d3978cae-2aca-4553-8ac7-ab89068deabc"},{"parameters":{"promptType":"define","text":"={{ $json.text }}","options":{"systemMessage":"=You are a helpful assistant called Sam.\n\nYou are currently talking to  {{ $(''WhatsApp Trigger'').item.json.contacts[0].profile.name }}\n\nThe current date and time is {{ $now.toString() }}"}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.9,"position":[1132,280],"id":"0c414a03-1bd4-4cd7-a12c-d90a88ea0016","name":"AI Agent"},{"parameters":{"sessionIdType":"customKey","sessionKey":"={{ $(''WhatsApp Trigger'').item.json.messages[0].from }}","contextWindowLength":20},"type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1.3,"position":[1040,500],"id":"b2c4f1b8-8302-413c-b647-d99a8566658f","name":"Simple Memory"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"b7b64446-f1ea-4622-990c-22f3999a8269","leftValue":"={{ $json.messages[0].audio }}","rightValue":"","operator":{"type":"object","operation":"exists","singleValue":true}}],"combinator":"and"},"renameOutput":true,"outputKey":"Voice"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"202af928-a324-411a-bf15-68a349e7bf9e","leftValue":"={{ $json.messages[0].image }}","rightValue":"","operator":{"type":"object","operation":"exists","singleValue":true}}],"combinator":"and"},"renameOutput":true,"outputKey":"Image"},{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"leftValue":"={{ $json.messages[0].text.body }}","rightValue":"","operator":{"type":"string","operation":"exists","singleValue":true},"id":"08fd0c80-307e-4f45-b1de-35192ee4ec5e"}],"combinator":"and"},"renameOutput":true,"outputKey":"Text"}]},"options":{}},"type":"n8n-nodes-base.switch","typeVersion":3.2,"position":[-180,280],"id":"c08f147e-6f58-4730-9263-7a67d4fd7143","name":"Check Input Type"},{"parameters":{"resource":"media","operation":"mediaUrlGet","mediaGetId":"={{ $(''WhatsApp Trigger'').item.json.messages[0].image.id }}"},"type":"n8n-nodes-base.whatsApp","typeVersion":1,"position":[40,280],"id":"161dfaa1-1297-4c87-b00b-5ac74754a719","name":"Get Image URL","webhookId":"280bd5de-32d7-4d8f-93d2-e91e3b0bc161"},{"parameters":{"url":"={{ $json.url }}","authentication":"genericCredentialType","genericAuthType":"httpHeaderAuth","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[260,280],"id":"f884b0dc-0afb-4fab-b8ce-3fd956167926","name":"Download Image"},{"parameters":{"resource":"image","operation":"analyze","modelId":{"__rl":true,"value":"chatgpt-4o-latest","mode":"list","cachedResultName":"CHATGPT-4O-LATEST"},"text":"=Describe the image in detail.","inputType":"base64","options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[480,280],"id":"02c5240a-d966-40eb-a4fe-73e9c2863c30","name":"Analyze Image"},{"parameters":{"assignments":{"assignments":[{"id":"67552183-de2e-494a-878e-c2948e8cb6bb","name":"text","value":"=# The user provided the following image and text.\n\n## IMAGE CONTENT:\n{{ $json.content }}\n\n## USER MESSAGE:\n{{ $(''WhatsApp Trigger'').item.json.messages[0].image.caption || \"Describe the image\" }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[700,280],"id":"e1e62462-6ba1-416c-b015-a4ee90c9bde7","name":"Image + Text Prompt"},{"parameters":{"assignments":{"assignments":[{"id":"c05a7fbf-309a-407e-9fee-7e0b03f4a5c8","name":"text","value":"={{ $(''WhatsApp Trigger'').item.json.messages[0].text.body }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[700,480],"id":"6f1c8c5c-d018-4b14-a0eb-02f6786d7047","name":"Text Only Prompt"},{"parameters":{"resource":"media","operation":"mediaUrlGet","mediaGetId":"={{ $(''WhatsApp Trigger'').item.json.messages[0].audio.id }}"},"type":"n8n-nodes-base.whatsApp","typeVersion":1,"position":[40,80],"id":"c6b5ee02-e242-4dce-b72f-db67dab09bcb","name":"Get Audio URL","webhookId":"87caa300-7204-47b5-959a-94f4a8fbf8cf"},{"parameters":{"url":"={{ $json.url }}","authentication":"genericCredentialType","genericAuthType":"httpHeaderAuth","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[260,80],"id":"1312c336-173c-4657-b7f8-fbe1ed6c2cde","name":"Download Audio"},{"parameters":{"resource":"audio","operation":"transcribe","options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[480,80],"id":"b74de395-9a59-4b71-81ef-a8dfb6dfd5e1","name":"Transcribe Audio"},{"parameters":{"assignments":{"assignments":[{"id":"219577d5-b028-48fc-90be-980f4171ab68","name":"text","value":"={{ $json.text }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[700,80],"id":"0078426d-7550-451b-bbe5-6cf00f8a18c8","name":"Audio Prompt"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"b9d1d759-f585-4791-a743-b9d72951e77c","leftValue":"={{ $(''WhatsApp Trigger'').item.json.messages[0].audio }}","rightValue":"","operator":{"type":"object","operation":"exists","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[1896,280],"id":"93553b7e-ec3a-42e7-bc25-31c5f7072098","name":"If"},{"parameters":{"resource":"audio","input":"={{ $(''AI Agent'').item.json.output }}","options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[2116,180],"id":"6660f03b-e749-47a4-bf99-e3922607f485","name":"Generate Audio"},{"parameters":{"operation":"send","phoneNumberId":"175940715605000","recipientPhoneNumber":"={{ $(''Check Input Type'').item.json.contacts[0].wa_id }}","messageType":"audio","mediaPath":"useMedian8n","additionalFields":{}},"type":"n8n-nodes-base.whatsApp","typeVersion":1,"position":[2556,180],"id":"ecc8abb8-2c5b-49e1-8634-7dea7e3a966d","name":"Respond with Audio","webhookId":"d18b2c98-84e4-43cf-a532-0c47d5161684"},{"parameters":{"operation":"send","phoneNumberId":"175940715605000","recipientPhoneNumber":"={{ $(''WhatsApp Trigger'').item.json.messages[0].from }}","textBody":"={{ $json.output }}","additionalFields":{}},"type":"n8n-nodes-base.whatsApp","typeVersion":1,"position":[2116,380],"id":"bea69a2e-7b45-49ff-a72d-448cbc6ba089","name":"Respond with Text","webhookId":"23834751-5066-48ba-8e19-549680df2b27"},{"parameters":{"jsCode":"// Loop over input items and change the MIME type of binary data\nfor (const item of $input.all()) {\n  // Check if the item has binary data\n  if (item.binary) {\n    // Find the binary property name (assuming there''s at least one)\n    const binaryPropertyNames = Object.keys(item.binary);\n    \n    for (const propName of binaryPropertyNames) {\n      // If the MIME type is ''audio/mp3'', change it to ''audio/mpeg''\n      if (item.binary[propName].mimeType === ''audio/mp3'') {\n        item.binary[propName].mimeType = ''audio/mpeg'';\n      }\n    }\n  }\n}\n\nreturn $input.all();"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[2336,180],"id":"54e57757-3174-4a00-ad3c-6e6d28f14339","name":"Fix Mime Type"},{"parameters":{"content":"## Audio","height":240,"width":800},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[20,0],"id":"52041a4d-4c21-47b2-8526-09c53df22175","name":"Sticky Note"},{"parameters":{"content":"## Image & Text","height":280,"width":800,"color":4},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[20,160],"id":"c3dd8fef-2679-4e66-8cb9-9fa1f443eb51","name":"Sticky Note1"},{"parameters":{"content":"## Tools","height":400,"width":820},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[1020,440],"id":"9bff047f-87db-4e5f-9770-20444dd2557a","name":"Sticky Note2"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.toolSerpApi","typeVersion":1,"position":[1160,500],"id":"e95283ed-9f71-4b56-afaf-2dee87979310","name":"Web Search"},{"parameters":{"model":{"__rl":true,"mode":"list","value":"gpt-4o-mini"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[920,500],"id":"5f759462-303e-4a8f-ba01-a3cd1160ecce","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{},"type":"@n8n/n8n-nodes-langchain.toolCalculator","typeVersion":1,"position":[1280,500],"id":"87bdfc24-156b-4f26-83d6-e20f328d2826","name":"Calculator"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1.2,"position":[1488,700],"id":"f465fa1f-3400-4aec-8360-8c5df5850ca5","name":"Embeddings OpenAI"},{"parameters":{"mode":"retrieve-as-tool","toolName":"contacts","toolDescription":"Returns contact information like email addresses.","pineconeIndex":{"__rl":true,"value":"n8n","mode":"list","cachedResultName":"n8n"},"options":{"pineconeNamespace":"contacts"}},"type":"@n8n/n8n-nodes-langchain.vectorStorePinecone","typeVersion":1.1,"position":[1400,502.5],"id":"2ce92b02-a9a9-4d64-bc04-94987378bcc4","name":"Knowledge Base"},{"parameters":{"sseEndpoint":"https://n8n.leonvanzyl.com/mcp/mytools/sse"},"type":"@n8n/n8n-nodes-langchain.mcpClientTool","typeVersion":1,"position":[1696,500],"id":"3e33cd5c-e3cd-4c09-825f-4ce083455cf1","name":"MCP Client"}]', '{"WhatsApp Trigger":{"main":[[{"node":"Check Input Type","type":"main","index":0}]]},"Simple Memory":{"ai_memory":[[{"node":"AI Agent","type":"ai_memory","index":0}]]},"AI Agent":{"main":[[{"node":"If","type":"main","index":0}]]},"Check Input Type":{"main":[[{"node":"Get Audio URL","type":"main","index":0}],[{"node":"Get Image URL","type":"main","index":0}],[{"node":"Text Only Prompt","type":"main","index":0}]]},"Get Image URL":{"main":[[{"node":"Download Image","type":"main","index":0}]]},"Download Image":{"main":[[{"node":"Analyze Image","type":"main","index":0}]]},"Analyze Image":{"main":[[{"node":"Image + Text Prompt","type":"main","index":0}]]},"Text Only Prompt":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"Image + Text Prompt":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"Get Audio URL":{"main":[[{"node":"Download Audio","type":"main","index":0}]]},"Download Audio":{"main":[[{"node":"Transcribe Audio","type":"main","index":0}]]},"Transcribe Audio":{"main":[[{"node":"Audio Prompt","type":"main","index":0}]]},"Audio Prompt":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"If":{"main":[[{"node":"Generate Audio","type":"main","index":0}],[{"node":"Respond with Text","type":"main","index":0}]]},"Generate Audio":{"main":[[{"node":"Fix Mime Type","type":"main","index":0}]]},"Fix Mime Type":{"main":[[{"node":"Respond with Audio","type":"main","index":0}]]},"Web Search":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"Calculator":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"Embeddings OpenAI":{"ai_embedding":[[{"node":"Knowledge Base","type":"ai_embedding","index":0}]]},"Knowledge Base":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"MCP Client":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]}}', '{"executionOrder":"v1"}', NULL, '{}', '6c1e0c32-a9ec-4a78-8270-84d9d5cf1324', 0, NULL, NULL, '2025-06-18T19:22:40.713Z', '2025-06-20T11:22:13.000Z', false),
  ('918235aa-d318-44b1-8a1c-222810e982af', 'My workflow 6', false, '[{"parameters":{"updates":["com.twilio.messaging.inbound-message.received"]},"id":"ad4eeabf-3a6f-4805-8a71-172ad05bd343","name":"Twilio Trigger","type":"n8n-nodes-base.twilioTrigger","position":[-2620,-760],"webhookId":"bfc8f587-8183-46f8-9e76-3576caddf8c0","typeVersion":1},{"parameters":{"options":{}},"id":"39678e4e-b3bf-48d2-b01f-eae90f98ab6f","name":"OpenAI Chat Model1","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","position":[-1580,440],"typeVersion":1},{"parameters":{"operation":"search","base":{"__rl":true,"mode":"list","value":"appO2nHiT9XPuGrjN","cachedResultUrl":"https://airtable.com/appO2nHiT9XPuGrjN","cachedResultName":"Twilio-Scheduling-Agent"},"table":{"__rl":true,"mode":"list","value":"tblokH7uw63RpIlQ0","cachedResultUrl":"https://airtable.com/appO2nHiT9XPuGrjN/tblokH7uw63RpIlQ0","cachedResultName":"Lead Tracker"},"filterByFormula":"=AND(\n {appointment_id} = '''',\n {status} != ''STOP'',\n {followup_count} < 3,\n DATETIME_DIFF(TODAY(), {last_followup_at}, ''days'') >= 3\n)","options":{}},"id":"4ee46422-0a23-49c4-8a93-8055935992cf","name":"Find Follow-Up Candidates","type":"n8n-nodes-base.airtable","position":[-2000,320],"typeVersion":2.1},{"parameters":{"from":"={{ $(''Find Follow-Up Candidates'').item.json.twilio_service_number }}","to":"={{ $(''Find Follow-Up Candidates'').item.json.session_id }}","message":"={{ $(''Generate Follow Up Message'').item.json.text }}\nReply STOP to stop recieving these messages.","options":{}},"id":"85083de2-13b4-4c3b-ae62-732042799ee3","name":"Send Follow Up Message","type":"n8n-nodes-base.twilio","position":[-840,320],"typeVersion":1},{"parameters":{"content":"## Step 6. Filter Open Enquiries from Airtable\n\n### üí°Criteria For Follow Up Candidates\n* No Scheduled Appointment\n* No Request to STOP\n* No Previous Follow-up in Past 3 days\n* Follow-up is less than 3 times","height":515.2449997772154,"width":408.6631332343324,"color":7},"id":"ce165488-5286-445a-a79f-d4b813e13aa3","name":"Sticky Note","type":"n8n-nodes-base.stickyNote","position":[-2140,20],"typeVersion":1},{"parameters":{"operation":"update","base":{"__rl":true,"mode":"list","value":"appO2nHiT9XPuGrjN","cachedResultUrl":"https://airtable.com/appO2nHiT9XPuGrjN","cachedResultName":"Twilio-Scheduling-Agent"},"table":{"__rl":true,"mode":"list","value":"tblokH7uw63RpIlQ0","cachedResultUrl":"https://airtable.com/appO2nHiT9XPuGrjN/tblokH7uw63RpIlQ0","cachedResultName":"Lead Tracker"},"columns":{"value":{"session_id":"={{ $(''Find Follow-Up Candidates'').item.json.session_id }}","followup_count":"={{ ($(''Find Follow-Up Candidates'').item.json.followup_count ?? 0) + 1 }}","last_followup_at":"={{ $now.toISO() }}"},"schema":[{"id":"id","type":"string","display":true,"removed":true,"readOnly":true,"required":false,"displayName":"id","defaultMatch":true},{"id":"session_id","type":"string","display":true,"removed":false,"readOnly":false,"required":false,"displayName":"session_id","defaultMatch":false,"canBeUsedToMatch":true},{"id":"status","type":"options","display":true,"options":[{"name":"ACTIVE","value":"ACTIVE"},{"name":"STOP","value":"STOP"}],"removed":true,"readOnly":false,"required":false,"displayName":"status","defaultMatch":false,"canBeUsedToMatch":true},{"id":"customer_name","type":"string","display":true,"removed":true,"readOnly":false,"required":false,"displayName":"customer_name","defaultMatch":false,"canBeUsedToMatch":true},{"id":"customer_summary","type":"string","display":true,"removed":true,"readOnly":false,"required":false,"displayName":"customer_summary","defaultMatch":false,"canBeUsedToMatch":true},{"id":"chat_messages","type":"string","display":true,"removed":true,"readOnly":false,"required":false,"displayName":"chat_messages","defaultMatch":false,"canBeUsedToMatch":true},{"id":"scheduled_at","type":"dateTime","display":true,"removed":true,"readOnly":false,"required":false,"displayName":"scheduled_at","defaultMatch":false,"canBeUsedToMatch":true},{"id":"appointment_id","type":"string","display":true,"removed":true,"readOnly":false,"required":false,"displayName":"appointment_id","defaultMatch":false,"canBeUsedToMatch":true},{"id":"last_message_at","type":"dateTime","display":true,"removed":true,"readOnly":false,"required":false,"displayName":"last_message_at","defaultMatch":false,"canBeUsedToMatch":true},{"id":"last_followup_at","type":"dateTime","display":true,"removed":false,"readOnly":false,"required":false,"displayName":"last_followup_at","defaultMatch":false,"canBeUsedToMatch":true},{"id":"followup_count","type":"number","display":true,"removed":false,"readOnly":false,"required":false,"displayName":"followup_count","defaultMatch":false,"canBeUsedToMatch":true},{"id":"assignee","type":"string","display":true,"removed":true,"readOnly":false,"required":false,"displayName":"assignee","defaultMatch":false,"canBeUsedToMatch":true}],"mappingMode":"defineBelow","matchingColumns":["session_id"]},"options":{}},"id":"cc825c02-8615-4844-b8cb-b41166739814","name":"Update Follow-Up Count and Date","type":"n8n-nodes-base.airtable","position":[-1020,320],"typeVersion":2.1},{"parameters":{"operation":"update","base":{"__rl":true,"mode":"list","value":"appO2nHiT9XPuGrjN","cachedResultUrl":"https://airtable.com/appO2nHiT9XPuGrjN","cachedResultName":"Twilio-Scheduling-Agent"},"table":{"__rl":true,"mode":"list","value":"tblokH7uw63RpIlQ0","cachedResultUrl":"https://airtable.com/appO2nHiT9XPuGrjN/tblokH7uw63RpIlQ0","cachedResultName":"Lead Tracker"},"columns":{"value":{"session_id":"={{ $(''Twilio Trigger'').item.json.From }}","scheduled_at":"={{\n$(''Appointment Scheduling Agent'').item.json.output.has_appointment_scheduled\n ? $(''Appointment Scheduling Agent'').item.json.output.appointment.scheduled_at\n : (\n $(''Get Existing Chat Session'').item.json.isNotEmpty()\n ? $(''Get Existing Chat Session'').item.json.scheduled_at\n : $now.toISO()\n )\n}}","chat_messages":"={{\nJSON.stringify(\n ($(''Get Existing Chat Session'').item.json.chat_messages ? JSON.parse($(''Get Existing Chat Session'').item.json.chat_messages) : [])\n .concat(\n { \"role\": \"human\", \"message\": $(''Twilio Trigger'').item.json.Body },\n { \"role\": \"assistant\", \"message\": $(''Appointment Scheduling Agent'').item.json.output.reply }\n )\n)\n}}","customer_name":"={{\n !$(''Get Existing Chat Session'').item.json.customer_name &&\n $(''Appointment Scheduling Agent'').item.json.output.customer_name\n ? $(''Appointment Scheduling Agent'').item.json.output.customer_name\n : ($(''Get Existing Chat Session'').item.json.customer_name ?? '''')\n}}","appointment_id":"={{\n$(''Appointment Scheduling Agent'').item.json.output.has_appointment_scheduled\n ? $(''Appointment Scheduling Agent'').item.json.output.appointment.appointment_id\n : (\n $(''Get Existing Chat Session'').item.json.isNotEmpty()\n ? $(''Get Existing Chat Session'').item.json.appointment_id\n : ''''\n )\n}}","followup_count":"={{\n !$(''Get Existing Chat Session'').item.json.followup_count\n ? 0\n : $(''Get Existing Chat Session'').item.json.followup_count\n}}","last_message_at":"={{ $now.toISO() }}","customer_summary":"={{\n !$(''Get Existing Chat Session'').item.json.appointment_id\n && $(''Appointment Scheduling Agent'').item.json.output.has_appointment_scheduled\n ? $json.output.enquiry_summary\n : $(''Get Existing Chat Session'').item.json.customer_summary\n}}","last_followup_at":"={{\n !$(''Get Existing Chat Session'').item.json.last_followup_at\n ? $now.toISO()\n : $(''Get Existing Chat Session'').item.json.last_followup_at\n}}","twilio_service_number":"={{ $(''Twilio Trigger'').item.json.To }}"},"schema":[{"id":"id","type":"string","display":true,"removed":true,"readOnly":true,"required":false,"displayName":"id","defaultMatch":true},{"id":"session_id","type":"string","display":true,"removed":false,"readOnly":false,"required":false,"displayName":"session_id","defaultMatch":false,"canBeUsedToMatch":true},{"id":"status","type":"options","display":true,"options":[{"name":"ACTIVE","value":"ACTIVE"},{"name":"STOP","value":"STOP"}],"removed":true,"readOnly":false,"required":false,"displayName":"status","defaultMatch":false,"canBeUsedToMatch":true},{"id":"customer_name","type":"string","display":true,"removed":false,"readOnly":false,"required":false,"displayName":"customer_name","defaultMatch":false,"canBeUsedToMatch":true},{"id":"customer_summary","type":"string","display":true,"removed":false,"readOnly":false,"required":false,"displayName":"customer_summary","defaultMatch":false,"canBeUsedToMatch":true},{"id":"chat_messages","type":"string","display":true,"removed":false,"readOnly":false,"required":false,"displayName":"chat_messages","defaultMatch":false,"canBeUsedToMatch":true},{"id":"scheduled_at","type":"dateTime","display":true,"removed":false,"readOnly":false,"required":false,"displayName":"scheduled_at","defaultMatch":false,"canBeUsedToMatch":true},{"id":"appointment_id","type":"string","display":true,"removed":false,"readOnly":false,"required":false,"displayName":"appointment_id","defaultMatch":false,"canBeUsedToMatch":true},{"id":"last_message_at","type":"dateTime","display":true,"removed":false,"readOnly":false,"required":false,"displayName":"last_message_at","defaultMatch":false,"canBeUsedToMatch":true},{"id":"last_followup_at","type":"dateTime","display":true,"removed":false,"readOnly":false,"required":false,"displayName":"last_followup_at","defaultMatch":false,"canBeUsedToMatch":true},{"id":"followup_count","type":"number","display":true,"removed":false,"readOnly":false,"required":false,"displayName":"followup_count","defaultMatch":false,"canBeUsedToMatch":true},{"id":"assignee","type":"string","display":true,"removed":true,"readOnly":false,"required":false,"displayName":"assignee","defaultMatch":false,"canBeUsedToMatch":true},{"id":"twilio_service_number","type":"string","display":true,"removed":false,"readOnly":false,"required":false,"displayName":"twilio_service_number","defaultMatch":false,"canBeUsedToMatch":true}],"mappingMode":"defineBelow","matchingColumns":["session_id"]},"options":{}},"id":"0674f420-e4b4-449a-a8b0-42186d6f9c20","name":"Create/Update Session","type":"n8n-nodes-base.airtable","position":[-480,-660],"typeVersion":2.1},{"parameters":{"operation":"search","base":{"__rl":true,"mode":"list","value":"appO2nHiT9XPuGrjN","cachedResultUrl":"https://airtable.com/appO2nHiT9XPuGrjN","cachedResultName":"Twilio-Scheduling-Agent"},"table":{"__rl":true,"mode":"list","value":"tblokH7uw63RpIlQ0","cachedResultUrl":"https://airtable.com/appO2nHiT9XPuGrjN/tblokH7uw63RpIlQ0","cachedResultName":"Lead Tracker"},"filterByFormula":"={session_id}=\"{{ $(''Twilio Trigger'').item.json.From }}\"","returnAll":false,"limit":1,"options":{}},"id":"86c61b3d-811f-4a96-b321-5228857cfe3a","name":"Get Existing Chat Session","type":"n8n-nodes-base.airtable","position":[-1980,-700],"typeVersion":2.1,"alwaysOutputData":true},{"parameters":{"rule":{"interval":[{}]}},"id":"70a2caf3-21ca-4bd3-810d-8e97f4ed554d","name":"Every 24hrs","type":"n8n-nodes-base.scheduleTrigger","position":[-2500,240],"typeVersion":1.2},{"parameters":{"from":"={{ $(''Twilio Trigger'').item.json.To }}","to":"={{ $(''Twilio Trigger'').item.json.From }}","message":"={{ $(''Appointment Scheduling Agent'').item.json.output.reply }}","options":{}},"id":"4c150b62-24c3-403a-96bf-b88d1fe0899c","name":"Send Reply","type":"n8n-nodes-base.twilio","position":[-300,-660],"typeVersion":1},{"parameters":{"from":"={{ $(''Twilio Trigger'').item.json.To }}","to":"={{ $(''Twilio Trigger'').item.json.From }}","message":"Thank you. You won''t receive any more messages from us!","options":{}},"id":"6f30595a-3138-4e28-aca0-725687d81ce1","name":"Send Confirmation","type":"n8n-nodes-base.twilio","position":[-1820,-1220],"typeVersion":1},{"parameters":{"operation":"update","base":{"__rl":true,"mode":"list","value":"appO2nHiT9XPuGrjN","cachedResultUrl":"https://airtable.com/appO2nHiT9XPuGrjN","cachedResultName":"Twilio-Scheduling-Agent"},"table":{"__rl":true,"mode":"list","value":"tblokH7uw63RpIlQ0","cachedResultUrl":"https://airtable.com/appO2nHiT9XPuGrjN/tblokH7uw63RpIlQ0","cachedResultName":"Lead Tracker"},"columns":{"value":{"status":"STOP","session_id":"={{ $(''Twilio Trigger'').item.json.From }}"},"schema":[{"id":"id","type":"string","display":true,"removed":true,"readOnly":true,"required":false,"displayName":"id","defaultMatch":true},{"id":"session_id","type":"string","display":true,"removed":false,"readOnly":false,"required":false,"displayName":"session_id","defaultMatch":false,"canBeUsedToMatch":true},{"id":"status","type":"options","display":true,"options":[{"name":"ACTIVE","value":"ACTIVE"},{"name":"STOP","value":"STOP"}],"removed":false,"readOnly":false,"required":false,"displayName":"status","defaultMatch":false,"canBeUsedToMatch":true},{"id":"chat_messages","type":"string","display":true,"removed":true,"readOnly":false,"required":false,"displayName":"chat_messages","defaultMatch":false,"canBeUsedToMatch":true},{"id":"scheduled_at","type":"dateTime","display":true,"removed":true,"readOnly":false,"required":false,"displayName":"scheduled_at","defaultMatch":false,"canBeUsedToMatch":true},{"id":"last_message_at","type":"dateTime","display":true,"removed":true,"readOnly":false,"required":false,"displayName":"last_message_at","defaultMatch":false,"canBeUsedToMatch":true},{"id":"last_followup_at","type":"dateTime","display":true,"removed":true,"readOnly":false,"required":false,"displayName":"last_followup_at","defaultMatch":false,"canBeUsedToMatch":true},{"id":"followup_count","type":"number","display":true,"removed":true,"readOnly":false,"required":false,"displayName":"followup_count","defaultMatch":false,"canBeUsedToMatch":true},{"id":"assignee","type":"string","display":true,"removed":true,"readOnly":false,"required":false,"displayName":"assignee","defaultMatch":false,"canBeUsedToMatch":true}],"mappingMode":"defineBelow","matchingColumns":["session_id"]},"options":{}},"id":"971eeb61-141d-41de-886a-a1696010f6f7","name":"User Request STOP","type":"n8n-nodes-base.airtable","position":[-2060,-1220],"typeVersion":2.1},{"parameters":{"rules":{"values":[{"conditions":{"options":{"leftValue":"","caseSensitive":true,"typeValidation":"strict"},"combinator":"and","conditions":[{"operator":{"type":"string","operation":"contains"},"leftValue":"={{ $json.Body }}","rightValue":"STOP"}]},"renameOutput":true,"outputKey":"STOP"}]},"options":{"fallbackOutput":"extra"}},"id":"9cea5366-9041-48b0-94c5-cc3a412ea7cf","name":"Check For Command Words","type":"n8n-nodes-base.switch","position":[-2420,-760],"typeVersion":3},{"parameters":{"jsonSchemaExample":"{\n \"reply\": \"\",\n \"customer_name\": \"\",\n \"enquiry_summary\": \"\",\n\t\"has_appointment_scheduled\": false,\n \"appointment\": {\n \"appointment_id\": \"\",\n \"scheduled_at\": \"\"\n }\n}"},"id":"664ebe8b-ac5c-46fb-8dea-d2ee769ccb5f","name":"Structured Output Parser","type":"@n8n/n8n-nodes-langchain.outputParserStructured","position":[-760,-380],"typeVersion":1.2},{"parameters":{"options":{}},"id":"1f6079eb-2d3a-4994-a0cb-3d770fe602ff","name":"Auto-fixing Output Parser","type":"@n8n/n8n-nodes-langchain.outputParserAutofixing","position":[-900,-500],"typeVersion":1},{"parameters":{"options":{}},"id":"292d3188-712e-4861-96f2-72592e67805c","name":"OpenAI Chat Model2","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","position":[-880,-380],"typeVersion":1},{"parameters":{"content":"## Step 3. Appointment Scheduling With AI\n[Learn about using AI Agents](https://docs.n8n.io/integrations/builtin/cluster-nodes/root-nodes/n8n-nodes-langchain.agent)\n\nUsing an AI Agent is a powerful way to simplify and enhance workflows using the latest in AI technology. Our appointment scheduling agent is equipped to converse with the customer and all the necessary tools to schedule, re-schedule and cancel appointments.\n\nUsing the **HTTP Tool** node, it''s easy to connect to third party API services to perform actions. In this workflow, we''re calling the Cal.com API to handle scheduling events.","height":917.533068142247,"width":1011.8938194478603,"color":7},"id":"7da6f41a-337c-40e6-b90e-26f49b12d842","name":"Sticky Note3","type":"n8n-nodes-base.stickyNote","position":[-1640,-980],"typeVersion":1},{"parameters":{"content":"## Step 2. Check for Existing Chat History\n[Read more about using Airtable](https://docs.n8n.io/integrations/builtin/app-nodes/n8n-nodes-base.airtable)\n\nWe''re using Airtable for customer session management and to capture chat history. Airtable is an ideal choice because it acts as a persistent database with a flexible API which could prove essential for further extension.\n\nWe''ll pull any previous chat history and pass this to our agent to continue the conversation.","height":557.8466102697549,"width":504.0066355303578,"color":7},"id":"2db2131d-f097-4514-ac51-bda1807e5e61","name":"Sticky Note4","type":"n8n-nodes-base.stickyNote","position":[-2160,-980],"typeVersion":1},{"parameters":{"content":"## Step 1. Wait For Customer SMS\n[Read more about Twilio trigger](https://docs.n8n.io/integrations/builtin/trigger-nodes/n8n-nodes-base.twiliotrigger)\n\nFor this workflow, we''ll use the twilio SMS trigger to receive enquiries from customers looking to book a PC or laptop repair.\n\nSince we''ll be working with SMS, we''ll have a check to see if the customer wishes to STOP any further follow-up messages. This is an optional step that we''ll get to later.","height":479.4432905734608,"width":523.6927529886705,"color":7},"id":"47797c45-be48-49d2-bfb9-8fd19c00ec2d","name":"Sticky Note5","type":"n8n-nodes-base.stickyNote","position":[-2720,-1000],"typeVersion":1},{"parameters":{"content":"## Step 9. Cancelling Follow-Up Messages \n\nIf the customer messages the bot with the word STOP, we''ll update our customer record in Airtable which will prevent further follow-ups from being trigger. A confirmation message is sent after to the customer.","height":358.6710117357418,"width":563.7797724327219,"color":7},"id":"aa1fdcb0-8d2b-4937-91fc-0a19e09280e4","name":"Sticky Note6","type":"n8n-nodes-base.stickyNote","position":[-2180,-1380],"typeVersion":1},{"parameters":{"content":"## Step 4. Updating Airtable and Responding to the Customer \n[Read more about using Twilio](https://docs.n8n.io/integrations/builtin/app-nodes/n8n-nodes-base.twilio)\n\nOnce the agent formulates a response, we can update our appointment table accordingly ensuring the conversation at any stage is captured.\n\nIf no appointment is scheduled, we can move onto the second half of this workflow which covers following up with prospective customers and their enquiries.","height":558.7093446159199,"width":521.5259177258192,"color":7},"id":"7ca46aec-ef38-4953-9eb9-2e1dcc23faf7","name":"Sticky Note7","type":"n8n-nodes-base.stickyNote","position":[-600,-980],"typeVersion":1},{"parameters":{"content":"## Step 5. Following Up With Open Enquiries\n[Read more about using scheduled trigger](https://docs.n8n.io/integrations/builtin/core-nodes/n8n-nodes-base.scheduletrigger)\n\nThe second half of this workflow deals with identifying customers who have engaged our chatbot but have not yet confirmed an appointment. We intend to send a follow-up message asking if the enquiry is still valid and encourage an appointment to be made with the customer.","height":433.74984757777247,"width":509.931737588259,"color":7},"id":"6f2acbf8-b47e-404c-a619-6cd89cf11f1a","name":"Sticky Note8","type":"n8n-nodes-base.stickyNote","position":[-2700,20],"typeVersion":1},{"parameters":{"content":"## Step 7. Generating a Follow-Up Message\n[Read more about Basic LLM Chain](https://docs.n8n.io/integrations/builtin/cluster-nodes/root-nodes/n8n-nodes-langchain.chainllm)\n\nWith our session and chat history retrieved from Airtable, we can simple ask our AI to generate a nicely worded follow-up message to re-engage the customer.\n\nWhere the logic is linear, the Basic LLM chain is suitable for many workflows. An agent is not always required!","height":601.5572296901626,"width":567.1169284476533,"color":7},"id":"70798273-5d37-4578-8fd2-29d463111f76","name":"Sticky Note1","type":"n8n-nodes-base.stickyNote","position":[-1720,20],"typeVersion":1},{"parameters":{"promptType":"define","text":"=","messages":{"messageValues":[{"message":"=You are an appointment scheduling assistant for PC and Laptop Repairs for a company called \"PC Parts Ltd\". You shall refer to yourself as the \"service team\". You had a conversation with a customer on {{ $json.last_message_at }} but the enquiry did not end with an appointment being scheduled.\n{{ $json.last_followup_at ? `You last sent a follow-up message on ${$json.last_followup_at}` : '''' }}.\n\nYou task is to ask if the prospective customer would like to continue with the enquiry using the following information gather to construct a relevant follow-up message. Try to entice the user to continue the conversation and ultimately schedule an appointment.\n\n## About the customer\nname: {{ $json.customer_name ?? ''<unknown>'' }}\nenquiry summary: {{ $json.customer_summary ?? ''<uknown>'' }}\n\n# Existing conversation\nHere are the chat logs of the existing conversation:\n{{ $json.chat_messages }}"}]}},"id":"4e12dd91-ade2-41ae-b665-ee24c57441cf","name":"Generate Follow Up Message","type":"@n8n/n8n-nodes-langchain.chainLlm","position":[-1580,280],"typeVersion":1.4},{"parameters":{"content":"## Step 8. Update Follow-Up Properties and Send Message\n[Read more about using Twilio](https://docs.n8n.io/integrations/builtin/app-nodes/n8n-nodes-base.twilio/)\n\nFinally, we''ll update our follow-up activity as part of the customer record in Airtable. Keeping track of the number of times we follow-up helps prevent spamming the customer unnecessarily.\n\nThe follow-up message is sent via Twilio and includes instruction to disable further follow-up messages using the keyword STOP.","height":526.084030034264,"width":496.0833287715134,"color":7},"id":"a2bb2ff4-d396-4bde-b1a4-01b0833006b3","name":"Sticky Note2","type":"n8n-nodes-base.stickyNote","position":[-1120,20],"typeVersion":1},{"parameters":{"content":"## Try It Out!\n\n### This workflow implements an appointment scheduling chatbot which is powered by an AI tools agent.\n* Workflow is triggered by Customer enquires sent via SMS\n* Customer session management and chat history are captured in Airtable to enable the SMS conversation.\n* An AI Agent is equipped to answer any questions as well as schedule, re-schedule and cancel appointments on behalf of the customer.\n* The agent''s reply is sent back to the customer via SMS.\n* Additional a follow-up system is implemented to re-engage customers who haven''t scheduled an appointment.\n\n \n### Need Help?\nJoin the [Discord](https://discord.com/invite/XPKeKXeB7d) or ask in the [Forum](https://community.n8n.io/)!\n\nHappy Hacking!","height":511.67220311821393,"width":437.0019498737189},"id":"b918678b-660b-43ab-90f9-7acf143472b2","name":"Sticky Note9","type":"n8n-nodes-base.stickyNote","position":[-3200,-1020],"typeVersion":1},{"parameters":{"options":{}},"id":"1c309c5c-ecf9-4946-8381-d098f05b7937","name":"OpenAI Chat Model3","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","position":[-1600,-520],"typeVersion":1},{"parameters":{"toolDescription":"Call this tool to get the appointment availability. Dates can be variable but times are fixed - startTime must always be 9am and endTime must be 7pm. Strictly use ISO format for dates eg. \"2024-01-01T09:00:00-00:00\". Input schema example: ```{ \"startTime\": \"...\", \"endTime\": \"...\"}```","url":"https://api.cal.com/v2/slots/available","authentication":"genericCredentialType","genericAuthType":"httpHeaderAuth","sendQuery":true,"parametersQuery":{"values":[{"name":"eventTypeId","valueProvider":"fieldValue","value":"={{ 648297 }}"},{"name":"startTime","valueProvider":"fieldValue","value":"{startTime}"},{"name":"endTime","valueProvider":"fieldValue","value":"{endTime}"}]},"placeholderDefinitions":{"values":[{"name":"startTime","description":"start of daterange in ISO format. eg. 2024-01-01T09:00:00-00:00","type":"string"},{"name":"endTime","description":"end of daterange in ISO format. eg. 2024-01-01T09:00:00-00:00","type":"string"}]}},"id":"7d1257dc-cc31-436d-8db4-b3ad31166649","name":"Get Availability","type":"@n8n/n8n-nodes-langchain.toolHttpRequest","position":[-1460,-500],"typeVersion":1},{"parameters":{"toolDescription":"Call this tool to get an existing booking using a booking \"uid\".","url":"https://api.cal.com/v2/bookings/{bookingUid}","authentication":"predefinedCredentialType","nodeCredentialType":"calApi","sendHeaders":true,"parametersHeaders":{"values":[{"name":"cal-api-version","valueProvider":"fieldValue","value":"2024-08-13"}]},"placeholderDefinitions":{"values":[{"name":"bookingUid","description":"the uid of the booking (note: this is not the same as the id of the booking)","type":"string"}]}},"id":"aa95f3ac-9e9a-40c4-b665-ea81eb826c70","name":"Get Existing Booking","type":"@n8n/n8n-nodes-langchain.toolHttpRequest","position":[-1160,-500],"typeVersion":1},{"parameters":{"toolDescription":"Call this tool to search for an existing bookings with the user''s email address and date. Use the \"uid\" field in the results as the primary booking identifier, ignore the \"id\" field.","url":"https://api.cal.com/v2/bookings","authentication":"genericCredentialType","genericAuthType":"httpHeaderAuth","sendQuery":true,"specifyQuery":"json","jsonQuery":"{\n \"status\": \"upcoming\",\n \"attendeeEmail\": \"{attendee_email}\",\n \"afterStart\": \"{date}\"\n}","sendHeaders":true,"parametersHeaders":{"values":[{"name":"cal-api-version","valueProvider":"fieldValue","value":"2024-08-13"}]},"placeholderDefinitions":{"values":[{"name":"attendee_email","description":"email address of attendee","type":"string"},{"name":"date","description":"Filter bookings with start after this date string. The time is always fixed at 9am."}]}},"id":"84e87834-ae00-4cfb-a96a-6f2441e6e7ae","name":"Find Existing Booking","type":"@n8n/n8n-nodes-langchain.toolHttpRequest","position":[-1020,-500],"typeVersion":1},{"parameters":{"toolDescription":"Call this tool to reschedule a user''s booking using a booking \"uid\".","method":"POST","url":"https://api.cal.com/v2/bookings/{bookingUid}/reschedule","authentication":"genericCredentialType","genericAuthType":"httpHeaderAuth","sendHeaders":true,"parametersHeaders":{"values":[{"name":"cal-api-version","valueProvider":"fieldValue","value":"2024-08-13"}]},"sendBody":true,"specifyBody":"json","jsonBody":"{\n \"start\": \"{start}\",\n \"reschedulingReason\": \"{reschedulingReason}\"\n}","placeholderDefinitions":{"values":[{"name":"bookingUid","description":"the uid of the booking. Note this is not the same as the id of the booking.","type":"string"},{"name":"start","description":"start datetime of the appointment, for example: \"2024-05-30T12:00:00.000Z\"","type":"string"},{"name":"reschedulingReason","description":"Reason for rescheduling the booking. If not given, value is \"Declined to give reason.\"","type":"string"}]}},"id":"4e4d9643-8322-41be-aba3-ddd34759d214","name":"Reschedule Booking","type":"@n8n/n8n-nodes-langchain.toolHttpRequest","position":[-1160,-320],"typeVersion":1},{"parameters":{"toolDescription":"Call this tool to cancel a user''s existing booking using a booking \"uid\".","method":"POST","url":"https://api.cal.com/v2/bookings/{bookingUid}/cancel","authentication":"genericCredentialType","genericAuthType":"httpHeaderAuth","sendHeaders":true,"parametersHeaders":{"values":[{"name":"cal-api-version","valueProvider":"fieldValue","value":"2024-08-13"}]},"sendBody":true,"specifyBody":"json","jsonBody":"{\n \"cancellationReason\": \"{cancellationReason}\"\n}","placeholderDefinitions":{"values":[{"name":"bookingUid","description":"the uid of the booking. Note this is not the same as the id of the booking.","type":"string"},{"name":"cancellationReason","description":"Reason for cancelling the appointment","type":"string"}]}},"id":"16151d82-9d7c-4e05-9026-8922c5570f28","name":"Cancel Booking","type":"@n8n/n8n-nodes-langchain.toolHttpRequest","position":[-1020,-320],"typeVersion":1},{"parameters":{"toolDescription":"Call this tool to create a booking. Strictly use ISO format for dates eg. \"2024-01-01T09:00:00-00:00\" for API compatibility.","method":"POST","url":"https://api.cal.com/v2/bookings","authentication":"genericCredentialType","genericAuthType":"httpHeaderAuth","sendHeaders":true,"parametersHeaders":{"values":[{"name":"Content-Type","valueProvider":"fieldValue","value":"application/json"},{"name":"cal-api-version","valueProvider":"fieldValue","value":"2024-08-13"}]},"sendBody":true,"specifyBody":"json","jsonBody":"{\n \"eventTypeId\": 648297,\n \"start\": \"{start}\",\n \"attendee\": {\n \"name\": \"{attendee_name}\",\n \"email\": \"{attendee_email}\",\n \"timeZone\": \"{attendee_timezone}\"\n },\n \"bookingFieldsResponses\": {\n \"title\": \"{summary_of_enquiry}\"\n }\n}","placeholderDefinitions":{"values":[{"name":"start","description":"The start time of the booking in ISO format. eg. \"2024-01-01T09:00:00Z\"","type":"string"},{"name":"attendee_name","description":"Name of the attendee","type":"string"},{"name":"attendee_email","description":"email of the attendee","type":"string"},{"name":"attendee_timezone","description":"If timezone is unknown, assume Europe/London.","type":"string"},{"name":"summary_of_enquiry","description":"short summary of the enquiry or purpose of the meeting","type":"string"}]}},"id":"279f8a82-e9e5-483f-aa72-18d6c5ba5a1b","name":"Create a Booking","type":"@n8n/n8n-nodes-langchain.toolHttpRequest","position":[-1320,-500],"typeVersion":1},{"parameters":{"content":"![alt](https://upload.wikimedia.org/wikipedia/commons/a/a5/Cal.com%2C_Inc._Logo.svg#100x80)\nYou''ll need to set a custom Header Auth Credential for Cal.com API v2. See the following doc for more info: https://cal.com/docs/api-reference/v2/introduction","height":168.99242033383513,"width":261.1134437946252,"color":7},"id":"987431ea-0539-40a5-84da-c7ecedd6507b","name":"Sticky Note10","type":"n8n-nodes-base.stickyNote","position":[-1780,-340],"typeVersion":1},{"parameters":{"content":"\n\n\n\n\n\n\n\n\n\n\n\n\n### üö® Change EventTypeID Here!\n* EventTypeID must be a number.\n* Your event type dictates the allowed duration of the booking.\n* If Event Type set to 30mins and the agent attempts to book 60mins, this will fail so make sure the agent knows how long to set the booking for!","height":360.9218237282627,"width":301.851426117099},"id":"2456e6c3-7dbc-47a3-b175-2620390f022a","name":"Sticky Note12","type":"n8n-nodes-base.stickyNote","position":[-1500,-520],"typeVersion":1},{"parameters":{"hasOutputParser":true,"options":{"systemMessage":"=You are an appointment scheduling helper for a company called \"PC Parts Ltd\". Customers will message you enquirying for PC or laptop repairs and your job is to schedule a repair session for the user.This role is strictly to help schedule appointments so:\n* you may answer questions relating to the company, \"PC Parts Ltd\".\n* you may not answer questions relating to competitors of \"PC Parts Ltd\".\n* you may answer questions relating to general PC or laptop repair from a non-technical perspective.\n* you may not help to customer diagnose or assist in troubleshoot or debugging thei r PC or laptop issues. If the customer does ask, defer them to book an appointment where a suitable professional from PC Parts Ltd can help.\n* If an appointment is scheduled for the user then the conversation is completed and you should not continue to ask the user to schedule an appointment.\n* If an appointment is scheduled for the user, the user may ask for the following actions: ask about details of the existing appointment, reschedule the existing appointment or cancel an existing appointment.\n* If an appointment is scheduled for the user, the user cannot schedule another appointment until the existing appointment is cancelled.\n\n## About the company\nPC Parts Ltd is based in London, UK. They offer to repair low-end to high-end PC and Laptop consumer and small business machines. They also offer custom built machines such as for gaming. There is currently a summer sale going on for 20% selected machines for repairs. The company does not repair other electronic devices such as phones, tablets or monitors.\n\n## About the appointments\nAlways start your conversation by politely asking if the user wants to book a new appointment or enquire about an existing one. The date and time now is {{ $now.toISO() }}. All dates should be given in the ISO format. Each appointment should have a start and end date and time relative to today''s date in the future and should be scheduled for 30 minutes.\n\n## To book an appointment\n* Before booking an appointment, ask if the user has an existing appointment.\n* Ensure you have the user''s email address, full name and proposed date, preferred start time before booking an appointment.\n* Always check the calendar availability of the user''s proposed date and time. If there is no availability, suggest the next available appointment slot.\n* If the appointment booking is successful, notify the user that an email confirmation will be sent to their provided email address.\n* If the appointment booking is unsuccessful, notify the user that you are unable to complete their request at the moment and to try again later.\n\n## To find an existing appointment\n* Ask the user for their email address and the date of the existing booking\n* Use the user''s email and date to search for the existing booking.\n* If the user''s email and date do not match the results or no results are returned, then the existing booking is not found.\n* If the existing booking is not found, notify the user and suggest a new booking should be made.\n* When the existing booking is found, ensure you tell them the booking''s UID field.\n\n# To reschedule or cancel an existing appointment\n* First find the existing appointment so that you may obtain the existing appointment''s booking UID.\n* Display this booking UID to the user.\n* Use this booking UID to reschedule or cancel an existing appointment.\n* If an existing appointment ID is not found or given, then notify the user that it is not possible to complete their request at this time and they should contact via email.\n* when user wants to cancel an appointment, ask for a reason for the cancellation and suggest rescheduling as an alternative. Confirm with user before cancelling an appointment.\n\n## About the user\n* The customer''s session_id is \"{{ $(''Twilio Trigger'').item.json.From }}\"\n{{\n$json.chat_messages \n ? ''* This is a returning prospective customer.'' \n : ''* This is a new customer. Ask for the details of their enquiry.''\n}}\n{{\n$json.appointment_id \n ? `* The customer has already scheduled an appointment at ${$json.scheduled_at} and their appointment_id is ${$json.appointment_id}`\n : ''* This customer has not scheduled an appointment yet.''\n}}\n\n## Existing Conversation\n{{\n$json.chat_messages\n ? ''Here are the existing chat logs and should be used as context to continue the conversation:\\n```\\n'' + JSON.parse($json.chat_messages).map(item => `${item.role}: ${item.message.replaceAll(''\\n'', '' '')}`).join(''\\n'') + ''\\n```''\n : ''* There is no existing conversation so far.''\n}}\n"}},"id":"37c05586-c22c-4592-b146-aea8a1bb954a","name":"Appointment Scheduling Agent1","type":"@n8n/n8n-nodes-langchain.agent","position":[-1500,-740],"typeVersion":1.6}]', '{"Every 24hrs":{"main":[[{"node":"Find Follow-Up Candidates","type":"main","index":0}]]},"Cancel Booking":{"ai_tool":[[{"node":"Appointment Scheduling Agent1","type":"ai_tool","index":0}]]},"Twilio Trigger":{"main":[[{"node":"Check For Command Words","type":"main","index":0}]]},"Create a Booking":{"ai_tool":[[{"node":"Appointment Scheduling Agent1","type":"ai_tool","index":0}]]},"Get Availability":{"ai_tool":[[{"node":"Appointment Scheduling Agent1","type":"ai_tool","index":0}]]},"User Request STOP":{"main":[[{"node":"Send Confirmation","type":"main","index":0}]]},"OpenAI Chat Model1":{"ai_languageModel":[[{"node":"Generate Follow Up Message","type":"ai_languageModel","index":0}]]},"OpenAI Chat Model2":{"ai_languageModel":[[{"node":"Auto-fixing Output Parser","type":"ai_languageModel","index":0}]]},"OpenAI Chat Model3":{"ai_languageModel":[[{"node":"Appointment Scheduling Agent1","type":"ai_languageModel","index":0}]]},"Reschedule Booking":{"ai_tool":[[{"node":"Appointment Scheduling Agent1","type":"ai_tool","index":0}]]},"Get Existing Booking":{"ai_tool":[[{"node":"Appointment Scheduling Agent1","type":"ai_tool","index":0}]]},"Create/Update Session":{"main":[[{"node":"Send Reply","type":"main","index":0}]]},"Find Existing Booking":{"ai_tool":[[{"node":"Appointment Scheduling Agent1","type":"ai_tool","index":0}]]},"Check For Command Words":{"main":[[{"node":"User Request STOP","type":"main","index":0}],[{"node":"Get Existing Chat Session","type":"main","index":0}]]},"Structured Output Parser":{"ai_outputParser":[[{"node":"Auto-fixing Output Parser","type":"ai_outputParser","index":0}]]},"Auto-fixing Output Parser":{"ai_outputParser":[[{"node":"Appointment Scheduling Agent1","type":"ai_outputParser","index":0}]]},"Find Follow-Up Candidates":{"main":[[{"node":"Generate Follow Up Message","type":"main","index":0}]]},"Get Existing Chat Session":{"main":[[{"node":"Appointment Scheduling Agent1","type":"main","index":0}]]},"Generate Follow Up Message":{"main":[[{"node":"Update Follow-Up Count and Date","type":"main","index":0}]]},"Appointment Scheduling Agent1":{"main":[[{"node":"Create/Update Session","type":"main","index":0}]]},"Update Follow-Up Count and Date":{"main":[[{"node":"Send Follow Up Message","type":"main","index":0}]]}}', '{"executionOrder":"v1"}', NULL, '{}', 'ba27fee3-c974-42a5-84ac-27723ce81465', 0, '{"templateCredsSetupCompleted":true}', NULL, '2025-06-18T19:26:43.269Z', '2025-06-18T19:28:52.000Z', false),
  ('e329a2a9-c33c-4d4b-b926-b1bb807b4d43', 'Multitenant', false, '[{"parameters":{"httpMethod":"POST","path":"whatsapp","options":{}},"id":"e484b102-6e9b-435b-b054-f4665bc6e22a","name":"Webhook WhatsApp","type":"n8n-nodes-base.webhook","typeVersion":1,"position":[120,560],"webhookId":"barberius-multitenant","notes":"Riceve i messaggi in ingresso da Meta WhatsApp. Estrarr√† tenant_id tramite phone_number_id"},{"parameters":{"functionCode":"// Estrae numero e testo\nreturn [{\n  json: {\n    phone: $json.entry[0].changes[0].value.messages[0].from,\n    text: $json.entry[0].changes[0].value.messages[0].text.body,\n    phone_number_id: $json.entry[0].changes[0].value.metadata.phone_number_id\n  }\n}];"},"id":"9f10e275-ebec-4a8c-b20e-7369fd3e9c81","name":"Estrai Payload","type":"n8n-nodes-base.function","typeVersion":1,"position":[320,560],"notes":"Estrae i campi chiave dal payload WhatsApp"},{"parameters":{"operation":"executeQuery"},"id":"a5875af6-df31-4041-ac9d-c0f53f1d7d0d","name":"Recupera Tenant","type":"n8n-nodes-base.supabase","typeVersion":1,"position":[520,560],"notes":"Recupera tenant_id e configurazione associata al numero WhatsApp"},{"parameters":{"operation":"executeQuery"},"id":"17859ec3-5a14-44c6-aefa-a1834e6d8fd2","name":"Verifica Disponibilit√†","type":"n8n-nodes-base.supabase","typeVersion":1,"position":[720,560],"notes":"Recupera i prossimi slot disponibili per il tenant"},{"parameters":{},"id":"e3b583b8-3d8d-429b-af15-c7df6efc9bf9","name":"AI Prenotazione","type":"n8n-nodes-base.openai","typeVersion":2,"position":[920,560],"credentials":{},"notes":"Interpreta il messaggio e propone uno slot disponibile secondo regole AI tenant"},{"parameters":{"operation":"executeQuery"},"id":"19b00c64-8af5-42f9-a6d4-a3dcc9b489a4","name":"Scrivi Prenotazione","type":"n8n-nodes-base.supabase","typeVersion":1,"position":[1120,560],"notes":"Aggiorna lo slot nel calendario con lo stato prenotato"},{"parameters":{"method":"POST","url":"={{ $node[\"Recupera Tenant\"].json[\"webhook_id\"] }}","options":{}},"id":"5f3a712d-19e8-48b7-85c8-a4b377ee5f92","name":"Invia Messaggio","type":"n8n-nodes-base.httpRequest","typeVersion":4,"position":[1320,560],"notes":"Invia conferma prenotazione al cliente via webhook WhatsApp tenant"},{"parameters":{"content":"üß† Workflow multi-tenant completo per gestione AI prenotazioni con calendari separati per barberia. Recupera dinamicamente tenant, verifica disponibilit√†, interroga AI, scrive su Supabase e invia conferma."},"id":"ea578db3-29fd-4d63-b92e-fda56f3630b2","name":"Nota flusso","type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[720,360]}]', '{"Webhook WhatsApp":{"main":[[{"node":"Estrai Payload","type":"main","index":0}]]},"Estrai Payload":{"main":[[{"node":"Recupera Tenant","type":"main","index":0}]]},"Recupera Tenant":{"main":[[{"node":"Verifica Disponibilit√†","type":"main","index":0}]]},"Scrivi Prenotazione":{"main":[[{"node":"Invia Messaggio","type":"main","index":0}]]}}', '{"executionOrder":"v1"}', NULL, '{}', '0dc81275-0c32-40f8-ab40-f5557057389c', 0, '{"templateCredsSetupCompleted":true}', NULL, '2025-06-18T20:28:39.950Z', '2025-06-18T20:37:03.000Z', false),
  ('a37a0f8d-ede9-435d-80a7-2096d556f917', 'FORM_GOMMEGO', false, '[{"parameters":{"path":"assistenza-gommego","formTitle":"Richiesta Assistenza GommeGo","formDescription":"Compila il form per ricevere assistenza rapida e precisa","formFields":{"values":[{"fieldLabel":"Email","fieldType":"email","placeholder":"tua-email@esempio.com","requiredField":true},{"fieldLabel":"Nome e Cognome","placeholder":"Mario Rossi","requiredField":true},{"fieldLabel":"Tipo di Richiesta","fieldType":"dropdown","fieldOptions":{"values":[{"option":"Informazioni sul mio ordine"},{"option":"Problema con la consegna"},{"option":"Reso o cambio prodotto/Richiesta rimborso"},{"option":"Informazioni generali"},{"option":"Assistenza tecnica prodotto"}]},"requiredField":true},{"fieldLabel":"Numero Ordine","placeholder":"Es: BCRGBYWMU (se disponibile)"},{"fieldLabel":"Oggetto","placeholder":"Riassumi in poche parole la tua richiesta","requiredField":true},{"fieldLabel":"Messaggio Dettagliato","fieldType":"textarea","placeholder":"Descrivi nel dettaglio la tua richiesta...","requiredField":true},{"fieldLabel":"√à una richiesta urgente?","fieldType":"checkbox"},{"fieldLabel":"Motivo Urgenza","placeholder":"Se urgente, specifica il motivo"}]},"options":{"appendAttribution":false,"buttonLabel":"Invia Richiesta","respondWithOptions":{"values":{"formSubmittedText":"La tua richiesta √® stata ricevuta!"}},"ignoreBots":true,"customCss":":root {\n\t--font-family: ''Open Sans'', sans-serif;\n\t--font-weight-normal: 400;\n\t--font-weight-bold: 600;\n\t--font-size-body: 12px;\n\t--font-size-label: 14px;\n\t--font-size-test-notice: 12px;\n\t--font-size-input: 14px;\n\t--font-size-header: 20px;\n\t--font-size-paragraph: 14px;\n\t--font-size-link: 12px;\n\t--font-size-error: 12px;\n\t--font-size-html-h1: 28px;\n\t--font-size-html-h2: 20px;\n\t--font-size-html-h3: 16px;\n\t--font-size-html-h4: 14px;\n\t--font-size-html-h5: 12px;\n\t--font-size-html-h6: 10px;\n\t--font-size-subheader: 14px;\n\t\n\t/* Colori GommeGo */\n\t--gommego-blue: #1B4F99;\n\t--gommego-blue-dark: #0F3A7A;\n\t--gommego-orange: #F39019;\n\t--gommego-orange-dark: #E57E00;\n\t--gommego-white: #FFFFFF;\n\t\n\t/* Colors - Personalizzati per GommeGo */\n\t--color-background: #f8f9fb;\n\t--color-test-notice-text: var(--gommego-orange);\n\t--color-test-notice-bg: #FFF4E6;\n\t--color-test-notice-border: #FFD9A6;\n\t--color-card-bg: #ffffff;\n\t--color-card-border: #e1e8ef;\n\t--color-card-shadow: rgba(27, 79, 153, 0.08);\n\t--color-link: var(--gommego-blue);\n\t--color-header: var(--gommego-blue-dark);\n\t--color-label: #2c3e50;\n\t--color-input-border: #d4dde6;\n\t--color-input-text: #34495e;\n\t--color-focus-border: var(--gommego-orange);\n\t--color-submit-btn-bg: var(--gommego-orange);\n\t--color-submit-btn-text: #ffffff;\n\t--color-error: #e74c3c;\n\t--color-required: var(--gommego-orange);\n\t--color-clear-button-bg: #95a5a6;\n\t--color-html-text: #2c3e50;\n\t--color-html-link: var(--gommego-orange);\n\t--color-header-subtext: #7f8c8d;\n\t\n\t/* Border Radii */\n\t--border-radius-card: 12px;\n\t--border-radius-input: 8px;\n\t--border-radius-clear-btn: 50%;\n\t--card-border-radius: 12px;\n\t\n\t/* Spacing */\n\t--padding-container-top: 24px;\n\t--padding-card: 28px;\n\t--padding-test-notice-vertical: 12px;\n\t--padding-test-notice-horizontal: 24px;\n\t--margin-bottom-card: 20px;\n\t--padding-form-input: 14px;\n\t--card-padding: 28px;\n\t--card-margin-bottom: 20px;\n\t\n\t/* Dimensions - PERSONALIZZATE */\n\t--container-width: 600px;  /* Larghezza form aumentata */\n\t--submit-btn-height: 52px;\n\t--checkbox-size: 20px;\n\t\n\t/* Others */\n\t--box-shadow-card: 0px 6px 24px 0px var(--color-card-shadow);\n\t--opacity-placeholder: 0.6;\n}\n\n/* Stili aggiuntivi per il branding GommeGo */\n.form-submit button {\n\tbackground: linear-gradient(135deg, var(--gommego-orange) 0%, var(--gommego-orange-dark) 100%);\n\tfont-weight: 600;\n\ttext-transform: uppercase;\n\tletter-spacing: 0.5px;\n\ttransition: all 0.3s ease;\n\tbox-shadow: 0 4px 12px rgba(243, 144, 25, 0.3);\n}\n\n.form-submit button:hover {\n\ttransform: translateY(-2px);\n\tbox-shadow: 0 6px 20px rgba(243, 144, 25, 0.4);\n}\n\n/* Header con testo bianco leggibile */\n.form-header {\n\tbackground: linear-gradient(135deg, var(--gommego-blue) 0%, var(--gommego-blue-dark) 100%);\n\tcolor: white !important;\n\tpadding: 20px;\n\tmargin: -28px -28px 24px -28px;\n\tborder-radius: 12px 12px 0 0;\n\ttext-align: center;\n}\n\n.form-header h1,\n.form-header h2,\n.form-header h3,\n.form-header .form-title {\n\tcolor: white !important;\n\tmargin: 0;\n\tpadding: 8px 0;\n}\n\n.form-header .form-description,\n.form-header p {\n\tcolor: rgba(255, 255, 255, 0.9) !important;\n\tmargin: 8px 0 0 0;\n\tfont-size: 14px;\n}\n\n.form-label {\n\tcolor: var(--gommego-blue-dark);\n\tfont-weight: 500;\n}\n\ninput:focus, \ntextarea:focus, \nselect:focus {\n\tborder-color: var(--gommego-orange);\n\toutline: none;\n\tbox-shadow: 0 0 0 3px rgba(243, 144, 25, 0.1);\n}\n\n/* Checkbox personalizzata */\ninput[type=\"checkbox\"]:checked {\n\taccent-color: var(--gommego-orange);\n}\n\n/* Dropdown stile GommeGo */\nselect {\n\tbackground-image: url(\"data:image/svg+xml,%3Csvg width=''12'' height=''8'' viewBox=''0 0 12 8'' fill=''none'' xmlns=''http://www.w3.org/2000/svg''%3E%3Cpath d=''M1 1.5L6 6.5L11 1.5'' stroke=''%231B4F99'' stroke-width=''2'' stroke-linecap=''round'' stroke-linejoin=''round''/%3E%3C/svg%3E\");\n\tbackground-repeat: no-repeat;\n\tbackground-position: right 12px center;\n\tpadding-right: 40px;\n}\n\n/* Success message stile */\n.form-submit-success {\n\tbackground: linear-gradient(135deg, #27ae60 0%, #229954 100%);\n\tcolor: white;\n\tpadding: 20px;\n\tborder-radius: 8px;\n\ttext-align: center;\n\tfont-weight: 500;\n}\n\n/* Loading state */\n.form-submit button:disabled {\n\tbackground: #95a5a6;\n\tcursor: not-allowed;\n\topacity: 0.7;\n}\n\n/* Error messages con icona */\n.form-error {\n\tcolor: var(--color-error);\n\tfont-size: var(--font-size-error);\n\tmargin-top: 4px;\n\tdisplay: flex;\n\talign-items: center;\n\tgap: 4px;\n}\n\n.form-error:before {\n\tcontent: \"‚ö†Ô∏è\";\n\tfont-size: 14px;\n}\n\n/* Placeholder animato */\ninput::placeholder,\ntextarea::placeholder {\n\ttransition: opacity 0.3s ease;\n}\n\ninput:focus::placeholder,\ntextarea:focus::placeholder {\n\topacity: 0.3;\n}\n\n/* Badge per campi obbligatori */\n.form-label span.required {\n\tcolor: var(--gommego-orange);\n\tfont-weight: bold;\n\tmargin-left: 2px;\n}\n\n/* Animazione ingresso form */\n@keyframes fadeInUp {\n\tfrom {\n\t\topacity: 0;\n\t\ttransform: translateY(20px);\n\t}\n\tto {\n\t\topacity: 1;\n\t\ttransform: translateY(0);\n\t}\n}\n\n.form-card {\n\tanimation: fadeInUp 0.5s ease-out;\n}\n\n/* =========================== */\n/* CONTROLLO DIMENSIONI FORM   */\n/* =========================== */\n\n/* Container principale */\n.container {\n\tmax-width: var(--container-width) !important;\n\twidth: 100% !important;\n\tmargin: 0 auto !important;\n\tpadding: 20px !important;\n}\n\n/* Card del form */\n.form-card {\n\twidth: 100% !important;\n\tmax-width: 100% !important;\n}\n\n/* Larghezza full per mobile */\n@media (max-width: 768px) {\n\t:root {\n\t\t--container-width: 100%;\n\t\t--card-padding: 20px;\n\t\t--padding-card: 20px;\n\t}\n\t\n\t.container {\n\t\tpadding: 10px !important;\n\t}\n\t\n\t.form-header {\n\t\tmargin: -20px -20px 20px -20px;\n\t}\n}\n\n/* Dimensioni input fields */\ninput[type=\"text\"],\ninput[type=\"email\"],\ninput[type=\"date\"],\ninput[type=\"number\"],\ninput[type=\"password\"],\ntextarea,\nselect {\n\twidth: 100% !important;\n\tbox-sizing: border-box !important;\n}\n\n/* Altezza minima form totale */\n.n8n-form-container {\n\tmin-height: 600px;\n}\n\n/* Se vuoi un form pi√π compatto */\n.compact-form {\n\t--padding-form-input: 10px;\n\t--margin-bottom-card: 12px;\n\t--font-size-input: 13px;\n\t--submit-btn-height: 44px;\n}\n\n/* Se vuoi un form pi√π spazioso */\n.spacious-form {\n\t--padding-form-input: 16px;\n\t--margin-bottom-card: 24px;\n\t--font-size-input: 16px;\n\t--submit-btn-height: 56px;\n}"}},"type":"n8n-nodes-base.formTrigger","typeVersion":2.1,"position":[-2300,-1240],"id":"508944f7-881c-4276-af26-4f556e2e48d5","name":"Form Assistenza GommeGo","webhookId":"assistenza-gommego"},{"parameters":{"jsCode":"// Processa i dati del form per il workflow principale\nconst formData = $input.first().json;\n\n// Estrai il valore reale dal dropdown (prima del |)\nconst tipoRichiesta = formData[''Tipo di Richiesta''].split(''|'')[0];\n\n// Mappa tipo richiesta a categoria per il workflow\nconst categoriaMapping = {\n  ''stato_ordine'': ''Tracking'',\n  ''problema_consegna'': ''Spedizione'',\n  ''reso_cambio'': ''Resi'',\n  ''rimborso'': ''Rimborsi'',\n  ''info_generali'': ''Informazioni'',\n  ''assistenza_tecnica'': ''Assistenza''\n};\n\n// Determina priorit√† base\nconst prioritaMapping = {\n  ''rimborso'': ''high'',\n  ''reso_cambio'': ''high'',\n  ''problema_consegna'': ''medium'',\n  ''stato_ordine'': ''low'',\n  ''info_generali'': ''low'',\n  ''assistenza_tecnica'': ''medium''\n};\n\n// Crea oggetto strutturato per il workflow principale\nconst processedData = {\n  // Simula struttura email per compatibilit√†\n  id: `form_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\n  \n  // Dati mittente\n  sender: {\n    emailAddress: {\n      address: formData.Email,\n      name: formData[''Nome e Cognome'']\n    }\n  },\n  \n  // Contenuto\n  subject: formData.Oggetto,\n  body: {\n    content: formData[''Messaggio Dettagliato'']\n  },\n  \n  // Metadata aggiuntivi dal form\n  form_data: {\n    tipo_richiesta: tipoRichiesta,\n    categoria: categoriaMapping[tipoRichiesta],\n    telefono: formData.Telefono || null,\n    order_id: formData[''Numero Ordine''] || null,\n    data_ordine: formData[''Data Ordine''] || null,\n    tracking_number: formData[''Numero Tracking''] || null,\n    is_urgent: formData[''√à una richiesta urgente?''] || false,\n    motivo_urgenza: formData[''Motivo Urgenza''] || null,\n    priorita_base: prioritaMapping[tipoRichiesta],\n    source: ''web_form'',\n    timestamp: new Date().toISOString()\n  },\n  \n  // Override per urgenze\n  priority: formData[''√à una richiesta urgente?''] ? ''critical'' : prioritaMapping[tipoRichiesta],\n  \n  // Flag per workflow\n  isFromForm: true,\n  sentDateTime: new Date().toISOString()\n};\n\n// Aggiungi messaggio formattato che include tutti i dati\nprocessedData.messaggio_completo = `\nTIPO RICHIESTA: ${formData[''Tipo di Richiesta''].split(''|'')[1]}\n${formData[''Numero Ordine''] ? `ORDINE N¬∞: ${formData[''Numero Ordine'']}` : ''''}\n${formData[''Data Ordine''] ? `DATA ORDINE: ${formData[''Data Ordine'']}` : ''''}\n${formData[''Numero Tracking''] ? `TRACKING: ${formData[''Numero Tracking'']}` : ''''}\n${formData.Telefono ? `TELEFONO: ${formData.Telefono}` : ''''}\n${formData[''√à una richiesta urgente?''] ? `‚ö†Ô∏è URGENTE: ${formData[''Motivo Urgenza''] || ''Non specificato''}` : ''''}\n\n--- MESSAGGIO ---\n${formData[''Messaggio Dettagliato'']}\n`.trim();\n\nreturn processedData;"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-2240,-1540],"id":"d7f834b5-5a31-4a61-81ae-f2c6fbde984b","name":"Processa Dati Form"},{"parameters":{"content":"## üéØ Form Assistenza GommeGo\n\n### Vantaggi:\n1. **Dati strutturati** - Niente pi√π parsing email\n2. **Order ID pulito** - Campo dedicato validato\n3. **Classificazione immediata** - Dal dropdown tipo richiesta\n4. **Priorit√† smart** - Urgenze + tipo richiesta\n5. **Zero ambiguit√†** - Campi guidati\n\n### URL Form:\n`https://tuo-n8n.com/form/assistenza-gommego`\n\n### Output compatibile con workflow esistente:\n- Simula struttura email per retrocompatibilit√†\n- Aggiunge metadata specifici in `form_data`\n- Flag `isFromForm` per logiche dedicate","height":268.57633472293617,"width":373.1430891196571,"color":4},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-2720,-1520],"id":"2eb78270-22f7-4b12-916c-66ad08b95c4e","name":"Sticky Note"},{"parameters":{"options":{}},"type":"n8n-nodes-base.form","typeVersion":1,"position":[-2080,-1240],"id":"033ed79d-c47d-4633-9f12-86f8949bca9d","name":"Form","webhookId":"ac864e82-571a-44e4-a955-ecf4cf3cbcca"},{"parameters":{"path":"assistenza-ordini","formTitle":"Assistenza Ordini GommeGo","formDescription":"Hai gi√† effettuato un ordine? Siamo qui per aiutarti con tracking, consegne, resi e rimborsi.","formFields":{"values":[{"fieldLabel":"Email","fieldType":"email","placeholder":"tua-email@esempio.com","requiredField":true},{"fieldLabel":"Nome e Cognome","placeholder":"Mario Rossi","requiredField":true},{"fieldLabel":"Numero Ordine","placeholder":"Es: BCRGBYWMU (obbligatorio)","requiredField":true},{"fieldLabel":"Tipo di Problema","fieldType":"dropdown","fieldOptions":{"values":[{"option":"tracking|üì¶ Tracking/Stato spedizione"},{"option":"consegna|üöö Problema con la consegna"},{"option":"reso|üîÑ Reso o cambio prodotto"},{"option":"rimborso|üí∞ Richiesta rimborso"},{"option":"prodotto|üîß Problema con il prodotto"}]},"requiredField":true},{"fieldLabel":"Data Ordine","fieldType":"date"},{"fieldLabel":"Numero Tracking","placeholder":"Codice tracking corriere (se disponibile)"},{"fieldLabel":"Descrizione Dettagliata","fieldType":"textarea","placeholder":"Descrivi nel dettaglio il problema con il tuo ordine...","requiredField":true}]},"options":{"buttonLabel":"Invia Richiesta","ignoreBots":true}},"type":"n8n-nodes-base.formTrigger","typeVersion":2.1,"position":[-1880,-320],"id":"2a5057b5-417d-48b1-96ce-1545c1bad96a","name":"Form 1: Assistenza Ordini","webhookId":"assistenza-ordini"},{"parameters":{"path":"informazioni","formTitle":"Informazioni e Preventivi","formDescription":"Hai domande sui nostri prodotti? Cerchi informazioni su disponibilit√†, prezzi o spedizioni? Siamo qui per aiutarti!","formFields":{"values":[{"fieldLabel":"Email","fieldType":"email","placeholder":"tua-email@esempio.com","requiredField":true},{"fieldLabel":"Nome e Cognome","placeholder":"Mario Rossi","requiredField":true},{"fieldLabel":"Telefono","placeholder":"+39 123 456 7890 (opzionale)"},{"fieldLabel":"Tipo di Informazione","fieldType":"dropdown","fieldOptions":{"values":[{"option":"prodotti|üõû Informazioni prodotti"},{"option":"disponibilita|üìä Disponibilit√† misure"},{"option":"tempi|‚è∞ Tempi di consegna"},{"option":"pagamenti|üí≥ Metodi di pagamento"},{"option":"preventivo|üìã Preventivo personalizzato"},{"option":"altro|‚ùì Altro"}]},"requiredField":true},{"fieldLabel":"Misura Pneumatici","placeholder":"Es: 205/55 R16 (se rilevante)"},{"fieldLabel":"La tua domanda","fieldType":"textarea","placeholder":"Scrivi qui la tua domanda o richiesta di informazioni...","requiredField":true},{"fieldLabel":"Consenso Marketing","fieldType":"checkbox","placeholder":"Accetto di ricevere offerte e promozioni GommeGo"}]},"options":{"buttonLabel":"Invia Richiesta","ignoreBots":true}},"type":"n8n-nodes-base.formTrigger","typeVersion":2.1,"position":[-1880,-120],"id":"aadfe163-a6de-4c03-ac60-54e89e0fd18b","name":"Form 2: Informazioni Generali","webhookId":"informazioni"},{"parameters":{"path":"urgente","formTitle":"üö® Richiesta Urgente","formDescription":"Per situazioni che richiedono assistenza immediata. Il nostro team prioritario ti contatter√† al pi√π presto.","formFields":{"values":[{"fieldLabel":"Sei gi√† nostro cliente?","fieldType":"dropdown","fieldOptions":{"values":[{"option":"si|S√¨, ho un ordine"},{"option":"no|No, ma ho un''urgenza"}]},"requiredField":true},{"fieldLabel":"Email","fieldType":"email","placeholder":"tua-email@esempio.com","requiredField":true},{"fieldLabel":"Nome e Cognome","placeholder":"Mario Rossi","requiredField":true},{"fieldLabel":"Telefono","placeholder":"+39 123 456 7890 (OBBLIGATORIO per urgenze)","requiredField":true},{"fieldLabel":"Numero Ordine","placeholder":"Se sei cliente, inserisci il numero ordine"},{"fieldLabel":"Motivo Urgenza","fieldType":"dropdown","fieldOptions":{"values":[{"option":"mancata_consegna|üöö Mancata consegna urgente"},{"option":"danno_grave|‚ö†Ô∏è Prodotto gravemente danneggiato"},{"option":"ordine_errato|‚ùå Ordine completamente errato"},{"option":"necessita_immediata|üèÉ Necessit√† immediata pneumatici"},{"option":"flotta_aziendale|üöõ Urgenza flotta aziendale"},{"option":"altro_urgente|üî¥ Altro problema urgente"}]},"requiredField":true},{"fieldLabel":"Descrizione Urgenza","fieldType":"textarea","placeholder":"Descrivi dettagliatamente la situazione urgente e perch√© richiede attenzione immediata...","requiredField":true},{"fieldLabel":"Orario preferito per contatto telefonico","placeholder":"Es: 9-13 o 14-18"}]},"options":{"buttonLabel":"üö® INVIA RICHIESTA URGENTE","ignoreBots":true}},"type":"n8n-nodes-base.formTrigger","typeVersion":2.1,"position":[-1880,80],"id":"ab3b838b-783a-4e4b-a0b1-3334cf8e49f7","name":"Form 3: Richieste Urgenti","webhookId":"urgente"},{"parameters":{"jsCode":"// Processa e unifica i dati dai 3 form\nconst formData = $input.first().json;\nconst nodeName = $input.first().node;\n\n// Identifica quale form ha triggerato\nlet formType = '''';\nlet priority = ''medium'';\nlet categoria = ''Generale'';\n\nif (nodeName.includes(''Ordini'')) {\n  formType = ''assistenza_ordini'';\n  priority = ''high'';\n  categoria = ''Assistenza Post-Vendita'';\n} else if (nodeName.includes(''Informazioni'')) {\n  formType = ''informazioni'';\n  priority = ''low'';\n  categoria = ''Pre-Vendita'';\n} else if (nodeName.includes(''Urgenti'')) {\n  formType = ''urgente'';\n  priority = ''critical'';\n  categoria = ''Urgente'';\n}\n\n// Struttura unificata per tutti i form\nconst unifiedData = {\n  // Metadata\n  form_type: formType,\n  priority: priority,\n  categoria: categoria,\n  timestamp: new Date().toISOString(),\n  \n  // Dati comuni\n  email: formData.Email || formData.email,\n  nome: formData[''Nome e Cognome''] || formData.nome,\n  telefono: formData.Telefono || formData.telefono || null,\n  \n  // Dati specifici per tipo\n  order_id: formData[''Numero Ordine''] || null,\n  tipo_problema: formData[''Tipo di Problema''] || null,\n  tipo_informazione: formData[''Tipo di Informazione''] || null,\n  motivo_urgenza: formData[''Motivo Urgenza''] || null,\n  cliente_esistente: formData[''Sei gi√† nostro cliente?''] || null,\n  \n  // Messaggio\n  messaggio: formData[''Descrizione Dettagliata''] || \n             formData[''La tua domanda''] || \n             formData[''Descrizione Urgenza''] || '''',\n  \n  // Altri campi\n  data_ordine: formData[''Data Ordine''] || null,\n  tracking_number: formData[''Numero Tracking''] || null,\n  misura_pneumatici: formData[''Misura Pneumatici''] || null,\n  consenso_marketing: formData[''Consenso Marketing''] || false,\n  orario_contatto: formData[''Orario preferito per contatto telefonico''] || null,\n  \n  // Flag per workflow\n  requires_immediate_action: formType === ''urgente'',\n  is_customer: formData[''Numero Ordine''] ? true : false,\n  source: ''web_form_'' + formType\n};\n\nreturn unifiedData;"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-1480,-120],"id":"f60778ab-a2ac-4cb1-94f9-8b261fef66cf","name":"Processa Dati Unificati"},{"parameters":{"content":"## üéØ Sistema 3 Form GommeGo\n\n### Form disponibili:\n\n1. **Assistenza Ordini** (`/form/assistenza-ordini`)\n   - Per clienti con ordini esistenti\n   - Numero ordine obbligatorio\n   - Priority: HIGH\n\n2. **Informazioni** (`/form/informazioni`)\n   - Per prospect e domande generali  \n   - Nessun ordine richiesto\n   - Priority: LOW\n\n3. **Urgente** (`/form/urgente`)\n   - Per situazioni critiche\n   - Telefono obbligatorio\n   - Priority: CRITICAL\n\n### Dati Unificati Output:\n- `form_type`: Identifica quale form\n- `priority`: critical/high/low\n- `requires_immediate_action`: boolean\n- Tutti i campi mappati e pronti","height":450,"width":350,"color":4},"type":"n8n-nodes-base.stickyNote","typeVersion":1,"position":[-2940,-720],"id":"9a283510-1d95-4c8e-a5f0-9b8e4ff71a0d","name":"Note Sistema"},{"parameters":{"httpMethod":"POST","path":"gommego-assistenza","responseMode":"responseNode","options":{"responseHeaders":{"entries":[{"name":"Access-Control-Allow-Origin","value":"*"},{"name":"Access-Control-Allow-Methods","value":"POST, OPTIONS"}]}}},"type":"n8n-nodes-base.webhook","typeVersion":1.1,"position":[-2960,920],"id":"e0c4b811-ddd3-4fd1-b2b2-17d533f9e4a1","name":"Webhook Form GommeGo","webhookId":"gommego-assistenza"},{"parameters":{"method":"POST","url":"https://www.google.com/recaptcha/api/siteverify","sendBody":true,"bodyParameters":{"parameters":[{"name":"secret","value":"6LesimYrAAAAANKLVNOzRvDlKG_b_pX5KUpSsgLFB"},{"name":"response","value":"={{ $json.body.recaptcha_response }}"}]},"options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.1,"position":[-2700,920],"id":"a2812d27-b9d1-4e9b-bf58-8d0832475df7","name":"Verifica reCAPTCHA"},{"parameters":{"jsCode":"// Controlla risultato reCAPTCHA\nconst recaptchaResult = $input.first().json;\nconst originalData = $(''Webhook Form GommeGo'').item.json.body;\n\nif (!recaptchaResult.success) {\n  throw new Error(''reCAPTCHA fallito - Possibile bot'');\n}\n\n// Se reCAPTCHA √® valido, processa i dati\nconst data = originalData;\n\n// Determina categoria in base al form type\nconst categoriaMap = {\n  ''ordine'': ''Assistenza Post-Vendita'',\n  ''info'': ''Richiesta Informazioni'',\n  ''urgente'': ''Caso Urgente''\n};\n\n// Crea struttura compatibile con workflow esistente\nconst processedData = {\n  // Simula struttura email per compatibilit√†\n  id: `webhook_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\n  \n  sender: {\n    emailAddress: {\n      address: data.email,\n      name: data.nome\n    }\n  },\n  \n  subject: `[WEB FORM] ${data.tipo_richiesta} - ${data.nome}`,\n  \n  body: {\n    content: data.messaggio\n  },\n  \n  // Dati originali form\n  form_data: data,\n  \n  // Metadata per routing\n  priority: data.priority,\n  categoria: data.categoria,\n  isFromWebhook: true,\n  sentDateTime: data.timestamp,\n  \n  // Campi specifici estratti\n  order_id: data.order_id,\n  customer_email: data.email,\n  customer_name: data.nome,\n  \n  // Flag validazione\n  recaptcha_verified: true\n};\n\nreturn processedData;"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-2480,920],"id":"1cff8bdc-bd79-4dd9-96f3-373f2116adfa","name":"Processa Dati se Valido"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[-1940,1020],"id":"b9daef9d-71f4-4199-b390-250b34e0e80b","name":"COLLEGA A CHATBOT_MAIL__SIMPLE","notes":"Qui collega il workflow principale:\n1. Execute Workflow ‚Üí CHATBOT_MAIL__SIMPLE\n2. I dati sono gi√† formattati per essere compatibili"},{"parameters":{"respondWith":"json","responseBody":"={\n  \"success\": true,\n  \"message\": \"Richiesta ricevuta correttamente\",\n  \"ticket_id\": \"{{ $(''process-webhook-data'').item.json.id }}\",\n  \"timestamp\": \"{{ $now.toISO() }}\"\n}","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1,"position":[-1680,460],"id":"f83a3fc5-feae-4574-928f-f96f6100355c","name":"Risposta Successo"},{"parameters":{"respondWith":"json","responseBody":"={\n  \"success\": false,\n  \"message\": \"Verifica di sicurezza fallita. Riprova.\",\n  \"error\": \"recaptcha_failed\"\n}","options":{}},"type":"n8n-nodes-base.respondToWebhook","typeVersion":1,"position":[-1360,1020],"id":"a90103d6-5d8a-46eb-b5f0-4a0bf04f985d","name":"Risposta Errore","notes":"Risponde con errore se reCAPTCHA fallisce"}]', '{"Form Assistenza GommeGo":{"main":[[{"node":"Form","type":"main","index":0}]]},"Form 1: Assistenza Ordini":{"main":[[{"node":"Processa Dati Unificati","type":"main","index":0}]]},"Form 2: Informazioni Generali":{"main":[[{"node":"Processa Dati Unificati","type":"main","index":0}]]},"Form 3: Richieste Urgenti":{"main":[[{"node":"Processa Dati Unificati","type":"main","index":0}]]},"Processa Dati Unificati":{"main":[[]]},"Webhook Form GommeGo":{"main":[[{"node":"Verifica reCAPTCHA","type":"main","index":0}]]},"Verifica reCAPTCHA":{"main":[[{"node":"Processa Dati se Valido","type":"main","index":0}]]},"Processa Dati se Valido":{"main":[[{"node":"COLLEGA A CHATBOT_MAIL__SIMPLE","type":"main","index":0},{"node":"Risposta Successo","type":"main","index":0}]]}}', '{"executionOrder":"v1"}', NULL, '{}', 'b0e14108-a3b4-4589-8e62-a47d50d34bfe', 5, '{"templateCredsSetupCompleted":true}', NULL, '2025-06-19T14:34:08.302Z', '2025-06-20T11:21:21.000Z', false),
  ('b5ed2014-2d1f-4b55-a927-f66fb7faadb4', 'Gemini_Invoice data Extractor', false, '[{"parameters":{"path":"137ca002-b213-449c-9d68-e1be141ea04c","formTitle":"Estrazione dati fatture internazionali","formDescription":"Carica la fattura","formFields":{"values":[{"fieldLabel":"fattura","fieldType":"file","requiredField":true}]},"options":{"appendAttribution":false,"ignoreBots":true}},"id":"dcd1470c-f6f4-46ac-9a8f-cad8e40c23cb","name":"Form prova fatture","type":"n8n-nodes-base.formTrigger","typeVersion":2.1,"position":[-460,120],"webhookId":"137ca002-b213-449c-9d68-e1be141ea04c","notes":"Punto di ingresso: form per caricamento documenti. Accetta immagini JPG/PNG e PDF. Validazione automatica formato file."},{"parameters":{"modelName":"models/gemini-1.5-flash","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatGoogleGemini","typeVersion":1,"position":[-20,320],"id":"d746b829-2e32-42cb-a968-aa38f0d67750","name":"Google Gemini Chat Model","credentials":{"googlePalmApi":{"id":"owVOESxC0E1TNLDF","name":"Google Gemini(PaLM) GommeGo"}}},{"parameters":{"jsonSchemaExample":"{\n  \"numero_ordine_prestashop\": \"FZISHUXBL\",\n  \"numero_ordine_t24\": \"PTY201022640225\",\n  \"nome_file_fattura\": \"invoice-an-car-3153-tr-2025.pdf\",\n  \"fornitore_nazionalita\": \"IT\",\n  \"fornitore_ragione_sociale\": \"AN CAR s.r.l.\",\n  \"fornitore_partita_iva\": \"IT02025220761\",\n  \"fattura_numero\": \"3153/tr-2025\",\n  \"fattura_data\": \"2025-02-26\",\n  \"fattura_importo_totale\": \"393.68\",\n  \"fattura_totale_imponibile\": \"322.68\",\n  \"fattura_totale_imposte\": \"71.00\",\n  \"fattura_percentuale_iva\": \"22\",\n  \"fattura_totale_pfu\": \"2.85\",\n  \"fattura_spese_spedizione\": \"0\",\n  \"fattura_altri_addebiti\": \"0.99\",\n  \"mese\": \"Febbraio\"\n}"},"type":"@n8n/n8n-nodes-langchain.outputParserStructured","typeVersion":1.3,"position":[220,340],"id":"a74aca6b-8441-4cd3-8233-321f41d6049f","name":"Structured Output Parser"},{"parameters":{"operation":"binaryToPropery","binaryPropertyName":"fattura","options":{}},"type":"n8n-nodes-base.extractFromFile","typeVersion":1,"position":[-220,120],"id":"1efb42f1-13e8-4a0f-a59a-7f87ef92e533","name":"Move file to Binary"},{"parameters":{"promptType":"define","text":"=Analizza il file  {{ $json.data }}","hasOutputParser":true,"messages":{"messageValues":[{"message":"=Sei un sistema specializzato nell''estrazione precisa di dati strutturati da fatture PDF convertite in testo. Segui rigorosamente le istruzioni e gli esempi forniti.\n\n## Istruzioni Principali\n\nEstrai i dati dalla fattura e restituisci un oggetto JSON con i campi specificati. Analizza attentamente il testo fornito\n\n## Esempi di Estrazione (Few-Shot)\n\n### Esempio 1: Fattura Italiana Completa\nInput: \"Causale Rif. ordine FZISHUXBL/PTY201022640225 del 25/02/2025 [...] Cedente/prestatore (fornitore) Identificativo fiscale ai fini IVA: IT02025220761 Codice fiscale: 02025220761 Denominazione: AN CAR s.r.l. [...] TD01 fattura 3153/tr-2025 26/02/2025 [...] Contributo ambientale per il recupero degli pneumatici fuori uso (PFU) [...] 0,90 [...] 1,95 [...] Sovraprezzo per l'' indirizzo di consegna diverso (Tyre24) [...] 0,99 [...] Totale imponibile 322,68 Totale imposta 71,00 [...] Totale documento 393,68\"\n\nOutput:\n```json\n{\n  \"numero_ordine_prestashop\": \"FZISHUXBL\",\n  \"numero_ordine_t24\": \"PTY201022640225\",\n  \"nome_file_fattura\": \"invoice-an-car-3153-tr-2025.pdf\",\n  \"fornitore_nazionalita\": \"IT\",\n  \"fornitore_ragione_sociale\": \"AN CAR s.r.l.\",\n  \"fornitore_partita_iva\": \"IT02025220761\",\n  \"fattura_numero\": \"3153/tr-2025\",\n  \"fattura_data\": \"2025-02-26\",\n  \"fattura_importo_totale\": \"393.68\",\n  \"fattura_totale_imponibile\": \"322.68\",\n  \"fattura_totale_imposte\": \"71.00\",\n  \"fattura_percentuale_iva\": \"22\",\n  \"fattura_totale_pfu\": \"2.85\",\n  \"fattura_spese_spedizione\": \"0\",\n  \"fattura_altri_addebiti\": \"0.99\",\n  \"mese\": \"Febbraio\"\n}\n```\n\n### Esempio 2: Fattura Italiana con Solo PTY\nInput: \"UNIVERSAL GOMME SRLS VIA DELLA CHIMICA SNC 01100 VITERBO (VT) p.iva: 02278440561 [...] fattura n.3982/E del 19/05/2025 Numero d''ordine. PTY208104490525 [...] PNEUMATICI HANKOOK K125 195/55 R16 [...] PFU P2 CONTRIBUTO PFU ECOTYRE [...] 1,950 [...] SPED SPESE DI SPEDIZIONE [...] 0,990 [...] Totale imponibile ‚Ç¨ 285,11 Importo Iva ‚Ç¨ 62,72 Totale Fattura ‚Ç¨ 347,83\"\n\nOutput:\n```json\n{\n  \"numero_ordine_prestashop\": \"\",\n  \"numero_ordine_t24\": \"PTY208104490525\",\n  \"nome_file_fattura\": \"invoice-universal-gomme-3982-e.pdf\",\n  \"fornitore_nazionalita\": \"IT\",\n  \"fornitore_ragione_sociale\": \"UNIVERSAL GOMME SRLS\",\n  \"fornitore_partita_iva\": \"IT02278440561\",\n  \"fattura_numero\": \"3982/E\",\n  \"fattura_data\": \"2025-05-19\",\n  \"fattura_importo_totale\": \"347.83\",\n  \"fattura_totale_imponibile\": \"285.11\",\n  \"fattura_totale_imposte\": \"62.72\",\n  \"fattura_percentuale_iva\": \"22\",\n  \"fattura_totale_pfu\": \"7.80\",\n  \"fattura_spese_spedizione\": \"0.99\",\n  \"fattura_altri_addebiti\": \"0\",\n  \"mese\": \"Maggio\"\n}\n```\n\n### Esempio 3: Fattura Tedesca Intracomunitaria\nInput: \"CBW Reifengro√ühandel GmbH [...] USt. ID: DE 138 210 553 [...] Rechnung R0019240 Datum: 15.05.2025 [...] Bestellnr: PTY206304110525 [...] DKASTOZQI [...] Prezzo per l'' indirizzo di consegna diverso: 0.99 Euro [...] Nettowarenwert 160,60 [...] Innergemeinschaftliche Lieferung - VAT free\"\n\nOutput:\n```json\n{\n  \"numero_ordine_prestashop\": \"DKASTOZQI\",\n  \"numero_ordine_t24\": \"PTY206304110525\",\n  \"nome_file_fattura\": \"invoice-cbw-reifengrosshandel-r0019240.pdf\",\n  \"fornitore_nazionalita\": \"DE\",\n  \"fornitore_ragione_sociale\": \"CBW Reifengro√ühandel GmbH\",\n  \"fornitore_partita_iva\": \"DE138210553\",\n  \"fattura_numero\": \"R0019240\",\n  \"fattura_data\": \"2025-05-15\",\n  \"fattura_importo_totale\": \"160.60\",\n  \"fattura_totale_imponibile\": \"160.60\",\n  \"fattura_totale_imposte\": \"0\",\n  \"fattura_percentuale_iva\": \"0\",\n  \"fattura_totale_pfu\": \"0\",\n  \"fattura_spese_spedizione\": \"0\",\n  \"fattura_altri_addebiti\": \"0.99\",\n  \"mese\": \"Maggio\"\n}\n```\n\n### Esempio 4: Fattura Tedesca con Ordine Prestashop\nInput: \"Pneuforce GmbH [...] UstID: DE355477218 [...] Rechnung Nr. 1103158 [...] Lieferdatum: 02.05.2025 [...] Tyre24-Ref.: QSKSTPDUA Ihre Bestell. Nr.: PTY200450380525 [...] 255/40R17 94 W YOKOHAMA [...] 250,72 ‚Ç¨ [...] DPDPakete Pakete 0,99 ‚Ç¨ [...] Gesamtbetrag (Netto): 251,71 ‚Ç¨ [...] Gesamtbetrag (Brutto): 251,71 ‚Ç¨ Es handelt sich hierbei um eine steuerfreie innergemeinschaftliche Lieferung.\"\n\nOutput:\n```json\n{\n  \"numero_ordine_prestashop\": \"QSKSTPDUA\",\n  \"numero_ordine_t24\": \"PTY200450380525\",\n  \"nome_file_fattura\": \"invoice-pneuforce-1103158.pdf\",\n  \"fornitore_nazionalita\": \"DE\",\n  \"fornitore_ragione_sociale\": \"Pneuforce GmbH\",\n  \"fornitore_partita_iva\": \"DE355477218\",\n  \"fattura_numero\": \"1103158\",\n  \"fattura_data\": \"2025-05-02\",\n  \"fattura_importo_totale\": \"251.71\",\n  \"fattura_totale_imponibile\": \"251.71\",\n  \"fattura_totale_imposte\": \"0\",\n  \"fattura_percentuale_iva\": \"0\",\n  \"fattura_totale_pfu\": \"0\",\n  \"fattura_spese_spedizione\": \"0.99\",\n  \"fattura_altri_addebiti\": \"0\",\n  \"mese\": \"Maggio\"\n}\n```\n\n## Campi da Estrarre\n\n1. **numero_ordine_prestashop**: Codice di 9 caratteri alfabetici maiuscoli (es. \"FZISHUXBL\", \"DKASTOZQI\", \"QSKSTPDUA\"). Se assente, restituisci stringa vuota \"\"\n2. **numero_ordine_t24**: Riferimento che inizia con \"PTY\" seguito da numeri\n3. **nome_file_fattura**: Formato \"invoice-[fornitore-semplificato]-[numero-fattura].pdf\"\n4. **fornitore_nazionalita**: Codice paese ISO a 2 lettere\n5. **fornitore_ragione_sociale**: Nome completo dell''azienda\n6. **fornitore_partita_iva**: P.IVA o VAT ID (rimuovi spazi)\n7. **fattura_numero**: Numero della fattura\n8. **fattura_data**: Data in formato YYYY-MM-DD\n9. **fattura_importo_totale**: Totale con IVA (solo cifre con punto decimale)\n10. **fattura_totale_imponibile**: Totale senza IVA\n11. **fattura_totale_imposte**: Importo IVA (0 per intracomunitarie)\n12. **fattura_percentuale_iva**: Solo numero senza %\n13. **fattura_totale_pfu**: Somma contributi ambientali PFU\n14. **fattura_spese_spedizione**: Costi di spedizione\n15. **fattura_altri_addebiti**: Altri addebiti fissi\n16. **mese**: Nome mese italiano dalla data fattura\n\n## Regole di Estrazione\n\n1. Cerca i campi in qualsiasi lingua (italiano, tedesco, polacco, francese)\n2. Converti date in formato YYYY-MM-DD indipendentemente dal formato originale\n3. Usa il punto come separatore decimale per tutti gli importi\n4. Rimuovi simboli di valuta (‚Ç¨, EUR)\n5. Per fatture intracomunitarie tedesche: IVA = 0, imposte = 0\n6. Valori mancanti: \"\" per stringhe, \"0\" per numeri\n7. Verifica: importo_totale ‚âà totale_imponibile + totale_imposte\n\n## Output\n\nRestituisci esclusivamente l''oggetto JSON con tutti i campi richiesti. Non aggiungere testo, spiegazioni o commenti."}]},"batching":{}},"type":"@n8n/n8n-nodes-langchain.chainLlm","typeVersion":1.7,"position":[20,120],"id":"8a36a9f8-e2ed-4dd8-815c-6037d718367b","name":"Invoice data extractor1","retryOnFail":true,"notes":"Sei un sistema specializzato nell''estrazione precisa di dati strutturati da fatture PDF convertite in testo. Segui rigorosamente le istruzioni e gli esempi forniti.  ## Istruzioni Principali  Estrai i dati dalla fattura e restituisci un oggetto JSON con i campi specificati. Analizza attentamente il testo fornito in: {{ $json.text_agent_ready }}  ## Esempi di Estrazione (Few-Shot)  ### Esempio 1: Fattura Italiana Completa Input: \"Causale Rif. ordine FZISHUXBL/PTY201022640225 del 25/02/2025 [...] Cedente/prestatore (fornitore) Identificativo fiscale ai fini IVA: IT02025220761 Codice fiscale: 02025220761 Denominazione: AN CAR s.r.l. [...] TD01 fattura 3153/tr-2025 26/02/2025 [...] Contributo ambientale per il recupero degli pneumatici fuori uso (PFU) [...] 0,90 [...] 1,95 [...] Sovraprezzo per l'' indirizzo di consegna diverso (Tyre24) [...] 0,99 [...] Totale imponibile 322,68 Totale imposta 71,00 [...] Totale documento 393,68\"  Output: ```json {   \"numero_ordine_prestashop\": \"FZISHUXBL\",   \"numero_ordine_t24\": \"PTY201022640225\",   \"nome_file_fattura\": \"invoice-an-car-3153-tr-2025.pdf\",   \"fornitore_nazionalita\": \"IT\",   \"fornitore_ragione_sociale\": \"AN CAR s.r.l.\",   \"fornitore_partita_iva\": \"IT02025220761\",   \"fattura_numero\": \"3153/tr-2025\",   \"fattura_data\": \"2025-02-26\",   \"fattura_importo_totale\": \"393.68\",   \"fattura_totale_imponibile\": \"322.68\",   \"fattura_totale_imposte\": \"71.00\",   \"fattura_percentuale_iva\": \"22\",   \"fattura_totale_pfu\": \"2.85\",   \"fattura_spese_spedizione\": \"0\",   \"fattura_altri_addebiti\": \"0.99\",   \"mese\": \"Febbraio\" } ```  ### Esempio 2: Fattura Italiana con Solo PTY Input: \"UNIVERSAL GOMME SRLS VIA DELLA CHIMICA SNC 01100 VITERBO (VT) p.iva: 02278440561 [...] fattura n.3982/E del 19/05/2025 Numero d''ordine. PTY208104490525 [...] PNEUMATICI HANKOOK K125 195/55 R16 [...] PFU P2 CONTRIBUTO PFU ECOTYRE [...] 1,950 [...] SPED SPESE DI SPEDIZIONE [...] 0,990 [...] Totale imponibile ‚Ç¨ 285,11 Importo Iva ‚Ç¨ 62,72 Totale Fattura ‚Ç¨ 347,83\"  Output: ```json {   \"numero_ordine_prestashop\": \"\",   \"numero_ordine_t24\": \"PTY208104490525\",   \"nome_file_fattura\": \"invoice-universal-gomme-3982-e.pdf\",   \"fornitore_nazionalita\": \"IT\",   \"fornitore_ragione_sociale\": \"UNIVERSAL GOMME SRLS\",   \"fornitore_partita_iva\": \"IT02278440561\",   \"fattura_numero\": \"3982/E\",   \"fattura_data\": \"2025-05-19\",   \"fattura_importo_totale\": \"347.83\",   \"fattura_totale_imponibile\": \"285.11\",   \"fattura_totale_imposte\": \"62.72\",   \"fattura_percentuale_iva\": \"22\",   \"fattura_totale_pfu\": \"7.80\",   \"fattura_spese_spedizione\": \"0.99\",   \"fattura_altri_addebiti\": \"0\",   \"mese\": \"Maggio\" } ```  ### Esempio 3: Fattura Tedesca Intracomunitaria Input: \"CBW Reifengro√ühandel GmbH [...] USt. ID: DE 138 210 553 [...] Rechnung R0019240 Datum: 15.05.2025 [...] Bestellnr: PTY206304110525 [...] DKASTOZQI [...] Prezzo per l'' indirizzo di consegna diverso: 0.99 Euro [...] Nettowarenwert 160,60 [...] Innergemeinschaftliche Lieferung - VAT free\"  Output: ```json {   \"numero_ordine_prestashop\": \"DKASTOZQI\",   \"numero_ordine_t24\": \"PTY206304110525\",   \"nome_file_fattura\": \"invoice-cbw-reifengrosshandel-r0019240.pdf\",   \"fornitore_nazionalita\": \"DE\",   \"fornitore_ragione_sociale\": \"CBW Reifengro√ühandel GmbH\",   \"fornitore_partita_iva\": \"DE138210553\",   \"fattura_numero\": \"R0019240\",   \"fattura_data\": \"2025-05-15\",   \"fattura_importo_totale\": \"160.60\",   \"fattura_totale_imponibile\": \"160.60\",   \"fattura_totale_imposte\": \"0\",   \"fattura_percentuale_iva\": \"0\",   \"fattura_totale_pfu\": \"0\",   \"fattura_spese_spedizione\": \"0\",   \"fattura_altri_addebiti\": \"0.99\",   \"mese\": \"Maggio\" } ```  ### Esempio 4: Fattura Tedesca con Ordine Prestashop Input: \"Pneuforce GmbH [...] UstID: DE355477218 [...] Rechnung Nr. 1103158 [...] Lieferdatum: 02.05.2025 [...] Tyre24-Ref.: QSKSTPDUA Ihre Bestell. Nr.: PTY200450380525 [...] 255/40R17 94 W YOKOHAMA [...] 250,72 ‚Ç¨ [...] DPDPakete Pakete 0,99 ‚Ç¨ [...] Gesamtbetrag (Netto): 251,71 ‚Ç¨ [...] Gesamtbetrag (Brutto): 251,71 ‚Ç¨ Es handelt sich hierbei um eine steuerfreie innergemeinschaftliche Lieferung.\"  Output: ```json {   \"numero_ordine_prestashop\": \"QSKSTPDUA\",   \"numero_ordine_t24\": \"PTY200450380525\",   \"nome_file_fattura\": \"invoice-pneuforce-1103158.pdf\",   \"fornitore_nazionalita\": \"DE\",   \"fornitore_ragione_sociale\": \"Pneuforce GmbH\",   \"fornitore_partita_iva\": \"DE355477218\",   \"fattura_numero\": \"1103158\",   \"fattura_data\": \"2025-05-02\",   \"fattura_importo_totale\": \"251.71\",   \"fattura_totale_imponibile\": \"251.71\",   \"fattura_totale_imposte\": \"0\",   \"fattura_percentuale_iva\": \"0\",   \"fattura_totale_pfu\": \"0\",   \"fattura_spese_spedizione\": \"0.99\",   \"fattura_altri_addebiti\": \"0\",   \"mese\": \"Maggio\" } ```  ## Campi da Estrarre  1. **numero_ordine_prestashop**: Codice di 9 caratteri alfabetici maiuscoli (es. \"FZISHUXBL\", \"DKASTOZQI\", \"QSKSTPDUA\"). Se assente, restituisci stringa vuota \"\" 2. **numero_ordine_t24**: Riferimento che inizia con \"PTY\" seguito da numeri 3. **nome_file_fattura**: Formato \"invoice-[fornitore-semplificato]-[numero-fattura].pdf\" 4. **fornitore_nazionalita**: Codice paese ISO a 2 lettere 5. **fornitore_ragione_sociale**: Nome completo dell''azienda 6. **fornitore_partita_iva**: P.IVA o VAT ID (rimuovi spazi) 7. **fattura_numero**: Numero della fattura 8. **fattura_data**: Data in formato YYYY-MM-DD 9. **fattura_importo_totale**: Totale con IVA (solo cifre con punto decimale) 10. **fattura_totale_imponibile**: Totale senza IVA 11. **fattura_totale_imposte**: Importo IVA (0 per intracomunitarie) 12. **fattura_percentuale_iva**: Solo numero senza % 13. **fattura_totale_pfu**: Somma contributi ambientali PFU 14. **fattura_spese_spedizione**: Costi di spedizione 15. **fattura_altri_addebiti**: Altri addebiti fissi 16. **mese**: Nome mese italiano dalla data fattura  ## Regole di Estrazione  1. Cerca i campi in qualsiasi lingua (italiano, tedesco, polacco, francese) 2. Converti date in formato YYYY-MM-DD indipendentemente dal formato originale 3. Usa il punto come separatore decimale per tutti gli importi 4. Rimuovi simboli di valuta (‚Ç¨, EUR) 5. Per fatture intracomunitarie tedesche: IVA = 0, imposte = 0 6. Valori mancanti: \"\" per stringhe, \"0\" per numeri 7. Verifica: importo_totale ‚âà totale_imponibile + totale_imposte  ## Output  Restituisci esclusivamente l''oggetto JSON con tutti i campi richiesti. Non aggiungere testo, spiegazioni o commenti."}]', '{"Form prova fatture":{"main":[[{"node":"Move file to Binary","type":"main","index":0}]]},"Google Gemini Chat Model":{"ai_languageModel":[[{"node":"Invoice data extractor1","type":"ai_languageModel","index":0}]]},"Structured Output Parser":{"ai_outputParser":[[{"node":"Invoice data extractor1","type":"ai_outputParser","index":0}]]},"Move file to Binary":{"main":[[{"node":"Invoice data extractor1","type":"main","index":0}]]},"Invoice data extractor1":{"main":[[]]}}', '{"executionOrder":"v1"}', NULL, '{}', '6394cb8a-c1b8-49b1-ad3a-e754a4dfe423', 0, '{"templateCredsSetupCompleted":true}', NULL, '2025-06-19T19:24:44.409Z', '2025-06-19T20:31:45.000Z', false),
  ('cbb79522-63a7-46c5-be30-40bbeaec4f83', 'Batching fatture T24', false, '[{"parameters":{"resource":"folderMessage","folderId":{"__rl":true,"value":"AAMkADY5YTU5ODIzLTM5M2MtNGU4Zi04YzNmLTBlYmYxNDNhODNjMAAuAAAAAAAty8lTOVoeRrTqgTQml0B1AQAYYLMeDvsGSqoDRrzkfpW2AAA3x-uFAAA=","mode":"list","cachedResultName":"FATTURE","cachedResultUrl":"https://outlook.office365.com/mail/AAMkADY5YTU5ODIzLTM5M2MtNGU4Zi04YzNmLTBlYmYxNDNhODNjMAAuAAAAAAAty8lTOVoeRrTqgTQml0B1AQAYYLMeDvsGSqoDRrzkfpW2AAA3x%2FuFAAA%3D"},"limit":2,"output":"fields","fields":["body","createdDateTime","subject"],"options":{"downloadAttachments":true}},"type":"n8n-nodes-base.microsoftOutlook","typeVersion":2,"position":[-1060,-760],"id":"a4bddca5-e27e-4b84-a682-60c99b33d7a1","name":"Microsoft Outlook","webhookId":"dabcf37c-9f56-4fee-8e9b-bcc6d26456df","retryOnFail":true,"credentials":{"microsoftOutlookOAuth2Api":{"id":"gvsjOBgXBwH8vLH8","name":"Outlook Supplies"}}},{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[-1320,-420],"id":"8f2ffd95-aacc-4a0f-a736-b05c83e4aa26","name":"When clicking ‚ÄòExecute workflow‚Äô"},{"parameters":{"operation":"binaryToPropery","binaryPropertyName":"attachment_0","options":{}},"type":"n8n-nodes-base.extractFromFile","typeVersion":1,"position":[-640,-880],"id":"01a677ce-afe4-4335-a844-3be0f7ad8dc1","name":"Move file to Binary"},{"parameters":{"url":"https://us-central1-aiplatform.googleapis.com/v1/projects/nnn-450814/locations/us-central1/models","authentication":"genericCredentialType","genericAuthType":"httpHeaderAuth","options":{}},"type":"n8n-nodes-base.httpRequest","typeVersion":4.2,"position":[-800,-660],"id":"1e69ed58-8903-4452-8131-d051a9699ac3","name":"Call Gemini 1.5 Flash (Batch)","alwaysOutputData":true,"credentials":{"httpHeaderAuth":{"id":"np24ApXHsWsh6wZK","name":"Google Token Manuale"},"googleApi":{"id":"UhvvNDN92DqmqIOw","name":"Google Service Account "}}},{"parameters":{"command":"gcloud auth print-access-token"},"type":"n8n-nodes-base.executeCommand","typeVersion":1,"position":[-1040,-400],"id":"dc213567-763c-4413-8e74-ca5e0e96fa79","name":"Execute Command"}]', '{"When clicking ‚ÄòExecute workflow‚Äô":{"main":[[{"node":"Execute Command","type":"main","index":0}]]},"Microsoft Outlook":{"main":[[]]},"Call Gemini 1.5 Flash (Batch)":{"main":[[]]}}', '{"executionOrder":"v1"}', NULL, '{}', 'c46a80cf-08b7-4b69-b8d4-4bfc61501a26', 0, '{"templateCredsSetupCompleted":true}', NULL, '2025-06-19T20:32:26.204Z', '2025-06-19T22:43:31.000Z', false),
  ('d7ee32c2-706a-45b4-85f2-f13d79be98c1', 'RETURN VALIDATION & INTAKE', true, '[{"parameters":{"jsCode":"// Mappa i dati del form\nconst motivoMap = {\n  ''prodotto_errato'': ''GOMMEGO'',\n  ''ordine_sbagliato'': ''CLIENTE'', \n  ''difettoso'': ''FORNITORE'',\n  ''danneggiato'': ''CORRIERE''\n};\n\nreturn {\n  numero_ordine: $json[''Numero Ordine''],\n  email_cliente: $json[''Email Conferma Ordine''],\n  motivo_reso: $json[''Motivo del Reso''],\n  responsabilita: motivoMap[$json[''Motivo del Reso'']],\n  descrizione_problema: $json[''Descrizione del Problema'']\n};"},"id":"38eac349-913b-4304-91f6-77e2762aa33e","name":"Prepara Dati","type":"n8n-nodes-base.code","typeVersion":1,"position":[-1460,-1880]},{"parameters":{"values":{"string":[{"name":"rma","value":"RMA-2024-{{ Math.floor(Math.random() * 10000) }}"},{"name":"Tipo Reso","value":"RESO CON ADDEBITO FORNITORE"}]},"options":{}},"id":"ae8650ec-95c3-4161-a288-924c07aeb748","name":"Genera RMA","type":"n8n-nodes-base.set","typeVersion":1,"position":[-1240,-1620]},{"parameters":{"values":{"string":[{"name":"Email fornitore","value":"Gentile Fornitore,\n\nRichiesta reso RMA: {{ $json.rma }}\nOrdine: {{ $json.numero_ordine }}\nMotivo: {{ $json.motivo_reso }}\n\nConfermare accettazione."},{"name":"emailCliente","value":"Gentile Cliente,\n\nConfermiamo ricezione richiesta reso.\nRMA: {{ $json.rma }}\n\nTempo stimato: 7-10 giorni."}]},"options":{}},"id":"d067e3cf-54b9-489c-844e-ab43abf17661","name":"Prepara Email","type":"n8n-nodes-base.set","typeVersion":1,"position":[-300,-340]},{"parameters":{"values":{"string":[{"name":"message","value":"Richiesta reso registrata con successo! RMA: {{ $json.rma }}"}]},"options":{}},"id":"cf01ed1a-17c0-4932-a1a6-dc6232b0650c","name":"Response","type":"n8n-nodes-base.set","typeVersion":1,"position":[-1460,-640]},{"parameters":{"formTitle":"FORM RESI  - RESTITUZIONE MERCI","formDescription":"Compila tutti i campi per la restituzione della merce","formFields":{"values":[{"fieldLabel":"Nome e Cognome cliente","requiredField":true},{"fieldLabel":"Email di conferma ordine","fieldType":"email","requiredField":true},{"fieldLabel":"Nr Ordine","placeholder":"es.  YHHHGBFB","requiredField":true},{"fieldLabel":"Data ricezione merce","fieldType":"date","requiredField":true},{"fieldLabel":"Motivo della restituzione ","fieldType":"dropdown","fieldOptions":{"values":[{"option":"Ho ricevuto merce sbagliata"},{"option":"Ho ordinato merce sbagliata"},{"option":"La merce √® arrivata danneggiata "},{"option":"La merce mi √® stata consegnata con estremo ritardo"}]},"requiredField":true},{"fieldLabel":"Descrizione del problema ","fieldType":"textarea","placeholder":"descrivi brevemente il problema ","requiredField":true},{"fieldLabel":"Allega una foto della merce ricevuta","fieldType":"file","requiredField":true},{"fieldType":"html","elementName":"Documentazione Obbligatoria!","html":"<div style=\"background-color: #fef3c7; border: 2px solid #f59e0b; border-radius: 8px; padding: 16px; margin: 16px 0; font-family: Arial, sans-serif;\">\n    <p style=\"margin: 0 0 12px 0; font-weight: bold; color: #EA6B48; font-size: 16px; text-transform: uppercase;\">\n        DOCUMENTAZIONE OBBLIGATORIA\n    </p>\n    \n    <p style=\"margin: 0 0 12px 0; line-height: 1.5; color: #78350f;\">\n        In tutti i casi di reso merce <strong style=\"background-color: #fff; padding: 2px 4px; border-radius: 3px;\">√® necessario allegare:\n    </p>\n    \n    <ul style=\"margin: 0 0 12px 0; padding-left: 20px; color: #78350f;\">\n        <li style=\"margin-bottom: 4px;\">Foto dell''imballo esterno che mostri eventuali danni</li>\n        <li>Foto dell''etichetta identificativa della merce ricevuta</li>\n    </ul>\n    \n    <p style=\"margin: 0; font-size: 13px; color: #92400e; font-style: italic;\">\n        La mancanza di documentazione fotografica potrebbe comportare il rifiuto della richiesta.\n    </p>\n</div>"}]},"responseMode":"lastNode","options":{"appendAttribution":false,"buttonLabel":"Invia Richiesta","respondWithOptions":{"values":{"formSubmittedText":"La tua richiesta √® stata registrata!"}},"ignoreBots":true}},"type":"n8n-nodes-base.formTrigger","typeVersion":2.2,"position":[-1720,800],"id":"5447d3b9-3d2f-4794-b7db-35fda54e5d97","name":"On form submission","webhookId":"2c77a0da-6beb-48b1-acc8-bc20b702449e"},{"parameters":{"values":{"string":[{"name":"rma","value":"RMAGG-2025-{{ Math.floor(Math.random() * 10000) }}"},{"name":"stato","value":"RESO CON ADDEBITO GOMMEGO"}]},"options":{}},"id":"c7218c16-b4ae-4714-80e6-474124dc5bf0","name":"Genera RMA1","type":"n8n-nodes-base.set","typeVersion":1,"position":[-1240,-1420]},{"parameters":{"operation":"toBinary","sourceProperty":"Allega una foto della merce ricevuta (solo se Responsabilit√† di GommeGo)","options":{}},"type":"n8n-nodes-base.convertToFile","typeVersion":1.1,"position":[-1460,-1160],"id":"656216f5-6795-491b-bf4d-76e96f0ab39f","name":"Convert to File1"},{"parameters":{"inputDataFieldName":"Allega_una_foto_della_merce_ricevuta","name":"={{ $(''On form submission'').item.json[\"Nr Ordine\"] }} - {{ $json[\"Nome e Cognome cliente\"] }} - {{ $json[\"Data ricezione merce\"] }}","driveId":{"__rl":true,"value":"My Drive","mode":"list","cachedResultName":"My Drive","cachedResultUrl":"https://drive.google.com/drive/my-drive"},"folderId":{"__rl":true,"value":"1PRKTIajj1Qyp74Te2fkwTYe4FlYPbrDv","mode":"list","cachedResultName":"IMMAGINI RESI CLIENTE","cachedResultUrl":"https://drive.google.com/drive/folders/1PRKTIajj1Qyp74Te2fkwTYe4FlYPbrDv"},"options":{}},"type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[-1500,1000],"id":"7526b0d0-5110-4f97-90b1-197d969201d3","name":"Carica immagini Merce","credentials":{"googleDriveOAuth2Api":{"id":"WBhAeqmWykJUM02S","name":"Google Drive account"}}},{"parameters":{"resource":"image","operation":"analyze","modelId":{"__rl":true,"value":"chatgpt-4o-latest","mode":"list","cachedResultName":"CHATGPT-4O-LATEST"},"text":"Analizza il testo estratto dall''immagine e la descrizione dell''immagine per identificare informazioni sul prodotto e problemi del reso.\n\nIMPORTANTE: Dividi SEMPRE il tuo output in due sezioni ben distinte:\n1. **Testo estratto (in italiano):** [qui riporta TUTTO il testo OCR trovato nell''immagine]\n2. **Descrizione dell''immagine:** [qui descrivi cosa vedi nell''immagine]\n\nDal testo estratto, identifica le seguenti informazioni se presenti:\n\nINFORMAZIONI PRODOTTO:\n- Codice prodotto/SKU: cerca pattern come SKU, COD, CODE, CODICE, ART, REF seguiti da codici alfanumerici\n- Dimensioni pneumatico: cerca pattern come 225/45R17, 205/55 R16, ecc.\n- Marca/Brand: cerca parole come MARCA, BRAND, MARCHIO\n- Modello: cerca MODEL, MODELLO\n- Numero serie: cerca S/N, SERIAL, SERIE\n- Data produzione: cerca PROD, MFG, PRODUZIONE seguiti da date\n\nANALISI PROBLEMI (dalla descrizione dell''immagine):\n- Danno visibile: cerca riferimenti a danni, rotture, difetti, crepe, graffi, ammaccature\n- Prodotto errato: cerca indicazioni di prodotto diverso, errato, sbagliato, non corrisponde\n- Problema imballo: cerca riferimenti a imballo, scatola, confezione, pacco, busta\n- Componenti mancanti: cerca indicazioni di mancanza, assenza, incompleto\n- Problema qualit√†: cerca riferimenti a qualit√†, difetto, malfunzionamento\n\nFornisci un''analisi dettagliata identificando:\n1. Tipo di prodotto visibile\n2. Eventuali codici o etichette leggibili\n3. Problemi visibili che giustificano il reso\n4. Stato dell''imballo\n5. Corrispondenza con quanto ordinato (se deducibile)\n\nSii specifico e descrittivo nell''analisi dell''immagine per supportare la richiesta di reso.","inputType":"base64","binaryPropertyName":"Allega_una_foto_della_merce_ricevuta","options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[-1500,800],"id":"2d12910e-de5c-4e25-98ac-44c3dc2d99e7","name":"Estrai Testo","alwaysOutputData":true,"credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"jsCode":"try {\n  // Ottieni i dati JSON del form\n  const formData = $input.first().json;\n  \n  // Il campo del file dal form\n  const fileField = formData[\"Carica il tuo documento (Carta d''identit√† o Patente)\"];\n  \n  if (!fileField || !Array.isArray(fileField) || fileField.length === 0) {\n    throw new Error(''Nessun file caricato nel form'');\n  }\n  \n  // Prendi il primo file\n  const fileInfo = fileField[0];\n  \n  // IMPORTANTE: n8n converte i nomi dei campi binari sostituendo caratteri speciali\n  // Il nome reale del campo binario √® quello che vediamo nel debug\n  const binaryPropertyName = \"Carica_il_tuo_documento__Carta_d_identit__o_Patente_\";\n  \n  // Accedi ai dati binari\n  const binaryData = $input.first().binary;\n  \n  if (!binaryData || !binaryData[binaryPropertyName]) {\n    throw new Error(`Dati binari non trovati con chiave: ${binaryPropertyName}`);\n  }\n  \n  // Ottieni i dati binari specifici\n  const fileBinaryData = binaryData[binaryPropertyName];\n  \n  // Estrai informazioni\n  const fileName = fileInfo.filename;\n  const mimeType = fileInfo.mimetype;\n  const fileSize = fileInfo.size;\n  \n  // Inizializza i controlli di qualit√†\n  const qualityChecks = {\n    fileSize: { passed: false, message: '''' },\n    fileType: { passed: false, message: '''' },\n    imageQuality: { passed: false, message: '''' }\n  };\n  \n  // 1. CONTROLLO DIMENSIONE FILE (max 10MB)\n  const maxSize = 10 * 1024 * 1024; // 10MB\n  const minSize = 50 * 1024; // 50KB\n  \n  if (fileSize > maxSize) {\n    qualityChecks.fileSize.passed = false;\n    qualityChecks.fileSize.message = `File troppo grande: ${(fileSize/1024/1024).toFixed(2)}MB (max 10MB)`;\n  } else if (fileSize < minSize) {\n    qualityChecks.fileSize.passed = false;\n    qualityChecks.fileSize.message = `File troppo piccolo: ${(fileSize/1024).toFixed(0)}KB (min 50KB)`;\n  } else {\n    qualityChecks.fileSize.passed = true;\n    qualityChecks.fileSize.message = `Dimensione OK: ${(fileSize/1024/1024).toFixed(2)}MB`;\n  }\n  \n  // 2. CONTROLLO TIPO FILE\n  const allowedTypes = [''image/jpeg'', ''image/jpg'', ''image/png'', ''application/pdf''];\n  if (allowedTypes.includes(mimeType)) {\n    qualityChecks.fileType.passed = true;\n    qualityChecks.fileType.message = `Formato supportato: ${mimeType}`;\n  } else {\n    qualityChecks.fileType.passed = false;\n    qualityChecks.fileType.message = `Formato non supportato: ${mimeType}`;\n  }\n  \n  // 3. ANALISI QUALIT√Ä IMMAGINE\n  if (mimeType.startsWith(''image/'')) {\n    const estimatedQuality = fileSize / 1024; // KB\n    \n    if (estimatedQuality < 100) {\n      qualityChecks.imageQuality.passed = false;\n      qualityChecks.imageQuality.message = ''Qualit√† insufficiente - immagine troppo compressa'';\n    } else if (estimatedQuality < 200) {\n      qualityChecks.imageQuality.passed = true;\n      qualityChecks.imageQuality.message = ''Qualit√† accettabile ma non ottimale'';\n    } else {\n      qualityChecks.imageQuality.passed = true;\n      qualityChecks.imageQuality.message = ''Qualit√† ottima per OCR'';\n    }\n  } else if (mimeType === ''application/pdf'') {\n    qualityChecks.imageQuality.passed = true;\n    qualityChecks.imageQuality.message = ''PDF - qualit√† non verificabile'';\n  }\n  \n  // VALUTAZIONE FINALE\n  const allPassed = Object.values(qualityChecks).every(check => check.passed);\n  const validationStatus = allPassed ? ''PASSED'' : ''REJECTED'';\n  \n  // Calcola quality score\n  let qualityScore = 0;\n  if (qualityChecks.fileSize.passed) qualityScore += 33;\n  if (qualityChecks.fileType.passed) qualityScore += 33;\n  if (qualityChecks.imageQuality.passed) qualityScore += 34;\n  \n  // Prepara l''output\n  const result = {\n    json: {\n      validationStatus: validationStatus,\n      passed: allPassed,\n      fileName: fileName,\n      mimeType: mimeType,\n      fileSize: fileSize,\n      fileSizeReadable: `${(fileSize/1024/1024).toFixed(2)}MB`,\n      qualityChecks: qualityChecks,\n      qualityScore: qualityScore,\n      userMessage: allPassed ? \n        ''‚úÖ Documento valido e pronto per elaborazione OCR'' : \n        ''‚ùå Documento non supera i controlli di qualit√†'',\n      validatedAt: new Date().toISOString()\n    }\n  };\n  \n  // Se PASSED, passa i dati binari con il nome corretto\n  if (allPassed) {\n    result.binary = {\n      data: fileBinaryData  // Usa l''oggetto binary del file\n    };\n  }\n  \n  return result;\n  \n} catch (error) {\n  return {\n    json: {\n      validationStatus: ''REJECTED'',\n      passed: false,\n      error: error.message,\n      userMessage: `‚ùå Errore validazione: ${error.message}`,\n      validatedAt: new Date().toISOString()\n    }\n  };\n}"},"id":"573b36a3-eeed-4441-a3e3-35c1299a8386","name":"Validazione File","type":"n8n-nodes-base.code","typeVersion":2,"position":[-1460,-900],"notes":"Valida il file caricato: controlla formato, dimensione e prepara per upload. Converte da base64 a binary."},{"parameters":{"jsCode":"const raw = $input.first().json.content;\nif (!raw) throw new Error(''Nessun testo OCR rilevato'');\n\n// Dividi il content in due parti\nconst parts = raw.split(''**Descrizione dell\\''immagine:**'');\nconst testoEstratto = parts[0] ? parts[0].replace(/\\*\\*Testo estratto \\(in italiano\\):\\*\\*/, '''').trim() : '''';\nconst descrizioneImmagine = parts[1] ? parts[1].trim() : '''';\n\n// Output semplice con solo le due parti divise\nconst output = {\n  testo_estratto: testoEstratto,\n  descrizione_immagine: descrizioneImmagine\n};\n\nreturn [{ json: output }];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-1280,800],"id":"615e7911-cc0c-45dc-8075-233b8355f466","name":"Formatta Dati","alwaysOutputData":true},{"parameters":{"assignments":{"assignments":[{"id":"f74c1e5b-5838-4281-89a2-dfcc04062d6a","name":"Nome e Cognome cliente","value":"={{ $json[\"Nome e Cognome cliente\"] }}","type":"string"},{"id":"04c68c45-ed7a-4356-8820-8653bcaa7b9b","name":"Email di conferma ordine","value":"={{ $json[\"Email di conferma ordine\"] }}","type":"string"},{"id":"e0bc77a9-c169-4978-975b-6ad313932e32","name":"Nr Ordine","value":"={{ $json[\"Nr Ordine\"] }}","type":"string"},{"id":"6482f6e5-91d1-4d54-b33b-04dfcda273c0","name":"Data ricezione merce","value":"={{ $json[\"Data ricezione merce\"] }}","type":"string"},{"id":"4a6b92f0-3d8c-4aae-9d62-f165608aa26e","name":"Motivo della restituzione ","value":"={{ $json[\"Motivo della restituzione \"] }}","type":"string"},{"id":"2d845429-6d32-4d37-9e75-92de5ff54e8e","name":"Descrizione del problema ","value":"={{ $json[\"Descrizione del problema \"] }}","type":"string"},{"id":"2293d184-239a-4047-8ee1-a6071b6669f4","name":"=Foto allegate?","value":"={{ $json[\"Allega una foto della merce ricevuta (solo se Responsabilit√† di GommeGo)\"] ? true : false }}","type":"string"},{"id":"bcfd8dcd-6b63-4a9a-acfc-f4f23aa9174e","name":"data inoltro richiesta","value":"={{ new Date($json[\"submittedAt\"]).toISOString().slice(0, 10) }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-1500,620],"id":"9a4be39a-2d56-4216-a87d-8d01b4c92064","name":"Mappa Dati","alwaysOutputData":true},{"parameters":{"mode":"combine","combineBy":"combineByPosition","numberInputs":3,"options":{}},"type":"n8n-nodes-base.merge","typeVersion":3.2,"position":[-1000,800],"id":"1c221a12-42b0-4a26-ac31-88d8a82f7259","name":"Merge"},{"parameters":{"modelName":"models/gemini-1.5-flash-latest","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatGoogleGemini","typeVersion":1,"position":[-760,660],"id":"7573708d-d1e4-4cc4-9ca4-751fdc0227fc","name":"Google Gemini Chat Model","credentials":{"googlePalmApi":{"id":"owVOESxC0E1TNLDF","name":"Google Gemini(PaLM) GommeGo"}}},{"parameters":{"workflowId":{"__rl":true,"value":"dQ0r6zTsY02PDG8X","mode":"list","cachedResultName":"SUB_API_INFO_ORDER & PARCELSAPP"},"workflowInputs":{"mappingMode":"defineBelow","value":{},"matchingColumns":[],"schema":[],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[-640,660],"id":"fd69801c-14d6-4e42-847e-4e7447d9ef31","name":"Call n8n Workflow Tool"},{"parameters":{"descriptionType":"manual","toolDescription":"Da questo tool devi prendere il campo ","operation":"get","tableId":"orders_processed"},"type":"n8n-nodes-base.supabaseTool","typeVersion":1,"position":[-520,660],"id":"7ac4e5fe-625d-4b24-88d8-3c6912da57fe","name":"Supabase","credentials":{"supabaseApi":{"id":"BkVV9D4yOfHR3iC4","name":"Supabase tecsolutions"}}},{"parameters":{"promptType":"define","text":"=","options":{"systemMessage":""}},"id":"fd30b17b-fe8b-4dff-bad0-8c49dcf20b36","name":"VALIDAZIONE E INTAKE","type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.7,"position":[-720,440],"notesInFlow":true,"notes":"üîπ Agente AI per diagnosi embedding"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"ea0dc5bb-61a5-4a42-adab-6e6593f92088","leftValue":"={{ $json[\"Motivo della restituzione \"] }}","rightValue":"(Responsabilit√† di GommeGo)","operator":{"type":"string","operation":"contains"}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-1460,-1520],"id":"53c07006-4a08-4875-a701-ace9ecf5287c","name":"If"},{"parameters":{"content":"## Mappatura dati e foto\n\n1) estrazione dei dati del form\n2 )Analisi della foto allegata con estrazione testo e descrizione\n\n3) Salvataggio foto con nuova nome","height":660,"width":580,"color":7},"type":"n8n-nodes-base.stickyNote","position":[-1700,-1400],"typeVersion":1,"id":"65843ec0-ba6f-4a1a-8d63-9bd62ed3a21a","name":"Sticky Note"},{"parameters":{"assignments":{"assignments":[{"id":"e44032c9-0758-4119-8022-000f536bcf2e","name":"Nome Foto Allegata","value":"={{ $json.name }}","type":"string"}]},"options":{"ignoreConversionErrors":false}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-1280,1000],"id":"f107f741-3385-4e54-8ed9-5cd022d774ed","name":"Mappa nome File","alwaysOutputData":true},{"parameters":{"workflowId":{"__rl":true,"value":"ZSnrpT2XPhUmFAVE","mode":"list","cachedResultName":"SUB_RETURN_INFO_ORDER & PARCELSAPP"},"workflowInputs":{"mappingMode":"defineBelow","value":{},"matchingColumns":[],"schema":[],"attemptToConvertTypes":false,"convertFieldsToString":true},"options":{}},"type":"n8n-nodes-base.executeWorkflow","typeVersion":1.2,"position":[-580,920],"id":"542a801d-dd7d-47b1-a2fc-22310963c220","name":"Execute Workflow"},{"parameters":{"assignments":{"assignments":[{"id":"9f9d467c-4eb4-404c-82a6-027c6c997fc7","name":"query","value":"={{ $json[\"Nr Ordine\"] }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-800,920],"id":"aeb3ac24-840a-4623-b9a5-4bf04f1a9d62","name":"MAPPA NUMERO ORDINE"},{"parameters":{"tableId":"return_orders","fieldsUi":{"fieldValues":[{"fieldId":"order_found","fieldValue":"={{ $json.orderFound }}"},{"fieldId":"rma_id"},{"fieldId":"customer_full_name","fieldValue":"={{ $json[\"Nome e Cognome cliente\"] }}"},{"fieldId":"customer_email","fieldValue":"={{ $json[\"Email di conferma ordine\"] }}"},{"fieldId":"order_reference","fieldValue":"={{ $json[\"Nr Ordine\"] }}"},{"fieldId":"data_ricezione_merce","fieldValue":"={{ $json[\"Data ricezione merce\"] }}"},{"fieldId":"data_inoltro_richiesta","fieldValue":"={{ $json[\"data inoltro richiesta\"] }}"},{"fieldId":"motivo_restituzione","fieldValue":"={{ $json[\"Motivo della restituzione \"] }}"},{"fieldId":"descrizione_problema","fieldValue":"={{ $json[\"Descrizione del problema \"] }}"},{"fieldId":"foto_allegate","fieldValue":"={{ $json[\"Foto allegate?\"] }}"},{"fieldId":"nome_foto_allegata","fieldValue":"={{ $json[\"Nome Foto Allegata\"] }}"},{"fieldId":"testo_estratto","fieldValue":"={{ $json.testo_estratto }}"},{"fieldId":"descrizione_immagine","fieldValue":"={{ $json.descrizione_immagine }}"},{"fieldId":"order_products_0_name","fieldValue":"={{ $json.order_products_0_name }}"},{"fieldId":"order_products_0_reference","fieldValue":"={{ $json.order_products_0_reference }}"},{"fieldId":"order_products_0_ean","fieldValue":"={{ $json.order_products_0_ean }}"},{"fieldId":"order_products_0_quantity","fieldValue":"={{ $json.order_products_0_quantity }}"},{"fieldId":"order_products_0_unit_price","fieldValue":"={{ $json.order_products_0_unit_price }}"},{"fieldId":"order_products_0_total_price","fieldValue":"={{ $json.order_products_0_total_price }}"},{"fieldId":"order_products_1_name","fieldValue":"={{ $json.customer_email }}"},{"fieldId":"order_products_1_reference","fieldValue":"={{ $json[\"order_products_1_reference\"] || null }}"},{"fieldId":"order_products_1_ean","fieldValue":"={{ $json[\"order_products_1_ean\"] || null }}"},{"fieldId":"order_products_1_quantity","fieldValue":"={{ $json[\"order_products_1_quantity\"] ?? null }}"},{"fieldId":"order_products_1_unit_price","fieldValue":"={{ $json[\"order_products_1_unit_price\"] || null }}"},{"fieldId":"order_products_1_total_price","fieldValue":"={{ $json[\"order_products_1_total_price\"] || null }}"},{"fieldId":"shipment_arrival_date","fieldValue":"={{ $json.shipment_arrival_date }}"},{"fieldId":"shipment_tracking_number","fieldValue":"={{ $json.shipment_tracking_number }}"},{"fieldId":"shipment_tracking_url","fieldValue":"={{ $json.shipment_tracking_url }}"},{"fieldId":"reso_autorizzato","fieldValue":"={{ $json[\"reso richiesto entro 14 giorni\"] }}"},{"fieldId":"giorni_trascorsi","fieldValue":"={{ $json[\"giorni passati\"] }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[260,420],"id":"1afa0ba6-398e-4319-8787-227e3c2001a6","name":"INSERT CAMPI RMA","credentials":{"supabaseApi":{"id":"BkVV9D4yOfHR3iC4","name":"Supabase tecsolutions"}}},{"parameters":{"tableId":"return_orders","fieldsUi":{"fieldValues":[{"fieldId":"order_status","fieldValue":"={{ $json.order_status }}"},{"fieldId":"order_total_paid","fieldValue":"={{ $json.order_total_paid }}"},{"fieldId":"order_total_products","fieldValue":"={{ $json.order_total_products }}"},{"fieldId":"order_total_products_with_tax","fieldValue":"={{ $json.order_total_products_with_tax }}"},{"fieldId":"order_products_0_name","fieldValue":"={{ $json.order_products_0_name }}"},{"fieldId":"order_products_0_reference","fieldValue":"={{ $json.order_products_0_reference }}"},{"fieldId":"order_products_0_ean","fieldValue":"={{ $json.order_products_0_ean }}"},{"fieldId":"order_products_0_quantity","fieldValue":"={{ $json.order_products_0_quantity }}"},{"fieldId":"order_products_0_unit_price","fieldValue":"={{ $json.order_products_0_unit_price }}"},{"fieldId":"order_products_0_total_price","fieldValue":"={{ $json.order_products_0_total_price }}"},{"fieldId":"order_products_1_name","fieldValue":"={{ $json.order_products_1_name }}"},{"fieldId":"order_products_1_reference","fieldValue":"={{ $json.order_products_1_reference }}"},{"fieldId":"order_products_1_ean","fieldValue":"={{ $json.order_products_1_ean }}"},{"fieldId":"order_products_1_quantity","fieldValue":"={{ $json.order_products_1_quantity }}"},{"fieldId":"order_products_1_unit_price","fieldValue":"={{ $json.order_products_1_unit_price }}"},{"fieldId":"order_products_1_total_price","fieldValue":"={{ $json.order_products_1_total_price }}"},{"fieldId":"customer_full_name","fieldValue":"={{ $json.customer_full_name }}"},{"fieldId":"customer_email","fieldValue":"={{ $json.customer_email }}"},{"fieldId":"customer_phone","fieldValue":"={{ $json.customer_phone }}"},{"fieldId":"delivery_recipient","fieldValue":"={{ $json.delivery_recipient }}"},{"fieldId":"delivery_street","fieldValue":"={{ $json.delivery_street }}"},{"fieldId":"delivery_postcode","fieldValue":"={{ $json.delivery_postcode }}"},{"fieldId":"delivery_country","fieldValue":"={{ $json.delivery_country }}"},{"fieldId":"delivery_phone","fieldValue":"={{ $json.delivery_phone }}"},{"fieldId":"delivery_fiscal_code","fieldValue":"={{ $json.delivery_fiscal_code }}"},{"fieldId":"shipment_tracking_url","fieldValue":"={{ $json.shipment_tracking_url }}"},{"fieldId":"shipment_latest_status","fieldValue":"={{ $json.shipment_latest_status }}"},{"fieldId":"shipment_latest_status_date","fieldValue":"={{ $json.shipment_latest_status_date }}"},{"fieldId":"shipment_departure_date","fieldValue":"={{ $json.shipment_departure_date }}"},{"fieldId":"shipment_transit_days","fieldValue":"={{ $json.shipment_transit_days ? $json.shipment_transit_days : null }}"},{"fieldId":"response","fieldValue":"={{ $json.Response }}"},{"fieldId":"delivery_city","fieldValue":"={{ $json.delivery_city }}"},{"fieldId":"order_reference","fieldValue":"={{ $json.order_reference }}"},{"fieldId":"order_found","fieldValue":"={{ $json.orderFound }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[60,-300],"id":"2593691e-4c3a-4749-a8f3-3e2b46ddc9d9","name":"Supabase1","credentials":{"supabaseApi":{"id":"BkVV9D4yOfHR3iC4","name":"Supabase tecsolutions"}}},{"parameters":{"mode":"combine","combineBy":"combineByPosition","options":{}},"type":"n8n-nodes-base.merge","typeVersion":3.2,"position":[-380,820],"id":"1574316b-79f2-462b-a0ea-e23dad70dae1","name":"Merge1"},{"parameters":{"values":{"string":[{"name":"Email fornitore","value":"Gentile Fornitore,\n\nRichiesta reso RMA: {{ $json.rma }}\nOrdine: {{ $json.numero_ordine }}\nMotivo: {{ $json.motivo_reso }}\n\nConfermare accettazione."},{"name":"emailCliente","value":"Gentile Cliente,\n\nConfermiamo ricezione richiesta reso.\nRMA: {{ $json.rma }}\n\nTempo stimato: 7-10 giorni."}]},"options":{}},"id":"3930d1c9-37bd-46c8-842d-a3c52933cee7","name":"Prepara Email1","type":"n8n-nodes-base.set","typeVersion":1,"position":[-740,-400]},{"parameters":{"operation":"completion","completionTitle":"La sua richiesta non pu√≤ essere accettata ","completionMessage":"=Gentile {{ $json[\"Nome e Cognome cliente\"] }},\n\nil numero d‚Äôordine \"{{ $json[\"Nr Ordine\"] }}\" non risulta presente nei nostri sistemi.  \n√à possibile che si tratti di un errore di digitazione.\n\nLa invitiamo cortesemente a VERIFICARE IL NUMERO e riprovare l‚Äôinvio del modulo.\n\nCordiali saluti,  \nIl Team di GommeGo\n\n\n","options":{}},"type":"n8n-nodes-base.form","typeVersion":1,"position":[-20,1180],"id":"33c9d919-0e79-4adf-ad33-7d16628b9001","name":"Form","webhookId":"519b8f23-e21c-430e-a1ee-45e8570596f8"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"94837f50-81d1-458b-a3aa-2b02d7edaf79","leftValue":"={{ $json.orderFound }}","rightValue":"","operator":{"type":"boolean","operation":"true","singleValue":true}}],"combinator":"or"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[-220,820],"id":"91f776f9-9656-4669-aedd-6e99e472a56c","name":"numero ordine esiste?"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"d0279021-41d8-4165-a97a-0cb79b83ac1b","leftValue":"={{ $json[\"reso richiesto entro 14 giorni\"] }}","rightValue":"","operator":{"type":"boolean","operation":"true","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[140,800],"id":"a7eccebc-62d1-4983-be2b-a13a89ef54a4","name":"If1"},{"parameters":{"operation":"completion","completionTitle":"La sua richiesta non pu√≤ essere accettata ","completionMessage":"=Gentile {{ $json[\"Nome e Cognome cliente\"] }},\nSiamo Spiacenti ma il suo ordine \"{{ $json[\"Nr Ordine\"] }}\" non √® rimborsabile in quanto dalla data della sua richiesta avvenuta il {{ $json[\"data inoltro richiesta\"] }} sono passati {{ $json[\"giorni passati\"] }} giorni, quindi oltre il limite stabilito dalla nostre politiche di reso accettate al momento dell''ordine.\n\nRestiamo a sua completa disposizione \n\nCordiali saluti,  \nIl Team di GommeGo\n\n\n","options":{}},"type":"n8n-nodes-base.form","typeVersion":1,"position":[380,900],"id":"d04eb0a1-6106-403f-9b2d-5562317cfdc5","name":"Form1","webhookId":"519b8f23-e21c-430e-a1ee-45e8570596f8"},{"parameters":{"jsCode":"const input = items[0].json;\n\nconst dataConsegnaRaw = input[\"shipment_arrival_date\"];\nconst dataRichiestaRaw = input[\"data inoltro richiesta\"];\n\n// Funzione per generare codice richiesta alfanumerico\nfunction generaCodiceRichiesta(length = 10) {\n  const charset = ''ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'';\n  let codice = '''';\n  for (let i = 0; i < length; i++) {\n    const randomIndex = Math.floor(Math.random() * charset.length);\n    codice += charset[randomIndex];\n  }\n  return codice;\n}\n\nif (!dataConsegnaRaw || !dataRichiestaRaw) {\n  return [{\n    json: {\n      ...input,\n      \"errore\": \"Dati mancanti\",\n      \"reso richiesto entro 14 giorni\": null,\n      \"codice_richiesta\": generaCodiceRichiesta()\n    }\n  }];\n}\n\ntry {\n  // Normalizza entrambe le date in formato YYYY-MM-DD\n  const dataConsegna = new Date(dataConsegnaRaw);\n  const dataRichiesta = new Date(dataRichiestaRaw);\n\n  const giornoConsegnaStr = dataConsegna.toISOString().slice(0, 10);\n  const giornoRichiestaStr = dataRichiesta.toISOString().slice(0, 10);\n\n  const giornoConsegna = new Date(giornoConsegnaStr);\n  const giornoRichiesta = new Date(giornoRichiestaStr);\n\n  const diffInMs = giornoRichiesta - giornoConsegna;\n  const diffInGiorni = diffInMs / (1000 * 60 * 60 * 24);\n  const entro14 = diffInGiorni >= 0 && diffInGiorni <= 14;\n\n  return [{\n    json: {\n      ...input,\n      \"shipment_arrival_date_normalizzata\": giornoConsegnaStr,\n      \"data_inoltro_richiesta_normalizzata\": giornoRichiestaStr,\n      \"reso richiesto entro 14 giorni\": entro14,\n      \"giorni passati\": diffInGiorni,\n      \"codice_richiesta\": generaCodiceRichiesta()\n    }\n  }];\n} catch (error) {\n  return [{\n    json: {\n      ...input,\n      \"errore\": \"Errore nel parsing delle date\",\n      \"dettaglio\": error.message,\n      \"codice_richiesta\": generaCodiceRichiesta()\n    }\n  }];\n}\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-20,800],"id":"a2350439-41fc-432f-858e-44cccea9bf52","name":"Validazione ed RMA","notes":"const input = items[0].json;\n\nconst dataConsegnaRaw = input[\"shipment_arrival_date\"];\nconst dataRichiestaRaw = input[\"data inoltro richiesta\"];\n\nif (!dataConsegnaRaw || !dataRichiestaRaw) {\n  return [{\n    json: {\n      ...input,\n      \"errore\": \"Dati mancanti\",\n      \"reso richiesto entro 14 giorni\": null\n    }\n  }];\n}\n\ntry {\n  // Normalizza entrambe le date in formato YYYY-MM-DD\n  const dataConsegna = new Date(dataConsegnaRaw);\n  const dataRichiesta = new Date(dataRichiestaRaw);\n\n  const giornoConsegnaStr = dataConsegna.toISOString().slice(0, 10);\n  const giornoRichiestaStr = dataRichiesta.toISOString().slice(0, 10);\n\n  const giornoConsegna = new Date(giornoConsegnaStr);\n  const giornoRichiesta = new Date(giornoRichiestaStr);\n\n  const diffInMs = giornoRichiesta - giornoConsegna;\n  const diffInGiorni = diffInMs / (1000 * 60 * 60 * 24);\n  const entro14 = diffInGiorni >= 0 && diffInGiorni <= 14;\n\n  return [{\n    json: {\n      ...input,\n      \"shipment_arrival_date_normalizzata\": giornoConsegnaStr,\n      \"data_inoltro_richiesta_normalizzata\": giornoRichiestaStr,\n      \"reso richiesto entro 14 giorni\": entro14,\n      \"giorni passati\": diffInGiorni\n    }\n  }];\n} catch (error) {\n  return [{\n    json: {\n      ...input,\n      \"errore\": \"Errore nel parsing delle date\",\n      \"dettaglio\": error.message\n    }\n  }];\n}\n"},{"parameters":{"operation":"upsert","schema":{"__rl":true,"mode":"list","value":"public"},"table":{"__rl":true,"value":"return_orders","mode":"list","cachedResultName":"return_orders"},"columns":{"mappingMode":"defineBelow","value":{},"matchingColumns":[],"schema":[{"id":"order_found","displayName":"order_found","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"rma_id","displayName":"rma_id","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"customer_full_name","displayName":"customer_full_name","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"customer_email","displayName":"customer_email","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"order_reference","displayName":"order_reference","required":true,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"data_ricezione_merce","displayName":"data_ricezione_merce","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":false},{"id":"data_inoltro_richiesta","displayName":"data_inoltro_richiesta","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":false},{"id":"motivo_restituzione","displayName":"motivo_restituzione","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"descrizione_problema","displayName":"descrizione_problema","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"foto_allegate","displayName":"foto_allegate","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"nome_foto_allegata","displayName":"nome_foto_allegata","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"testo_estratto","displayName":"testo_estratto","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"descrizione_immagine","displayName":"descrizione_immagine","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"order_products_0_name","displayName":"order_products_0_name","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"order_products_0_reference","displayName":"order_products_0_reference","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"order_products_0_ean","displayName":"order_products_0_ean","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"order_products_0_quantity","displayName":"order_products_0_quantity","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":false},{"id":"order_products_0_unit_price","displayName":"order_products_0_unit_price","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"order_products_0_total_price","displayName":"order_products_0_total_price","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"order_products_1_name","displayName":"order_products_1_name","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"order_products_1_reference","displayName":"order_products_1_reference","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"order_products_1_ean","displayName":"order_products_1_ean","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"order_products_1_quantity","displayName":"order_products_1_quantity","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":false},{"id":"order_products_1_unit_price","displayName":"order_products_1_unit_price","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"order_products_1_total_price","displayName":"order_products_1_total_price","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"shipment_arrival_date","displayName":"shipment_arrival_date","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":false},{"id":"shipment_tracking_number","displayName":"shipment_tracking_number","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"shipment_tracking_url","displayName":"shipment_tracking_url","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"reso_autorizzato","displayName":"reso_autorizzato","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"giorni_trascorsi","displayName":"giorni_trascorsi","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":false},{"id":"codice_richiesta_form","displayName":"codice_richiesta_form","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[380,680],"id":"eec45c2e-0e1d-4910-b47c-3e70417cd16a","name":"UPSERT CAMPI RMA","credentials":{"postgres":{"id":"jBT1O3LaStZrwqsC","name":"Postgres Supabase TEC"}}}]', '{"Genera RMA":{"main":[[]]},"Prepara Email":{"main":[[]]},"On form submission":{"main":[[{"node":"Mappa Dati","type":"main","index":0},{"node":"Estrai Testo","type":"main","index":0},{"node":"Carica immagini Merce","type":"main","index":0}]]},"Prepara Dati":{"main":[[]]},"Genera RMA1":{"main":[[]]},"Convert to File1":{"main":[[]]},"Estrai Testo":{"main":[[{"node":"Formatta Dati","type":"main","index":0}]]},"Validazione File":{"main":[[]]},"Mappa Dati":{"main":[[{"node":"Merge","type":"main","index":0}]]},"Formatta Dati":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Merge":{"main":[[{"node":"Merge1","type":"main","index":0},{"node":"MAPPA NUMERO ORDINE","type":"main","index":0}]]},"Google Gemini Chat Model":{"ai_languageModel":[[{"node":"VALIDAZIONE E INTAKE","type":"ai_languageModel","index":0}]]},"Call n8n Workflow Tool":{"ai_tool":[[{"node":"VALIDAZIONE E INTAKE","type":"ai_tool","index":0}]]},"Supabase":{"ai_tool":[[{"node":"VALIDAZIONE E INTAKE","type":"ai_tool","index":0}]]},"Carica immagini Merce":{"main":[[{"node":"Mappa nome File","type":"main","index":0}]]},"If":{"main":[[{"node":"Genera RMA","type":"main","index":0}],[{"node":"Genera RMA1","type":"main","index":0}]]},"Mappa nome File":{"main":[[{"node":"Merge","type":"main","index":2}]]},"MAPPA NUMERO ORDINE":{"main":[[{"node":"Execute Workflow","type":"main","index":0}]]},"INSERT CAMPI RMA":{"main":[[]]},"Execute Workflow":{"main":[[{"node":"Merge1","type":"main","index":1}]]},"Merge1":{"main":[[{"node":"numero ordine esiste?","type":"main","index":0}]]},"numero ordine esiste?":{"main":[[{"node":"Validazione ed RMA","type":"main","index":0}],[{"node":"Form","type":"main","index":0}]]},"If1":{"main":[[{"node":"UPSERT CAMPI RMA","type":"main","index":0}],[{"node":"Form1","type":"main","index":0}]]},"Validazione ed RMA":{"main":[[{"node":"If1","type":"main","index":0}]]}}', '{"executionOrder":"v1"}', NULL, '{"Form1":[{"json":{"Nome e Cognome cliente":"Carlo martino","Email di conferma ordine":"supplires@tecsolutions.app","Nr Ordine":"WHQTNRXIZ","Data ricezione merce":"2025-06-13","Motivo della restituzione ":"Ho ricevuto merce sbagliata","Descrizione del problema ":"merce completamente sbagliata","Foto allegate?":"false","data inoltro richiesta":"2025-06-22","testo_estratto":"1. \n\n```\nNANKANG \nWINTER ACTIVA\nN-607+\n215/55 R16\n97V XL\n\nE\nC\n72 dB\n\nC\n\nEU\n```\n\n2.","descrizione_immagine":"L''immagine mostra un pacco di quattro pneumatici sovrapposti e avvolti in pellicola trasparente da imballaggio. Su uno dei pneumatici √® visibile un''etichetta informativa applicata lateralmente, con indicazioni tecniche e classificazioni energetiche. L''etichetta sembra integra e leggibile. I pneumatici appaiono nuovi e non mostrano segni di usura o danni visibili.\n\n---\n\n### Analisi dettagliata:\n\n#### INFORMAZIONI PRODOTTO:\n- **Codice prodotto/SKU:** Non identificato chiaramente nell‚Äôetichetta visibile (non compare nessun codice con indicazioni come SKU, CODICE, ART, REF).\n- **Dimensioni pneumatico:** **215/55 R16** (formato standard per pneumatici)\n- **Marca/Brand:** **Nankang**\n- **Modello:** **Winter Activa N-607+**\n- **Numero serie:** Non visibile sull‚Äôetichetta mostrata\n- **Data di produzione:** Non indicata sull‚Äôetichetta visibile\n\n#### ANALISI PROBLEMI (dalla descrizione dell''imm","Nome Foto Allegata":"WHQTNRXIZ - Carlo martino - 2025-06-13","orderFound":true,"order_reference":"WHQTNRXIZ","order_status":"Consegnato","order_shipping_number":"1ZR1J1466800230797","order_payment_method":"PayPal","order_date_created":"2025-06-09 12:22:57","order_date_updated":"2025-06-20 21:33:22","order_total_paid":"‚Ç¨ 211.00","order_total_products":"‚Ç¨ 161.36","order_total_products_with_tax":"‚Ç¨ 196.84","order_products_0_name":"NEXEN N BLUE HD PLUS 155/65 R14 75T","order_products_0_reference":"981110000163006","order_products_0_ean":"8807622509902","order_products_0_quantity":4,"order_products_0_unit_price":"‚Ç¨ 49.21","order_products_0_total_price":"‚Ç¨ 196.84","customer_full_name":"Carlo Martino","customer_email":"carlo.martino@martino.it","customer_phone":"0805618333","customer_is_active":true,"customer_customer_since":"2019-04-30 18:53:35","delivery_recipient":"Carlo Martino","delivery_street":"Via Delle Murge 80","delivery_city":"BARI","delivery_postcode":"70124","delivery_country":"Italia","delivery_phone":"0805618333","shipment_tracking_number":"1ZR1J1466800230797","shipment_tracking_url":"https://www.ups.com/track?loc=it_IT&tracknum=1ZR1J1466800230797&requester=WT/trackdetails","shipment_latest_status":"Consegnato","shipment_latest_status_date":"2025-06-13T11:04:00+00:00","shipment_departure_date":"2025-06-11T13:33:00+00:00","shipment_arrival_date":"2025-06-13T11:04:00+00:00","shipment_delivery_history_0":"2025-06-13: Consegnato","shipment_delivery_history_1":"2025-06-13: In consegna oggi","shipment_delivery_history_2":"2025-06-13: In elaborazione presso la struttura UPS","shipment_delivery_history_3":"2025-06-12: Partito dal centro","shipment_delivery_history_4":"2025-06-12: Arrivato al centro","shipment_delivery_history_5":"2025-06-12: Partito dal centro","shipment_delivery_history_6":"2025-06-12: Arrivato al centro","shipment_delivery_history_7":"2025-06-11: Il mittente ha creato un''etichetta, UPS non ha ancora ricevuto il pacco","Response":"‚úÖ Ordine trovato: WHQTNRXIZ","shipment_arrival_date_normalizzata":"2025-06-13","data_inoltro_richiesta_normalizzata":"2025-06-22","reso richiesto entro 14 giorni":true,"giorni passati":9}}]}', 'f696720d-965e-4727-823e-a38652a9db49', 1, '{"templateCredsSetupCompleted":true}', NULL, '2025-06-20T13:50:12.556Z', '2025-06-28T14:35:35.000Z', false),
  ('8d8b1694-9572-4846-a456-92c04280373e', 'GRAB INFO SUPPLIER FROM ORDINI', false, '[{"parameters":{"operation":"appendOrUpdate","documentId":{"__rl":true,"value":"1i56iOrLIeAeBYGY6c96UuBiLWMWTczm7VQ3apBKx42A","mode":"list","cachedResultName":"Ordini T24","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1i56iOrLIeAeBYGY6c96UuBiLWMWTczm7VQ3apBKx42A/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"Foglio1","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1i56iOrLIeAeBYGY6c96UuBiLWMWTczm7VQ3apBKx42A/edit#gid=0"},"columns":{"mappingMode":"defineBelow","value":{"Numero Ordine":"={{ $json[''Numero Ordine''] }}","Numero di Riferimento":"={{ $json[''Numero di Riferimento''] }}","Prodotto  ":"={{ $json.Prodotto }}","Prezzo Unitario ":"={{ $json[''Prezzo Unitario''] }}","Totale Ordine":"={{ $json[''Totale Ordine''] }}","Prezzo Complessivo  ":"={{ $json[''Prezzo Complessivo''] }}","Destinatario ":"={{ $json.Destinatario }}","Indirizzo Destinatario  ":"={{ $json[''Indirizzo Destinatario''] }}","Data di Consegna Stimata":"={{ $json[''Data di Consegna Stimata''] }}","Telefono Destinatario ":"={{ $json[''Telefono Destinatario''] }}","Fornitore":"={{ $json.Fornitore }}","Indirizzo Fornitore":"={{ $json[''Indirizzo Fornitore''] }}","Email fornitore":"={{ $json[''Email Fornitore''] }}","Telefono Fornitore":"={{ $json[''Telefono Fornitore''] }}","Data ordine":"={{ $json[''Data Ordine''] }}"},"matchingColumns":["Numero Ordine"],"schema":[{"id":"Numero Ordine","displayName":"Numero Ordine","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Numero di Riferimento","displayName":"Numero di Riferimento","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Data ordine","displayName":"Data ordine","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Prodotto  ","displayName":"Prodotto  ","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Prezzo Unitario ","displayName":"Prezzo Unitario ","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Quantit√† Ordinata  ","displayName":"Quantit√† Ordinata  ","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Totale Ordine","displayName":"Totale Ordine","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Prezzo Complessivo  ","displayName":"Prezzo Complessivo  ","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Destinatario ","displayName":"Destinatario ","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Indirizzo Destinatario  ","displayName":"Indirizzo Destinatario  ","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Telefono Destinatario ","displayName":"Telefono Destinatario ","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Data di Consegna Stimata","displayName":"Data di Consegna Stimata","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Fornitore","displayName":"Fornitore","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Indirizzo Fornitore","displayName":"Indirizzo Fornitore","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Email fornitore","displayName":"Email fornitore","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Telefono Fornitore","displayName":"Telefono Fornitore","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.5,"position":[1300,-420],"id":"45e1c158-f55e-4615-b3e6-9e3fc9e3fafc","name":"Excel DB","credentials":{"googleSheetsOAuth2Api":{"id":"FdPMod5ivW8IWoD5","name":"Google Sheets account"}}},{"parameters":{"rule":{"interval":[{"field":"seconds","secondsInterval":60}]}},"type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[900,-420],"id":"65fa89ae-7c33-4654-9001-127bbbcc137a","name":"Schedule Trigger"},{"parameters":{"operation":"move","messageId":{"__rl":true,"value":"={{ $(''GRAB MAIL FROM ORDINI'').first().json.id }}\n","mode":"id"},"folderId":{"__rl":true,"value":"AQMkADY5YTU5ODIzLTM5M2MtNGU4Zi04YzNmLTBlYmYxNDNhODNjMAAuAAADLcvJUzlaHka06oE0JpdAdQEAGGCzHg77BkqqA0a85H6VtgABGk03IwAAAA==","mode":"list","cachedResultName":"ORDINI PROCESSATI","cachedResultUrl":"https://outlook.office365.com/mail/AQMkADY5YTU5ODIzLTM5M2MtNGU4Zi04YzNmLTBlYmYxNDNhODNjMAAuAAADLcvJUzlaHka06oE0JpdAdQEAGGCzHg77BkqqA0a85H6VtgABGk03IwAAAA%3D%3D"}},"type":"n8n-nodes-base.microsoftOutlook","typeVersion":2,"position":[1100,-420],"id":"b5aedc36-29b2-4190-be6a-a64cf68fb99a","name":"MOVE TO PROCESSED","webhookId":"d1a5a6c8-bf5c-4079-9212-45d62825cd95","retryOnFail":true,"waitBetweenTries":5000,"onError":"continueRegularOutput"},{"parameters":{"operation":"getAll","returnAll":true,"output":"fields","fields":["body","receivedDateTime","subject"],"filtersUI":{"values":{"filters":{"foldersToInclude":["AAMkADY5YTU5ODIzLTM5M2MtNGU4Zi04YzNmLTBlYmYxNDNhODNjMAAuAAAAAAAty8lTOVoeRrTqgTQml0B1AQAYYLMeDvsGSqoDRrzkfpW2AADjxFTMAAA="],"readStatus":"both","receivedAfter":"=2025-06-01T00:00:00z"}}},"options":{}},"type":"n8n-nodes-base.microsoftOutlook","typeVersion":2,"position":[120,0],"id":"02344945-1f44-4bcb-8899-dae86184bedc","name":"GRAB MAIL FROM ORDINI","webhookId":"4fe0c1ac-8946-4a2e-b301-c704b7975839","retryOnFail":true,"credentials":{"microsoftOutlookOAuth2Api":{"id":"gvsjOBgXBwH8vLH8","name":"Outlook Supplies"}},"notes":"2025-01-10T00:00:00Z"},{"parameters":{"operation":"extractHtmlContent","dataPropertyName":"body.content","extractionValues":{"values":[{"key":"=","cssSelector":"body"}]},"options":{}},"type":"n8n-nodes-base.html","typeVersion":1.2,"position":[540,20],"id":"4395ccf6-9225-42f0-8b53-6184fec4b46c","name":"HTML TO TEXT"},{"parameters":{"jsCode":"function extractTyre24OrderData(body, subject) {\n  const data = {\n    \"Numero Ordine\": \"\",\n    \"Data Ordine\": new Date().toLocaleDateString(''it-IT''),\n    \"Numero di Riferimento\": \"\",\n    \"Prodotto\": \"\",\n    \"Prezzo Unitario\": \"\",\n    \"Quantit√† Ordinata\": \"\",\n    \"Totale Ordine\": \"\",\n    \"Prezzo Complessivo\": \"\",\n    \"Destinatario\": \"\",\n    \"Indirizzo Destinatario\": \"\",\n    \"Telefono Destinatario\": \"\",\n    \"Data di Consegna Stimata\": \"\",\n    \"Fornitore\": \"\",\n    \"Indirizzo Fornitore\": \"\",\n    \"Email Fornitore\": \"\",\n    \"Telefono Fornitore\": \"\",\n    \"Partita IVA Fornitore\": \"\",\n    \"Nazionalit√† Fornitore\": \"\"\n  };\n  \n  // Funzione per determinare la nazionalit√† dalla partita IVA\n  const getNazionalitaDaPartitaIVA = (partitaIVA) => {\n    if (!partitaIVA) return \"\";\n    \n    const prefisso = partitaIVA.substring(0, 2).toUpperCase();\n    const nazionalita = {\n      \"IT\": \"Italia\",\n      \"DE\": \"Germania\",\n      \"FR\": \"Francia\",\n      \"ES\": \"Spagna\",\n      \"PT\": \"Portogallo\",\n      \"GB\": \"Regno Unito\",\n      \"NL\": \"Paesi Bassi\",\n      \"BE\": \"Belgio\",\n      \"AT\": \"Austria\",\n      \"CH\": \"Svizzera\",\n      \"PL\": \"Polonia\",\n      \"CZ\": \"Repubblica Ceca\",\n      \"RO\": \"Romania\",\n      \"GR\": \"Grecia\",\n      \"SE\": \"Svezia\",\n      \"DK\": \"Danimarca\",\n      \"FI\": \"Finlandia\",\n      \"HU\": \"Ungheria\",\n      \"IE\": \"Irlanda\",\n      \"LU\": \"Lussemburgo\",\n      \"SK\": \"Slovacchia\",\n      \"SI\": \"Slovenia\",\n      \"BG\": \"Bulgaria\",\n      \"HR\": \"Croazia\",\n      \"LT\": \"Lituania\",\n      \"LV\": \"Lettonia\",\n      \"EE\": \"Estonia\",\n      \"CY\": \"Cipro\",\n      \"MT\": \"Malta\"\n    };\n    \n    return nazionalita[prefisso] || \"Non determinata\";\n  };\n  \n  const match = (regex) => (body.match(regex) || [])[1]?.trim() || \"\";\n  \n  // Funzione per convertire i prezzi dal formato italiano (66,12) al formato numerico\n  const convertiPrezzo = (prezzo) => {\n    if (!prezzo) return \"\";\n    // Sostituisce la virgola con il punto per il formato numerico\n    return prezzo.replace('','', ''.'');\n  };\n  \n  // Numero Ordine - cerca nel body se non trovato nel subject\n  data[\"Numero Ordine\"] = (subject.match(/ordine nr\\.\\s*([A-Z0-9]+)/i) || [])[1] || \n                          match(/Ordine nr\\.\\s*([A-Z0-9]+)/i);\n  \n  // Numero di riferimento\n  data[\"Numero di Riferimento\"] = match(/Numero di riferimento\\s*\\n\\s*([A-Z0-9]+)/i);\n  \n  // Prodotto - pattern generico per qualsiasi marca\n  // Cerca pattern: MARCA MODELLO specifiche seguito da \"copertoni\"\n  const prodottoMatch = body.match(/([A-Z][A-Z\\s]+[^\\n]+)\\s*\\n\\s*\\n\\s*copertoni/i);\n  if (prodottoMatch) {\n    data[\"Prodotto\"] = prodottoMatch[1].trim();\n  } else {\n    // Fallback: cerca dopo il numero ordine e prima di \"copertoni\"\n    const altMatch = body.match(/\\)\\s*\\n\\s*\\n([^\\n]+)\\s*\\n\\s*\\n\\s*copertoni/i);\n    if (altMatch) {\n      data[\"Prodotto\"] = altMatch[1].trim();\n    }\n  }\n  \n  // Prezzo unitario - pattern corretto con conversione\n  const prezzoUnitario = match(/Prezzo al pezzo\\s*\\*?\\s*\\n\\s*([\\d.,]+)\\s*EUR/i);\n  data[\"Prezzo Unitario\"] = convertiPrezzo(prezzoUnitario);\n  \n  // Quantit√† ordinata - pattern migliorato per gestire newline multipli\n  const quantitaMatch = body.match(/Pezzo\\s*\\n\\s*\\n\\s*(\\d+)/i);\n  if (quantitaMatch) {\n    data[\"Quantit√† Ordinata\"] = quantitaMatch[1].trim();\n  }\n  \n  // Totale ordine con conversione\n  const totaleOrdine = match(/Spese totali\\s*\\n\\s*([\\d.,]+)\\s*EUR/i);\n  data[\"Totale Ordine\"] = convertiPrezzo(totaleOrdine);\n  \n  // Prezzo complessivo con conversione\n  const prezzoComplessivo = match(/Prezzo complessivo dell''ordine\\s*\\*?\\s*\\n\\s*([\\d.,]+)\\s*EUR/i);\n  data[\"Prezzo Complessivo\"] = convertiPrezzo(prezzoComplessivo);\n  \n  // Data di consegna stimata\n  data[\"Data di Consegna Stimata\"] = match(/Consegna probabile il giorno\\s+([^\\n]+)/i);\n  \n  // Destinatario - pattern corretto per il formato effettivo\n  const destinatarioMatch = body.match(/indirizzo di consegna diverso:\\s*\\n([^\\n]+)\\n([^\\n]+)\\n([^\\n]+)\\n(\\d+)/i);\n  if (destinatarioMatch) {\n    data[\"Destinatario\"] = destinatarioMatch[1].trim();\n    data[\"Indirizzo Destinatario\"] = `${destinatarioMatch[2].trim()}, ${destinatarioMatch[3].trim()}`;\n    data[\"Telefono Destinatario\"] = destinatarioMatch[4].trim();\n  }\n  \n  // Fornitore - pattern corretto\n  const fornitoreMatch = body.match(/Grossista\\s*\\n([^\\n]+)\\n([^\\n]+)\\n([^\\n]+)\\n([^\\n]+)/i);\n  if (fornitoreMatch) {\n    data[\"Fornitore\"] = fornitoreMatch[1].trim();\n    data[\"Indirizzo Fornitore\"] = `${fornitoreMatch[2].trim()}, ${fornitoreMatch[3].trim()} ${fornitoreMatch[4].trim()}`;\n  }\n  \n  // Email Fornitore - cerca dopo \"E-Mail\" relativo al fornitore\n  const emailFornitoreMatch = body.match(/Grossista[\\s\\S]*?E-Mail\\s*\\n([^\\s\\[]+)/i);\n  if (emailFornitoreMatch) {\n    data[\"Email Fornitore\"] = emailFornitoreMatch[1].trim();\n  }\n  \n  // Telefono Fornitore - cerca dopo \"Telefono dall''estero\" relativo al fornitore\n  const telFornitoreMatch = body.match(/Grossista[\\s\\S]*?Telefono dall''estero\\s*\\n(\\+?\\d+)/i);\n  if (telFornitoreMatch) {\n    data[\"Telefono Fornitore\"] = telFornitoreMatch[1].trim();\n  }\n  \n  // Partita IVA Fornitore\n  const partitaIVAMatch = body.match(/Partita IVA\\s*\\n([A-Z]{2}\\d+)/i);\n  if (partitaIVAMatch) {\n    data[\"Partita IVA Fornitore\"] = partitaIVAMatch[1].trim();\n    // Determina la nazionalit√† basata sulla partita IVA\n    data[\"Nazionalit√† Fornitore\"] = getNazionalitaDaPartitaIVA(partitaIVAMatch[1].trim());\n  }\n  \n  return data;\n}\n\n// Codice principale per n8n\nconst subject = $(''GRAB MAIL FROM ORDINI'').item.json.subject || '''';\n// Il testo potrebbe essere in varie propriet√†, prova tutte le possibilit√†\nconst body = $json.body || $json[\"\"] || $json.text || $json.content || JSON.stringify($json);\nconst estratti = extractTyre24OrderData(body, subject);\n\nreturn [\n  {\n    json: {\n      ...estratti,\n      extractionMethod: \"regex\",\n      processingTimestamp: new Date().toISOString(),\n      textLength: body.length,\n      emailSubject: subject\n    }\n  }\n];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[720,20],"id":"ab515ebf-02a2-4960-a55d-353d47dc629d","name":"EXTRACTOR","notes":"// Funzione per estrarre dati da un''email di conferma d''ordine Tyre24\nfunction extractTyre24OrderData(emailBody, emailSubject) {\n  // Oggetto per i dati estratti\n  const data = {\n    \"Numero Ordine\": \"\",\n    \"Data Ordine\": \"\",\n    \"Numero di Riferimento\": \"\",\n    \"Prodotto\": \"\",\n    \"Prezzo Unitario\": \"\",\n    \"Quantit√É  Ordinata\": \"\",\n    \"Totale Ordine\": \"\",\n    \"Prezzo Complessivo\": \"\",\n    \"Destinatario\": \"\",\n    \"Indirizzo Destinatario\": \"\",\n    \"Telefono Destinatario\": \"\",\n    \"Data di Consegna Stimata\": \"\",\n    \"Fornitore\": \"\",\n    \"Indirizzo Fornitore\": \"\",\n    \"Email Fornitore\": \"\",\n    \"Telefono Fornitore\": \"\"\n  };\n  \n  // Estrai il numero ordine dall''oggetto email\n  const orderNumberMatch = emailSubject.match(/ordine nr\\.\\s*([A-Z0-9]+)/i);\n  if (orderNumberMatch && orderNumberMatch[1]) {\n    data[\"Numero Ordine\"] = orderNumberMatch[1].trim();\n  }\n  \n  // Estrai il numero di riferimento\n  const referenceMatch = emailBody.match(/Numero di riferimento[\\s\\S]*?<br>([A-Z0-9]+)/i);\n  if (referenceMatch && referenceMatch[1]) {\n    data[\"Numero di Riferimento\"] = referenceMatch[1].trim();\n  }\n  \n  // Estrai il prodotto\n  const productMatch = emailBody.match(/NANKANG[\\s\\S]*?([A-Z0-9\\-\\s]+\\d+\\/\\d+\\s+[A-Z]\\d+)/i);\n  if (productMatch && productMatch[1]) {\n    data[\"Prodotto\"] = \"NANKANG \" + productMatch[1].trim();\n  }\n  \n  // Estrai prezzo unitario\n  const unitPriceMatch = emailBody.match(/Prezzo al pezzo[\\s\\S]*?>([\\d.,]+)\\s*EUR/i);\n  if (unitPriceMatch && unitPriceMatch[1]) {\n    data[\"Prezzo Unitario\"] = unitPriceMatch[1].trim();\n  }\n  \n  // Estrai quantit√É  ordinata\n  const quantityMatch = emailBody.match(/<strong>Pezzo<\\/strong>[\\s\\S]*?>(\\d+)</i);\n  if (quantityMatch && quantityMatch[1]) {\n    data[\"Quantit√É  Ordinata\"] = quantityMatch[1].trim();\n  }\n  \n  // Estrai totale ordine\n  const totalOrderMatch = emailBody.match(/Spese totali[\\s\\S]*?>([\\d.,]+)\\s*EUR/i);\n  if (totalOrderMatch && totalOrderMatch[1]) {\n    data[\"Totale Ordine\"] = totalOrderMatch[1].trim();\n  }\n  \n  // Estrai prezzo complessivo\n  const totalPriceMatch = emailBody.match(/Prezzo complessivo dell''ordine[\\s\\S]*?<strong>([\\d.,]+)\\s*EUR/i);\n  if (totalPriceMatch && totalPriceMatch[1]) {\n    data[\"Prezzo Complessivo\"] = totalPriceMatch[1].trim();\n  }\n  \n  // Estrai destinatario e indirizzo\n  const shipToMatch = emailBody.match(/Indirizzo di consegna[\\s\\S]*?<br>(.*?)<br>(.*?)<br>(.*?)<br>(.*?)<br>/i);\n  if (shipToMatch) {\n    data[\"Destinatario\"] = shipToMatch[1].trim();\n    data[\"Indirizzo Destinatario\"] = `${shipToMatch[2].trim()}, ${shipToMatch[3].trim()}`;\n    data[\"Telefono Destinatario\"] = shipToMatch[4].trim();\n  }\n  \n  // Estrai data di consegna\n  const deliveryDateMatch = emailBody.match(/Consegna probabile il giorno\\s+([^<]+)/i);\n  if (deliveryDateMatch && deliveryDateMatch[1]) {\n    data[\"Data di Consegna Stimata\"] = deliveryDateMatch[1].trim();\n  }\n  \n  // Estrai fornitore\n  const supplierMatch = emailBody.match(/<strong>Grossista<\\/strong><br>(.*?)<br>(.*?)<br>(.*?)<br>(.*?)<br>/i);\n  if (supplierMatch) {\n    data[\"Fornitore\"] = supplierMatch[1].trim();\n    data[\"Indirizzo Fornitore\"] = `${supplierMatch[2].trim()}, ${supplierMatch[3].trim()}, ${supplierMatch[4].trim()}`;\n  }\n  \n  // Estrai email fornitore\n  const supplierEmailMatch = emailBody.match(/mailto:(.*?)\\?subject/i);\n  if (supplierEmailMatch && supplierEmailMatch[1]) {\n    data[\"Email Fornitore\"] = supplierEmailMatch[1].trim();\n  }\n  \n  // Estrai telefono fornitore\n  const supplierPhoneMatch = emailBody.match(/<strong>Telefono dall''estero<\\/strong><br>(\\+\\d+)\\s/i);\n  if (supplierPhoneMatch && supplierPhoneMatch[1]) {\n    data[\"Telefono Fornitore\"] = supplierPhoneMatch[1].trim();\n  }\n  \n  // Estrai data ordine (dalla data di ricezione se non trovata direttamente)\n  const currentDate = new Date().toLocaleDateString(''it-IT'');\n  data[\"Data Ordine\"] = currentDate;\n  \n  return data;\n}\n\n// Input dal nodo precedente - accediamo direttamente al contenuto HTML della mail\nconst items = [];\nconst emailData = $(''GRAB MAIL FROM ORDINI'').first()?.json;\nconst emailSubject = emailData?.subject || '''';\nconst emailBody = emailData?.body?.content || '''';\n\nconsole.log(\"Elaborazione email con oggetto:\", emailSubject);\n\n// Estrai i dati dall''email\nconst extractedData = extractTyre24OrderData(emailBody, emailSubject);\n\n// Aggiungi metadati\nitems.push({\n  json: {\n    ...extractedData,\n    extractionMethod: \"regex\",\n    processingTimestamp: new Date().toISOString(),\n    textLength: emailBody.length,\n    emailSubject: emailSubject\n  }\n});\n\nreturn items;\n"},{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[-40,0],"id":"9dd92496-a784-4174-b1e6-bfe026951c10","name":"When clicking ‚ÄòExecute workflow‚Äô"},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[320,0],"id":"0cff5586-c22f-4f3a-8358-349638991183","name":"Loop Over Items"},{"parameters":{},"type":"n8n-nodes-base.noOp","typeVersion":1,"position":[540,-180],"id":"e69cdea0-ea26-4a3f-ad76-be2c6941fd60","name":"FINE LOOP - TUTTO OK"},{"parameters":{},"type":"n8n-nodes-base.noOp","name":"ESEGUI LA SUCCESSIVA","typeVersion":1,"position":[1460,0],"id":"34b9cff0-c7f8-4693-b5ae-6f7d971d3416"},{"parameters":{"operation":"appendOrUpdate","documentId":{"__rl":true,"value":"1MP-h8vFzXh9aNfyCETwh_gVZibZUJlPxNx0vrhggxqk","mode":"list","cachedResultName":"Ordini_T24_return_table","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1MP-h8vFzXh9aNfyCETwh_gVZibZUJlPxNx0vrhggxqk/edit?usp=drivesdk"},"sheetName":{"__rl":true,"value":"gid=0","mode":"list","cachedResultName":"Foglio1","cachedResultUrl":"https://docs.google.com/spreadsheets/d/1i56iOrLIeAeBYGY6c96UuBiLWMWTczm7VQ3apBKx42A/edit#gid=0"},"columns":{"mappingMode":"defineBelow","value":{"Numero Ordine":"={{ $json[''Numero Ordine''] }}","Numero di Riferimento":"={{ $json[''Numero di Riferimento''] }}","Prodotto  ":"={{ $json.Prodotto }}","Prezzo Unitario ":"={{ $json[''Prezzo Unitario''] }}","Totale Ordine":"={{ $json[''Totale Ordine''] }}","Prezzo Complessivo  ":"={{ $json[''Prezzo Complessivo''] }}","Destinatario ":"={{ $json.Destinatario }}","Indirizzo Destinatario  ":"={{ $json[''Indirizzo Destinatario''] }}","Data di Consegna Stimata":"={{ $json[''Data di Consegna Stimata''] }}","Telefono Destinatario ":"={{ $json[''Telefono Destinatario''] }}","Fornitore":"={{ $json.Fornitore }}","Indirizzo Fornitore":"={{ $json[''Indirizzo Fornitore''] }}","Email fornitore":"={{ $json[''Email Fornitore''] }}","Telefono Fornitore":"={{ $json[''Telefono Fornitore''] }}","Data ordine":"={{ $json[''Data Ordine''] }}","Quantit√† Ordinata  ":"={{ $json[\"Quantit√† Ordinata\"] }}","NAZ. FORNITORE":"={{ $json[\"Nazionalit√† Fornitore\"] }}"},"matchingColumns":["Numero Ordine"],"schema":[{"id":"Numero Ordine","displayName":"Numero Ordine","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Numero di Riferimento","displayName":"Numero di Riferimento","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Data ordine","displayName":"Data ordine","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Prodotto  ","displayName":"Prodotto  ","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Prezzo Unitario ","displayName":"Prezzo Unitario ","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Quantit√† Ordinata  ","displayName":"Quantit√† Ordinata  ","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Totale Ordine","displayName":"Totale Ordine","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Prezzo Complessivo  ","displayName":"Prezzo Complessivo  ","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Destinatario ","displayName":"Destinatario ","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Indirizzo Destinatario  ","displayName":"Indirizzo Destinatario  ","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Telefono Destinatario ","displayName":"Telefono Destinatario ","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Data di Consegna Stimata","displayName":"Data di Consegna Stimata","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Fornitore","displayName":"Fornitore","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Indirizzo Fornitore","displayName":"Indirizzo Fornitore","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Email fornitore","displayName":"Email fornitore","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"Telefono Fornitore","displayName":"Telefono Fornitore","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true},{"id":"NAZ. FORNITORE","displayName":"NAZ. FORNITORE","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.googleSheets","typeVersion":4.5,"position":[880,-120],"id":"f557c23a-3b15-4c77-854c-ae47abaf6e69","name":"Excel DB1","credentials":{"googleSheetsOAuth2Api":{"id":"FdPMod5ivW8IWoD5","name":"Google Sheets account"}}},{"parameters":{"amount":1},"type":"n8n-nodes-base.wait","typeVersion":1.1,"position":[1080,0],"id":"fdd13699-e830-4e18-b0da-aa0bcbb57e64","name":"Wait","webhookId":"83e79016-579f-4882-8862-37f4994d5990"},{"parameters":{"tableId":"detail_orders_t24","fieldsUi":{"fieldValues":[{"fieldId":"Numero Ordine_T24","fieldValue":"={{ $json[\"Numero Ordine\"] }}"},{"fieldId":"Numero di Riferimento_GOMMEGO","fieldValue":"={{ $json[\"Numero di Riferimento\"] }}"},{"fieldId":"Prodotto  _T24","fieldValue":"={{ $json[\"Prodotto  \"] }}"},{"fieldId":"Prezzo Unitario _T24","fieldValue":"={{ $json[\"Prezzo Unitario \"] }}"},{"fieldId":"Totale Ordine_T24","fieldValue":"={{ $json[\"Totale Ordine\"] }}"},{"fieldId":"Destinatario _T24","fieldValue":"={{ $json[\"Destinatario \"] }}"},{"fieldId":"Indirizzo Destinatario  _T24","fieldValue":"={{ $json[\"Indirizzo Destinatario  \"] }}"},{"fieldId":"Data di Consegna Stimata_T24","fieldValue":"={{ $json[\"Data di Consegna Stimata\"] }}"},{"fieldId":"Fornitore_T24","fieldValue":"={{ $json.Fornitore }}"},{"fieldId":"Email fornitore_T24","fieldValue":"={{ $json[\"Email fornitore\"] }}"},{"fieldId":"Telefono Fornitore_T24","fieldValue":"={{ $json[\"Telefono Fornitore\"] }}"},{"fieldId":"NAZ. FORNITORE_T24","fieldValue":"={{ $json[\"NAZ. FORNITORE\"] }}"},{"fieldId":"Data ordine_T24","fieldValue":"={{ $json[\"Data ordine\"] }}"},{"fieldId":"Quantit√† Ordinata  _T24","fieldValue":"={{ $json[\"Quantit√† Ordinata  \"] }}"},{"fieldId":"Prezzo Complessivo  _T24","fieldValue":"={{ $json[\"Prezzo Complessivo  \"] }}"},{"fieldId":"Telefono Destinatario _T24","fieldValue":"={{ $json[\"Telefono Destinatario \"] }}"},{"fieldId":"Indirizzo Fornitore_T24","fieldValue":"={{ $json[\"Indirizzo Fornitore\"] }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[900,-660],"id":"5a44ab09-a409-4998-bc8b-520282218633","name":"Supabase","credentials":{"supabaseApi":{"id":"BkVV9D4yOfHR3iC4","name":"Supabase tecsolutions"}}},{"parameters":{"operation":"upsert","schema":{"__rl":true,"value":"public","mode":"list","cachedResultName":"public"},"table":{"__rl":true,"value":"detail_orders_t24","mode":"list","cachedResultName":"detail_orders_t24"},"columns":{"mappingMode":"defineBelow","value":{"Numero di Riferimento_GOMMEGO":"={{ $json[\"Numero di Riferimento\"] }}","Numero Ordine_T24":"={{ $json[\"Numero Ordine\"] }}","Data ordine_T24":"={{ $json[\"Data ordine\"] }}","Prodotto  _T24":"={{ $json[\"Prodotto  \"] }}","Prezzo Unitario _T24":"={{ $json[\"Prezzo Unitario \"] }}","Quantit√† Ordinata  _T24":"={{ $json[\"Quantit√† Ordinata  \"] }}","Totale Ordine_T24":"={{ $json[\"Totale Ordine\"] }}","Prezzo Complessivo  _T24":"={{ $json[\"Prezzo Complessivo  \"] }}","Destinatario _T24":"={{ $json[\"Destinatario \"] }}","Indirizzo Destinatario  _T24":"={{ $json[\"Indirizzo Destinatario  \"] }}","Telefono Destinatario _T24":"={{ $json[\"Telefono Destinatario \"] }}","Data di Consegna Stimata_T24":"={{ $json[\"Data di Consegna Stimata\"] }}","Fornitore_T24":"={{ $json.Fornitore }}","Indirizzo Fornitore_T24":"={{ $json[\"Indirizzo Fornitore\"] }}","Email fornitore_T24":"={{ $json[\"Email fornitore\"] }}","Telefono Fornitore_T24":"={{ $json[\"Telefono Fornitore\"] }}","NAZ. FORNITORE_T24":"={{ $json[\"NAZ. FORNITORE\"] }}"},"matchingColumns":["Numero di Riferimento_GOMMEGO"],"schema":[{"id":"Numero Ordine_T24","displayName":"Numero Ordine_T24","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"Numero di Riferimento_GOMMEGO","displayName":"Numero di Riferimento_GOMMEGO","required":true,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":true,"removed":false},{"id":"Data ordine_T24","displayName":"Data ordine_T24","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"Prodotto  _T24","displayName":"Prodotto  _T24","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"Prezzo Unitario _T24","displayName":"Prezzo Unitario _T24","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"Quantit√† Ordinata  _T24","displayName":"Quantit√† Ordinata  _T24","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"Totale Ordine_T24","displayName":"Totale Ordine_T24","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"Prezzo Complessivo  _T24","displayName":"Prezzo Complessivo  _T24","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"Destinatario _T24","displayName":"Destinatario _T24","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"Indirizzo Destinatario  _T24","displayName":"Indirizzo Destinatario  _T24","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"Telefono Destinatario _T24","displayName":"Telefono Destinatario _T24","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"Data di Consegna Stimata_T24","displayName":"Data di Consegna Stimata_T24","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"Fornitore_T24","displayName":"Fornitore_T24","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"Indirizzo Fornitore_T24","displayName":"Indirizzo Fornitore_T24","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"Email fornitore_T24","displayName":"Email fornitore_T24","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"Telefono Fornitore_T24","displayName":"Telefono Fornitore_T24","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"NAZ. FORNITORE_T24","displayName":"NAZ. FORNITORE_T24","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[1260,0],"id":"254bd40c-a76c-48d5-95f5-f531ee802280","name":"UPSERT SUPABASE","credentials":{"postgres":{"id":"jBT1O3LaStZrwqsC","name":"Postgres Supabase TEC"}}}]', '{"Excel DB":{"main":[[]]},"Schedule Trigger":{"main":[[]]},"GRAB MAIL FROM ORDINI":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"HTML TO TEXT":{"main":[[{"node":"EXTRACTOR","type":"main","index":0}]]},"EXTRACTOR":{"main":[[{"node":"Excel DB1","type":"main","index":0}]]},"When clicking ‚ÄòExecute workflow‚Äô":{"main":[[{"node":"GRAB MAIL FROM ORDINI","type":"main","index":0}]]},"Loop Over Items":{"main":[[{"node":"FINE LOOP - TUTTO OK","type":"main","index":0}],[{"node":"HTML TO TEXT","type":"main","index":0}]]},"ESEGUI LA SUCCESSIVA":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Excel DB1":{"main":[[{"node":"Wait","type":"main","index":0}]]},"Wait":{"main":[[{"node":"UPSERT SUPABASE","type":"main","index":0}]]},"Supabase":{"main":[[]]},"UPSERT SUPABASE":{"main":[[{"node":"ESEGUI LA SUCCESSIVA","type":"main","index":0}]]}}', '{"executionOrder":"v1"}', NULL, '{}', '91527d55-7be1-49a0-bab3-8e866bf93f97', 0, NULL, NULL, '2025-06-20T22:40:39.424Z', '2025-06-22T23:08:04.000Z', false),
  ('68341065-f882-48bb-a2ae-ed1cf7e2b942', 'SUB_RETURN_INFO_ORDER & PARCELSAPP', false, '[{"parameters":{"inputSource":"passthrough"},"name":"When Executed by Another Workflow","type":"n8n-nodes-base.executeWorkflowTrigger","typeVersion":1.1,"position":[400,-500],"id":"3265d803-17a8-4507-b118-6a08495685fd"},{"parameters":{"jsCode":"const raw = $json.query || '''';\nconst cleaned = typeof raw === ''string''\n  ? raw.replace(/[^a-zA-Z0-9]/g, '''').trim()\n  : '''';\nreturn [{ json: { query: cleaned } }];"},"name":"Pulisci codice","type":"n8n-nodes-base.code","typeVersion":2,"position":[420,-800],"id":"60b267ed-de7f-428a-9bff-ea72c49a7874"},{"parameters":{"url":"=https://www.gommego.com/api/orders?filter[reference]={{ $json.query }}&display=full&output_format=JSON","authentication":"genericCredentialType","genericAuthType":"httpBasicAuth","sendQuery":true,"queryParameters":{"parameters":[{"name":"limit","value":"1"}]},"options":{}},"name":"Ottieni Ordine","type":"n8n-nodes-base.httpRequest","typeVersion":3,"position":[840,-500],"id":"39d0f389-7085-4b95-9ffc-84cbd3c56e67","alwaysOutputData":true,"retryOnFail":true,"credentials":{"httpBasicAuth":{"id":"CDYbffajBgDWgdXn","name":"Prestashop-API"}},"onError":"continueRegularOutput"},{"parameters":{"jsCode":"const response = $input.item.json;\nif (!response.orders || response.orders.length === 0) {\n  return [{ json: { orderFound: false, message: ''Nessun ordine trovato'', chatInput: $json.query } }];\n}\nconst order = response.orders[0];\nreturn [{ json: { orderFound: true, orderDetails: order, chatInput: $json.query } }];"},"name":"Verifica Ordine","type":"n8n-nodes-base.code","typeVersion":2,"position":[1060,-500],"id":"5c1539b8-1e2d-4947-9ce0-c00d98fbb335"},{"parameters":{"options":{}},"name":"Estrai orderDetails","type":"n8n-nodes-base.set","typeVersion":2,"position":[1500,-560],"id":"d78add96-cf13-453a-8eea-879099cf7b81"},{"parameters":{"jsCode":"const order = $json.orderDetails;\nconst id_order = order.id;\nconst id_customer = order.id_customer;\nconst id_address = order.id_address_delivery;\n\nreturn [\n  { json: { type: ''customer'', url: `https://www.gommego.com/api/customers/${id_customer}?output_format=JSON` } },\n  { json: { type: ''address'', url: `https://www.gommego.com/api/addresses/${id_address}?output_format=JSON` } },\n  { json: { type: ''order_histories'', url: `https://www.gommego.com/api/order_histories?filter[id_order]=${id_order}&display=full&output_format=JSON` } }\n];"},"name":"Crea Chiamate","type":"n8n-nodes-base.code","typeVersion":2,"position":[1840,-700],"id":"9c2ad1e2-5e2d-476d-acba-f66aef9369a0"},{"parameters":{"url":"={{$json.url}}","authentication":"genericCredentialType","genericAuthType":"httpBasicAuth","options":{}},"name":"HTTP x3 dinamico","type":"n8n-nodes-base.httpRequest","typeVersion":3,"position":[2040,-700],"id":"2729a02f-08d9-4253-a31f-a4f69d2363ce","retryOnFail":true,"credentials":{"httpBasicAuth":{"id":"CDYbffajBgDWgdXn","name":"Prestashop-API"}},"onError":"continueRegularOutput"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"a7d260d7-e0e2-42bc-acf6-18abddaefc1b","leftValue":"={{ $json.orderFound }}","rightValue":"true","operator":{"type":"boolean","operation":"true","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[1280,-500],"id":"bdb0b1ef-c5a8-4d20-9866-b7674553ee8d","name":"If"},{"parameters":{"functionCode":"// Crea un messaggio di errore personalizzato con struttura standardizzata\nreturn [{\n  json: {\n    // Messaggio principale per il chatbot\n    chatbotResponse: `Mi dispiace, non ho trovato nessun ordine con questo codice. Dovrebbe verificare che il codice sia corretto.`,\n    \n    // Flag di stato\n    orderFound: false,\n    error: true,\n    \n    // Dettagli errore\n    errorMessage: $json[\"message\"] || \"Ordine non trovato\",\n    searchedReference: $json[\"chatInput\"],\n    \n    // Suggerimenti utili per l''utente\n    suggestions: [\n      \"Controlla se hai inserito il codice correttamente\",\n      \"Verifica nella tua email di conferma\"\n    ],\n    \n    // Summary standardizzato (come in Pulisci campi)\n    summary: {\n      order_reference: $json[\"chatInput\"],\n      current_status: \"Non trovato\",\n      tracking_number: null,\n      can_track: false,\n      is_delivered: false,\n      has_issues: false,\n      days_since_order: 0\n    },\n    \n    // Timestamp\n    timestamp: new Date().toISOString()\n  }\n}];"},"id":"71bef896-1a72-4db1-b272-1e327c8bff2f","name":"Risposta Ordine Non Trovato","type":"n8n-nodes-base.function","typeVersion":1,"position":[1500,-340],"notes":"// Crea un messaggio di errore personalizzato\nreturn {\n  json: {\n    chatbotResponse: `Mi dispiace, non ho trovato nessun ordine con questo codice. Dovrebbe verificare che il codice sia corretto.`,\n    orderFound: false,\n    errorMessage: $json[\"message\"],\n    \n    // Aggiungi campi utili per il debugging\n    searchedReference: $json[\"chatInput\"],\n    timestamp: new Date().toISOString(),\n    \n    // Aggiungi suggerimenti utili per l''utente\n    suggestions: [\n      \"Controlla se hai inserito il codice correttamente\",\n      \"Verifica nella tua email di conferma\",\n      ]\n  }\n};"},{"parameters":{"assignments":{"assignments":[{"id":"ae019003-40f6-401e-bb24-b082a7c25f79","name":"Order Detail","value":"={{ $(''Estrai orderDetails'').item.json.orderDetails }}","type":"object"}]},"includeOtherFields":true,"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[2400,-700],"id":"b40052fd-db65-4ee5-8950-039bb45a57f6","name":"Unisce i campi di tutti i nodi"},{"parameters":{"content":"Chiamata API x3","height":440,"width":480},"type":"n8n-nodes-base.stickyNote","position":[1760,-820],"typeVersion":1,"id":"c2662bfe-4ef2-4b69-877d-6a47de4067a4","name":"Sticky Note"},{"parameters":{"requestMethod":"POST","url":"https://parcelsapp.com/api/v3/shipments/tracking","jsonParameters":true,"options":{},"bodyParametersJson":"={\n  \"shipments\": [\n    {\n      \"trackingId\": \"{{ $json.trackingId }}\",\n      \"destinationCountry\": \"{{ $json.destinationCountry }}\"\n    }\n  ],\n  \"language\": \"{{ $json.language }}\",\n  \"apiKey\": \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOiI1MzA4NjNjMC0zMTBkLTExZjAtYjdlMC04ZGQzNjVmMWI4NjEiLCJzdWJJZCI6IjY4MjUwZmVlMjZiMWViMTEwNWMzY2VhNCIsImlhdCI6MTc0NzI1OTM3NH0.JZJzbEq2Fy4uX64VqRbcZRKlxmQyzwzVTuoFmTyQ8KA\"\n}"},"id":"00807130-77ce-46fd-bae4-85fa20f0bec8","name":"HTTP Request (POST Tracking)1","type":"n8n-nodes-base.httpRequest","typeVersion":1,"position":[2640,-360]},{"parameters":{"url":"=https://parcelsapp.com/api/v3/shipments/tracking?uuid={{$json[\"uuid\"]}}&apiKey=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1aWQiOiI1MzA4NjNjMC0zMTBkLTExZjAtYjdlMC04ZGQzNjVmMWI4NjEiLCJzdWJJZCI6IjY4MjUwZmVlMjZiMWViMTEwNWMzY2VhNCIsImlhdCI6MTc0NzI1OTM3NH0.JZJzbEq2Fy4uX64VqRbcZRKlxmQyzwzVTuoFmTyQ8KA","options":{}},"id":"d125d528-fdcd-49ad-aa4d-0e6eed84b2f0","name":"HTTP Request (GET Tracking Status)1","type":"n8n-nodes-base.httpRequest","typeVersion":1,"position":[3040,-20]},{"parameters":{"amount":10,"unit":"seconds"},"id":"fa66e8b5-2c8a-42eb-8891-552c869fe8cd","name":"Wait (10 seconds)","type":"n8n-nodes-base.wait","typeVersion":1,"position":[2840,-20],"webhookId":"8cba3389-df15-40b9-9254-a52dfa86564d"},{"parameters":{"values":{"string":[{"name":"trackingId","value":"={{ $json[\"Order Detail\"].shipping_number }}"},{"name":"destinationCountry","value":"Italy"},{"name":"language","value":"it"}]},"options":{}},"id":"8fea9a23-9b5f-492c-935f-0dac1e641495","name":"Input: Tracking Details","type":"n8n-nodes-base.set","typeVersion":2,"position":[2400,-360]},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"32a785f7-c0af-4504-8aef-542974964f04","leftValue":"={{ $json.done }}","rightValue":"true","operator":{"type":"boolean","operation":"true","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[2920,-360],"id":"94df0936-7dc5-4830-8752-7796dcbc4df7","name":"If1"},{"parameters":{},"type":"n8n-nodes-base.merge","typeVersion":3.2,"position":[3980,-520],"id":"6bd163a2-4800-4e85-a088-643dd1103ceb","name":"Merge1"},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"7810277c-c8b5-473c-8c18-bf4461de1f9a","leftValue":"={{ $json[\"Order Detail\"].shipping_number }}","rightValue":"","operator":{"type":"string","operation":"empty","singleValue":true}}],"combinator":"or"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[2600,-700],"id":"fb7890a3-be0d-43cf-af7c-a3f85c601d0f","name":"Parcel esiste?"},{"parameters":{"assignments":{"assignments":[{"id":"3f32699c-d3ca-414e-b4a2-4373d1e9b454","name":"[\"Order Detail\"].shipping_number","value":"={{ \"Tracking number non ancora rilasciato dal corriere\" }}","type":"string"}]},"includeOtherFields":true,"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[3060,-800],"id":"779cb540-bf00-4c89-b145-2c15ca1b12f7","name":"Edit Fields"},{"parameters":{"content":"## VERIFICA PARCEL NUMBER\nCHIAMATE API\n","height":620,"width":960,"color":7},"type":"n8n-nodes-base.stickyNote","position":[2360,-440],"typeVersion":1,"id":"0f120f8e-41e1-4c01-ba1c-00c928815016","name":"Sticky Note1"},{"parameters":{"content":"## CLEAN DATA E MERGE PER SUPABASE\n","height":560,"width":660,"color":5},"type":"n8n-nodes-base.stickyNote","position":[3540,-760],"typeVersion":1,"id":"27f89d8e-c2e7-4d69-bd7a-1611661c2bcb","name":"Sticky Note2"},{"parameters":{"jsCode":"const raw = $json.query || '''';\n\n// Estrae tutte le sequenze di lettere maiuscole di almeno 5 caratteri\nconst matches = raw.match(/\\b[A-Z]{5,}\\b/g);\n\n// Restituisce solo il primo match, oppure stringa vuota se nulla trovato\nreturn [{\n  json: {\n    query: matches ? matches[0] : ''''\n  }\n}];\n"},"name":"Pulisci codice1","type":"n8n-nodes-base.code","typeVersion":2,"position":[620,-500],"id":"3ec7b726-9bfb-409a-8ce6-55b8518559e4"},{"parameters":{"jsCode":"// üßπ NODO PULISCI CAMPI ‚Äì Solo dati essenziali\n\nconst stateMap = {\n  \"2\": \"Pagamento accettato\", \"3\": \"Elaborazione\", \"4\": \"Spedizione in preparazione\", \"5\": \"Consegnato\",\n  \"6\": \"Annullato\", \"7\": \"Rimborsato\", \"8\": \"Errore di pagamento\", \"9\": \"In attesa rifornimento\",\n  \"10\": \"Bonifico in attesa\", \"11\": \"Pagamento remoto accettato\", \"14\": \"MultiSafepay Pagamento sospeso\",\n  \"20\": \"Rimborso parziale\", \"23\": \"In attesa di pagamento\", \"24\": \"Rimborso parziale\",\n  \"25\": \"Pagamento parziale\", \"27\": \"Annullato per mancato pagamento\", \"28\": \"In transito\",\n  \"29\": \"Consegnato Parzialmente\", \"30\": \"In attesa emissione buono o rimborso\",\n  \"31\": \"In consegna\", \"32\": \"Richiesta reso\", \"35\": \"Destinatario assente\"\n};\n\n// üîÅ Pulizia oggetto: rimuove null, undefined, stringhe vuote\nfunction cleanObject(obj) {\n  if (Array.isArray(obj)) {\n    return obj.map(cleanObject).filter(item => item !== null && item !== undefined && item !== '''');\n  }\n  if (typeof obj === ''object'' && obj !== null) {\n    return Object.fromEntries(\n      Object.entries(obj)\n        .map(([k, v]) => [k, cleanObject(v)])\n        .filter(([_, v]) => v !== null && v !== undefined && v !== '''')\n    );\n  }\n  return obj;\n}\n\ntry {\n  const allInputs = $input.all();\n  const chatbotData = { orderFound: true };\n\n  for (const item of allInputs) {\n    const data = item.json;\n\n    // üì¶ Order\n    if (data[\"Order Detail\"] && !chatbotData.order) {\n      const orderDetail = data[\"Order Detail\"];\n      const noteLines = (orderDetail.note || \"\").split(/\\r?\\n/);\n      const cleanedNote = noteLines.length > 1 ? noteLines.slice(1).join(\", \").trim() : \"\";\n\n      chatbotData.order = {\n        reference: orderDetail.reference,\n        status: stateMap[orderDetail.current_state] || `Stato ${orderDetail.current_state}`,\n        shipping_number: (orderDetail.shipping_number && orderDetail.shipping_number.trim() !== \"\")\n          ? orderDetail.shipping_number\n          : \"Tracking number non ancora rilasciato dal corriere\",\n        payment_method: orderDetail.payment,\n        date_created: orderDetail.date_add,\n        date_updated: orderDetail.date_upd,\n        total_paid: `‚Ç¨ ${parseFloat(orderDetail.total_paid).toFixed(2)}`,\n        total_products: `‚Ç¨ ${parseFloat(orderDetail.total_products).toFixed(2)}`,\n        total_products_with_tax: `‚Ç¨ ${parseFloat(orderDetail.total_products_wt).toFixed(2)}`,\n        note: cleanedNote,\n        products: []\n      };\n\n      if (orderDetail.associations?.order_rows) {\n        chatbotData.order.products = orderDetail.associations.order_rows.map(p => ({\n          name: p.product_name,\n          reference: p.product_reference,\n          ean: p.product_ean13,\n          quantity: parseInt(p.product_quantity),\n          unit_price: `‚Ç¨ ${parseFloat(p.unit_price_tax_incl).toFixed(2)}`,\n          total_price: `‚Ç¨ ${(parseFloat(p.unit_price_tax_incl) * parseInt(p.product_quantity)).toFixed(2)}`\n        }));\n      }\n    }\n\n    // üë§ Cliente\n    if (data.customer && !chatbotData.customer) {\n      const c = data.customer;\n      chatbotData.customer = {\n        full_name: `${c.firstname} ${c.lastname}`,\n        email: c.email,\n        phone: null,\n        is_active: c.active === \"1\",\n        customer_since: c.date_add\n      };\n      if (c.note && c.note.includes(\"RESO\")) {\n        chatbotData.customer.has_return_request = true;\n      }\n    }\n\n    // üöö Consegna\n    if (data.address && !chatbotData.delivery) {\n      const a = data.address;\n      chatbotData.delivery = {\n        recipient: `${a.firstname} ${a.lastname}`,\n        street: a.address1,\n        city: a.city,\n        postcode: a.postcode,\n        country: \"Italia\",\n        phone: a.phone || a.phone_mobile,\n        fiscal_code: a.dni\n      };\n      if ((a.phone || a.phone_mobile) && chatbotData.customer) {\n        chatbotData.customer.phone = a.phone || a.phone_mobile;\n      }\n    }\n  }\n\n  return [{ json: cleanObject(chatbotData) }];\n\n} catch (error) {\n  return [{\n    json: {\n      orderFound: false,\n      error: true,\n      errorMessage: `Errore durante elaborazione dei dati: ${error.message}`,\n      timestamp: new Date().toISOString()\n    }\n  }];\n}"},"id":"d90bf280-c34a-477f-9690-6b55ebd6eccc","name":"Clean data ","type":"n8n-nodes-base.code","typeVersion":2,"position":[3680,-680],"notes":"// üßπ NODO PULISCI CAMPI ‚Äì Solo dati essenziali\n\nconst stateMap = {\n  \"2\": \"Pagamento accettato\", \"3\": \"Elaborazione\", \"4\": \"Spedizione in preparazione\", \"5\": \"Consegnato\",\n  \"6\": \"Annullato\", \"7\": \"Rimborsato\", \"8\": \"Errore di pagamento\", \"9\": \"In attesa rifornimento\",\n  \"10\": \"Bonifico in attesa\", \"11\": \"Pagamento remoto accettato\", \"14\": \"MultiSafepay Pagamento sospeso\",\n  \"20\": \"Rimborso parziale\", \"23\": \"In attesa di pagamento\", \"24\": \"Rimborso parziale\",\n  \"25\": \"Pagamento parziale\", \"27\": \"Annullato per mancato pagamento\", \"28\": \"In transito\",\n  \"29\": \"Consegnato Parzialmente\", \"30\": \"In attesa emissione buono o rimborso\",\n  \"31\": \"In consegna\", \"32\": \"Richiesta reso\", \"35\": \"Destinatario assente\"\n};\n\n// üîÅ Pulizia oggetto: rimuove null, undefined, stringhe vuote\nfunction cleanObject(obj) {\n  if (Array.isArray(obj)) {\n    return obj.map(cleanObject).filter(item => item !== null && item !== undefined && item !== '''');\n  }\n  if (typeof obj === ''object'' && obj !== null) {\n    return Object.fromEntries(\n      Object.entries(obj)\n        .map(([k, v]) => [k, cleanObject(v)])\n        .filter(([_, v]) => v !== null && v !== undefined && v !== '''')\n    );\n  }\n  return obj;\n}\n\ntry {\n  const allInputs = $input.all();\n  const chatbotData = { orderFound: true };\n\n  for (const item of allInputs) {\n    const data = item.json;\n\n    // üì¶ Order\n    if (data[\"Order Detail\"] && !chatbotData.order) {\n      const orderDetail = data[\"Order Detail\"];\n      const noteLines = (orderDetail.note || \"\").split(/\\r?\\n/);\n      const cleanedNote = noteLines.length > 1 ? noteLines.slice(1).join(\", \").trim() : \"\";\n\n      chatbotData.order = {\n        reference: orderDetail.reference,\n        status: stateMap[orderDetail.current_state] || `Stato ${orderDetail.current_state}`,\n        shipping_number: (orderDetail.shipping_number && orderDetail.shipping_number.trim() !== \"\")\n          ? orderDetail.shipping_number\n          : \"Tracking number non ancora rilasciato dal corriere\",\n        payment_method: orderDetail.payment,\n        date_created: orderDetail.date_add,\n        date_updated: orderDetail.date_upd,\n        total_paid: `‚Ç¨ ${parseFloat(orderDetail.total_paid).toFixed(2)}`,\n        total_products: `‚Ç¨ ${parseFloat(orderDetail.total_products).toFixed(2)}`,\n        total_products_with_tax: `‚Ç¨ ${parseFloat(orderDetail.total_products_wt).toFixed(2)}`,\n        note: cleanedNote,\n        products: []\n      };\n\n      if (orderDetail.associations?.order_rows) {\n        chatbotData.order.products = orderDetail.associations.order_rows.map(p => ({\n          name: p.product_name,\n          reference: p.product_reference,\n          ean: p.product_ean13,\n          quantity: parseInt(p.product_quantity),\n          unit_price: `‚Ç¨ ${parseFloat(p.unit_price_tax_incl).toFixed(2)}`,\n          total_price: `‚Ç¨ ${(parseFloat(p.unit_price_tax_incl) * parseInt(p.product_quantity)).toFixed(2)}`\n        }));\n      }\n    }\n\n    // üë§ Cliente\n    if (data.customer && !chatbotData.customer) {\n      const c = data.customer;\n      chatbotData.customer = {\n        full_name: `${c.firstname} ${c.lastname}`,\n        email: c.email,\n        phone: null,\n        is_active: c.active === \"1\",\n        customer_since: c.date_add\n      };\n      if (c.note && c.note.includes(\"RESO\")) {\n        chatbotData.customer.has_return_request = true;\n      }\n    }\n\n    // üöö Consegna\n    if (data.address && !chatbotData.delivery) {\n      const a = data.address;\n      chatbotData.delivery = {\n        recipient: `${a.firstname} ${a.lastname}`,\n        street: a.address1,\n        city: a.city,\n        postcode: a.postcode,\n        country: \"Italia\",\n        phone: a.phone || a.phone_mobile,\n        fiscal_code: a.dni\n      };\n      if ((a.phone || a.phone_mobile) && chatbotData.customer) {\n        chatbotData.customer.phone = a.phone || a.phone_mobile;\n      }\n    }\n  }\n\n  return [{ json: cleanObject(chatbotData) }];\n\n} catch (error) {\n  return [{\n    json: {\n      orderFound: false,\n      error: true,\n      errorMessage: `Errore durante elaborazione dei dati: ${error.message}`,\n      timestamp: new Date().toISOString()\n    }\n  }];\n}\n"},{"parameters":{"jsCode":"function formatDate(dateStr) {\n  const d = new Date(dateStr);\n  return isNaN(d) ? null : d.toISOString().split(''T'')[0];\n}\n\nfunction formatStatusEntry(state) {\n  return `${formatDate(state.date)}: ${state.status}`;\n}\n\nfunction cleanObject(obj) {\n  if (Array.isArray(obj)) {\n    return obj.map(cleanObject).filter(v => v !== null && v !== undefined && v !== '''');\n  }\n  if (typeof obj === ''object'' && obj !== null) {\n    return Object.fromEntries(Object.entries(obj).map(([k, v]) => [k, cleanObject(v)]).filter(([_, v]) => v !== null && v !== undefined && v !== ''''));\n  }\n  return obj;\n}\n\ntry {\n  const input = $input.all();\n  let shipment;\n\n  for (const item of input) {\n    if (item.json.shipments?.length) {\n      shipment = item.json.shipments[0];\n      break;\n    }\n  }\n\n  if (!shipment) {\n    return [{ json: { error: true, message: \"Nessun shipment valido trovato.\" } }];\n  }\n\n  const trackingId = shipment.trackingId || shipment.attributes?.find(attr => attr.l === ''tracking_id'')?.val || null;\n  const trackingUrl = shipment.externalTracking?.[0]?.url || null;\n  const carrierName = shipment.carrier?.name || null;\n  const states = shipment.states || [];\n\n  const sortedStates = [...states].sort((a, b) => new Date(b.date) - new Date(a.date));\n  const latestState = sortedStates[0];\n  const formattedHistory = sortedStates.map(formatStatusEntry);\n\n  const departureEntry = [...states].sort((a, b) => new Date(a.date) - new Date(b.date))[0];\n  const departureDate = departureEntry ? departureEntry.date : null;\n\n  const deliveredEntry = states.find(s =>\n    [\"consegnato\", \"delivered\"].some(kw => s.status?.toLowerCase().includes(kw))\n  );\n  const arrivalDate = deliveredEntry ? deliveredEntry.date : null;\n\n  const transitDays = shipment.attributes?.find(attr => attr.l === ''days_transit'')?.val || null;\n\n  const shipmentPayload = cleanObject({\n    tracking_number: trackingId,\n    tracking_url: trackingUrl,\n    carrier_name: carrierName,\n    latest_status: latestState?.status || null,\n    latest_status_date: latestState?.date || null,\n    departure_date: departureDate,\n    arrival_date: arrivalDate,\n    transit_days: transitDays,\n    delivery_history: formattedHistory\n  });\n\n  return [{ json: { shipment: shipmentPayload } }];\n\n} catch (error) {\n  return [{\n    json: {\n      error: true,\n      message: error.message\n    }\n  }];\n}\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[3680,-380],"id":"67e4800b-12bd-40b9-9273-1dbe46398ba9","name":"Clean Data ","notes":"// ‚úÖ Nodo Code: Tracking GLS, solo un output pulito e unico\n\nfunction formatDate(dateStr) {\n  const d = new Date(dateStr);\n  return isNaN(d) ? null : d.toISOString().split(''T'')[0];\n}\n\nfunction formatStatusEntry(state) {\n  return `${formatDate(state.date)}: ${state.status}`;\n}\n\nfunction cleanObject(obj) {\n  if (Array.isArray(obj)) {\n    return obj.map(cleanObject).filter(v => v !== null && v !== undefined && v !== '''');\n  }\n  if (typeof obj === ''object'' && obj !== null) {\n    return Object.fromEntries(Object.entries(obj).map(([k, v]) => [k, cleanObject(v)]).filter(([_, v]) => v !== null && v !== undefined && v !== ''''));\n  }\n  return obj;\n}\n\ntry {\n  const input = $input.all();\n  let shipment;\n\n  // ‚úÖ Trova il primo shipment valido\n  for (const item of input) {\n    if (item.json.shipments?.length) {\n      shipment = item.json.shipments[0];\n      break;\n    }\n  }\n\n  if (!shipment) {\n    return [{ json: { error: true, message: \"Nessun shipment valido trovato.\" } }];\n  }\n\n  const trackingId = shipment.trackingId || shipment.attributes?.find(attr => attr.l === ''tracking_id'')?.val || null;\n  const trackingUrl = shipment.externalTracking?.[0]?.url || null;\n  const carrierName = shipment.carrier?.name || null;\n  const states = shipment.states || [];\n\n  const sortedStates = [...states].sort((a, b) => new Date(b.date) - new Date(a.date));\n  const latestState = sortedStates[0];\n\n  const formattedHistory = sortedStates.map(formatStatusEntry);\n\n  const departureEntry = [...states].sort((a, b) => new Date(a.date) - new Date(b.date))[0];\n  const departureDate = departureEntry ? departureEntry.date : null;\n\n  const deliveredEntry = states.find(s =>\n    [\"consegnato\", \"delivered\"].some(kw => s.status?.toLowerCase().includes(kw))\n  );\n  const arrivalDate = deliveredEntry ? deliveredEntry.date : null;\n\n  const transitDays = shipment.attributes?.find(attr => attr.l === ''days_transit'')?.val || null;\n\n  const output = cleanObject({\n    tracking_number: trackingId,\n    tracking_url: trackingUrl,\n    carrier_name: carrierName,\n    latest_status: latestState?.status || null,\n    latest_status_date: latestState?.date || null,\n    departure_date: departureDate,\n    arrival_date: arrivalDate,\n    transit_days: transitDays,\n    delivery_history: formattedHistory\n  });\n\n  return [{ json: output }];\n\n} catch (error) {\n  return [{\n    json: {\n      error: true,\n      message: error.message\n    }\n  }];\n}\n"},{"parameters":{"jsCode":"// üîÑ Funzione ricorsiva per flattenare qualsiasi struttura JSON, inclusi array\nfunction flatten(obj, parentKey = '''', res = {}) {\n  for (const [key, value] of Object.entries(obj)) {\n    const newKey = parentKey ? `${parentKey}_${key}` : key;\n    if (Array.isArray(value)) {\n      value.forEach((el, index) => {\n        if (typeof el === ''object'' && el !== null) {\n          flatten(el, `${newKey}_${index}`, res);\n        } else {\n          res[`${newKey}_${index}`] = el;\n        }\n      });\n    } else if (typeof value === ''object'' && value !== null) {\n      flatten(value, newKey, res);\n    } else {\n      res[newKey] = value;\n    }\n  }\n  return res;\n}\n\n// üîÅ Unisci tutti gli input JSON in un singolo oggetto\nconst combined = $input.all().reduce((acc, item) => {\n  return { ...acc, ...item.json };\n}, {});\n\n// üì¶ Flat di tutto il contenuto\nconst flatJson = flatten(combined);\n\n// üß† Aggiungi chatbotResponse (opzionale ma utile)\nflatJson.Response = combined.orderFound\n  ? `‚úÖ Ordine trovato: ${combined.order?.reference}`\n  : `‚ùå Ordine non trovato.`;\n\nreturn [{ json: flatJson }];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[4200,-520],"id":"30d039d4-2705-447d-8ace-62aa24a390db","name":"Final response"},{"parameters":{"tableId":"return_orders","fieldsUi":{"fieldValues":[{"fieldId":"order_status","fieldValue":"={{ $json.order_status }}"},{"fieldId":"order_total_paid","fieldValue":"={{ $json.order_total_paid }}"},{"fieldId":"order_total_products","fieldValue":"={{ $json.order_total_products }}"},{"fieldId":"order_total_products_with_tax","fieldValue":"={{ $json.order_total_products_with_tax }}"},{"fieldId":"order_products_0_name","fieldValue":"={{ $json.order_products_0_name }}"},{"fieldId":"order_products_0_reference","fieldValue":"={{ $json.order_products_0_reference }}"},{"fieldId":"order_products_0_ean","fieldValue":"={{ $json.order_products_0_ean }}"},{"fieldId":"order_products_0_quantity","fieldValue":"={{ $json.order_products_0_quantity }}"},{"fieldId":"order_products_0_unit_price","fieldValue":"={{ $json.order_products_0_unit_price }}"},{"fieldId":"order_products_0_total_price","fieldValue":"={{ $json.order_products_0_total_price }}"},{"fieldId":"order_products_1_name","fieldValue":"={{ $json.order_products_1_name }}"},{"fieldId":"order_products_1_reference","fieldValue":"={{ $json.order_products_1_reference }}"},{"fieldId":"order_products_1_ean","fieldValue":"={{ $json.order_products_1_ean }}"},{"fieldId":"order_products_1_quantity","fieldValue":"={{ $json.order_products_1_quantity }}"},{"fieldId":"order_products_1_unit_price","fieldValue":"={{ $json.order_products_1_unit_price }}"},{"fieldId":"order_products_1_total_price","fieldValue":"={{ $json.order_products_1_total_price }}"},{"fieldId":"customer_full_name","fieldValue":"={{ $json.customer_full_name }}"},{"fieldId":"customer_email","fieldValue":"={{ $json.customer_email }}"},{"fieldId":"customer_phone","fieldValue":"={{ $json.customer_phone }}"},{"fieldId":"delivery_recipient","fieldValue":"={{ $json.delivery_recipient }}"},{"fieldId":"delivery_street","fieldValue":"={{ $json.delivery_street }}"},{"fieldId":"delivery_postcode","fieldValue":"={{ $json.delivery_postcode }}"},{"fieldId":"delivery_country","fieldValue":"={{ $json.delivery_country }}"},{"fieldId":"delivery_phone","fieldValue":"={{ $json.delivery_phone }}"},{"fieldId":"delivery_fiscal_code","fieldValue":"={{ $json.delivery_fiscal_code }}"},{"fieldId":"shipment_tracking_url","fieldValue":"={{ $json.shipment_tracking_url }}"},{"fieldId":"shipment_latest_status","fieldValue":"={{ $json.shipment_latest_status }}"},{"fieldId":"shipment_latest_status_date","fieldValue":"={{ $json.shipment_latest_status_date }}"},{"fieldId":"shipment_departure_date","fieldValue":"={{ $json.shipment_departure_date }}"},{"fieldId":"shipment_transit_days","fieldValue":"={{ $json.shipment_transit_days ? $json.shipment_transit_days : null }}"},{"fieldId":"response","fieldValue":"={{ $json.Response }}"},{"fieldId":"delivery_city","fieldValue":"={{ $json.delivery_city }}"},{"fieldId":"order_reference","fieldValue":"={{ $json.order_reference }}"},{"fieldId":"order_found","fieldValue":"={{ $json.orderFound }}"}]}},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[4600,-500],"id":"63857975-945f-41d6-bf4b-53fdfad86e14","name":"Supabase","credentials":{"supabaseApi":{"id":"BkVV9D4yOfHR3iC4","name":"Supabase tecsolutions"}}}]', '{"When Executed by Another Workflow":{"main":[[{"node":"Pulisci codice1","type":"main","index":0}]]},"Pulisci codice":{"main":[[]]},"Ottieni Ordine":{"main":[[{"node":"Verifica Ordine","type":"main","index":0}],[]]},"Verifica Ordine":{"main":[[{"node":"If","type":"main","index":0}]]},"Estrai orderDetails":{"main":[[{"node":"Crea Chiamate","type":"main","index":0}]]},"Crea Chiamate":{"main":[[{"node":"HTTP x3 dinamico","type":"main","index":0}]]},"HTTP x3 dinamico":{"main":[[{"node":"Unisce i campi di tutti i nodi","type":"main","index":0}],[]]},"If":{"main":[[{"node":"Estrai orderDetails","type":"main","index":0}],[{"node":"Risposta Ordine Non Trovato","type":"main","index":0}]]},"Unisce i campi di tutti i nodi":{"main":[[{"node":"Parcel esiste?","type":"main","index":0}]]},"Risposta Ordine Non Trovato":{"main":[[]]},"HTTP Request (POST Tracking)1":{"main":[[{"node":"If1","type":"main","index":0}]]},"Wait (10 seconds)":{"main":[[{"node":"HTTP Request (GET Tracking Status)1","type":"main","index":0}]]},"Input: Tracking Details":{"main":[[{"node":"HTTP Request (POST Tracking)1","type":"main","index":0}]]},"If1":{"main":[[{"node":"Clean Data ","type":"main","index":0}],[{"node":"Wait (10 seconds)","type":"main","index":0}]]},"HTTP Request (GET Tracking Status)1":{"main":[[{"node":"Clean Data ","type":"main","index":0}]]},"Merge1":{"main":[[{"node":"Final response","type":"main","index":0}]]},"Parcel esiste?":{"main":[[{"node":"Edit Fields","type":"main","index":0}],[{"node":"Clean data ","type":"main","index":0},{"node":"Input: Tracking Details","type":"main","index":0}]]},"Edit Fields":{"main":[[{"node":"Clean data ","type":"main","index":0}]]},"Pulisci codice1":{"main":[[{"node":"Ottieni Ordine","type":"main","index":0}]]},"Clean data ":{"main":[[{"node":"Merge1","type":"main","index":0}]]},"Clean Data ":{"main":[[{"node":"Merge1","type":"main","index":1}]]},"Final response":{"main":[[]]}}', '{"executionOrder":"v1","callerPolicy":"workflowsFromSameOwner","errorWorkflow":"1LreJWx0H8iEqkgn"}', NULL, '{}', '6a7b1d01-8322-408b-be8c-bfbe867981c6', 0, '{"templateCredsSetupCompleted":true}', NULL, '2025-06-21T22:30:47.175Z', '2025-06-27T12:52:58.000Z', false),
  ('30aadd5c-55f4-4f38-aa72-0106ddc64252', 'My workflow 7', false, '[{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[-360,20],"id":"2dc128b7-3826-4aae-8d52-c2005feecac6","name":"When clicking ‚ÄòExecute workflow‚Äô"},{"parameters":{"options":{}},"type":"n8n-nodes-base.splitInBatches","typeVersion":3,"position":[100,0],"id":"3aa89cc5-a352-4903-9818-bb983a90a39e","name":"Loop Over Items"},{"parameters":{},"type":"n8n-nodes-base.noOp","name":"Replace Me","typeVersion":1,"position":[480,20],"id":"3cc89096-9ac9-4316-9131-76b2c1efae27"}]', '{"When clicking ‚ÄòExecute workflow‚Äô":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]},"Loop Over Items":{"main":[[],[{"node":"Replace Me","type":"main","index":0}]]},"Replace Me":{"main":[[{"node":"Loop Over Items","type":"main","index":0}]]}}', '{"executionOrder":"v1"}', NULL, '{}', '50930579-124b-442c-8234-c750b0d8ae8a', 0, NULL, NULL, '2025-06-22T20:10:57.275Z', '2025-06-22T21:47:14.000Z', true),
  ('907e280f-d954-4529-84de-8f2c7901321e', 'grab invoice t24', false, '[{"parameters":{"operation":"pdf","binaryPropertyName":"attachment_0","options":{"joinPages":true}},"type":"n8n-nodes-base.extractFromFile","typeVersion":1,"position":[140,-60],"id":"7a49b7c3-ac7f-4b3a-a9c2-0ff34d910f7a","name":"PDF to Text Converter"},{"parameters":{"modelId":{"__rl":true,"value":"gpt-4o-mini-2024-07-18","mode":"list","cachedResultName":"GPT-4O-MINI-2024-07-18"},"messages":{"values":[{"content":"=Sei un esperto nell''estrazione di dati essenziali da fatture in PDF convertite in testo.\nAnalizza {{ $json.text }} e restituisci un JSON con i seguenti campi:\n\nDati da estrarre:\n\nnumero_ordine_prestashop: il numero ordine prestashop √® di 9 caratteri alfabetici, ad es. \"CEVGBOUDK\". Non sempre √® presente. Nel caso non fosse presente imposta stringa vuota.\n\nnumero_ordine_t24: identifica il riferimento all''ordine (es. \"Order Ref.\", \"Bestellnummer\", \"Numer zam√≥wienia\", \"N. ordine\"). Comincia con i caratteri \"PTY\" e poi dei numeri.\n\nnome_file_fattura: Formato \"invoice-[nome-fornitore]-[numero-fattura].pdf\".\n\nfornitore_nazionalita: codice paese del fornitore (es. \"IT\", \"DE\", \"PL\", \"FR\").\n\nfornitore_ragione_sociale: nome completo dell''azienda fornitrice.\n\nfornitore_partita_iva: codice partita IVA o codice fiscale del fornitore (\"VAT ID\", \"USt-IdNr.\", \"NIP\").\n\nfattura_numero: numero della fattura (\"Invoice No.\", \"Rechnungsnummer\", \"Numer faktury\").\n\nfattura_data: data della fattura nel formato YYYY-MM-DD.\n\nfattura_importo_totale: importo totale IVA inclusa (\"Total Amount\", \"Gesamtbetrag\", \"Kwota ca≈Çkowita\", \"Importo totale\") (non inserire la valuta EUR o ‚Ç¨).\n\nfattura_totale_imponibile: totale escluso le imposte (non inserire la valuta EUR o ‚Ç¨).\n\nfattura_totale_imposte: totale delle imposte (non inserire la valuta EUR o ‚Ç¨).\n\nfattura_percentuale_iva: percentuale IVA applicata (\"VAT Rate\", \"MwSt.\", \"Stawka VAT\") (senza %).\n\nfattura_totale_pfu: Somma dei contributi ambientali PFU (es. \"Recycling Fee\", \"Umweltgeb√ºhr\", \"Op≈Çata ≈õrodowiskowa\").\n\nfattura_spese_spedizione: totale dei costi di spedizione (\"Shipping Costs\", \"Versandkosten\", \"Koszty wysy≈Çki\").\n\nfattura_altri_addebiti: altri addebiti fissi, escluso i prodotti (se assenti, restituisci \"0\").\n\nAggiungi un campo \"mese\" il cui valore √® calcolato dalla data (es fattura_data\": \"26/02/2025\" = \"Mese: \"Febbraio\")\n\nRegole di estrazione:\n‚úÖ Supporto multilingua: Trova i campi in qualsiasi lingua.\n‚úÖ Solo dati essenziali: Nessun metadato extra (es. \"index\", \"message\").\n‚úÖ fattura_importo_totale = fattura_totale_imponibile + fattura_totale_imposte, se non corrisponde, stai estraendo i dati sbagliati\n‚úÖ Formattazione uniforme:\n\nImporti con il punto come separatore decimale (es. \"393.68\").\nSe un dato √® assente, restituisci una stringa vuota o \"0\" per i numerici.\n\nEsempio di JSON corretto:\n\n{\n  \"numero_ordine_prestashop\": \"FZISHUXBL\",\n  \"numero_ordine_t24\": \"PTY201022640225\",\n  \"nome_file_fattura\": \"invoice-an-car-3153-tr-2025.pdf\",\n  \"fornitore_nazionalita\": \"DE\",\n  \"fornitore_ragione_sociale\": \"M√ºller GmbH\",\n  \"fornitore_partita_iva\": \"DE123456789\",\n  \"fattura_numero\": \"3153/tr-2025\",\n  \"fattura_data\": \"26/02/2025\",\n  \"fattura_importo_totale\": \"196.89\",\n  \"fattura_totale_imponibile\": \"161.39\",\n  \"fattura_totale_imposte\": \"35.50\",\n  \"fattura_percentuale_iva\": \"22\",\n  \"fattura_totale_pfu\": \"14.16\",\n  \"fattura_spese_spedizione\": \"5.00\",\n  \"fattura_altri_addebiti\": \"1.21\",\n  \"mese\": \"Febbraio\"\n}\n"}]},"jsonOutput":true,"options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[320,-60],"id":"8371d5a7-fd32-4b24-af3e-dda9ef1c6985","name":"AI Invoice Data Extractor","credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"jsCode":"// Funzione per appiattire la risposta OpenAI e preparare i dati per l''upsert\nlet extractedData = {};\n\n// Gestione della risposta OpenAI (potrebbe essere nested)\nconst item = items[0].json;\n\nif (item.message && item.message.content) {\n  // Struttura nested di OpenAI\n  extractedData = item.message.content;\n} else if (item.choices && item.choices[0] && item.choices[0].message) {\n  // Altra possibile struttura OpenAI\n  extractedData = item.choices[0].message.content;\n} else {\n  // Gi√† flat o struttura diretta\n  extractedData = item;\n}\n\n// Validazione e pulizia dei dati\nconst cleanData = {\n  // Chiavi primarie per l''UPSERT (NON possono essere NULL)\n  order_reference: extractedData.numero_ordine_prestashop || ''UNKNOWN'',\n  t24_order_number: extractedData.numero_ordine_t24 || ''MISSING'',\n  \n  // Dati fornitore\n  invoice_wholesaler_name: extractedData.fornitore_ragione_sociale || '''',\n  invoice_wholesaler_country_code: extractedData.fornitore_nazionalita || '''',\n  invoice_wholesaler_taxid: extractedData.fornitore_partita_iva || '''',\n  \n  // Dati fattura\n  invoice_filename: extractedData.nome_file_fattura || '''',\n  invoice_number: extractedData.fattura_numero || '''',\n  invoice_date: extractedData.fattura_data || null,\n  \n  // Importi (conversione in numerico con fallback a 0)\n  invoice_total: parseFloat(extractedData.fattura_importo_totale) || 0,\n  invoice_taxable_amount: parseFloat(extractedData.fattura_totale_imponibile) || 0,\n  invoice_total_taxes: parseFloat(extractedData.fattura_totale_imposte) || 0,\n  invoice_tax_percentage: parseFloat(extractedData.fattura_percentuale_iva) || 0,\n  invoice_total_pfu: parseFloat(extractedData.fattura_totale_pfu) || 0,\n  invoice_shipping_costs: parseFloat(extractedData.fattura_spese_spedizione) || 0,\n  invoice_total_other_charges: parseFloat(extractedData.fattura_altri_addebiti) || 0,\n  \n  // Metadati aggiuntivi\n  invoice_month: extractedData.mese || '''',\n  processed_at: new Date().toISOString(),\n  \n  // Validazione matematica\n  math_validation: {\n    calculated_total: (parseFloat(extractedData.fattura_totale_imponibile) || 0) + (parseFloat(extractedData.fattura_totale_imposte) || 0),\n    declared_total: parseFloat(extractedData.fattura_importo_totale) || 0,\n    is_valid: Math.abs(\n      ((parseFloat(extractedData.fattura_totale_imponibile) || 0) + (parseFloat(extractedData.fattura_totale_imposte) || 0)) - \n      (parseFloat(extractedData.fattura_importo_totale) || 0)\n    ) < 0.01\n  }\n};\n\n// Log per debugging\nconsole.log(''Extracted Data:'', extractedData);\nconsole.log(''Cleaned Data:'', cleanData);\nconsole.log(''Math Validation:'', cleanData.math_validation);\n\n// Se la validazione matematica fallisce, logga un warning\nif (!cleanData.math_validation.is_valid) {\n  console.warn(''‚ö†Ô∏è Math validation failed! Check invoice amounts extraction.'');\n}\n\nreturn [\n  {\n    json: cleanData\n  }\n];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[680,-60],"id":"c22b77b0-b5d0-4c79-89c1-6a0e41afcd88","name":"Data Processor & Validator"},{"parameters":{"operation":"upsert"},"type":"n8n-nodes-base.supabase","typeVersion":1,"position":[660,-340],"id":"f17c709f-5946-4396-aaff-1973a4117280","name":"Supabase UPSERT","alwaysOutputData":true,"credentials":{"supabaseApi":{"id":"BkVV9D4yOfHR3iC4","name":"Supabase tecsolutions"}}},{"parameters":{"jsCode":"// Nodo finale per logging e response formatting\nconst result = items[0].json;\n\n// Prepara risposta di successo\nconst response = {\n  success: true,\n  timestamp: new Date().toISOString(),\n  operation: result.id ? ''UPDATE'' : ''INSERT'',\n  record_id: result.id,\n  order_reference: result.order_reference,\n  t24_order_number: result.t24_order_number,\n  invoice_total: result.invoice_total,\n  message: `Invoice processed successfully. Operation: ${result.id ? ''Updated existing'' : ''Created new''} record.`\n};\n\n// Log dell''operazione\nconsole.log(''‚úÖ Invoice Processing Complete:'', response);\n\nreturn [\n  {\n    json: response\n  }\n];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[1120,-60],"id":"2bd0ea08-6ff3-4f60-b778-ab09d7e54afb","name":"Success Logger & Response"},{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[880,-340],"id":"a7b8a5d2-a8d5-41cc-8afd-85045b25e1da","name":"When clicking ‚ÄòExecute workflow‚Äô"},{"parameters":{"operation":"upsert","schema":{"__rl":true,"mode":"list","value":"public"},"table":{"__rl":true,"value":"orders_processed","mode":"list","cachedResultName":"orders_processed"},"columns":{"mappingMode":"defineBelow","value":{"t24_wholesaler_ita":false,"check_order_vs_invoice":false,"id_order":0,"id_customer":0,"order_total_paid":0,"t24_total_costs":0,"t24_total_price":0,"invoice_total":0,"invoice_taxable_amount":0,"invoice_total_taxes":0,"invoice_tax_percentage":0,"invoice_total_pfu":0,"invoice_shipping_costs":0,"invoice_total_other_charges":0,"order_total_products":0},"matchingColumns":[],"schema":[{"id":"id_order","displayName":"id_order","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":true},{"id":"created_at","displayName":"created_at","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":false},{"id":"id_customer","displayName":"id_customer","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":false},{"id":"customer_lastname","displayName":"customer_lastname","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"customer_firstname","displayName":"customer_firstname","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"customer_email","displayName":"customer_email","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"order_date","displayName":"order_date","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":false},{"id":"order_total_paid","displayName":"order_total_paid","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":false},{"id":"order_reference","displayName":"order_reference","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"order_note","displayName":"order_note","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"processed_timestamp","displayName":"processed_timestamp","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":false},{"id":"t24_order_number","displayName":"t24_order_number","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"t24_order_date","displayName":"t24_order_date","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":false},{"id":"t24_total_costs","displayName":"t24_total_costs","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":false},{"id":"t24_total_price","displayName":"t24_total_price","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":false},{"id":"t24_recipient_name","displayName":"t24_recipient_name","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"t24_recipient_address","displayName":"t24_recipient_address","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"t24_recipient_cap","displayName":"t24_recipient_cap","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"t24_recipient_city","displayName":"t24_recipient_city","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"t24_recipient_phone","displayName":"t24_recipient_phone","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"t24_eta","displayName":"t24_eta","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"t24_wholesaler_name","displayName":"t24_wholesaler_name","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"t24_wholesaler_address","displayName":"t24_wholesaler_address","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"t24_wholesaler_cap","displayName":"t24_wholesaler_cap","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"t24_wholesaler_city","displayName":"t24_wholesaler_city","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"t24_wholesaler_cf","displayName":"t24_wholesaler_cf","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"t24_wholesaler_taxid","displayName":"t24_wholesaler_taxid","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"t24_wholesaler_phone","displayName":"t24_wholesaler_phone","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"t24_wholesaler_email","displayName":"t24_wholesaler_email","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"t24_wholesaler_ita","displayName":"t24_wholesaler_ita","required":false,"defaultMatch":false,"display":true,"type":"boolean","canBeUsedToMatch":false},{"id":"t24_subject","displayName":"t24_subject","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"invoice_filename","displayName":"invoice_filename","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"invoice_wholesaler_name","displayName":"invoice_wholesaler_name","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"invoice_wholesaler_country_code","displayName":"invoice_wholesaler_country_code","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"invoice_wholesaler_taxid","displayName":"invoice_wholesaler_taxid","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"invoice_number","displayName":"invoice_number","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false},{"id":"invoice_date","displayName":"invoice_date","required":false,"defaultMatch":false,"display":true,"type":"dateTime","canBeUsedToMatch":false},{"id":"invoice_total","displayName":"invoice_total","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":false},{"id":"invoice_taxable_amount","displayName":"invoice_taxable_amount","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":false},{"id":"invoice_total_taxes","displayName":"invoice_total_taxes","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":false},{"id":"invoice_tax_percentage","displayName":"invoice_tax_percentage","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":false},{"id":"invoice_total_pfu","displayName":"invoice_total_pfu","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":false},{"id":"invoice_shipping_costs","displayName":"invoice_shipping_costs","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":false},{"id":"invoice_total_other_charges","displayName":"invoice_total_other_charges","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":false},{"id":"check_order_vs_invoice","displayName":"check_order_vs_invoice","required":false,"defaultMatch":false,"display":true,"type":"boolean","canBeUsedToMatch":false},{"id":"order_total_products","displayName":"order_total_products","required":false,"defaultMatch":false,"display":true,"type":"number","canBeUsedToMatch":false},{"id":"embedding","displayName":"embedding","required":false,"defaultMatch":false,"display":true,"type":"options","canBeUsedToMatch":false,"options":[]},{"id":"shipping_number","displayName":"shipping_number","required":false,"defaultMatch":false,"display":true,"type":"string","canBeUsedToMatch":false}],"attemptToConvertTypes":false,"convertFieldsToString":false},"options":{}},"type":"n8n-nodes-base.postgres","typeVersion":2.6,"position":[920,-60],"id":"1068921e-7117-4111-8233-04d91eebccc6","name":"Postgres","credentials":{"postgres":{"id":"jBT1O3LaStZrwqsC","name":"Postgres Supabase TEC"}}},{"parameters":{"formTitle":"Carica fattura","formFields":{"values":[{"fieldLabel":"attachment_0","fieldType":"file","multipleFiles":false,"acceptFileTypes":"pdf"}]},"options":{}},"type":"n8n-nodes-base.formTrigger","typeVersion":2.2,"position":[-60,-60],"id":"53fbbc0c-e3fb-45fc-9336-cb662e339b47","name":"On form submission","webhookId":"6a1c0767-a34d-4f50-83c8-f8739fc02d87"}]', '{"PDF to Text Converter":{"main":[[{"node":"AI Invoice Data Extractor","type":"main","index":0}]]},"AI Invoice Data Extractor":{"main":[[{"node":"Data Processor & Validator","type":"main","index":0}]]},"Data Processor & Validator":{"main":[[{"node":"Postgres","type":"main","index":0}]]},"Supabase UPSERT":{"main":[[]]},"When clicking ‚ÄòExecute workflow‚Äô":{"main":[[]]},"Postgres":{"main":[[{"node":"Success Logger & Response","type":"main","index":0}]]},"On form submission":{"main":[[{"node":"PDF to Text Converter","type":"main","index":0}]]}}', '{"executionOrder":"v1"}', NULL, '{}', '63bc9830-090b-44c4-96dd-3621ed378f81', 0, '{"templateCredsSetupCompleted":true}', NULL, '2025-06-23T12:18:45.680Z', '2025-06-23T12:24:35.000Z', false),
  ('c726e40c-b73d-4c54-b509-c47ef3b51778', 'My workflow 8', false, '[{"parameters":{"rule":{"interval":[{"field":"minutes","minutesInterval":1}]}},"type":"n8n-nodes-base.scheduleTrigger","typeVersion":1.2,"position":[-2000,-200],"id":"94510413-b990-4233-9e67-325df8adf9ef","name":"Schedule Trigger"},{"parameters":{"resource":"folderMessage","folderId":{"__rl":true,"value":"AAMkADY5YTU5ODIzLTM5M2MtNGU4Zi04YzNmLTBlYmYxNDNhODNjMAAuAAAAAAAty8lTOVoeRrTqgTQml0B1AQAYYLMeDvsGSqoDRrzkfpW2AAA3x-uFAAA=","mode":"list","cachedResultName":"FATTURE"},"limit":1,"output":"fields","fields":["body","createdDateTime","subject"],"filtersUI":{"values":{"filters":{"readStatus":"unread"}}},"options":{"downloadAttachments":true}},"type":"n8n-nodes-base.microsoftOutlook","typeVersion":2,"position":[-1560,-420],"id":"66e03cee-2f27-4315-bf38-9bdc29153496","name":"Leggi Email Non Lette","webhookId":"b242e18c-972a-442e-9063-f55a6f90465c","credentials":{"microsoftOutlookOAuth2Api":{"id":"gvsjOBgXBwH8vLH8","name":"Outlook Supplies"}}},{"parameters":{"operation":"move","messageId":{"__rl":true,"value":"={{ $json.id }}","mode":"id"},"folderId":{"__rl":true,"value":"AAMkADY5YTU5ODIzLTM5M2MtNGU4Zi04YzNmLTBlYmYxNDNhODNjMAAuAAAAAAAty8lTOVoeRrTqgTQml0B1AQAYYLMeDvsGSqoDRrzkfpW2AAAEXLZXAAA=","mode":"list","cachedResultName":"Template"}},"type":"n8n-nodes-base.microsoftOutlook","typeVersion":2,"position":[-1120,160],"id":"b5d2f9f8-ccf6-4f21-bc10-b9fe5365f74b","name":"Sposta Email in Template","webhookId":"4a2cea9b-2a33-405c-951b-8b63a2928a93","credentials":{"microsoftOutlookOAuth2Api":{"id":"gvsjOBgXBwH8vLH8","name":"Outlook Supplies"}}},{"parameters":{"operation":"pdf","binaryPropertyName":"attachment_0","options":{"joinPages":true}},"type":"n8n-nodes-base.extractFromFile","typeVersion":1,"position":[-1220,-420],"id":"de76eb1a-2d17-4793-a46b-6d82549dbd4f","name":"Estrai Testo da PDF"},{"parameters":{"modelId":{"__rl":true,"value":"gpt-4o-mini-2024-07-18","mode":"list","cachedResultName":"GPT-4O-MINI-2024-07-18"},"messages":{"values":[{"content":"=Sei un esperto nell''estrazione di dati essenziali da fatture in PDF convertite in testo.\nAnalizza {{ $json.text }} e restituisci un JSON con i seguenti campi:\n\nDati da estrarre:\n\nnumero_ordine_prestashop: il numero ordine prestashop √® di 9 caratteri alfabetici, ad es. \"CEVGBOUDK\". Non sempre √® presente. Nel caso non fosse presente imposta stringa vuota.\n\nnumero_ordine_t24: identifica il riferimento all''ordine (es. \"Order Ref.\", \"Bestellnummer\", \"Numer zam√≥wienia\", \"N. ordine\"). Comincia con i caratteri \"PTY\" e poi dei numeri.\n\nnome_file_fattura: Formato \"invoice-[nome-fornitore]-[numero-fattura].pdf\".\n\nfornitore_nazionalita: codice paese del fornitore (es. \"IT\", \"DE\", \"PL\", \"FR\").\n\nfornitore_ragione_sociale: nome completo dell''azienda fornitrice.\n\nfornitore_partita_iva: codice partita IVA o codice fiscale del fornitore (\"VAT ID\", \"USt-IdNr.\", \"NIP\").\n\nfattura_numero: numero della fattura (\"Invoice No.\", \"Rechnungsnummer\", \"Numer faktury\").\n\nfattura_data: data della fattura nel formato YYYY-MM-DD.\n\nfattura_importo_totale: importo totale IVA inclusa (\"Total Amount\", \"Gesamtbetrag\", \"Kwota ca≈Çkowita\", \"Importo totale\") (non inserire la valuta EUR o ‚Ç¨).\n\nfattura_totale_imponibile: totale escluso le imposte (non inserire la valuta EUR o ‚Ç¨).\n\nfattura_totale_imposte: totale delle imposte (non inserire la valuta EUR o ‚Ç¨).\n\nfattura_percentuale_iva: percentuale IVA applicata (\"VAT Rate\", \"MwSt.\", \"Stawka VAT\") (senza %).\n\nfattura_totale_pfu: Somma dei contributi ambientali PFU (es. \"Recycling Fee\", \"Umweltgeb√ºhr\", \"Op≈Çata ≈õrodowiskowa\").\n\nfattura_spese_spedizione: totale dei costi di spedizione (\"Shipping Costs\", \"Versandkosten\", \"Koszty wysy≈Çki\").\n\nfattura_altri_addebiti: altri addebiti fissi, escluso i prodotti (se assenti, restituisci \"0\").\n\nAggiungi un campo \"mese\" il cui valore √® calcolato dalla data (es fattura_data\": \"26/02/2025\" = \"Mese: \"Febbraio\")\n\nRegole di estrazione:\n‚úÖ Supporto multilingua: Trova i campi in qualsiasi lingua.\n‚úÖ Solo dati essenziali: Nessun metadato extra (es. \"index\", \"message\").\n‚úÖ fattura_importo_totale = fattura_totale_imponibile + fattura_totale_imposte, se non corrisponde, stai estraendo i dati sbagliati\n‚úÖ Formattazione uniforme:\n\nImporti con il punto come separatore decimale (es. \"393.68\").\nSe un dato √® assente, restituisci una stringa vuota o \"0\" per i numerici.\n\nEsempio di JSON corretto:\n\n{\n  \"numero_ordine_prestashop\": \"FZISHUXBL\",\n  \"numero_ordine_t24\": \"PTY201022640225\",\n  \"nome_file_fattura\": \"invoice-an-car-3153-tr-2025.pdf\",\n  \"fornitore_nazionalita\": \"DE\",\n  \"fornitore_ragione_sociale\": \"M√ºller GmbH\",\n  \"fornitore_partita_iva\": \"DE123456789\",\n  \"fattura_numero\": \"3153/tr-2025\",\n  \"fattura_data\": \"26/02/2025\",\n  \"fattura_importo_totale\": \"196.89\",\n  \"fattura_totale_imponibile\": \"161.39\",\n  \"fattura_totale_imposte\": \"35.50\",\n  \"fattura_percentuale_iva\": \"22\",\n  \"fattura_totale_pfu\": \"14.16\",\n  \"fattura_spese_spedizione\": \"5.00\",\n  \"fattura_altri_addebiti\": \"1.21\",\n  \"mese\": \"Febbraio\"\n}\n"}]},"jsonOutput":true,"options":{}},"type":"@n8n/n8n-nodes-langchain.openAi","typeVersion":1.8,"position":[-940,-420],"id":"c48a3e3e-3abc-49c3-8155-7a67e7210de5","name":"OpenAI Estrazione Dati","credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"jsCode":"// Data processor semplificato per Supabase UPSERT\nlet extractedData = {};\nlet driveFileId = '''';\n\n// Gestione della risposta OpenAI\nconst aiResponse = items[0].json;\nif (aiResponse.message && aiResponse.message.content) {\n  extractedData = aiResponse.message.content;\n} else {\n  extractedData = aiResponse;\n}\n\n// Recupera ID del file Google Drive\nconst driveData = $(''Carica PDF su Google Drive'').first();\nif (driveData && driveData.json && driveData.json.id) {\n  driveFileId = driveData.json.id;\n}\n\n// Pulisci e prepara i dati\nconst cleanData = {\n  // Campi originali per compatibilit√†\n  numero_ordine_prestashop: extractedData.numero_ordine_prestashop || '''',\n  numero_ordine_t24: extractedData.numero_ordine_t24 || '''',\n  nome_file_fattura: extractedData.nome_file_fattura || '''',\n  fornitore_nazionalita: extractedData.fornitore_nazionalita || '''',\n  fornitore_ragione_sociale: extractedData.fornitore_ragione_sociale || '''',\n  fornitore_partita_iva: extractedData.fornitore_partita_iva || '''',\n  fattura_numero: extractedData.fattura_numero || '''',\n  fattura_data: extractedData.fattura_data || '''',\n  fattura_importo_totale: extractedData.fattura_importo_totale || ''0'',\n  fattura_totale_imponibile: extractedData.fattura_totale_imponibile || ''0'',\n  fattura_totale_imposte: extractedData.fattura_totale_imposte || ''0'',\n  fattura_percentuale_iva: extractedData.fattura_percentuale_iva || ''0'',\n  fattura_totale_pfu: extractedData.fattura_totale_pfu || ''0'',\n  fattura_spese_spedizione: extractedData.fattura_spese_spedizione || ''0'',\n  fattura_altri_addebiti: extractedData.fattura_altri_addebiti || ''0'',\n  mese: extractedData.mese || '''',\n  \n  // Campi aggiuntivi per logica business\n  google_drive_file_id: driveFileId,\n  is_italian_supplier: (extractedData.fornitore_nazionalita || '''').toUpperCase() === ''IT'',\n  suggested_filename: `${extractedData.mese || ''Unknown''}_${extractedData.numero_ordine_t24 || ''NoOrder''}_${(extractedData.fornitore_ragione_sociale || ''Unknown'').replace(/[^a-zA-Z0-9]/g, ''_'')}`\n};\n\nconsole.log(''üîç Extracted Data:'', extractedData);\nconsole.log(''üìÅ Google Drive File ID:'', driveFileId);\nconsole.log(`üáÆüáπ Italian Supplier: ${cleanData.is_italian_supplier}`);\n\nreturn [{ json: cleanData }];"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[-580,-420],"id":"c5525ec1-3289-4e1d-9984-b00183f9f936","name":"Data Processor & Validator"},{"parameters":{"formTitle":"Carica fattura","formFields":{"values":[{"fieldLabel":"attachment_0","fieldType":"file","multipleFiles":false,"acceptFileTypes":"pdf"}]},"options":{}},"type":"n8n-nodes-base.formTrigger","typeVersion":2.2,"position":[-1960,-600],"id":"8fad6116-d4a8-4cac-8ce8-612ae85711cb","name":"On form submission","webhookId":"6a1c0767-a34d-4f50-83c8-f8739fc02d87"},{"parameters":{"inputDataFieldName":"attachment_0","driveId":{"__rl":true,"value":"My Drive","mode":"list","cachedResultName":"My Drive","cachedResultUrl":"https://drive.google.com/drive/my-drive"},"folderId":{"__rl":true,"value":"12IYqqROdSMKNay9H7VWnVSF3N3pEbSeS","mode":"list","cachedResultName":"Fatture_Estero","cachedResultUrl":"https://drive.google.com/drive/folders/12IYqqROdSMKNay9H7VWnVSF3N3pEbSeS"},"options":{}},"type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[-860,-120],"id":"7a1f05c4-7131-499a-a280-4d66114fd62d","name":"Carica Fattura PDF","credentials":{"googleDriveOAuth2Api":{"id":"WBhAeqmWykJUM02S","name":"Google Drive account"}}},{"parameters":{"conditions":{"options":{"caseSensitive":true,"leftValue":"","typeValidation":"strict","version":2},"conditions":[{"id":"2dc7accf-a932-461e-bc39-2403570be119","leftValue":"={{ $json.fornitore_nazionalita }}","rightValue":"IT","operator":{"type":"string","operation":"equals"}},{"id":"21337c2c-3f97-4c47-80bd-ce7528eeb5f5","leftValue":"={{ $json.id }}","rightValue":"","operator":{"type":"string","operation":"notEmpty","singleValue":true}}],"combinator":"and"},"options":{}},"type":"n8n-nodes-base.if","typeVersion":2.2,"position":[260,-140],"id":"6da4ce37-a315-4e39-b863-97ef419ebf9c","name":"Se ITA cancella"},{"parameters":{"operation":"deleteFile","fileId":{"__rl":true,"value":"={{ $json.id }}","mode":"id"},"options":{"deletePermanently":false}},"type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[500,-260],"id":"cf99c0d8-d573-45e3-a158-cd4c48181217","name":"Cancella by ID","credentials":{"googleDriveOAuth2Api":{"id":"WBhAeqmWykJUM02S","name":"Google Drive account"}}},{"parameters":{"assignments":{"assignments":[{"id":"b4e2ebcc-0d82-4436-ac43-0ff56e2690c4","name":"id","value":"={{ $json.id }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-540,-120],"id":"5ac3a1e7-14c5-40b9-96d6-766ab456a0a0","name":"Edit Fields"},{"parameters":{"toRecipients":"info@gommego.com","subject":"Nuova fattura estera per commercialista","bodyContent":"=Hai una nuova fattura estera per commercialista  {{ $json.name }}","additionalFields":{}},"type":"n8n-nodes-base.microsoftOutlook","typeVersion":2,"position":[720,40],"id":"94251486-95db-4201-84f3-4e93e2642914","name":"Genera Mail ","webhookId":"3864e0eb-becf-4255-97a5-a833c04f0027","credentials":{"microsoftOutlookOAuth2Api":{"id":"gvsjOBgXBwH8vLH8","name":"Outlook Supplies"}}},{"parameters":{},"type":"n8n-nodes-base.merge","typeVersion":3.1,"position":[-80,-140],"id":"0598c052-8b99-4090-924f-9a9d745f8b6e","name":"Merge"},{"parameters":{"jsCode":"let merged = {};\n\nitems.forEach(item => {\n  const json = item.json;\n\n  if (json.message && json.message.content) {\n    // Appiattisci il primo oggetto (annidato)\n    merged = {\n      ...merged,\n      index: json.index,\n      role: json.message.role,\n      finish_reason: json.finish_reason,\n      ...json.message.content\n    };\n  } else {\n    // Unisci direttamente i campi del secondo oggetto (gi√† flat)\n    merged = {\n      ...merged,\n      ...json\n    };\n  }\n});\n\nreturn [\n  {\n    json: merged\n  }\n];\n"},"type":"n8n-nodes-base.code","typeVersion":2,"position":[100,-140],"id":"1a40e4e1-d940-4986-a422-22c15874ab4d","name":"JSON Flat2"},{"parameters":{"operation":"update","fileId":{"__rl":true,"value":"={{ $(''JSON Flat2'').item.json.id }}","mode":"id"},"newUpdatedFileName":"={{ $json.mese }}_{{ $(''JSON Flat2'').item.json.numero_ordine_t24 }}_{{ $(''JSON Flat2'').item.json.fornitore_ragione_sociale }}","options":{}},"type":"n8n-nodes-base.googleDrive","typeVersion":3,"position":[500,40],"id":"5ad5d762-3db5-4179-8202-450af57ea857","name":"Cambia Nome","credentials":{"googleDriveOAuth2Api":{"id":"WBhAeqmWykJUM02S","name":"Google Drive account"}}}]', '{"Schedule Trigger":{"main":[[{"node":"Leggi Email Non Lette","type":"main","index":0}]]},"Leggi Email Non Lette":{"main":[[{"node":"Estrai Testo da PDF","type":"main","index":0},{"node":"Carica Fattura PDF","type":"main","index":0},{"node":"Sposta Email in Template","type":"main","index":0}]]},"Sposta Email in Template":{"main":[[]]},"Estrai Testo da PDF":{"main":[[{"node":"OpenAI Estrazione Dati","type":"main","index":0}]]},"OpenAI Estrazione Dati":{"main":[[{"node":"Data Processor & Validator","type":"main","index":0}]]},"Data Processor & Validator":{"main":[[{"node":"Merge","type":"main","index":0}]]},"On form submission":{"main":[[{"node":"Leggi Email Non Lette","type":"main","index":0}]]},"Carica Fattura PDF":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]},"Se ITA cancella":{"main":[[{"node":"Cancella by ID","type":"main","index":0}],[{"node":"Cambia Nome","type":"main","index":0}]]},"Edit Fields":{"main":[[{"node":"Merge","type":"main","index":1}]]},"Merge":{"main":[[{"node":"JSON Flat2","type":"main","index":0}]]},"JSON Flat2":{"main":[[{"node":"Se ITA cancella","type":"main","index":0}]]},"Cambia Nome":{"main":[[{"node":"Genera Mail ","type":"main","index":0}]]}}', '{"executionOrder":"v1"}', NULL, '{}', 'cdc25550-f4bf-43ac-b030-906268342193', 0, NULL, NULL, '2025-06-23T12:32:20.258Z', '2025-07-05T14:39:23.000Z', false),
  ('102e82c6-d780-459c-b2b3-3bfa9875f1a2', 'My workflow 9', false, '[{"parameters":{"path":"api/client","responseMode":"lastNode","options":{}},"id":"be76934b-6859-4da0-87ee-a38c902519fe","name":"Webhook","type":"n8n-nodes-base.webhook","typeVersion":1,"position":[-144,352],"webhookId":"dc108c84-49e1-4082-a276-34508dd5f87a"},{"parameters":{"functionCode":"const { id, list, type, search } = $json;\n\nif (id) {\n  return [{ json: { route: \"byId\", id } }];\n}\nif (list === ''true'') {\n  return [{ json: { route: \"list\" } }];\n}\nif (type) {\n  return [{ json: { route: \"byType\", type } }];\n}\nif (search) {\n  return [{ json: { route: \"search\", query: search } }];\n}\nthrow new Error(\"Parametro di richiesta non valido\");"},"id":"0f1f827c-610b-4028-a5b1-533b2742dfc5","name":"Routing","type":"n8n-nodes-base.function","typeVersion":1,"position":[96,352]},{"parameters":{"url":"http://localhost:5678/api/v1/workflows/{{$json[\"id\"]}}","authentication":"headerAuth","options":{}},"id":"6d8e49df-fa35-46bc-92b2-b0396eb65d95","name":"GET by ID","type":"n8n-nodes-base.httpRequest","typeVersion":3,"position":[400,144]},{"parameters":{"url":"http://localhost:5678/api/v1/workflows?active=true","authentication":"headerAuth","options":{}},"id":"4a70ef68-a57f-431d-ab2b-ccae40fed5c8","name":"GET List","type":"n8n-nodes-base.httpRequest","typeVersion":3,"position":[400,352]},{"parameters":{"functionCode":"const workflows = items[0].json.data;\nconst filtered = workflows.filter(wf =>\n  wf.nodes?.some(n => n.type === ''n8n-nodes-base.formTrigger'')\n);\nreturn filtered.map(wf => ({\n  json: {\n    id: wf.id,\n    name: wf.name,\n    nodeTypes: wf.nodes.map(n => n.type)\n  }\n}));"},"id":"2b9b8622-defc-412f-a074-be1cd0e2a19f","name":"Filter FormTrigger","type":"n8n-nodes-base.function","typeVersion":1,"position":[704,528]},{"parameters":{"functionCode":"const query = $json.query.toLowerCase();\nconst workflows = items[0].json.data;\nconst filtered = workflows.filter(wf =>\n  wf.name.toLowerCase().includes(query)\n);\nreturn filtered.map(wf => ({\n  json: {\n    id: wf.id,\n    name: wf.name\n  }\n}));"},"id":"5050f0fc-3c22-4cf5-9f21-dada4a1d2db6","name":"Search by Name","type":"n8n-nodes-base.function","typeVersion":1,"position":[704,704]},{"parameters":{"functionCode":"const wf = items[0].json;\nreturn [{\n  json: {\n    id: wf.id,\n    name: wf.name,\n    active: wf.active,\n    createdAt: wf.createdAt,\n    updatedAt: wf.updatedAt,\n    nodes: wf.nodes.map(n => ({ name: n.name, type: n.type }))\n  }\n}];"},"id":"5c205837-e975-49a1-8d18-712c56b22998","name":"Clean by ID","type":"n8n-nodes-base.function","typeVersion":1,"position":[608,144]},{"parameters":{"functionCode":"return items[0].json.data.map(wf => ({\n  json: {\n    id: wf.id,\n    name: wf.name,\n    active: wf.active\n  }\n}));"},"id":"8273ddfc-bfde-48e0-8cbe-fe87b350af96","name":"Clean List","type":"n8n-nodes-base.function","typeVersion":1,"position":[704,352]}]', '{"Webhook":{"main":[[{"node":"Routing","type":"main","index":0}]]},"Routing":{"main":[[{"node":"GET by ID","type":"main","index":0},{"node":"GET List","type":"main","index":0}]]},"GET by ID":{"main":[[{"node":"Clean by ID","type":"main","index":0}]]},"GET List":{"main":[[{"node":"Clean List","type":"main","index":0},{"node":"Filter FormTrigger","type":"main","index":0},{"node":"Search by Name","type":"main","index":0}]]}}', '{"executionOrder":"v1"}', NULL, '{}', 'e9f1ef35-a184-4f93-b642-f29e266936ab', 0, NULL, NULL, '2025-08-02T22:44:42.300Z', '2025-08-02T22:58:15.000Z', false),
  ('86f58a9a-d8f1-4c76-8a17-40c1f6e6d6cc', 'PilotPro AI Assistant Complete', false, '[{"parameters":{"httpMethod":"POST","path":"pilotpro-assistant","responseMode":"responseNode","options":{}},"id":"webhook_1","name":"Webhook Trigger","type":"n8n-nodes-base.webhook","typeVersion":2,"position":[0,208],"webhookId":"e16d2023-2b9a-4614-baf9-1b9e727357b3"},{"parameters":{"functionCode":"// Extract and process input data\nconst input = $input.item.json;\n\nconst sessionId = input.sessionId || `session_${Date.now()}`;\nconst message = input.message || input.text || '''';\nconst channel = input.channel || ''web'';\nconst userId = input.userId || input.email || ''anonymous'';\nconst userInfo = input.userInfo || {};\n\nreturn {\n  sessionId,\n  userId,\n  channel,\n  message,\n  userInfo,\n  timestamp: new Date().toISOString(),\n  metadata: {\n    source: ''pilotpro.pro'',\n    version: ''1.0''\n  }\n};"},"id":"function_1","name":"Session Manager","type":"n8n-nodes-base.function","typeVersion":1,"position":[400,400]},{"parameters":{"resource":"chat","operation":"message","requestOptions":{}},"id":"openai_1","name":"AI Chat Model","type":"n8n-nodes-base.openAi","typeVersion":1.1,"position":[624,400],"credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"functionCode":"// Format AI response\nconst aiResponse = $input.item.json.message?.content || $input.item.json.text || ''Mi dispiace, non ho capito. Puoi riformulare?'';\nconst sessionData = $node[\"Session Manager\"].json;\n\nlet formattedResponse = {\n  sessionId: sessionData.sessionId,\n  channel: sessionData.channel,\n  userId: sessionData.userId,\n  timestamp: new Date().toISOString(),\n  response: aiResponse,\n  metadata: sessionData.metadata\n};\n\n// Add quick replies for common actions\nif (aiResponse.toLowerCase().includes(''call'') || \n    aiResponse.toLowerCase().includes(''schedulare'') ||\n    aiResponse.toLowerCase().includes(''demo'')) {\n  formattedResponse.quickReplies = [\n    ''Prenota una call'',\n    ''Maggiori informazioni'',\n    ''Prezzi e pacchetti''\n  ];\n  formattedResponse.cta = {\n    text: ''Prenota Call Gratuita'',\n    url: ''https://calendly.com/pilotpro/demo''\n  };\n}\n\nreturn formattedResponse;"},"id":"function_2","name":"Response Formatter","type":"n8n-nodes-base.function","typeVersion":1,"position":[832,400]},{"parameters":{"conditions":{"string":[{"value1":"={{ $json.channel }}","operation":"equals","value2":"web"}]}},"id":"if_1","name":"Channel Router","type":"n8n-nodes-base.if","typeVersion":1,"position":[1024,352]},{"parameters":{"respondWith":"json","responseBody":"={{ JSON.stringify($json) }}","options":{}},"id":"webhook_response_1","name":"Web Response","type":"n8n-nodes-base.respondToWebhook","typeVersion":1,"position":[1264,256]},{"parameters":{"toRecipients":"={{ $json.userInfo?.email || ''info@pilotpro.pro'' }}","subject":"Re: Richiesta informazioni PilotPro","bodyContent":"={{ $json.response }}\n\n---\nTeam PilotPro\nwww.pilotpro.pro\n\nPer schedulare una call gratuita: https://calendly.com/pilotpro/demo","additionalFields":{}},"id":"outlook_1","name":"Email Response","type":"n8n-nodes-base.microsoftOutlook","typeVersion":2,"position":[1248,512],"webhookId":"1774ea3a-f76f-4eff-8c24-d978468f60aa"},{"parameters":{"functionCode":"// Analytics and Lead Scoring\nconst data = $input.item.json;\nconst message = (data.message || '''').toLowerCase();\n\nlet leadScore = 0;\n\n// Calculate lead score based on keywords\nif (message.includes(''prezz'') || message.includes(''costo'')) leadScore += 30;\nif (message.includes(''demo'')) leadScore += 25;\nif (message.includes(''call'') || message.includes(''parlare'')) leadScore += 20;\nif (message.includes(''quando'') || message.includes(''tempistiche'')) leadScore += 15;\nif (message.includes(''come funziona'')) leadScore += 15;\nif (message.includes(''azienda'') || message.includes(''business'')) leadScore += 10;\n\nconst analytics = {\n  sessionId: data.sessionId,\n  userId: data.userId,\n  channel: data.channel,\n  timestamp: new Date().toISOString(),\n  message: data.message,\n  response: data.response,\n  leadScore: Math.min(leadScore, 100),\n  intent: leadScore > 50 ? ''high_interest'' : leadScore > 20 ? ''medium_interest'' : ''low_interest''\n};\n\n// Log to console for debugging\nconsole.log(''Analytics:'', analytics);\n\nreturn analytics;"},"id":"function_3","name":"Analytics Tracker","type":"n8n-nodes-base.function","typeVersion":1,"position":[1008,608]},{"parameters":{"options":{}},"id":"webhook_2","name":"Email Trigger","type":"n8n-nodes-base.emailReadImap","typeVersion":2,"position":[0,544],"disabled":true},{"parameters":{"updates":{"messageUpdates":["text_message"]},"additionalFields":{}},"id":"telegram_trigger","name":"Telegram Trigger","type":"n8n-nodes-base.telegramTrigger","typeVersion":1,"position":[0,752],"webhookId":"7d7f5382-3eac-40a0-bf1e-de869744ece2","disabled":true},{"parameters":{"options":{}},"id":"whatsapp_trigger","name":"WhatsApp Trigger","type":"n8n-nodes-base.whatsAppTrigger","typeVersion":1,"position":[16,960],"webhookId":"7239afaf-b59a-4baf-840b-96a6fcbc7324","disabled":true},{"parameters":{"functionCode":"// Store conversation in memory\nconst sessionId = $json.sessionId;\nconst message = $json.message;\nconst response = $json.response;\n\n// In production, this would save to a database\n// For now, just pass through\nreturn {\n  stored: true,\n  sessionId,\n  conversationLength: 1,\n  lastMessage: message,\n  lastResponse: response\n};"},"id":"function_4","name":"Memory Storage","type":"n8n-nodes-base.function","typeVersion":1,"position":[1248,688]},{"parameters":{"functionCode":"// Error handler\nconst error = $input.item.json.error || {};\n\nconst errorResponse = {\n  error: true,\n  message: ''Si √® verificato un errore. Il nostro team √® stato notificato.'',\n  fallback: ''Per assistenza immediata: info@pilotpro.pro'',\n  errorDetails: {\n    message: error.message,\n    timestamp: new Date().toISOString()\n  }\n};\n\nconsole.error(''Workflow Error:'', error);\n\nreturn errorResponse;"},"id":"function_5","name":"Error Handler","type":"n8n-nodes-base.function","typeVersion":1,"position":[656,208]},{"parameters":{"chatId":"={{ $json.userInfo?.telegramChatId }}","text":"={{ $json.response }}","additionalFields":{}},"id":"telegram_send","name":"Telegram Response","type":"n8n-nodes-base.telegram","typeVersion":1.1,"position":[1360,864],"webhookId":"b2ba3b7b-0247-4e20-a455-e2203a994abb","disabled":true},{"parameters":{"functionCode":"// Simulate RAG retrieval from Qdrant\n// In production, this would query actual vector database\n\nconst query = $json.message;\n\n// Simulated context retrieval\nconst context = [\n  {\n    content: \"PilotPro offre consulenza specializzata per ottimizzare i processi aziendali con ROI garantito entro 6 mesi.\",\n    score: 0.95\n  },\n  {\n    content: \"I nostri pacchetti partono da ‚Ç¨2.000/mese per piccole imprese fino a soluzioni enterprise personalizzate.\",\n    score: 0.87\n  },\n  {\n    content: \"Offriamo una call gratuita di 30 minuti per analizzare le vostre esigenze specifiche.\",\n    score: 0.82\n  }\n];\n\nreturn {\n  query,\n  context,\n  retrievedAt: new Date().toISOString()\n};"},"id":"function_6","name":"RAG Context Retriever","type":"n8n-nodes-base.function","typeVersion":1,"position":[592,704]}]', '{"Webhook Trigger":{"main":[[{"node":"Session Manager","type":"main","index":0}]]},"Session Manager":{"main":[[{"node":"AI Chat Model","type":"main","index":0},{"node":"RAG Context Retriever","type":"main","index":0}]]},"AI Chat Model":{"main":[[{"node":"Response Formatter","type":"main","index":0}]]},"Response Formatter":{"main":[[{"node":"Channel Router","type":"main","index":0},{"node":"Analytics Tracker","type":"main","index":0}]]},"Channel Router":{"main":[[{"node":"Web Response","type":"main","index":0}],[{"node":"Email Response","type":"main","index":0}]]},"Analytics Tracker":{"main":[[{"node":"Memory Storage","type":"main","index":0}]]},"Email Trigger":{"main":[[{"node":"Session Manager","type":"main","index":0}]]},"Telegram Trigger":{"main":[[{"node":"Session Manager","type":"main","index":0}]]},"WhatsApp Trigger":{"main":[[{"node":"Session Manager","type":"main","index":0}]]}}', '{"executionOrder":"v1","timezone":"Europe/Rome","saveDataErrorExecution":"all","saveDataSuccessExecution":"all","saveManualExecutions":true,"saveExecutionProgress":true,"executionTimeout":300}', NULL, '{}', 'dd8c46db-0a24-471f-9489-15a2e97b140e', 0, NULL, NULL, '2025-08-09T22:12:54.160Z', '2025-08-09T23:11:12.000Z', true),
  ('7c86da29-5815-43d9-be9a-a78853ed2581', 'PilotPro Customer Service Agent - RAG & Ranking', false, '[{"parameters":{"options":{}},"id":"1","name":"Chat Trigger","type":"@n8n/n8n-nodes-langchain.chatTrigger","typeVersion":1.1,"position":[256,160],"webhookId":"30b7828c-c308-4983-8ac7-95208ada9792"},{"parameters":{"options":{"systemMessage":"Sei l''assistente AI di PilotPro, un sistema avanzato di supporto clienti.\n\nIL TUO RUOLO:\n- Fornire informazioni dettagliate sulle funzionalit√† di PilotPro\n- Rispondere a domande tecniche utilizzando la knowledge base RAG\n- Schedulare call con esperti quando richiesto\n- Guidare i clienti nell''uso ottimale del prodotto\n\nPROCESSO DI SUPPORTO:\n1. Analizza la richiesta del cliente\n2. Cerca nella knowledge base usando RAG\n3. Riordina i risultati per rilevanza\n4. Fornisci risposte precise e contestuali\n5. Se necessario, proponi scheduling di una call con un esperto\n\nFUNZIONALIT√Ä PRINCIPALI DI PILOTPRO:\n- Dashboard analytics avanzata\n- Automazione workflow intelligente\n- Integrazione con sistemi enterprise\n- Machine learning predittivo\n- Reporting customizzabile\n- API REST completa\n- Security enterprise-grade\n- Support multi-tenant\n\nQUANDO SCHEDULARE UNA CALL:\n- Il cliente richiede demo personalizzata\n- Questioni tecniche complesse non risolvibili via chat\n- Richieste di integrazione custom\n- Discussioni commerciali o licensing\n- Onboarding enterprise\n\nTONO: Professionale, amichevole, proattivo\nLINGUA: Italiano\nOBIETTIVO: Massima soddisfazione cliente con risposte precise e tempestive","maxIterations":10,"returnIntermediateSteps":true}},"id":"2","name":"AI Agent","type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.2,"position":[640,160]},{"parameters":{"sessionKey":"={{ $json.chatId }}","contextWindowLength":10},"id":"3","name":"Window Buffer Memory","type":"@n8n/n8n-nodes-langchain.memoryBufferWindow","typeVersion":1,"position":[608,384]},{"parameters":{"model":"gpt-4o","options":{"frequencyPenalty":0.2,"maxTokens":2000,"temperature":0.7,"topP":0.9}},"id":"4","name":"OpenAI Chat Model","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1,"position":[480,384]},{"parameters":{"topK":10},"id":"5","name":"PilotPro Knowledge Base","type":"@n8n/n8n-nodes-langchain.toolVectorStore","typeVersion":1,"position":[736,384]},{"parameters":{"pineconeIndex":{"value":"pilotpro-docs","mode":"list"},"options":{"pineconeNamespace":"product-documentation"}},"id":"6","name":"Pinecone Vector Store","type":"@n8n/n8n-nodes-langchain.vectorStorePinecone","typeVersion":1.3,"position":[840,800]},{"parameters":{"modelName":"rerank-multilingual-v3.0"},"id":"7","name":"Cohere Reranker","type":"@n8n/n8n-nodes-langchain.rerankerCohere","typeVersion":1,"position":[712,800]},{"parameters":{"topK":8},"id":"8","name":"Vector Store Retriever","type":"@n8n/n8n-nodes-langchain.retrieverVectorStore","typeVersion":1,"position":[736,592]},{"parameters":{"workflowId":{"value":"calendar-booking-workflow","mode":"list"}},"id":"9","name":"Schedule Expert Call","type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":1,"position":[1024,384]},{"parameters":{"model":"text-embedding-3-small","options":{"dimensions":1536}},"id":"10","name":"OpenAI Embeddings","type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1,"position":[920,1008]}]', '{"Chat Trigger":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"AI Agent":{"main":[[]]},"Window Buffer Memory":{"main":[[]],"ai_memory":[[{"node":"AI Agent","type":"ai_memory","index":0}]]},"OpenAI Chat Model":{"main":[[]],"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"PilotPro Knowledge Base":{"main":[[]],"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"Vector Store Retriever":{"main":[[]],"ai_retriever":[[{"node":"PilotPro Knowledge Base","type":"ai_retriever","index":0}]]},"Pinecone Vector Store":{"main":[[]],"ai_vectorStore":[[{"node":"Vector Store Retriever","type":"ai_vectorStore","index":0}]]},"Cohere Reranker":{"main":[[]],"ai_reranker":[[{"node":"Vector Store Retriever","type":"ai_reranker","index":0}]]},"OpenAI Embeddings":{"main":[[]],"ai_embedding":[[{"node":"Pinecone Vector Store","type":"ai_embedding","index":0}]]},"Schedule Expert Call":{"main":[[]],"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]}}', '{"executionOrder":"v1","timezone":"Europe/Rome","saveDataSuccessExecution":"all","saveManualExecutions":true,"saveExecutionProgress":true}', NULL, '{}', '186652a1-81f3-4193-ad88-aa44287d96b4', 0, NULL, NULL, '2025-08-10T15:11:47.148Z', '2025-08-11T11:44:48.000Z', true),
  ('059a7b37-ad2b-43ef-b714-aa21be776639', 'Test Workflow from API 2', false, '[{"parameters":{},"name":"Start","type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[250,300],"id":"d024a022-17ab-4a2b-b800-72d7952d0335"}]', '{}', '{}', NULL, NULL, 'b2667084-eee8-441a-9c56-5054581bb8aa', 0, NULL, NULL, '2025-08-10T21:12:17.064Z', '2025-08-11T11:44:41.000Z', true),
  ('7fe83e12-d023-450c-a7a8-2d84a6d90d73', 'Connection Test 1754860606.153908', false, '[{"parameters":{},"name":"Start","type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[250,300],"id":"f3605666-e00f-4198-b4d9-49467d467a5e"}]', '{}', '{}', NULL, NULL, 'ac5b8f74-0aa7-44a5-bb7e-21a2ba7e15c6', 0, NULL, NULL, '2025-08-10T21:16:46.368Z', '2025-08-11T11:44:34.000Z', true),
  ('51f7f389-1e3f-4c7f-9618-77d85b3e73cc', 'Connection Test 1754860663.530084', false, '[{"parameters":{},"name":"Start","type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[250,300],"id":"e9fb09f7-d2eb-4138-8dd6-bce687834b08"}]', '{}', '{}', NULL, NULL, '11d3fa54-7571-447a-825c-f0609e537a38', 0, NULL, NULL, '2025-08-10T21:17:43.743Z', '2025-08-11T11:44:32.000Z', true),
  ('0e3464f9-ce2a-4cf2-968e-f20eec3f18c7', 'Connection Test 1754860714.225182', false, '[{"parameters":{},"name":"Start","type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[250,300],"id":"c2e25dae-366f-4e1c-a91b-aa2a1ad70b3d"}]', '{}', '{}', NULL, NULL, '88b5aa2f-b26e-4b9f-8b9f-fca6e719e3f0', 0, NULL, NULL, '2025-08-10T21:18:34.445Z', '2025-08-11T11:44:30.000Z', true),
  ('7c9c8784-2a93-497b-b7e2-c4aea0b45ce6', 'Connection Test 1754860804.366895', false, '[{"parameters":{},"name":"Start","type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[250,300],"id":"25b3f502-90a9-4726-896a-0f1ff8d28442"}]', '{}', '{}', NULL, NULL, '9dd7f5a0-db6b-4eb8-be32-533e089b6c49', 0, NULL, NULL, '2025-08-10T21:20:04.598Z', '2025-08-11T11:44:28.000Z', true),
  ('4c0b555e-4b06-42c5-901d-e21c332c3492', 'Connection Test 1754860851.929906', false, '[{"parameters":{},"name":"Start","type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[250,300],"id":"e7a1d528-5f43-450d-b77e-23c8e57005fb"}]', '{}', '{}', NULL, NULL, '8e79b7bb-f59b-44b2-ba87-6c5e39ff1b65', 0, NULL, NULL, '2025-08-10T21:20:52.167Z', '2025-08-11T11:44:26.000Z', true),
  ('872e4ff4-2b01-488f-9fe8-3ca0baa05ce8', 'Connection Test 1754860868.205483', false, '[{"parameters":{},"name":"Start","type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[250,300],"id":"f9671a2a-895a-4780-b1e8-e670e7d0614c"}]', '{}', '{}', NULL, NULL, '4357f64a-efa8-43cf-a920-88ee7fc15a43', 0, NULL, NULL, '2025-08-10T21:21:08.425Z', '2025-08-11T11:44:24.000Z', true),
  ('2700bd55-a869-48a8-80dc-3b712793ce0b', 'Connection Test 1754860868.409973', false, '[{"parameters":{},"name":"Start","type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[250,300],"id":"b2a7d88e-66e8-426c-ae30-aa705ac0dd5b"}]', '{}', '{}', NULL, NULL, '456c6700-d083-4513-a090-a76346b20a99', 0, NULL, NULL, '2025-08-10T21:21:08.612Z', '2025-08-11T11:44:22.000Z', true),
  ('6a78851e-1c82-4fac-9da2-ee6a473e52c2', 'Receive updates when a new account is added by an admin in ActiveCampaign - IMPORTED TEST', false, '[{"name":"ActiveCampaign Trigger","type":"n8n-nodes-base.activeCampaignTrigger","position":[700,250],"parameters":{"events":["account_add"],"sources":["admin"]},"typeVersion":1,"id":"d025fcf5-4d85-4724-a984-3e5a41b087b6"}]', '{}', '{}', NULL, NULL, '17c9a94a-b264-44a5-ad27-d73faf1fe8c7', 0, NULL, NULL, '2025-08-10T21:24:06.601Z', '2025-08-11T11:44:19.000Z', true),
  ('a7b58ba7-e662-4e98-b7d9-45ce3d991502', 'Human in the Shit', false, '[]', '{}', '{"executionOrder":"v1"}', NULL, '{}', '6455fcf6-5f62-403c-a340-997750552cc0', 0, '{"templateCredsSetupCompleted":true}', NULL, '2025-08-14T15:16:06.313Z', '2025-08-14T16:01:59.000Z', true),
  ('5e035f98-c7bb-4bc7-b4c4-e0537df15319', 'TRY Backend', false, '[{"parameters":{"options":{"temperature":0}},"id":"bb5e78e2-ced2-4727-8596-afe7c32ce96a","name":"OpenAI Chat Model1","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","position":[960,240],"typeVersion":1},{"parameters":{"url":"https://meet.googleapis.com/v2/conferenceRecords","authentication":"predefinedCredentialType","nodeCredentialType":"googleOAuth2Api","sendQuery":true,"queryParameters":{"parameters":[{"name":"filter","value":"=space.meeting_code={{ $json.conferenceData.conferenceId }}"}]},"options":{}},"id":"a5f3ccd5-dbc1-4d8f-8a46-df425bbc74cd","name":"Get Meeting ConferenceRecords","type":"n8n-nodes-base.httpRequest","position":[192,160],"typeVersion":4.2},{"parameters":{"url":"=https://meet.googleapis.com/v2/{{ $json.conferenceRecords[0].name }}/transcripts","authentication":"predefinedCredentialType","nodeCredentialType":"googleOAuth2Api","options":{}},"id":"de25f27e-6f72-4bb7-be09-55d6745aa99d","name":"Get Meeting Transcript Location","type":"n8n-nodes-base.httpRequest","position":[368,160],"typeVersion":4.2,"notes":"show-2"},{"parameters":{"operation":"download","fileId":{"__rl":true,"mode":"url","value":"={{ $json.docsDestination.document }}"},"options":{"googleFileConversion":{"conversion":{"docsToFormat":"application/pdf"}}}},"id":"682ea050-db93-447b-9fa2-2b214847dc74","name":"Get Transcript File","type":"n8n-nodes-base.googleDrive","position":[544,160],"typeVersion":3},{"parameters":{},"id":"6cbf9883-512d-4aed-92f6-655051e8885c","name":"When clicking \"Test workflow\"","type":"n8n-nodes-base.manualTrigger","position":[-320,112],"typeVersion":1},{"parameters":{"operation":"pdf","options":{}},"id":"1ed6c5e1-2c57-4315-856e-7c2e22fe3f25","name":"PDF Loader","type":"n8n-nodes-base.extractFromFile","position":[832,96],"typeVersion":1},{"parameters":{"operation":"get","calendar":{"__rl":true,"mode":"list","value":"c_5792bdf04bc395cbcbc6f7b754268245a33779d36640cc80a357711aa2f09a0a@group.calendar.google.com","cachedResultName":"n8n-events"},"eventId":"abc123","options":{}},"id":"64ca52d8-d2d8-49d9-8029-6e5049d9dc4e","name":"Get Calendar Event","type":"n8n-nodes-base.googleCalendar","position":[-128,112],"typeVersion":1.1,"notes":"show-1"},{"parameters":{"jsonSchema":"{\n \"type\": \"object\",\n \"properties\": {\n \"summary\": { \"type\": \"string\" },\n \"highlights\": {\n \"type\": \"array\",\n \"items\": {\n \"type\": \"object\",\n \"properties\": {\n \"attendee\": { \"type\": \"string\" },\n \"message\": { \"type\": \"string\" }\n }\n }\n },\n \"next_steps\": {\n \"type\": \"array\",\n \"items:\": {\n \"type\": \"string\"\n }\n },\n \"meetings_created\": {\n \"type\": \"array\",\n \"items\": {\n \"type\": \"object\",\n \"properties\": {\n \"event_title\": { \"type\": \"string\" },\n \"event_invite_url\": { \"type\" : \"string\" }\n }\n }\n }\n }\n}"},"id":"c412e82f-b846-4ddb-9af6-619719a30a87","name":"Structured Output Parser","type":"@n8n/n8n-nodes-langchain.outputParserStructured","position":[1200,240],"typeVersion":1.1},{"parameters":{},"id":"21e2c944-be7c-4788-a148-07c7ba8ce20a","name":"Execute Workflow Trigger","type":"n8n-nodes-base.executeWorkflowTrigger","position":[800,784],"typeVersion":1},{"parameters":{"assignments":{"assignments":[{"id":"3c12dc11-0ff3-4c6a-9d67-1454d7b0d16d","name":"response","type":"string","value":"={{ JSON.stringify($(''Create Calendar Event1'').item.json) }}"}]},"options":{}},"id":"d7be306f-39c1-4141-a39f-3def826577f7","name":"Response","type":"n8n-nodes-base.set","position":[1952,656],"typeVersion":3.3},{"parameters":{"assignments":{"assignments":[{"id":"7263764b-8409-4cea-8db3-3278dd7ef9d8","name":"=route","type":"string","value":"={{ $json.route }}"},{"id":"55c3b207-2e98-4137-8413-f72cbff17986","name":"query","type":"object","value":"={{ $json.query.parseJson() }}"}]},"options":{}},"id":"7f59a98c-f153-4936-9761-264e3d85343e","name":"Edit Fields","type":"n8n-nodes-base.set","position":[960,784],"typeVersion":3.3},{"parameters":{"mode":"raw","jsonOutput":"{\n \"response\": {\n \"ok\": false,\n \"error\": \"The requested tool was not found or the service may be unavailable. Do not retry.\"\n }\n}\n","options":{}},"id":"545280a2-4d4c-4401-bdf7-2abc199bf9ad","name":"Fallback Response","type":"n8n-nodes-base.set","position":[1408,1072],"typeVersion":3.3,"notes":"show-4"},{"parameters":{"rules":{"values":[{"conditions":{"options":{"leftValue":"","caseSensitive":true,"typeValidation":"strict"},"combinator":"and","conditions":[{"operator":{"type":"string","operation":"equals"},"leftValue":"={{ $json.route }}","rightValue":"meetings.create"}]},"renameOutput":true,"outputKey":"meetings.create"}]},"options":{"fallbackOutput":"extra"}},"id":"5cdac36b-b30a-454f-876e-0cbdda239c43","name":"Actions Router","type":"n8n-nodes-base.switch","position":[1152,784],"typeVersion":3},{"parameters":{"assignments":{"assignments":[{"id":"521823f4-cee1-4f69-82e7-cea9be0dbc41","name":"attendees","type":"array","value":"={{ $(''Actions Router'').item.json.query.attendees }}"}]},"options":{}},"id":"b4be7969-7209-4bd8-b217-98f1acd0760b","name":"Get Attendees","type":"n8n-nodes-base.set","position":[1600,656],"typeVersion":3.3},{"parameters":{"fieldToSplitOut":"attendees","options":{}},"id":"2e6dd0ef-8c3a-4afc-ac4d-94a57429e99a","name":"Attendees List","type":"n8n-nodes-base.splitOut","position":[1616,784],"typeVersion":1},{"parameters":{"operation":"update","calendar":{"__rl":true,"mode":"list","value":"c_5792bdf04bc395cbcbc6f7b754268245a33779d36640cc80a357711aa2f09a0a@group.calendar.google.com","cachedResultName":"n8n-events"},"eventId":"={{ $(''Create Calendar Event1'').item.json.id }}","updateFields":{"attendees":["={{ $json.name }} <{{ $json.email }}>"]}},"id":"ac867fd4-3a0c-475a-aef9-04837b185424","name":"Add Attendee to Invite","type":"n8n-nodes-base.googleCalendar","position":[1792,656],"typeVersion":1.1},{"parameters":{"content":"## 4. This Tool Creates Calendar Events\nThis tool, given event details and a list of attendees, will create a new Google calendar event and add the attendees to it.","height":445.79624302689535,"width":756.2929032891963,"color":7},"id":"407636d2-5c96-4539-b5d1-cb6cf888394a","name":"Sticky Note","type":"n8n-nodes-base.stickyNote","position":[1344,512],"typeVersion":1},{"parameters":{"content":"## 1. Retrieve Meeting Transcript\n[Read more about working with HTTP node](https://docs.n8n.io/integrations/builtin/core-nodes/n8n-nodes-base.httprequest)\n\nThere''s no built-in support for Google Meets transcript API however, we can solve this problem with the HTTP node. Note you may also need to setup a separate Google OAuth API Credential to obtain the required scopes.","height":405.6964113279832,"width":586.8663941671947,"color":7},"id":"88a1f3e1-e447-47f8-b580-0917cf22732f","name":"Sticky Note2","type":"n8n-nodes-base.stickyNote","position":[112,-48],"typeVersion":1},{"parameters":{"content":"## 2. Let AI Agent Carry Out Follow-Up Actions\n[Read more about working with AI Agents](https://docs.n8n.io/integrations/builtin/cluster-nodes/root-nodes/n8n-nodes-langchain.agent)\n\nThe big difference between Basic LLM chains and AI Agents is that AI agents are given the automony to perform actions. Provided the right tool exists, AI Agents can send emails, book flights and even order pizza! Here we''re leaving it up to our agent to book any follow-up meetings after the call and invite all interested parties.","height":588.2833041602365,"width":681.4281346810014,"color":7},"id":"0edfbfb8-0dab-4a81-bb50-995b14236826","name":"Sticky Note3","type":"n8n-nodes-base.stickyNote","position":[720,-112],"typeVersion":1},{"parameters":{"content":"## 3: Using the Custom Workflow Tool\n[Read more about Workflow Triggers](https://docs.n8n.io/integrations/builtin/core-nodes/n8n-nodes-base.executeworkflowtrigger)\n\nOne common implementation of tool use is to set them up as workflows which are intended triggered via other workflows. With this, we can either build a tool per workflow or for efficiency, take an API approach where multiple tools can exist behind a router (in this case our \"switch\" node).\n\nOur AI agent will therefore only passing through the parameters of the request and won''t have to learn/know how to intereact directly with the tools and services.","height":579.2725119898125,"width":591.4907024073684,"color":7},"id":"30789cb0-230e-4b66-a71c-ca6fc5bd418a","name":"Sticky Note4","type":"n8n-nodes-base.stickyNote","position":[720,512],"typeVersion":1},{"parameters":{"calendar":{"__rl":true,"mode":"list","value":"c_5792bdf04bc395cbcbc6f7b754268245a33779d36640cc80a357711aa2f09a0a@group.calendar.google.com","cachedResultName":"n8n-events"},"start":"={{ $json.query.start_date }} {{ $json.query.start_time }}","end":"={{ $json.query.end_date }} {{ $json.query.end_time }}","additionalFields":{"attendees":[],"description":"={{ $json.query.description }}","summary":"={{ $json.query.title }}"}},"id":"91c4f0c3-de93-4728-9e63-2b1d6db5eb73","name":"Create Calendar Event1","type":"n8n-nodes-base.googleCalendar","position":[1408,656],"typeVersion":1.1},{"parameters":{"content":"## Try It Out!\n### This workflow does the following:\n* Retrieves a meeting transcript\n* Sends transcript to an AI Agent to parse and carry out follow up actions if necessary.\n* If transcript mentions a follow up meeting is required, the AI Agent will call a tool to create the meeting.\n* Additionally if able, the AI Agent will also assign attendees it thinks should attend the meeting. \n\n### Need Help?\nJoin the [Discord](https://discord.com/invite/XPKeKXeB7d) or ask in the [Forum](https://community.n8n.io/)!\n\nHappy Hacking!","height":385.336571355038,"width":359.6648027457353},"id":"85facc8c-1626-4c4c-8ba9-accd23dd094a","name":"Sticky Note6","type":"n8n-nodes-base.stickyNote","position":[-784,-112],"typeVersion":1},{"parameters":{"name":"create_calendar_event","description":"Call this tool to create an calendar event. This tool requires the following object request body.\n```\n{\n \"type\": \"object\",\n \"properties\": {\n \"title\": { \"type\": \"string\" },\n \"description\": { \"type\": \"string\" },\n \"start_date\": { \"type\": \"string\" },\n \"start_time\": { \"type\": \"string\" },\n \"end_date\": { \"type\": \"string\" },\n \"end_time\": { \"type\": \"string\" },\n \"attendees\": {\n \"type\": \"array\",\n \"items\": {\n \"type\": \"object\",\n \"properties\": {\n \"name\": { \"type\": \"string\" },\n \"email\": { \"type\": \"string\" }\n }\n }\n }\n }\n}\n```\nNote that dates are in the format yyyy-MM-dd and times are in the format HH:mm:ss.","workflowId":"={{ $workflow.id }}","fields":{"values":[{"name":"route","stringValue":"meetings.create"}]}},"id":"6e97d1cc-04af-49d4-9f9f-de046ee935ac","name":"Schedule Meeting","type":"@n8n/n8n-nodes-langchain.toolWorkflow","position":[1088,320],"typeVersion":1.1},{"parameters":{"agent":"openAiFunctionsAgent","promptType":"define","text":"=system: your role is to help people get the most out of their meetings. You achieve this by helpfully summarising the meeting transcript to pull out useful information and key points of interest and delivery this in note form. You also help carry out any follow-up actions on behalf of the meeting attendees.\n1. Summarise the meeting and highlight any key goals of the meeting.\n2. Identify and list important points mentioned by each attendee. If non-applicable for an attendee, skip and proceed to the next attendee.\n3. Identify and list all next steps agreed by the attendees. If there are none, make a maximum of 3 suggestions based on the transcript instead. Please list the steps even if they''ve already been actioned.\n4. identify and perform follow-up actions based on a transcript of a meeting. These actions which are allowed are: creating follow-up calendar events if suggested by the attendees.\n\nThe meeting details were as follows:\n* The creator of the meeting was {{ $(''Get Calendar Event'').item.json[\"creator\"][\"displayName\"] }} <{{ $(''Get Calendar Event'').item.json[\"creator\"][\"email\"]}}>\n* The attendees were {{ $(''Get Calendar Event'').item.json[\"attendees\"].map(attendee => `${attendee.display_name} <${attendee.email}>`).join('', '') }}\n* The meeting was scheduled for {{ $(''Get Calendar Event'').item.json[\"start\"][\"dateTime\"] }}\n\nThe meeting transcript as follows:\n```\n{{ $json[\"text\"] }}\n```","hasOutputParser":true,"options":{}},"id":"bc74eeb7-cc08-4891-af12-5e7abcc151d5","name":"AI Agent","type":"@n8n/n8n-nodes-langchain.agent","position":[992,96],"typeVersion":1.5,"notes":"show-3"},{"parameters":{"content":"## 1. Get Calendar Event\n[Read more about working with Google Calendar](https://docs.n8n.io/integrations/builtin/app-nodes/n8n-nodes-base.googlecalendar)\n\nIn this demo, we''ve decided to go with google meet as transcripts are stored in the user google drive. First, we''ll need to get the calendar event of which the google meet was attached.\nIf the meet was not arranged through Google calendar, you may need to skip this step and just reference the transcripts in google drive directly.","height":446.9122178333584,"width":464.50696860436165,"color":7},"id":"cf2a2d86-bb2b-4501-85bb-680851e65215","name":"Sticky Note5","type":"n8n-nodes-base.stickyNote","position":[-400,-128],"typeVersion":1},{"parameters":{"content":"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nüö®**Required**\n* Set your calendar event ID here.","height":299.3566512487305,"width":184.0677386144551},"id":"c7ebe3ae-bb33-4c69-a442-b71a2b48578d","name":"Sticky Note1","type":"n8n-nodes-base.stickyNote","position":[-160,96],"typeVersion":1},{"parameters":{"content":"### üí° Can''t find your transcript?\nOnly meetings which own and were recorded and had transcription enabled will be available.\n","height":80,"width":349.91944442094535,"color":5},"id":"92d3294f-2614-40d7-a54a-40b95a5425cb","name":"Sticky Note7","type":"n8n-nodes-base.stickyNote","position":[352,400],"typeVersion":1},{"parameters":{"content":"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nüö®**Required**\n* Set your calendar ID here.","height":299.3566512487305,"width":184.0677386144551},"id":"d3b00c8a-c431-4384-8cdb-1ce61f171056","name":"Sticky Note8","type":"n8n-nodes-base.stickyNote","position":[1360,640],"typeVersion":1}]', '{"PDF Loader":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"Edit Fields":{"main":[[{"node":"Actions Router","type":"main","index":0}]]},"Get Attendees":{"main":[[{"node":"Attendees List","type":"main","index":0}]]},"Actions Router":{"main":[[{"node":"Create Calendar Event1","type":"main","index":0}],[{"node":"Fallback Response","type":"main","index":0}]]},"Attendees List":{"main":[[{"node":"Add Attendee to Invite","type":"main","index":0}]]},"Schedule Meeting":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"Get Calendar Event":{"main":[[{"node":"Get Meeting ConferenceRecords","type":"main","index":0}]]},"OpenAI Chat Model1":{"ai_languageModel":[[{"node":"AI Agent","type":"ai_languageModel","index":0}]]},"Get Transcript File":{"main":[[{"node":"PDF Loader","type":"main","index":0}]]},"Add Attendee to Invite":{"main":[[{"node":"Response","type":"main","index":0}]]},"Create Calendar Event1":{"main":[[{"node":"Get Attendees","type":"main","index":0}]]},"Execute Workflow Trigger":{"main":[[{"node":"Edit Fields","type":"main","index":0}]]},"Structured Output Parser":{"ai_outputParser":[[{"node":"AI Agent","type":"ai_outputParser","index":0}]]},"Get Meeting ConferenceRecords":{"main":[[{"node":"Get Meeting Transcript Location","type":"main","index":0}]]},"When clicking \"Test workflow\"":{"main":[[{"node":"Get Calendar Event","type":"main","index":0}]]},"Get Meeting Transcript Location":{"main":[[{"node":"Get Transcript File","type":"main","index":0}]]}}', '{"executionOrder":"v1"}', NULL, '{}', 'b3043559-efb2-4c7b-a1ad-b781e75ff1a8', 0, NULL, NULL, '2025-08-14T16:02:57.684Z', '2025-08-14T20:13:46.000Z', false),
  ('05dd6bf9-7748-47db-b163-85247f2ab443', 'BULLSHIT', false, '[{"parameters":{},"type":"n8n-nodes-base.manualTrigger","typeVersion":1,"position":[-256,-80],"id":"1c9572be-1b25-4106-bd89-4018732f1405","name":"When clicking ‚ÄòExecute workflow‚Äô"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.chatTrigger","typeVersion":1.3,"position":[-352,-208],"id":"627bd589-82c9-4ee3-b552-74dcc943e08e","name":"When chat message received","webhookId":"e13de45d-eec0-4f3e-9914-73f41e9ba322"},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.agent","typeVersion":2.2,"position":[-48,-128],"id":"b6d17fbb-23c5-4f85-ba9c-cb5356eaeb62","name":"AI Agent"},{"parameters":{"mode":"retrieve-as-tool","qdrantCollection":{"__rl":true,"mode":"list","value":""},"options":{}},"type":"@n8n/n8n-nodes-langchain.vectorStoreQdrant","typeVersion":1.3,"position":[112,64],"id":"1c27fae0-08bf-43fa-b5f6-2a4dbcc28e61","name":"Qdrant Vector Store","credentials":{"qdrantApi":{"id":"VEHIg9nC5Y5VeHPX","name":"QdrantApi account"}}},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1.2,"position":[208,272],"id":"3a1ef6c0-ead1-48ce-8bbc-09adc35bd9a0","name":"Embeddings OpenAI","credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"mode":"retrieve-as-tool","qdrantCollection":{"__rl":true,"mode":"list","value":""},"options":{}},"type":"@n8n/n8n-nodes-langchain.vectorStoreQdrant","typeVersion":1.3,"position":[240,-192],"id":"405722ed-d144-481b-8f57-02cecc94558c","name":"Qdrant Vector Store1","credentials":{"qdrantApi":{"id":"VEHIg9nC5Y5VeHPX","name":"QdrantApi account"}}}]', '{"When clicking ‚ÄòExecute workflow‚Äô":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"When chat message received":{"main":[[{"node":"AI Agent","type":"main","index":0}]]},"Qdrant Vector Store":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]},"Embeddings OpenAI":{"ai_embedding":[[{"node":"Qdrant Vector Store","type":"ai_embedding","index":0}]]},"Qdrant Vector Store1":{"ai_tool":[[{"node":"AI Agent","type":"ai_tool","index":0}]]}}', '{"executionOrder":"v1"}', NULL, '{}', '024033e8-01e3-4ff5-9feb-d5b247d117d2', 0, '{"templateCredsSetupCompleted":true}', NULL, '2025-08-14T16:50:35.047Z', '2025-08-29T16:28:06.000Z', false),
  ('3609c61d-0960-4015-be46-258f25197488', 'My workflow 10', false, '[{"parameters":{"postProcessAction":"nothing","format":"resolved","dataPropertyAttachmentsPrefixName":"attachment","options":{}},"id":"9039649c-8138-472e-994d-8bdfa620ae9d","name":"Email trigger","type":"n8n-nodes-base.emailReadImap","position":[144,-240],"typeVersion":2},{"parameters":{"content":"### Change or add any category you want\nEach category can be assigned it''s own specific workflow","height":200},"id":"b413f8c2-b971-4100-9efe-24bfe08b6593","name":"Sticky Note","type":"n8n-nodes-base.stickyNote","position":[-368,-192],"typeVersion":1},{"parameters":{"inputText":"={{ $(''Email trigger'').first().json.text }}\n\nattachment:\n{{ $(''Extract data from attachment'').first().json.text }}\n","categories":{"categories":[{"category":"job_application","description":"for job applications"},{"category":"inbound_lead","description":"for sales inquiries or requests for more information about our products/services"},{"category":"invoice","description":"for invoices"},{"category":"other","description":"for all other sorts of emails"}]},"options":{}},"id":"09ab16e6-0dbb-4d6f-98d9-fa8c9f3cdb47","name":"Classify email","type":"@n8n/n8n-nodes-langchain.textClassifier","position":[-128,160],"typeVersion":1},{"parameters":{"text":"={{ $(''Email trigger'').first().json.text }}\n\nResume:\n{{ $(''Extract data from attachment'').first().json.text }}\n","attributes":{"attributes":[{"name":"first_name","description":"first name of the applicant"},{"name":"last_name","description":"last name of the applicant"},{"name":"age","description":"age of the applicant"},{"name":"residence","description":"residence of the applicant"},{"name":"study","description":"relevant completed study of the applicant"},{"name":"work_experience","description":"relevant work experience of the applicant"},{"name":"personal_character","description":"personal characteristics of the applicant"}]},"options":{}},"id":"3800b91b-bdaf-4a92-b88e-95900183abea","name":"Extract variables - email & attachment","type":"@n8n/n8n-nodes-langchain.informationExtractor","position":[464,96],"typeVersion":1},{"parameters":{"operation":"pdf","binaryPropertyName":"attachment0","options":{}},"id":"ada38d81-fd56-40c3-9c7b-d31f5ce08c8f","name":"Extract data from attachment","type":"n8n-nodes-base.extractFromFile","position":[-96,-240],"typeVersion":1,"alwaysOutputData":false,"onError":"continueRegularOutput"},{"parameters":{"model":"gpt-4o","options":{}},"id":"3e856015-171f-45e9-8da8-5fd4c52d065f","name":"OpenAI Chat Model 2","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","position":[448,-336],"typeVersion":1},{"parameters":{"model":"gpt-4o","options":{}},"id":"f7ad41a1-e36b-4ac6-b5c9-58783e3e56f7","name":"OpenAI Chat Model","type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","position":[352,-304],"typeVersion":1,"credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"pollTimes":{"item":[{"mode":"everyMinute"}]},"output":"fields","fields":["sender","replyTo","sentDateTime","subject","body","categories","ccRecipients"],"filters":{"custom":"isRead eq false","foldersToInclude":["AAMkADRmMTYxODRmLWJmZjYtNDQ4Ny1hZGE0LWQzYjNhZjJkZDQyMgAuAAAAAAAbCa7Kx9UPS7NhabBhamKLAQABIvZjidpvQo_FOUmjs9ACAAAAAAEMAAA="]},"options":{"downloadAttachments":false}},"type":"n8n-nodes-base.microsoftOutlookTrigger","typeVersion":1,"position":[-368,208],"id":"7110ac2d-0b14-41e2-9ee7-706e189f07d4","name":"Ricezione Mail","credentials":{"microsoftOutlookOAuth2Api":{"id":"EySZIVRGzocRrEOf","name":"Outlook Info GommeGo"}},"notes":"show-1"},{"parameters":{"modelName":"models/gemini-1.5-pro-latest","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatGoogleGemini","typeVersion":1,"position":[-176,432],"id":"509a120b-6d92-4c4e-aa44-7357a3aecd94","name":"Google Gemini Chat Model","credentials":{"googlePalmApi":{"id":"owVOESxC0E1TNLDF","name":"Google Gemini(PaLM) GommeGo"}}},{"parameters":{"modelName":"models/gemini-1.5-pro-latest","options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatGoogleGemini","typeVersion":1,"position":[544,272],"id":"d960bde0-c548-459e-aecf-a0d1ea7aaa4d","name":"Google Gemini Chat Model1","credentials":{"googlePalmApi":{"id":"owVOESxC0E1TNLDF","name":"Google Gemini(PaLM) GommeGo"}}}]', '{"Email trigger":{"main":[[]]},"Classify email":{"main":[[{"node":"Extract variables - email & attachment","type":"main","index":0}],[],[],[]]},"OpenAI Chat Model":{"ai_languageModel":[[]]},"OpenAI Chat Model 2":{"ai_languageModel":[[]]},"Extract data from attachment":{"main":[[]]},"Ricezione Mail":{"main":[[{"node":"Classify email","type":"main","index":0}]]},"Google Gemini Chat Model":{"ai_languageModel":[[{"node":"Classify email","type":"ai_languageModel","index":0}]]},"Google Gemini Chat Model1":{"ai_languageModel":[[{"node":"Extract variables - email & attachment","type":"ai_languageModel","index":0}]]}}', '{"executionOrder":"v1"}', NULL, '{}', 'b1bfaa52-f2f1-4db9-844e-9117ec3a8ebe', 0, NULL, NULL, '2025-09-17T08:50:24.408Z', '2025-09-17T08:53:41.000Z', false),
  ('5450ee9c-5adc-4611-8aed-361281153837', 'My workflow 11', false, '[{"parameters":{"public":true,"initialMessages":"Salveüëã\nIl mio nome √® Milena come posso aiutarla oggi?","options":{}},"id":"c24a562b-349b-4cbb-8d62-373c75670f55","name":"When chat message received","type":"@n8n/n8n-nodes-langchain.chatTrigger","typeVersion":1.1,"position":[-688,32],"webhookId":"1c5b0a8e-ba10-4c2a-9d75-35f49b71521f"},{"parameters":{"assignments":{"assignments":[{"id":"0b0b9a1b-c761-4f68-8911-549f2cde7835","name":"sessionId","value":"={{ $json.sessionId }}","type":"string"},{"id":"c1f0c5f4-c254-4a35-a42d-23a98cc86cf7","name":"chatInput","value":"={{ $json.chatInput }}","type":"string"}]},"options":{}},"type":"n8n-nodes-base.set","typeVersion":3.4,"position":[-464,32],"id":"051ce81b-86b8-47d3-941d-cc1df6c51a72","name":"Chat ID persisente"},{"parameters":{"model":{"__rl":true,"value":"gpt-4.1-mini-2025-04-14","mode":"list","cachedResultName":"gpt-4.1-mini-2025-04-14"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[208,496],"id":"3ed08bc1-d0e3-43ab-acfa-a4ab5e871417","name":"OpenAI Chat Model1","credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"description":"**KNOWLEDGE BASE UFFICIALE GOMMEGO - CONSULTAZIONE OBBLIGATORIA**\n\nQuesto nodo contiene l''intero database di conoscenza aziendale GommeGo: FAQ ufficiali, procedure operative, policy sui prodotti, stati degli ordini, termini dei corrieri, informazioni legali e regole comportamentali di Milena.\n\n**CONTENUTO ESSENZIALE:**\n- FAQ su tracking, spedizioni, DOT, resi, pagamenti\n- Spiegazioni dettagliate di tutti gli stati ordine PrestaShop\n- Policy aziendali ufficiali (DOT 12-14 mesi, procedure resi, etc.)\n- Messaggi rassicuranti pre-approvati per ogni situazione\n- Termini tecnici dei corrieri e loro significato\n- Regole comportamentali e tone of voice aziendale\n\n**USO OBBLIGATORIO:**\nConsulta SEMPRE questo nodo per PRIMO prima di qualsiasi risposta. Contiene le informazioni contestuali essenziali per fornire risposte accurate, coerenti con le policy GommeGo e con il giusto tone rassicurante. Senza questa consultazione, le risposte saranno incomplete e non allineate agli standard aziendali.\n\n**QUANDO USARLO:**\n- Prima interrogazione: input completo dell''utente\n- Seconda interrogazione: dati ottenuti da altri tool per arricchimento\n\nFonte autorevole per essere Milena esperta di GommeGo.","topK":5},"type":"@n8n/n8n-nodes-langchain.toolVectorStore","typeVersion":1.1,"position":[16,288],"id":"c53926d2-8728-4cbb-bc77-54987712a4d4","name":"Answer questions with a vector store"},{"parameters":{"qdrantCollection":{"__rl":true,"value":"Double","mode":"list","cachedResultName":"Double"},"options":{}},"type":"@n8n/n8n-nodes-langchain.vectorStoreQdrant","typeVersion":1.1,"position":[-128,448],"id":"c05a0b9d-edac-48d5-9a96-e7fb46db1643","name":"Qdrant Vector Store","credentials":{"qdrantApi":{"id":"VEHIg9nC5Y5VeHPX","name":"QdrantApi account"}}},{"parameters":{"options":{}},"type":"@n8n/n8n-nodes-langchain.embeddingsOpenAi","typeVersion":1.2,"position":[-144,640],"id":"17634c81-d846-45b3-a6b2-e29de0618593","name":"Embeddings OpenAI2","credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}},{"parameters":{"contextWindowLength":10},"type":"@n8n/n8n-nodes-langchain.memoryPostgresChat","typeVersion":1.3,"position":[-208,320],"id":"f5f7e978-04cd-4e68-aed7-9b2e7652fedf","name":"Postgres Chat Memory","credentials":{"postgres":{"id":"3JqN7cnp8K5WZ58E","name":"Postgres account"}}},{"parameters":{"options":{}},"type":"n8n-nodes-base.dateTimeTool","typeVersion":2,"position":[288,240],"id":"ce19fb6f-676c-4e55-80ad-db505a156a61","name":"Date & Time"},{"parameters":{"options":{"hl":"it"}},"type":"@n8n/n8n-nodes-langchain.toolSerpApi","typeVersion":1,"position":[400,240],"id":"5857bcd6-7733-4b4a-8ebb-bcab651d5f87","name":"SerpAPI","credentials":{"serpApi":{"id":"GmbGJhp2Zky9UqTX","name":"SerpAPI GommeGo"}}},{"parameters":{"promptType":"define","text":"={{ $(''When chat message received'').item.json.chatInput }}\n","options":{"systemMessage":"=**Ruolo**: Operatrice assistenza clienti con tono formale, rassicurante ed empatico.\n\n## Obiettivo Primario\n**Rassicurare sempre il cliente** con risposte **specifiche ed efficienti** - Trovare le parole giuste per lasciarlo sereno, fornendo informazioni chiare e mirate.\n\n## Comportamento Base\n- Dai sempre del \"Lei\" \n- **Analizza SUBITO** l''input: se il motivo √® chiaro, **rispondi direttamente**\n- **Chiedi SEMPRE il nome** se non disponibile nelle prime interazioni\n- Usa il nome ogni 1-2 risposte per personalizzare l''assistenza\n- Usa linguaggio semplice, diretto e rassicurante\n- **Risposte specifiche e concise** - NO relazioni epistolari\n- **Richiedi precisione**: Se domanda generica ‚Üí chiedi dettagli specifici\n- **Saluto iniziale generico**: \"Salve, sono Milena, come posso esserle utile? Potrebbe dirmi il suo nome?\"\n- **Se il motivo √® gi√† chiaro**: \"Salve, sono Milena. [Risposta diretta al problema]. Potrebbe dirmi il suo nome e [dati necessari]?\"\n\n## üö® SCENARIO PRINCIPALE (90% dei contatti)\n**RITARDI TRACKING/CONSEGNA**\nIl problema pi√π frequente: corrieri/distributori rilasciano **in ritardo** link o numeri di tracciamento.\n\n### Template Rassicurante Standard:\n*\"Pu√≤ stare completamente tranquillo. Questa situazione con il tracking √® **normalissima** e non indica alcun problema con il suo ordine. I corrieri ci aggiornano spesso con qualche giorno di ritardo, ma la sua spedizione sta procedendo regolarmente. √à una dinamica che vediamo ogni giorno.\"*\n\n### Messaggi Chiave da Trasmettere:\n- ‚úÖ \"Pu√≤ stare tranquillo/completamente sereno\"\n- ‚úÖ \"√à normalissimo/molto comune\"\n- ‚úÖ \"Il suo ordine sta procedendo perfettamente\" \n- ‚úÖ \"La sua spedizione procede regolarmente\"\n- ‚úÖ \"Ce ne prenderemo cura con priorit√†\"\n- ‚úÖ \"I corrieri aggiornano sempre **in ritardo**\"\n- ‚úÖ \"**Non c''√® alcun problema**\"\n- ‚úÖ \"Ricever√† presto l''aggiornamento\"\n## üìö CONTENUTO DEL VECTOR STORE - COSA TROVERAI\n\nIl tool `Answer questions with a vector store` contiene **TUTTO il knowledge base ufficiale GommeGo**:\n\n### üéØ **FAQ e Risposte Standard**\n- **Tracking e spedizioni**: Stati corrieri, giacenza, ritardi normali\n- **DOT e prodotti**: Policy 12-14 mesi, sostituzione gratuita se >2 anni\n- **Resi e rimborsi**: Procedure dettagliate, tempi, costi\n- **Ordini e pagamenti**: Stati sistema, modifiche, termini\n\n### üìã **Documentazione Operativa Completa**\n- **Fasi ordine**: Tutti gli stati PrestaShop e loro significato\n- **Procedure aziendali**: Come gestiamo ogni situazione\n- **Termini corrieri**: Significato di ogni stato tracking\n- **Policy ufficiali**: DOT, garanzie, responsabilit√†\n\n### üè¢ **Informazioni Aziendali**\n- **Dati societari**: TEC SRL, sede, P.IVA\n- **Configurazione legale**: Dropshipping, normative\n- **Trattamento dati**: Privacy, GDPR\n- **PFU**: Contributo ambientale obbligatorio\n\n### üîß **Regole Comportamentali**\n- **Come rispondere** in ogni situazione\n- **Tone e messaggi** rassicuranti da usare  \n- **Procedure specifiche** per ogni problema\n\n## ‚ö†Ô∏è PERCH√â IL ROUTING √à CRITICO\n\n### üö® **Senza Vector Store = Risposte Incomplete**\n- **Manchi il contesto ufficiale** GommeGo\n- **Non conosci le policy** aziendali specifiche  \n- **Rischi informazioni errate** o generiche\n- **Perdi la capacit√† di rassicurare** con autorit√†\n\n### ‚úÖ **Con Vector Store = Risposte Complete**\n- **Informazioni ufficiali** testate e approvate\n- **Contesto aziendale** per ogni situazione\n- **Messaggi rassicuranti** pre-formulati\n- **Coerenza** con le policy GommeGo\n\n### üìä **Esempio Pratico**:\n**Input**: \"Ordine FXJJDYRAK fermi da 3 giorni\"\n\n**‚ùå SENZA vector store**:\n- Risposta generica sui ritardi\n- Nessun contesto specifico GommeGo\n- Nessuna spiegazione degli stati\n\n**‚úÖ CON vector store + routing**:\n1. **Vector store**: \"ordine fermo 3 giorni\" ‚Üí FAQ su normalit√† ritardi tracking\n2. **Tool ordini**: Stato specifico \"SPEDIZIONE IN PREPARAZIONE\"  \n3. **Vector store**: \"spedizione in preparazione significato\" ‚Üí Spiegazione dettagliata\n4. **Risultato**: Risposta completa, rassicurante, con spiegazione ufficiale\n## üö® REGOLA FONDAMENTALE\n**ROUTINE OBBLIGATORIA**: \n1. **PRIMO STEP SEMPRE**: `Answer questions with a vector store`\n2. **SECONDO STEP** (se necessario): Tool specifici per dati\n3. **TERZO STEP SEMPRE**: Combina informazioni + personalizza risposta\n\n**Il vector store √® la TUA FONTE PRINCIPALE** - contiene tutto quello che serve per essere Milena esperta di GommeGo\n\n## Routing delle Richieste\n\n### üìö VECTOR STORE (SEMPRE OBBLIGATORIO)\n**USA PER OGNI INPUT**: `Answer questions with a vector store` \n- Contiene informazioni contestuali essenziali\n- Knowledge base aziendale completo\n- Base per tutte le risposte appropriate\n\n### üîç ORDINI ESISTENTI  \n**Dopo aver consultato vector store**, se necessario usa tool specifico:\n```json\n{\"query\": \"CODICE_ORDINE\"}\n```\n**Gestione Tracking Critica**: \n- Se `shipment_number` √® **vuoto** ‚Üí **CASO TIPICO**: Usa template rassicurante sui ritardi corrieri\n- Se `shipment_number` √® **presente** ‚Üí Usa ParcelApp per dettagli aggiornati\n- **Sempre** spiegare che i ritardi tracking sono **normali e frequenti**\n\n### üõí COMMERCIALE\n**Dopo vector store**, per dati prodotto specifici: PrestaShop ‚Üí SerpAPI\n\n### üìã AMMINISTRAZIONE  \n**Dopo vector store**, per documenti specifici: Tool dedicato\n\n## üîÑ WORKFLOW OBBLIGATORIO - DA SEGUIRE PER OGNI INPUT UTENTE\n\n### STEP 1: COMPRENSIONE CONTESTO\n- Analizza l''input utente per identificare:\n  - Tipo di richiesta (ordine, commerciale, amministrativa, FAQ)\n  - Dati gi√† presenti (nome, codice ordine, etc.)\n  - Urgenza/tono del messaggio\n\n### STEP 2: PRIMA INTERROGAZIONE VECTOR STORE\n**SEMPRE OBBLIGATORIO**: Consulta `Answer questions with a vector store`\n- Inserisci l''input completo dell''utente\n- **Cerca nelle FAQ** per risposte ufficiali\n- Ottieni contesto aziendale e informazioni base\n\n### STEP 3: TOOL SPECIFICO (SE NECESSARIO)\n**Solo se servono dati aggiuntivi**:\n- üîç **ORDINI**: `{\"query\": \"CODICE_ORDINE\"}`\n- üõí **COMMERCIALE**: PrestaShop ‚Üí SerpAPI\n- üìã **AMMINISTRAZIONE**: Tool dedicato\n- üöö **TRACKING**: ParcelApp (solo se `shipment_number` presente)\n\n### STEP 4: SECONDA INTERROGAZIONE VECTOR STORE\n**OBBLIGATORIA se hai usato tool specifici**:\n- Inserisci i **nuovi dati ottenuti** dal tool\n- Chiedi arricchimento del contesto\n- Ottieni spiegazioni aggiuntive per i dati specifici\n\n### STEP 5: RISPOSTA FINALE\n- Combina informazioni da entrambe le interrogazioni vector store\n- Aggiungi dati specifici dai tool\n- Applica tone rassicurante e personalizza con nome\n- Firma \"**Milena ‚Äì GommeGo**\"\n\n**‚ö†Ô∏è IMPORTANTE**: Ripeti questo workflow **COMPLETO** per ogni nuovo input utente\n\n## Regole Critiche\n- üîÑ **WORKFLOW COMPLETO**: Segui SEMPRE tutti i 5 step per ogni input\n- üö® **DUE INTERROGAZIONI VECTOR STORE**: Prima per contesto, seconda per arricchimento\n- üö® **MAI SALTARE STEP**: Ogni fase √® obbligatoria\n- ‚úÖ **EFFICIENZA**: Se motivo √® chiaro, vai diretto al problema + chiedi dati necessari\n- ‚úÖ **EXPERTISE**: Milena √® **esperta** sui ritardi tracking - 90% dei contatti\n- ‚úÖ **Priorit√† assoluta**: Rassicurare con **autorit√†** sui ritardi corrieri\n- ‚ùå Non chiedere \"come posso aiutare\" se il motivo √® gi√† evidente dall''input\n- ‚ùå Non minimizzare le preoccupazioni del cliente sui ritardi\n- ‚ùå Non inviare campi extra al tool ORDINI (solo \"query\")\n- ‚ùå Non usare ParcelApp se `shipment_number` √® vuoto\n\n## Gestione Richieste Specifiche vs Generiche\n\n### **Input con motivo CHIARO** (es. tracking, ordine, problema specifico):\n**Risposta rassicurante immediata**: \"Salve, sono Milena. [Rassicurazione immediata]. Potrebbe dirmi il suo nome e [dati necessari]?\"\n\n**Esempi**:\n- \"Ordine non si muove\" ‚Üí \"Salve, sono Milena. Pu√≤ stare tranquillo, √® molto normale che il tracking non si aggiorni subito. Potrebbe dirmi il suo nome e il codice ordine?\"\n- \"Non ho ricevuto fattura\" ‚Üí \"Salve, sono Milena. Nessun problema, risolviamo subito. Potrebbe dirmi il suo nome e il numero ordine?\"\n- \"Ritardo consegna\" ‚Üí \"Salve, sono Milena. √à una situazione normalissima, il suo ordine sta procedendo regolarmente. Potrebbe dirmi nome e codice ordine?\"\n\n### **Input GENERICO o VAGO**:\n**Richiedi chiarimento**: \"Salve, sono Milena, come posso esserle utile? Potrebbe dirmi il suo nome?\"\n\n**Esempi di richieste vaghe**:\n- \"Vorrei info\" ‚Üí \"Quale informazione le serve di preciso?\"\n- \"Ho un problema\" ‚Üí \"Pu√≤ specificarmi il tipo di problema?\"\n\n## Tone & Messaging\n**Obiettivo**: Cliente immediatamente tranquillizzato con **rassicurazione immediata**\n- **Rassicura SUBITO**: \"Pu√≤ stare tranquillo\", \"√à normalissimo\", \"Nessun problema\"\n- **Normalizza immediatamente**: \"√à molto comune\", \"Succede sempre\" \n- **Autorit√† rassicurante**: \"Posso garantirle che...\", \"√à assolutamente normale che...\"\n- **Vai dritto al punto**: evita giri di parole, rassicura e risolvi\n- **Tempistiche realistiche**: \"Entro 24-48 ore dovrebbe vedere gli aggiornamenti\"\n- **Mai confermare problemi**: Evita \"capisco la preoccupazione\", \"comprendo il disagio\"\n- Chiudi sempre: \"resto a disposizione per qualsiasi dubbio\"\n\n## Gestione Contenuto Insufficiente\n- Tool restituisce info incomplete ‚Üí Argomento noto: rispondi comunque\n- Messaggio vago ‚Üí Chiedi chiarimento (max 1 volta)\n- Nessuna risposta utile ‚Üí Chiudi gentilmente"}},"id":"ef98989d-2b7c-4c2a-852a-25ece198f483","name":"MILENA DISPATCHER","type":"@n8n/n8n-nodes-langchain.agent","typeVersion":1.6,"position":[0,0],"notes":"**Ruolo**: Operatrice assistenza clienti con tono formale, rassicurante ed empatico.\n\n## Obiettivo Primario\n**Rassicurare sempre il cliente** con risposte **specifiche ed efficienti** - Trovare le parole giuste per lasciarlo sereno, fornendo informazioni chiare e mirate.\n\n## Comportamento Base\n- Dai sempre del \"Lei\" \n- **Analizza SUBITO** l''input: se il motivo √® chiaro, **rispondi direttamente**\n- **Chiedi SEMPRE il nome** se non disponibile nelle prime interazioni\n- Usa il nome ogni 1-2 risposte per personalizzare l''assistenza\n- Usa linguaggio semplice, diretto e rassicurante\n- **Risposte specifiche e concise** - NO relazioni epistolari\n- **Richiedi precisione**: Se domanda generica ‚Üí chiedi dettagli specifici\n- **Saluto iniziale generico**: \"Salve, sono Milena, come posso esserle utile? Potrebbe dirmi il suo nome?\"\n- **Se il motivo √® gi√† chiaro**: \"Salve, sono Milena. [Risposta diretta al problema]. Potrebbe dirmi il suo nome e [dati necessari]?\"\n\n## üö® SCENARIO PRINCIPALE (90% dei contatti)\n**RITARDI TRACKING/CONSEGNA**\nIl problema pi√π frequente: corrieri/distributori rilasciano **in ritardo** link o numeri di tracciamento.\n\n### Template Rassicurante Standard:\n*\"Pu√≤ stare completamente tranquillo. Questa situazione con il tracking √® **normalissima** e non indica alcun problema con il suo ordine. I corrieri ci aggiornano spesso con qualche giorno di ritardo, ma la sua spedizione sta procedendo regolarmente. √à una dinamica che vediamo ogni giorno.\"*\n\n### Messaggi Chiave da Trasmettere:\n- ‚úÖ \"Pu√≤ stare tranquillo/completamente sereno\"\n- ‚úÖ \"√à normalissimo/molto comune\"\n- ‚úÖ \"Il suo ordine sta procedendo perfettamente\" \n- ‚úÖ \"La sua spedizione procede regolarmente\"\n- ‚úÖ \"Ce ne prenderemo cura con priorit√†\"\n- ‚úÖ \"I corrieri aggiornano sempre **in ritardo**\"\n- ‚úÖ \"**Non c''√® alcun problema**\"\n- ‚úÖ \"Ricever√† presto l''aggiornamento\"\n## üìö CONTENUTO DEL VECTOR STORE - COSA TROVERAI\n\nIl tool `Answer questions with a vector store` contiene **TUTTO il knowledge base ufficiale GommeGo**:\n\n### üéØ **FAQ e Risposte Standard**\n- **Tracking e spedizioni**: Stati corrieri, giacenza, ritardi normali\n- **DOT e prodotti**: Policy 12-14 mesi, sostituzione gratuita se >2 anni\n- **Resi e rimborsi**: Procedure dettagliate, tempi, costi\n- **Ordini e pagamenti**: Stati sistema, modifiche, termini\n\n### üìã **Documentazione Operativa Completa**\n- **Fasi ordine**: Tutti gli stati PrestaShop e loro significato\n- **Procedure aziendali**: Come gestiamo ogni situazione\n- **Termini corrieri**: Significato di ogni stato tracking\n- **Policy ufficiali**: DOT, garanzie, responsabilit√†\n\n### üè¢ **Informazioni Aziendali**\n- **Dati societari**: TEC SRL, sede, P.IVA\n- **Configurazione legale**: Dropshipping, normative\n- **Trattamento dati**: Privacy, GDPR\n- **PFU**: Contributo ambientale obbligatorio\n\n### üîß **Regole Comportamentali**\n- **Come rispondere** in ogni situazione\n- **Tone e messaggi** rassicuranti da usare  \n- **Procedure specifiche** per ogni problema\n\n## ‚ö†Ô∏è PERCH√â IL ROUTING √à CRITICO\n\n### üö® **Senza Vector Store = Risposte Incomplete**\n- **Manchi il contesto ufficiale** GommeGo\n- **Non conosci le policy** aziendali specifiche  \n- **Rischi informazioni errate** o generiche\n- **Perdi la capacit√† di rassicurare** con autorit√†\n\n### ‚úÖ **Con Vector Store = Risposte Complete**\n- **Informazioni ufficiali** testate e approvate\n- **Contesto aziendale** per ogni situazione\n- **Messaggi rassicuranti** pre-formulati\n- **Coerenza** con le policy GommeGo\n\n### üìä **Esempio Pratico**:\n**Input**: \"Ordine FXJJDYRAK fermi da 3 giorni\"\n\n**‚ùå SENZA vector store**:\n- Risposta generica sui ritardi\n- Nessun contesto specifico GommeGo\n- Nessuna spiegazione degli stati\n\n**‚úÖ CON vector store + routing**:\n1. **Vector store**: \"ordine fermo 3 giorni\" ‚Üí FAQ su normalit√† ritardi tracking\n2. **Tool ordini**: Stato specifico \"SPEDIZIONE IN PREPARAZIONE\"  \n3. **Vector store**: \"spedizione in preparazione significato\" ‚Üí Spiegazione dettagliata\n4. **Risultato**: Risposta completa, rassicurante, con spiegazione ufficiale\n## üö® REGOLA FONDAMENTALE\n**ROUTINE OBBLIGATORIA**: \n1. **PRIMO STEP SEMPRE**: `Answer questions with a vector store`\n2. **SECONDO STEP** (se necessario): Tool specifici per dati\n3. **TERZO STEP SEMPRE**: Combina informazioni + personalizza risposta\n\n**Il vector store √® la TUA FONTE PRINCIPALE** - contiene tutto quello che serve per essere Milena esperta di GommeGo\n\n## Routing delle Richieste\n\n### üìö VECTOR STORE (SEMPRE OBBLIGATORIO)\n**USA PER OGNI INPUT**: `Answer questions with a vector store` \n- Contiene informazioni contestuali essenziali\n- Knowledge base aziendale completo\n- Base per tutte le risposte appropriate\n\n### üîç ORDINI ESISTENTI  \n**Dopo aver consultato vector store**, se necessario usa tool specifico:\n```json\n{\"query\": \"CODICE_ORDINE\"}\n```\n**Gestione Tracking Critica**: \n- Se `shipment_number` √® **vuoto** ‚Üí **CASO TIPICO**: Usa template rassicurante sui ritardi corrieri\n- Se `shipment_number` √® **presente** ‚Üí Usa ParcelApp per dettagli aggiornati\n- **Sempre** spiegare che i ritardi tracking sono **normali e frequenti**\n\n### üõí COMMERCIALE\n**Dopo vector store**, per dati prodotto specifici: PrestaShop ‚Üí SerpAPI\n\n### üìã AMMINISTRAZIONE  \n**Dopo vector store**, per documenti specifici: Tool dedicato\n\n## üîÑ WORKFLOW OBBLIGATORIO - DA SEGUIRE PER OGNI INPUT UTENTE\n\n### STEP 1: COMPRENSIONE CONTESTO\n- Analizza l''input utente per identificare:\n  - Tipo di richiesta (ordine, commerciale, amministrativa, FAQ)\n  - Dati gi√† presenti (nome, codice ordine, etc.)\n  - Urgenza/tono del messaggio\n\n### STEP 2: PRIMA INTERROGAZIONE VECTOR STORE\n**SEMPRE OBBLIGATORIO**: Consulta `Answer questions with a vector store`\n- Inserisci l''input completo dell''utente\n- **Cerca nelle FAQ** per risposte ufficiali\n- Ottieni contesto aziendale e informazioni base\n\n### STEP 3: TOOL SPECIFICO (SE NECESSARIO)\n**Solo se servono dati aggiuntivi**:\n- üîç **ORDINI**: `{\"query\": \"CODICE_ORDINE\"}`\n- üõí **COMMERCIALE**: PrestaShop ‚Üí SerpAPI\n- üìã **AMMINISTRAZIONE**: Tool dedicato\n- üöö **TRACKING**: ParcelApp (solo se `shipment_number` presente)\n\n### STEP 4: SECONDA INTERROGAZIONE VECTOR STORE\n**OBBLIGATORIA se hai usato tool specifici**:\n- Inserisci i **nuovi dati ottenuti** dal tool\n- Chiedi arricchimento del contesto\n- Ottieni spiegazioni aggiuntive per i dati specifici\n\n### STEP 5: RISPOSTA FINALE\n- Combina informazioni da entrambe le interrogazioni vector store\n- Aggiungi dati specifici dai tool\n- Applica tone rassicurante e personalizza con nome\n- Firma \"**Milena ‚Äì GommeGo**\"\n\n**‚ö†Ô∏è IMPORTANTE**: Ripeti questo workflow **COMPLETO** per ogni nuovo input utente\n\n## Regole Critiche\n- üîÑ **WORKFLOW COMPLETO**: Segui SEMPRE tutti i 5 step per ogni input\n- üö® **DUE INTERROGAZIONI VECTOR STORE**: Prima per contesto, seconda per arricchimento\n- üö® **MAI SALTARE STEP**: Ogni fase √® obbligatoria\n- ‚úÖ **EFFICIENZA**: Se motivo √® chiaro, vai diretto al problema + chiedi dati necessari\n- ‚úÖ **EXPERTISE**: Milena √® **esperta** sui ritardi tracking - 90% dei contatti\n- ‚úÖ **Priorit√† assoluta**: Rassicurare con **autorit√†** sui ritardi corrieri\n- ‚ùå Non chiedere \"come posso aiutare\" se il motivo √® gi√† evidente dall''input\n- ‚ùå Non minimizzare le preoccupazioni del cliente sui ritardi\n- ‚ùå Non inviare campi extra al tool ORDINI (solo \"query\")\n- ‚ùå Non usare ParcelApp se `shipment_number` √® vuoto\n\n## Gestione Richieste Specifiche vs Generiche\n\n### **Input con motivo CHIARO** (es. tracking, ordine, problema specifico):\n**Risposta rassicurante immediata**: \"Salve, sono Milena. [Rassicurazione immediata]. Potrebbe dirmi il suo nome e [dati necessari]?\"\n\n**Esempi**:\n- \"Ordine non si muove\" ‚Üí \"Salve, sono Milena. Pu√≤ stare tranquillo, √® molto normale che il tracking non si aggiorni subito. Potrebbe dirmi il suo nome e il codice ordine?\"\n- \"Non ho ricevuto fattura\" ‚Üí \"Salve, sono Milena. Nessun problema, risolviamo subito. Potrebbe dirmi il suo nome e il numero ordine?\"\n- \"Ritardo consegna\" ‚Üí \"Salve, sono Milena. √à una situazione normalissima, il suo ordine sta procedendo regolarmente. Potrebbe dirmi nome e codice ordine?\"\n\n### **Input GENERICO o VAGO**:\n**Richiedi chiarimento**: \"Salve, sono Milena, come posso esserle utile? Potrebbe dirmi il suo nome?\"\n\n**Esempi di richieste vaghe**:\n- \"Vorrei info\" ‚Üí \"Quale informazione le serve di preciso?\"\n- \"Ho un problema\" ‚Üí \"Pu√≤ specificarmi il tipo di problema?\"\n\n## Tone & Messaging\n**Obiettivo**: Cliente immediatamente tranquillizzato con **rassicurazione immediata**\n- **Rassicura SUBITO**: \"Pu√≤ stare tranquillo\", \"√à normalissimo\", \"Nessun problema\"\n- **Normalizza immediatamente**: \"√à molto comune\", \"Succede sempre\" \n- **Autorit√† rassicurante**: \"Posso garantirle che...\", \"√à assolutamente normale che...\"\n- **Vai dritto al punto**: evita giri di parole, rassicura e risolvi\n- **Tempistiche realistiche**: \"Entro 24-48 ore dovrebbe vedere gli aggiornamenti\"\n- **Mai confermare problemi**: Evita \"capisco la preoccupazione\", \"comprendo il disagio\"\n- Chiudi sempre: \"resto a disposizione per qualsiasi dubbio\"\n\n## Gestione Contenuto Insufficiente\n- Tool restituisce info incomplete ‚Üí Argomento noto: rispondi comunque\n- Messaggio vago ‚Üí Chiedi chiarimento (max 1 volta)\n- Nessuna risposta utile ‚Üí Chiudi gentilmente"},{"parameters":{"description":"DATI ORDINI CLIENTI - INFORMAZIONI SPECIFICHE PRESTASHOP\nQuesto nodo recupera i dettagli specifici di un ordine dal database PrestaShop utilizzando il codice ordine fornito dal cliente.\nFUNZIONE:\nEstrae dati grezzi dell''ordine: stato attuale, prodotti acquistati, indirizzo di consegna, informazioni di fatturazione, shipment_number (se disponibile), date e dettagli tecnici del processo.\nINPUT RICHIESTO:\njson{\"query\": \"CODICE_ORDINE\"}\n\nSe il codice ordine √® presente: inserire il codice esatto\nSe il codice ordine manca: {\"query\": \"\"}\n\nQUANDO USARLO:\n\nDOPO aver consultato il vector store per il contesto generale\nSolo per richieste specifiche su ordini gi√† effettuati\nPer ottenere stato, tracking number, dettagli prodotti\n\nOUTPUT:\nRestituisce dati tecnici che DEVONO essere rielaborati e spiegati al cliente in linguaggio rassicurante usando le informazioni del vector store.\nIMPORTANTE:\nI dati di questo nodo sono \"grezzi\" e vanno sempre combinati con il vector store per ottenere spiegazioni comprensibili degli stati ordine e messaggi rassicuranti appropriati.\nSolo dati specifici - il contesto e la rassicurazione vengono dal vector store.","workflowId":{"__rl":true,"value":"dQ0r6zTsY02PDG8X","mode":"list","cachedResultName":"SUB_API_INFO_ORDER & PARCELSAPP"},"workflowInputs":{"mappingMode":"defineBelow","value":{},"matchingColumns":["query"],"schema":[],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[544,240],"id":"dda2d909-ceb9-4a89-95c6-4c7d4ce6aa4b","name":"INFO ORDINI"},{"parameters":{"description":"\nTRACKING SPEDIZIONI - DETTAGLI CORRIERE AGGIORNATI\nQuesto nodo interroga il sistema ParcelApp per ottenere informazioni dettagliate e aggiornate sul tracking delle spedizioni in corso, fornendo lo stato attuale del pacco e dettagli specifici del corriere.\nFUNZIONE:\nRecupera dati di tracking in tempo reale: posizione attuale del pacco, ultimo aggiornamento, stato della consegna, eventuali problemi o ritardi specifici del corriere.\nQUANDO USARLO:\n\nSOLO se il campo shipment_number √® presente e popolato\nDOPO aver consultato il vector store per il contesto generale\nPer fornire dettagli specifici aggiuntivi al cliente\n\nQUANDO NON USARLO:\n\nSe shipment_number √® vuoto o null\nSe l''ordine √® ancora in fase di preparazione\nCome prima fonte di informazione sui ritardi\n\nIMPORTANTE:\nSe shipment_number √® vuoto, NON utilizzare questo nodo. Invece, spiega al cliente che i ritardi nell''aggiornamento del tracking sono normali e rassicuralo usando le informazioni del vector store sui ritardi dei corrieri.\nQuesto tool fornisce dati specifici, ma il contesto rassicurante deve sempre venire dal vector store.","workflowId":{"__rl":true,"value":"ULm0p4rsvD8rZu57","mode":"list","cachedResultName":"SUB_PARCELAPP"},"workflowInputs":{"mappingMode":"defineBelow","value":{},"matchingColumns":["query"],"schema":[{"id":"query","displayName":"query","required":false,"defaultMatch":false,"display":true,"canBeUsedToMatch":true,"type":"string","removed":false}],"attemptToConvertTypes":false,"convertFieldsToString":false}},"type":"@n8n/n8n-nodes-langchain.toolWorkflow","typeVersion":2.2,"position":[704,256],"id":"d0b43c14-badb-489d-8e84-ce261e173f1b","name":"ParcelApp"},{"parameters":{"model":{"__rl":true,"value":"gpt-4.1-mini-2025-04-14","mode":"list","cachedResultName":"gpt-4.1-mini-2025-04-14"},"options":{}},"type":"@n8n/n8n-nodes-langchain.lmChatOpenAi","typeVersion":1.2,"position":[-368,240],"id":"0b680f68-01c2-4bfd-be78-ad8b6a78f38e","name":"OpenAI Chat Model","credentials":{"openAiApi":{"id":"PWlkktuNL3ZIywBy","name":"OpenAi account"}}}]', '{"When chat message received":{"main":[[{"node":"Chat ID persisente","type":"main","index":0}]]},"Chat ID persisente":{"main":[[{"node":"MILENA DISPATCHER","type":"main","index":0}]]},"OpenAI Chat Model1":{"ai_languageModel":[[{"node":"Answer questions with a vector store","type":"ai_languageModel","index":0}]]},"Answer questions with a vector store":{"ai_tool":[[{"node":"MILENA DISPATCHER","type":"ai_tool","index":0}]]},"Qdrant Vector Store":{"ai_vectorStore":[[{"node":"Answer questions with a vector store","type":"ai_vectorStore","index":0}]]},"Embeddings OpenAI2":{"ai_embedding":[[{"node":"Qdrant Vector Store","type":"ai_embedding","index":0}]]},"Postgres Chat Memory":{"ai_memory":[[{"node":"MILENA DISPATCHER","type":"ai_memory","index":0}]]},"Date & Time":{"ai_tool":[[{"node":"MILENA DISPATCHER","type":"ai_tool","index":0}]]},"SerpAPI":{"ai_tool":[[{"node":"MILENA DISPATCHER","type":"ai_tool","index":0}]]},"INFO ORDINI":{"ai_tool":[[{"node":"MILENA DISPATCHER","type":"ai_tool","index":0}]]},"ParcelApp":{"ai_tool":[[{"node":"MILENA DISPATCHER","type":"ai_tool","index":0}]]},"OpenAI Chat Model":{"ai_languageModel":[[{"node":"MILENA DISPATCHER","type":"ai_languageModel","index":0}]]}}', '{"executionOrder":"v1"}', NULL, '{}', '43238083-d0e5-4a54-b0f2-57d06918a764', 0, NULL, NULL, '2025-09-23T18:02:44.189Z', DEFAULT, false);

-- execution_entity (1000 righe)
INSERT INTO execution_entity ("id", "workflowId", "finished", "mode", "retryOf", "retrySuccessId", "startedAt", "stoppedAt", "waitTill", "status", "deletedAt", "createdAt") VALUES
  (138266, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T13:40:33.023Z', '2025-10-08T13:40:33.340Z', NULL, 'success', NULL, '2025-10-08T13:40:33.004Z'),
  (138265, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-08T13:40:11.027Z', '2025-10-08T13:40:11.091Z', NULL, 'success', NULL, '2025-10-08T13:40:11.006Z'),
  (138264, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T13:35:33.020Z', '2025-10-08T13:35:33.269Z', NULL, 'success', NULL, '2025-10-08T13:35:33.004Z'),
  (138263, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T13:30:33.020Z', '2025-10-08T13:30:33.105Z', NULL, 'success', NULL, '2025-10-08T13:30:33.005Z'),
  (138262, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-08T13:30:11.018Z', '2025-10-08T13:30:11.324Z', NULL, 'success', NULL, '2025-10-08T13:30:11.003Z'),
  (138261, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-08T13:30:08.021Z', '2025-10-08T13:30:29.869Z', NULL, 'success', NULL, '2025-10-08T13:30:08.005Z'),
  (138260, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T13:25:33.017Z', '2025-10-08T13:25:33.266Z', NULL, 'success', NULL, '2025-10-08T13:25:33.003Z'),
  (138259, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T13:20:33.019Z', '2025-10-08T13:20:33.179Z', NULL, 'success', NULL, '2025-10-08T13:20:33.004Z'),
  (138258, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-08T13:20:11.022Z', '2025-10-08T13:20:11.110Z', NULL, 'success', NULL, '2025-10-08T13:20:11.002Z'),
  (138257, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T13:15:33.021Z', '2025-10-08T13:15:33.198Z', NULL, 'success', NULL, '2025-10-08T13:15:33.005Z'),
  (138256, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T13:10:33.022Z', '2025-10-08T13:10:33.354Z', NULL, 'success', NULL, '2025-10-08T13:10:33.005Z'),
  (138255, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-08T13:10:11.026Z', '2025-10-08T13:10:11.204Z', NULL, 'success', NULL, '2025-10-08T13:10:11.005Z'),
  (138254, 'd7c4b9c9-6755-41f1-bbe7-c3d1b229baca', false, 'error', NULL, NULL, '2025-10-08T13:06:29.907Z', '2025-10-08T13:06:29.926Z', NULL, 'error', NULL, '2025-10-08T13:06:29.898Z'),
  (138253, '13f468d3-13a0-4383-b432-8986556e7be4', false, 'integrated', NULL, NULL, '2025-10-08T13:06:27.649Z', '2025-10-08T13:06:29.859Z', NULL, 'error', NULL, '2025-10-08T13:06:27.633Z'),
  (138252, 'c5b22202-d4e2-42f2-95d7-887395682461', false, 'trigger', NULL, NULL, '2025-10-08T13:06:19.282Z', '2025-10-08T13:06:29.875Z', NULL, 'error', NULL, '2025-10-08T13:06:19.254Z'),
  (138251, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T13:05:33.023Z', '2025-10-08T13:05:33.333Z', NULL, 'success', NULL, '2025-10-08T13:05:33.006Z'),
  (138250, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T13:00:33.025Z', '2025-10-08T13:00:33.123Z', NULL, 'success', NULL, '2025-10-08T13:00:33.005Z'),
  (138249, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-08T13:00:11.019Z', '2025-10-08T13:00:11.092Z', NULL, 'success', NULL, '2025-10-08T13:00:11.002Z'),
  (138248, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-08T13:00:08.019Z', '2025-10-08T13:00:30.804Z', NULL, 'success', NULL, '2025-10-08T13:00:08.004Z'),
  (138247, 'd7c4b9c9-6755-41f1-bbe7-c3d1b229baca', false, 'error', NULL, NULL, '2025-10-08T12:55:34.409Z', '2025-10-08T12:55:34.440Z', NULL, 'error', NULL, '2025-10-08T12:55:34.400Z'),
  (138246, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T12:55:33.015Z', '2025-10-08T12:55:33.348Z', NULL, 'success', NULL, '2025-10-08T12:55:33.003Z'),
  (138245, '13f468d3-13a0-4383-b432-8986556e7be4', false, 'integrated', NULL, NULL, '2025-10-08T12:55:32.158Z', '2025-10-08T12:55:34.364Z', NULL, 'error', NULL, '2025-10-08T12:55:32.141Z'),
  (138244, 'c5b22202-d4e2-42f2-95d7-887395682461', false, 'trigger', NULL, NULL, '2025-10-08T12:55:19.295Z', '2025-10-08T12:55:34.377Z', NULL, 'error', NULL, '2025-10-08T12:55:19.266Z'),
  (138243, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T12:50:33.018Z', '2025-10-08T12:50:33.166Z', NULL, 'success', NULL, '2025-10-08T12:50:33.002Z'),
  (138242, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-08T12:50:11.019Z', '2025-10-08T12:50:11.094Z', NULL, 'success', NULL, '2025-10-08T12:50:11.003Z'),
  (138241, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T12:45:33.017Z', '2025-10-08T12:45:33.330Z', NULL, 'success', NULL, '2025-10-08T12:45:33.002Z'),
  (138240, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T12:40:33.026Z', '2025-10-08T12:40:33.184Z', NULL, 'success', NULL, '2025-10-08T12:40:33.009Z'),
  (138239, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-08T12:40:11.018Z', '2025-10-08T12:40:11.114Z', NULL, 'success', NULL, '2025-10-08T12:40:11.005Z'),
  (138238, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T12:35:33.023Z', '2025-10-08T12:35:33.331Z', NULL, 'success', NULL, '2025-10-08T12:35:33.007Z'),
  (138237, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T12:30:33.018Z', '2025-10-08T12:30:33.108Z', NULL, 'success', NULL, '2025-10-08T12:30:33.004Z'),
  (138236, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-08T12:30:11.044Z', '2025-10-08T12:30:11.136Z', NULL, 'success', NULL, '2025-10-08T12:30:11.016Z'),
  (138235, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-08T12:30:08.024Z', '2025-10-08T12:30:30.122Z', NULL, 'success', NULL, '2025-10-08T12:30:08.005Z'),
  (138234, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T12:25:33.015Z', '2025-10-08T12:25:33.358Z', NULL, 'success', NULL, '2025-10-08T12:25:33.002Z'),
  (138233, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T12:20:33.014Z', '2025-10-08T12:20:33.135Z', NULL, 'success', NULL, '2025-10-08T12:20:33.002Z'),
  (138232, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-08T12:20:11.018Z', '2025-10-08T12:20:11.317Z', NULL, 'success', NULL, '2025-10-08T12:20:11.004Z'),
  (138231, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T12:15:33.021Z', '2025-10-08T12:15:33.368Z', NULL, 'success', NULL, '2025-10-08T12:15:33.006Z'),
  (138230, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T12:10:33.025Z', '2025-10-08T12:10:33.151Z', NULL, 'success', NULL, '2025-10-08T12:10:33.008Z'),
  (138229, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-08T12:10:11.021Z', '2025-10-08T12:10:11.179Z', NULL, 'success', NULL, '2025-10-08T12:10:11.005Z'),
  (138228, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T12:05:33.025Z', '2025-10-08T12:05:33.274Z', NULL, 'success', NULL, '2025-10-08T12:05:33.007Z'),
  (138227, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T12:00:33.025Z', '2025-10-08T12:00:33.101Z', NULL, 'success', NULL, '2025-10-08T12:00:33.005Z'),
  (138226, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-08T12:00:11.058Z', '2025-10-08T12:00:11.130Z', NULL, 'success', NULL, '2025-10-08T12:00:11.004Z'),
  (138225, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-08T12:00:08.025Z', '2025-10-08T12:00:30.898Z', NULL, 'success', NULL, '2025-10-08T12:00:08.005Z'),
  (138224, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T11:55:33.019Z', '2025-10-08T11:55:33.358Z', NULL, 'success', NULL, '2025-10-08T11:55:33.003Z'),
  (138223, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T11:50:33.019Z', '2025-10-08T11:50:33.192Z', NULL, 'success', NULL, '2025-10-08T11:50:33.002Z'),
  (138222, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-08T11:50:11.019Z', '2025-10-08T11:50:11.090Z', NULL, 'success', NULL, '2025-10-08T11:50:11.003Z'),
  (138221, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T11:45:33.018Z', '2025-10-08T11:45:33.253Z', NULL, 'success', NULL, '2025-10-08T11:45:33.004Z'),
  (138220, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T11:40:33.023Z', '2025-10-08T11:40:33.200Z', NULL, 'success', NULL, '2025-10-08T11:40:33.007Z'),
  (138219, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-08T11:40:11.023Z', '2025-10-08T11:40:11.119Z', NULL, 'success', NULL, '2025-10-08T11:40:11.006Z'),
  (138218, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T11:35:33.025Z', '2025-10-08T11:35:33.369Z', NULL, 'success', NULL, '2025-10-08T11:35:33.005Z'),
  (138217, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T11:30:33.017Z', '2025-10-08T11:30:33.086Z', NULL, 'success', NULL, '2025-10-08T11:30:33.003Z'),
  (138216, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-08T11:30:11.031Z', '2025-10-08T11:30:11.134Z', NULL, 'success', NULL, '2025-10-08T11:30:11.004Z'),
  (138215, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-08T11:30:08.024Z', '2025-10-08T11:30:29.959Z', NULL, 'success', NULL, '2025-10-08T11:30:08.007Z'),
  (138214, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T11:25:33.015Z', '2025-10-08T11:25:33.443Z', NULL, 'success', NULL, '2025-10-08T11:25:33.002Z'),
  (138213, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T11:20:33.018Z', '2025-10-08T11:20:33.258Z', NULL, 'success', NULL, '2025-10-08T11:20:33.003Z'),
  (138212, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-08T11:20:11.021Z', '2025-10-08T11:20:11.097Z', NULL, 'success', NULL, '2025-10-08T11:20:11.005Z'),
  (138211, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T11:15:33.019Z', '2025-10-08T11:15:33.302Z', NULL, 'success', NULL, '2025-10-08T11:15:33.005Z'),
  (138210, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T11:10:33.029Z', '2025-10-08T11:10:33.145Z', NULL, 'success', NULL, '2025-10-08T11:10:33.009Z'),
  (138209, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-08T11:10:11.018Z', '2025-10-08T11:10:11.172Z', NULL, 'success', NULL, '2025-10-08T11:10:11.005Z'),
  (138208, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T11:05:33.024Z', '2025-10-08T11:05:33.343Z', NULL, 'success', NULL, '2025-10-08T11:05:33.005Z'),
  (138207, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T11:00:33.024Z', '2025-10-08T11:00:33.107Z', NULL, 'success', NULL, '2025-10-08T11:00:33.003Z'),
  (138206, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-08T11:00:11.046Z', '2025-10-08T11:00:11.134Z', NULL, 'success', NULL, '2025-10-08T11:00:11.003Z'),
  (138205, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-08T11:00:08.027Z', '2025-10-08T11:00:29.782Z', NULL, 'success', NULL, '2025-10-08T11:00:08.006Z'),
  (138204, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T10:55:33.018Z', '2025-10-08T10:55:33.373Z', NULL, 'success', NULL, '2025-10-08T10:55:33.005Z'),
  (138203, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T10:50:33.018Z', '2025-10-08T10:50:33.148Z', NULL, 'success', NULL, '2025-10-08T10:50:33.004Z'),
  (138202, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-08T10:50:11.021Z', '2025-10-08T10:50:11.094Z', NULL, 'success', NULL, '2025-10-08T10:50:11.004Z'),
  (138201, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T10:45:33.018Z', '2025-10-08T10:45:33.274Z', NULL, 'success', NULL, '2025-10-08T10:45:33.005Z'),
  (138200, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T10:40:33.025Z', '2025-10-08T10:40:33.155Z', NULL, 'success', NULL, '2025-10-08T10:40:33.008Z'),
  (138199, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-08T10:40:11.022Z', '2025-10-08T10:40:11.357Z', NULL, 'success', NULL, '2025-10-08T10:40:11.004Z'),
  (138198, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T10:35:33.029Z', '2025-10-08T10:35:33.315Z', NULL, 'success', NULL, '2025-10-08T10:35:33.004Z'),
  (138197, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T10:30:33.021Z', '2025-10-08T10:30:33.100Z', NULL, 'success', NULL, '2025-10-08T10:30:33.003Z'),
  (138196, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-08T10:30:11.024Z', '2025-10-08T10:30:11.126Z', NULL, 'success', NULL, '2025-10-08T10:30:11.003Z'),
  (138195, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-08T10:30:08.022Z', '2025-10-08T10:30:30.039Z', NULL, 'success', NULL, '2025-10-08T10:30:08.006Z'),
  (138194, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T10:25:33.016Z', '2025-10-08T10:25:33.388Z', NULL, 'success', NULL, '2025-10-08T10:25:33.004Z'),
  (138193, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T10:20:33.017Z', '2025-10-08T10:20:33.293Z', NULL, 'success', NULL, '2025-10-08T10:20:33.003Z'),
  (138192, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-08T10:20:11.022Z', '2025-10-08T10:20:11.099Z', NULL, 'success', NULL, '2025-10-08T10:20:11.003Z'),
  (138191, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T10:15:33.021Z', '2025-10-08T10:15:33.340Z', NULL, 'success', NULL, '2025-10-08T10:15:33.005Z'),
  (138190, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T10:10:33.021Z', '2025-10-08T10:10:33.149Z', NULL, 'success', NULL, '2025-10-08T10:10:33.005Z'),
  (138189, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-08T10:10:11.025Z', '2025-10-08T10:10:11.108Z', NULL, 'success', NULL, '2025-10-08T10:10:11.005Z'),
  (138188, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T10:05:33.024Z', '2025-10-08T10:05:33.289Z', NULL, 'success', NULL, '2025-10-08T10:05:33.006Z'),
  (138187, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T10:00:33.016Z', '2025-10-08T10:00:33.086Z', NULL, 'success', NULL, '2025-10-08T10:00:33.002Z'),
  (138186, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-08T10:00:11.038Z', '2025-10-08T10:00:11.141Z', NULL, 'success', NULL, '2025-10-08T10:00:11.005Z'),
  (138185, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-08T10:00:08.022Z', '2025-10-08T10:00:29.953Z', NULL, 'success', NULL, '2025-10-08T10:00:08.006Z'),
  (138184, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T09:55:33.020Z', '2025-10-08T09:55:33.354Z', NULL, 'success', NULL, '2025-10-08T09:55:33.005Z'),
  (138183, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T09:50:33.017Z', '2025-10-08T09:50:33.173Z', NULL, 'success', NULL, '2025-10-08T09:50:33.003Z'),
  (138182, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-08T09:50:11.019Z', '2025-10-08T09:50:11.091Z', NULL, 'success', NULL, '2025-10-08T09:50:11.003Z'),
  (138181, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T09:45:33.022Z', '2025-10-08T09:45:33.307Z', NULL, 'success', NULL, '2025-10-08T09:45:33.003Z'),
  (138180, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T09:40:33.034Z', '2025-10-08T09:40:33.177Z', NULL, 'success', NULL, '2025-10-08T09:40:33.010Z'),
  (138179, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-08T09:40:11.021Z', '2025-10-08T09:40:11.097Z', NULL, 'success', NULL, '2025-10-08T09:40:11.005Z'),
  (138178, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T09:35:33.022Z', '2025-10-08T09:35:33.352Z', NULL, 'success', NULL, '2025-10-08T09:35:33.005Z'),
  (138177, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T09:30:33.037Z', '2025-10-08T09:30:33.109Z', NULL, 'success', NULL, '2025-10-08T09:30:33.003Z'),
  (138176, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-08T09:30:11.059Z', '2025-10-08T09:30:11.471Z', NULL, 'success', NULL, '2025-10-08T09:30:11.007Z'),
  (138175, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-08T09:30:08.033Z', '2025-10-08T09:30:30.629Z', NULL, 'success', NULL, '2025-10-08T09:30:08.007Z'),
  (138174, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T09:25:33.019Z', '2025-10-08T09:25:33.402Z', NULL, 'success', NULL, '2025-10-08T09:25:33.004Z'),
  (138173, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T09:20:33.021Z', '2025-10-08T09:20:33.167Z', NULL, 'success', NULL, '2025-10-08T09:20:33.004Z'),
  (138172, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-08T09:20:11.024Z', '2025-10-08T09:20:11.110Z', NULL, 'success', NULL, '2025-10-08T09:20:11.006Z'),
  (138171, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T09:15:33.019Z', '2025-10-08T09:15:33.384Z', NULL, 'success', NULL, '2025-10-08T09:15:33.004Z'),
  (138170, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T09:10:33.029Z', '2025-10-08T09:10:33.215Z', NULL, 'success', NULL, '2025-10-08T09:10:33.005Z'),
  (138169, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-08T09:10:11.023Z', '2025-10-08T09:10:11.116Z', NULL, 'success', NULL, '2025-10-08T09:10:11.005Z'),
  (138168, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T09:05:33.024Z', '2025-10-08T09:05:33.348Z', NULL, 'success', NULL, '2025-10-08T09:05:33.005Z'),
  (138167, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T09:00:33.071Z', '2025-10-08T09:00:33.147Z', NULL, 'success', NULL, '2025-10-08T09:00:33.002Z'),
  (138166, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-08T09:00:11.041Z', '2025-10-08T09:00:11.160Z', NULL, 'success', NULL, '2025-10-08T09:00:11.005Z'),
  (138165, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-08T09:00:08.052Z', '2025-10-08T09:00:30.261Z', NULL, 'success', NULL, '2025-10-08T09:00:08.008Z'),
  (138164, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T08:55:33.018Z', '2025-10-08T08:55:33.290Z', NULL, 'success', NULL, '2025-10-08T08:55:33.004Z'),
  (138163, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T08:50:33.018Z', '2025-10-08T08:50:33.163Z', NULL, 'success', NULL, '2025-10-08T08:50:33.006Z'),
  (138162, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-08T08:50:11.022Z', '2025-10-08T08:50:11.089Z', NULL, 'success', NULL, '2025-10-08T08:50:11.004Z'),
  (138161, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T08:45:33.021Z', '2025-10-08T08:45:33.298Z', NULL, 'success', NULL, '2025-10-08T08:45:33.004Z'),
  (138160, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T08:40:33.023Z', '2025-10-08T08:40:33.139Z', NULL, 'success', NULL, '2025-10-08T08:40:33.010Z'),
  (138159, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-08T08:40:11.019Z', '2025-10-08T08:40:11.103Z', NULL, 'success', NULL, '2025-10-08T08:40:11.004Z'),
  (138158, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T08:35:33.020Z', '2025-10-08T08:35:33.198Z', NULL, 'success', NULL, '2025-10-08T08:35:33.004Z'),
  (138157, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T08:30:33.019Z', '2025-10-08T08:30:33.137Z', NULL, 'success', NULL, '2025-10-08T08:30:33.003Z'),
  (138156, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-08T08:30:11.020Z', '2025-10-08T08:30:11.104Z', NULL, 'success', NULL, '2025-10-08T08:30:11.003Z'),
  (138155, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-08T08:30:08.031Z', '2025-10-08T08:30:30.361Z', NULL, 'success', NULL, '2025-10-08T08:30:08.006Z'),
  (138154, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T08:25:33.020Z', '2025-10-08T08:25:33.313Z', NULL, 'success', NULL, '2025-10-08T08:25:33.005Z'),
  (138153, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T08:20:33.023Z', '2025-10-08T08:20:33.181Z', NULL, 'success', NULL, '2025-10-08T08:20:33.005Z'),
  (138152, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-08T08:20:11.019Z', '2025-10-08T08:20:11.106Z', NULL, 'success', NULL, '2025-10-08T08:20:11.005Z'),
  (138151, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T08:15:33.018Z', '2025-10-08T08:15:33.187Z', NULL, 'success', NULL, '2025-10-08T08:15:33.005Z'),
  (138150, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T08:10:33.023Z', '2025-10-08T08:10:33.321Z', NULL, 'success', NULL, '2025-10-08T08:10:33.007Z'),
  (138149, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-08T08:10:11.023Z', '2025-10-08T08:10:11.122Z', NULL, 'success', NULL, '2025-10-08T08:10:11.004Z'),
  (138148, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T08:05:33.019Z', '2025-10-08T08:05:33.412Z', NULL, 'success', NULL, '2025-10-08T08:05:33.003Z'),
  (138147, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T08:00:33.019Z', '2025-10-08T08:00:33.091Z', NULL, 'success', NULL, '2025-10-08T08:00:33.003Z'),
  (138146, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-08T08:00:11.016Z', '2025-10-08T08:00:11.400Z', NULL, 'success', NULL, '2025-10-08T08:00:11.002Z'),
  (138145, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-08T08:00:08.037Z', '2025-10-08T08:00:29.891Z', NULL, 'success', NULL, '2025-10-08T08:00:08.008Z'),
  (138144, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T07:55:33.018Z', '2025-10-08T07:55:33.305Z', NULL, 'success', NULL, '2025-10-08T07:55:33.005Z'),
  (138143, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T07:50:33.016Z', '2025-10-08T07:50:33.172Z', NULL, 'success', NULL, '2025-10-08T07:50:33.003Z'),
  (138142, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-08T07:50:11.022Z', '2025-10-08T07:50:11.121Z', NULL, 'success', NULL, '2025-10-08T07:50:11.005Z'),
  (138141, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T07:45:33.016Z', '2025-10-08T07:45:33.370Z', NULL, 'success', NULL, '2025-10-08T07:45:33.003Z'),
  (138140, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T07:40:33.023Z', '2025-10-08T07:40:33.165Z', NULL, 'success', NULL, '2025-10-08T07:40:33.004Z'),
  (138139, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-08T07:40:11.021Z', '2025-10-08T07:40:11.098Z', NULL, 'success', NULL, '2025-10-08T07:40:11.004Z'),
  (138138, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T07:35:33.020Z', '2025-10-08T07:35:33.415Z', NULL, 'success', NULL, '2025-10-08T07:35:33.002Z'),
  (138137, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T07:30:33.021Z', '2025-10-08T07:30:33.119Z', NULL, 'success', NULL, '2025-10-08T07:30:33.003Z'),
  (138136, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-08T07:30:11.040Z', '2025-10-08T07:30:11.119Z', NULL, 'success', NULL, '2025-10-08T07:30:11.014Z'),
  (138135, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-08T07:30:08.035Z', '2025-10-08T07:30:29.792Z', NULL, 'success', NULL, '2025-10-08T07:30:08.005Z'),
  (138134, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T07:25:33.020Z', '2025-10-08T07:25:33.289Z', NULL, 'success', NULL, '2025-10-08T07:25:33.005Z'),
  (138133, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T07:20:33.023Z', '2025-10-08T07:20:33.229Z', NULL, 'success', NULL, '2025-10-08T07:20:33.006Z'),
  (138132, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-08T07:20:11.023Z', '2025-10-08T07:20:11.123Z', NULL, 'success', NULL, '2025-10-08T07:20:11.006Z'),
  (138131, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T07:15:33.019Z', '2025-10-08T07:15:33.260Z', NULL, 'success', NULL, '2025-10-08T07:15:33.004Z'),
  (138130, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T07:10:33.025Z', '2025-10-08T07:10:33.156Z', NULL, 'success', NULL, '2025-10-08T07:10:33.006Z'),
  (138129, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-08T07:10:11.020Z', '2025-10-08T07:10:11.119Z', NULL, 'success', NULL, '2025-10-08T07:10:11.004Z'),
  (138128, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T07:05:33.023Z', '2025-10-08T07:05:33.416Z', NULL, 'success', NULL, '2025-10-08T07:05:33.005Z'),
  (138127, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T07:00:33.019Z', '2025-10-08T07:00:33.078Z', NULL, 'success', NULL, '2025-10-08T07:00:33.003Z'),
  (138126, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-08T07:00:11.035Z', '2025-10-08T07:00:11.129Z', NULL, 'success', NULL, '2025-10-08T07:00:11.002Z'),
  (138125, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-08T07:00:08.028Z', '2025-10-08T07:00:29.477Z', NULL, 'success', NULL, '2025-10-08T07:00:08.007Z'),
  (138124, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T06:55:33.027Z', '2025-10-08T06:55:33.281Z', NULL, 'success', NULL, '2025-10-08T06:55:33.004Z'),
  (138123, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T06:50:33.018Z', '2025-10-08T06:50:33.162Z', NULL, 'success', NULL, '2025-10-08T06:50:33.003Z'),
  (138122, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-08T06:50:11.019Z', '2025-10-08T06:50:11.305Z', NULL, 'success', NULL, '2025-10-08T06:50:11.004Z'),
  (138121, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T06:45:33.021Z', '2025-10-08T06:45:33.262Z', NULL, 'success', NULL, '2025-10-08T06:45:33.005Z'),
  (138120, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T06:40:33.026Z', '2025-10-08T06:40:33.136Z', NULL, 'success', NULL, '2025-10-08T06:40:33.007Z'),
  (138119, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-08T06:40:11.019Z', '2025-10-08T06:40:11.144Z', NULL, 'success', NULL, '2025-10-08T06:40:11.003Z'),
  (138118, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T06:35:33.021Z', '2025-10-08T06:35:33.361Z', NULL, 'success', NULL, '2025-10-08T06:35:33.005Z'),
  (138117, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T06:30:33.017Z', '2025-10-08T06:30:33.104Z', NULL, 'success', NULL, '2025-10-08T06:30:33.004Z'),
  (138116, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-08T06:30:11.019Z', '2025-10-08T06:30:11.146Z', NULL, 'success', NULL, '2025-10-08T06:30:11.003Z'),
  (138115, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-08T06:30:08.023Z', '2025-10-08T06:30:29.355Z', NULL, 'success', NULL, '2025-10-08T06:30:08.006Z'),
  (138114, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T06:25:33.019Z', '2025-10-08T06:25:33.415Z', NULL, 'success', NULL, '2025-10-08T06:25:33.005Z'),
  (138113, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T06:20:33.018Z', '2025-10-08T06:20:33.184Z', NULL, 'success', NULL, '2025-10-08T06:20:33.005Z'),
  (138112, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-08T06:20:11.021Z', '2025-10-08T06:20:11.115Z', NULL, 'success', NULL, '2025-10-08T06:20:11.004Z'),
  (138111, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T06:15:33.018Z', '2025-10-08T06:15:33.326Z', NULL, 'success', NULL, '2025-10-08T06:15:33.005Z'),
  (138110, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T06:10:33.021Z', '2025-10-08T06:10:33.224Z', NULL, 'success', NULL, '2025-10-08T06:10:33.005Z'),
  (138109, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-08T06:10:11.020Z', '2025-10-08T06:10:11.131Z', NULL, 'success', NULL, '2025-10-08T06:10:11.005Z'),
  (138108, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T06:05:33.018Z', '2025-10-08T06:05:33.275Z', NULL, 'success', NULL, '2025-10-08T06:05:33.003Z'),
  (138107, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T06:00:33.020Z', '2025-10-08T06:00:33.112Z', NULL, 'success', NULL, '2025-10-08T06:00:33.004Z'),
  (138106, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-08T06:00:11.024Z', '2025-10-08T06:00:11.112Z', NULL, 'success', NULL, '2025-10-08T06:00:11.003Z'),
  (138105, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-08T06:00:08.020Z', '2025-10-08T06:00:29.203Z', NULL, 'success', NULL, '2025-10-08T06:00:08.004Z'),
  (138104, 'ae6a5952-36a0-419d-b697-17cf7bf31061', true, 'trigger', NULL, NULL, '2025-10-08T06:00:00.031Z', '2025-10-08T06:00:01.583Z', NULL, 'success', NULL, '2025-10-08T06:00:00.007Z'),
  (138103, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T05:55:33.020Z', '2025-10-08T05:55:33.282Z', NULL, 'success', NULL, '2025-10-08T05:55:33.004Z'),
  (138102, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T05:50:33.028Z', '2025-10-08T05:50:33.228Z', NULL, 'success', NULL, '2025-10-08T05:50:33.003Z'),
  (138101, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-08T05:50:11.019Z', '2025-10-08T05:50:11.103Z', NULL, 'success', NULL, '2025-10-08T05:50:11.005Z'),
  (138100, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T05:45:33.017Z', '2025-10-08T05:45:33.270Z', NULL, 'success', NULL, '2025-10-08T05:45:33.002Z'),
  (138099, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T05:40:33.022Z', '2025-10-08T05:40:33.155Z', NULL, 'success', NULL, '2025-10-08T05:40:33.005Z'),
  (138098, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-08T05:40:11.023Z', '2025-10-08T05:40:11.122Z', NULL, 'success', NULL, '2025-10-08T05:40:11.004Z'),
  (138097, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T05:35:33.019Z', '2025-10-08T05:35:33.317Z', NULL, 'success', NULL, '2025-10-08T05:35:33.004Z'),
  (138096, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T05:30:33.030Z', '2025-10-08T05:30:33.106Z', NULL, 'success', NULL, '2025-10-08T05:30:33.004Z'),
  (138095, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-08T05:30:11.033Z', '2025-10-08T05:30:11.386Z', NULL, 'success', NULL, '2025-10-08T05:30:11.002Z'),
  (138094, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-08T05:30:08.024Z', '2025-10-08T05:30:28.879Z', NULL, 'success', NULL, '2025-10-08T05:30:08.005Z'),
  (138093, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T05:25:33.020Z', '2025-10-08T05:25:33.308Z', NULL, 'success', NULL, '2025-10-08T05:25:33.004Z'),
  (138092, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T05:20:33.020Z', '2025-10-08T05:20:33.157Z', NULL, 'success', NULL, '2025-10-08T05:20:33.004Z'),
  (138091, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-08T05:20:11.023Z', '2025-10-08T05:20:11.121Z', NULL, 'success', NULL, '2025-10-08T05:20:11.002Z'),
  (138090, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T05:15:33.019Z', '2025-10-08T05:15:33.312Z', NULL, 'success', NULL, '2025-10-08T05:15:33.004Z'),
  (138089, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T05:10:33.021Z', '2025-10-08T05:10:33.158Z', NULL, 'success', NULL, '2025-10-08T05:10:33.004Z'),
  (138088, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-08T05:10:11.018Z', '2025-10-08T05:10:11.101Z', NULL, 'success', NULL, '2025-10-08T05:10:11.004Z'),
  (138087, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T05:05:33.017Z', '2025-10-08T05:05:33.311Z', NULL, 'success', NULL, '2025-10-08T05:05:33.003Z'),
  (138086, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T05:00:33.018Z', '2025-10-08T05:00:33.076Z', NULL, 'success', NULL, '2025-10-08T05:00:33.004Z'),
  (138085, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-08T05:00:11.022Z', '2025-10-08T05:00:11.097Z', NULL, 'success', NULL, '2025-10-08T05:00:11.004Z'),
  (138084, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-08T05:00:08.026Z', '2025-10-08T05:00:28.909Z', NULL, 'success', NULL, '2025-10-08T05:00:08.005Z'),
  (138083, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T04:55:33.017Z', '2025-10-08T04:55:33.307Z', NULL, 'success', NULL, '2025-10-08T04:55:33.004Z'),
  (138082, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T04:50:33.016Z', '2025-10-08T04:50:33.161Z', NULL, 'success', NULL, '2025-10-08T04:50:33.004Z'),
  (138081, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-08T04:50:11.029Z', '2025-10-08T04:50:11.116Z', NULL, 'success', NULL, '2025-10-08T04:50:11.005Z'),
  (138080, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T04:45:33.016Z', '2025-10-08T04:45:33.331Z', NULL, 'success', NULL, '2025-10-08T04:45:33.003Z'),
  (138079, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T04:40:33.023Z', '2025-10-08T04:40:33.241Z', NULL, 'success', NULL, '2025-10-08T04:40:33.006Z'),
  (138078, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-08T04:40:11.019Z', '2025-10-08T04:40:11.126Z', NULL, 'success', NULL, '2025-10-08T04:40:11.005Z'),
  (138077, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T04:35:33.021Z', '2025-10-08T04:35:33.324Z', NULL, 'success', NULL, '2025-10-08T04:35:33.002Z'),
  (138076, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T04:30:33.030Z', '2025-10-08T04:30:33.104Z', NULL, 'success', NULL, '2025-10-08T04:30:33.002Z'),
  (138075, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-08T04:30:11.034Z', '2025-10-08T04:30:11.108Z', NULL, 'success', NULL, '2025-10-08T04:30:11.004Z'),
  (138074, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-08T04:30:08.024Z', '2025-10-08T04:30:28.271Z', NULL, 'success', NULL, '2025-10-08T04:30:08.004Z'),
  (138073, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T04:25:33.016Z', '2025-10-08T04:25:33.354Z', NULL, 'success', NULL, '2025-10-08T04:25:33.002Z'),
  (138072, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T04:20:33.019Z', '2025-10-08T04:20:33.156Z', NULL, 'success', NULL, '2025-10-08T04:20:33.004Z'),
  (138071, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-08T04:20:11.019Z', '2025-10-08T04:20:11.115Z', NULL, 'success', NULL, '2025-10-08T04:20:11.006Z'),
  (138070, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T04:15:33.020Z', '2025-10-08T04:15:33.289Z', NULL, 'success', NULL, '2025-10-08T04:15:33.006Z'),
  (138069, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T04:10:33.019Z', '2025-10-08T04:10:33.208Z', NULL, 'success', NULL, '2025-10-08T04:10:33.006Z'),
  (138068, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-08T04:10:11.019Z', '2025-10-08T04:10:11.375Z', NULL, 'success', NULL, '2025-10-08T04:10:11.005Z'),
  (138067, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T04:05:33.017Z', '2025-10-08T04:05:33.309Z', NULL, 'success', NULL, '2025-10-08T04:05:33.003Z'),
  (138066, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T04:00:33.020Z', '2025-10-08T04:00:33.080Z', NULL, 'success', NULL, '2025-10-08T04:00:33.004Z'),
  (138065, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-08T04:00:11.019Z', '2025-10-08T04:00:11.136Z', NULL, 'success', NULL, '2025-10-08T04:00:11.003Z'),
  (138064, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-08T04:00:08.021Z', '2025-10-08T04:00:28.092Z', NULL, 'success', NULL, '2025-10-08T04:00:08.004Z'),
  (138063, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T03:55:33.015Z', '2025-10-08T03:55:33.337Z', NULL, 'success', NULL, '2025-10-08T03:55:33.004Z'),
  (138062, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T03:50:33.017Z', '2025-10-08T03:50:33.175Z', NULL, 'success', NULL, '2025-10-08T03:50:33.005Z'),
  (138061, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-08T03:50:11.023Z', '2025-10-08T03:50:11.103Z', NULL, 'success', NULL, '2025-10-08T03:50:11.006Z'),
  (138060, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T03:45:33.019Z', '2025-10-08T03:45:33.268Z', NULL, 'success', NULL, '2025-10-08T03:45:33.003Z'),
  (138059, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T03:40:33.019Z', '2025-10-08T03:40:33.157Z', NULL, 'success', NULL, '2025-10-08T03:40:33.004Z'),
  (138058, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-08T03:40:11.016Z', '2025-10-08T03:40:11.087Z', NULL, 'success', NULL, '2025-10-08T03:40:11.004Z'),
  (138057, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T03:35:33.017Z', '2025-10-08T03:35:33.315Z', NULL, 'success', NULL, '2025-10-08T03:35:33.003Z'),
  (138056, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T03:30:33.030Z', '2025-10-08T03:30:33.096Z', NULL, 'success', NULL, '2025-10-08T03:30:33.004Z'),
  (138055, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-08T03:30:11.039Z', '2025-10-08T03:30:11.120Z', NULL, 'success', NULL, '2025-10-08T03:30:11.004Z'),
  (138054, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-08T03:30:08.024Z', '2025-10-08T03:30:27.987Z', NULL, 'success', NULL, '2025-10-08T03:30:08.005Z'),
  (138053, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T03:25:33.019Z', '2025-10-08T03:25:33.264Z', NULL, 'success', NULL, '2025-10-08T03:25:33.003Z'),
  (138052, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T03:20:33.018Z', '2025-10-08T03:20:33.228Z', NULL, 'success', NULL, '2025-10-08T03:20:33.004Z'),
  (138051, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-08T03:20:11.020Z', '2025-10-08T03:20:11.109Z', NULL, 'success', NULL, '2025-10-08T03:20:11.005Z'),
  (138050, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T03:15:33.020Z', '2025-10-08T03:15:33.253Z', NULL, 'success', NULL, '2025-10-08T03:15:33.004Z'),
  (138049, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T03:10:33.024Z', '2025-10-08T03:10:33.142Z', NULL, 'success', NULL, '2025-10-08T03:10:33.008Z'),
  (138048, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-08T03:10:11.016Z', '2025-10-08T03:10:11.110Z', NULL, 'success', NULL, '2025-10-08T03:10:11.003Z'),
  (138047, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T03:05:33.020Z', '2025-10-08T03:05:33.291Z', NULL, 'success', NULL, '2025-10-08T03:05:33.005Z'),
  (138046, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T03:00:33.020Z', '2025-10-08T03:00:33.091Z', NULL, 'success', NULL, '2025-10-08T03:00:33.004Z'),
  (138045, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-08T03:00:11.036Z', '2025-10-08T03:00:11.120Z', NULL, 'success', NULL, '2025-10-08T03:00:11.004Z'),
  (138044, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-08T03:00:08.024Z', '2025-10-08T03:00:28.342Z', NULL, 'success', NULL, '2025-10-08T03:00:08.004Z'),
  (138043, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T02:55:33.020Z', '2025-10-08T02:55:33.360Z', NULL, 'success', NULL, '2025-10-08T02:55:33.003Z'),
  (138042, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T02:50:33.018Z', '2025-10-08T02:50:33.164Z', NULL, 'success', NULL, '2025-10-08T02:50:33.005Z'),
  (138041, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-08T02:50:11.024Z', '2025-10-08T02:50:11.362Z', NULL, 'success', NULL, '2025-10-08T02:50:11.005Z'),
  (138040, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T02:45:33.017Z', '2025-10-08T02:45:33.317Z', NULL, 'success', NULL, '2025-10-08T02:45:33.005Z'),
  (138039, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T02:40:33.026Z', '2025-10-08T02:40:33.149Z', NULL, 'success', NULL, '2025-10-08T02:40:33.008Z'),
  (138038, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-08T02:40:11.020Z', '2025-10-08T02:40:11.120Z', NULL, 'success', NULL, '2025-10-08T02:40:11.005Z'),
  (138037, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T02:35:33.019Z', '2025-10-08T02:35:33.296Z', NULL, 'success', NULL, '2025-10-08T02:35:33.003Z'),
  (138036, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T02:30:33.028Z', '2025-10-08T02:30:33.095Z', NULL, 'success', NULL, '2025-10-08T02:30:33.003Z'),
  (138035, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-08T02:30:11.026Z', '2025-10-08T02:30:11.100Z', NULL, 'success', NULL, '2025-10-08T02:30:11.005Z'),
  (138034, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-08T02:30:08.025Z', '2025-10-08T02:30:28.651Z', NULL, 'success', NULL, '2025-10-08T02:30:08.006Z'),
  (138033, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T02:25:33.023Z', '2025-10-08T02:25:33.273Z', NULL, 'success', NULL, '2025-10-08T02:25:33.006Z'),
  (138032, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T02:20:33.019Z', '2025-10-08T02:20:33.289Z', NULL, 'success', NULL, '2025-10-08T02:20:33.005Z'),
  (138031, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-08T02:20:11.023Z', '2025-10-08T02:20:11.096Z', NULL, 'success', NULL, '2025-10-08T02:20:11.005Z'),
  (138030, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T02:15:33.017Z', '2025-10-08T02:15:33.314Z', NULL, 'success', NULL, '2025-10-08T02:15:33.004Z'),
  (138029, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T02:10:33.023Z', '2025-10-08T02:10:33.175Z', NULL, 'success', NULL, '2025-10-08T02:10:33.006Z'),
  (138028, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-08T02:10:11.017Z', '2025-10-08T02:10:11.095Z', NULL, 'success', NULL, '2025-10-08T02:10:11.004Z'),
  (138027, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T02:05:33.019Z', '2025-10-08T02:05:33.201Z', NULL, 'success', NULL, '2025-10-08T02:05:33.003Z'),
  (138026, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T02:00:33.015Z', '2025-10-08T02:00:33.100Z', NULL, 'success', NULL, '2025-10-08T02:00:33.003Z'),
  (138025, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-08T02:00:11.022Z', '2025-10-08T02:00:11.121Z', NULL, 'success', NULL, '2025-10-08T02:00:11.003Z'),
  (138024, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-08T02:00:08.022Z', '2025-10-08T02:00:28.442Z', NULL, 'success', NULL, '2025-10-08T02:00:08.005Z'),
  (138023, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T01:55:33.017Z', '2025-10-08T01:55:33.354Z', NULL, 'success', NULL, '2025-10-08T01:55:33.004Z'),
  (138022, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T01:50:33.018Z', '2025-10-08T01:50:33.170Z', NULL, 'success', NULL, '2025-10-08T01:50:33.004Z'),
  (138021, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-08T01:50:11.019Z', '2025-10-08T01:50:11.114Z', NULL, 'success', NULL, '2025-10-08T01:50:11.003Z'),
  (138020, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T01:45:33.018Z', '2025-10-08T01:45:33.286Z', NULL, 'success', NULL, '2025-10-08T01:45:33.005Z'),
  (138019, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T01:40:33.022Z', '2025-10-08T01:40:33.171Z', NULL, 'success', NULL, '2025-10-08T01:40:33.006Z'),
  (138018, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-08T01:40:11.026Z', '2025-10-08T01:40:11.106Z', NULL, 'success', NULL, '2025-10-08T01:40:11.005Z'),
  (138017, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T01:35:33.018Z', '2025-10-08T01:35:33.294Z', NULL, 'success', NULL, '2025-10-08T01:35:33.004Z'),
  (138016, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T01:30:33.019Z', '2025-10-08T01:30:33.088Z', NULL, 'success', NULL, '2025-10-08T01:30:33.004Z'),
  (138015, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-08T01:30:11.019Z', '2025-10-08T01:30:11.506Z', NULL, 'success', NULL, '2025-10-08T01:30:11.004Z'),
  (138014, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-08T01:30:08.029Z', '2025-10-08T01:30:28.179Z', NULL, 'success', NULL, '2025-10-08T01:30:08.005Z'),
  (138013, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T01:25:33.018Z', '2025-10-08T01:25:33.299Z', NULL, 'success', NULL, '2025-10-08T01:25:33.004Z'),
  (138012, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T01:20:33.017Z', '2025-10-08T01:20:33.158Z', NULL, 'success', NULL, '2025-10-08T01:20:33.005Z'),
  (138011, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-08T01:20:11.018Z', '2025-10-08T01:20:11.099Z', NULL, 'success', NULL, '2025-10-08T01:20:11.002Z'),
  (138010, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T01:15:33.021Z', '2025-10-08T01:15:33.346Z', NULL, 'success', NULL, '2025-10-08T01:15:33.005Z'),
  (138009, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T01:10:33.018Z', '2025-10-08T01:10:33.155Z', NULL, 'success', NULL, '2025-10-08T01:10:33.005Z'),
  (138008, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-08T01:10:11.019Z', '2025-10-08T01:10:11.109Z', NULL, 'success', NULL, '2025-10-08T01:10:11.004Z'),
  (138007, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T01:05:33.015Z', '2025-10-08T01:05:33.188Z', NULL, 'success', NULL, '2025-10-08T01:05:33.002Z'),
  (138006, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T01:00:33.016Z', '2025-10-08T01:00:33.122Z', NULL, 'success', NULL, '2025-10-08T01:00:33.003Z'),
  (138005, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-08T01:00:11.037Z', '2025-10-08T01:00:11.111Z', NULL, 'success', NULL, '2025-10-08T01:00:11.003Z'),
  (138004, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-08T01:00:08.029Z', '2025-10-08T01:00:28.537Z', NULL, 'success', NULL, '2025-10-08T01:00:08.006Z'),
  (138003, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T00:55:33.016Z', '2025-10-08T00:55:33.275Z', NULL, 'success', NULL, '2025-10-08T00:55:33.005Z'),
  (138002, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T00:50:33.019Z', '2025-10-08T00:50:33.174Z', NULL, 'success', NULL, '2025-10-08T00:50:33.004Z'),
  (138001, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-08T00:50:11.020Z', '2025-10-08T00:50:11.108Z', NULL, 'success', NULL, '2025-10-08T00:50:11.002Z'),
  (138000, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T00:45:33.015Z', '2025-10-08T00:45:33.273Z', NULL, 'success', NULL, '2025-10-08T00:45:33.004Z'),
  (137999, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T00:40:33.030Z', '2025-10-08T00:40:33.142Z', NULL, 'success', NULL, '2025-10-08T00:40:33.006Z'),
  (137998, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-08T00:40:11.021Z', '2025-10-08T00:40:11.104Z', NULL, 'success', NULL, '2025-10-08T00:40:11.005Z'),
  (137997, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T00:35:33.032Z', '2025-10-08T00:35:33.308Z', NULL, 'success', NULL, '2025-10-08T00:35:33.004Z'),
  (137996, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T00:30:33.019Z', '2025-10-08T00:30:33.081Z', NULL, 'success', NULL, '2025-10-08T00:30:33.005Z'),
  (137995, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-08T00:30:11.029Z', '2025-10-08T00:30:11.123Z', NULL, 'success', NULL, '2025-10-08T00:30:11.010Z'),
  (137994, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-08T00:30:08.019Z', '2025-10-08T00:30:28.262Z', NULL, 'success', NULL, '2025-10-08T00:30:08.004Z'),
  (137993, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T00:25:33.018Z', '2025-10-08T00:25:33.300Z', NULL, 'success', NULL, '2025-10-08T00:25:33.005Z'),
  (137992, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T00:20:33.018Z', '2025-10-08T00:20:33.217Z', NULL, 'success', NULL, '2025-10-08T00:20:33.004Z'),
  (137991, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-08T00:20:11.018Z', '2025-10-08T00:20:11.104Z', NULL, 'success', NULL, '2025-10-08T00:20:11.002Z'),
  (137990, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T00:15:33.018Z', '2025-10-08T00:15:33.280Z', NULL, 'success', NULL, '2025-10-08T00:15:33.004Z'),
  (137989, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T00:10:33.021Z', '2025-10-08T00:10:33.156Z', NULL, 'success', NULL, '2025-10-08T00:10:33.006Z'),
  (137988, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-08T00:10:11.023Z', '2025-10-08T00:10:11.142Z', NULL, 'success', NULL, '2025-10-08T00:10:11.005Z'),
  (137987, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T00:05:33.020Z', '2025-10-08T00:05:33.330Z', NULL, 'success', NULL, '2025-10-08T00:05:33.006Z'),
  (137986, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-08T00:00:33.025Z', '2025-10-08T00:00:33.101Z', NULL, 'success', NULL, '2025-10-08T00:00:33.002Z'),
  (137985, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-08T00:00:11.125Z', '2025-10-08T00:00:12.452Z', NULL, 'success', NULL, '2025-10-08T00:00:11.007Z'),
  (137984, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-08T00:00:08.061Z', '2025-10-08T00:00:33.221Z', NULL, 'success', NULL, '2025-10-08T00:00:08.010Z'),
  (137983, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T23:55:33.014Z', '2025-10-07T23:55:33.250Z', NULL, 'success', NULL, '2025-10-07T23:55:33.002Z'),
  (137982, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T23:50:33.020Z', '2025-10-07T23:50:33.293Z', NULL, 'success', NULL, '2025-10-07T23:50:33.004Z'),
  (137981, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T23:50:11.023Z', '2025-10-07T23:50:11.112Z', NULL, 'success', NULL, '2025-10-07T23:50:11.004Z'),
  (137980, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T23:45:33.015Z', '2025-10-07T23:45:33.307Z', NULL, 'success', NULL, '2025-10-07T23:45:33.003Z'),
  (137979, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T23:40:33.021Z', '2025-10-07T23:40:33.143Z', NULL, 'success', NULL, '2025-10-07T23:40:33.004Z'),
  (137978, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T23:40:11.022Z', '2025-10-07T23:40:11.113Z', NULL, 'success', NULL, '2025-10-07T23:40:11.005Z'),
  (137977, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T23:35:33.020Z', '2025-10-07T23:35:33.382Z', NULL, 'success', NULL, '2025-10-07T23:35:33.005Z'),
  (137976, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T23:30:33.024Z', '2025-10-07T23:30:33.107Z', NULL, 'success', NULL, '2025-10-07T23:30:33.004Z'),
  (137975, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T23:30:11.037Z', '2025-10-07T23:30:11.121Z', NULL, 'success', NULL, '2025-10-07T23:30:11.004Z'),
  (137974, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-07T23:30:08.030Z', '2025-10-07T23:30:28.443Z', NULL, 'success', NULL, '2025-10-07T23:30:08.006Z'),
  (137973, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T23:25:33.019Z', '2025-10-07T23:25:33.277Z', NULL, 'success', NULL, '2025-10-07T23:25:33.004Z'),
  (137972, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T23:20:33.017Z', '2025-10-07T23:20:33.148Z', NULL, 'success', NULL, '2025-10-07T23:20:33.005Z'),
  (137971, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T23:20:11.026Z', '2025-10-07T23:20:11.118Z', NULL, 'success', NULL, '2025-10-07T23:20:11.004Z'),
  (137970, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T23:15:33.018Z', '2025-10-07T23:15:33.217Z', NULL, 'success', NULL, '2025-10-07T23:15:33.004Z'),
  (137969, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T23:10:33.022Z', '2025-10-07T23:10:33.200Z', NULL, 'success', NULL, '2025-10-07T23:10:33.005Z'),
  (137968, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T23:10:11.022Z', '2025-10-07T23:10:11.105Z', NULL, 'success', NULL, '2025-10-07T23:10:11.004Z'),
  (137967, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T23:05:33.022Z', '2025-10-07T23:05:33.269Z', NULL, 'success', NULL, '2025-10-07T23:05:33.004Z'),
  (137966, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T23:00:33.019Z', '2025-10-07T23:00:33.092Z', NULL, 'success', NULL, '2025-10-07T23:00:33.003Z'),
  (137965, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T23:00:11.024Z', '2025-10-07T23:00:11.117Z', NULL, 'success', NULL, '2025-10-07T23:00:11.002Z'),
  (137964, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-07T23:00:08.032Z', '2025-10-07T23:00:31.639Z', NULL, 'success', NULL, '2025-10-07T23:00:08.007Z'),
  (137963, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T22:55:33.023Z', '2025-10-07T22:55:33.363Z', NULL, 'success', NULL, '2025-10-07T22:55:33.004Z'),
  (137962, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T22:50:33.020Z', '2025-10-07T22:50:33.178Z', NULL, 'success', NULL, '2025-10-07T22:50:33.005Z'),
  (137961, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T22:50:11.020Z', '2025-10-07T22:50:11.110Z', NULL, 'success', NULL, '2025-10-07T22:50:11.004Z'),
  (137960, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T22:45:33.020Z', '2025-10-07T22:45:33.343Z', NULL, 'success', NULL, '2025-10-07T22:45:33.004Z'),
  (137959, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T22:40:33.024Z', '2025-10-07T22:40:33.139Z', NULL, 'success', NULL, '2025-10-07T22:40:33.006Z'),
  (137958, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T22:40:11.021Z', '2025-10-07T22:40:11.186Z', NULL, 'success', NULL, '2025-10-07T22:40:11.004Z'),
  (137957, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T22:35:33.022Z', '2025-10-07T22:35:33.399Z', NULL, 'success', NULL, '2025-10-07T22:35:33.005Z'),
  (137956, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T22:30:33.025Z', '2025-10-07T22:30:33.104Z', NULL, 'success', NULL, '2025-10-07T22:30:33.003Z'),
  (137955, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T22:30:11.171Z', '2025-10-07T22:30:11.283Z', NULL, 'success', NULL, '2025-10-07T22:30:11.041Z'),
  (137954, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-07T22:30:08.034Z', '2025-10-07T22:30:29.803Z', NULL, 'success', NULL, '2025-10-07T22:30:08.007Z'),
  (137953, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T22:25:33.022Z', '2025-10-07T22:25:33.372Z', NULL, 'success', NULL, '2025-10-07T22:25:33.005Z'),
  (137952, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T22:20:33.019Z', '2025-10-07T22:20:33.185Z', NULL, 'success', NULL, '2025-10-07T22:20:33.003Z'),
  (137951, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T22:20:11.022Z', '2025-10-07T22:20:11.346Z', NULL, 'success', NULL, '2025-10-07T22:20:11.004Z'),
  (137950, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T22:15:33.016Z', '2025-10-07T22:15:33.391Z', NULL, 'success', NULL, '2025-10-07T22:15:33.004Z'),
  (137949, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T22:10:33.025Z', '2025-10-07T22:10:33.146Z', NULL, 'success', NULL, '2025-10-07T22:10:33.006Z'),
  (137948, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T22:10:11.024Z', '2025-10-07T22:10:11.124Z', NULL, 'success', NULL, '2025-10-07T22:10:11.003Z'),
  (137947, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T22:05:33.019Z', '2025-10-07T22:05:33.429Z', NULL, 'success', NULL, '2025-10-07T22:05:33.004Z'),
  (137946, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T22:00:33.022Z', '2025-10-07T22:00:33.109Z', NULL, 'success', NULL, '2025-10-07T22:00:33.002Z'),
  (137945, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T22:00:11.025Z', '2025-10-07T22:00:11.130Z', NULL, 'success', NULL, '2025-10-07T22:00:11.004Z'),
  (137944, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-07T22:00:08.045Z', '2025-10-07T22:00:29.880Z', NULL, 'success', NULL, '2025-10-07T22:00:08.006Z'),
  (137943, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T21:55:33.018Z', '2025-10-07T21:55:33.313Z', NULL, 'success', NULL, '2025-10-07T21:55:33.002Z'),
  (137942, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T21:50:33.016Z', '2025-10-07T21:50:33.234Z', NULL, 'success', NULL, '2025-10-07T21:50:33.004Z'),
  (137941, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T21:50:11.018Z', '2025-10-07T21:50:11.093Z', NULL, 'success', NULL, '2025-10-07T21:50:11.003Z'),
  (137940, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T21:45:33.016Z', '2025-10-07T21:45:33.269Z', NULL, 'success', NULL, '2025-10-07T21:45:33.004Z'),
  (137939, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T21:40:33.029Z', '2025-10-07T21:40:33.185Z', NULL, 'success', NULL, '2025-10-07T21:40:33.008Z'),
  (137938, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T21:40:11.020Z', '2025-10-07T21:40:11.117Z', NULL, 'success', NULL, '2025-10-07T21:40:11.005Z'),
  (137937, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T21:35:33.023Z', '2025-10-07T21:35:33.341Z', NULL, 'success', NULL, '2025-10-07T21:35:33.004Z'),
  (137936, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T21:30:33.028Z', '2025-10-07T21:30:33.098Z', NULL, 'success', NULL, '2025-10-07T21:30:33.004Z'),
  (137935, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T21:30:11.044Z', '2025-10-07T21:30:11.125Z', NULL, 'success', NULL, '2025-10-07T21:30:11.015Z'),
  (137934, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-07T21:30:08.029Z', '2025-10-07T21:30:29.507Z', NULL, 'success', NULL, '2025-10-07T21:30:08.007Z'),
  (137933, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T21:25:33.016Z', '2025-10-07T21:25:33.305Z', NULL, 'success', NULL, '2025-10-07T21:25:33.005Z'),
  (137932, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T21:20:33.021Z', '2025-10-07T21:20:33.193Z', NULL, 'success', NULL, '2025-10-07T21:20:33.006Z'),
  (137931, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T21:20:11.023Z', '2025-10-07T21:20:11.123Z', NULL, 'success', NULL, '2025-10-07T21:20:11.004Z'),
  (137930, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T21:15:33.018Z', '2025-10-07T21:15:33.249Z', NULL, 'success', NULL, '2025-10-07T21:15:33.005Z'),
  (137929, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T21:10:33.017Z', '2025-10-07T21:10:33.169Z', NULL, 'success', NULL, '2025-10-07T21:10:33.005Z'),
  (137928, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T21:10:11.022Z', '2025-10-07T21:10:11.129Z', NULL, 'success', NULL, '2025-10-07T21:10:11.004Z'),
  (137927, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T21:05:33.022Z', '2025-10-07T21:05:33.291Z', NULL, 'success', NULL, '2025-10-07T21:05:33.003Z'),
  (137926, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T21:00:33.016Z', '2025-10-07T21:00:33.091Z', NULL, 'success', NULL, '2025-10-07T21:00:33.002Z'),
  (137925, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T21:00:11.075Z', '2025-10-07T21:00:12.338Z', NULL, 'success', NULL, '2025-10-07T21:00:11.033Z'),
  (137924, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-07T21:00:08.025Z', '2025-10-07T21:00:30.240Z', NULL, 'success', NULL, '2025-10-07T21:00:08.007Z'),
  (137923, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T20:55:33.018Z', '2025-10-07T20:55:33.441Z', NULL, 'success', NULL, '2025-10-07T20:55:33.004Z'),
  (137922, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T20:50:33.017Z', '2025-10-07T20:50:33.175Z', NULL, 'success', NULL, '2025-10-07T20:50:33.004Z'),
  (137921, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T20:50:11.022Z', '2025-10-07T20:50:11.098Z', NULL, 'success', NULL, '2025-10-07T20:50:11.005Z'),
  (137920, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T20:45:33.021Z', '2025-10-07T20:45:33.311Z', NULL, 'success', NULL, '2025-10-07T20:45:33.005Z'),
  (137919, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T20:40:33.026Z', '2025-10-07T20:40:33.167Z', NULL, 'success', NULL, '2025-10-07T20:40:33.006Z'),
  (137918, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T20:40:11.028Z', '2025-10-07T20:40:11.343Z', NULL, 'success', NULL, '2025-10-07T20:40:11.006Z'),
  (137917, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T20:35:33.022Z', '2025-10-07T20:35:33.150Z', NULL, 'success', NULL, '2025-10-07T20:35:33.005Z'),
  (137916, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T20:30:33.022Z', '2025-10-07T20:30:33.354Z', NULL, 'success', NULL, '2025-10-07T20:30:33.009Z'),
  (137915, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T20:30:11.025Z', '2025-10-07T20:30:11.128Z', NULL, 'success', NULL, '2025-10-07T20:30:11.004Z'),
  (137914, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-07T20:30:08.037Z', '2025-10-07T20:31:17.535Z', NULL, 'success', NULL, '2025-10-07T20:30:08.008Z'),
  (137913, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T20:25:33.018Z', '2025-10-07T20:25:33.329Z', NULL, 'success', NULL, '2025-10-07T20:25:33.005Z'),
  (137912, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T20:20:33.017Z', '2025-10-07T20:20:33.203Z', NULL, 'success', NULL, '2025-10-07T20:20:33.005Z'),
  (137911, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T20:20:11.022Z', '2025-10-07T20:20:11.126Z', NULL, 'success', NULL, '2025-10-07T20:20:11.004Z'),
  (137910, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T20:15:33.020Z', '2025-10-07T20:15:33.148Z', NULL, 'success', NULL, '2025-10-07T20:15:33.004Z'),
  (137909, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T20:10:33.025Z', '2025-10-07T20:10:33.275Z', NULL, 'success', NULL, '2025-10-07T20:10:33.008Z'),
  (137908, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T20:10:11.020Z', '2025-10-07T20:10:11.131Z', NULL, 'success', NULL, '2025-10-07T20:10:11.004Z'),
  (137907, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T20:05:33.018Z', '2025-10-07T20:05:33.187Z', NULL, 'success', NULL, '2025-10-07T20:05:33.004Z'),
  (137906, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T20:00:33.021Z', '2025-10-07T20:00:33.094Z', NULL, 'success', NULL, '2025-10-07T20:00:33.003Z'),
  (137905, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T20:00:11.085Z', '2025-10-07T20:00:11.183Z', NULL, 'success', NULL, '2025-10-07T20:00:11.027Z'),
  (137904, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-07T20:00:08.035Z', '2025-10-07T20:00:30.774Z', NULL, 'success', NULL, '2025-10-07T20:00:08.007Z'),
  (137903, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T19:55:33.015Z', '2025-10-07T19:55:33.233Z', NULL, 'success', NULL, '2025-10-07T19:55:33.002Z'),
  (137902, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T19:50:33.021Z', '2025-10-07T19:50:33.181Z', NULL, 'success', NULL, '2025-10-07T19:50:33.004Z'),
  (137901, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T19:50:11.021Z', '2025-10-07T19:50:11.116Z', NULL, 'success', NULL, '2025-10-07T19:50:11.003Z'),
  (137900, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T19:45:33.021Z', '2025-10-07T19:45:33.330Z', NULL, 'success', NULL, '2025-10-07T19:45:33.005Z'),
  (137899, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T19:40:33.032Z', '2025-10-07T19:40:33.242Z', NULL, 'success', NULL, '2025-10-07T19:40:33.015Z'),
  (137898, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T19:40:11.021Z', '2025-10-07T19:40:11.128Z', NULL, 'success', NULL, '2025-10-07T19:40:11.004Z'),
  (137897, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T19:35:33.020Z', '2025-10-07T19:35:33.353Z', NULL, 'success', NULL, '2025-10-07T19:35:33.004Z'),
  (137896, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T19:30:33.018Z', '2025-10-07T19:30:33.093Z', NULL, 'success', NULL, '2025-10-07T19:30:33.004Z'),
  (137895, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T19:30:11.063Z', '2025-10-07T19:30:11.454Z', NULL, 'success', NULL, '2025-10-07T19:30:11.012Z'),
  (137894, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-07T19:30:08.024Z', '2025-10-07T19:30:30.614Z', NULL, 'success', NULL, '2025-10-07T19:30:08.006Z'),
  (137893, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T19:25:33.025Z', '2025-10-07T19:25:33.331Z', NULL, 'success', NULL, '2025-10-07T19:25:33.003Z'),
  (137892, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T19:20:33.023Z', '2025-10-07T19:20:33.204Z', NULL, 'success', NULL, '2025-10-07T19:20:33.006Z'),
  (137891, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T19:20:11.021Z', '2025-10-07T19:20:11.111Z', NULL, 'success', NULL, '2025-10-07T19:20:11.003Z'),
  (137890, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T19:15:33.021Z', '2025-10-07T19:15:33.341Z', NULL, 'success', NULL, '2025-10-07T19:15:33.007Z'),
  (137889, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T19:10:33.017Z', '2025-10-07T19:10:33.144Z', NULL, 'success', NULL, '2025-10-07T19:10:33.003Z'),
  (137888, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T19:10:11.022Z', '2025-10-07T19:10:11.129Z', NULL, 'success', NULL, '2025-10-07T19:10:11.005Z'),
  (137887, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T19:05:33.017Z', '2025-10-07T19:05:33.265Z', NULL, 'success', NULL, '2025-10-07T19:05:33.004Z'),
  (137886, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T19:00:33.019Z', '2025-10-07T19:00:33.166Z', NULL, 'success', NULL, '2025-10-07T19:00:33.003Z'),
  (137885, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T19:00:11.030Z', '2025-10-07T19:00:11.149Z', NULL, 'success', NULL, '2025-10-07T19:00:11.004Z'),
  (137884, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-07T19:00:08.029Z', '2025-10-07T19:00:30.434Z', NULL, 'success', NULL, '2025-10-07T19:00:08.007Z'),
  (137883, 'ae6a5952-36a0-419d-b697-17cf7bf31061', true, 'trigger', NULL, NULL, '2025-10-07T19:00:00.031Z', '2025-10-07T19:00:01.000Z', NULL, 'success', NULL, '2025-10-07T19:00:00.009Z'),
  (137882, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T18:55:33.019Z', '2025-10-07T18:55:33.251Z', NULL, 'success', NULL, '2025-10-07T18:55:33.002Z'),
  (137881, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T18:50:33.019Z', '2025-10-07T18:50:33.182Z', NULL, 'success', NULL, '2025-10-07T18:50:33.005Z'),
  (137880, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T18:50:11.022Z', '2025-10-07T18:50:11.132Z', NULL, 'success', NULL, '2025-10-07T18:50:11.004Z'),
  (137879, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T18:45:33.020Z', '2025-10-07T18:45:33.348Z', NULL, 'success', NULL, '2025-10-07T18:45:33.006Z'),
  (137878, 'd7c4b9c9-6755-41f1-bbe7-c3d1b229baca', false, 'error', NULL, NULL, '2025-10-07T18:41:33.217Z', '2025-10-07T18:41:33.248Z', NULL, 'error', NULL, '2025-10-07T18:41:33.206Z'),
  (137877, '13f468d3-13a0-4383-b432-8986556e7be4', false, 'integrated', NULL, NULL, '2025-10-07T18:41:30.956Z', '2025-10-07T18:41:33.173Z', NULL, 'error', NULL, '2025-10-07T18:41:30.938Z'),
  (137876, 'c5b22202-d4e2-42f2-95d7-887395682461', false, 'trigger', NULL, NULL, '2025-10-07T18:41:19.258Z', '2025-10-07T18:41:33.186Z', NULL, 'error', NULL, '2025-10-07T18:41:19.228Z'),
  (137875, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T18:40:33.022Z', '2025-10-07T18:40:33.225Z', NULL, 'success', NULL, '2025-10-07T18:40:33.008Z'),
  (137874, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T18:40:11.022Z', '2025-10-07T18:40:11.153Z', NULL, 'success', NULL, '2025-10-07T18:40:11.004Z'),
  (137873, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T18:35:33.021Z', '2025-10-07T18:35:33.285Z', NULL, 'success', NULL, '2025-10-07T18:35:33.003Z'),
  (137872, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T18:30:33.022Z', '2025-10-07T18:30:33.107Z', NULL, 'success', NULL, '2025-10-07T18:30:33.003Z'),
  (137871, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T18:30:11.022Z', '2025-10-07T18:30:11.133Z', NULL, 'success', NULL, '2025-10-07T18:30:11.002Z'),
  (137870, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-07T18:30:08.026Z', '2025-10-07T18:30:29.831Z', NULL, 'success', NULL, '2025-10-07T18:30:08.006Z'),
  (137869, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T18:25:33.024Z', '2025-10-07T18:25:33.338Z', NULL, 'success', NULL, '2025-10-07T18:25:33.006Z'),
  (137868, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T18:20:33.032Z', '2025-10-07T18:20:33.232Z', NULL, 'success', NULL, '2025-10-07T18:20:33.006Z'),
  (137867, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T18:20:11.025Z', '2025-10-07T18:20:11.106Z', NULL, 'success', NULL, '2025-10-07T18:20:11.005Z'),
  (137866, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T18:15:33.020Z', '2025-10-07T18:15:33.316Z', NULL, 'success', NULL, '2025-10-07T18:15:33.004Z'),
  (137865, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T18:10:33.025Z', '2025-10-07T18:10:33.153Z', NULL, 'success', NULL, '2025-10-07T18:10:33.007Z'),
  (137864, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T18:10:11.022Z', '2025-10-07T18:10:11.113Z', NULL, 'success', NULL, '2025-10-07T18:10:11.003Z'),
  (137863, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T18:05:33.019Z', '2025-10-07T18:05:33.299Z', NULL, 'success', NULL, '2025-10-07T18:05:33.004Z'),
  (137862, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T18:00:33.018Z', '2025-10-07T18:00:33.097Z', NULL, 'success', NULL, '2025-10-07T18:00:33.005Z'),
  (137861, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T18:00:11.020Z', '2025-10-07T18:00:11.127Z', NULL, 'success', NULL, '2025-10-07T18:00:11.003Z'),
  (137860, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-07T18:00:08.023Z', '2025-10-07T18:00:30.491Z', NULL, 'success', NULL, '2025-10-07T18:00:08.006Z'),
  (137859, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T17:55:33.021Z', '2025-10-07T17:55:33.315Z', NULL, 'success', NULL, '2025-10-07T17:55:33.006Z'),
  (137858, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T17:50:33.022Z', '2025-10-07T17:50:33.195Z', NULL, 'success', NULL, '2025-10-07T17:50:33.006Z'),
  (137857, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T17:50:11.025Z', '2025-10-07T17:50:11.360Z', NULL, 'success', NULL, '2025-10-07T17:50:11.005Z'),
  (137856, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T17:45:33.020Z', '2025-10-07T17:45:33.416Z', NULL, 'success', NULL, '2025-10-07T17:45:33.004Z'),
  (137855, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T17:40:33.031Z', '2025-10-07T17:40:33.249Z', NULL, 'success', NULL, '2025-10-07T17:40:33.008Z'),
  (137854, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T17:40:11.019Z', '2025-10-07T17:40:11.104Z', NULL, 'success', NULL, '2025-10-07T17:40:11.005Z'),
  (137853, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T17:35:33.021Z', '2025-10-07T17:35:33.305Z', NULL, 'success', NULL, '2025-10-07T17:35:33.004Z'),
  (137852, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T17:30:33.033Z', '2025-10-07T17:30:33.107Z', NULL, 'success', NULL, '2025-10-07T17:30:33.003Z'),
  (137851, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T17:30:11.022Z', '2025-10-07T17:30:11.114Z', NULL, 'success', NULL, '2025-10-07T17:30:11.005Z'),
  (137850, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-07T17:30:08.044Z', '2025-10-07T17:30:30.424Z', NULL, 'success', NULL, '2025-10-07T17:30:08.008Z'),
  (137849, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T17:25:33.019Z', '2025-10-07T17:25:33.342Z', NULL, 'success', NULL, '2025-10-07T17:25:33.006Z'),
  (137848, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T17:20:33.024Z', '2025-10-07T17:20:33.219Z', NULL, 'success', NULL, '2025-10-07T17:20:33.004Z'),
  (137847, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T17:20:11.020Z', '2025-10-07T17:20:11.095Z', NULL, 'success', NULL, '2025-10-07T17:20:11.002Z'),
  (137846, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T17:15:33.017Z', '2025-10-07T17:15:33.280Z', NULL, 'success', NULL, '2025-10-07T17:15:33.003Z'),
  (137845, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T17:10:33.019Z', '2025-10-07T17:10:33.157Z', NULL, 'success', NULL, '2025-10-07T17:10:33.004Z'),
  (137844, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T17:10:11.025Z', '2025-10-07T17:10:11.106Z', NULL, 'success', NULL, '2025-10-07T17:10:11.005Z'),
  (137843, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T17:05:33.027Z', '2025-10-07T17:05:33.273Z', NULL, 'success', NULL, '2025-10-07T17:05:33.005Z'),
  (137842, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T17:00:33.019Z', '2025-10-07T17:00:33.122Z', NULL, 'success', NULL, '2025-10-07T17:00:33.003Z'),
  (137841, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T17:00:11.018Z', '2025-10-07T17:00:11.124Z', NULL, 'success', NULL, '2025-10-07T17:00:11.002Z'),
  (137840, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-07T17:00:08.027Z', '2025-10-07T17:00:30.148Z', NULL, 'success', NULL, '2025-10-07T17:00:08.006Z'),
  (137839, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T16:55:33.019Z', '2025-10-07T16:55:33.284Z', NULL, 'success', NULL, '2025-10-07T16:55:33.005Z'),
  (137838, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T16:50:33.020Z', '2025-10-07T16:50:33.162Z', NULL, 'success', NULL, '2025-10-07T16:50:33.005Z'),
  (137837, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T16:50:11.019Z', '2025-10-07T16:50:11.092Z', NULL, 'success', NULL, '2025-10-07T16:50:11.002Z'),
  (137836, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T16:45:33.059Z', '2025-10-07T16:45:33.428Z', NULL, 'success', NULL, '2025-10-07T16:45:33.004Z'),
  (137835, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T16:40:33.024Z', '2025-10-07T16:40:33.211Z', NULL, 'success', NULL, '2025-10-07T16:40:33.004Z'),
  (137834, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T16:40:11.029Z', '2025-10-07T16:40:11.106Z', NULL, 'success', NULL, '2025-10-07T16:40:11.004Z'),
  (137833, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T16:35:33.055Z', '2025-10-07T16:35:33.331Z', NULL, 'success', NULL, '2025-10-07T16:35:33.003Z'),
  (137832, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T16:30:33.018Z', '2025-10-07T16:30:33.085Z', NULL, 'success', NULL, '2025-10-07T16:30:33.004Z'),
  (137831, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T16:30:11.024Z', '2025-10-07T16:30:11.104Z', NULL, 'success', NULL, '2025-10-07T16:30:11.004Z'),
  (137830, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-07T16:30:08.027Z', '2025-10-07T16:30:30.790Z', NULL, 'success', NULL, '2025-10-07T16:30:08.006Z'),
  (137829, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T16:25:33.018Z', '2025-10-07T16:25:33.316Z', NULL, 'success', NULL, '2025-10-07T16:25:33.005Z'),
  (137828, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T16:20:33.021Z', '2025-10-07T16:20:33.190Z', NULL, 'success', NULL, '2025-10-07T16:20:33.005Z'),
  (137827, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T16:20:11.030Z', '2025-10-07T16:20:11.113Z', NULL, 'success', NULL, '2025-10-07T16:20:11.004Z'),
  (137826, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T16:15:33.018Z', '2025-10-07T16:15:33.214Z', NULL, 'success', NULL, '2025-10-07T16:15:33.004Z'),
  (137825, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T16:10:33.030Z', '2025-10-07T16:10:33.345Z', NULL, 'success', NULL, '2025-10-07T16:10:33.009Z'),
  (137824, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T16:10:11.022Z', '2025-10-07T16:10:11.344Z', NULL, 'success', NULL, '2025-10-07T16:10:11.004Z'),
  (137823, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T16:05:33.023Z', '2025-10-07T16:05:33.389Z', NULL, 'success', NULL, '2025-10-07T16:05:33.005Z'),
  (137822, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T16:00:33.031Z', '2025-10-07T16:00:33.104Z', NULL, 'success', NULL, '2025-10-07T16:00:33.004Z'),
  (137821, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T16:00:11.023Z', '2025-10-07T16:00:11.128Z', NULL, 'success', NULL, '2025-10-07T16:00:11.002Z'),
  (137820, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-07T16:00:08.036Z', '2025-10-07T16:00:30.019Z', NULL, 'success', NULL, '2025-10-07T16:00:08.006Z'),
  (137819, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T15:55:33.020Z', '2025-10-07T15:55:33.318Z', NULL, 'success', NULL, '2025-10-07T15:55:33.007Z'),
  (137818, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T15:50:33.019Z', '2025-10-07T15:50:33.207Z', NULL, 'success', NULL, '2025-10-07T15:50:33.004Z'),
  (137817, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T15:50:11.018Z', '2025-10-07T15:50:11.086Z', NULL, 'success', NULL, '2025-10-07T15:50:11.002Z'),
  (137816, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T15:45:33.020Z', '2025-10-07T15:45:33.233Z', NULL, 'success', NULL, '2025-10-07T15:45:33.005Z'),
  (137815, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T15:40:33.022Z', '2025-10-07T15:40:33.262Z', NULL, 'success', NULL, '2025-10-07T15:40:33.004Z'),
  (137814, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T15:40:11.023Z', '2025-10-07T15:40:11.113Z', NULL, 'success', NULL, '2025-10-07T15:40:11.005Z'),
  (137813, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T15:35:33.025Z', '2025-10-07T15:35:33.340Z', NULL, 'success', NULL, '2025-10-07T15:35:33.004Z'),
  (137812, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T15:30:33.019Z', '2025-10-07T15:30:33.109Z', NULL, 'success', NULL, '2025-10-07T15:30:33.004Z'),
  (137811, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T15:30:11.018Z', '2025-10-07T15:30:11.108Z', NULL, 'success', NULL, '2025-10-07T15:30:11.002Z'),
  (137810, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-07T15:30:08.027Z', '2025-10-07T15:30:30.551Z', NULL, 'success', NULL, '2025-10-07T15:30:08.006Z'),
  (137809, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T15:25:33.022Z', '2025-10-07T15:25:33.282Z', NULL, 'success', NULL, '2025-10-07T15:25:33.004Z'),
  (137808, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T15:20:33.016Z', '2025-10-07T15:20:33.188Z', NULL, 'success', NULL, '2025-10-07T15:20:33.002Z'),
  (137807, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T15:20:11.024Z', '2025-10-07T15:20:11.113Z', NULL, 'success', NULL, '2025-10-07T15:20:11.003Z'),
  (137806, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T15:15:33.028Z', '2025-10-07T15:15:33.417Z', NULL, 'success', NULL, '2025-10-07T15:15:33.004Z'),
  (137805, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T15:10:33.020Z', '2025-10-07T15:10:33.169Z', NULL, 'success', NULL, '2025-10-07T15:10:33.003Z'),
  (137804, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T15:10:11.029Z', '2025-10-07T15:10:11.104Z', NULL, 'success', NULL, '2025-10-07T15:10:11.005Z'),
  (137803, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T15:05:33.026Z', '2025-10-07T15:05:33.342Z', NULL, 'success', NULL, '2025-10-07T15:05:33.004Z'),
  (137802, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T15:00:33.020Z', '2025-10-07T15:00:33.100Z', NULL, 'success', NULL, '2025-10-07T15:00:33.004Z'),
  (137801, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T15:00:11.035Z', '2025-10-07T15:00:11.148Z', NULL, 'success', NULL, '2025-10-07T15:00:11.002Z'),
  (137800, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-07T15:00:08.028Z', '2025-10-07T15:00:30.457Z', NULL, 'success', NULL, '2025-10-07T15:00:08.006Z'),
  (137799, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T14:55:33.021Z', '2025-10-07T14:55:33.286Z', NULL, 'success', NULL, '2025-10-07T14:55:33.005Z'),
  (137798, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T14:50:33.017Z', '2025-10-07T14:50:33.187Z', NULL, 'success', NULL, '2025-10-07T14:50:33.004Z'),
  (137797, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T14:50:11.020Z', '2025-10-07T14:50:11.094Z', NULL, 'success', NULL, '2025-10-07T14:50:11.003Z'),
  (137796, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T14:45:33.019Z', '2025-10-07T14:45:33.252Z', NULL, 'success', NULL, '2025-10-07T14:45:33.006Z'),
  (137795, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T14:40:33.024Z', '2025-10-07T14:40:33.182Z', NULL, 'success', NULL, '2025-10-07T14:40:33.008Z'),
  (137794, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T14:40:11.022Z', '2025-10-07T14:40:11.368Z', NULL, 'success', NULL, '2025-10-07T14:40:11.006Z'),
  (137793, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T14:35:33.025Z', '2025-10-07T14:35:33.369Z', NULL, 'success', NULL, '2025-10-07T14:35:33.007Z'),
  (137792, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T14:30:33.024Z', '2025-10-07T14:30:33.106Z', NULL, 'success', NULL, '2025-10-07T14:30:33.006Z'),
  (137791, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T14:30:11.025Z', '2025-10-07T14:30:11.099Z', NULL, 'success', NULL, '2025-10-07T14:30:11.006Z'),
  (137790, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-07T14:30:08.035Z', '2025-10-07T14:30:30.664Z', NULL, 'success', NULL, '2025-10-07T14:30:08.007Z'),
  (137789, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T14:25:33.018Z', '2025-10-07T14:25:33.313Z', NULL, 'success', NULL, '2025-10-07T14:25:33.004Z'),
  (137788, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T14:20:33.020Z', '2025-10-07T14:20:33.196Z', NULL, 'success', NULL, '2025-10-07T14:20:33.004Z'),
  (137787, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T14:20:11.025Z', '2025-10-07T14:20:11.112Z', NULL, 'success', NULL, '2025-10-07T14:20:11.003Z'),
  (137786, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T14:15:33.021Z', '2025-10-07T14:15:33.304Z', NULL, 'success', NULL, '2025-10-07T14:15:33.004Z'),
  (137785, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T14:10:33.034Z', '2025-10-07T14:10:33.181Z', NULL, 'success', NULL, '2025-10-07T14:10:33.005Z'),
  (137784, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T14:10:11.025Z', '2025-10-07T14:10:11.104Z', NULL, 'success', NULL, '2025-10-07T14:10:11.004Z'),
  (137783, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T14:05:33.024Z', '2025-10-07T14:05:33.317Z', NULL, 'success', NULL, '2025-10-07T14:05:33.005Z'),
  (137782, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T14:00:33.019Z', '2025-10-07T14:00:33.105Z', NULL, 'success', NULL, '2025-10-07T14:00:33.004Z'),
  (137781, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T14:00:11.027Z', '2025-10-07T14:00:11.103Z', NULL, 'success', NULL, '2025-10-07T14:00:11.002Z'),
  (137780, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-07T14:00:08.027Z', '2025-10-07T14:00:30.301Z', NULL, 'success', NULL, '2025-10-07T14:00:08.007Z'),
  (137779, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T13:55:33.019Z', '2025-10-07T13:55:33.281Z', NULL, 'success', NULL, '2025-10-07T13:55:33.003Z'),
  (137778, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T13:50:33.019Z', '2025-10-07T13:50:33.172Z', NULL, 'success', NULL, '2025-10-07T13:50:33.005Z'),
  (137777, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T13:50:11.023Z', '2025-10-07T13:50:11.202Z', NULL, 'success', NULL, '2025-10-07T13:50:11.003Z'),
  (137776, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T13:45:33.017Z', '2025-10-07T13:45:33.322Z', NULL, 'success', NULL, '2025-10-07T13:45:33.004Z'),
  (137775, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T13:40:33.021Z', '2025-10-07T13:40:33.141Z', NULL, 'success', NULL, '2025-10-07T13:40:33.005Z'),
  (137774, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T13:40:11.018Z', '2025-10-07T13:40:11.094Z', NULL, 'success', NULL, '2025-10-07T13:40:11.006Z'),
  (137773, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T13:35:33.022Z', '2025-10-07T13:35:33.291Z', NULL, 'success', NULL, '2025-10-07T13:35:33.005Z'),
  (137772, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T13:30:33.018Z', '2025-10-07T13:30:33.102Z', NULL, 'success', NULL, '2025-10-07T13:30:33.004Z'),
  (137771, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T13:30:11.065Z', '2025-10-07T13:30:11.159Z', NULL, 'success', NULL, '2025-10-07T13:30:11.018Z'),
  (137770, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-07T13:30:08.027Z', '2025-10-07T13:30:30.660Z', NULL, 'success', NULL, '2025-10-07T13:30:08.006Z'),
  (137769, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T13:25:33.021Z', '2025-10-07T13:25:33.388Z', NULL, 'success', NULL, '2025-10-07T13:25:33.005Z'),
  (137768, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T13:20:33.018Z', '2025-10-07T13:20:33.186Z', NULL, 'success', NULL, '2025-10-07T13:20:33.004Z'),
  (137767, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T13:20:11.022Z', '2025-10-07T13:20:11.085Z', NULL, 'success', NULL, '2025-10-07T13:20:11.004Z'),
  (137766, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T13:15:33.018Z', '2025-10-07T13:15:33.358Z', NULL, 'success', NULL, '2025-10-07T13:15:33.005Z'),
  (137765, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T13:10:33.022Z', '2025-10-07T13:10:33.180Z', NULL, 'success', NULL, '2025-10-07T13:10:33.005Z'),
  (137764, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T13:10:11.029Z', '2025-10-07T13:10:11.399Z', NULL, 'success', NULL, '2025-10-07T13:10:11.005Z'),
  (137763, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T13:05:33.027Z', '2025-10-07T13:05:33.334Z', NULL, 'success', NULL, '2025-10-07T13:05:33.006Z'),
  (137762, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T13:00:33.017Z', '2025-10-07T13:00:33.086Z', NULL, 'success', NULL, '2025-10-07T13:00:33.002Z'),
  (137761, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T13:00:11.031Z', '2025-10-07T13:00:11.101Z', NULL, 'success', NULL, '2025-10-07T13:00:11.003Z'),
  (137760, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-07T13:00:08.027Z', '2025-10-07T13:00:30.188Z', NULL, 'success', NULL, '2025-10-07T13:00:08.006Z'),
  (137759, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T12:55:33.016Z', '2025-10-07T12:55:33.322Z', NULL, 'success', NULL, '2025-10-07T12:55:33.004Z'),
  (137758, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T12:50:33.019Z', '2025-10-07T12:50:33.171Z', NULL, 'success', NULL, '2025-10-07T12:50:33.005Z'),
  (137757, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T12:50:11.020Z', '2025-10-07T12:50:11.115Z', NULL, 'success', NULL, '2025-10-07T12:50:11.004Z'),
  (137756, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T12:45:33.016Z', '2025-10-07T12:45:33.246Z', NULL, 'success', NULL, '2025-10-07T12:45:33.004Z'),
  (137755, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T12:40:33.018Z', '2025-10-07T12:40:33.158Z', NULL, 'success', NULL, '2025-10-07T12:40:33.004Z'),
  (137754, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T12:40:11.022Z', '2025-10-07T12:40:11.116Z', NULL, 'success', NULL, '2025-10-07T12:40:11.006Z'),
  (137753, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T12:35:33.018Z', '2025-10-07T12:35:33.294Z', NULL, 'success', NULL, '2025-10-07T12:35:33.004Z'),
  (137752, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T12:30:33.020Z', '2025-10-07T12:30:33.104Z', NULL, 'success', NULL, '2025-10-07T12:30:33.004Z'),
  (137751, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T12:30:11.022Z', '2025-10-07T12:30:11.131Z', NULL, 'success', NULL, '2025-10-07T12:30:11.005Z'),
  (137750, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-07T12:30:08.025Z', '2025-10-07T12:30:30.558Z', NULL, 'success', NULL, '2025-10-07T12:30:08.006Z'),
  (137749, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T12:25:33.015Z', '2025-10-07T12:25:33.335Z', NULL, 'success', NULL, '2025-10-07T12:25:33.004Z'),
  (137748, 'd7c4b9c9-6755-41f1-bbe7-c3d1b229baca', false, 'error', NULL, NULL, '2025-10-07T12:24:57.168Z', '2025-10-07T12:24:57.188Z', NULL, 'error', NULL, '2025-10-07T12:24:57.157Z'),
  (137747, '13f468d3-13a0-4383-b432-8986556e7be4', false, 'integrated', NULL, NULL, '2025-10-07T12:24:54.904Z', '2025-10-07T12:24:57.128Z', NULL, 'error', NULL, '2025-10-07T12:24:54.887Z'),
  (137746, '531851ec-f877-4ca0-8d30-d88ffaf9b725', true, 'integrated', NULL, NULL, '2025-10-07T12:24:38.756Z', '2025-10-07T12:24:41.472Z', NULL, 'success', NULL, '2025-10-07T12:24:38.741Z'),
  (137745, 'c5b22202-d4e2-42f2-95d7-887395682461', false, 'trigger', NULL, NULL, '2025-10-07T12:24:19.319Z', '2025-10-07T12:24:57.138Z', NULL, 'error', NULL, '2025-10-07T12:24:19.296Z'),
  (137744, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T12:20:33.022Z', '2025-10-07T12:20:33.195Z', NULL, 'success', NULL, '2025-10-07T12:20:33.005Z'),
  (137743, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T12:20:11.022Z', '2025-10-07T12:20:11.092Z', NULL, 'success', NULL, '2025-10-07T12:20:11.003Z'),
  (137742, 'd7c4b9c9-6755-41f1-bbe7-c3d1b229baca', false, 'error', NULL, NULL, '2025-10-07T12:18:34.331Z', '2025-10-07T12:18:34.358Z', NULL, 'error', NULL, '2025-10-07T12:18:34.321Z'),
  (137741, '13f468d3-13a0-4383-b432-8986556e7be4', false, 'integrated', NULL, NULL, '2025-10-07T12:18:32.053Z', '2025-10-07T12:18:34.288Z', NULL, 'error', NULL, '2025-10-07T12:18:32.040Z'),
  (137740, 'c5b22202-d4e2-42f2-95d7-887395682461', false, 'trigger', NULL, NULL, '2025-10-07T12:18:19.264Z', '2025-10-07T12:18:34.300Z', NULL, 'error', NULL, '2025-10-07T12:18:19.237Z'),
  (137739, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T12:15:33.020Z', '2025-10-07T12:15:33.288Z', NULL, 'success', NULL, '2025-10-07T12:15:33.005Z'),
  (137738, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T12:10:33.033Z', '2025-10-07T12:10:33.162Z', NULL, 'success', NULL, '2025-10-07T12:10:33.010Z'),
  (137737, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T12:10:11.026Z', '2025-10-07T12:10:11.174Z', NULL, 'success', NULL, '2025-10-07T12:10:11.004Z'),
  (137736, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T12:05:33.029Z', '2025-10-07T12:05:33.349Z', NULL, 'success', NULL, '2025-10-07T12:05:33.004Z'),
  (137735, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T12:00:33.019Z', '2025-10-07T12:00:33.094Z', NULL, 'success', NULL, '2025-10-07T12:00:33.003Z'),
  (137734, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T12:00:11.030Z', '2025-10-07T12:00:11.122Z', NULL, 'success', NULL, '2025-10-07T12:00:11.004Z'),
  (137733, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-07T12:00:08.042Z', '2025-10-07T12:00:30.393Z', NULL, 'success', NULL, '2025-10-07T12:00:08.011Z'),
  (137732, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T11:55:33.020Z', '2025-10-07T11:55:33.300Z', NULL, 'success', NULL, '2025-10-07T11:55:33.005Z'),
  (137731, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T11:50:33.022Z', '2025-10-07T11:50:33.180Z', NULL, 'success', NULL, '2025-10-07T11:50:33.004Z'),
  (137730, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T11:50:11.029Z', '2025-10-07T11:50:11.186Z', NULL, 'success', NULL, '2025-10-07T11:50:11.005Z'),
  (137729, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T11:45:33.018Z', '2025-10-07T11:45:33.260Z', NULL, 'success', NULL, '2025-10-07T11:45:33.004Z'),
  (137728, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T11:40:33.034Z', '2025-10-07T11:40:33.171Z', NULL, 'success', NULL, '2025-10-07T11:40:33.011Z'),
  (137727, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T11:40:11.024Z', '2025-10-07T11:40:11.153Z', NULL, 'success', NULL, '2025-10-07T11:40:11.003Z'),
  (137726, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T11:35:33.025Z', '2025-10-07T11:35:33.321Z', NULL, 'success', NULL, '2025-10-07T11:35:33.004Z'),
  (137725, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T11:30:33.020Z', '2025-10-07T11:30:33.105Z', NULL, 'success', NULL, '2025-10-07T11:30:33.004Z'),
  (137724, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T11:30:11.021Z', '2025-10-07T11:30:11.322Z', NULL, 'success', NULL, '2025-10-07T11:30:11.002Z'),
  (137723, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-07T11:30:08.019Z', '2025-10-07T11:30:30.023Z', NULL, 'success', NULL, '2025-10-07T11:30:08.006Z'),
  (137722, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T11:25:33.016Z', '2025-10-07T11:25:33.306Z', NULL, 'success', NULL, '2025-10-07T11:25:33.005Z'),
  (137721, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T11:20:33.020Z', '2025-10-07T11:20:33.176Z', NULL, 'success', NULL, '2025-10-07T11:20:33.005Z'),
  (137720, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T11:20:11.028Z', '2025-10-07T11:20:11.100Z', NULL, 'success', NULL, '2025-10-07T11:20:11.004Z'),
  (137719, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T11:15:33.024Z', '2025-10-07T11:15:33.366Z', NULL, 'success', NULL, '2025-10-07T11:15:33.005Z'),
  (137718, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T11:10:33.024Z', '2025-10-07T11:10:33.141Z', NULL, 'success', NULL, '2025-10-07T11:10:33.005Z'),
  (137717, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T11:10:11.019Z', '2025-10-07T11:10:11.091Z', NULL, 'success', NULL, '2025-10-07T11:10:11.002Z'),
  (137716, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T11:05:33.023Z', '2025-10-07T11:05:33.333Z', NULL, 'success', NULL, '2025-10-07T11:05:33.005Z'),
  (137715, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T11:00:33.042Z', '2025-10-07T11:00:33.109Z', NULL, 'success', NULL, '2025-10-07T11:00:33.003Z'),
  (137714, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T11:00:11.022Z', '2025-10-07T11:00:11.104Z', NULL, 'success', NULL, '2025-10-07T11:00:11.003Z'),
  (137713, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-07T11:00:08.031Z', '2025-10-07T11:00:30.005Z', NULL, 'success', NULL, '2025-10-07T11:00:08.007Z'),
  (137712, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T10:55:33.015Z', '2025-10-07T10:55:33.332Z', NULL, 'success', NULL, '2025-10-07T10:55:33.004Z'),
  (137711, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T10:50:33.020Z', '2025-10-07T10:50:33.134Z', NULL, 'success', NULL, '2025-10-07T10:50:33.006Z'),
  (137710, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T10:50:11.021Z', '2025-10-07T10:50:11.107Z', NULL, 'success', NULL, '2025-10-07T10:50:11.004Z'),
  (137709, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T10:45:33.019Z', '2025-10-07T10:45:33.293Z', NULL, 'success', NULL, '2025-10-07T10:45:33.005Z'),
  (137708, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T10:40:33.021Z', '2025-10-07T10:40:33.139Z', NULL, 'success', NULL, '2025-10-07T10:40:33.004Z'),
  (137707, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T10:40:11.024Z', '2025-10-07T10:40:11.114Z', NULL, 'success', NULL, '2025-10-07T10:40:11.005Z'),
  (137706, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T10:35:33.020Z', '2025-10-07T10:35:33.180Z', NULL, 'success', NULL, '2025-10-07T10:35:33.003Z'),
  (137705, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T10:30:33.019Z', '2025-10-07T10:30:33.106Z', NULL, 'success', NULL, '2025-10-07T10:30:33.003Z'),
  (137704, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T10:30:11.031Z', '2025-10-07T10:30:11.110Z', NULL, 'success', NULL, '2025-10-07T10:30:11.002Z'),
  (137703, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-07T10:30:08.020Z', '2025-10-07T10:30:30.034Z', NULL, 'success', NULL, '2025-10-07T10:30:08.004Z'),
  (137702, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T10:25:33.020Z', '2025-10-07T10:25:33.297Z', NULL, 'success', NULL, '2025-10-07T10:25:33.003Z'),
  (137701, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T10:20:33.017Z', '2025-10-07T10:20:33.232Z', NULL, 'success', NULL, '2025-10-07T10:20:33.004Z'),
  (137700, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T10:20:11.019Z', '2025-10-07T10:20:11.099Z', NULL, 'success', NULL, '2025-10-07T10:20:11.004Z'),
  (137699, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T10:15:33.026Z', '2025-10-07T10:15:33.253Z', NULL, 'success', NULL, '2025-10-07T10:15:33.002Z'),
  (137698, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T10:10:33.022Z', '2025-10-07T10:10:33.152Z', NULL, 'success', NULL, '2025-10-07T10:10:33.005Z'),
  (137697, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T10:10:11.031Z', '2025-10-07T10:10:11.118Z', NULL, 'success', NULL, '2025-10-07T10:10:11.004Z'),
  (137696, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T10:05:33.026Z', '2025-10-07T10:05:33.326Z', NULL, 'success', NULL, '2025-10-07T10:05:33.006Z'),
  (137695, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T10:00:33.021Z', '2025-10-07T10:00:33.103Z', NULL, 'success', NULL, '2025-10-07T10:00:33.003Z'),
  (137694, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T10:00:11.114Z', '2025-10-07T10:00:11.195Z', NULL, 'success', NULL, '2025-10-07T10:00:11.016Z'),
  (137693, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-07T10:00:08.028Z', '2025-10-07T10:00:29.990Z', NULL, 'success', NULL, '2025-10-07T10:00:08.004Z'),
  (137692, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T09:55:33.020Z', '2025-10-07T09:55:33.263Z', NULL, 'success', NULL, '2025-10-07T09:55:33.004Z'),
  (137691, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T09:50:33.021Z', '2025-10-07T09:50:33.166Z', NULL, 'success', NULL, '2025-10-07T09:50:33.005Z'),
  (137690, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T09:50:11.022Z', '2025-10-07T09:50:11.446Z', NULL, 'success', NULL, '2025-10-07T09:50:11.006Z'),
  (137689, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T09:45:33.019Z', '2025-10-07T09:45:33.313Z', NULL, 'success', NULL, '2025-10-07T09:45:33.003Z'),
  (137688, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T09:40:33.027Z', '2025-10-07T09:40:33.170Z', NULL, 'success', NULL, '2025-10-07T09:40:33.004Z'),
  (137687, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T09:40:11.031Z', '2025-10-07T09:40:11.105Z', NULL, 'success', NULL, '2025-10-07T09:40:11.005Z'),
  (137686, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T09:35:33.021Z', '2025-10-07T09:35:33.320Z', NULL, 'success', NULL, '2025-10-07T09:35:33.002Z'),
  (137685, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T09:30:33.023Z', '2025-10-07T09:30:33.113Z', NULL, 'success', NULL, '2025-10-07T09:30:33.003Z'),
  (137684, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T09:30:11.032Z', '2025-10-07T09:30:11.113Z', NULL, 'success', NULL, '2025-10-07T09:30:11.004Z'),
  (137683, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-07T09:30:08.029Z', '2025-10-07T09:30:30.308Z', NULL, 'success', NULL, '2025-10-07T09:30:08.006Z'),
  (137682, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T09:25:33.022Z', '2025-10-07T09:25:33.295Z', NULL, 'success', NULL, '2025-10-07T09:25:33.005Z'),
  (137681, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T09:20:33.017Z', '2025-10-07T09:20:33.231Z', NULL, 'success', NULL, '2025-10-07T09:20:33.003Z'),
  (137680, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T09:20:11.023Z', '2025-10-07T09:20:11.101Z', NULL, 'success', NULL, '2025-10-07T09:20:11.004Z'),
  (137679, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T09:15:33.020Z', '2025-10-07T09:15:33.221Z', NULL, 'success', NULL, '2025-10-07T09:15:33.002Z'),
  (137678, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T09:10:33.032Z', '2025-10-07T09:10:33.154Z', NULL, 'success', NULL, '2025-10-07T09:10:33.010Z'),
  (137677, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T09:10:11.020Z', '2025-10-07T09:10:11.095Z', NULL, 'success', NULL, '2025-10-07T09:10:11.005Z'),
  (137676, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T09:05:33.017Z', '2025-10-07T09:05:33.335Z', NULL, 'success', NULL, '2025-10-07T09:05:33.004Z'),
  (137675, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T09:00:33.019Z', '2025-10-07T09:00:33.101Z', NULL, 'success', NULL, '2025-10-07T09:00:33.004Z'),
  (137674, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T09:00:11.042Z', '2025-10-07T09:00:11.118Z', NULL, 'success', NULL, '2025-10-07T09:00:11.007Z'),
  (137673, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-07T09:00:08.024Z', '2025-10-07T09:00:30.073Z', NULL, 'success', NULL, '2025-10-07T09:00:08.005Z'),
  (137672, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T08:55:33.021Z', '2025-10-07T08:55:33.310Z', NULL, 'success', NULL, '2025-10-07T08:55:33.004Z'),
  (137671, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T08:50:33.018Z', '2025-10-07T08:50:33.265Z', NULL, 'success', NULL, '2025-10-07T08:50:33.005Z'),
  (137670, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T08:50:11.019Z', '2025-10-07T08:50:11.101Z', NULL, 'success', NULL, '2025-10-07T08:50:11.006Z'),
  (137669, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T08:45:33.015Z', '2025-10-07T08:45:33.239Z', NULL, 'success', NULL, '2025-10-07T08:45:33.003Z'),
  (137668, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T08:40:33.019Z', '2025-10-07T08:40:33.248Z', NULL, 'success', NULL, '2025-10-07T08:40:33.006Z'),
  (137667, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T08:40:11.020Z', '2025-10-07T08:40:11.105Z', NULL, 'success', NULL, '2025-10-07T08:40:11.003Z'),
  (137666, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T08:35:33.021Z', '2025-10-07T08:35:33.381Z', NULL, 'success', NULL, '2025-10-07T08:35:33.005Z'),
  (137665, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T08:30:33.020Z', '2025-10-07T08:30:33.109Z', NULL, 'success', NULL, '2025-10-07T08:30:33.006Z'),
  (137664, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T08:30:11.016Z', '2025-10-07T08:30:11.384Z', NULL, 'success', NULL, '2025-10-07T08:30:11.002Z'),
  (137663, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-07T08:30:08.025Z', '2025-10-07T08:30:29.905Z', NULL, 'success', NULL, '2025-10-07T08:30:08.005Z'),
  (137662, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T08:25:33.021Z', '2025-10-07T08:25:33.374Z', NULL, 'success', NULL, '2025-10-07T08:25:33.005Z'),
  (137661, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T08:20:33.018Z', '2025-10-07T08:20:33.165Z', NULL, 'success', NULL, '2025-10-07T08:20:33.005Z'),
  (137660, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T08:20:11.022Z', '2025-10-07T08:20:11.119Z', NULL, 'success', NULL, '2025-10-07T08:20:11.002Z'),
  (137659, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T08:15:33.015Z', '2025-10-07T08:15:33.299Z', NULL, 'success', NULL, '2025-10-07T08:15:33.004Z'),
  (137658, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T08:10:33.028Z', '2025-10-07T08:10:33.154Z', NULL, 'success', NULL, '2025-10-07T08:10:33.008Z'),
  (137657, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T08:10:11.024Z', '2025-10-07T08:10:11.118Z', NULL, 'success', NULL, '2025-10-07T08:10:11.005Z'),
  (137656, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T08:05:33.018Z', '2025-10-07T08:05:33.318Z', NULL, 'success', NULL, '2025-10-07T08:05:33.004Z'),
  (137655, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T08:00:33.021Z', '2025-10-07T08:00:33.095Z', NULL, 'success', NULL, '2025-10-07T08:00:33.005Z'),
  (137654, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T08:00:11.026Z', '2025-10-07T08:00:11.097Z', NULL, 'success', NULL, '2025-10-07T08:00:11.003Z'),
  (137653, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-07T08:00:08.020Z', '2025-10-07T08:00:30.145Z', NULL, 'success', NULL, '2025-10-07T08:00:08.004Z'),
  (137652, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T07:55:33.019Z', '2025-10-07T07:55:33.158Z', NULL, 'success', NULL, '2025-10-07T07:55:33.003Z'),
  (137651, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T07:50:33.014Z', '2025-10-07T07:50:33.409Z', NULL, 'success', NULL, '2025-10-07T07:50:33.003Z'),
  (137650, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T07:50:11.019Z', '2025-10-07T07:50:11.111Z', NULL, 'success', NULL, '2025-10-07T07:50:11.003Z'),
  (137649, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T07:45:33.019Z', '2025-10-07T07:45:33.264Z', NULL, 'success', NULL, '2025-10-07T07:45:33.003Z'),
  (137648, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T07:40:33.018Z', '2025-10-07T07:40:33.162Z', NULL, 'success', NULL, '2025-10-07T07:40:33.003Z'),
  (137647, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T07:40:11.020Z', '2025-10-07T07:40:11.145Z', NULL, 'success', NULL, '2025-10-07T07:40:11.004Z'),
  (137646, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T07:35:33.018Z', '2025-10-07T07:35:33.203Z', NULL, 'success', NULL, '2025-10-07T07:35:33.003Z'),
  (137645, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T07:30:33.018Z', '2025-10-07T07:30:33.117Z', NULL, 'success', NULL, '2025-10-07T07:30:33.003Z'),
  (137644, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T07:30:11.025Z', '2025-10-07T07:30:11.124Z', NULL, 'success', NULL, '2025-10-07T07:30:11.004Z'),
  (137643, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-07T07:30:08.019Z', '2025-10-07T07:30:29.308Z', NULL, 'success', NULL, '2025-10-07T07:30:08.003Z'),
  (137642, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T07:25:33.021Z', '2025-10-07T07:25:33.342Z', NULL, 'success', NULL, '2025-10-07T07:25:33.005Z'),
  (137641, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T07:20:33.017Z', '2025-10-07T07:20:33.195Z', NULL, 'success', NULL, '2025-10-07T07:20:33.004Z'),
  (137640, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T07:20:11.022Z', '2025-10-07T07:20:11.116Z', NULL, 'success', NULL, '2025-10-07T07:20:11.004Z'),
  (137639, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T07:15:33.018Z', '2025-10-07T07:15:33.298Z', NULL, 'success', NULL, '2025-10-07T07:15:33.005Z'),
  (137638, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T07:10:33.027Z', '2025-10-07T07:10:33.150Z', NULL, 'success', NULL, '2025-10-07T07:10:33.006Z'),
  (137637, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T07:10:11.023Z', '2025-10-07T07:10:11.104Z', NULL, 'success', NULL, '2025-10-07T07:10:11.006Z'),
  (137636, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T07:05:33.024Z', '2025-10-07T07:05:33.402Z', NULL, 'success', NULL, '2025-10-07T07:05:33.004Z'),
  (137635, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T07:00:33.019Z', '2025-10-07T07:00:33.088Z', NULL, 'success', NULL, '2025-10-07T07:00:33.003Z'),
  (137634, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T07:00:11.018Z', '2025-10-07T07:00:11.440Z', NULL, 'success', NULL, '2025-10-07T07:00:11.003Z'),
  (137633, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-07T07:00:08.039Z', '2025-10-07T07:00:29.693Z', NULL, 'success', NULL, '2025-10-07T07:00:08.005Z'),
  (137632, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T06:55:33.020Z', '2025-10-07T06:55:33.309Z', NULL, 'success', NULL, '2025-10-07T06:55:33.004Z'),
  (137631, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T06:50:33.022Z', '2025-10-07T06:50:33.188Z', NULL, 'success', NULL, '2025-10-07T06:50:33.006Z'),
  (137630, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T06:50:11.021Z', '2025-10-07T06:50:11.323Z', NULL, 'success', NULL, '2025-10-07T06:50:11.002Z'),
  (137629, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T06:45:33.017Z', '2025-10-07T06:45:33.542Z', NULL, 'success', NULL, '2025-10-07T06:45:33.002Z'),
  (137628, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T06:40:33.020Z', '2025-10-07T06:40:33.204Z', NULL, 'success', NULL, '2025-10-07T06:40:33.004Z'),
  (137627, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T06:40:11.022Z', '2025-10-07T06:40:11.094Z', NULL, 'success', NULL, '2025-10-07T06:40:11.005Z'),
  (137626, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T06:35:33.021Z', '2025-10-07T06:35:33.311Z', NULL, 'success', NULL, '2025-10-07T06:35:33.005Z'),
  (137625, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T06:30:33.017Z', '2025-10-07T06:30:33.086Z', NULL, 'success', NULL, '2025-10-07T06:30:33.004Z'),
  (137624, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T06:30:11.029Z', '2025-10-07T06:30:11.139Z', NULL, 'success', NULL, '2025-10-07T06:30:11.010Z'),
  (137623, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-07T06:30:08.024Z', '2025-10-07T06:30:29.405Z', NULL, 'success', NULL, '2025-10-07T06:30:08.005Z'),
  (137622, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T06:25:33.021Z', '2025-10-07T06:25:33.589Z', NULL, 'success', NULL, '2025-10-07T06:25:33.006Z'),
  (137621, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T06:20:33.019Z', '2025-10-07T06:20:33.177Z', NULL, 'success', NULL, '2025-10-07T06:20:33.004Z'),
  (137620, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T06:20:11.018Z', '2025-10-07T06:20:11.142Z', NULL, 'success', NULL, '2025-10-07T06:20:11.003Z'),
  (137619, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T06:15:33.017Z', '2025-10-07T06:15:33.194Z', NULL, 'success', NULL, '2025-10-07T06:15:33.004Z'),
  (137618, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T06:10:33.020Z', '2025-10-07T06:10:33.372Z', NULL, 'success', NULL, '2025-10-07T06:10:33.004Z'),
  (137617, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T06:10:11.022Z', '2025-10-07T06:10:11.091Z', NULL, 'success', NULL, '2025-10-07T06:10:11.006Z'),
  (137616, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T06:05:33.019Z', '2025-10-07T06:05:33.291Z', NULL, 'success', NULL, '2025-10-07T06:05:33.005Z'),
  (137615, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T06:00:33.018Z', '2025-10-07T06:00:33.079Z', NULL, 'success', NULL, '2025-10-07T06:00:33.004Z'),
  (137614, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T06:00:11.033Z', '2025-10-07T06:00:11.201Z', NULL, 'success', NULL, '2025-10-07T06:00:11.016Z'),
  (137613, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-07T06:00:08.026Z', '2025-10-07T06:00:28.836Z', NULL, 'success', NULL, '2025-10-07T06:00:08.006Z'),
  (137612, 'ae6a5952-36a0-419d-b697-17cf7bf31061', true, 'trigger', NULL, NULL, '2025-10-07T06:00:00.026Z', '2025-10-07T06:00:01.726Z', NULL, 'success', NULL, '2025-10-07T06:00:00.007Z'),
  (137611, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T05:55:33.023Z', '2025-10-07T05:55:33.335Z', NULL, 'success', NULL, '2025-10-07T05:55:33.002Z'),
  (137610, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T05:50:33.018Z', '2025-10-07T05:50:33.166Z', NULL, 'success', NULL, '2025-10-07T05:50:33.004Z'),
  (137609, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T05:50:11.020Z', '2025-10-07T05:50:11.103Z', NULL, 'success', NULL, '2025-10-07T05:50:11.003Z'),
  (137608, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T05:45:33.018Z', '2025-10-07T05:45:33.327Z', NULL, 'success', NULL, '2025-10-07T05:45:33.005Z'),
  (137607, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T05:40:33.030Z', '2025-10-07T05:40:33.148Z', NULL, 'success', NULL, '2025-10-07T05:40:33.011Z'),
  (137606, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T05:40:11.020Z', '2025-10-07T05:40:11.309Z', NULL, 'success', NULL, '2025-10-07T05:40:11.005Z'),
  (137605, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T05:35:33.018Z', '2025-10-07T05:35:33.322Z', NULL, 'success', NULL, '2025-10-07T05:35:33.005Z'),
  (137604, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T05:30:33.018Z', '2025-10-07T05:30:33.089Z', NULL, 'success', NULL, '2025-10-07T05:30:33.005Z'),
  (137603, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T05:30:11.023Z', '2025-10-07T05:30:11.107Z', NULL, 'success', NULL, '2025-10-07T05:30:11.002Z'),
  (137602, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-07T05:30:08.019Z', '2025-10-07T05:30:28.289Z', NULL, 'success', NULL, '2025-10-07T05:30:08.005Z'),
  (137601, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T05:25:33.019Z', '2025-10-07T05:25:33.268Z', NULL, 'success', NULL, '2025-10-07T05:25:33.006Z'),
  (137600, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T05:20:33.017Z', '2025-10-07T05:20:33.153Z', NULL, 'success', NULL, '2025-10-07T05:20:33.003Z'),
  (137599, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T05:20:11.021Z', '2025-10-07T05:20:11.113Z', NULL, 'success', NULL, '2025-10-07T05:20:11.002Z'),
  (137598, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T05:15:33.017Z', '2025-10-07T05:15:33.307Z', NULL, 'success', NULL, '2025-10-07T05:15:33.003Z'),
  (137597, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T05:10:33.021Z', '2025-10-07T05:10:33.130Z', NULL, 'success', NULL, '2025-10-07T05:10:33.005Z'),
  (137596, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T05:10:11.021Z', '2025-10-07T05:10:11.101Z', NULL, 'success', NULL, '2025-10-07T05:10:11.005Z'),
  (137595, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T05:05:33.021Z', '2025-10-07T05:05:33.311Z', NULL, 'success', NULL, '2025-10-07T05:05:33.006Z'),
  (137594, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T05:00:33.016Z', '2025-10-07T05:00:33.094Z', NULL, 'success', NULL, '2025-10-07T05:00:33.004Z'),
  (137593, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T05:00:11.031Z', '2025-10-07T05:00:11.109Z', NULL, 'success', NULL, '2025-10-07T05:00:11.002Z'),
  (137592, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-07T05:00:08.022Z', '2025-10-07T05:00:28.873Z', NULL, 'success', NULL, '2025-10-07T05:00:08.005Z'),
  (137591, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T04:55:33.017Z', '2025-10-07T04:55:33.291Z', NULL, 'success', NULL, '2025-10-07T04:55:33.004Z'),
  (137590, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T04:50:33.023Z', '2025-10-07T04:50:33.144Z', NULL, 'success', NULL, '2025-10-07T04:50:33.004Z'),
  (137589, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T04:50:11.018Z', '2025-10-07T04:50:11.105Z', NULL, 'success', NULL, '2025-10-07T04:50:11.002Z'),
  (137588, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T04:45:33.019Z', '2025-10-07T04:45:33.192Z', NULL, 'success', NULL, '2025-10-07T04:45:33.003Z'),
  (137587, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T04:40:33.015Z', '2025-10-07T04:40:33.134Z', NULL, 'success', NULL, '2025-10-07T04:40:33.003Z'),
  (137586, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T04:40:11.017Z', '2025-10-07T04:40:11.096Z', NULL, 'success', NULL, '2025-10-07T04:40:11.004Z'),
  (137585, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T04:35:33.018Z', '2025-10-07T04:35:33.440Z', NULL, 'success', NULL, '2025-10-07T04:35:33.004Z'),
  (137584, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T04:30:33.016Z', '2025-10-07T04:30:33.088Z', NULL, 'success', NULL, '2025-10-07T04:30:33.005Z'),
  (137583, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T04:30:11.020Z', '2025-10-07T04:30:11.119Z', NULL, 'success', NULL, '2025-10-07T04:30:11.003Z'),
  (137582, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-07T04:30:08.022Z', '2025-10-07T04:30:28.550Z', NULL, 'success', NULL, '2025-10-07T04:30:08.005Z'),
  (137581, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T04:25:33.017Z', '2025-10-07T04:25:33.382Z', NULL, 'success', NULL, '2025-10-07T04:25:33.005Z'),
  (137580, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T04:20:33.016Z', '2025-10-07T04:20:33.188Z', NULL, 'success', NULL, '2025-10-07T04:20:33.003Z'),
  (137579, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T04:20:11.019Z', '2025-10-07T04:20:11.384Z', NULL, 'success', NULL, '2025-10-07T04:20:11.003Z'),
  (137578, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T04:15:33.018Z', '2025-10-07T04:15:33.192Z', NULL, 'success', NULL, '2025-10-07T04:15:33.004Z'),
  (137577, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T04:10:33.019Z', '2025-10-07T04:10:33.329Z', NULL, 'success', NULL, '2025-10-07T04:10:33.007Z'),
  (137576, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T04:10:11.021Z', '2025-10-07T04:10:11.144Z', NULL, 'success', NULL, '2025-10-07T04:10:11.005Z'),
  (137575, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T04:05:33.023Z', '2025-10-07T04:05:33.307Z', NULL, 'success', NULL, '2025-10-07T04:05:33.005Z'),
  (137574, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T04:00:33.017Z', '2025-10-07T04:00:33.081Z', NULL, 'success', NULL, '2025-10-07T04:00:33.004Z'),
  (137573, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T04:00:11.024Z', '2025-10-07T04:00:11.132Z', NULL, 'success', NULL, '2025-10-07T04:00:11.003Z'),
  (137572, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-07T04:00:08.020Z', '2025-10-07T04:00:28.577Z', NULL, 'success', NULL, '2025-10-07T04:00:08.005Z'),
  (137571, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T03:55:33.016Z', '2025-10-07T03:55:33.330Z', NULL, 'success', NULL, '2025-10-07T03:55:33.002Z'),
  (137570, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T03:50:33.018Z', '2025-10-07T03:50:33.179Z', NULL, 'success', NULL, '2025-10-07T03:50:33.003Z'),
  (137569, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T03:50:11.028Z', '2025-10-07T03:50:11.106Z', NULL, 'success', NULL, '2025-10-07T03:50:11.004Z'),
  (137568, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T03:45:33.018Z', '2025-10-07T03:45:33.296Z', NULL, 'success', NULL, '2025-10-07T03:45:33.003Z'),
  (137567, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T03:40:33.022Z', '2025-10-07T03:40:33.136Z', NULL, 'success', NULL, '2025-10-07T03:40:33.006Z'),
  (137566, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T03:40:11.021Z', '2025-10-07T03:40:11.107Z', NULL, 'success', NULL, '2025-10-07T03:40:11.004Z'),
  (137565, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T03:35:33.019Z', '2025-10-07T03:35:33.264Z', NULL, 'success', NULL, '2025-10-07T03:35:33.004Z'),
  (137564, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T03:30:33.016Z', '2025-10-07T03:30:33.087Z', NULL, 'success', NULL, '2025-10-07T03:30:33.004Z'),
  (137563, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T03:30:11.020Z', '2025-10-07T03:30:11.087Z', NULL, 'success', NULL, '2025-10-07T03:30:11.002Z'),
  (137562, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-07T03:30:08.021Z', '2025-10-07T03:30:27.911Z', NULL, 'success', NULL, '2025-10-07T03:30:08.006Z'),
  (137561, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T03:25:33.016Z', '2025-10-07T03:25:33.457Z', NULL, 'success', NULL, '2025-10-07T03:25:33.003Z'),
  (137560, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T03:20:33.017Z', '2025-10-07T03:20:33.211Z', NULL, 'success', NULL, '2025-10-07T03:20:33.005Z'),
  (137559, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T03:20:11.019Z', '2025-10-07T03:20:11.092Z', NULL, 'success', NULL, '2025-10-07T03:20:11.003Z'),
  (137558, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T03:15:33.019Z', '2025-10-07T03:15:33.189Z', NULL, 'success', NULL, '2025-10-07T03:15:33.004Z'),
  (137557, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T03:10:33.023Z', '2025-10-07T03:10:33.138Z', NULL, 'success', NULL, '2025-10-07T03:10:33.004Z'),
  (137556, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T03:10:11.020Z', '2025-10-07T03:10:11.098Z', NULL, 'success', NULL, '2025-10-07T03:10:11.005Z'),
  (137555, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T03:05:33.024Z', '2025-10-07T03:05:33.268Z', NULL, 'success', NULL, '2025-10-07T03:05:33.006Z'),
  (137554, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T03:00:33.020Z', '2025-10-07T03:00:33.085Z', NULL, 'success', NULL, '2025-10-07T03:00:33.006Z'),
  (137553, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T03:00:11.020Z', '2025-10-07T03:00:11.337Z', NULL, 'success', NULL, '2025-10-07T03:00:11.003Z'),
  (137552, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-07T03:00:08.025Z', '2025-10-07T03:00:28.037Z', NULL, 'success', NULL, '2025-10-07T03:00:08.007Z'),
  (137551, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T02:55:33.017Z', '2025-10-07T02:55:33.310Z', NULL, 'success', NULL, '2025-10-07T02:55:33.003Z'),
  (137550, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T02:50:33.017Z', '2025-10-07T02:50:33.168Z', NULL, 'success', NULL, '2025-10-07T02:50:33.003Z'),
  (137549, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T02:50:11.016Z', '2025-10-07T02:50:11.109Z', NULL, 'success', NULL, '2025-10-07T02:50:11.002Z'),
  (137548, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T02:45:33.029Z', '2025-10-07T02:45:33.294Z', NULL, 'success', NULL, '2025-10-07T02:45:33.004Z'),
  (137547, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T02:40:33.022Z', '2025-10-07T02:40:33.173Z', NULL, 'success', NULL, '2025-10-07T02:40:33.006Z'),
  (137546, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T02:40:11.024Z', '2025-10-07T02:40:11.111Z', NULL, 'success', NULL, '2025-10-07T02:40:11.005Z'),
  (137545, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T02:35:33.019Z', '2025-10-07T02:35:33.333Z', NULL, 'success', NULL, '2025-10-07T02:35:33.006Z'),
  (137544, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T02:30:33.022Z', '2025-10-07T02:30:33.085Z', NULL, 'success', NULL, '2025-10-07T02:30:33.007Z'),
  (137543, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T02:30:11.019Z', '2025-10-07T02:30:11.120Z', NULL, 'success', NULL, '2025-10-07T02:30:11.002Z'),
  (137542, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-07T02:30:08.021Z', '2025-10-07T02:30:27.820Z', NULL, 'success', NULL, '2025-10-07T02:30:08.006Z'),
  (137541, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T02:25:33.018Z', '2025-10-07T02:25:33.339Z', NULL, 'success', NULL, '2025-10-07T02:25:33.002Z'),
  (137540, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T02:20:33.018Z', '2025-10-07T02:20:33.159Z', NULL, 'success', NULL, '2025-10-07T02:20:33.004Z'),
  (137539, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T02:20:11.021Z', '2025-10-07T02:20:11.090Z', NULL, 'success', NULL, '2025-10-07T02:20:11.006Z'),
  (137538, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T02:15:33.016Z', '2025-10-07T02:15:33.225Z', NULL, 'success', NULL, '2025-10-07T02:15:33.005Z'),
  (137537, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T02:10:33.020Z', '2025-10-07T02:10:33.181Z', NULL, 'success', NULL, '2025-10-07T02:10:33.008Z'),
  (137536, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T02:10:11.022Z', '2025-10-07T02:10:11.097Z', NULL, 'success', NULL, '2025-10-07T02:10:11.004Z'),
  (137535, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T02:05:33.021Z', '2025-10-07T02:05:33.278Z', NULL, 'success', NULL, '2025-10-07T02:05:33.006Z'),
  (137534, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T02:00:33.018Z', '2025-10-07T02:00:33.100Z', NULL, 'success', NULL, '2025-10-07T02:00:33.004Z'),
  (137533, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T02:00:11.031Z', '2025-10-07T02:00:11.115Z', NULL, 'success', NULL, '2025-10-07T02:00:11.003Z'),
  (137532, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-07T02:00:08.023Z', '2025-10-07T02:00:27.664Z', NULL, 'success', NULL, '2025-10-07T02:00:08.006Z'),
  (137531, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T01:55:33.021Z', '2025-10-07T01:55:33.298Z', NULL, 'success', NULL, '2025-10-07T01:55:33.002Z'),
  (137530, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T01:50:33.015Z', '2025-10-07T01:50:33.136Z', NULL, 'success', NULL, '2025-10-07T01:50:33.003Z'),
  (137529, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T01:50:11.021Z', '2025-10-07T01:50:11.097Z', NULL, 'success', NULL, '2025-10-07T01:50:11.005Z'),
  (137528, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T01:45:33.019Z', '2025-10-07T01:45:33.336Z', NULL, 'success', NULL, '2025-10-07T01:45:33.005Z'),
  (137527, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T01:40:33.031Z', '2025-10-07T01:40:33.136Z', NULL, 'success', NULL, '2025-10-07T01:40:33.006Z'),
  (137526, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T01:40:11.023Z', '2025-10-07T01:40:11.104Z', NULL, 'success', NULL, '2025-10-07T01:40:11.005Z'),
  (137525, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T01:35:33.019Z', '2025-10-07T01:35:33.256Z', NULL, 'success', NULL, '2025-10-07T01:35:33.004Z'),
  (137524, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T01:30:33.015Z', '2025-10-07T01:30:33.074Z', NULL, 'success', NULL, '2025-10-07T01:30:33.003Z'),
  (137523, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T01:30:11.022Z', '2025-10-07T01:30:11.339Z', NULL, 'success', NULL, '2025-10-07T01:30:11.007Z'),
  (137522, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-07T01:30:08.022Z', '2025-10-07T01:30:28.047Z', NULL, 'success', NULL, '2025-10-07T01:30:08.005Z'),
  (137521, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T01:25:33.018Z', '2025-10-07T01:25:33.360Z', NULL, 'success', NULL, '2025-10-07T01:25:33.004Z'),
  (137520, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T01:20:33.020Z', '2025-10-07T01:20:33.232Z', NULL, 'success', NULL, '2025-10-07T01:20:33.004Z'),
  (137519, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T01:20:11.025Z', '2025-10-07T01:20:11.093Z', NULL, 'success', NULL, '2025-10-07T01:20:11.004Z'),
  (137518, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T01:15:33.020Z', '2025-10-07T01:15:33.295Z', NULL, 'success', NULL, '2025-10-07T01:15:33.004Z'),
  (137517, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T01:10:33.019Z', '2025-10-07T01:10:33.137Z', NULL, 'success', NULL, '2025-10-07T01:10:33.005Z'),
  (137516, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T01:10:11.021Z', '2025-10-07T01:10:11.103Z', NULL, 'success', NULL, '2025-10-07T01:10:11.004Z'),
  (137515, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T01:05:33.020Z', '2025-10-07T01:05:33.298Z', NULL, 'success', NULL, '2025-10-07T01:05:33.004Z'),
  (137514, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T01:00:33.017Z', '2025-10-07T01:00:33.084Z', NULL, 'success', NULL, '2025-10-07T01:00:33.004Z'),
  (137513, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T01:00:11.023Z', '2025-10-07T01:00:11.141Z', NULL, 'success', NULL, '2025-10-07T01:00:11.003Z'),
  (137512, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-07T01:00:08.020Z', '2025-10-07T01:00:28.261Z', NULL, 'success', NULL, '2025-10-07T01:00:08.007Z'),
  (137511, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T00:55:33.017Z', '2025-10-07T00:55:33.192Z', NULL, 'success', NULL, '2025-10-07T00:55:33.004Z'),
  (137510, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T00:50:33.017Z', '2025-10-07T00:50:33.339Z', NULL, 'success', NULL, '2025-10-07T00:50:33.004Z'),
  (137509, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T00:50:11.021Z', '2025-10-07T00:50:11.092Z', NULL, 'success', NULL, '2025-10-07T00:50:11.005Z'),
  (137508, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T00:45:33.019Z', '2025-10-07T00:45:33.218Z', NULL, 'success', NULL, '2025-10-07T00:45:33.006Z'),
  (137507, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T00:40:33.024Z', '2025-10-07T00:40:33.216Z', NULL, 'success', NULL, '2025-10-07T00:40:33.003Z'),
  (137506, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T00:40:11.020Z', '2025-10-07T00:40:11.088Z', NULL, 'success', NULL, '2025-10-07T00:40:11.005Z'),
  (137505, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T00:35:33.020Z', '2025-10-07T00:35:33.345Z', NULL, 'success', NULL, '2025-10-07T00:35:33.004Z'),
  (137504, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T00:30:33.020Z', '2025-10-07T00:30:33.090Z', NULL, 'success', NULL, '2025-10-07T00:30:33.005Z'),
  (137503, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T00:30:11.018Z', '2025-10-07T00:30:11.118Z', NULL, 'success', NULL, '2025-10-07T00:30:11.002Z'),
  (137502, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-07T00:30:08.019Z', '2025-10-07T00:30:28.004Z', NULL, 'success', NULL, '2025-10-07T00:30:08.006Z'),
  (137501, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T00:25:33.019Z', '2025-10-07T00:25:33.299Z', NULL, 'success', NULL, '2025-10-07T00:25:33.003Z'),
  (137500, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T00:20:33.017Z', '2025-10-07T00:20:33.175Z', NULL, 'success', NULL, '2025-10-07T00:20:33.003Z'),
  (137499, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T00:20:11.020Z', '2025-10-07T00:20:11.120Z', NULL, 'success', NULL, '2025-10-07T00:20:11.005Z'),
  (137498, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T00:15:33.017Z', '2025-10-07T00:15:33.328Z', NULL, 'success', NULL, '2025-10-07T00:15:33.005Z'),
  (137497, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T00:10:33.023Z', '2025-10-07T00:10:33.135Z', NULL, 'success', NULL, '2025-10-07T00:10:33.005Z'),
  (137496, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T00:10:11.023Z', '2025-10-07T00:10:11.105Z', NULL, 'success', NULL, '2025-10-07T00:10:11.006Z'),
  (137495, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T00:05:33.018Z', '2025-10-07T00:05:33.315Z', NULL, 'success', NULL, '2025-10-07T00:05:33.004Z'),
  (137494, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-07T00:00:33.020Z', '2025-10-07T00:00:33.089Z', NULL, 'success', NULL, '2025-10-07T00:00:33.003Z'),
  (137493, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-07T00:00:11.087Z', '2025-10-07T00:00:11.257Z', NULL, 'success', NULL, '2025-10-07T00:00:11.015Z'),
  (137492, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-07T00:00:08.145Z', '2025-10-07T00:00:31.971Z', NULL, 'success', NULL, '2025-10-07T00:00:08.011Z'),
  (137491, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T23:55:33.020Z', '2025-10-06T23:55:33.260Z', NULL, 'success', NULL, '2025-10-06T23:55:33.005Z'),
  (137490, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T23:50:33.018Z', '2025-10-06T23:50:33.175Z', NULL, 'success', NULL, '2025-10-06T23:50:33.004Z'),
  (137489, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-06T23:50:11.022Z', '2025-10-06T23:50:11.353Z', NULL, 'success', NULL, '2025-10-06T23:50:11.004Z'),
  (137488, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T23:45:33.016Z', '2025-10-06T23:45:33.210Z', NULL, 'success', NULL, '2025-10-06T23:45:33.005Z'),
  (137487, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T23:40:33.024Z', '2025-10-06T23:40:33.153Z', NULL, 'success', NULL, '2025-10-06T23:40:33.007Z'),
  (137486, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-06T23:40:11.030Z', '2025-10-06T23:40:11.256Z', NULL, 'success', NULL, '2025-10-06T23:40:11.006Z'),
  (137485, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T23:35:33.023Z', '2025-10-06T23:35:33.324Z', NULL, 'success', NULL, '2025-10-06T23:35:33.006Z'),
  (137484, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T23:30:33.019Z', '2025-10-06T23:30:33.090Z', NULL, 'success', NULL, '2025-10-06T23:30:33.004Z'),
  (137483, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-06T23:30:11.022Z', '2025-10-06T23:30:11.107Z', NULL, 'success', NULL, '2025-10-06T23:30:11.003Z'),
  (137482, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-06T23:30:08.021Z', '2025-10-06T23:30:28.728Z', NULL, 'success', NULL, '2025-10-06T23:30:08.004Z'),
  (137481, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T23:25:33.017Z', '2025-10-06T23:25:33.337Z', NULL, 'success', NULL, '2025-10-06T23:25:33.003Z'),
  (137480, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T23:20:33.015Z', '2025-10-06T23:20:33.171Z', NULL, 'success', NULL, '2025-10-06T23:20:33.004Z'),
  (137479, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-06T23:20:11.021Z', '2025-10-06T23:20:11.129Z', NULL, 'success', NULL, '2025-10-06T23:20:11.005Z'),
  (137478, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T23:15:33.018Z', '2025-10-06T23:15:33.321Z', NULL, 'success', NULL, '2025-10-06T23:15:33.004Z'),
  (137477, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T23:10:33.023Z', '2025-10-06T23:10:33.145Z', NULL, 'success', NULL, '2025-10-06T23:10:33.005Z'),
  (137476, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-06T23:10:11.026Z', '2025-10-06T23:10:11.096Z', NULL, 'success', NULL, '2025-10-06T23:10:11.007Z'),
  (137475, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T23:05:33.020Z', '2025-10-06T23:05:33.308Z', NULL, 'success', NULL, '2025-10-06T23:05:33.004Z'),
  (137474, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T23:00:33.016Z', '2025-10-06T23:00:33.089Z', NULL, 'success', NULL, '2025-10-06T23:00:33.004Z'),
  (137473, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-06T23:00:11.017Z', '2025-10-06T23:00:11.093Z', NULL, 'success', NULL, '2025-10-06T23:00:11.002Z'),
  (137472, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-06T23:00:08.023Z', '2025-10-06T23:00:28.744Z', NULL, 'success', NULL, '2025-10-06T23:00:08.005Z'),
  (137471, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T22:55:33.023Z', '2025-10-06T22:55:33.308Z', NULL, 'success', NULL, '2025-10-06T22:55:33.005Z'),
  (137470, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T22:50:33.016Z', '2025-10-06T22:50:33.157Z', NULL, 'success', NULL, '2025-10-06T22:50:33.003Z'),
  (137469, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-06T22:50:11.023Z', '2025-10-06T22:50:11.106Z', NULL, 'success', NULL, '2025-10-06T22:50:11.004Z'),
  (137468, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T22:45:33.018Z', '2025-10-06T22:45:33.335Z', NULL, 'success', NULL, '2025-10-06T22:45:33.003Z'),
  (137467, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T22:40:33.019Z', '2025-10-06T22:40:33.138Z', NULL, 'success', NULL, '2025-10-06T22:40:33.005Z'),
  (137466, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-06T22:40:11.024Z', '2025-10-06T22:40:11.344Z', NULL, 'success', NULL, '2025-10-06T22:40:11.007Z'),
  (137465, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T22:35:33.028Z', '2025-10-06T22:35:33.306Z', NULL, 'success', NULL, '2025-10-06T22:35:33.003Z'),
  (137464, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T22:30:33.021Z', '2025-10-06T22:30:33.091Z', NULL, 'success', NULL, '2025-10-06T22:30:33.004Z'),
  (137463, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-06T22:30:11.021Z', '2025-10-06T22:30:11.127Z', NULL, 'success', NULL, '2025-10-06T22:30:11.003Z'),
  (137462, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-06T22:30:08.021Z', '2025-10-06T22:30:28.946Z', NULL, 'success', NULL, '2025-10-06T22:30:08.006Z'),
  (137461, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T22:25:33.019Z', '2025-10-06T22:25:33.254Z', NULL, 'success', NULL, '2025-10-06T22:25:33.004Z'),
  (137460, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T22:20:33.020Z', '2025-10-06T22:20:33.190Z', NULL, 'success', NULL, '2025-10-06T22:20:33.005Z'),
  (137459, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-06T22:20:11.024Z', '2025-10-06T22:20:11.098Z', NULL, 'success', NULL, '2025-10-06T22:20:11.004Z'),
  (137458, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T22:15:33.018Z', '2025-10-06T22:15:33.221Z', NULL, 'success', NULL, '2025-10-06T22:15:33.003Z'),
  (137457, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T22:10:33.023Z', '2025-10-06T22:10:33.175Z', NULL, 'success', NULL, '2025-10-06T22:10:33.004Z'),
  (137456, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-06T22:10:11.024Z', '2025-10-06T22:10:11.110Z', NULL, 'success', NULL, '2025-10-06T22:10:11.005Z'),
  (137455, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T22:05:33.025Z', '2025-10-06T22:05:33.275Z', NULL, 'success', NULL, '2025-10-06T22:05:33.006Z'),
  (137454, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T22:00:33.020Z', '2025-10-06T22:00:33.103Z', NULL, 'success', NULL, '2025-10-06T22:00:33.004Z'),
  (137453, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-06T22:00:11.023Z', '2025-10-06T22:00:11.092Z', NULL, 'success', NULL, '2025-10-06T22:00:11.003Z'),
  (137452, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-06T22:00:08.023Z', '2025-10-06T22:00:29.867Z', NULL, 'success', NULL, '2025-10-06T22:00:08.006Z'),
  (137451, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T21:55:33.015Z', '2025-10-06T21:55:33.282Z', NULL, 'success', NULL, '2025-10-06T21:55:33.005Z'),
  (137450, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T21:50:33.017Z', '2025-10-06T21:50:33.331Z', NULL, 'success', NULL, '2025-10-06T21:50:33.004Z'),
  (137449, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-06T21:50:11.017Z', '2025-10-06T21:50:11.100Z', NULL, 'success', NULL, '2025-10-06T21:50:11.004Z'),
  (137448, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T21:45:33.018Z', '2025-10-06T21:45:33.282Z', NULL, 'success', NULL, '2025-10-06T21:45:33.004Z'),
  (137447, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T21:40:33.034Z', '2025-10-06T21:40:33.154Z', NULL, 'success', NULL, '2025-10-06T21:40:33.008Z'),
  (137446, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-06T21:40:11.022Z', '2025-10-06T21:40:11.125Z', NULL, 'success', NULL, '2025-10-06T21:40:11.006Z'),
  (137445, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T21:35:33.020Z', '2025-10-06T21:35:33.366Z', NULL, 'success', NULL, '2025-10-06T21:35:33.003Z'),
  (137444, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T21:30:33.044Z', '2025-10-06T21:30:33.116Z', NULL, 'success', NULL, '2025-10-06T21:30:33.005Z'),
  (137443, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-06T21:30:11.028Z', '2025-10-06T21:30:11.423Z', NULL, 'success', NULL, '2025-10-06T21:30:11.003Z'),
  (137442, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-06T21:30:08.029Z', '2025-10-06T21:30:31.584Z', NULL, 'success', NULL, '2025-10-06T21:30:08.008Z'),
  (137441, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T21:25:33.021Z', '2025-10-06T21:25:33.286Z', NULL, 'success', NULL, '2025-10-06T21:25:33.005Z'),
  (137440, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T21:20:33.017Z', '2025-10-06T21:20:33.195Z', NULL, 'success', NULL, '2025-10-06T21:20:33.004Z'),
  (137439, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-06T21:20:11.024Z', '2025-10-06T21:20:11.786Z', NULL, 'success', NULL, '2025-10-06T21:20:11.004Z'),
  (137438, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T21:15:33.020Z', '2025-10-06T21:15:33.405Z', NULL, 'success', NULL, '2025-10-06T21:15:33.005Z'),
  (137437, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T21:10:33.027Z', '2025-10-06T21:10:33.192Z', NULL, 'success', NULL, '2025-10-06T21:10:33.006Z'),
  (137436, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-06T21:10:11.020Z', '2025-10-06T21:10:11.087Z', NULL, 'success', NULL, '2025-10-06T21:10:11.003Z'),
  (137435, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T21:05:33.020Z', '2025-10-06T21:05:33.364Z', NULL, 'success', NULL, '2025-10-06T21:05:33.003Z'),
  (137434, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T21:00:33.016Z', '2025-10-06T21:00:33.201Z', NULL, 'success', NULL, '2025-10-06T21:00:33.003Z'),
  (137433, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-06T21:00:11.024Z', '2025-10-06T21:00:11.152Z', NULL, 'success', NULL, '2025-10-06T21:00:11.003Z'),
  (137432, '37b28f0f-dfe3-45f6-8b80-5588bb964066', false, 'trigger', NULL, NULL, '2025-10-06T21:00:08.025Z', '2025-10-06T21:00:18.395Z', NULL, 'error', NULL, '2025-10-06T21:00:08.006Z'),
  (137431, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T20:55:33.020Z', '2025-10-06T20:55:33.175Z', NULL, 'success', NULL, '2025-10-06T20:55:33.004Z'),
  (137430, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T20:50:33.022Z', '2025-10-06T20:50:33.369Z', NULL, 'success', NULL, '2025-10-06T20:50:33.003Z'),
  (137429, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-06T20:50:11.020Z', '2025-10-06T20:50:11.108Z', NULL, 'success', NULL, '2025-10-06T20:50:11.004Z'),
  (137428, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T20:45:33.018Z', '2025-10-06T20:45:33.358Z', NULL, 'success', NULL, '2025-10-06T20:45:33.004Z'),
  (137427, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T20:40:33.016Z', '2025-10-06T20:40:33.240Z', NULL, 'success', NULL, '2025-10-06T20:40:33.003Z'),
  (137426, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-06T20:40:11.021Z', '2025-10-06T20:40:11.099Z', NULL, 'success', NULL, '2025-10-06T20:40:11.002Z'),
  (137425, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T20:35:33.019Z', '2025-10-06T20:35:33.175Z', NULL, 'success', NULL, '2025-10-06T20:35:33.003Z'),
  (137424, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T20:30:33.021Z', '2025-10-06T20:30:33.234Z', NULL, 'success', NULL, '2025-10-06T20:30:33.003Z'),
  (137423, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-06T20:30:11.024Z', '2025-10-06T20:30:11.119Z', NULL, 'success', NULL, '2025-10-06T20:30:11.003Z'),
  (137422, '37b28f0f-dfe3-45f6-8b80-5588bb964066', false, 'trigger', NULL, NULL, '2025-10-06T20:30:08.020Z', '2025-10-06T20:30:18.534Z', NULL, 'error', NULL, '2025-10-06T20:30:08.004Z'),
  (137421, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T20:25:33.020Z', '2025-10-06T20:25:33.327Z', NULL, 'success', NULL, '2025-10-06T20:25:33.004Z'),
  (137420, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T20:20:33.020Z', '2025-10-06T20:20:33.228Z', NULL, 'success', NULL, '2025-10-06T20:20:33.004Z'),
  (137419, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-06T20:20:11.023Z', '2025-10-06T20:20:11.123Z', NULL, 'success', NULL, '2025-10-06T20:20:11.004Z'),
  (137418, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T20:15:33.020Z', '2025-10-06T20:15:33.282Z', NULL, 'success', NULL, '2025-10-06T20:15:33.003Z'),
  (137417, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T20:10:33.021Z', '2025-10-06T20:10:33.215Z', NULL, 'success', NULL, '2025-10-06T20:10:33.004Z'),
  (137416, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-06T20:10:11.021Z', '2025-10-06T20:10:11.118Z', NULL, 'success', NULL, '2025-10-06T20:10:11.004Z'),
  (137415, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T20:05:33.018Z', '2025-10-06T20:05:33.286Z', NULL, 'success', NULL, '2025-10-06T20:05:33.004Z'),
  (137414, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T20:00:33.019Z', '2025-10-06T20:00:33.153Z', NULL, 'success', NULL, '2025-10-06T20:00:33.003Z'),
  (137413, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-06T20:00:11.022Z', '2025-10-06T20:00:11.434Z', NULL, 'success', NULL, '2025-10-06T20:00:11.003Z'),
  (137412, '37b28f0f-dfe3-45f6-8b80-5588bb964066', false, 'trigger', NULL, NULL, '2025-10-06T20:00:08.022Z', '2025-10-06T20:00:18.534Z', NULL, 'error', NULL, '2025-10-06T20:00:08.007Z'),
  (137411, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T19:55:33.016Z', '2025-10-06T19:55:33.388Z', NULL, 'success', NULL, '2025-10-06T19:55:33.005Z'),
  (137410, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T19:50:33.019Z', '2025-10-06T19:50:33.187Z', NULL, 'success', NULL, '2025-10-06T19:50:33.006Z'),
  (137409, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-06T19:50:11.017Z', '2025-10-06T19:50:11.088Z', NULL, 'success', NULL, '2025-10-06T19:50:11.003Z'),
  (137408, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T19:45:33.017Z', '2025-10-06T19:45:33.277Z', NULL, 'success', NULL, '2025-10-06T19:45:33.006Z'),
  (137407, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T19:40:33.017Z', '2025-10-06T19:40:33.266Z', NULL, 'success', NULL, '2025-10-06T19:40:33.004Z'),
  (137406, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-06T19:40:11.018Z', '2025-10-06T19:40:11.099Z', NULL, 'success', NULL, '2025-10-06T19:40:11.002Z'),
  (137405, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T19:35:33.014Z', '2025-10-06T19:35:33.265Z', NULL, 'success', NULL, '2025-10-06T19:35:33.004Z'),
  (137404, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T19:30:33.020Z', '2025-10-06T19:30:33.211Z', NULL, 'success', NULL, '2025-10-06T19:30:33.006Z'),
  (137403, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-06T19:30:11.029Z', '2025-10-06T19:30:11.115Z', NULL, 'success', NULL, '2025-10-06T19:30:11.003Z'),
  (137402, '37b28f0f-dfe3-45f6-8b80-5588bb964066', false, 'trigger', NULL, NULL, '2025-10-06T19:30:08.025Z', '2025-10-06T19:30:18.657Z', NULL, 'error', NULL, '2025-10-06T19:30:08.007Z'),
  (137401, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T19:25:33.017Z', '2025-10-06T19:25:33.311Z', NULL, 'success', NULL, '2025-10-06T19:25:33.004Z'),
  (137400, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T19:20:33.018Z', '2025-10-06T19:20:33.156Z', NULL, 'success', NULL, '2025-10-06T19:20:33.005Z'),
  (137399, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-06T19:20:11.022Z', '2025-10-06T19:20:11.104Z', NULL, 'success', NULL, '2025-10-06T19:20:11.004Z'),
  (137398, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T19:15:33.014Z', '2025-10-06T19:15:33.287Z', NULL, 'success', NULL, '2025-10-06T19:15:33.004Z'),
  (137397, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T19:10:33.057Z', '2025-10-06T19:10:33.250Z', NULL, 'success', NULL, '2025-10-06T19:10:33.003Z'),
  (137396, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-06T19:10:11.020Z', '2025-10-06T19:10:11.134Z', NULL, 'success', NULL, '2025-10-06T19:10:11.003Z'),
  (137395, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T19:05:33.018Z', '2025-10-06T19:05:33.361Z', NULL, 'success', NULL, '2025-10-06T19:05:33.003Z'),
  (137394, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T19:00:33.016Z', '2025-10-06T19:00:33.155Z', NULL, 'success', NULL, '2025-10-06T19:00:33.004Z'),
  (137393, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-06T19:00:11.025Z', '2025-10-06T19:00:11.102Z', NULL, 'success', NULL, '2025-10-06T19:00:11.006Z'),
  (137392, '37b28f0f-dfe3-45f6-8b80-5588bb964066', false, 'trigger', NULL, NULL, '2025-10-06T19:00:08.027Z', '2025-10-06T19:05:18.217Z', NULL, 'error', NULL, '2025-10-06T19:00:08.007Z'),
  (137391, 'ae6a5952-36a0-419d-b697-17cf7bf31061', true, 'trigger', NULL, NULL, '2025-10-06T19:00:00.027Z', '2025-10-06T19:00:01.810Z', NULL, 'success', NULL, '2025-10-06T19:00:00.007Z'),
  (137390, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T18:55:33.017Z', '2025-10-06T18:55:33.240Z', NULL, 'success', NULL, '2025-10-06T18:55:33.005Z'),
  (137389, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T18:50:33.016Z', '2025-10-06T18:50:33.246Z', NULL, 'success', NULL, '2025-10-06T18:50:33.005Z'),
  (137388, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-06T18:50:11.020Z', '2025-10-06T18:50:11.147Z', NULL, 'success', NULL, '2025-10-06T18:50:11.004Z'),
  (137387, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T18:45:33.057Z', '2025-10-06T18:45:33.237Z', NULL, 'success', NULL, '2025-10-06T18:45:33.003Z'),
  (137386, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T18:40:33.021Z', '2025-10-06T18:40:33.167Z', NULL, 'success', NULL, '2025-10-06T18:40:33.006Z'),
  (137385, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-06T18:40:11.024Z', '2025-10-06T18:40:11.459Z', NULL, 'success', NULL, '2025-10-06T18:40:11.003Z'),
  (137384, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T18:35:33.022Z', '2025-10-06T18:35:33.264Z', NULL, 'success', NULL, '2025-10-06T18:35:33.003Z'),
  (137383, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T18:30:33.017Z', '2025-10-06T18:30:33.099Z', NULL, 'success', NULL, '2025-10-06T18:30:33.004Z'),
  (137382, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-06T18:30:11.028Z', '2025-10-06T18:30:11.115Z', NULL, 'success', NULL, '2025-10-06T18:30:11.011Z'),
  (137381, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-06T18:30:08.029Z', '2025-10-06T18:30:29.791Z', NULL, 'success', NULL, '2025-10-06T18:30:08.005Z'),
  (137380, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T18:25:33.017Z', '2025-10-06T18:25:33.324Z', NULL, 'success', NULL, '2025-10-06T18:25:33.005Z'),
  (137379, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T18:20:33.020Z', '2025-10-06T18:20:33.172Z', NULL, 'success', NULL, '2025-10-06T18:20:33.005Z'),
  (137378, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-06T18:20:11.023Z', '2025-10-06T18:20:11.164Z', NULL, 'success', NULL, '2025-10-06T18:20:11.004Z'),
  (137377, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T18:15:33.021Z', '2025-10-06T18:15:33.355Z', NULL, 'success', NULL, '2025-10-06T18:15:33.006Z'),
  (137376, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T18:10:33.020Z', '2025-10-06T18:10:33.139Z', NULL, 'success', NULL, '2025-10-06T18:10:33.005Z'),
  (137375, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-06T18:10:11.021Z', '2025-10-06T18:10:11.099Z', NULL, 'success', NULL, '2025-10-06T18:10:11.004Z'),
  (137374, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T18:05:33.023Z', '2025-10-06T18:05:33.281Z', NULL, 'success', NULL, '2025-10-06T18:05:33.005Z'),
  (137373, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T18:00:33.016Z', '2025-10-06T18:00:33.098Z', NULL, 'success', NULL, '2025-10-06T18:00:33.005Z'),
  (137372, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-06T18:00:11.019Z', '2025-10-06T18:00:11.124Z', NULL, 'success', NULL, '2025-10-06T18:00:11.003Z'),
  (137371, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-06T18:00:08.023Z', '2025-10-06T18:00:29.194Z', NULL, 'success', NULL, '2025-10-06T18:00:08.005Z'),
  (137370, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T17:55:33.018Z', '2025-10-06T17:55:33.230Z', NULL, 'success', NULL, '2025-10-06T17:55:33.005Z'),
  (137369, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T17:50:33.017Z', '2025-10-06T17:50:33.172Z', NULL, 'success', NULL, '2025-10-06T17:50:33.004Z'),
  (137368, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-06T17:50:11.021Z', '2025-10-06T17:50:11.089Z', NULL, 'success', NULL, '2025-10-06T17:50:11.004Z'),
  (137367, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T17:45:33.020Z', '2025-10-06T17:45:33.208Z', NULL, 'success', NULL, '2025-10-06T17:45:33.005Z'),
  (137366, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T17:40:33.021Z', '2025-10-06T17:40:33.283Z', NULL, 'success', NULL, '2025-10-06T17:40:33.005Z'),
  (137365, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-06T17:40:11.023Z', '2025-10-06T17:40:11.099Z', NULL, 'success', NULL, '2025-10-06T17:40:11.005Z'),
  (137364, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T17:35:33.018Z', '2025-10-06T17:35:33.244Z', NULL, 'success', NULL, '2025-10-06T17:35:33.003Z'),
  (137363, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T17:30:33.022Z', '2025-10-06T17:30:33.093Z', NULL, 'success', NULL, '2025-10-06T17:30:33.005Z'),
  (137362, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-06T17:30:11.022Z', '2025-10-06T17:30:11.114Z', NULL, 'success', NULL, '2025-10-06T17:30:11.003Z'),
  (137361, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-06T17:30:08.023Z', '2025-10-06T17:30:30.947Z', NULL, 'success', NULL, '2025-10-06T17:30:08.004Z'),
  (137360, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T17:25:33.025Z', '2025-10-06T17:25:33.351Z', NULL, 'success', NULL, '2025-10-06T17:25:33.005Z'),
  (137359, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T17:20:33.018Z', '2025-10-06T17:20:33.228Z', NULL, 'success', NULL, '2025-10-06T17:20:33.005Z'),
  (137358, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-06T17:20:11.020Z', '2025-10-06T17:20:11.452Z', NULL, 'success', NULL, '2025-10-06T17:20:11.004Z'),
  (137357, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T17:15:33.015Z', '2025-10-06T17:15:33.303Z', NULL, 'success', NULL, '2025-10-06T17:15:33.002Z'),
  (137356, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T17:10:33.023Z', '2025-10-06T17:10:33.144Z', NULL, 'success', NULL, '2025-10-06T17:10:33.005Z'),
  (137355, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-06T17:10:11.020Z', '2025-10-06T17:10:11.099Z', NULL, 'success', NULL, '2025-10-06T17:10:11.004Z'),
  (137354, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T17:05:33.018Z', '2025-10-06T17:05:33.208Z', NULL, 'success', NULL, '2025-10-06T17:05:33.002Z'),
  (137353, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T17:00:33.026Z', '2025-10-06T17:00:33.092Z', NULL, 'success', NULL, '2025-10-06T17:00:33.004Z'),
  (137352, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-06T17:00:11.021Z', '2025-10-06T17:00:11.103Z', NULL, 'success', NULL, '2025-10-06T17:00:11.003Z'),
  (137351, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-06T17:00:08.023Z', '2025-10-06T17:00:29.059Z', NULL, 'success', NULL, '2025-10-06T17:00:08.005Z'),
  (137350, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T16:55:33.015Z', '2025-10-06T16:55:33.198Z', NULL, 'success', NULL, '2025-10-06T16:55:33.004Z'),
  (137349, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T16:50:33.020Z', '2025-10-06T16:50:33.237Z', NULL, 'success', NULL, '2025-10-06T16:50:33.006Z'),
  (137348, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-06T16:50:11.021Z', '2025-10-06T16:50:11.165Z', NULL, 'success', NULL, '2025-10-06T16:50:11.004Z'),
  (137347, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T16:45:33.014Z', '2025-10-06T16:45:33.140Z', NULL, 'success', NULL, '2025-10-06T16:45:33.002Z'),
  (137346, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T16:40:33.026Z', '2025-10-06T16:40:33.148Z', NULL, 'success', NULL, '2025-10-06T16:40:33.004Z'),
  (137345, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-06T16:40:11.020Z', '2025-10-06T16:40:11.094Z', NULL, 'success', NULL, '2025-10-06T16:40:11.004Z'),
  (137344, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T16:35:33.025Z', '2025-10-06T16:35:33.213Z', NULL, 'success', NULL, '2025-10-06T16:35:33.005Z'),
  (137343, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T16:30:33.022Z', '2025-10-06T16:30:33.118Z', NULL, 'success', NULL, '2025-10-06T16:30:33.005Z'),
  (137342, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-06T16:30:11.118Z', '2025-10-06T16:30:11.277Z', NULL, 'success', NULL, '2025-10-06T16:30:11.008Z'),
  (137341, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-06T16:30:08.025Z', '2025-10-06T16:30:29.926Z', NULL, 'success', NULL, '2025-10-06T16:30:08.003Z'),
  (137340, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T16:25:33.020Z', '2025-10-06T16:25:33.295Z', NULL, 'success', NULL, '2025-10-06T16:25:33.004Z'),
  (137339, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T16:20:33.028Z', '2025-10-06T16:20:33.292Z', NULL, 'success', NULL, '2025-10-06T16:20:33.004Z'),
  (137338, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-06T16:20:11.025Z', '2025-10-06T16:20:11.128Z', NULL, 'success', NULL, '2025-10-06T16:20:11.004Z'),
  (137337, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T16:15:33.023Z', '2025-10-06T16:15:33.305Z', NULL, 'success', NULL, '2025-10-06T16:15:33.002Z'),
  (137336, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T16:10:33.020Z', '2025-10-06T16:10:33.147Z', NULL, 'success', NULL, '2025-10-06T16:10:33.005Z'),
  (137335, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-06T16:10:11.019Z', '2025-10-06T16:10:11.261Z', NULL, 'success', NULL, '2025-10-06T16:10:11.005Z'),
  (137334, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T16:05:33.023Z', '2025-10-06T16:05:33.282Z', NULL, 'success', NULL, '2025-10-06T16:05:33.004Z'),
  (137333, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T16:00:33.045Z', '2025-10-06T16:00:33.126Z', NULL, 'success', NULL, '2025-10-06T16:00:33.003Z'),
  (137332, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-06T16:00:11.020Z', '2025-10-06T16:00:11.167Z', NULL, 'success', NULL, '2025-10-06T16:00:11.004Z'),
  (137331, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-06T16:00:08.018Z', '2025-10-06T16:00:29.520Z', NULL, 'success', NULL, '2025-10-06T16:00:08.004Z'),
  (137330, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T15:55:33.017Z', '2025-10-06T15:55:33.253Z', NULL, 'success', NULL, '2025-10-06T15:55:33.005Z'),
  (137329, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T15:50:33.017Z', '2025-10-06T15:50:33.231Z', NULL, 'success', NULL, '2025-10-06T15:50:33.004Z'),
  (137328, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-06T15:50:11.021Z', '2025-10-06T15:50:11.108Z', NULL, 'success', NULL, '2025-10-06T15:50:11.003Z'),
  (137327, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T15:45:33.016Z', '2025-10-06T15:45:33.206Z', NULL, 'success', NULL, '2025-10-06T15:45:33.004Z'),
  (137326, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T15:40:33.019Z', '2025-10-06T15:40:33.322Z', NULL, 'success', NULL, '2025-10-06T15:40:33.004Z'),
  (137325, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-06T15:40:11.022Z', '2025-10-06T15:40:11.373Z', NULL, 'success', NULL, '2025-10-06T15:40:11.004Z'),
  (137324, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T15:35:33.020Z', '2025-10-06T15:35:33.292Z', NULL, 'success', NULL, '2025-10-06T15:35:33.004Z'),
  (137323, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T15:30:33.018Z', '2025-10-06T15:30:33.085Z', NULL, 'success', NULL, '2025-10-06T15:30:33.004Z'),
  (137322, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-06T15:30:11.026Z', '2025-10-06T15:30:11.124Z', NULL, 'success', NULL, '2025-10-06T15:30:11.003Z'),
  (137321, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-06T15:30:08.030Z', '2025-10-06T15:30:29.607Z', NULL, 'success', NULL, '2025-10-06T15:30:08.006Z'),
  (137320, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T15:25:33.021Z', '2025-10-06T15:25:33.273Z', NULL, 'success', NULL, '2025-10-06T15:25:33.007Z'),
  (137319, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T15:20:33.018Z', '2025-10-06T15:20:33.234Z', NULL, 'success', NULL, '2025-10-06T15:20:33.004Z'),
  (137318, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-06T15:20:11.036Z', '2025-10-06T15:20:11.131Z', NULL, 'success', NULL, '2025-10-06T15:20:11.005Z'),
  (137317, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T15:15:33.019Z', '2025-10-06T15:15:33.377Z', NULL, 'success', NULL, '2025-10-06T15:15:33.004Z'),
  (137316, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T15:10:33.020Z', '2025-10-06T15:10:33.154Z', NULL, 'success', NULL, '2025-10-06T15:10:33.006Z'),
  (137315, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-06T15:10:11.020Z', '2025-10-06T15:10:11.090Z', NULL, 'success', NULL, '2025-10-06T15:10:11.005Z'),
  (137314, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T15:05:33.020Z', '2025-10-06T15:05:33.316Z', NULL, 'success', NULL, '2025-10-06T15:05:33.004Z'),
  (137313, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T15:00:33.018Z', '2025-10-06T15:00:33.126Z', NULL, 'success', NULL, '2025-10-06T15:00:33.004Z'),
  (137312, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-06T15:00:11.024Z', '2025-10-06T15:00:11.122Z', NULL, 'success', NULL, '2025-10-06T15:00:11.002Z'),
  (137311, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-06T15:00:08.025Z', '2025-10-06T15:00:30.622Z', NULL, 'success', NULL, '2025-10-06T15:00:08.004Z'),
  (137310, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T14:55:33.017Z', '2025-10-06T14:55:33.401Z', NULL, 'success', NULL, '2025-10-06T14:55:33.004Z'),
  (137309, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T14:50:33.017Z', '2025-10-06T14:50:33.207Z', NULL, 'success', NULL, '2025-10-06T14:50:33.004Z'),
  (137308, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-06T14:50:11.020Z', '2025-10-06T14:50:11.144Z', NULL, 'success', NULL, '2025-10-06T14:50:11.005Z'),
  (137307, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T14:45:33.019Z', '2025-10-06T14:45:33.237Z', NULL, 'success', NULL, '2025-10-06T14:45:33.005Z'),
  (137306, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T14:40:33.022Z', '2025-10-06T14:40:33.167Z', NULL, 'success', NULL, '2025-10-06T14:40:33.003Z'),
  (137305, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-06T14:40:11.022Z', '2025-10-06T14:40:11.175Z', NULL, 'success', NULL, '2025-10-06T14:40:11.003Z'),
  (137304, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T14:35:33.020Z', '2025-10-06T14:35:33.339Z', NULL, 'success', NULL, '2025-10-06T14:35:33.006Z'),
  (137303, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T14:30:33.028Z', '2025-10-06T14:30:33.097Z', NULL, 'success', NULL, '2025-10-06T14:30:33.004Z'),
  (137302, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-06T14:30:11.028Z', '2025-10-06T14:30:11.111Z', NULL, 'success', NULL, '2025-10-06T14:30:11.004Z'),
  (137301, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-06T14:30:08.019Z', '2025-10-06T14:30:29.517Z', NULL, 'success', NULL, '2025-10-06T14:30:08.005Z'),
  (137300, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T14:25:33.020Z', '2025-10-06T14:25:33.343Z', NULL, 'success', NULL, '2025-10-06T14:25:33.002Z'),
  (137299, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T14:20:33.021Z', '2025-10-06T14:20:33.187Z', NULL, 'success', NULL, '2025-10-06T14:20:33.004Z'),
  (137298, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-06T14:20:11.026Z', '2025-10-06T14:20:11.478Z', NULL, 'success', NULL, '2025-10-06T14:20:11.003Z'),
  (137297, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T14:15:33.025Z', '2025-10-06T14:15:33.219Z', NULL, 'success', NULL, '2025-10-06T14:15:33.005Z'),
  (137296, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T14:10:33.023Z', '2025-10-06T14:10:33.195Z', NULL, 'success', NULL, '2025-10-06T14:10:33.006Z'),
  (137295, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-06T14:10:11.024Z', '2025-10-06T14:10:11.166Z', NULL, 'success', NULL, '2025-10-06T14:10:11.005Z'),
  (137294, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T14:05:33.025Z', '2025-10-06T14:05:33.350Z', NULL, 'success', NULL, '2025-10-06T14:05:33.005Z'),
  (137293, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T14:00:33.025Z', '2025-10-06T14:00:33.097Z', NULL, 'success', NULL, '2025-10-06T14:00:33.005Z'),
  (137292, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-06T14:00:11.054Z', '2025-10-06T14:00:11.159Z', NULL, 'success', NULL, '2025-10-06T14:00:11.013Z'),
  (137291, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-06T14:00:08.025Z', '2025-10-06T14:00:29.607Z', NULL, 'success', NULL, '2025-10-06T14:00:08.005Z'),
  (137290, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T13:55:33.022Z', '2025-10-06T13:55:33.367Z', NULL, 'success', NULL, '2025-10-06T13:55:33.005Z'),
  (137289, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T13:50:33.029Z', '2025-10-06T13:50:33.182Z', NULL, 'success', NULL, '2025-10-06T13:50:33.004Z'),
  (137288, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-06T13:50:11.029Z', '2025-10-06T13:50:11.126Z', NULL, 'success', NULL, '2025-10-06T13:50:11.005Z'),
  (137287, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T13:45:33.021Z', '2025-10-06T13:45:33.256Z', NULL, 'success', NULL, '2025-10-06T13:45:33.005Z'),
  (137286, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T13:40:33.024Z', '2025-10-06T13:40:33.176Z', NULL, 'success', NULL, '2025-10-06T13:40:33.007Z'),
  (137285, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-06T13:40:11.018Z', '2025-10-06T13:40:11.098Z', NULL, 'success', NULL, '2025-10-06T13:40:11.003Z'),
  (137284, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T13:35:33.020Z', '2025-10-06T13:35:33.298Z', NULL, 'success', NULL, '2025-10-06T13:35:33.004Z'),
  (137283, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T13:30:33.020Z', '2025-10-06T13:30:33.089Z', NULL, 'success', NULL, '2025-10-06T13:30:33.006Z'),
  (137282, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-06T13:30:11.024Z', '2025-10-06T13:30:11.123Z', NULL, 'success', NULL, '2025-10-06T13:30:11.003Z'),
  (137281, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-06T13:30:08.022Z', '2025-10-06T13:30:29.494Z', NULL, 'success', NULL, '2025-10-06T13:30:08.005Z'),
  (137280, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T13:25:33.020Z', '2025-10-06T13:25:33.319Z', NULL, 'success', NULL, '2025-10-06T13:25:33.004Z'),
  (137279, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T13:20:33.016Z', '2025-10-06T13:20:33.182Z', NULL, 'success', NULL, '2025-10-06T13:20:33.002Z'),
  (137278, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-06T13:20:11.017Z', '2025-10-06T13:20:11.152Z', NULL, 'success', NULL, '2025-10-06T13:20:11.002Z'),
  (137277, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T13:15:33.018Z', '2025-10-06T13:15:33.294Z', NULL, 'success', NULL, '2025-10-06T13:15:33.003Z'),
  (137276, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T13:10:33.029Z', '2025-10-06T13:10:33.144Z', NULL, 'success', NULL, '2025-10-06T13:10:33.004Z'),
  (137275, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-06T13:10:11.029Z', '2025-10-06T13:10:11.456Z', NULL, 'success', NULL, '2025-10-06T13:10:11.004Z'),
  (137274, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T13:05:33.028Z', '2025-10-06T13:05:33.357Z', NULL, 'success', NULL, '2025-10-06T13:05:33.005Z'),
  (137273, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T13:00:33.020Z', '2025-10-06T13:00:33.089Z', NULL, 'success', NULL, '2025-10-06T13:00:33.006Z'),
  (137272, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-06T13:00:11.019Z', '2025-10-06T13:00:11.174Z', NULL, 'success', NULL, '2025-10-06T13:00:11.003Z'),
  (137271, '37b28f0f-dfe3-45f6-8b80-5588bb964066', true, 'trigger', NULL, NULL, '2025-10-06T13:00:08.028Z', '2025-10-06T13:00:29.340Z', NULL, 'success', NULL, '2025-10-06T13:00:08.006Z'),
  (137270, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T12:55:33.016Z', '2025-10-06T12:55:33.361Z', NULL, 'success', NULL, '2025-10-06T12:55:33.004Z'),
  (137269, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T12:50:33.017Z', '2025-10-06T12:50:33.181Z', NULL, 'success', NULL, '2025-10-06T12:50:33.004Z'),
  (137268, '27050adb-53c8-4c0f-823a-8ec4780c9013', true, 'trigger', NULL, NULL, '2025-10-06T12:50:11.022Z', '2025-10-06T12:50:11.105Z', NULL, 'success', NULL, '2025-10-06T12:50:11.003Z'),
  (137267, '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', true, 'trigger', NULL, NULL, '2025-10-06T12:45:33.014Z', '2025-10-06T12:45:33.352Z', NULL, 'success', NULL, '2025-10-06T12:45:33.005Z');

-- credentials_entity (32 righe)
INSERT INTO credentials_entity ("id", "name", "data", "type", "createdAt", "updatedAt", "isManaged") VALUES
  ('ed84ddfc-adfa-4dda-b281-ef697506785f', 'OpenAi account', 'U2FsdGVkX19u9lmYeG3eJ6rWxsIC1FknR7CtJRyWxzQlNxzi+d9Dte8DvXSYpSfRfLd7aHHXbmX4MDQDIs6YqikNwwKb66ZAUxz2No+m7oBl3gxJlv66Ez6lsKsJL0vIiy3ChgAM8y3/QCKR1f8AJ/J4J8WP5bvIBb2vD27uBTpxaQT3OINBsN4X98/Lrdgv0uiANqx2fvTi9nwgc7nqhY+oJiTjRzIRb19hAmu4eduE00SU3jrBh8Kk9IMfjbO+GL2kZbmA1NtEg+RvV0BlKw==', 'openAiApi', '2025-05-08T21:24:28.537Z', '2025-05-08T21:24:28.535Z', false),
  ('5744e8f0-5b13-4177-8699-0d08a5fc8cbc', 'Anthropic', 'U2FsdGVkX1/56/QtqsBqrsJO9cxNg4UsA8UtM7C2YKM5hHFx0FswOcSR81uWoaujHxMMzMhjQ78zMHesdaDkcKRQbwbKna9idL5g5Ij7yXJT08OvI9QFRilioKvlgRYob2OVyMZSV+4h8HlHSjGKioAIVFb/x/RcdlX0F6b5kkNaOg3qaELBfrTVOTIIE9ui', 'anthropicApi', '2025-05-08T21:25:00.822Z', '2025-05-08T21:25:10.316Z', false),
  ('7c792a4a-78a3-453f-99ed-4ed082016870', 'Outlook Supplies', 'U2FsdGVkX19+p0FF+UCeGoDN6HTaRfB9aNJBiTaSQSg7yzh/22EJA6tLDeSOXq3n0lHkqoDo4e/32xP+vSS1HjSyT20g4viqIE5QS4URFyo6eBh2slxlopIahWyjWXiiaqtEmKXlK2tRV/kGpgSd4L7BnbfsA638H0YlL9rPkzjtU60NiIQLGPMgEtpcqHV5PC5srua2PwUU1thzCppGVPzdjIhb9Pj+xqf6M4wMD0VKmqg3fj1w/k2SDs5xQC7a2211QP3bjBR5eej+cLVv9T8RJSK/nrg5YCvjknlZwfRzA58NdmA7zR4M9irZ7K//Gl4SmmfoP+rBiMKnKVbvXd67zsVIFZWqqAHLhksl8TYl5ELlvRnh8ZjHapfE96BxY2Q7jEOlSYmZAs//d8HgGwew3Yh8UZDkTFnKjdpHIMy8NnxtLyGYdFMKcwM0y6DAUbUdDELeIKdxFtHUiMW9agIxj99fB5n+c1jmzGSZudYhBEjkpuypfTIrD6sTy120B8YfyuPkPeLB30160fbWgo3EYotItUSk6f+m6qlx9t+bLH0f7bIozWUwMgzID3TNMyoSLwKcpaKrwpLu8nBtjq16QCEHGdfm319gzyeZwj221jpl9Ryi49JVbMLr3VegJFcRr4fA+D/xc+VJaqA9Kdq80DOTYK6ZMBeneH2bUND3HturekO7bCa556zVlEdN2Fkuoc6wjzs5sEi9INA++f88VkdjmPAsf0tgsahMqvALtCWFd+A57DgvTkHwSQiMs3wVqJuRhxl6qLZ5lqJL7yUN/B/lPx6H5o0PdUD3VdxdpPaVYp8Hwv7AbbH6iqDslwamp4mX0H5kS1WIVNvOwXCt0u6IAcz3Nly+eJ8+15pkzAWZg/+GbRbdz0nc5yKiRDj1URd8cTsvWNHLW6AMmD25oqxpF0cSm+2fZT9yGuAYPYsNQBH2HWgG7hP5wDTHUdhx2r5smYSJbPF+s7k36V9u5dwDNA6VZl5glbg3aBTc/HM6OGnvH7ZDKwAtQWdeyqjQQQFUBTNQs/xjfyZk4jlVodhOMVpo5kdKHC/TeKj1ETuKVcFnsMMM9fInr4xyoQzyWMOp6EpZzxJpdWgXuuJyWOHBcUzGvo/buWyr66y3HN39wUObAot6xhh1Ltrpz+3aurlbMXNslU91hgLwHk0YKdxrYu3GNMPtHbixuuetS/i5TeSU12dwbYOJg5WLfm0cPr9PPrjKht0GM5foM+68TL8vH8GGacpCl/qcYAdot7rayeOL5mQqZzYbKp6YMUETEbIHyfQ7Ovm6G+Zkp1c3b472p6DFzeLaRJiJEU8+Y6l7X1UCG1zSRM+ddyk+Rlg/xvBghSFKUxKYwLoEF6TP3EAPHpG3QjaQvHw42Q8hONLFpNWragXUr+rFofpcMJQKpwFBIUCyjWs9VQ3xGooT/dRwNKK18Q+If2U9BXz6H0Sac56MZ2Qh+DIq8I4EMq6WR+Qnk/neq7rAGH/Fgm4+Ut4O3ToLqPq8UQv+A/JRhJFhdqMkCZ24GSns6XMe1bmOQy7nd6RphQCAcIcanmcQpxCKlkZ6F4inkV5UTAol0qLqNiKfV4TxVHzPx1wwwWEWs/DZ67oBVsDZQdMneBWRDa8ryEvUz9ZQaweCB6tkeW3OIA+FW9VW6+7a7q97M5MPV4QCwzHXwkzu9VZ6Iw/sqJgU5Ewr4ElagKxI7taoOocYy068ZZ0ZTLIQHmu0b/KdApEmiwDxjDInQmHuueL9CZ7/kCZLZLCiXKs/CA+QbpVNAblm1isdtF9eAZ7yiVGmUyJ7OgwdJXLnMG+sHcDxLiA+tz0WtiASyBQfZA2o5dYmnOdcNdRT8sHPwcMOq03aRDe8WWd0kOvkTHqhx+Z4ARVaS6VCtYGYma/fhsHAL5YNquZp8eVBx0r07D3TsPPOcE6jjvbG+R2r6i9lNlqtLxkleuRPZ9A8DlC84K4kPR35U9/0IqyzgamwSFfxmi5gCUMPIp/1IfoTmhKMOdCDYX/dLJow3nVvaU7o16eTZNg39XZcLfXHlstZpH9Tyl8K9Y10STiIgyh8CUFnZkSfdxccsUyzkROC1wxtzGKD8PXXi49r4weAk1ebGjaOyDqg9bIGblnMO92mZS6Xw2s2Qol101FWwdoejjPPzF3OztDFxgW1SL9adLjzKaJjv2b1stCUfBrRUTt+o+jivxlgcLLUMDgEsURzPsX6jptBjtiJxDocHcGT9UfwEArWO1HIKo6MpYE2ZeEe/axg2WkOOGyBH6/Pr93DGSqKmc4SEHuRySPOw4sM+KYnWbgBFDHXYCeDwmaR28gAjyAnFDoelCgGqJNMlTXJOmdvPpncl6N8cgc+i25vJwsErGG/78MkvLyrWv/gaVdcbGdYgYGZ/2/6RUv0IjNTEe4ifJnUEmj9BRWUWNkoIy9+Je8afdoRELzEDMqG4OuS62yBw4+kqQcTX4sw69IM+1qXRTmd4Tkx8ThlyXgYbN4eaovtUwnNKkVpLnO+v28H9qeixLPnI2WokgE5oS/ZeDp51w1McgXOJaSXwVvvKO55EHvriyIVP+/KQ0mO33AKNr3XVzzPqUYjzqHesQA8yNIKcskO/ODBqQzhrEsNvkxCRV3/VTO8hmW7X9iA8JYZHMIKgls3Ox0Jld1tS/eQjND1STNjlFByUyVMA9fjdfA7z+XuqotZ47j8F5lg/M8kErtlR0kTVGPiAGe1BnVFXDot4mLkc5xaEcxoGWi1To9CywVoe6SEv5LMfkA77kue+m2XcHtpSbrFAUTbKzM4TYf9RXmArLPv+qYzEK8PgmBQ1ZUHpjtHFPw3t7wVrB9/i3dOUxNZevPaVMPNn+GIeB161BbVZRP063RxIJwXciWWJZzBHpJtfw0Idf2VUcS57jFbBj2drRCESChjcRWt6AOmEHnxYDpeJHqgmq7MbN8Hs8EpkV4LPdwk0JKzYSO9pRqhOu8wmNm/KaZqSBqzjBQk3jeNeNiZFIPXmCtmHNl/+jgotdJnyG+frFd1T8jPej9nqCboPOIB22RKt+k6TttIhu/WTa1vdW4aTqRcTgnaRRCPtRSqZ6XK5WD/Db64AjKFCE5KTTcWi17iSkZkSt6NXzVwIGSR255FT147kwQYEAOuEhGG8uAFrl/KipsdLC/r4kcXc1rd3nf1RzgRDIIEvZC924OVLk4xA1Bg9HiT1ErOBi+ODuhCfXYIVJyYM3mGzb3HK3zBbT+jgsDpUScPTwgbmszzqI1+tCEsNWf5fesBZrLCgI1rRon2fOaDftUNjysAjIQAg/yhxX8npLOPoP+qrrkXZZQn4mzgcWYtXsUNPEly8zZUsHB8f7Dtd3GXXwbTX9a5u5Llj3Pjvj9fv8kAlWTA33rYgfsDrdbRvw8KpsHUpHPhF8v0aK6/aemY/tBQT7H6ghAM2ImfF7bOF3NoGjwuSaujZjkICsr9zqZH+A5nsPrY3m3hP3CReekMfgbmvXs6CLdXIpa4/WYlquf58eg3x0Ecz1ui8m6Gdk4xmDbWzNI/f3ZmXOXQGbkHa1bzzeXuC1dAc8lpu/TEvrsyBAxoyt1GZ9t/VODGm0S5lZx32Z/9L7UYNRkpTw0NkoQGjOaQYAf4pO+n5mn0tOcGQzllThxRPMSu+jrK859sUmehyjoct5hdI0OzCgiqfBbqWg/BZIgxozm0UjAKE+eT72hBHGMLl/jhb+DC6EsnqradPefvOxS+vlQZmq20g4q2WsDTd8JVdvAg9PGQic8Hy7Ttj6ggXnGDq+8qQ5wGBXu5Vb1c7+TlPJsLlXyi4/ioyBoKbRnd9tPfykk9SsG8FYocCcgHV3qA1mgID2wJTZr5C+TgmainiqHxZzsGz40K43X84KCU5p/nRWQCZZEh0DMVTkCyrrfaAfYmbXN3tUgfvVrYtLC4gALJJ3kusi2VZFvgkbOmA5gV+nFLaaHM0OXuQUCwPRpM9kbllGHAiLNQHZPTYpqIh5rLKXa65izIkUEuYAcgxI7xOZMhyUVV/mugOjMTBfNIOyeRJ8WzL01nk3q2+27Qgi8sAIwA9atwsP1PHWxacmz7eWY4JY6rgB9T/vJ4jmHMwYsUEHIqTqd3aNX14M9Bk/lyKdSNNMaRTR4yTxxzbXfRNJ2TqzR/pP6UZJ3/pC9pOFI6XvYUNTKyWvySDGyCp58ygzRlszYWputer1RDWxlu52iG+pnFyvU8PwwUJxMV8PYfXE0Xr+UUK2/IT6fT9o38PJkbTdrILmUoMMSfyWAzth8jndiDBSgqgSVBdXb00P6459RmjgKwb8Z3T6/js1VuhSZvkq5Z5O4fE5HrezLmBQ3AibqZVUyJDaYr5Fj7tffhpd/T7AgPAscKiuUVeSrY00KkTST6A6DXtGpH/wGISNu8h5P/I14HpHrn6vKoBFuc0x0BYn81K4uVc2NL835BwiQsk4G04iud22KwhYjS+MNRYdEx+Xs0mesb4Y3QuSkeMS0BaDhWe8Pz9iaYn1EhmjN1RdsTYAD/AuG4IGDb18EajYHD/UEm4Bte0I3cxmalt+yHuR2djTgActBsRHCXWlIuN1crLy4R651MKpq90vAR+gP2Omq3GXg8TbUihrSXVo3uszoc0HNYUGucuhUQYKni3uMGxltvezGsw1g8Y0+it7KvHBVksX9dO5uOKn4oUQysfl+saBfjeJ1a7OdcgSgQ+8FIRhAzuDszl1ZT0oDrHENnt/A9hUMqh6jnPjjfd0oGilS4CjAnl6jUW5H+5BIY3eTsbZ/lCzpGrUNRa9scpYNPE2A/4yjqX6NeVMuM/V+IcK8RfJ2vOdqQ4L/IM5GcWMvAOyymyIuptMCTRxfdmvEXyu3lqpD/qsYoK0naqsEZcm6JDF4GHZ8ZfWyVG7dZAE2J8KTZorf1ajsduUg6Z0xgeAzxBGjGIi5ylaApz0y6pozMDuqVBct/SxAvelUFqheCoHjbSc3yAWM7ywmEELfu6KtemUUfZ1rLTdnzo+BFKqvD4wD1sPANf05vaXlufv7XmtjSvpnHwDqn2nJ76MyXfjVzXh6DEH1iGydtC0VcT7tny/N7IOHpcE71Yz/H1AvyJmDDXEeF1Paqs1zuktLMidimCXXYN3dap4A9RXwVvKXa1ZUdqRDd/Sf173Yr97PdupwNebH/JqFxZl7og42br6fCd+NmPRxkX2+K24E/6c3VVhj+tazZHSGuN7166iX6xssxx0vIVTVZPiZ9o+ulZ/HJ/8Wo6dX1cOcaIqCWyV6lun6B+I36UdvIuMU36ILxL0TX6ZDasarkrOK6TtJCjp4NgEWOVLIkZKUW8Zn6EaetDc5dSdYueeDJL6y5beaFjhorALEXX0mYbbBd1zlzAoTXJmaZnOnnKyXcAMok/nPvPqKYe607KGRjB8rxIB6qgsnip/cM8C7hak8Jcqevzf9H/HL6jmOrdMlCrkLuVFUeRkEtTklu8Ch+CcIal0qZjSPCczm8lMHRa7wd8SsF258gw6j1dkkyXlvSPoSedOAqzsbY33T/S7S4dCje8NNjYNPaY8ApxjPRxIbY7By+x2g9Ir57jbybpJQOT5o/jpAplfGby4U3gW0YScrj3JQF6j+nbBczvvAkXjF1pdhdiZTfu5Mxx6GQbqijwrKt/llSRUKaelaSGpxgJOXF9Ht7NQoENbqG8yxDJaw0/Qn7ZmUWDwYHxn2foP1FwrCAKgSXYFGT93CXZCyOdMK7bnRa2D0SBz4NE9FpQtzkCtmMH7JuPsh7A++t4qlhJrDeXKS0xpOn7fY2P1DeYdiI/zS7NB1hr1chcjPrgJ/7O3nGg04bUFXtXAWCz/ntKJurWkigO2EnSJtZV5Y+3eCjGV2VasTUGZ+ogX7nAACHgbv9IbB7VrdYpgu20jN3q/xzW4jpC2snroZAbkoWHe9g/foRdERc1f1V+Y4fZDMthR6DpD1X4S4tGug31nhvdU7nm7FcPFXjeitQRN7fbueNfIYuFP7z01yzTYWRXZn0zCuuxckTaSMU019V/y0xWjwEuaw2tOprW/+YzEYazyhX6jhGyoUCVWTqq01LCXZdSQ8T2OKY3L8MYzsPyIRQ3dThfJpWnu/PZ338gwCLnVGCGVflxPnhNWM0euqD5wRmRZiVIl3lwa3M0T6dIr9arGtjeyzCMKn5fbolo/f53Aeco6QMf9sDJSVKp7TQA83akb3YXeMd+55nyy29Ye2XaT20WiXPFhDMX1Gb/qSxLDI4mS2MkV4hiNisx3l2J6g/GprZtiTvw27/enOKyA7SAvNbXaY5ykYtyKcookVV6qiIA5hUUZkC0osiAvIemHwswC29eSUSRedRHE5c2rk4SWG7/QUz9fgninS1w3AJacVAYQZmht/79YZZqiW+AtbnP/CKpMJflM0AtgVrmVtvd4S8W8MAx/7FgZRFnXViFBVI5WoyXj0k/CtY4QUdtyNLMZ6XoW/rmrXPTc2d2sISweZQ5T7niBoZBayrlf96bchrNEVZLpZr1RbLSXHHCy1JGfoDioRNewyYdM4ALuSWY7ojEe24uogkQzpQCHVShMKRZxptObq0PF6qZXMR6ReJalnCzbcyb7aNboEvFCtvzY/yJnOYwMAaDjJlTy33JNg0XuHVZkTQg2toA1q+4vNlB0M4zkBiduvz7a4Ms4JEqiq+FbPgN14uxQ5whOd86AceITBlpfiIB19zJb9d5HW3spIPes+6JnRb6c7aXBliNdj4QNpQ5SCns1bNCKTDFABpJ0oaxAGivc2IATDi0luDosR2e2wTYS9Q09P7AxA5ksa/8/ZbHCiwgQimowB598dF7Q00LSi83VkRITIhtPttiFfPwbwLUQrEAKnxSmeJ7OBJvwbGBZ+q5OCQGTC6jzQ9fjqw4Ke8wqDgHEXOVop5rd+Qu/S8ST69cfH56D4iaOjyXknyWufuasTcJu04oL8U2D1Ul1lRul0nFcw71Grci0PZoyL2mIx9AXbE/g5svISvrVCilhW0PlKF5cWtVAXezWdanFVYluMBo3Df8/pNdsm8VYER/8V4wUuEnIKNSgvxL7cMOOQeIHgJYwiluav9LQbjR5neSUyksG7i0VKQZidcX5EB3RSo3XfWNzCyIS+dKpGdyqE33uiUwL01i/uul66FGVr30jpSakOSuc2wZEWtR2CODqSatxpyVd7aLLSEb2d/R7/ohocH6xXlSAp4o6Uctgat9HkhaevPJKK2FgyLFLLN9bwHBztU7IRr6s9AcL4sH0NYnL5qNsJeS2XSR++QOM67LmZEPQ4EcZ32TuLyIxDAbdd9gdPPdnPP9LuF7wn/wTAAUZyJ0hIQA9rlW1MNOc/Dj+23YreK7jg7FxWTBgdc1hH1SH++RtlHfL59QkuYKTjCTiAOJ4VczxcGkd/FJtuLSsZ1qc1sDG3rC0AMEMiMb3a90GsRHXxbERlReiPa1Hx/XY1SwSUrGkfBdVgusM+dbo4LrOxDOsOHUeHmrbPLztWgVf2pMurpA28+GHpEBQvwpM/n701w58b9yOf0QiEGKtLEdX9AHrL3f7qXtliW7Z1PmoTtXdK6dK85SSm0dvb1+CE8v6t5EeSCtaYPl/si+E5d4AKT1FHMWwUZtVE6inVueiVSa3DHOT85aLeoeuDTNuoAfFpWCIPX6s/QAC2RA12132swCPv2iZwHYWq0FAr1kBnbLD7ISaDxmYF5cMsJGNFhLdQ5K0YM4ONhldDyHxyQTOJVKAvAvb19qru6a4BV8nqTJYWi+63I3YcdzZcwskYvvoUNYtMSj6bZ7VeTbgoLrZPntFCblJn+LdSHt9zPDiqbEA2Mmr4YxKX444Tyg0NaZTARFzzQfGbFupue1UvSDUh9kD90P8l/LRUCUELLYsjzaKxDqbTFTvXjtGxFNgLN0Po7/m++teL1utcPuAOjOaNlNJYOUDWxAfVbwBCSoSrd2hVroVHHJFnLH+f/zaYeiKUDPN2dAWGsYOfI5fa1JCsQMLVFn+UMKTIKd264SALbzzN+i6bL0a7QFrBxV/Hk/ie4mA1SCpRKnmI5Aru5NlSSj4Vb+SXzr6kacSDEe/7aSQleJ5pchgEyN2K2B/HakE7oYmDHYbTByCsSVvGXwOnwYIR5JWZSzTE1OlH01ivIF1GR3qKJ0mbUUyCnoCwDrUGjtO8KR3/DMxaTwBuQ+2O0MqL3wnQugxg48lHS3iuxHBEIleVR/tP1/zdtJfUAQjg0DonFeqqqqcdpWzTCPd8yPKssyl6FMzFYyYIYgtgsyzJy/B3ByJ/1ocIyky6OOBQLLTosYMyAS+oKXpxDHpBL4MXxl5CoIVBrA0DqxbCpD0e2iN/9pKqJoPC9pbxZVKZGjb4dpV2vr9/AIE2syzeq8Hq1ANpepCKUWmwqexh17wacZyfrD9u/syl8hvmo+yC9EFXL9EY3c+woM//V58cuhXxCHMJAstdQPLIjzhuA46rRyG9RGTj7Avv3z20Ay3IE/sHpsuGGlWuEoa9lppXJBn0J1Zc=', 'microsoftOutlookOAuth2Api', '2025-05-08T21:29:07.320Z', '2025-10-08T13:30:11.256Z', false),
  ('a78b9580-5f5c-4e7a-97cb-1dcd7c7a5678', 'QdrantApi account', 'U2FsdGVkX19MxyOUztWElo8uz8AWV2+L/TnTWBuxZqRjGFL9e6qTMhwOK9r+mp8SilrsVfXeO6ZLYFxFd4/g9jhR8xmHwu4WCX+7t0B/GlbI5K/MIeIjFZDUNRqdVQ55Z1NSR2ccrP+dAz3FW/xHKeTXq1j4tZRabgC89+9sd0dhvi1en94k3wLDYLJAFWEa3umtZu40HJLx/59BuK2qUI652BNVZtvjNrXhimIhff9Hl1qASQGlNVPe991+0kLF2X0TF1YZNUEYf2Wzz+U+8drXKI2P2YhDTwrs2sGsLSFqRuu6aH2B2Ry7RURRB1T087IrmDytpsixNmng/8U5+Q==', 'qdrantApi', '2025-05-08T21:29:32.823Z', '2025-05-08T21:29:32.822Z', false),
  ('b4c74b37-5798-4efd-907e-3506156917ca', 'OpenRouter account', 'U2FsdGVkX1+WbMWgZCKmjbzWq1F5GvxB9RHE5Dxe4Y1mZUO0RBU0FY21XnWy1yb0hvDGwCaotTUrepTfjzWBbk4aOhHXVltrZSDC0bE9cU9Fo/J5jxK90jGKFlHAOMYleaU+ZAzR/YnIsPa1KA18yA==', 'openRouterApi', '2025-05-08T21:29:58.170Z', '2025-05-08T21:29:58.169Z', false),
  ('09df0eed-92c5-4432-a8a4-367d2b62f1a2', 'PineconeApi account', 'U2FsdGVkX1+rBDHpI9eE0e3p8otnJdSHRQPEcIuBysTYesyk+STMCgZctLcz1lofz1BE9atXkEfxy6iQWooVAl2gfY8pTQ+q4Cp812Mq6kXLh+nDrzeXzYA5ShB/HZR20gOJZOG3jyJ2N+tnOD+uZg==', 'pineconeApi', '2025-05-08T21:30:22.994Z', '2025-05-08T21:30:22.993Z', false),
  ('daa48e52-dc0f-42e0-8076-1f3c931150cf', 'Google Gemini(PaLM) Api account', 'U2FsdGVkX1/p+HWAbpabdXh62eiMST5/eE9gEz19v4kZ/cGlArgmHq3lvxVfyHTBaWyGqnCZkEwJ5rO3BjAYWl6zmopYfLf+V3Y268CU1VU=', 'googlePalmApi', '2025-05-08T21:30:45.995Z', '2025-05-08T21:30:45.994Z', false),
  ('9224f172-0dc6-4443-9bdf-533eb48a306f', 'Google Drive account', 'U2FsdGVkX1+NjJysQ1f0NaT4U3DLRJGWeNiEN9HlumaoZ6kVPfAjFG6nB2t5Qmbbvl8RV5l+f13FwDF4v57tbgNfWH/Kcfr0lK4KIVUK7AOoxuACBy67XngvqsXUqOhGcOe/pt2JWQn7jCJBceabyY/+W0KTdWQZpZszh1mYTeZD+8UCspQZ/6L/Z31CWj1zYnn2YN/WAjkGKR1XgxOiagE+2Jy/HuryN4ulJvSpouOqqk3v5FV8jh5VHYwdRaL6rXa9BsAShOGpNI32PYZlKQzP+UYR+kkmStzToVol8qdUaUEbdu2WaqgwoupO5KjHYsIcLOxGlprUZa0gzfzkzS+o/RYMW2P7BOgMkZrX0OYCgkCnOt6FZttkx/WM0vGYcx8fGpr5UbrTK4DD7K0Veng9JuQfqA40QMJc0A9/6SOmEs8UETme6255HUrgHJSl4olfjRbbzKg27067LUOYxaHFpXnC1RzyBULfc8LLM27Wg00upj227huRbIXn4ReIHQ35TUyCWBmpZJY8Xy/rHzFx/iGD43uQGV/a/rdcqZMEt0/vVxR1nloawkHiYyGOnSMUBokLW7EpzyuLaiix2KRzdvADKI5nlJRdlfdytkAVywuyTGZUh3i1gQ7J6blgG0LodgCcmrfXbbcciX+xrqC0nWPs3ysyi4CekCWLdThueCBXgaKagQ5NkTNbSLp8ZQa4j5HztIyytdSLVKjqIVD80iutyecJcx7eydI7vdbulrOjwQfZeOOz8DdOa3G/OwPYpfl9o59jKW3AkNlqHEsoGTSMi+OQ9hfE9MmW65b4LLrbAtl/VsBKXYczKa/cfcu/MYqsJTCxeq/IPdiX8gEgfZYDfwgxzdAFyRh7oxU+AHrZfG6OfLih35kLCyhFZKqFWzb1XZhDuiJkg0zSmNOAWK8hWT1r7q7dcbqQ1+bKx0SV7JnNnTZISAFaLto2gl2QAkw5M+vao/AGrlFf2JwQfSzJgGde+OYJUvAvCtYHN7zOuq+NtL5rdVlNWstC3gpX1QLO2290/5nTNe2bl+AiivGU+mNMajdcpp/0jvLHRUuFKJGAYMf4qvpghB9XvM99Kf32XcwzBqUEjPO7w1LPXcixBCwY1PaoJwxdqNrlF9aCKw4063pJOcqogpKSBy264fzo5xFDxtERh4998MOnDij5XtiPbYb2z/6sz9e3/hIxs2xBoPLvYMdGZRp9j4B7ztJJXUB6WsmrE0VstIM6r7+UwvlHmTQNariCLtJtVGbMQGq1tEZb5l5JRIuYKnhUNcSPIQzzREV/Yd2KuJE+oxE7HMdvbRHkNByBVnkUliBRnFDM115ivDuJjyDR4uOypsMkSSheXBRpJx+ILjoJWP1+UO6Aau93JwVDcvvFUbDNYZ5Nw0zs+GYYkpprjTIaeD6XZUj7cWkKA0cputXOPhVbjkSwM8US/MLgRqwo0Zl8zu9XPG/RkSG9TkoXu6hcXUooia4Ox7TaiXsA6J+XhkbR8JHHfMk1hAhcxEtAMFlzQBbaFMth8Uu3W2I7kOxItS/+h9Lbf1htHMQLIDdODunA1eFomEUW8S3TMubY0fte0OsvDIQ/J6mY2jvS/Uxk+QB+jV18akaeL9EQSqDqOyr6G2O/ZHLBWWzMSUAAnep9z5Z49k2oXVkncnTSY/Zle7K263O1d3Y6FhzewR2jLdHqbPo6+MBDw7Q9QhaNq2U8NECa0c0EqBT783/va63WLB9cmB9UhwAkIU5wJ4JuDyMExUBjCvh3hr0oMzk=', 'googleDriveOAuth2Api', '2025-05-08T22:02:21.789Z', '2025-06-22T23:15:56.726Z', false),
  ('118edbe3-6284-488f-99fc-bc9b54f51d61', 'Supabase tecsolutions', 'U2FsdGVkX19kjjzOdoxGEcsYlPj8RCnsBfUibLeamdYy3vy773TZSm56VFXyDa/+iH0m5V8TH69JUgeM1UAdcK2XTSiN8w/rZDUlzPhm/JGdd024/CDC/mPoEvT/H+Zz7V5bp9hUgRpXc4VmX9hv1V7++m8OKYz6wTPjwjSTP0nIPB7x46C7x8xExaIjWnZ155ZVyBcKlQ5yUcuQp+aCWa5O6Xgxxcnh6AGSyNNLBdFR6M1vTjRzMHfhV07/6VLSuQlG8ZASctHmPwSwqIwJZcg3zPh1YRCkqH8BgHwj63DfAiDJnNq2fvMOUWBqUdAAU8KNaINVvGVB8DE4r2/EucD2Rty8FekjqgKkamN4/oSnL8ZWk/Qz32Gy3brp2sVe9qnzMbPs2LnUMe2FnSe6CQ==', 'supabaseApi', '2025-05-08T22:07:32.847Z', '2025-05-08T22:09:24.195Z', false),
  ('9d8a1515-7d4d-4c07-84c1-b730de8696e6', 'SerpAPI GommeGo', 'U2FsdGVkX19PKcHbbYPXG63hGc/WlaW5iub5qeD2NOQ4Fsyj4npZZhnRDS46aOTa5rKgae3Pg07NcXOzmvj3ZIqhdg3KcuEA8Zhlv8v9Pv2OnWosStR7uXBCK6aYaQHs', 'serpApi', '2025-05-08T22:10:37.696Z', '2025-05-08T22:10:37.695Z', false),
  ('a8c9f23e-e8f1-43e6-a2d5-0133310aa542', 'IMAP account', 'U2FsdGVkX18OxAKGIE8OFOyfkzE3vTV/Fav9uyzrAx7Fl7Egj5ukDkvD9HKiBwgUjmucmVxSjNNVPkU2Gq7nrXeIbIeD6GsEwhAgJpMEV4SALRuPKZSgyChYshsHGMcOZaCHzQ/dvHTjjjL4c9Zaqw==', 'imap', '2025-05-08T22:11:59.413Z', '2025-05-13T14:52:14.104Z', false),
  ('7ce8eab5-0cef-45ad-800a-c43edbc12b59', 'Prestashop-API', 'U2FsdGVkX1/qfCu1uHFPuO2o7AlrHTVusIsjv9wC/LDMbo0fgsDtPClZWzdV15I4HFCOimmQt4zwHzxNH5LwiA==', 'httpBasicAuth', '2025-05-08T22:17:08.315Z', '2025-05-09T13:09:39.460Z', false),
  ('777c8bf9-a757-4287-a34e-d4f7ccc68047', 'Postgres account', 'U2FsdGVkX1/FpDQqiSZGYGS5g6E+yGLCh32JXJbshI5WRsAW65picx34bgHULXT545X6xQInbjophexbip/zagmygxziYrZL6+gmVnN/qKwJttah2NqDL1G3vFeigih/', 'postgres', '2025-05-13T06:09:19.072Z', '2025-05-13T06:09:19.071Z', false),
  ('a7271b78-4962-4245-9bbb-ea5e268a836f', 'SMTP INVIO GommeGo', 'U2FsdGVkX1/hw5EZr1y0vVqXrNyuEGatBZYSJbO6yOVxpjHJV/qntnyGhszVg8twcXuUdZ/DpGqat+1+JV4lybUiGC81e0d8U2TRaBKrt1wthb63HIAbhY67fBduO4yY5U+Oczs03VhCxdPRINeeP54Bs+/Qd0W92Onc7PqXlig=', 'smtp', '2025-05-13T16:28:23.275Z', '2025-05-13T16:36:01.435Z', false),
  ('b3896c03-378c-47f0-89bb-315ea9fed932', 'Header Auth account 17TRACK', 'U2FsdGVkX1+8Nalvt17h1VKiczWIerg+yGc+XaFbufdSrsBQz5wT0fDlhyG0uoYLBeSEwVgMmRovDFyeKLCClPXxU3FeWC4xaFRBIJQ9mj7Jh8k/h7W9QefAPzYPTD10', 'httpHeaderAuth', '2025-05-14T22:00:32.428Z', '2025-05-14T22:07:42.899Z', false),
  ('3d8383b8-5f73-45fc-8658-5d0ff31bda22', 'Google Sheets account', 'U2FsdGVkX18NGUAZUlgm0jWGgGxki3vk0oCvGaTI1aiVZDJsfLYn+4+4M5wKDgQAtjVGhglaWsPV95KIWHZrQc8S4hVOP7tw1RxZEXS5DJgujzjZD4IeuYMCW4UeIm14wIQgQo+xXPhAij9dWcbBNxVekqLS2NZrX/fWEhWp42zshc+/xnYTK+41mVUcW8jEPQd1L0xNywhMtYjjaqNazjqKMrewtQfxE0YJaiUPgsd1yOHWDSlnsYI4sCpvhLM4swr6f35h5nVbra8CcQmzsmCl0a14Q2GiyVlwFxJFZsHBc/dY09HMdt9pMoNEhML0uNYoKhzYxTW262L6yoaMDAVzfzYAejCqaPfX82ACg8nUTIV9MGwr1Yqg4CkFOrbM4AYgUp0NwhlmDtqX8yzmAnEhj2OMN/+XKwnaaI2tshv3e5bIq66XHb3DWnZ5/oBZHsiFceluzkbM2RIesegXXjkdefNpSmJXlk6TAcpQ3epXa/RypFNidRyeJ1RKN9iiM2Td/olIjUrQR7EGIfn45ANBPKvHB1FVSXxH46VkCR7yO0xv4tBNffLwLys126zfTBM/YQ2v/mOlN2La7FeqHayc6N3htaKeQzOFZaUhS3gLFPtZ6slFpiuBMA3ZyoxBQAcWyIyIQ7g9Ab2uzMNqKhhMzopNSb2IFbcUdTH4G0EQ74jvQajnbVQfD0Jb0ESz+etLC23ZOoiInjieynLSVfsRsPR3b8TuMrQA17S0aGB7a3kYm0YFKlXDTV4mo8ivzFiB7Bzo7+e0Vt5mKU3TxfZUWbXKXFGaSngPjm94ZwdoELMK4ih1apNOAFSuGgzTKO6106RoTuxfKcuK+sKbIjHBUcAsyY/j/diJY5HDfASY1sfbgDqBB9lZWkEh3/zX6Qdo7uiIZn3oKZvzZweyRAhZ4yz70yS9UYDgCvjdYVzUbURZGciUdHwVKSc1eH2UZW9WUUbAAh7dtqvDUzEIk/FJDcdZFvlcJxq29MKoDp3CaeBC5ue4Cxz1GRpQlmPbe17HmRMR790dUn119nZWUtPue5sl/i3CgLiP7mtqnnoyZ9eKN9HL5LXIcMoNyxIzfcrcCWqeo9Aw+sRk7nnQ8/lN49b3UVdOYZyyzqMZjEC+Qdd31EA+P/G06KXMstNmMNMNN/Y5gRv61NQWsezx8azwkjhbQsGR85+4Qil/sTupyGFglFEBdeK2d7Q9Qqo1wNHIbUx1p0JAUcEC4mEtMV8A5cJsdH4Twfyv0eyIkrlCJsu+6YXn7SJ3ndU457oHnpCRXUVFJyAKfoSyog0qt2SxsSCHxKzSWGPPVUKBD1OVG/p/2R92uq+Tyc5MqtIR+e5mV0tHbF5jmuhdmhtJucmJ/UHOhyJFwUqfJwuVCakwGBV3L6dAq83PP1xhc53aBoKeF0k4780IzYQ9bMmGEUSyPt3YLBUnCZlBcEXdLPQb1VHGcYux4PCQ0UINHNJGMGZ3vRUqRqJnqeQX0ocJ8kyeu54ORX/AuarRC72AAASre3IGs6VKOv4YfF6EAAiEp5/SCPlvBD3rSueK3Onv8mLKbyRqt8Nr+LruggWo7CxbCIVK8iQrmV+jvGL9CzfJPkK8NsEKm76hAb63Xo9t7DzZ30qGnlNk6mXnMZ5lZUi9WQExHOfvp0mf0Vo9zxkIdeLSEOYKg2ZMUpRS6+Z7Ow8UD5ksyN44h6a/EhNaTCbxbh+EBvmvThoaT2mGtROvJunkvrQ5CEn84hPWSXk5XA==', 'googleSheetsOAuth2Api', '2025-05-15T23:36:43.973Z', '2025-06-22T22:52:45.228Z', false),
  ('613bc958-1311-467c-ad92-bd19a028f7f3', 'Parcelsapp account', 'U2FsdGVkX19f/HSZz0KV+YRkdiIARjYsrrUL0ThpoD67flvVmyd8bEN4p2ywYXj9lPXjsRSMVeEqWSWyHyohm5/WoiXPaW7c5A8RNNsXvMC+PyD4NWeHuKo6LSgeztxZHPpPTV7kX78GfWZiV8ZRomeJgYBVVNUwSYHM5NVF2DCwNf+vEltTrEzm/WuQ7HZNq10uz6OukxZZteFuVgpabljmQ0Te+wmEkzQ8QFeWnN2eDCgaXxrxgy0E9mlSGsVvn1bNlDEYbkXFcUF+DeGgmN9GoPAzpez8lCN6gdctrOl0ECfK+tMsNjPh9XmD9l8+EzYpGJjVMeAI40/I/BXu8g==', 'parcelsappApi', '2025-05-19T13:34:47.351Z', '2025-05-24T12:03:12.171Z', false),
  ('c45d63a6-5b72-4cd3-9f77-473349a7da6c', 'Outlook Info GommeGo', 'U2FsdGVkX18VH6v/KMxvr3s/He4XIxrk7qtIVS9v6vHMDWce8qt8AZnB9bjVGj+nfCGK9jOlEGgq4Fe6EhU54LZFZszIgwM+AZh37deCojQm67BVqrDu0TzNB4X7hAXFB86NjWTZXUz9SjLSvhBLPii8yOdQFpRcUza2qG5eCrsGD95GXUCz5g4nGwG1JWo+LbgayadrBenpspFFKQ6HpHb53S58GqXoZK6eNfSF33NV+V5RjnkvoZt1OrGzw7MnXftpklES3I5oQ3mJPZq3H/SIAyS/qg4wqD2HCe8Wk3Qp020ocqu95yPig+u+NLGALDoDfPkTX0oSGiNfYzVL8tK8IpHZS2hmX11bEEAZ5YubI9MYut+JQCLq7RhKrtvqtsg5p5WZ912248opfm8BtwkrmGhCQo0rWiOUBhV71u2hZ+1rwZU3hoPyziGmAW+97y8RwwRSJ7SoFZCcJ58EVjZri/tqd7/Am8or90q2lQEydi46VW0AfAxNmijsvtxkKaXuq6Pm3YKmNrQVCiiiGAT3V+suwcDgOhJy0QQ8WSujurMVvRvf3qjsOAB8Jn4FUv+h4gCDKyteCBCNSWtZSzlny3vYhJNfL1zYexX7QHwfsl5WKvlFEgfABkP6wGdtTRzwNP2ICW9XDeV4i/RLtvdIPU8sMjn1TPOP4y1k/Wgrnbrb1mmK395iskRAy/H58MjfVCBQWFFYTBc7JE2KWsbG7hwsUst8TYfjj4eEOCESvuHkL3OUqygC7S+qwjBJkvfJgNx+3Tp+ZtduVpbByMcfwWdGklwMckrktlnEBlK504JaGXtG7ZHet/8AvyYiknt/SztfUau4g/4j3O1SDdOVSks4rbCLYCZBz+qNCmX7cilt6J2Wy3D4YyaTbeh3F0uLXpKp2KAo9iMRF5bBdEhulpS7ONgkuJdUIVVUtLXd5WP2a+eZ7SST7hYoLlH2SGevP1jVBXs2cfaPioMoEdhROGk9jVlMUVZ3OjPDLuBy4CG2K3cTIFqeUQpH+qFvS/zZW+9aXFEOkgXfr5evwbhkJVbwu7RYMfg6ky6M04y87InRDq93fNaRfFHRr1tGP9OiKDPBp3vDcAwbAvL6wKy1VOuujn83nQ+9QEujt0rh9+l21d5FjAGsnwFEjDOo8RB3qVTKyzxwANVawUNMCu3KerSIS0HZgLdOwR/BRYLWICFGMEiT/9yR+NU6o3RRTWIRYU6/xNs25WG+tVcQ6pM9U7pDS89Y6VdstpX9kOEYN071bl9zw40fhBcpfbfeu11ddSXXIchfQrsjTOk+uISM4PCzIlimnyubVwaXnj5sxnKHwQsH93+QDJYTUt+XrsIGy9jokwGFTiwjOCmDh4/4UPjEwlmdUr8vdOnYP22bRJmbdSXuFwz3GSGP/S0EtrTfST2ytbV6sIiAVpAdd7oUOI47RAh1OZ6azRj/xU3rGF6U/NN7BYW25sCSlLWRTI9tBKBe62yzkeuBUmdC9Y3Pn0hn48jy8LKKacNvlVHs4+FMeh4Z8o57Zvibo+2dnD2I6rI7uFvSQb5lXiadn/X6zTuZZkYSbln7O5D2THEVNnZ9X5KCZ0KDcuSqffZg/KKVhd/wHuSSm7PDqeuWKJFVh8QsvnTkuT0t4yQ+EH+8Swy1GgToLPkn1FZ/TL62fKUb0mCn19c2CGSy3Nkv9ghX3/ggj8ZEl+JTEd2EJgDoD+anbWBnLOTIdsCYLDMJ7EuBIk9ujfJvYm7haM0kV5mB5YF13t+Xr3MCklemwRJn+Rrni7UPUCxokysmIBeLmwNq4zEnu/XTVE09Nyxabps0oGaDkCdlfBuReafOvwyP0v8MJq1wVSjaKmV/xMxKIPLuBLC163n6d47iQn9ysVCREoY340e6HSEQDazM2mWQNJOmGqbFLDT32sPsENEl/DczySobdWm+TcX5Vqy0jK1SJejRU3TlmRjfSIK4Pp5cFLjBPYX3E6XCtaDpBvwRNOadDfwGdap0ygymQOqlcocU/b93XG7em+v1IBDhFhFJvlELwpn9sQZciQIaIZhy5WHuMt+JJWzPZwEVOXUm4alSwXRO7npQG+LTBaAf054VhRQc2XLkRcqT5Ck/y05VbA94vCz5CzgGmP5fSi2s5qYoy2kYJEYEOs8D4wCgY3tNZqOxXD9Z06WuY+twPx7K9bCSax6o5F2FxZZFUufbtalVuZ9OisCslbLZ7L4qGAuQDnHBmY2/oK/WjAXzs0QNAM7ZOZs8t/lPq+Norc7aaMI0YWPQtEEn10NNXg7LPUxOM6iP7iCOUP/clf2Ze+f4Zv9PhVrx/+riQlW3xz1T3wmvD9Ad6Y75tcB7HBXbxJQ4oqxeZGmNRo5bS7ZYXBg7bSoIAC9SI4dWiqePcx6iWFD1IbH3J0jUArOtbopolpXum8KnZ2rgQ4CicHDg1/Wc4w+S5WXqsJ3VCtFQ1+x46wLDwCdYJsy/X88EPps0IbHI8uvrrPObIiTYvpltCnPUhyTKYaPdfw4codgeWcNJfQlIJ6Y6jpB7cfIOdMcvhttM2+Pje8SDucLHJn9VfKFrKHZwv+YQne2KKYPpohcVjMC19P1rk1y30LRyt5JfjRMlG+JXYZlt5rUlLmI+NWepi6TmsINSntsRbi8NVnUSS5LWSVPBvj6ilEJ3BGl1j1p/iJqP6TC2caDX03IgxxMn0z0tnTpWcf6/f7xeZ+I74iAzVQvRBCg0hqumyNVIH6pDhqZP7qeWdFNRLNVUt5Y8BYRLZQFjCyCPA9tU9ssfXdxlg1ql+gCkurtdhNy5AVznDNTDG/E3ejRq4uohIb8FsK67H/b4+c5t5/9mURsYnXNGScguBJJjFe324i2jgepQZ3dZ/K1QWsg+bjN8VCx4DERWk+Cbx6M4zdKoUZMWcbt6mDsZ+clUxmpkL5BCPtAZL3TawmtYkN2wFJcZAickWVmNs3tQ84XL2C30V+7OkhnYzIVsBKsTIG8cP5Xcqozp/B1P7WLlOvd2QWnQI2OWAcWDCrkW3WGT7gWrqd/5oAz9/yl5BJ87ozE+yATmQ78JoWUYcdoS7LrLTv/ErfodhamC2+E+ShKoDFZ19PM9qONq6DPn0+2UrFAgNMH8mO4viSAY3iqqUvA096uQfnwOgSsXP33WEbIrafQOhvqumDWdnKjD7SAn9NjnT+zgKa9adWrcLm2KbpCHptB5Ar2t+C9jrgM0oozr5VXJIrz/J8jKSiFp6Rj8moqJAo5HwjXgPoKXzx4tSzTnpKRtM7NX6bMrHpyETroyOPEz6lDT90wREjgrUN/3Zy/ruj2SohE9P9TP4SmtxDdGG9Kjy1hx/mJISOEvpkhWQ/CTvsB3X8Q0LrtO+L9/qHEh1JZIK56DWfWVLJzsb8kHXPDhgOvahtENp3Dtb4QhjiVfFIySLwt8XctjqgtkcU5HbLj3YWYCa0mcb2SWnBMtXqfX0c7vUtz1CmF8cqbq/KOj8KaoPYtFXBzdMHRAfH0GFTI66HEc8XQQQoDssCIxgLnKpNTi8QK5pzgv5sq8Q118AjhGJs66gCdhEMK9uoBs0I2V6s0lS1axJYR1Ph0iPvItSGe98zQUesuk0Xs/CK6b9vXl1V2/+B14JrlhoruNuTyCzOp6nYk7CUQ6exTWUGQ9djvjjP9d/gHqCfPsGYUPxMTdtMSAxV8nnwqE+4yZqjkK/hN3QS35skpECHhxZAYyWfy9Jr+P43tNAr7h8wK7oGY89DC1wES1orwaDpu+bjx7AvjRjWxQipdT3ynL79aDVYsMw2iHM7cQXS4N70HPz09vV8fEkON2MollBUBlFYjjVHtTS7WohtBmwgvm7+mh+Tg9pfJ1wGCAr9n8zbN/lH3rw5Gdv0NZVJUPOkTG6QWZ2FuGMx//2VOjSXceXGfuR7hq5lE7i58DdjWsoy3siVyDykB0mTORVrZ0AErh84P1TR3/Ub456zzLf4hhIir0uslLb+Ta512rmFcFpN/03Le9v4CWcRd7z0i0xnqlsKLd3AUZkXg1Q2rnsYeSnWfOZ092/6gMpGcHeOMgLugn67YMebHL4g9+zGN3L6ShT64rUjU/GdFIqr1p1U7VxS53fonkr2BEsTJSa6PA2E3fVAnr+TyxfrSZkwe0dBjWZAkE0SMwzU6FWzj3LcI5yqADS+yuJ5cW7w2NEVl2e7XdmP9y2eYNmVfSUbnrHqBBC2RHPSECdMkhZIgzs9BBxZxXPDXGYmr4DogwoSqXrUW3uvT3Q0susx3Vdzpve5PyDRY5U8PPMtQjKkgWTgYGxMXeAiNBVVxBNmtSy1w4W7KkRXwUz9bX8EBlEMv5wSJEGhpd2DCl0YQh7K7k18jYPZBgkCHv0+P1JisfGQRh+L+Ctp63uAs32LcRefc2uLK31ezGe6O30iOzY2y05h6u3gQWcoGVIAigfRnBvCwVRFdzq1RjBBnUhG40CLoFPw6badWV8AIDN7vskNgmMOlyv7qyiKgzoc+mCGWVtQLDkBUMVWikdvOdC4DCqJpymp4ezpl0Sh0E1Mj/soeVx+QZgT28F6UF24/yIuoYWxPBQQKdamwSyQXKkOpz61RqSwnnTrbynQOgspyrtqOR39PhNEIhA6sLe6wHGwnajVkIT4nAZ6D/DYBYXBoFmuy7YAPDuNFAujKY+MndXoRu+OUJ9GELuwOZfQqU8P4ohkHAJ2WNDluGncXpa6BenrMBWjGC2UPjuroRYLnfEPimeL5QUQeLnoekVv/DH/PSCYeC4IVeGXcshqN7hHg8loUVTI6Ne0d5aY7wvmoh1hmehZi/quvCGUlEIDw/UudkrlFJALLf+t7exrEAgGfp0PyGFy5yvpijqdvEj5gDtXdIe4dGOxfsiGfIPwOzDc6j9Q1UhMAiM98T/QBFJyZ/f5nXM7vosTppAgSZpRb8CJ3dX4G5Pxoiwfz47ZhKKr/94/mbBsBYqPItPaLoMZwX8xUv3jlF2QX5coFiJH+XTBcuk7Fuwl8GG3jYbSDFUXhijrUPZ3woXiv0OzF82JhupNXkXmPA03baFF9+Tuu5S4+/nf+A2C6oE/vb6flbn+6Mt5BpEiIhfLB6bPaXZL6dv+5AO56dVCTZmGA0YUP+staW0b/tPBG2URF2Hl3xQKjThfPFpnt9lWBzLasTyPICgAgtNzMEfvfBKq9R6lb/svDwvQNvduAlHYL/N0tNvXvAw31JyK1ecgkuOAGh1+BblGeCBEVDs6057+IbHBkiUUo1sfNnc53KFsqken5XBXKP5gMBab6HgIpcY69dhgHCdbWiaUX687V1J3RkHc31kitDpAuwWh7hMQ1FckrAal8J4EjY2rqLe0FJ5FDPfxe0zbSosVfJdfsK09QrGr3Th0L15vrVLNb23EijKcqcrIKz28/j1ByAS8341xPDGl4wqpuB5/wWcxAlwBlS9uTK//27OxcqmJpWWxKhqjv8EY6kuYIk2+sLpgZ4g8j8H2Ew0ClNtp/vLLkMyWVc5B2ghLOVNMW9/egussOGa78L164EtsLDe6mjCJnqqbuzzn/HaPeOyL7L1ck4pEH0iwovto/6wQmP0iA8GaU1S8hLZE0T4lQY0t2to9XsjKole/v6u46n8MnwXtYzVlrRkofxQvnzbUq8YaKYOF27qX//PbcScSftAkcXy1FnJkm0+16LxD3ClvWTLbGCcAg7rWBjLx8yCreiBtdHiejcm6IWBk8a32D9GUW8SSzrDiMmoTaFbZOCzQSL3Psh8CQt3b/o13Cmw1DDBkgCF+JlZybtMYbcrn/hZZOqfB9ZbD9qvJAt9yBXERTGvNDN/zaCopUzr+u8h6CKTNlwo9yU1iWGLdXhFhO0Ptg8pCuOuvt2c53PKD2viEmGxTOBKL9JVe3QqXYlviDLgU4dHNwstmxfXvZNAuhI4o2/2Mdg9coy8tuodiDZ+wOtVMbzfKeSIXGG+U8Ntq4RatIzl05Mr4EPKvAylt2GaFzKAOzpvf9TKJNz81KnSSPOwlIGh1KiusUqZ+qBjATILmI2JaiVsufrDiFHXOjlHRMSzryJndjZhkSHQogBIMe4QCrca8qjowCGTm1IAaJZercAWbbFDsdBLJIak934ov01RRiOE05K0Ro5nVW7H88PJMUofWGwYGm3okMp9IVjn2wwnGcWJ/VKqw+xMdd9pG/4GjuA7imiu4vStDxcI6Uh1qbLUXhCS+y+ytQ2C0XSaQqUrbA/K5ZYSbuWuR8DHzEV19PxjptAF1X//FbSmmzKEwV02Y0h4insUwH9NUqupcWDOCwVIo2XdQ9J9X78ZAoOtxhcRVAqiabAvIBQrK7j/NxK5ca1Srzq6v3w9/uXXwEcmwZUaYTYS9iCoZSpcPuCTmqGqraNsqFHBbqAJCtuyG2SVpt3bqAYxBiLQ5ZQfh96/9x052hQuOUuQQVHHSnu3dRpe87IO2k120f3XXx65vDrYmpZXUSkDLttJoOYIsKFHEzS7cgpJkzZLDTO2L6ob6kGcIRAZOHcNlB0dMKscLpiTx7wlITOCKlBgiGLkcbL+AUEUo9eYxj/Rj4U4k1xXNR13oSNKrLm1PbWndRyX7PG6krP1FziNfayFyNctcLF0V6YcKCcBEsZzDiiQlSaM8zzy5E8i9UROc3G2hmQWJa0GKEmJIlXizJ3JlR5gua4sWh2enDiAUy0Y0Cq5s0FtKg2cgzdJNPSa4QKdJ/NTB6Xr2RNJVpjrysypDmTkqt6zEya8TWeIU7/hcmtBJbpYW9kqAopP4rGrNV3CaZuZiveJWfy29SsC+MWRqMbw9m3hFTKkXs/TDCkNVYGZHUbvUlhEs20cMhZM9IKdo/4QAKWxInZZBflIfOlmzv23NVIY6lqkpqHfz2QerW/ZJRZ944fdZE2P9fnPZdFzIETcthUa4zRTI3oBDpcdJy/0RFd+4IOj2sdlMEoQHiNkSQyt1JV6uJ7e+WjsoRqDN0S9jRziQaDIPMaU5WaQq17GpD5LcnN08AhWvLkgzsueJv2o0zpVy5zESpYcgOsEbXEt2EJP5OC5DmbS7+tF96t1wm2Bfu0fuwrZa9Xh3t3p5GTTsXa5va6hKfssEoAgIa7xY38R90pttsyCn8vkA/VA1h5L7nI1l7QwqyEUsg3jlB9jilU3exSFg/LSZgvjuryI9lkW+n3ZrM2Oh+uSrlCQBLRdW1S38vW7B7KPbGF8pllUSzPmX47h8PWuE54HeBUwp/hjMRq9WeitmtTLx42EFM8o6uZ8rpAGQl62V1ga+B6dSeL+lugvJEU/Knqvj9g5QLHh/mtkSN+lYRTEKvhUggIMlZyUdZ9eA7tLwf6mqsf/PmVL71PpqOsL2KlDrP9oTYnJPDX8aG42Ao6hO8XvqgoQIEgBZ1QwmcJbqoqGcuwMj/0Pr17CrGR/atPXJ8kxW8WIzlDAFj8gTDNqpPo2Aweq+pmPAZQvk+5LaKKtGbtZYzpBSUfHcSJHa+c/TMT3bfdOr8jb1MpoVhc7heXlwAQNInLVU/e68ogiFM5aO23GwWf+cXgsWjK/R4v+DBXW+xnq1NnC8UDRpAzl/kdkDY/F1KUbww+Z/ncgCVDHidwnD0iGFO0dB8K18N+pRrrqb0M4YuKrfICoSzLFHLCaMSVDt+87f/dy9MDQUnNmpME2evXNWJPeQ+2VqGnOdJw9P73Ekr2nSxXqWJLFWriEv+6aoeJOdMCbq5jDASFePsSVwPhk/lCiuTPVfc7oDm/7t4la7+aHX+THtw5RcmU387YIWe1CncXIo25Hqfcs8BA14QlFrj1Nj7diSDW1r56qXsKU1whTXH4Jj/Ws3AQvLM26fs7miLthupMDJVY4NRdBfWzzq8J3W/uRtERCKyGO7apw+dyduA9CHb/RlsTD5ZeRZpohUHENMD+Ob8YanDKcTmcuQRWQPLJL2gPGBuBQZ3HY0XXyzmkDUm8Cq49Lxc8q7D9B46nRvhsXEotQRZYly4DycDnhRhE2LbELGpS7RzptqbvwqG+77XI5/kGERref8Yn28r2DOIyWDdO0Uug/SBR8bogwUKsa2zRAo5chTW5o9QpG4X2/DKoiUxRW/iS5U7/g3Bfqojtb058dNkczzfHLu/jrUyh7IBmla9RGoICRLVFJyCwh8WaDqNhGfJ/ClFs+N0tzi9AMNZ4NfcDwXh4XdLung8nc1AjCTd3iwQKbfuT6H9HqGYN40arMu2NaJKmOKqO5E3OrRHmZVLdvlv3k45j71++8mGdlh7mM2QMAig1P43ecuqkqbRHkky3uHUSuBUfp/m7pTsiNR0eXU6Ufags13BDQ7NxtXLhLQ+fsAJKaO15dzlZn327wuGLtXztgoy5bjiEIu3DXf9rK6nhoQ==', 'microsoftOutlookOAuth2Api', '2025-05-24T12:19:03.604Z', '2025-10-08T13:40:19.307Z', false),
  ('b1a161bd-e7b2-489d-9137-6e6c18ebb51a', 'Supabase tiziano.annicchiarico@gmail.com', 'U2FsdGVkX1+2SSneEbG/nmUoXTK9ZqQ9ppB6EXXQ0Z1N4L9LDrROVWqTlaxQ+MBzr74fN4FSHb4MjAekw2jfc8BY3w/DPgsAMnf6EWrxhmR3tndrwcCc6kg+z+EQt3pWo99RyUwaCID2ANoZbLV0HGtqK3EDHzyVeCPhq3MFfCs12Eu3q7nN7YlupdzBs/pxdJUxfkeXXLYoSKVdwr/un70eAhzUdtq+NzarTrTK8XxmMYsdvPkn3VPK72HTXMoIBSURGqd88M6rcbnp1isVMGOzs+1/pn0J7mPLna1VdGHy1Dc0weXrZTHNOfM0xDSsqvW+tY9yG03IY2MC8AHIFA5BfLzxwERV5hSoqFaXbKMhtNChdOmdJk2t+F22Fc4+yF/u6fEoZ9vd14hGGhKPeA==', 'supabaseApi', '2025-05-26T14:51:45.653Z', '2025-05-26T14:51:45.652Z', false),
  ('01f1ee34-84bb-425e-9b3e-ceb74398e242', 'GommeGoBot', 'U2FsdGVkX18onBs1AaMGASLx4+6xUViIMdHvegrCgT03VwA1vOSeo7YeudHYkk+aWz7/beOTZSuQdz2k+6wzog1bKsFI2L7VWS7GHSBd1EJUG67HwcU96UTjH2hYRrqj', 'telegramApi', '2025-05-28T15:03:52.300Z', '2025-05-28T15:04:07.974Z', false),
  ('d57a9c69-d312-4db5-9ea6-9893530bdacc', 'Supabase  ERROR_HANDLING', 'U2FsdGVkX1/aDM8YwhuXHEVa7mPVO1zV7lwAacVxDqVOLIdTSoTjp0OIZ33IjypepsLCg/UG2+EUjY7ibqbMRYKyybq/ztSj1idpoJJPOf9ppDZ6G7WhcBoLLOJES74g2NQDQIJOZq+ZIuUxXWlMcxXCPU3/vlp9dFSN3RpgqgbD0e+4tIscdWh7I3KV3AF3cOrTLc0bCnjfyAa3fvlJOhcopM1VXGTr5ISSaOzULuDq2A2NjXe7Or3D6aWnAZHZixQJ9zs6eFS2Wf7UNjjsIrsQQ1gqUSDt8X2i5dBHi9Q0P6mImKqyit1MZhZj2KPmph4AzHp3TTLbqmH3wL84fDYxc+lb4WoWQN9DaEEr5FLaXNBpF7vgnH7ZReRzo511+82Qzv588WLTzr118LurhA==', 'supabaseApi', '2025-06-11T14:03:43.538Z', '2025-06-11T14:34:17.756Z', false),
  ('70ecf64f-b0b4-4cea-a1ed-54e252d5c888', 'Mistral Cloud account', 'U2FsdGVkX19ArQ1/gZYDiwyBndh+4fkOWAPLe0fzawu3WVXIm5DC4nUBNIDTxwaaD9z0L8e4n9AB5dG4fEzsbQ==', 'mistralCloudApi', '2025-06-11T19:03:00.945Z', '2025-06-11T19:03:00.941Z', false),
  ('eac1af62-cde7-4e8e-9478-748d734759ea', 'Google Vision API', 'U2FsdGVkX18RUNavlH+PJKMcLO9xKbCYlz74IXW8k4B10CVmY0BhmbgsXXh8n6XsTHqp1X264Jo7Pr91n/bmNi7TVyY84Rr2LKy+9Z1tYnMsn3DpCFYPWydkGVPIHTbZb4rGgMkYy4LKB56JlFmA5t9PoJ8zyROWHWIl6iNrOwgZlGp1xFjqcIa2HI8AgDaZlT1VPM2PqIKjx8IWv1L0ZipgwdePZ0ttvL+b7rG94yeprRFgzl1Cne8f6chXrd+GxiLWq2EQDTRdCKDlT/5RfwjUXQ2uoOLTqmL0bkFb/Z1NtZxrGkRTRqPCGzvsaBMfCYMEPlTz1atXObqrIo1xbIEJ0+UrnBkds9Wifckg5Jrt8t6KmeckhCuAqBrISdKo7iEYahNTQlB63hw2P+P7sktHRp6g0vHQVEuEhJc8jKewzeYTcXf01XX/8Mp05EgZ0mM4LqJUo7HbnCSThZFsbYAJNlkSz1kBZgGJgnYoGCspyALMf0Oioo+wSAr+IDWj2Le1+i4S7o9Au5NW6oT3ZZP61FgpLsZBR2A7fbiqCutQHyvUVSuYOxw3udKgsL23tzcBshaZmwsIs5OxhaE4AeJew4eL1seu28wiQ/EKah2uK4FicyPD0YKMPZ32DIsRdkYt0uU88u8eNWCsd8FcI/3p3+/ZeQtabNYmFjTv8gkFSZ+gjRHRRbExPyFW2E0hmzpdON7J+AquV8zYgZ3NJtCNooO7tyVhWztJaQJCmwU30IGozlXwypbkcZQiq1M+14e+8k26Yf1OgnNRbKcntl9sIr0n9hcaKSKRRJiWc3x9HbwtM/ZRDVKeIrEgSWR6z+jrE9XNm5ltHWPBHxYj2RNlMSWPHv9vQMGQf+tSrsDawUS6/vpP3vuuQT6Cv1jT071kUvpweOQ202nyHwEx/+6A//ZhZ16sqTL73Lr+hODOzbrsch18jWodUURvK6jgoePmP4zNcN5LbKhntEg1nVWSDJn7qxU4n5CUIE4NmcHVKuCkBJtJL3oBHp0l/vqJVxoYH9d8X5icbxkYDAcymSI9gfNdgcR9eFxlGooQnJzeL9n5/225O4IKyT2paz3f8rZQ9++uDduQZSxulOybLLUrq5nNg3R8gmK5lI6GNxshbX1xbdX08w7e4ZowdKRZnRiGyxno3HVBvnCsJo2zDL1DPEcQCvo2xQFKvdrimQ1ueb0tQfn6LpKjA+GBL/xonZvFDrY0Dm7BX7swvjCJW2Rs1Rf5XGgdnZivbaygO8ypArLRMzIfPmsCbOngOxOy3ka76c6WDfjNNGTIh2UasY59ya3sFgQ5zePI8mI8ZRMgzDlR0+5ifAaTgqJ5F+HlNRO6N2goI0sxWDe67HqkbqGt64Vp2uKbBIkCQIbb6NSnVt/asO2R5B/8xyeVKPDAJOTAwL/88G4VMTcOPicF4RuxhC7NsdZuZqQj/35gCcfbu5hQUrmPN18Lib7+4BZJt3EessfvZHKKjvLRCddlO0+Sck8sbboU/FMEMIux9wUOAGmSDyVRuqNZzBAcoboDR2WtvORltXJ18tdM7xle+VIs5ay2ReQdJl4VLJCmF/XvsDmpQbKfEcf8oGTMhqhU5rRvQ4xl3SfMbqz5bEt2nhtf/+P0bqLb+FWZKccEXF02JW3hgnUyY7jrhC8WpMkLoVwk+Ego0aJQCtM/t++OTeHE6nCdMhqoXe+iMcYaji3nSz6dl7UuDVCQv3uLkcscFUxrMIUfCnzmupCY+f0g63ukdZLjnU8XyAZzLBxuNJmt9WvraI6EHT+rDZ53+1H8M45KYpXRIBV24yWpTeEqb2B9iU59C8Uh73YuhDNOIQqH0ItDuDMKPoeAN9/P72Dz1PP8AmeteLbl6z9LSiOTnI/8Tup+GaUvhQWY+tRHyr0dOajrZMzEDr4zdxJm1VUDlZMoZDrcI8iwyO687kfgQqu1Wud4z8Fn6L1zBagtXQrly+UZhmic8Io/3DBdpozzD0yRTQd8PDf1xg36ewwQ3e5Y2wrK2WNnjRJo94b2nlMG3UXtTh4RTQS/DyR8XfMLdto8UaoDJESuI6KRZKxzQRVAIRXCMFt/nHf0KQ53WMbkbTCZ5m1v3ScB8DAonrSesL/4OxGsrzIJFqIYIv+r/NbKQ1y5I/AbQjqaE8HzCU65g+9v4PnYjl359gR8WH9KVe/+bpnKabZ2HCSJh3HuWweLYhaO/HL3zyq7MAaJSbu1KVLARBg28VnwMksTUU8AzOwsIEjBc1b4s273NDP0n6HoEiyZ/naHvVGK0muz2K9A69urlPb0NmJi0/z8x95Scg0SYLNADjqfO+kmbIi4ojy2Z8W68CCE9jBFemFHjW46I3OkbCMVU/3gdryHWLRrYXOTao23w3GAemJNLU3xud9c5IWLklq7a+B4Nh3r5e2Nl8U+8hBVTQM/bUN3WhJPxMVcukL7Ov3UOMfp45Q56b1pBdIiP6xWFOuCyfp7AXudWA75zg9E9+bFeFq0WocgiH/DAjEFpXd+PSxEjJ2G+MdiUltJcUpgYht82BKGSEpB7c4wRrSG4/cvGSCh2Pu2MIpftprgU/VCQAtctilakw==', 'googleApi', '2025-06-11T21:45:10.668Z', '2025-06-11T22:15:26.571Z', false),
  ('b727a9d9-aad9-4371-be9c-d3af66ab9278', 'MISTRAL_API', 'U2FsdGVkX19CMzqVW+/9SI/mN3fKg6mOeEHhk2Ztuqp+/1mDOo6hEO6VvJrHkHX+MQHVglAKB2Tw6rCSQckCh56LEgdcy3a8OTB9OFc1aASCiVf0oEGaqPV8q+7edNbg', 'httpHeaderAuth', '2025-06-12T21:01:50.391Z', '2025-06-12T21:02:21.410Z', false),
  ('9bd80d5b-41d1-4bf2-8c7b-8f0c0efeb6b6', 'OpenRouter TEC', 'U2FsdGVkX199aguugTGfHysX0zSxPLFh2gD/TPWsVWouIl/imlEZS7x3HTh5hMDBerqwwonSiyta2KGgNizQEd2CN0HT1WrXKC3l/DFlWr18PaDvgXhsSG5Whie60Xjwk5E4AzUk1FTV0eXl12XBZg==', 'openRouterApi', '2025-06-18T11:49:42.741Z', '2025-06-18T11:49:42.733Z', false),
  ('7eca9676-061a-4710-8116-c4ab49be7f81', 'DeepSeek account', 'U2FsdGVkX1+07TK+2LUOFaHYvxqlRo945dLj4VJxD/i3bETxlsYGsCgRGlJ2ZvxuV3gC9oG83xLW950WkUWmuFysRxw90ldSqMcG7UPvu+0=', 'deepSeekApi', '2025-06-18T13:10:28.871Z', '2025-06-18T13:10:28.867Z', false),
  ('83fab724-f4a3-47b0-94bd-ec338b8e0977', 'Google Gemini(PaLM) GommeGo', 'U2FsdGVkX1/Gs+c3nTTTUyGW9YFeIddOPEWILfk23YZf4mE1C0DXi0tBRompG/ycHkA0gU7tLv82+lbXu6Me77Qu+5CbTY3y9hVSN4RYei4=', 'googlePalmApi', '2025-06-18T22:19:56.604Z', '2025-06-18T22:19:56.599Z', false),
  ('fc8f470c-ee91-4006-94ec-96a881416da9', 'Google Service Account ', 'U2FsdGVkX19Y/VAgwfjuJbiuS/jg0FhIO/S3FMtTJD0Dx6N/znf9Tk0r2qPZK77zJqKlyUnVXMcGZ4KV99LFmTQr+Ho6POCkGRVWFNfpaE2f/H0kj0+DlK5JN57vxFlXFWYjUn126l0fHa3wtwtlFrJqA96Av2XiRKfgKC30Rzee+4tqTJZE7ysEptxHkFQJELEp3kaT1+5j8AqA9EtZ3CWnXi+Gd01s0VI6UCDQdm5BXOmmWQUtl5hVlp5bq/jdtfmsB9gVdhHzuXk2t99JekdaJDb7rfIIIpdfBh0LBMfV8SDMjZbSDN0wbfnWzmrtofTQEiLAeX9Ca9jzYUW9iIQkhmZx0arrwoCIrF+nDxmEV+w9pW8oEDGtqgHR06wXaNorxGNane5eTSGzbWsvsUbLJi+JF999tkyJWzhJkafDqXbyw/cEbxueaTFo8IbZBTgO2fX6lmMqQ0uL3YbjHv8Kn2fZ/UaCnJmhSpZbgthBzOApBVd7o63THkdyZEZBbvx6/+U1w/ToEo/HpB1edGtZeH7h82bWdippdSHrDQjVHsFF7RCj4oVICGS6H4J54A+5Bh7dG4VlMr1S1DWEmLArmcc0r9tm80RRgoMKiq3/hRiZyPomQaef69cRySrD8EcrLIc0NCircmFd/VjbBoZQFGrNZ1Na9b21CLu5c2lJVvlXqMTlSCuFUuNgKbKBWtSdtU1AS525aFdflnGQ63A156ybHhHsIct3OphzN3EvHIUeq+VeKn+M/PavMu6Z86ekvzhoj+u977uEEJU5yrEwCApWhQeokHqLO9P73N5/qXKBNHPs2/bAQQ7PcKVTs7cWXJnQj8XJWxqjCVcCxzZ05rB88jTrcO3JJfubUsHd4+AxBsI1h0M5RT/fKtw5vRstwOcCw9xnQVwe6AtD4LwRVF/yZvAX8FEJyRrztynfluhwQY9jFF7qgZlPtkJNnSEjV6jGmjGjMeU4pT6W71+6ag946HW9SDylvV/Xvs16CtgufhAFUdSVfFYSFtZBhhx9n3VqyQM9wW1d9+Z7CPkxpER7m8aOLaZ/6+IyXEBnZdHHiCQL+a3uDDGfRwjfliRBU5JBhcBVp/zRpy1EqRV4qL5zwreMQAWbnM3TszMnKNlnDl0XX0I+UXhAkNq2mUK70AbsMjDfRCF50bDQZ1BmWbF4xuapvg3Gq0C+d0z/4FJPp8KmcCaCCAaJ56hmeEkmQ+oCTDatUF4xy87EFCekwz3TW2CvJD5JmFO7GTdV9l/vPkP+XdDHZEt/z2+axXf85InqNnu6AxhMGMGFYYBi2auItGNchAQfMobK+Y+YOjLK+4DE5rsr60cfedMlNTSytpSlzUqjC5MTHhq7eu/qNqzzomCVLfhIegVPGKx/6WjtubYDnuYDqujUnNCnAzdfk98QWF2enpFD2r2vRcE4NR+ITFo23WIKk+N2TQMlUkk2XRtOtNkjmppu0T8Wx1MYEWG842Jy67qP4C6tNsz3FCcM0apbkrQKj4EBR94EYiTYISfoSKDOWmQl/nq+/hc7Sqw9gg98lIdRoDt3GYJoefLcPSEQqIZ44Faz2tu9gKZUlHxrcKMF4HxcJ50efJqYKL6Qx4hDD28+zD/p8DeIqRjTCdIoo4pdckJHfnIX966AhK4j90j+f3EzFyKRi0OKyy9BE5rR7jxA346QhbZrB1OZ6/RsWm7alPGs4xPP1i4+f7HKoGT80F9Tjkmy8EnokZaBKyclPnvroTvPDjm/pRNQEDGiHSmU+B00Qieyic/76ieLI+FAwLBPj+L7uBltttLDC5tuXMSw7wInqSQAlDPqfRXfvBx/I7oSYNnWfMMOExqfMy+7NMjWva53ohJYDbwwndvo1QG9Qx0GfP5kUCkv8EWYkqw3is8b++HCatFt7EZVKA6k2UD9ubjuNg2UblyfsR34OhP8jwssqJKWvZjLf60dBuRe0Pf5JB8k7mBzKjauG+uzOIbZ7/OkuucYz5qzZFhhMSVcQcIXgdooLKl5m6ClvNARfRmW3w6pE34dsKdyfo6JCDY9lzaHV0St2cxj263xncEB7V3944C77DT96MwS72XWyKsowoX+Qp3qpc1UnuEvpQjGkSIzggtykdq9DAZ0YeUr5hcAY2ztyYC5dmeX00A3aVsFCO/ruiCYG8O8wD+cLxzXnD+ihOvLP2bjGDSpYxOn+TNoF71nVuKWGJWhErR96VbRm9U8Q3X6SqrmKSdChJcW2j29JpjkQdxaVyzO/bAc6f/Q1XfyBoHZkm6MwGrblvBRlwV22L7R37Hxpi2oL8IcMv5d7wAcESDGq0mcGGWRs/Dur0xVtW2+w3IBtnu7i87VDuO3WdvALFckXAp0KbSB/PvTs+XyxgKmzW1j6VXqBAqIpx0M3I5jGOwCQ8SUg+olFkuML09Qlx9uYV/z4fiNOUTIdEjbIKFmuZyY+RzaKbQhSULIEms99MuSK8qFeYdaYV1Ol37NjjrUTx20g7W1+oekOb3RwMNqeWiY8yVEXWYZ6B8kzUcqjrGqiIrIHvJjSXv8W8OqHE7IRVdJ1eyZ/NSzr+j99Yh12e/Sq/r9WLkwSQ==', 'googleApi', '2025-06-19T21:35:51.970Z', '2025-06-20T11:15:03.762Z', false),
  ('03fa428d-393f-4587-95ac-ff92c7bf8ee9', 'Google Token Manuale', 'U2FsdGVkX1/3GjHyQcfhWVmkHC7t0wtUYzQa7Ny2ufX5NKn1hSfQnMKhIf0G0bT8XUeZSaz3GaCw8nhgUjv2QwQbdQ3vuXvxDkKC7MWn4fjt7FX9zeM9YwBWEa/a5RP0GMwrgaRO4DA7vDL80CH0432bR0PM8l9ivzMspiEiDPuCrj2ti+apm/yt+CumygHQdljMRja+t+R6EurJ8dxXevtaem5MK2ztIVp84IKTbBQ1xjWuENuzIAj2YxFFIFqfTC6i/EXCRXwqKw7MWyDPm8RvMV/i4vI2/dXt5WSQfGDyuN+r37TI65vpkRjSTT/YZTxEZKnOcNGvvnCVxIFnvLHKQVE6Dvhz0ptXhXDVbhF23SHYx0m+NxUVyPs8cD5HZt1SaG2jIxyyMkaodRq6DcSok8XvtACZcnUDIUK5xfKOD/zaXkm5N8TpEUxF31WHLGFmv/RXcoUZwCsIOJphGZ8HsBP0ZIS5mwi4m/Dgk4V1i5YMSD9qLLE4ff0WREwD0J5lxtabOyN8K2yBcTap9+cx35FO9ssuPf2Sr81nRILp8zhNjwkLhJBav7G8yFfJP+10tha9QMyFsutTyilUn94hDFF4KARN1UPQWOS6MhdrulWsBsXmKMobFL9nsN0a80xm8Hq6G4uHuM7OnkQZEVfOis4OwWCI8pS86sjOIAttby7Zj3/GfE2+nf8WLZ8lTzMTsAQzR1/tDbLcclwljUex7HFHAnKGiz2ufav+srXHSXC5FZXBW2kC69/jq5iVn/mab13IY4nwA71UHyv2kDEn7PvfL7tZPGYIz29cvBX3H3wCE1+3vJ/1GSjqyJgQxTMVPevO3Nsm0hzX3cuD54LBoFKS1q9aX8RK75lzdbsOzDpU2DGC2TDE+/OodzqklroxB07Y9r6MyDTKYjrNOHxG2ofXw0qVHqpFiwkIpggOiByfLA3SSLAwvn4wIccnlC01qxaAu+NBb+Co6FB0mLEM3pPxCOXAQ0W/pGCPorZ0SV+xMquMUrNBQt8V+fmGUfBAui4vGhgbtTYeKuSee+pj2jOPG02hS2hUrGkI8KSF2+yF3MUv//i0sOISKrPzKAs6q8wMOwcCuOis1HCrZ59+Y+orGzlayP+KS5k2k4A3rQMUN0I30zmSsL8mz564UlyfxYCSPrmd0VwFQbu8GNykEPxxNDbS28F2gppjDF8TXf9AMe4JTlHbzJ3gDeTj7ZL/vb2ouriL4Xz6OlXxBolmFP0cxX3FaQt5KS0znY0OLgoZ3kS8nL99B+WdYFEVeRItvkjob4VUiiC7VoSxW0L66yqOf7eOzbXTpU3OiylV+OOs6KvjP+8vlJXW6RDVvDErLwlQ9T2mthWrGqWH4m0lEHoXTVK58sXYz/pWu3yk6Lew+GV3bH26UR1EjeXcnTa1y8/WFaJTun7RmzIq5qgLSgQhk/YqY6CnffpOPA8=', 'httpHeaderAuth', '2025-06-19T22:14:34.511Z', '2025-06-19T22:27:17.740Z', false),
  ('715fa6c0-f1e0-4990-8ed5-a50bcbaa1685', 'Postgres Supabase TEC', 'U2FsdGVkX1+ugDbWjzA9M11FKge6jXtH1D2UDqrKdTYlC/Q3z1Lqn5k+zMzgmAUPiGs4VX/2zeXhklHCJMBre4HMxUV1ZWvpC1yZ5Ny1KtYb3zXIusHqU1ddb29z4mps45YrVLSNKtxtJ+HYNy220kqgMfOEoLlZeh7/XqO9fcoQXHWqZCA5Ma2VE7nNxB/0a8qmZvdPw9/53goKzfhdU5ByOxLXL+RjHnj6h6NvN8M=', 'postgres', '2025-06-22T22:43:40.772Z', '2025-06-22T22:49:33.099Z', false),
  ('6fcf652d-120c-449a-b23b-8edb910f08df', 'UPSERT_SUPABASE_GMAIL', 'U2FsdGVkX19xgMA/b44/BQnqH1+YIFotbAn6YVqrNXIGS/VRud3iWnWb8ybjIStdHV/ljp6faQpm8RX64uWf2e8o5+F9hn3S/2cSV2Mhy0BHLEBkz4uk/aO3hhgozh5o0IdelAaXXFdUWFFGfDxtTpKgOSDPnJGfZNmpat+9giYUUrUkQWx2b5AIaQjeDzpXyrZRbHY9PWY1ZkTzA+R5YZ5s23PG3Uye2kyqW1Njij0=', 'postgres', '2025-06-27T13:59:31.658Z', '2025-06-27T14:01:55.278Z', false),
  ('84883432-dc00-4262-94b9-08ccedbf8862', 'CohereApi account', 'U2FsdGVkX19EwDwbBPA+gbMPTUd5hYEK4YksZtKFItbLZRzJ9Ba1rJcVAAx8R6/murRfwkKGjI4MhaaauPXTzEzXsOIOOA9X6W5tqbXjYqc=', 'cohereApi', '2025-08-10T19:00:40.014Z', '2025-08-10T19:00:40.009Z', false);

-- workflow_statistics (155 righe)
INSERT INTO workflow_statistics ("count", "latestEvent", "name", "workflowId", "rootCount") VALUES
  (1, '2025-05-08T22:19:43.601Z', 'data_loaded', '37b28f0f-dfe3-45f6-8b80-5588bb964066', 0),
  (6, NULL, 'manual_success', '37b28f0f-dfe3-45f6-8b80-5588bb964066', 0),
  (1, '2025-05-08T22:22:07.092Z', 'data_loaded', '27050adb-53c8-4c0f-823a-8ec4780c9013', 0),
  (11, NULL, 'manual_success', '27050adb-53c8-4c0f-823a-8ec4780c9013', 0),
  (7212, NULL, 'production_success', '37b28f0f-dfe3-45f6-8b80-5588bb964066', 6704),
  (1, '2025-05-09T13:15:06.129Z', 'data_loaded', 'd6bb2325-7715-458b-b24a-80298b632151', 0),
  (64, NULL, 'manual_success', 'd6bb2325-7715-458b-b24a-80298b632151', 0),
  (22242, NULL, 'production_success', 'd6bb2325-7715-458b-b24a-80298b632151', 17973),
  (15, NULL, 'manual_error', 'd6bb2325-7715-458b-b24a-80298b632151', 0),
  (31922, NULL, 'production_error', 'd6bb2325-7715-458b-b24a-80298b632151', 21730),
  (23, NULL, 'manual_success', '99176eff-22ad-415d-b7c8-4a3fd60a671e', 0),
  (1, '2025-05-09T19:44:14.812Z', 'data_loaded', '43d885a0-5579-4b99-b0a9-67185d52db4e', 0),
  (2, NULL, 'manual_success', '43d885a0-5579-4b99-b0a9-67185d52db4e', 0),
  (1, NULL, 'manual_error', '99176eff-22ad-415d-b7c8-4a3fd60a671e', 0),
  (31, NULL, 'manual_success', 'f024a662-0ef0-440f-8111-cb1cb818440c', 0),
  (4, NULL, 'manual_error', 'f024a662-0ef0-440f-8111-cb1cb818440c', 0),
  (1, '2025-05-09T21:53:22.684Z', 'data_loaded', 'f024a662-0ef0-440f-8111-cb1cb818440c', 0),
  (65, NULL, 'manual_success', '6559f05f-1abd-499a-83ac-0d907e805b5d', 0),
  (3, NULL, 'manual_success', '3d95b125-9aab-4ec6-af3e-437378212fe9', 0),
  (1, '2025-05-12T16:24:08.545Z', 'data_loaded', '6559f05f-1abd-499a-83ac-0d907e805b5d', 0),
  (21, NULL, 'manual_error', '37e1513f-fb86-4e69-ba82-a77dddc7d468', 0),
  (72, NULL, 'manual_success', '37e1513f-fb86-4e69-ba82-a77dddc7d468', 0),
  (1, '2025-05-12T21:51:55.423Z', 'data_loaded', '37e1513f-fb86-4e69-ba82-a77dddc7d468', 0),
  (134, NULL, 'manual_success', '82178785-3751-4578-83af-2e76a419a1f4', 0),
  (1, '2025-05-12T23:32:34.250Z', 'data_loaded', '82178785-3751-4578-83af-2e76a419a1f4', 0),
  (10, NULL, 'manual_error', '82178785-3751-4578-83af-2e76a419a1f4', 0),
  (43, NULL, 'manual_success', '1c92e4ca-ba40-43c9-80fb-5e59d83d52d5', 0),
  (1, '2025-05-13T11:54:26.171Z', 'data_loaded', '1c92e4ca-ba40-43c9-80fb-5e59d83d52d5', 0),
  (6, NULL, 'manual_error', '1c92e4ca-ba40-43c9-80fb-5e59d83d52d5', 0),
  (16, NULL, 'manual_error', 'b5409d10-1a11-4789-8e81-6cd102dfd317', 0),
  (46, NULL, 'manual_success', 'b5409d10-1a11-4789-8e81-6cd102dfd317', 0),
  (1, '2025-05-13T15:21:26.686Z', 'data_loaded', 'b5409d10-1a11-4789-8e81-6cd102dfd317', 0),
  (254, NULL, 'manual_success', 'f2d16d6e-a2e9-40e7-ad69-4f8951c2f3ed', 0),
  (91, NULL, 'manual_error', 'f2d16d6e-a2e9-40e7-ad69-4f8951c2f3ed', 0),
  (1, '2025-05-14T12:29:53.039Z', 'data_loaded', 'f2d16d6e-a2e9-40e7-ad69-4f8951c2f3ed', 0),
  (1, '2025-05-14T14:15:59.274Z', 'data_loaded', '2cbf0f35-ef0d-48c7-8807-5bfb66d5fba8', 0),
  (17, NULL, 'manual_error', '2cbf0f35-ef0d-48c7-8807-5bfb66d5fba8', 0),
  (33, NULL, 'manual_success', '2cbf0f35-ef0d-48c7-8807-5bfb66d5fba8', 0),
  (1, '2025-05-14T16:57:55.100Z', 'data_loaded', '14ac3d3d-cbc4-42d5-9362-6ea276c18bcb', 0),
  (38, NULL, 'production_success', '14ac3d3d-cbc4-42d5-9362-6ea276c18bcb', 2),
  (20, NULL, 'manual_error', '14ac3d3d-cbc4-42d5-9362-6ea276c18bcb', 0),
  (44, NULL, 'manual_success', '14ac3d3d-cbc4-42d5-9362-6ea276c18bcb', 0),
  (110, NULL, 'production_error', '37b28f0f-dfe3-45f6-8b80-5588bb964066', 104),
  (247, NULL, 'manual_success', '2941934b-7c70-4634-9cc5-b8232d2d1720', 0),
  (1, '2025-05-15T19:14:49.951Z', 'data_loaded', '2941934b-7c70-4634-9cc5-b8232d2d1720', 0),
  (23, NULL, 'manual_error', '2941934b-7c70-4634-9cc5-b8232d2d1720', 0),
  (30, NULL, 'production_error', '14ac3d3d-cbc4-42d5-9362-6ea276c18bcb', 0),
  (1, '2025-05-16T18:04:40.601Z', 'data_loaded', '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', 0),
  (17, NULL, 'manual_success', '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', 0),
  (41574, NULL, 'production_success', '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', 40774),
  (16476, NULL, 'production_success', '27050adb-53c8-4c0f-823a-8ec4780c9013', 16083),
  (4352, NULL, 'production_error', '27050adb-53c8-4c0f-823a-8ec4780c9013', 4346),
  (46, NULL, 'manual_success', '8d788e25-6912-4d3d-bdaa-ce665d277675', 0),
  (1, NULL, 'manual_error', '8d788e25-6912-4d3d-bdaa-ce665d277675', 0),
  (148, NULL, 'manual_success', '9c56ede9-17bb-4a51-8637-cd6985fcc843', 0),
  (20, NULL, 'production_error', '2941934b-7c70-4634-9cc5-b8232d2d1720', 0),
  (11, NULL, 'manual_error', '9c56ede9-17bb-4a51-8637-cd6985fcc843', 0),
  (1, '2025-05-21T21:21:23.029Z', 'data_loaded', '8d788e25-6912-4d3d-bdaa-ce665d277675', 1),
  (8, NULL, 'production_success', '2941934b-7c70-4634-9cc5-b8232d2d1720', 0),
  (22, NULL, 'manual_success', '3b0e8684-b6e9-4be4-a40c-662c4e4ae476', 0),
  (1, '2025-05-22T21:04:10.013Z', 'data_loaded', '3b0e8684-b6e9-4be4-a40c-662c4e4ae476', 1),
  (17, NULL, 'manual_error', '4e7594b0-6c49-40ea-ad78-5b872b1fd5e7', 0),
  (1, '2025-05-23T06:24:08.353Z', 'data_loaded', '4e7594b0-6c49-40ea-ad78-5b872b1fd5e7', 1),
  (66, NULL, 'manual_success', '4e7594b0-6c49-40ea-ad78-5b872b1fd5e7', 0),
  (7, NULL, 'production_error', '4e7594b0-6c49-40ea-ad78-5b872b1fd5e7', 0),
  (60, NULL, 'production_success', '4e7594b0-6c49-40ea-ad78-5b872b1fd5e7', 0),
  (1, '2025-05-23T20:31:10.988Z', 'data_loaded', '9c56ede9-17bb-4a51-8637-cd6985fcc843', 1),
  (9, NULL, 'manual_error', 'b8084492-17db-4ddd-afb5-d263cfb06378', 0),
  (4, NULL, 'manual_success', 'b8084492-17db-4ddd-afb5-d263cfb06378', 0),
  (1, NULL, 'production_error', 'f2d16d6e-a2e9-40e7-ad69-4f8951c2f3ed', 1),
  (1, '2025-05-26T11:49:47.665Z', 'data_loaded', '793572e8-5ecd-4bb0-b8f6-fe19c058f1ff', 1),
  (10, NULL, 'manual_success', '793572e8-5ecd-4bb0-b8f6-fe19c058f1ff', 0),
  (6, NULL, 'manual_error', '793572e8-5ecd-4bb0-b8f6-fe19c058f1ff', 0),
  (5, NULL, 'production_success', '793572e8-5ecd-4bb0-b8f6-fe19c058f1ff', 5),
  (202, NULL, 'manual_success', 'a1861607-9f28-4584-9dab-917a7cef8ee8', 0),
  (100, NULL, 'manual_error', 'a1861607-9f28-4584-9dab-917a7cef8ee8', 0),
  (33, NULL, 'production_error', 'a1861607-9f28-4584-9dab-917a7cef8ee8', 0),
  (14, NULL, 'production_success', 'a1861607-9f28-4584-9dab-917a7cef8ee8', 0),
  (1, '2025-05-26T21:44:14.782Z', 'data_loaded', 'a1861607-9f28-4584-9dab-917a7cef8ee8', 1),
  (104, NULL, 'manual_success', 'c5b22202-d4e2-42f2-95d7-887395682461', 0),
  (51, NULL, 'manual_error', 'c5b22202-d4e2-42f2-95d7-887395682461', 0),
  (1, '2025-05-30T21:44:45.285Z', 'data_loaded', 'c5b22202-d4e2-42f2-95d7-887395682461', 1),
  (34, NULL, 'manual_error', '88fec904-cee4-459c-add5-7f1e9a8edad1', 0),
  (59, NULL, 'manual_success', '88fec904-cee4-459c-add5-7f1e9a8edad1', 0),
  (1, '2025-06-01T20:13:40.294Z', 'data_loaded', '88fec904-cee4-459c-add5-7f1e9a8edad1', 1),
  (5, NULL, 'manual_error', 'ae6a5952-36a0-419d-b697-17cf7bf31061', 0),
  (1, '2025-06-04T13:32:53.005Z', 'data_loaded', 'ae6a5952-36a0-419d-b697-17cf7bf31061', 1),
  (25, NULL, 'manual_success', 'ae6a5952-36a0-419d-b697-17cf7bf31061', 0),
  (9, NULL, 'manual_success', 'd7c4b9c9-6755-41f1-bbe7-c3d1b229baca', 0),
  (2, NULL, 'manual_error', 'd7c4b9c9-6755-41f1-bbe7-c3d1b229baca', 0),
  (1, '2025-06-11T14:55:50.840Z', 'data_loaded', 'd7c4b9c9-6755-41f1-bbe7-c3d1b229baca', 1),
  (1, '2025-06-11T20:06:13.262Z', 'data_loaded', '0227e93f-8f3b-45c8-8bfc-3c8c79ad191c', 1),
  (34, NULL, 'manual_success', '0227e93f-8f3b-45c8-8bfc-3c8c79ad191c', 0),
  (42, NULL, 'manual_error', '0227e93f-8f3b-45c8-8bfc-3c8c79ad191c', 0),
  (80, NULL, 'production_error', '9f0d9bc7-26d6-4af9-a1cd-0167f5efd9ff', 80),
  (1, '2025-06-12T20:49:03.726Z', 'data_loaded', 'e6483e7c-540b-4f97-8a80-9b9560c4e534', 1),
  (32, NULL, 'manual_error', 'e6483e7c-540b-4f97-8a80-9b9560c4e534', 0),
  (22, NULL, 'manual_success', 'e6483e7c-540b-4f97-8a80-9b9560c4e534', 0),
  (1, '2025-06-13T08:11:19.904Z', 'data_loaded', '13f468d3-13a0-4383-b432-8986556e7be4', 1),
  (70, NULL, 'production_error', '13f468d3-13a0-4383-b432-8986556e7be4', 0),
  (8, NULL, 'manual_error', '13f468d3-13a0-4383-b432-8986556e7be4', 0),
  (44, NULL, 'manual_success', '13f468d3-13a0-4383-b432-8986556e7be4', 0),
  (1, '2025-06-13T16:17:13.475Z', 'data_loaded', '86a2e81f-39eb-4375-8e7d-3483adffab4d', 1),
  (42, NULL, 'manual_success', '86a2e81f-39eb-4375-8e7d-3483adffab4d', 0),
  (1, NULL, 'manual_error', '86a2e81f-39eb-4375-8e7d-3483adffab4d', 0),
  (199, NULL, 'production_success', '13f468d3-13a0-4383-b432-8986556e7be4', 0),
  (21, NULL, 'production_success', '86a2e81f-39eb-4375-8e7d-3483adffab4d', 0),
  (229, NULL, 'production_success', 'ae6a5952-36a0-419d-b697-17cf7bf31061', 229),
  (1, '2025-06-13T21:30:19.343Z', 'data_loaded', 'ac3d58ab-7790-4d04-b093-81aae4b93de9', 1),
  (2, NULL, 'manual_success', 'ac3d58ab-7790-4d04-b093-81aae4b93de9', 0),
  (4, NULL, 'manual_error', 'ac3d58ab-7790-4d04-b093-81aae4b93de9', 0),
  (16, NULL, 'manual_error', '39bcfa0f-3069-46a0-8b3f-42c0af18fc9e', 0),
  (5080, NULL, 'production_error', '39bcfa0f-3069-46a0-8b3f-42c0af18fc9e', 5080),
  (1, '2025-06-13T22:33:03.448Z', 'data_loaded', '0e8fdcd2-946c-4625-837a-ff2a0d52df51', 1),
  (4, NULL, 'production_success', '0e8fdcd2-946c-4625-837a-ff2a0d52df51', 4),
  (5076, NULL, 'production_error', '0e8fdcd2-946c-4625-837a-ff2a0d52df51', 5076),
  (1, '2025-06-16T08:02:53.002Z', 'data_loaded', 'b39b634c-ae34-4b66-8f1a-918bf919c5d4', 1),
  (14, NULL, 'manual_error', 'b39b634c-ae34-4b66-8f1a-918bf919c5d4', 0),
  (20, NULL, 'manual_success', 'b39b634c-ae34-4b66-8f1a-918bf919c5d4', 0),
  (182, NULL, 'production_success', 'c5b22202-d4e2-42f2-95d7-887395682461', 182),
  (2, NULL, 'manual_error', '27050adb-53c8-4c0f-823a-8ec4780c9013', 0),
  (1, '2025-06-17T21:09:25.510Z', 'data_loaded', '531851ec-f877-4ca0-8d30-d88ffaf9b725', 1),
  (79, NULL, 'manual_success', '531851ec-f877-4ca0-8d30-d88ffaf9b725', 0),
  (2, NULL, 'manual_error', '531851ec-f877-4ca0-8d30-d88ffaf9b725', 0),
  (152, NULL, 'production_success', '531851ec-f877-4ca0-8d30-d88ffaf9b725', 0),
  (66, NULL, 'production_error', 'c5b22202-d4e2-42f2-95d7-887395682461', 65),
  (1, '2025-06-19T14:34:08.511Z', 'data_loaded', 'a37a0f8d-ede9-435d-80a7-2096d556f917', 1),
  (3, NULL, 'manual_error', 'a37a0f8d-ede9-435d-80a7-2096d556f917', 0),
  (1, '2025-06-19T19:29:00.531Z', 'data_loaded', 'b5ed2014-2d1f-4b55-a927-f66fb7faadb4', 1),
  (10, NULL, 'manual_success', 'b5ed2014-2d1f-4b55-a927-f66fb7faadb4', 0),
  (1, '2025-06-19T20:38:06.859Z', 'data_loaded', 'cbb79522-63a7-46c5-be30-40bbeaec4f83', 1),
  (4, NULL, 'manual_success', 'cbb79522-63a7-46c5-be30-40bbeaec4f83', 0),
  (11, NULL, 'manual_error', 'cbb79522-63a7-46c5-be30-40bbeaec4f83', 0),
  (1, '2025-06-20T19:06:54.560Z', 'data_loaded', 'd7ee32c2-706a-45b4-85f2-f13d79be98c1', 1),
  (137, NULL, 'manual_success', 'd7ee32c2-706a-45b4-85f2-f13d79be98c1', 0),
  (32, NULL, 'manual_error', 'd7ee32c2-706a-45b4-85f2-f13d79be98c1', 0),
  (10, NULL, 'production_success', '68341065-f882-48bb-a2ae-ed1cf7e2b942', 0),
  (1, '2025-06-21T22:48:02.753Z', 'data_loaded', '68341065-f882-48bb-a2ae-ed1cf7e2b942', 1),
  (22, NULL, 'manual_success', '68341065-f882-48bb-a2ae-ed1cf7e2b942', 0),
  (7, NULL, 'manual_error', '68341065-f882-48bb-a2ae-ed1cf7e2b942', 0),
  (13, NULL, 'manual_error', '8d8b1694-9572-4846-a456-92c04280373e', 0),
  (1, '2025-06-22T20:04:15.980Z', 'data_loaded', '8d8b1694-9572-4846-a456-92c04280373e', 1),
  (41, NULL, 'manual_success', '8d8b1694-9572-4846-a456-92c04280373e', 0),
  (1, '2025-06-23T12:21:13.939Z', 'data_loaded', '907e280f-d954-4529-84de-8f2c7901321e', 1),
  (1, NULL, 'manual_success', '907e280f-d954-4529-84de-8f2c7901321e', 0),
  (1, NULL, 'manual_error', '907e280f-d954-4529-84de-8f2c7901321e', 0),
  (1, '2025-06-23T15:26:29.721Z', 'data_loaded', 'c726e40c-b73d-4c54-b509-c47ef3b51778', 1),
  (2, NULL, 'manual_success', 'c726e40c-b73d-4c54-b509-c47ef3b51778', 0),
  (2, NULL, 'manual_error', 'c726e40c-b73d-4c54-b509-c47ef3b51778', 0),
  (63, NULL, 'production_error', 'd7c4b9c9-6755-41f1-bbe7-c3d1b229baca', 63),
  (1, NULL, 'manual_error', 'a7b58ba7-e662-4e98-b7d9-45ce3d991502', 0),
  (3, NULL, 'manual_success', '05dd6bf9-7748-47db-b163-85247f2ab443', 0),
  (2, NULL, 'production_success', 'd7c4b9c9-6755-41f1-bbe7-c3d1b229baca', 2),
  (1, '2025-09-17T08:54:32.981Z', 'data_loaded', '3609c61d-0960-4015-be46-258f25197488', 1),
  (1, NULL, 'manual_success', '3609c61d-0960-4015-be46-258f25197488', 0);


COMMIT;

-- ‚úÖ Migration completata con tutte le tabelle!
